require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],2:[function(require,module,exports){
"use strict";

var ready        = require('elements/domready'),
    map          = require('prime/map')(),
    merge        = require('mout/object/merge'),
    forEach      = require('mout/array/forEach'),
    trim         = require('mout/string/trim'),
    $            = require('../utils/elements.utils'),
    decouple     = require('../utils/decouple'),
    asyncForEach = require('../utils/async-foreach');

var Map         = map,
    Assignments = {
        toggleSection: function(e, element, index, array) {
            if (e.type.match(/^touch/)) { e.preventDefault(); }
            if (element.siblings('[data-g-global-filter]') || element.parent('[data-g-global-filter]')) { return Assignments.globalToggleSection(e, element); }
            if (element.matches('label')) { return Assignments.treatLabel(e, element); }

            var card    = element.parent('.card'),
                toggles = Map.get(card),
                save    = $('[data-save]'),
                mode    = element.data('g-assignments-check') == null ? 0 : 1;

            if (!toggles || !toggles.inputs) {
                var inputs = card.search('.enabler input[type=hidden]');

                if (!toggles) { toggles = Map.set(card, { inputs: inputs }).get(card); }
                if (!toggles.inputs) { toggles = Map.set(card, merge(Map.get(card), { inputs: inputs })).get(card); }
            }

            // if necessary we should move to asyncForEach for an asynchronous loop, else forEach
            asyncForEach(toggles.inputs, function(item) {
                item = $(item);

                if (item.parent('label, h4').compute('display') == 'none') { return; }

                item.value(mode).emit('change');
                $('body').emit('change', { target: item });
            }, function() {
                if (typeof index !== 'undefined' && typeof array !== 'undefined' && (index + 1 == array.length)) {
                    save.disabled(false);
                }
            });
        },

        filterSection: function(e, element, value, global) {
            if (element.siblings('[data-g-global-filter]') || element.parent('[data-g-global-filter]')) { return Assignments.globalFilterSection(e, element); }

            var card        = element.parent('.card'),
                onlyEnabled = $('[data-assignments-enabledonly]'),
                items       = Map.get(card) || Map.set(card, { labels: card.search('label .settings-param-title') }).get(card);

            value = value || element.value();

            if (!items || !items.labels) {
                var labels = card.search('label .settings-param-title');

                if (!items) { items = Map.set(card, { labels: labels }).get(card); }
                if (!items.labels) { items = Map.set(card, merge(Map.get(card), { labels: labels })).get(card); }
            }

            items = $(items.labels);

            if (!value && !onlyEnabled.checked()) {
                card.style('display', 'inline-block');
                return items ? items.search('!> label').style('display', 'block') : items;
            }

            var count = 0, off = 0, on = 0, text, match;

            if (!items) {
                element.parent('.card').style('display', onlyEnabled.checked() || value ? 'none' : 'inline-block');
            }

            asyncForEach(items, function(item, i) {
                item = $(item);
                text = trim(item.text());
                match = text.match(new RegExp("^" + value + '|\\s' + value, 'gi'));

                if (onlyEnabled.checked()) {
                    match = Number(!!match) & Number(item.parent('label, h4').find('.enabler input[type="hidden"]').value());
                }

                if (match) {
                    var group = item.parent('[data-g-assignments-parent]');
                    if (group && (group = group.data('g-assignments-parent'))) {
                        var parentGroup = item.parent('.card').find('[data-g-assignments-group="' + group + '"]');
                        if (parentGroup) { parentGroup.style('display', 'block'); }
                    }

                    item.parent('label, h4').style('display', 'block');
                    on++;
                } else {
                    item.parent('label, h4').style('display', 'none');
                    off++;
                }

                count++;
                if (count == items.length && global) {
                    card.style('display', !on ? 'none' : 'inline-block');
                }
            });
        },

        filterEnabledOnly: function(e, element) {
            var global = $('[data-g-global-filter] input[type="text"]');
            Assignments.globalFilterSection(e, global, element);
        },

        treatLabel: function(event, element) {
            if (event && event.stopPropagation && event.preventDefault) {
                event.stopPropagation();
                event.preventDefault();
            }

            if ($(event.target).matches('.knob, .toggle')) { return; }
            var input = element.find('input[type="hidden"]:not([disabled])');
            if (!input) { return; }

            var value = input.value();
            value = !!+value;
            input.value(Number(!value)).emit('change');
            $('body').emit('change', { target: input });

            return false;
        },

        globalToggleSection: function(e, element) {
            var mode   = element.data('g-assignments-check') == null ? '[data-g-assignments-uncheck]' : '[data-g-assignments-check]',
                save   = $('[data-save]'),
                search = $('#assignments .card ' + mode + ', ' + '.settings-assignments .card ' + mode);

            if (!search) { return; }

            save.disabled(true);
            // if necessary we should move to asyncForEach for an asynchronous loop
            asyncForEach(search, function(item, index, array) {
                Assignments.toggleSection(e, $(item), index, array);
            });
        },

        globalFilterSection: function(e, element) {
            var value       = element.value(),
                onlyEnabled = $('[data-assignments-enabledonly]'),
                search      = $('#assignments .card .search input[type="text"], .settings-assignments .card .search input[type="text"]');

            if (!search && !onlyEnabled.checked()) { return; }

            asyncForEach(search, function(item) {
                Assignments.filterSection(e, $(item), value, 'global');
            });
        },

        toggleStateDelegation: function(event, element) {
            var enabled = element.value() == '1';
            element.attribute('disabled', !enabled);
        },

        // chrome workaround for overflow and columns
        chromeFix: function() {
            if (!Assignments.isChrome()) { return; }
            var panels = $('#assignments .settings-param-wrapper, .settings-assignments .settings-param-wrapper'), height, maxHeight;
            if (!panels) { return; }

            panels.forEach(function(panel){
                panel = $(panel);
                maxHeight = parseInt(panel.compute('max-height'), 10);
                height = panel[0].getBoundingClientRect().height;
                panel.style({overflow: height >= maxHeight ? 'auto' : 'visible'});

                if (height >= maxHeight) {
                    var alt = 100;
                    decouple(panel, 'scroll', function() {
                        alt = alt == 100 ? 100.01 : 100;
                        panel.parent('.card').style('width', alt + '%');
                    });
                }
            });
        },

        isChrome: function() {
            return navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
        }
    };

ready(function() {
    var body = $('body');

    body.delegate('input', '#assignments .search input[type="text"], .settings-assignments .search input[type="text"]', Assignments.filterSection);
    body.delegate('click', '#assignments .card label, #assignments [data-g-assignments-check], #assignments [data-g-assignments-uncheck], .settings-assignments .card label, .settings-assignments [data-g-assignments-check], .settings-assignments [data-g-assignments-uncheck]', Assignments.toggleSection);
    body.delegate('touchend', '#assignments .card label, #assignments [data-g-assignments-check], #assignments [data-g-assignments-uncheck], .settings-assignments .card label, .settings-assignments [data-g-assignments-check], .settings-assignments [data-g-assignments-uncheck]', Assignments.toggleSection);
    body.delegate('change', '[data-assignments-enabledonly]', Assignments.filterEnabledOnly);
    body.delegate('change', '#assignments input[type="hidden"][name], .settings-assignments input[type="hidden"][name]', Assignments.toggleStateDelegation);

    // chrome workaround for overflow and columns
    //if (Assignments.isChrome()) Assignments.chromeFix();
});

module.exports = Assignments;

},{"../utils/async-foreach":62,"../utils/decouple":63,"../utils/elements.utils":64,"elements/domready":109,"mout/array/forEach":172,"mout/object/merge":235,"mout/string/trim":270,"prime/map":300}],3:[function(require,module,exports){
"use strict";
var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    ui            = require('../ui'),
    interpolate   = require('mout/string/interpolate'),
    modal         = ui.modal,
    trim          = require('mout/string/trim'),

    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,
    getAjaxSuffix = require('../utils/get-ajax-suffix');

ready(function() {
    // Changelog links
    $('body').delegate('click', '[data-changelog]', function(event, element) {
        event.preventDefault();

        modal.open({
            content: 'Loading',
            method: 'post',
            className: 'g5-dialog-theme-default g5-modal-changelog',
            data: { version: element.data('changelog') },
            remote: parseAjaxURI(getAjaxURL('changelog') + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) { return; }

                var wrapper  = content.elements.content,
                    sections = wrapper.search('#g-changelog > ol > li > a');

                sections.forEach(function(section, i) {
                    section = $(section);
                    var href      = section.href(),
                        re        = new RegExp('#(common|' + GANTRY_PLATFORM + ')$', "gi"),
                        collapsed = !href.match(re),
                        status    = 'chevron-' + (!collapsed ? 'up' : 'down');

                    if (!trim(section.text())) {
                        // no platforms
                        return;
                    }

                    // if it's not common but the current platform, move it after common
                    if (i && !collapsed) {
                        section.parent('li').after(section.parent('ol').find('> li'));
                    }

                    zen('i[class="fa g-changelog-toggle fa-fw fa-' + status + '"]').bottom(section);

                    if (collapsed) {
                        section.nextSibling().style({
                            overflow: 'hidden',
                            height: 0
                        });
                    }

                    section.on('click', function(e) {
                        e.preventDefault();
                        var icon      = section.find('i[class*="fa-chevron-"]'),
                            collapsed = icon.hasClass('fa-chevron-down');

                        if (collapsed) {
                            icon.removeClass('fa-chevron-down').addClass('fa-chevron-up');
                            section.nextSibling().slideDown();
                        } else {
                            icon.removeClass('fa-chevron-up').addClass('fa-chevron-down');
                            section.nextSibling().slideUp();
                        }
                    });
                });
            }
        });
    });
});

},{"../ui":53,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"elements":111,"elements/domready":109,"elements/zen":135,"mout/string/interpolate":259,"mout/string/trim":270}],4:[function(require,module,exports){
"use strict";

var $             = require('elements'),
    ready         = require('elements/domready'),
    request       = require('agent'),

    modal         = require('../ui').modal,
    guid          = require('mout/random/guid'),
    trim          = require('mout/string/trim'),

    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,

    History       = require('../utils/history'),
    getParam      = require('mout/queryString/getParam'),
    setParam      = require('mout/queryString/setParam');


var refreshWordpressLinks = function (title, value) {
    if (GANTRY_PLATFORM == 'wordpress') {
        // refresh URIs with new configuration name
        var replace = title.replace(/[^a-z\d_-\s]/i, '_').toLowerCase(),
            find = $('[href*="/' + value + '/"]'),
            currentURI = History.getPageUrl(),
            currentView = getParam(currentURI, 'view');

        if (find) {
            find.forEach(function(lnk){
                lnk = $(lnk);
                var href = lnk.href().replace('/' + value + '/', '/' + replace + '/');
                lnk.href(href);
            });
        }

        currentView = currentView.replace('/' + value + '/', '/' + replace + '/');
        currentURI = setParam(currentURI, 'view', currentView);
        History.replaceState({ uuid: guid(), doNothing: true }, window.document.title, currentURI);
    }
};

ready(function() {
    var body = $('body');

    var selectized, select, editable, href;
    body.delegate('keydown', '.config-select-wrap [data-title-edit]', function(event, element) {
        var key = (event.which ? event.which : event.keyCode);
        if (key == 32 || key == 13) { // ARIA support: Space / Enter toggle
            event.preventDefault();
            body.emit('mousedown', event);
        }
    });

    body.delegate('mousedown', '.config-select-wrap [data-title-edit]', function(event, element) {
        selectized = element.siblings('.g-selectize-control');
        select = element.siblings('select');
        editable = element.siblings('[data-title-editable]');

        if (!editable.gConfEditAttached) {
            editable.gConfEditAttached = true;
            editable.on('title-edit-end', function(title, original, canceled) {
                title = trim(title);
                if (canceled || title == original) {
                    selectized.style('display', 'inline-block');
                    editable.style('display', 'none').attribute('contenteditable', null);

                    return;
                }

                element.addClass('disabled');
                element.removeClass('fa-pencil').addClass('fa-spin-fast fa-spinner');
                href = editable.data('g-config-href');

                request('post', parseAjaxURI(href + getAjaxSuffix()), { title: title }, function(error, response) {
                    if (!response.body.success) {
                        modal.open({
                            content: response.body.html || response.body,
                            afterOpen: function(container) {
                                if (!response.body.html) { container.style({ width: '90%' }); }
                            }
                        });

                        editable.data('title-editable', original).text(original);
                    } else {
                        var selectize = select.selectizeInstance,
                            value = select.value(),
                            data = selectize.Options[value];

                        data[selectize.options.labelField] = title;
                        selectize.updateOption(value, data);

                        selectized.style('display', 'inline-block');
                        editable.style('display', 'none')
                    }

                    // fix Wordpress non unique IDs by refreshing all hrefs
                    refreshWordpressLinks(title, value);

                    element.removeClass('disabled');
                    element.removeClass('fa-spin-fast fa-spinner').addClass('fa-pencil');
                });
            });
        }

        editable.style({
            width: selectized.compute('width'),
            display: 'inline-block'
        });
        selectized.style('display', 'none');
    });
});

module.exports = {};

},{"../ui":53,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/history":73,"agent":78,"elements":111,"elements/domready":109,"mout/queryString/getParam":245,"mout/queryString/setParam":247,"mout/random/guid":249,"mout/string/trim":270}],5:[function(require,module,exports){
"use strict";

var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    trim          = require('mout/string/trim'),
    keys          = require('mout/object/keys'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    request       = require('agent'),
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,

    flags         = require('../utils/flags-state');

require('./dropdown-edit');

ready(function() {
    var body = $('body');

    // Handles Creating new Configurations
    body.delegate('click', '[data-g5-outline-create], [data-g5-outline-duplicate]', function(event, element) {
        if (event) { event.preventDefault(); }

        modal.open({
            content: 'Loading',
            method: 'post',
            overlayClickToClose: false,
            remote: parseAjaxURI(element.href() + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }

                var title   = content.elements.content.find('[name="title"]'),
                    confirm = content.elements.content.find('[data-g-outline-create-confirm]');

                title.on('keyup', function(event) {
                    var code = event.which;
                    if (code === 13) {
                        confirm.emit('click');
                    }
                });

                confirm.on('click', function() {
                    confirm.hideIndicator();
                    confirm.showIndicator();

                    var URI  = parseAjaxURI(confirm.data('g-outline-create-confirm') + getAjaxSuffix()),
                        from    = content.elements.content.find('[name="from"]:checked'),
                        preset  = content.elements.content.find('[name="preset"]'),
                        outline = content.elements.content.find('[name="outline"]'),
                        inherit = content.elements.content.find('[name="inherit"]'),
                        data = {
                            title: title.value(),
                            from: from ? from.value() : null,
                            preset: preset ? preset.value() : null,
                            outline: outline ? outline.value() : null,
                            inherit: inherit.checked() ? 1 : 0
                        };

                    ['title', 'from', 'preset', 'outline'].forEach(function(key) {
                        if (!data[key]) { delete data[key]; }
                    });

                    request('post', URI, data, function(error, response) {
                        confirm.hideIndicator();

                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            var base    = $('#configurations').find('ul').find('li'),
                                outline = zen('li').attribute('class', base.attribute('class'));

                            outline.after(base).html(response.body.outline);

                            toastr.success(response.body.html || 'Action successfully completed.', response.body.title || '');

                            attachEditables(outline.find('[data-title-editable]'));
                            modal.close();
                        }

                    });
                });

                setTimeout(function() {
                    title[0].focus();
                }, 5);
            }
        });
    });

    // Handles Preset / Outline switcher in Outline creation
    body.delegate('change', 'input[type="radio"]#from-preset, input[type="radio"]#from-outline', function(event, element) {
        element = $(element);
        var value    = element.value(),
            elements = element.parent('.card').search('.g-create-from');

        var filtered = elements.style('display', 'none').filter(function(block) {
            block = $(block);
            return block.hasClass('g-create-from-' + value);
        });

        if (filtered) {
            $(filtered).style('display', 'block');
        }
    });

    // Handles Configurations Duplicate / Remove
    body.delegate('click', '#configurations [data-g-config]', function(event, element) {
        var mode        = element.data('g-config'),
            href        = element.data('g-config-href'),
            hrefConfirm = element.data('g-config-href-confirm'),
            encode      = window.btoa(href),//.substr(-20, 20), // in case the strings gets too long
            method      = (element.data('g-config-method') || 'post').toLowerCase();

        if (event && event.preventDefault) { event.preventDefault(); }

        if (mode == 'delete' && !flags.get('free:to:delete:' + encode, false)) {
            // confirm before proceeding
            flags.warning({
                url: parseAjaxURI(href + getAjaxSuffix()),
                callback: function(response, content) {
                    var confirm = content.find('[data-g-delete-confirm]'),
                        cancel  = content.find('[data-g-delete-cancel]');

                    if (!confirm) { return; }

                    confirm.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        flags.get('free:to:delete:' + encode, true);
                        $([confirm, cancel]).attribute('disabled');
                        body.emit('click', { target: element });

                        modal.close();
                    });

                    cancel.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([confirm, cancel]).attribute('disabled');
                        flags.get('free:to:delete:' + encode, false);

                        modal.close();
                    });
                }
            });

            return false;
        }

        element.hideIndicator();
        element.showIndicator();

        request(method, parseAjaxURI((hrefConfirm || href) + getAjaxSuffix()), {}, function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
            } else {
                var confSelector   = $('#configuration-selector'),
                    currentOutline = confSelector.value(),
                    outlineDeleted = response.body.outline,
                    reload         = $('[href="' + getAjaxURL('configurations') + '"]');

                // if the current outline is the one that's been deleted,
                // fallback to default
                if (outlineDeleted && currentOutline == outlineDeleted) {
                    var ids = keys(confSelector.selectizeInstance.Options);
                    if (ids.length) {
                        reload.href(reload.href().replace('style=' + outlineDeleted, 'style=' + ids.shift()));
                    }
                }

                if (!reload) { window.location = window.location; }
                else {
                    body.emit('click', { target: reload });
                }

                toastr.success(response.body.html || 'Action successfully completed.', response.body.title || '');
                if (outlineDeleted) {
                    body.outlineDeleted = outlineDeleted;
                }
            }

            element.hideIndicator();
        });

    });

    // Handles Configurations Titles Rename
    var updateTitle     = function(title, original, wasCanceled) {
            this.style('text-overflow', 'ellipsis');
            if (wasCanceled || title == original) { return; }
            var element = this,
                href    = element.data('g-config-href'),
                method  = (element.data('g-config-method') || 'post').toLowerCase(),
                parent  = element.parent();

            parent.showIndicator();
            parent.find('[data-title-edit]').addClass('disabled');

            request(method, parseAjaxURI(href + getAjaxSuffix()), { title: trim(title) }, function(error, response) {
                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });

                    element.data('title-editable', original).text(original);
                } else {
                    element.data('title', title).data('tip', title);

                    // refresh ID label and actions buttons
                    var dummy   = zen('div').html(response.body.outline),
                        id      = dummy.find('h4 span:last-child'),
                        actions = dummy.find('.outline-actions');

                    element.parent('.card').find('h4 span:last-child').html(id.html());
                    element.parent('.card').find('.outline-actions').html(actions.html());
                }

                parent.hideIndicator();
                parent.find('[data-title-edit]').removeClass('disabled');
            });
        },

        attachEditables = function(editables) {
            if (!editables || !editables.length) { return; }
            editables.forEach(function(editable) {
                editable = $(editable);
                editable.confWasAttached = true;
                editable.on('title-edit-start', function() {
                    editable.style('text-overflow', 'inherit');
                });
                editable.on('title-edit-end', updateTitle);
            });
        };

    body.on('statechangeAfter', function(event, element) {
        var editables = $('#configurations [data-title-editable]');
        if (!editables) { return true; }

        editables = editables.filter(function(editable) {
            return (typeof $(editable).confWasAttached) === 'undefined';
        });

        attachEditables(editables);
    });

    attachEditables($('#configurations [data-title-editable]'));
});

module.exports = {};

},{"../ui":53,"../utils/flags-state":67,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"./dropdown-edit":4,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/object/keys":234,"mout/string/trim":270}],6:[function(require,module,exports){
"use strict";
var ready         = require('elements/domready'),
    $             = require('elements/attributes'),
    storage       = require('prime/map'),
    deepEquals    = require('mout/lang/deepEquals'),
    is            = require('mout/lang/is'),
    isString      = require('mout/lang/isString'),
    hasOwn        = require('mout/object/has'),
    forEach       = require('mout/collection/forEach'),
    invoke        = require('mout/array/invoke'),
    History       = require('../utils/history'),
    flags         = require('../utils/flags-state'),
    submit        = require('./submit');

require('./multicheckbox');

var originals,
    collectFieldsValues = function(keys) {
        var map      = new storage(),
            defaults = $('[data-g-styles-defaults]'),
            overridables = $('input[type="checkbox"].settings-param-toggle');

        defaults = defaults ? JSON.parse(defaults.data('g-styles-defaults')) : {};

        // keep track of overrides getting enabled / disabled
        // in order to detect if has changed
        if (overridables) {
            var overrides = {};

            overridables.forEach(function(override) {
                override = $(override);
                overrides[override.id()] = override.checked();
            });

            map.set('__js__overrides', JSON.stringify(overrides));
        }

        if (keys) {
            var field;
            keys.forEach(function(key) {
                field = $('[name="' + key + '"]');
                if (field) {
                    map.set(key, field.value());
                }
            });

            return map;
        }

        var fields = $('.settings-block [name]');
        if (!fields) { return false; }

        fields.forEach(function(field) {
            field = $(field);
            var key     = field.attribute('name'),
                isInput = !hasOwn(defaults, key);

            if (field.type() == 'checkbox' && !field.value().length) { field.value('0'); }
            map.set(key, isInput ? field.value() : defaults[key]);
        }, this);

        return map;
    },
    createMapFrom       = function(data) {
        var map = new storage();

        forEach(data, function(value, key) {
            map.set(key, value);
        });

        return map;
    };

var compare = {
    single: function() {},
    whole: function() {},
    blanks: function() {},
    presets: function() {}
};

ready(function() {
    var body = $('body'), presetsCache;

    originals = collectFieldsValues();

    compare.single = function(event, element) {
        var parent      = element.parent('.settings-param') || element.parent('h4') || element.parent('.input-group'),
            target      = parent ? (parent.matches('h4') ? parent : parent.find('.settings-param-title, .g-instancepicker-title')) : null,
            isOverride  = parent ? parent.find('.settings-param-toggle') : false,
            isNewWidget = false,
            isOverrideToggle = element.hasClass('settings-param-toggle');

        if (!parent) { return; }

        if (isOverrideToggle) {
            return compare.whole('force');
        }

        if (element.type() == 'checkbox') {
            element.value(Number(element.checked()).toString());
        }

        if (originals && originals.get(element.attribute('name')) == null) {
            originals.set(element.attribute('name'), element.value());
            isNewWidget = true;
        }

        if (!target || !originals || originals.get(element.attribute('name')) == null) { return; }
        if (originals.get(element.attribute('name')) !== element.value() || isNewWidget) {
            if (isOverride && event.forceOverride && !isOverride.checked()) { isOverride[0].click(); }
            target.showIndicator('changes-indicator font-small fa fa-circle-o fa-fw');
        } else {
            if (isOverride && event.forceOverride && isOverride.checked()) { isOverride[0].click(); }
            target.hideIndicator();
        }

        compare.blanks(event, parent.find('.settings-param-field'));
        compare.whole('force');
        compare.presets();
    };

    compare.whole = function(force) {
        if (!originals) { return; }
        var equals = deepEquals(originals, collectFieldsValues(force ? originals.keys() : null), function(a, b) {
                if (isString(a) && isString(b) && a.substr(0, 1) == '#' && b.substr(0, 1) == '#') {
                    return a.toLowerCase() == b.toLowerCase();
                } else {
                    return is(a, b);
                }
            }),
            save   = $('[data-save]');

        if (!save) { return; }

        flags.set('pending', !equals);
        save[equals ? 'hideIndicator' : 'showIndicator']('changes-indicator fa fa-circle-o fa-fw');
    };

    compare.blanks = function(event, element) {
        if (!element) { return; }
        var field = element.find('[name]'),
            reset = element.find('.g-reset-field');
        if (!field || !reset) { return true; }

        var value = field.value();
        if (!value || field.disabled()) { reset.style('display', 'none'); }
        else { reset.removeAttribute('style'); }
    };

    compare.presets = function() {
        var presets = $('[data-g-styles]'), store;
        if (!presets) { return; }

        if (!presetsCache) {
            presetsCache = new storage();
            forEach(presets, function(preset, index) {
                preset = $(preset);
                store = {
                    index: index,
                    map: createMapFrom(JSON.parse(preset.data('g-styles')))
                };
                presetsCache.set(preset, store);
            });
        }

        var fields, equals;
        presetsCache.forEach(function(data, element) {
            fields = collectFieldsValues(data.map.keys());

            // Do not consider __js__overrides when comparing for equality
            fields.unset('__js__overrides');

            equals = deepEquals(fields, data.map, function(a, b) { return a == b; });
            $($('[data-g-styles]')[data.index]).parent()[equals ? 'addClass' : 'removeClass']('g-preset-match');
        });
    };

    body.delegate('input', '.settings-block input[name][type="text"], .settings-block textarea[name]', compare.single);
    body.delegate('change', '.settings-block input[name][type="hidden"], .settings-block input[name][type="checkbox"], .settings-block select[name], .settings-block .selectized[name], .settings-block input[id][type="checkbox"].settings-param-toggle', compare.single);

    body.delegate('input', '.g-urltemplate', function(event, element) {
        var previous = element.parent('.settings-param').siblings();
        if (!previous) { return; }

        previous = previous.find('[data-g-urltemplate]');

        if (previous) {
            var template = previous.data('g-urltemplate');
            previous.attribute('href', template.replace(/#ID#/g, element.value()));
        }
    });

    // fields resets
    body.delegate('mouseenter', '.settings-param-field', compare.blanks, true);
    body.delegate('click', '.g-reset-field', function(e, element) {
        var parent = element.parent('.settings-param-field'), field;
        if (!parent) { return; }

        field = parent.find('[name]');
        if (field && !field.disabled()) {
            var selectize = field.selectizeInstance;
            if (selectize) { selectize.setValue(''); }
            else { field.value(''); }

            field.emit('change');
            body.emit('input', { target: field });
            body.emit('keyup', { target: field });
        }
    });

    body.on('statechangeEnd', function() {
        var State = History.getState();
        body.emit('updateOriginalFields');
    });

    body.on('updateOriginalFields', function() {
        originals = collectFieldsValues();
        compare.presets();
    });

    // force a presets comparison check
    compare.presets();
});

module.exports = {
    compare: compare,
    collect: collectFieldsValues,
    submit: submit
};

},{"../utils/flags-state":67,"../utils/history":73,"./multicheckbox":7,"./submit":8,"elements/attributes":106,"elements/domready":109,"mout/array/invoke":176,"mout/collection/forEach":187,"mout/lang/deepEquals":199,"mout/lang/is":200,"mout/lang/isString":209,"mout/object/has":232,"prime/map":300}],7:[function(require,module,exports){
"use strict";
var $        = require('elements/attributes'),
    ready    = require('elements/domready'),
    remove   = require('mout/array/remove'),
    insert   = require('mout/array/insert'),
    contains = require('mout/array/contains');


ready(function() {
    var body = $('body');

    body.delegate('change', '.input-multicheckbox .input-group input[name][type="hidden"]', function(event, element) {
        var name = element.attribute('name'),
            values = element.value().split(','),
            fields = $('[data-multicheckbox-field="' + name +'"]');

        if (fields) {
            fields.forEach(function(field) {
                field = $(field);
                if (field.checked()) { insert(values, field.value()); }
                if (!field.checked()) { remove(values, field.value()); }
            });
        }

        element.value(values.filter(String).join(','));
    });

    body.delegate('change', '.input-multicheckbox .input-group input[data-multicheckbox-field][type="checkbox"]', function(event, element) {
        var field     = $('[name="' + element.data('multicheckbox-field') + '"]'),
            value     = element.value(),
            values    = field.value().split(','),
            isChecked = element.checked();

        if (isChecked) { insert(values, value); }
        if (!isChecked) { remove(values, value); }

        field.value(values.filter(String).join(','));

        body.emit('change', {target: field});
    });
});


},{"elements/attributes":106,"elements/domready":109,"mout/array/contains":164,"mout/array/insert":174,"mout/array/remove":179}],8:[function(require,module,exports){
'use strict';

var $             = require('elements'),
    isArray       = require('mout/lang/isArray'),
    contains      = require('mout/array/contains'),
    trim          = require('mout/string/trim'),
    validateField = require('../utils/field-validation');

var submit = function(elements, container, options) {
    var valid   = [],
        invalid = [];

    elements = $(elements);
    container = $(container);
    options = options || {};

    $(elements).forEach(function(input) {
        input = $(input);
        var name = input.attribute('name'),
            type = input.attribute('type');
        if (!name || input.disabled() || (type == 'radio' && !input.checked())) { return; }

        input = container.find('[name="' + name + '"]' + (type == 'radio' ? ':checked' : ''));

        // workaround for checkboxes trick that has both a hidden and checkbox field
        if (type === 'checkbox' && container.find('[type="hidden"][name="' + name + '"]')) {
            input = container.find('[name="' + name + '"][type="checkbox"]');
        }

        if (input) {
            var value    = input.type() == 'checkbox' ? Number(input.checked()) : input.value(),
                parent   = input.parent('.settings-param'),
                override = parent ? parent.find('> input[type="checkbox"]') : null;

            override = override || $(input.data('override-target'));

            if (contains(['select', 'select-multiple'], input.type()) && input.attribute('multiple')) {
                value = (input.search('option[selected]') || []).map(function(selection) {
                    return $(selection).value();
                });
            }

            if (override && !override.checked()) { return; }
            if (!validateField(input)) { invalid.push(input); }

            if (isArray(value)) {
                value.forEach(function(selection) {
                    valid.push(name + '[]=' + encodeURIComponent(selection));
                });
            } else {
                if (!options.submitUnchecked || (input.type() != 'checkbox' || (input.type() == 'checkbox' && !!value))) {
                    valid.push(name + '=' + encodeURIComponent(value));
                }
            }
        }
    });

    var titles = container.search('h4 [data-title-editable]'), key;
    if (titles) {
        titles.forEach(function(title) {
            title = $(title);
            if (title.parent('[data-collection-template]')) { return; }

            key = title.data('collection-key') || (options.isRoot ? 'settings[title]' : 'title');
            valid.push(key + '=' + encodeURIComponent(trim(title.data('title-editable'))));
        });
    }

    return { valid: valid, invalid: invalid };
};

module.exports = submit;
},{"../utils/field-validation":66,"elements":111,"mout/array/contains":164,"mout/lang/isArray":201,"mout/string/trim":270}],9:[function(require,module,exports){
"use strict";
// deprecated (5.2.0)
var prime      = require('prime'),
    $          = require('elements'),
    Base       = require('./base'),
    zen        = require('elements/zen'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

var Atom = new prime({
    inherits: Base,
    options: {
        type: 'atom'
    },

    constructor: function(options) {
        Base.call(this, options);

        this.on('changed', this.hasChanged);
    },

    updateTitle: function(title) {
        this.block.find('.title').text(title);
        this.setTitle(title);
        return this;
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            subtype      = this.getSubType() ? 'data-lm-blocksubtype="' + this.getSubType() + '"' : '';
        return '<div class="' + this.getType() + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" ' + subtype + '><span><span class="title">' + this.getTitle() + '</span><span class="font-small">' + (this.getSubType() || this.getKey() || this.getType()) + '</span></span><div class="float-right"><i aria-label="Configure Atom Settings" class="fa fa-cog" data-lm-nodrag data-lm-nodrag data-lm-settings="' + settings_uri + '"></i></div></div>';
    },

    hasChanged: function(state, parent) {
        var icon = this.block.find('span > i.changes-indicator:first-child');

        // if the particle has changes but the parent block doesn't, we want to keep the indicator showing
        if (icon && parent && !parent.changeState) { return; }

        this.block[state ? 'addClass' : 'removeClass']('block-has-changes');

        if (!state && icon) { icon.remove(); }
        if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').before(this.block.find('.icon')); }
    },

    onRendered: function(element, parent) {
        var globally_disabled = $('[data-lm-disabled][data-lm-subtype="' + this.getSubType() + '"]');

        if (globally_disabled || this.getAttribute('enabled') === 0) { this.disable(); }
    }
});

module.exports = Atom;

},{"../../utils/get-ajax-url":69,"./base":11,"elements":111,"elements/zen":135,"prime":299}],10:[function(require,module,exports){
"use strict";
// deprecated (5.2.0)
var prime   = require('prime'),
    $       = require('elements'),
    zen     = require('elements/zen'),
    bind    = require('mout/function/bind'),
    Section = require('./section');

var Atoms = new prime({
    inherits: Section,
    options: {
        type: 'atoms',
        attributes: {
            name: "Atoms Section"
        }
    },

    layout: function() {
        this.deprecated = '<div class="atoms-notice">Looking for Atoms? To make it easier we moved them in the <a href="#"><i class="fa fa-fw fa-list-alt"></i> Page Settings</a>.</div>';

        return '<div class="atoms-section" style="display: none;" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '"><div class="section-header clearfix"><h4 class="float-left">' + (this.getAttribute('name')) + '</h4></div></div>';
    },

    getId: function() {
        return this.id || (this.id = this.options.type);
    },

    onDone: function(event) {
        // Gantry 5.2.0: Remove atoms section if empty to keep the layout clear
        if (!this.block.search('[data-lm-blocktype="atom"]')) {
            var ids = [this.getId()], segments = this.block.search('[data-lm-id]');
            if (segments) {
                segments.forEach(function(element) {
                    ids.push($(element).data('lm-id'));
                });
            }

            ids.reverse().forEach(bind(function(id) {
                this.options.builder.remove(id);
            }, this));

            this.block.empty()[0].outerHTML = this.deprecated;
            this._attachRedirect();

            return;
        }

        if (!this.block.search('[data-lm-id]')) {
            this.grid.insert(this.block, 'bottom');
            this.options.builder.add(this.grid);
        }

        zen('div').html(this.deprecated).firstChild().after(this.block);

        this._attachRedirect();
    },

    _attachRedirect: function() {
        var item = $('[data-g5-nav="page"]');
        if (!item) { return; }

        $('.atoms-notice a').on('click', function(event) {
            event.preventDefault();
            $('body').emit('click', { target: item });
        });
    }
});

module.exports = Atoms;

},{"./section":19,"elements":111,"elements/zen":135,"mout/function/bind":190,"prime":299}],11:[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    Options   = require('prime-util/prime/options'),
    Bound     = require('prime-util/prime/bound'),
    Emitter   = require('prime/emitter'),
    zen       = require('elements/zen'),
    trim      = require('mout/string/trim'),
    $         = require('elements'),
    ID        = require('../id'),

    size      = require('mout/object/size'),
    get       = require('mout/object/get'),
    has       = require('mout/object/has'),
    set       = require('mout/object/set'),
    translate = require('../../utils/translate'),
    getCurrentOutline  = require('../../utils/get-outline').getCurrentOutline;

require('elements/traversal');

var Base = new prime({
    mixin: [Bound, Options],
    inherits: Emitter,
    options: {
        subtype: false,
        attributes: {},
        inherit: {}
    },
    constructor: function(options) {
        this.setOptions(options);

        this.fresh = !this.options.id;
        this.id = this.options.id || ID(this.options);
        this.attributes = this.options.attributes || {};
        this.inherit = this.options.inherit || {};

        this.block = zen('div').html(this.layout()).firstChild();

        this.on('rendered', this.bound('onRendered'));

        return this;
    },

    guid: function() {
        return guid();
    },

    getId: function() {
        return this.id || (this.id = ID(this.options));
    },

    getType: function() {
        return this.options.type || '';
    },

    getSubType: function() {
        return this.options.subtype || '';
    },

    getTitle: function() {
        return trim(this.options.title || 'Untitled');
    },

    setTitle: function(title) {
        this.options.title = trim(title || 'Untitled');
        return this;
    },

    getKey: function() {
        return '';
    },

    getPageId: function() {
        var root = $('[data-lm-root]');
        if (!root) return 'data-root-not-found';

        return root.data('lm-page');
    },

    getAttribute: function(key) {
        return get(this.attributes, key);
    },

    getAttributes: function() {
        return this.attributes || {};
    },

    getInheritance: function() {
        return this.inherit || {};
    },

    updateTitle: function() {
        return this;
    },

    setAttribute: function(key, value) {
        set(this.attributes, key, value);
        return this;
    },

    setAttributes: function(attributes) {
        this.attributes = attributes;

        return this;
    },

    setInheritance: function(inheritance) {
        this.inherit = inheritance;

        return this;
    },

    hasAttribute: function(key) {
        return has(this.attributes, key);
    },

    enableInheritance: function() {},

    disableInheritance: function() {},

    refreshInheritance: function() {},

    hasInheritance: function() {
        return size(this.inherit) && this.inherit.outline != getCurrentOutline();
    },

    disable: function() {
        this.block.title(translate('GANTRY5_PLATFORM_JS_LM_DISABLED_PARTICLE', 'particle'));
        this.block.addClass('particle-disabled');
    },

    enable: function() {
        this.block.removeAttribute('title');
        this.block.removeClass('particle-disabled');
    },

    insert: function(target, location) {
        this.block[location || 'after'](target);
        return this;
    },

    adopt: function(element) {
        element.insert(this.block);
        return this;
    },

    isNew: function(fresh) {
        if (typeof fresh !== 'undefined') {
            this.fresh = !!fresh;
        }
        return this.fresh;
    },

    dropzone: function() {
        return 'data-lm-dropzone';
    },

    addDropzone: function() {
        this.block.data('lm-dropzone', true);
    },

    removeDropzone: function() {
        this.block.data('lm-dropzone', null);
    },

    layout: function() {},

    onRendered: function() {},

    setLayout: function(layout) {
        this.block = layout;
        return this;
    },

    getLimits: function() {
        return false;
    }
});

module.exports = Base;

},{"../../utils/get-outline":70,"../../utils/translate":76,"../id":26,"elements":111,"elements/traversal":134,"elements/zen":135,"mout/object/get":231,"mout/object/has":232,"mout/object/set":239,"mout/object/size":240,"mout/string/trim":270,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],12:[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    Base      = require('./base'),
    $         = require('../../utils/elements.utils'),
    zen       = require('elements/zen'),
    precision = require('mout/number/enforcePrecision'),
    bind      = require('mout/function/bind');

var Block = new prime({
    inherits: Base,
    options: {
        type: 'block',
        attributes: {
            size: 100
        }
    },

    constructor: function(options) {
        Base.call(this, options);
        if (options.attributes && options.attributes.size) this.setAttribute('size', precision(options.attributes.size, 1));

        this.on('changed', this.hasChanged);
    },

    getSize: function() {
        return precision(this.getAttribute('size'), 1);
    },

    setSize: function(size, store) {
        size = typeof size === 'undefined' ? this.getSize() : Math.max(0, Math.min(100, parseFloat(size)));
        size = precision(size, 1);
        if (store) {
            this.setAttribute('size', size);
        }

        $(this.block).style({
            flex: '0 1 ' + size + '%',
            '-webkit-flex': '0 1 ' + size + '%',
            '-ms-flex': '0 1 ' + size + '%'
        });

        this.emit('resized', size, this);
    },

    setAnimatedSize: function(size, store) {
        size = typeof size === 'undefined' ? this.getSize() : Math.max(0, Math.min(100, parseFloat(size)));
        size = precision(size, 1);
        if (store) {
            this.setAttribute('size', size);
        }
        $(this.block).animate({
            flex: '0 1 ' + size + '%',
            '-webkit-flex': '0 1 ' + size + '%',
            '-ms-flex': '0 1 ' + size + '%'
        }, bind(function() {
            this.block.attribute('style', null);
            this.setSize(size);
        }, this));

        this.emit('resized', size, this);
    },

    setLabelSize: function(size) {
        var label = this.block.find('> .particle-size');
        if (!label) { return false; }

        label.text(precision(size, 1) + '%');
    },

    layout: function() {
        return '<div class="g-block" data-lm-id="' + this.getId() + '"' + this.dropzone() + ' data-lm-blocktype="block"></div>';
    },

    onRendered: function(element, parent) {
        if (element.block.find('> [data-lm-blocktype="section"]')) {
            this.removeDropzone();
        }

        if (!parent) { return; }

        var grandpa = parent.block.parent();
        if (grandpa.data('lm-root') || (grandpa.data('lm-blocktype') == 'container' && (grandpa.parent().data('lm-root') || grandpa.parent().data('lm-blocktype') == 'wrapper'))) {
            zen('span.particle-size').text(this.getSize() + '%').top(element.block);
            element.on('resized', this.bound('onResize'));
        }
    },

    onResize: function(resize) {
        this.setLabelSize(resize);
    },

    hasChanged: function(state) {
        var icon,
            child = this.block.find('> [data-lm-id]:not([data-lm-blocktype="section"]):not([data-lm-blocktype="container"])');

        this.changeState = state;

        if (!child) {
            child = this.block.find('> .particle-size') || this.block.parent('[data-lm-blocktype="block"]').find('> .particle-size');
            icon = child.find('i:first-child');

            if (!state && icon) { icon.remove(); }
            if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').top(child); }

            return;
        }

        var mapped = this.options.builder.get(child.data('lm-id'));
        if (mapped) { mapped.emit('changed', state, this); }
    }
});

module.exports = Block;

},{"../../utils/elements.utils":64,"./base":11,"elements/zen":135,"mout/function/bind":190,"mout/number/enforcePrecision":220,"prime":299}],13:[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    Base       = require('./base'),
    zen        = require('elements/zen'),
    $          = require('elements'),
    getAjaxURL = require('../../utils/get-ajax-url').config,
    translate  = require('../../utils/translate');

var Container = new prime({
    inherits: Base,
    options: {
        type: 'container'
    },

    constructor: function(options) {
        Base.call(this, options);
        this.on('changed', this.hasChanged);
    },

    layout: function() {
        return '<div class="g-lm-container" data-lm-id="' + this.getId() + '" data-lm-blocktype="container"></div>';
    },

    onRendered: function(element, parent) {
        if (!parent) {
            this.addSettings(element);
        }
    },

    hasChanged: function(state, child) {
        var icon = this.block.find('span.title > i:first-child');

        // if the the event is triggered from a grid we need to be cautious not to override the proper state
        if (icon && child && !child.changeState) { return; }

        this.block[state ? 'addClass' : 'removeClass']('block-has-changes');

        if (!state && icon) { icon.remove(); }
        if (state && !icon) {
            var title = this.block.find('span.title');
            if (title) { zen('i.fa.fa-circle-o.changes-indicator').top(title); }
        }
    },

    addSettings: function(container) {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            wrapper      = zen('div.container-wrapper.clearfix').top(container.block),
            title        = zen('div.container-title').bottom(wrapper),
            actions      = zen('div.container-actions').bottom(wrapper);

        title.html('<span class="title">' + this.getType() + '</span>');
        actions.html('<span data-tip="' + translate('GANTRY5_PLATFORM_JS_LM_SETTINGS', 'Container') + '" data-tip-place="top-left"><i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_CONFIGURE_SETTINGS', 'Container') + '" class="fa fa-cog" data-lm-settings="' + settings_uri + '"></i></span>');
    }
});

module.exports = Container;

},{"../../utils/get-ajax-url":69,"../../utils/translate":76,"./base":11,"elements":111,"elements/zen":135,"prime":299}],14:[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    Base       = require('./base'),
    $          = require('elements'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

var Grid = new prime({
    inherits: Base,
    options: {
        type: 'grid'
    },

    constructor: function(options) {
        Base.call(this, options);

        this.on('changed', this.hasChanged);
    },

    layout: function() {
        return '<div class="g-grid nowrap" data-lm-id="' + this.getId() + '" ' + this.dropzone() + '  data-lm-samewidth data-lm-blocktype="grid"></div>';
    },

    onRendered: function() {
        var parent = this.block.parent();
        if (parent && parent.data('lm-blocktype') == 'atoms') {
            this.block.removeClass('nowrap');
        }

        if (parent && parent.data('lm-root') || (parent.data('lm-blocktype') == 'container' && parent.parent().data('lm-root'))) {
            this.removeDropzone();
        }
    },

    hasChanged: function(state) {
        // Grids don't have room for an indicator so we forward it to the parent Section
        var parent = this.block.parent('[data-lm-blocktype="section"]'),
            id = parent ? parent.data('lm-id') : false;

        this.changeState = state;

        if (!parent || !id) { return; }

        if (this.options.builder) { this.options.builder.get(id).emit('changed', state, this); }
    }
});

module.exports = Grid;

},{"../../utils/get-ajax-url":69,"./base":11,"elements":111,"prime":299}],15:[function(require,module,exports){
module.exports = {
    base: require('./base'),
    atom: require('./atom'),
    section: require('./section'),
    offcanvas: require('./offcanvas'),
    wrapper: require('./wrapper'),
    atoms: require('./atoms'),
    grid: require('./grid'),
    container: require('./container'),
    block: require('./block'),
    particle: require('./particle'),
    position: require('./position'),
    system: require('./system'),
    spacer: require('./spacer')
};

},{"./atom":9,"./atoms":10,"./base":11,"./block":12,"./container":13,"./grid":14,"./offcanvas":16,"./particle":17,"./position":18,"./section":19,"./spacer":20,"./system":21,"./wrapper":22}],16:[function(require,module,exports){
"use strict";
var prime              = require('prime'),
    Section            = require('./section'),

    getAjaxURL         = require('../../utils/get-ajax-url').config,
    getOutlineNameById = require('../../utils/get-outline').getOutlineNameById,
    translate          = require('../../utils/translate');

var Offcanvas = new prime({
    inherits: Section,
    options: {
        type: 'offcanvas',
        attributes: {
            name: "Offcanvas Section"
        }
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            inheritance  = '',
            klass        = '';

        if (this.hasInheritance()) {
            var outline = getOutlineNameById(this.inherit.outline);
            inheritance = '<div class="g-inherit g-section-inherit"><div class="g-inherit-content">' + translate('GANTRY5_PLATFORM_INHERITING_FROM_X', '<strong>' + outline + '</strong>') + '</div></div>';
            klass = ' g-inheriting g-inheriting-' + this.inherit.include.join(' g-inheriting-');
        }

        return '<div class="offcanvas-section' + klass + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '"><div class="section-header clearfix"><h4 class="float-left" title="' + this.getAttribute('name') + '">' + this.getAttribute('name') + '</h4><div class="section-actions float-right"><span data-tip="' + translate('GANTRY5_PLATFORM_JS_LM_ADD_ROW', 'Offcanvas') + '" data-tip-place="top-right"><i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_ADD_ROW', 'Offcanvas') + '" class="fa fa-plus"></i></span> <span class="section-settings" data-tip="' + translate('GANTRY5_PLATFORM_JS_LM_SETTINGS', 'Offcanvas') + '" data-tip-place="top-right"><i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_CONFIGURE_SETTINGS', 'Offcanvas') + '" class="fa fa-cog" data-lm-settings="' + settings_uri + '"></i></span></div></div>' + inheritance + '</div>';
    },

    getId: function() {
        return this.id || (this.id = this.options.type);
    }
});

module.exports = Offcanvas;

},{"../../utils/get-ajax-url":69,"../../utils/get-outline":70,"../../utils/translate":76,"./section":19,"prime":299}],17:[function(require,module,exports){
(function (global){
"use strict";
var prime              = require('prime'),
    $                  = require('elements'),
    Atom               = require('./atom'),
    bind               = require('mout/function/bind'),
    precision          = require('mout/number/enforcePrecision'),
    forOwn             = require('mout/object/forOwn'),
    getAjaxURL         = require('../../utils/get-ajax-url').config,
    getOutlineNameById = require('../../utils/get-outline').getOutlineNameById,
    translate          = require('../../utils/translate');

var UID = 0;

var Particle = new prime({
    inherits: Atom,
    options: {
        type: 'particle'
    },

    constructor: function(options) {
        ++UID;
        Atom.call(this, options);
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            subtype      = this.getSubType() ? 'data-lm-blocksubtype="' + this.getSubType() + '"' : '',
            klass        = '';

        if (this.hasInheritance()) {
            klass = ' g-inheriting';
            if (this.inherit.include.length) {
                klass += ' g-inheriting-' + this.inherit.include.join(' g-inheriting-');
            }
        }

        return '<div class="' + this.getType() + klass + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" ' + subtype + '><span><span class="icon" ' + this.addInheritanceTip(true) + '><i class="fa ' + this.getIcon() + '"></i></span><span class="title">' + this.getTitle() + '</span><span class="font-small">' + (this.getKey() || this.getSubType() || this.getType()) + '</span></span><div class="float-right"><span class="particle-size"></span> <i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_CONFIGURE_SETTINGS', 'Particle') + '" class="fa fa-cog" data-lm-nodrag data-lm-settings="' + settings_uri + '"></i></div></div>';
    },

    enableInheritance: function() {
        this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
        if (this.hasInheritance()) {
            var outline = getOutlineNameById(this.inherit.outline),
                icon    = this.block.find('.icon');

            this.block.addClass('g-inheriting');
            if (this.inherit.include.length) {
                this.block.addClass('g-inheriting-' + this.inherit.include.join(' g-inheriting-'));
            }

            this.block.find('.icon .fa').attribute('class', 'fa ' + this.getIcon());

            forOwn(this.getInheritanceTip(), function(value, key) {
                icon.data(key, value);
            });

            global.G5.tips.reload();
        }
    },

    disableInheritance: function() {
        var icon    = this.block.find('.icon');

        this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
        this.block.removeClass('g-inheriting');
        this.block.find('.icon .fa').attribute('class', 'fa ' + this.getIcon());

        forOwn(this.getInheritanceTip(), function(value, key) {
            icon.data(key, null);
        });

        global.G5.tips.reload();
    },

    refreshInheritance: function() {
        this.block[this.hasInheritance() ? 'removeClass' : 'addClass']('g-inheritance');
        if (this.hasInheritance()) {
            this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
        }
    },

    addInheritanceTip: function(html) {
        var tooltip = this.getInheritanceTip();

        if (html) {
            var tooltipHTML = '';
            forOwn(tooltip, function(value, key) {
                tooltipHTML += 'data-' + key + '="' + value + '" ';
            });

            tooltip = tooltipHTML;
        }

        return this.hasInheritance() ? tooltip : '';
    },

    getInheritanceTip: function() {
        var outline = getOutlineNameById(this.inherit ? this.inherit.outline : null),
            particle = this.inherit.particle || '',
            include = (this.inherit.include || []).join(', ');

        return {
            'tip': translate('GANTRY5_PLATFORM_INHERITING_FROM_X', '<strong>' + outline + '</strong>') + '<br />ID: ' + particle + '<br />Replace: ' + include,
            'tip-offset': -10,
            'tip-place': 'top-right'
        };
    },

    cleanKlass: function(klass) {
        klass = (klass || '').split(' ');

        return klass.filter(function(item) { return !item.match(/^g-inheriting-/); }).join(' ');
    },

    setLabelSize: function(size) {
        var label = this.block.find('.particle-size');
        if (!label) { return false; }

        label.text(precision(size, 1) + '%');
    },

    onRendered: function(element, parent) {
        var size              = parent.getSize() || 100,
            globally_disabled = $('[data-lm-disabled][data-lm-subtype="' + this.getSubType() + '"]');

        if (globally_disabled || this.getAttribute('enabled') === 0) { this.disable(); }

        this.setLabelSize(size);
        parent.on('resized', this.bound('onParentResize'));
    },

    getParent: function() {
        var parent = this.block.parent('[data-lm-id]');

        return this.options.builder.get(parent.data('lm-id'));
    },

    onParentResize: function(resize) {
        this.setLabelSize(resize);
    },

    getIcon: function() {
        if (this.hasInheritance()) {
            return 'fa-lock';
        }

        var type     = this.getType(),
            subtype  = this.getSubType(),
            template = $('.particles-container [data-lm-blocktype="' + type + '"][data-lm-subtype="' + subtype + '"]');

        return template ? template.data('lm-icon') : 'fa-cube';
    },

    getLimits: function(parent) {
        if (!parent) { return false; }

        var sibling = parent.block.nextSibling() || parent.block.previousSibling() || false;

        if (!sibling) { return [100, 100]; }

        var siblingBlock = this.options.builder.get(sibling.data('lm-id')),
            sizes        = {
                current: this.getParent().getSize(),
                sibling: siblingBlock.getSize()
            };

        return [5, (sizes.current + sizes.sibling) - 5];
    }
});

module.exports = Particle;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../utils/get-ajax-url":69,"../../utils/get-outline":70,"../../utils/translate":76,"./atom":9,"elements":111,"mout/function/bind":190,"mout/number/enforcePrecision":220,"mout/object/forOwn":230,"prime":299}],18:[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    trim     = require('mout/string/trim'),
    Particle = require('./particle');

var UID = 0;

var Position = new prime({
    inherits: Particle,
    options: {
        type: 'position'
    },

    constructor: function(options) {
        ++UID;
        Particle.call(this, options);
        this.setAttribute('title', this.getTitle());
        this.setAttribute('key', this.getKey());

        if (this.isNew()) { --UID; }
    },

    getTitle: function() {
        return trim(this.options.title || 'Position ' + UID);
    },

    getKey: function() {
        return (this.getAttribute('key') || trim(this.getTitle()).replace(/\s/g, '-').toLowerCase());
    },

    updateKey: function(key) {
        this.options.key = key || this.getKey();
        this.block.find('.font-small').text(this.getKey());
        return this;
    },
});

module.exports = Position;

},{"./particle":17,"mout/string/trim":270,"prime":299}],19:[function(require,module,exports){
"use strict";
var prime              = require('prime'),
    Base               = require('./base'),
    Bound              = require('prime-util/prime/bound'),
    Grid               = require('./grid'),
    $                  = require('elements'),
    zen                = require('elements/zen'),

    bind               = require('mout/function/bind'),
    forOwn             = require('mout/object/forOwn'),
    getAjaxURL         = require('../../utils/get-ajax-url').config,
    getOutlineNameById = require('../../utils/get-outline').getOutlineNameById,
    translate          = require('../../utils/translate');

require('elements/insertion');

var UID = 0;

var Section = new prime({
    inherits: Base,
    options: {},

    constructor: function(options) {
        ++UID;
        this.grid = new Grid();
        Base.call(this, options);

        this.on('done', this.bound('onDone'));
        this.on('changed', this.hasChanged);
    },

    layout: function() {
        var settings_uri     = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            inheritanceLabel = '',
            klass            = '';

        if (this.hasInheritance()) {
            var outline = getOutlineNameById(this.inherit.outline);
            inheritanceLabel = this.renderInheritanceLabel(outline);
            klass = ' g-inheriting';

            if (this.inherit.include.length) {
                klass += ' g-inheriting-' + this.inherit.include.join(' g-inheriting-');
            }
        }

        return '<div class="section' + klass + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" data-lm-blocksubtype="' + this.getSubType() + '"><div class="section-header clearfix"><h4 class="float-left" title="' + this.getTitle() + '">' + this.getTitle() + '</h4><div class="section-actions float-right"><span class="section-addrow" data-tip="' + translate('GANTRY5_PLATFORM_JS_LM_ADD_ROW', 'Section') + '" data-tip-place="top-right"><i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_ADD_ROW', 'Section') + '" class="fa fa-plus"></i></span> <span class="section-settings" data-tip="' + translate('GANTRY5_PLATFORM_JS_LM_SETTINGS', 'Section') + '" data-tip-place="top-right"><i aria-label="' + translate('GANTRY5_PLATFORM_JS_LM_CONFIGURE_SETTINGS', 'Section') + '" class="fa fa-cog" data-lm-settings="' + settings_uri + '"></i></span></div></div>' + inheritanceLabel + '</div>';
    },

    adopt: function(child) {
        $(child).insert(this.block.find('.g-grid'));
    },

    renderInheritanceLabel: function(outline) {
        var content = translate('GANTRY5_PLATFORM_INHERITING_FROM_X', '<strong>' + outline + '</strong>');

        if (this.block && this.getParent()) {
            content = '';
        }

        return '<div class="g-inherit g-section-inherit"><div class="g-inherit-content" ' + this.addInheritanceTip(true) + '><i class="fa fa-lock"></i> ' + content + '</div></div>';
    },

    enableInheritance: function() {
        if (this.hasInheritance()) {
            this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
            this.block.addClass('g-inheriting');
            if (this.inherit.include.length) {
                this.block.addClass('g-inheriting-' + this.inherit.include.join(' g-inheriting-'));
            }

            if (!this.block.find('> .g-inherit')) {
                var inherit = zen('div'),
                    outline = getOutlineNameById(this.inherit.outline),
                    html    = this.renderInheritanceLabel(outline);

                inherit.html(html).children().after(this.block.find('> .section-header'));
            }
        }
    },

    disableInheritance: function() {
        if (this.block.find('> .g-inherit')) {
            var inherit = this.block.find('> .g-inherit.g-section-inherit');
            if (inherit) {
                inherit.remove();
            }
        }

        this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
        this.block.removeClass('g-inheriting');
    },

    refreshInheritance: function() {
        this.block.attribute('class', this.cleanKlass(this.block.attribute('class')));
        if (this.hasInheritance()) {
            this.enableInheritance();
            var overlay = this.block.find('> .g-inherit');
            if (overlay) {
                var outline = getOutlineNameById(this.inherit.outline),
                    content = zen('div').html(this.renderInheritanceLabel(outline));

                if (overlay && content) { overlay.html(content.children().html()); }
            }
        }
    },

    addInheritanceTip: function(html) {
        var tooltip = this.getInheritanceTip();

        if (html) {
            var tooltipHTML = '';
            forOwn(tooltip, function(value, key) {
                tooltipHTML += 'data-' + key + '="' + value + '" ';
            });

            tooltip = tooltipHTML;
        }

        return this.hasInheritance() ? tooltip : '';
    },

    getInheritanceTip: function() {
        var outline = this.inherit ? this.inherit.outline : null,
            name    = getOutlineNameById(outline),
            include = (this.inherit.include || []).join(', ');

        return {
            'tip': translate('GANTRY5_PLATFORM_INHERITING_FROM_X', '<strong>' + name + '</strong>') + '<br />Outline ID: ' + outline + '<br />Replace: ' + include,
            'tip-offset': -2,
            'tip-place': 'top-right'
        };
    },

    cleanKlass: function(klass) {
        klass = (klass || '').split(' ');

        return klass.filter(function(item) { return !item.match(/^g-inheriting-/); }).join(' ');
    },

    hasChanged: function(state, child) {
        var icon = this.block.find('h4 > i:first-child');

        // if the the event is triggered from a grid we need to be cautious not to override the proper state
        if (icon && child && !child.changeState) { return; }

        this.block[state ? 'addClass' : 'removeClass']('block-has-changes');

        if (!state && icon) { icon.remove(); }
        if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').top(this.block.find('h4')); }
    },

    onDone: function(event) {
        if (!this.block.search('[data-lm-id]')) {
            this.grid.insert(this.block, 'bottom');
            this.options.builder.add(this.grid);
        }

        var plus = this.block.find('.fa-plus');
        if (plus) {
            plus.on('click', bind(function(e) {
                if (e) { e.preventDefault(); }

                if (this.block.find('.g-grid:last-child:empty')) { return false; }

                this.grid = new Grid();
                this.grid.insert(this.block.find('[data-lm-blocktype="container"]') ? this.block.find('[data-lm-blocktype="container"]') : this.block, 'bottom');
                this.options.builder.add(this.grid);
            }, this));
        }

        this.refreshInheritance();
    },

    getParent: function() {
        var parent = this.block.parent('[data-lm-id]');

        return parent ? this.options.builder.get(parent.data('lm-id')) : null;
    },

    getLimits: function(parent) {
        if (!parent) { return false; }

        var sibling = parent.block.nextSibling() || parent.block.previousSibling() || false;

        if (!sibling) { return [100, 100]; }

        var siblingBlock = this.options.builder.get(sibling.data('lm-id'));
        if (siblingBlock.getType() !== 'block') { return false; }

        var sizes = {
            current: this.getParent().getSize(),
            sibling: siblingBlock.getSize()
        };

        return [5, (sizes.current + sizes.sibling) - 5];
    }
});

module.exports = Section;

},{"../../utils/get-ajax-url":69,"../../utils/get-outline":70,"../../utils/translate":76,"./base":11,"./grid":14,"elements":111,"elements/insertion":112,"elements/zen":135,"mout/function/bind":190,"mout/object/forOwn":230,"prime":299,"prime-util/prime/bound":295}],20:[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    Particle = require('./particle');

var UID = 0;

var Spacer = new prime({
    inherits: Particle,
    options: {
        type: 'spacer',
        title: 'Spacer',
        attributes: {}
    }
});

module.exports = Spacer;

},{"./particle":17,"prime":299}],21:[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    Particle = require('./particle');

var System = new prime({
    inherits: Particle,
    options: {
        type: 'system',
        attributes: {}
    }
});

module.exports = System;

},{"./particle":17,"prime":299}],22:[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    Section    = require('./section'),

    getAjaxURL = require('../../utils/get-ajax-url').config;

var Wrapper = new prime({
    inherits: Section,
    options: {
        type: 'wrapper',
        attributes: {
            name: "Wrapper"
        }
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId());
        return '<div class="wrapper-section" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" data-lm-blocksubtype="' + this.getSubType() + '"></div>';
    },

    hasChanged: function() {},

    getSize: function() {
        return false;
    },

    getId: function() {
        return this.id || (this.id = this.options.type);
    }
});

module.exports = Wrapper;

},{"../../utils/get-ajax-url":69,"./section":19,"prime":299}],23:[function(require,module,exports){
"use strict";
var prime   = require('prime'),
    $       = require('elements'),
    Emitter = require('prime/emitter');

var Blocks = require('./blocks/');

var forOwn     = require('mout/object/forOwn'),
    forEach    = require('mout/collection/forEach'),
    size       = require('mout/collection/size'),
    isArray    = require('mout/lang/isArray'),
    flatten    = require('mout/array/flatten'),
    ID         = require('./id'),

    set        = require('mout/object/set'),
    unset      = require('mout/object/unset'),
    get        = require('mout/object/get'),
    deepFillIn = require('mout/object/deepFillIn'),
    omit       = require('mout/object/omit');

require('elements/attributes');
require('elements/traversal');


// start Debug
var DEBUG  = false,
    rpad   = require('mout/string/rpad'),
    repeat = require('mout/string/repeat');
// end   Debug

$.implement({
    empty: function() {
        return this.forEach(function(node) {
            var first;
            while ((first = node.firstChild)) {
                node.removeChild(first);
            }
        });
    }
});

var Builder = new prime({

    inherits: Emitter,

    constructor: function(structure) {
        if (structure) {
            this.setStructure(structure);
        }
        this.map = {};

        return this;
    },

    setStructure: function(structure) {
        try {
            this.structure = (typeof structure === 'object') ? structure : JSON.parse(structure);
        }
        catch (e) {
            console.error("Parsing error:", e);
        }
    },

    add: function(block) {
        var id = typeof block === 'string' ? block : block.id;
        set(this.map, id, block);
        block.isNew(false);
    },

    remove: function(block) {
        block = typeof block === 'string' ? block : block.id;
        unset(this.map, block);
    },

    get: function(block) {
        var id = typeof block === 'string' ? block : block.id;
        return get(this.map, id, block);
    },

    load: function(data) {
        this.recursiveLoad(data);
        this.emit('loaded', data);

        return this;
    },

    serialize: function(root, flat) {
        var serieChildren = [];
        root = root || $('[data-lm-root]');

        if (!root) { return; }

        var blocks = root.search((!flat ? '> ' : '') + '[data-lm-id]'),
            id, type, subtype, serial, hasChildren, children;

        forEach(blocks, function(element) {
            element = $(element);
            id = element.data('lm-id');
            type = element.data('lm-blocktype');
            subtype = element.data('lm-blocksubtype') || false;
            hasChildren = element.search('> [data-lm-id]');

            if (flat) {
                children = hasChildren ? hasChildren.map(function(element){ return $(element).data('lm-id'); }) : false;
            } else {
                children = hasChildren ? this.serialize(element) : [];
            }

            serial = {
                id: id,
                type: type,
                subtype: subtype,
                title: get(this.map, id) ? get(this.map, id).getTitle() : 'Untitled',
                attributes: get(this.map, id) ? get(this.map, id).getAttributes() : {},
                inherit: get(this.map, id) ? get(this.map, id).getInheritance() : {},
                children: children
            };

            if (flat) {
                var obj = {}; obj[id] = serial;
                serial = obj;
            }

            serieChildren.push(serial);
        }, this);

        return serieChildren;
    },

    insert: function(key, value, parent/*, object*/) {
        var root = $('[data-lm-root]');
        if (!root) {
            return;
        }

        if (!Blocks[value.type]) {
            console[console.error ? 'error' : 'log'](value.type + ' does not exist');
        }

        var Element = new (Blocks[value.type] || Blocks['section'])(deepFillIn({
            id: key,
            attributes: {},
            inherit: {},
            subtype: value.subtype || false,
            builder: this
        }, omit(value, 'children')));

        if (!parent) {
            Element.block.insert(root);
        }
        else {
            Element.block.insert($('[data-lm-id="' + parent + '"]'));
        }

        if (Element.getType() === 'block') {
            Element.setSize();
        }

        this.add(Element);
        Element.emit('rendered', Element, parent ? get(this.map, parent) : null);

        return Element;
    },

    reset: function(data) {
        this.map = {};
        this.setStructure(data || {});
        $('[data-lm-root]').empty();
        this.load();
    },

    cleanupLonely: function() {
        var ghosts = [],
            parent, children = $('[data-lm-root] > .g-section > .g-grid > .g-block .g-grid > .g-block, [data-lm-root] > .g-section > .g-grid > .g-block > .g-block');

        if (!children) {
            return;
        }


        var isGrid;
        children.forEach(function(child) {
            child = $(child);
            parent = null;
            isGrid = child.parent().hasClass('g-grid');

            if (isGrid && child.siblings()) {
                return false;
            }

            if (isGrid) {
                ghosts.push(child.data('lm-id'));
                parent = child.parent();
            }

            ghosts.push(child.data('lm-id'));
            child.children().before(parent ? parent : child);
            (parent ? parent : child).remove();
        });

        return ghosts;
    },

    recursiveLoad: function(data, callback, depth, parent) {
        data = data || this.structure;
        depth = depth || 0;
        parent = parent || false;
        callback = callback || this.insert;

        forEach(data, function(value/*, key, object*/) {

            if (!value.id) {
                value.id = ID({ builder: { map: this.map }, type: value.type, subtype: value.subtype });
            }

            // debug (flat view of the structure)
            if (console && console.log && DEBUG) {
                console.log(rpad(repeat('    ', depth) + '' + value.type, 35) + ' (' + rpad(value.id, 36) + ') parent: ' + parent);
            }

            this.emit('loading', callback.call(this, value.id, value, parent, depth));
            if (value.children && size(value.children)) {
                depth++;

                forEach(value.children, function(childValue/*, childKey, array*/) {
                    this.recursiveLoad([childValue], callback, depth, value.id);
                }, this);
            }

            this.get(value.id).emit('done', this.get(value.id));

            depth--;
        }, this);
    }
});

module.exports = Builder;

},{"./blocks/":15,"./id":26,"elements":111,"elements/attributes":106,"elements/traversal":134,"mout/array/flatten":171,"mout/collection/forEach":187,"mout/collection/size":189,"mout/lang/isArray":201,"mout/object/deepFillIn":223,"mout/object/forOwn":230,"mout/object/get":231,"mout/object/omit":238,"mout/object/set":239,"mout/object/unset":242,"mout/string/repeat":264,"mout/string/rpad":267,"prime":299,"prime/emitter":298}],24:[function(require,module,exports){
"use strict";
var DragEvents = require('../ui/drag.events'),
    prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    isString   = require('mout/lang/isString'),
    nMap       = require('mout/math/map'),
    clamp      = require('mout/math/clamp'),
    precision  = require('mout/number/enforcePrecision'),
    get        = require('mout/object/get'),
    $          = require('../utils/elements.utils');

require('elements/events');
require('elements/delegation');

var Resizer = new prime({
    mixin: [Bound, Options],
    DRAG_EVENTS: DragEvents,
    options: {
        minSize: 5
    },
    constructor: function(container, options) {
        this.setOptions(options);
        this.history = this.options.history || {};
        this.builder = this.options.builder || {};
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };
    },

    getBlock: function(element) {
        return get(this.builder.map, isString(element) ? element : $(element).data('lm-id') || '');
    },

    getAttribute: function(element, prop) {
        return this.getBlock(element).getAttribute(prop);
    },

    getSize: function(element) {
        return this.getAttribute($(element), 'size');
    },

    start: function(event, element, siblings, offset) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        window.G5.tips.hide(element[0]);
        if (event.which && event.which !== 1) { return true; }

        // Stops text selection
        event.preventDefault();

        this.element = $(element);
        this.siblings = {
            occupied: 0,
            elements: siblings,
            next: this.element.nextSibling(),
            prevs: this.element.previousSiblings(),
            sizeBefore: 0
        };

        if (this.siblings.elements.length > 1) {
            this.siblings.occupied -= this.getSize(this.siblings.next);
            this.siblings.elements.forEach(function(sibling) {
                this.siblings.occupied += this.getSize(sibling);
            }, this);
        }

        if (this.siblings.prevs) {
            this.siblings.prevs.forEach(function(sibling) {
                this.siblings.sizeBefore += this.getSize(sibling);
            }, this);
        }

        this.origin = {
            size: this.getSize(this.element),
            maxSize: this.getSize(this.element) + this.getSize(this.siblings.next),
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX + 6,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
        };

        var clientRect = this.element[0].getBoundingClientRect(),
            parentRect = this.element.parent()[0].getBoundingClientRect();

        this.origin.offset = {
            clientRect: clientRect,
            parentRect: {left: parentRect.left, right: parentRect.right},
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y,
            down: offset
        };

        this.origin.offset.parentRect.left = this.element.parent().find('> [data-lm-id]:first-child')[0].getBoundingClientRect().left;
        this.origin.offset.parentRect.right = this.element.parent().find('> [data-lm-id]:last-child')[0].getBoundingClientRect().right;

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).on(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).on(event, this.bound('stop'));
        }, this));
    },

    move: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        var clientX = event.clientX || event.touches[0].clientX || 0,
            clientY = event.clientY || event.touches[0].clientY || 0,
            parentRect = this.origin.offset.parentRect;

        var deltaX = (this.lastX || clientX) - clientX,
            deltaY = (this.lastY || clientY) - clientY;

        this.direction =
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
            Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                                                                 'down';
        var size,
            diff = 100 - this.siblings.occupied,
            value = clientX + (!this.siblings.prevs ? this.origin.offset.x - this.origin.offset.down : this.siblings.prevs.length),
            normalized = clamp(value, parentRect.left, parentRect.right);

        size = nMap(normalized, parentRect.left, parentRect.right, 0, 100);
        size = size - this.siblings.sizeBefore;
        size = precision(clamp(size, this.options.minSize, this.origin.maxSize - this.options.minSize), 0);

        //grids?
        //console.log((size / 12) * (100 / 12));

        diff = precision(diff - size, 0);

        this.getBlock(this.element).setSize(size, true);
        this.getBlock(this.siblings.next).setSize(diff, true);

        // Hack to handle cases where size is not an integer
        var siblings = this.element.siblings(),
            amount = siblings ? siblings.length + 1 : 1;
        if (amount == 3 || amount == 6 || amount == 7 || amount == 8 || amount == 9 || amount == 11 || amount == 12) {
            var total = 0, blocks;

            blocks = $([siblings, this.element]);
            blocks.forEach(function(block, index){
                block = this.getBlock(block);
                size = block.getSize();
                if (size % 1) {
                    size = precision(100 / amount, 0);
                    block.setSize(size, true);
                }

                total += size;

                if (blocks.length == index + 1 && total != 100) {
                    diff = 100 - total;
                    block.setSize(size + diff, true);
                }

            }, this);
        }

        this.lastX = clientX;
        this.lastY = clientY;
    },

    stop: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('stop'));
        }, this));

        if (event.target.matches('[data-lm-back], [data-lm-forward]')) { return; }
        if (this.origin.size !== this.getSize(this.element)) { this.history.push(this.builder.serialize(), this.history.get().preset); }
    },

    evenResize: function(elements, animated) {
        var total = elements.length,
            size = precision(100 / total, 4),
            block;

        if (typeof animated === 'undefined') { animated = true; }

        elements.forEach(function(element) {
            element = $(element);
            block = this.getBlock(element);
            if (block && block.hasAttribute('size') && typeof block.getSize === 'function') {
                block[animated ? 'setAnimatedSize' : 'setSize'](size, size !== block.getSize());
            } else {
                if (element) { element[animated ? 'animate' : 'style']({ flex: '0 1 ' + size + '%' }); }
            }
        }, this);
    }
});

module.exports = Resizer;

},{"../ui/drag.events":51,"../utils/elements.utils":64,"elements/delegation":108,"elements/events":110,"mout/function/bind":190,"mout/lang/isString":209,"mout/math/clamp":214,"mout/math/map":216,"mout/number/enforcePrecision":220,"mout/object/get":231,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],25:[function(require,module,exports){
var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    slice      = require('mout/array/slice'),
    merge      = require('mout/object/merge'),
    deepEquals = require('mout/lang/deepEquals'),
    deepDiff   = require('deep-diff').diff;

var History = new prime({

    inherits: Emitter,

    constructor: function(session, preset) {
        this.index = 0;
        session = merge({}, session);
        preset = merge({}, preset);
        this.setSession(session, preset);
    },

    undo: function() {
        if (!this.index) return;
        this.index--;

        var session = this.get();
        this.emit('undo', session, this.index);
        return session;
    },

    redo: function() {
        if (this.index == this.session.length - 1) return;
        this.index++;

        var session = this.get();
        this.emit('redo', session, this.index);
        return session;
    },

    reset: function() {
        this.index = 0;

        var session = this.get();
        this.emit('reset', session, this.index);
        return session;
    },

    push: function(session, preset) {
        session = merge({}, session);
        preset = merge({}, preset);
        var sliced = this.index < this.session.length - 1;
        if (this.index < this.session.length - 1) this.session = slice(this.session, 0, -(this.session.length - 1 - this.index));
        session = {
            time: +(new Date()),
            data: session,
            preset: preset
        };

        if (this.equals(session.data)) { return session; }

        this.session.push(session);
        this.index = this.session.length - 1;

        this.emit('push', session, this.index, sliced);
        return session;
    },

    get: function(index) {
        return this.session[typeof index !== 'undefined' ? index : this.index] || false;
    },

    equals: function(session, compare) {
        if (!compare) { compare = this.get().data; }

        return deepEquals(session, compare);
    },

    diff: function(obj1, obj2) {
        if (!obj1 && !obj2 && this.session.length <= 1) { return 'Not enough sessions to diff'; }
        if (!obj2) { obj2 = this.get(); }
        if (!obj1) { obj1 = this.get(this.index - 1); }

        return deepDiff(obj1, obj2);
    },

    setSession: function(session, preset) {
        session = !session ? []
            : [{
            time: +(new Date()),
            data: merge({}, session),
            preset: preset
        }];

        this.session = session;
        this.index = 0;
        return this.session;
    },

    import: function() {},
    export: function() {}
});

module.exports = History;

},{"deep-diff":104,"mout/array/slice":181,"mout/lang/deepEquals":199,"mout/object/merge":235,"prime":299,"prime/emitter":298}],26:[function(require,module,exports){
'use strict';

var keys     = require('mout/object/keys'),
    contains = require('mout/array/contains'),
    rand     = require('mout/random/randInt');

var ID = function(options) {
    var map     = options.builder ? keys(options.builder.map) : {},
        type    = options.type,
        subtype = options.subtype,

        result  = [], key, id;

    if (type != 'particle') result.push(type);
    if (subtype)  result.push(subtype);

    key = result.join('-');

    while (id = rand(1000, 9999)) {
        if (!contains(map, key + '-' + id)) {
            break;
        }
    }

    return key + '-' + id;
};

module.exports = ID;
},{"mout/array/contains":164,"mout/object/keys":234,"mout/random/randInt":252}],27:[function(require,module,exports){
"use strict";
var ready          = require('elements/domready'),
    $              = require('elements/attributes'),
    Submit         = require('../fields/submit'),
    modal          = require('../ui').modal,
    toastr         = require('../ui').toastr,
    sidebar        = require('./particles-sidebar'),
    request        = require('agent'),
    zen            = require('elements/zen'),
    contains       = require('mout/array/contains'),
    size           = require('mout/collection/size'),
    trim           = require('mout/string/trim'),
    strReplace     = require('mout/string/replace'),
    properCase     = require('mout/string/properCase'),
    precision      = require('mout/number/enforcePrecision'),

    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,

    flags         = require('../utils/flags-state'),
    Builder        = require('./builder'),
    History        = require('../utils/history'),
    validateField  = require('../utils/field-validation'),
    LMHistory      = require('./history'),
    LayoutManager  = require('./layoutmanager'),
    SaveState      = require('../utils/save-state'),
    translate      = require('../utils/translate');

require('../ui/popover');
require('./inheritance');

var builder, layoutmanager, lmhistory, savestate, Tips;

builder = new Builder();
lmhistory = new LMHistory();
savestate = new SaveState();

ready(function() {
    var body = $('body');

    body.delegate('click', '[data-lm-back]', function(e, element) {
        if (e) { e.preventDefault(); }
        if ($(element).hasClass('disabled')) return false;
        lmhistory.undo();
    });

    body.delegate('click', '[data-lm-forward]', function(e, element) {
        if (e) { e.preventDefault(); }
        if ($(element).hasClass('disabled')) return false;
        lmhistory.redo();
    });

    /* lmhistory events */
    lmhistory.on('push', function(session, index, reset) {
        var HM = {
            back: $('[data-lm-back]'),
            forward: $('[data-lm-forward]')
        };

        if (index && HM.back && HM.back.hasClass('disabled')) HM.back.removeClass('disabled');
        if (reset && HM.forward && !HM.forward.hasClass('disabled')) HM.forward.addClass('disabled');
        layoutmanager.updatePendingChanges();
    });

    lmhistory.on('undo', function(session, index) {
        var notice = $('#lm-no-layout'),
            title = $('.layout-title .title small'),
            preset_name = session.preset.name || 'Default',
            HM = {
                back: $('[data-lm-back]'),
                forward: $('[data-lm-forward]')
            };

        if (notice) { notice.style({ display: !size(session.data) ? 'block' : 'none' }); }
        if (title) { title.text('(' + properCase(trim(strReplace(preset_name, [/_/g, /\//g], [' ', ' / ']))) + ')'); }

        builder.reset(session.data);
        HM.forward.removeClass('disabled');
        if (!index) HM.back.addClass('disabled');
        layoutmanager.singles('disable');
        layoutmanager.updatePendingChanges();
    });
    lmhistory.on('redo', function(session, index) {
        var notice = $('#lm-no-layout'),
            title = $('.layout-title .title small'),
            preset_name = session.preset.name || 'Default',
            HM = {
                back: $('[data-lm-back]'),
                forward: $('[data-lm-forward]')
            };

        if (notice) { notice.style({ display: !size(session.data) ? 'block' : 'none' }); }
        if (title) { title.text('(' + properCase(trim(strReplace(preset_name, [/_/g, /\//g], [' ', ' / ']))) + ')'); }

        builder.reset(session.data);
        HM.back.removeClass('disabled');
        if (index == this.session.length - 1) HM.forward.addClass('disabled');
        layoutmanager.singles('disable');
        layoutmanager.updatePendingChanges();
    });

});

ready(function() {
    var body = $('body'), root = $('[data-lm-root]'), data;

    // Layout Manager
    layoutmanager = new LayoutManager('[data-lm-container]', {
        delegate: '[data-lm-root] .g-grid > .g-block > [data-lm-blocktype]:not([data-lm-nodrag]) !> .g-block, .g5-lm-particles-picker [data-lm-blocktype], [data-lm-root] [data-lm-blocktype="section"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag]), [data-lm-root] [data-lm-blocktype="section"] > [data-lm-blocktype="container"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag]), [data-lm-root] [data-lm-blocktype="offcanvas"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag]), [data-lm-root] [data-lm-blocktype="offcanvas"] > [data-lm-blocktype="container"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag])',
        droppables: '[data-lm-dropzone]',
        exclude: '.section-header .button, .section-header .fa, .lm-newblocks .float-right .button, [data-lm-nodrag], [data-lm-disabled]',
        resize_handles: '[data-lm-root] .g-grid > .g-block:not(:last-child)',
        builder: builder,
        history: lmhistory,
        savestate: savestate
    });

    module.exports.layoutmanager = layoutmanager;

    // load builder data
    if (root) {
        data = JSON.parse(root.data('lm-root'));
        if (data.name) { data = data.layout; }
        builder.setStructure(data);
        builder.load();

        layoutmanager.history.setSession(builder.serialize(), JSON.parse(root.data('lm-preset')));
        layoutmanager.savestate.setSession(builder.serialize(null, true));
    }

    // attach events
    // Modal Tabs
    body.delegate('click', '.g-tabs a', function(event, element) {
        event.preventDefault();
        return false;
    });
    body.delegate('keydown', '.g-tabs a', function(event, element) {
        var key = (event.which ? event.which : event.keyCode);
        if (key == 32 || key == 13) { // ARIA support: Space / Enter toggle
            event.preventDefault();
            body.emit('mouseup', event);
            return false;
        }
    });
    body.delegate('mouseup', '.g-tabs a', function(event, element) {
        element = $(element);
        event.preventDefault();

        var index = 0,
            parent = element.parent('.g-tabs'),
            panes = parent.siblings('.g-panes'),
            links = parent.search('a');

        links.forEach(function(link, i) {
            if (link == element[0]) { index = i + 1; }
        });

        panes.find('> .active').removeClass('active');
        parent.find('> ul > .active').removeClass('active');
        panes.find('> .g-pane:nth-child(' + index + ')').addClass('active');
        parent.find('> ul > li:nth-child(' + index + ')').addClass('active');

        // ARIA
        if (panes.search('> [aria-expanded]')) { panes.search('> [aria-expanded]').attribute('aria-expanded', 'false'); }
        if (parent.search('> [aria-expanded]')) { parent.search('> [aria-expanded]').attribute('aria-expanded', 'false'); }

        panes.find('> .g-pane:nth-child(' + index + ')').attribute('aria-expanded', 'true');
        if (parent.find('> ul >li:nth-child(' + index + ') [aria-expanded]')) { parent.find('> ul > li:nth-child(' + index + ') > [aria-expanded]').attribute('aria-expanded', 'true'); }
    });

    // Picker
    body.delegate('statechangeBefore', '[data-g5-lm-picker]', function() {
        modal.close();
    });

    // Sub-navigation links
    body.on('statechangeAfter', function(event, element) {
        root = $('[data-lm-root]');
        if (!root) { return true; }
        data = JSON.parse(root.data('lm-root'));
        builder.setStructure(data);
        builder.load();

        layoutmanager.refresh();
        layoutmanager.history.setSession(builder.serialize(), JSON.parse(root.data('lm-preset')));
        layoutmanager.savestate.setSession(builder.serialize(null, true));

        // refresh LM eraser
        layoutmanager.eraser.element = $('[data-lm-eraseblock]');
        layoutmanager.eraser.hide(true);
    });

    // Particles filtering
    body.delegate('input', '.sidebar-block .search input', function(event, element) {
        var value = $(element).value().toLowerCase(),
            list = $('.sidebar-block [data-lm-blocktype]'),
            text, type;
        if (!list) { return false; }

        list.style({ display: 'none' }).forEach(function(blocktype) {
            blocktype = $(blocktype);
            type = blocktype.data('lm-blocktype').toLowerCase();
            text = trim(blocktype.text()).toLowerCase();
            if (type.substr(0, value.length) == value || text.match(value)) {
                blocktype.style({ display: 'block' });
            }
        }, this);
    });

    // Grid same widths button (evenize, equalize)
    ['click', 'touchend'].forEach(function(evt){
        body.delegate(evt, '[data-lm-samewidth]:not(:empty)', function(event, element) {
            window.G5.tips.hide(element[0]);
            var clientRect = element[0].getBoundingClientRect();
            if ((event.clientX || event.pageX || event.changedTouches[0].pageX || 0) < clientRect.width + clientRect.left) { return; }

            var blocks = element.search('> [data-lm-blocktype="block"]'), id;
            if (!blocks || blocks.length == 1) { return; }

            blocks.forEach(function(block) {
                id = $(block).data('lm-id');
                builder.get(id).setSize(100 / blocks.length, true);
            });

            lmhistory.push(builder.serialize(), lmhistory.get().preset);
        });
    });

    body.delegate('mouseover', '[data-lm-samewidth]:not(:empty)', function(event, element) {
        var clientRect = element[0].getBoundingClientRect(),
            clientX = event.clientX || (event.touches && event.touches[0].clientX) || 0,
            tooltips = {
                equalize: clientX + 5 > clientRect.width + clientRect.left,
                move: clientX - 5 < clientRect.left
            };

        if (!tooltips.equalize && !tooltips.move) { return; }

        var msg = tooltips.equalize ? translate('GANTRY5_PLATFORM_JS_LM_GRID_EQUALIZE') : translate('GANTRY5_PLATFORM_JS_LM_GRID_SORT_MOVE');

        element.data('tip', msg).data('tip-offset', -30);

        window.G5.tips
            .get(element[0])
            .content(msg)
            .place(tooltips.equalize ? 'top-left' : 'top-right')
            .show();
    });

    body.delegate('mouseout', '[data-lm-samewidth]:not(:empty)', function(event, element) {
        window.G5.tips.hide(element[0]);
    });

    // Clear Layout
    body.delegate('click', '[data-lm-clear]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var mode = element.data('lm-clear'),
            options = {};

        switch (mode) {
            case 'keep-inheritance':
                options = { save: true, dropLastGrid: false, emptyInherits: false };
                break;
            case 'full':
            default:
                options = { save: true, dropLastGrid: false, emptyInherits: true };
        }

        layoutmanager.clear(null, options);
    });

    // Switcher
    var SWITCHER_HIT = false;
    body.delegate('mouseover', '[data-lm-switcher]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        SWITCHER_HIT = element;
        if (!element.PopoverDefined) {
            element.getPopover({
                type: 'async',
                width: '500',
                url: parseAjaxURI(element.data('lm-switcher') + getAjaxSuffix()),
                allowElementsClick: '.g-tabs a'
            });
        }
    });

    // Switch Layout
    body.delegate('keydown', '[data-switch]', function(event, element){
        var key = (event.which ? event.which : event.keyCode);
        if (key == 32 || key == 13) { // ARIA support: Space toggle
            event.preventDefault();
            body.emit('mousedown', event);
        }
    });

    // Disable keeping particles if inherit option is selected
    body.delegate('change', '[data-g-inherit="outline"]', function(event, element) {
        var keeper = element.parent('.g-pane').find('input[type="checkbox"][data-g-preserve="outline"]');
        if (keeper) { keeper.checked(false); }
    });

    // Disable inheriting section/particles if keep option is selected
    body.delegate('change', '[data-g-preserve="outline"]', function(event, element) {
        var inherit = element.parent('.g-pane').find('input[type="checkbox"][data-g-inherit="outline"]');
        if (inherit) { inherit.checked(false); }
    });

    body.delegate('mousedown', '[data-switch]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        // it's already loading something.
        if (element.parent('.g5-popover-content').find('[data-switch] i')) {
            return false;
        }

        element.showIndicator();

        var preset = $('[data-lm-preset]'),
            preserve = element.parent('.g-pane').find('input[type="checkbox"][data-g-preserve]'),
            inherit = element.parent('.g-pane').find('input[type="checkbox"][data-g-inherit]'),
            method = !preserve ? 'get' : 'post',
            data = {};

        preserve = preserve && preserve.checked();
        inherit = inherit && inherit.checked();

        if (preserve) {
            var lm = layoutmanager;
            lm.singles('cleanup', lm.builder, true);
            lm.savestate.setSession(lm.builder.serialize(null, true));

            data.preset = preset && preset.data('lm-preset') ? preset.data('lm-preset') : 'default';
            data.layout = JSON.stringify(lm.builder.serialize());
        }

        if (inherit) {
            data.inherit = 1;
        }

        var uri = parseAjaxURI(element.data('switch') + getAjaxSuffix());
        request(method, uri, data, function(error, response) {
            element.hideIndicator();

            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
                return;
            }

            if (response.body.message && !flags.get('lm:switcher:' + window.btoa(uri), false)) {
                // confirm before proceeding
                flags.warning({
                    message: response.body.message,
                    callback: function(response, content) {
                        var confirm = content.find('[data-g-delete-confirm]'),
                            cancel  = content.find('[data-g-delete-cancel]');

                        if (!confirm) { return; }

                        confirm.on('click', function(e) {
                            e.preventDefault();
                            if (this.attribute('disabled')) { return false; }

                            flags.get('lm:switcher:' + window.btoa(uri), true);
                            $([confirm, cancel]).attribute('disabled');
                            body.emit('mousedown', { target: element });

                            modal.close();
                        });

                        cancel.on('click', function(e) {
                            e.preventDefault();
                            if (this.attribute('disabled')) { return false; }

                            $([confirm, cancel]).attribute('disabled');
                            flags.get('lm:switcher:' + window.btoa(uri), false);

                            modal.close();
                            if (SWITCHER_HIT) {
                                setTimeout(function(){
                                    SWITCHER_HIT.getPopover().show();
                                }, 5);
                            }
                        });
                    }
                });

                return false;
            }

            var preset = response.body.preset || { name: 'default' },
                preset_name = response.body.title || 'Default',
                structure = response.body.data,
                notice = $('#lm-no-layout'),
                title = $('.layout-title .title small');

            root.data('lm-root', JSON.stringify(structure)).empty();
            root.data('lm-preset', preset);
            if (notice) { notice.style({ display: 'none' }); }
            if (title) { title.text('(' + preset_name + ')'); }
            builder.setStructure(structure);
            builder.load();

            lmhistory.push(builder.serialize(), JSON.parse(preset));

            $('[data-lm-switcher]').getPopover().hideAll().destroy();
        });
    });

    // Particles settings
    body.delegate('click', '[data-lm-settings]', function(event, element) {
        element = $(element);

        var blocktype = element.data('lm-blocktype'),
            settingsURL = element.data('lm-settings'),
            data = null, parent, section;

        // grid is a special case, since relies on pseudo elements for sorting and same width (evenize)
        // we need to check where the user clicked.
        if (blocktype === 'grid') {
            var clientX = event.clientX || (event.touches && event.touches[0].clientX) || 0,
                boundings = element[0].getBoundingClientRect();

            if (clientX + 4 - boundings.left < boundings.width) {
                return false;
            }
        }

        element = element.parent('[data-lm-blocktype]');
        parent = element.parent('[data-lm-blocktype]');
        section = element.parent('[data-lm-blocktype="section"]');
        blocktype = element.data('lm-blocktype');

        var ID = element.data('lm-id'),
            parentID = parent ? parent.data('lm-id') : false,
            parentType = parent ? parent.data('lm-blocktype') : false;

        if (!contains(['block', 'grid'], blocktype)) {
            data = {};
            data.id = builder.get(element.data('lm-id')).getId() || null;
            data.type = builder.get(element.data('lm-id')).getType() || element.data('lm-blocktype') || false;
            data.subtype = builder.get(element.data('lm-id')).getSubType() || element.data('lm-blocksubtype') || false;
            data.title = (element.find('h4') || element.find('.title')).text() || data.type || 'Untitled';
            data.options = builder.get(element.data('lm-id')).getAttributes() || {};
            data.inherit = builder.get(element.data('lm-id')).getInheritance() || {};
            data.block = parent && parentType !== 'wrapper' ? builder.get(parent.data('lm-id')).getAttributes() || {} : {};
            data.size_limits = builder.get(element.data('lm-id')).getLimits(!parent ? false : builder.get(parent.data('lm-id')));
            data.parent = section ? section.data('lm-id') : null;

            if (!data.type) { delete data.type; }
            if (!data.subtype) { delete data.subtype; }
            if (!size(data.options)) { delete data.options; }
            if (!size(data.inherit)) { delete data.inherit; }
            if (!size(data.block)) { delete data.block; }
        }

        modal.open({
            content: 'Loading',
            method: 'post',
            data: data,
            overlayClickToClose: false,
            remote: parseAjaxURI(settingsURL + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }

                var form = content.elements.content.find('form'),
                    fakeDOM = zen('div').html(response.body.html).find('form'),
                    submit = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]');

                if ((!form && !fakeDOM) || !submit) { return true; }

                var urlTemplate = content.elements.content.find('.g-urltemplate');
                if (urlTemplate) { body.emit('input', { target: urlTemplate }); }

                var blockSize = content.elements.content.find('[name="block[size]"]');

                // logic for limits
                if (blockSize && data.size_limits) {
                    var note = content.elements.content.find('.blocksize-note'),
                        min = precision(data.size_limits[0], 1),
                        max = precision(data.size_limits[1], 1);

                    blockSize.attribute('min', min);
                    blockSize.attribute('max', max);

                    if (note) {
                        var noteHTML = note.html();
                        noteHTML = noteHTML.replace(/#min#/g, min);
                        noteHTML = noteHTML.replace(/#max#/g, max);

                        note.html(noteHTML);
                        note.find('.blocksize-' + (min == max ? 'range' : 'fixed')).addClass('hidden');
                    }

                    var isValid = function() {
                        return parseFloat(blockSize.value()) >= min && parseFloat(blockSize.value()) <= max ? '' : translate('GANTRY5_PLATFORM_JS_LM_SIZE_LIMITS_RANGE');
                    };

                    blockSize.on('input', function(){
                        blockSize[0].setCustomValidity(isValid());
                    });
                }

                // Particle Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();

                    var target = $(e.currentTarget);
                    target.disabled(true);

                    target.hideIndicator();
                    target.showIndicator();

                    // Refresh the form to collect fresh and dynamic fields
                    var formElements = content.elements.content.find('form')[0].elements;
                    var post = Submit(formElements, content.elements.content);

                    if (post.invalid.length) {
                        target.disabled(false);
                        target.hideIndicator();
                        target.showIndicator('fa fa-fw fa-exclamation-triangle');
                        toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
                        return;
                    }

                    request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&') || {}, function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            var particle = builder.get(ID),
                                block = null;

                            // particle attributes
                            particle.setAttributes(response.body.data.options);

                            if (particle.hasAttribute('enabled')) { particle[particle.getAttribute('enabled') ? 'enable' : 'disable'](); }

                            if (particle.getType() != 'section') {
                                particle.setTitle(response.body.data.title || 'Untitled');
                                particle.updateTitle(particle.getTitle());
                            }

                            if (particle.getType() == 'position') {
                                particle.updateKey();
                            }

                            // parent block attributes
                            if (response.body.data.block && size(response.body.data.block)) {
                                block = builder.get(parentID);

                                var sibling = block.block.nextSibling() || block.block.previousSibling(),
                                    currentSize = block.getSize(),
                                    diffSize;

                                block.setAttributes(response.body.data.block);

                                diffSize = currentSize - block.getSize();

                                block.setAnimatedSize(block.getSize());

                                if (sibling) {
                                    sibling = builder.get(sibling.data('lm-id'));
                                    sibling.setAnimatedSize(parseFloat(sibling.getSize()) + diffSize, true);
                                }
                            }

                            // particle inheritance
                            if (response.body.data.inherit) {
                                delete response.body.data.inherit.section;
                                particle.setInheritance(response.body.data.inherit);

                                particle.enableInheritance();
                                particle.refreshInheritance();
                            }

                            if (response.body.data.children) {
                                layoutmanager.clear(particle.block, { save: false, dropLastGrid: !!response.body.data.children.length, emptyInherits: true });
                                builder.recursiveLoad(response.body.data.children, builder.insert, 0, particle.getId());
                            }

                            if (particle.hasInheritance() && !response.body.data.inherit) {
                                particle.setInheritance({});
                                particle.disableInheritance();
                            }

                            lmhistory.push(builder.serialize(), lmhistory.get().preset);

                            // if it's apply and save we also save the panel
                            if (target.data('apply-and-save') !== null) {
                                var save = $('body').find('.button-save');
                                if (save) { body.emit('click', { target: save }); }
                            }

                            modal.close();

                            toastr.success(translate('GANTRY5_PLATFORM_JS_PARTICLE_SETTINGS_APPLIED', particle.getTitle()), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }

                        target.hideIndicator();
                    });
                });
            }
        });

    });

});

module.exports = {
    $: $,
    builder: builder,
    layoutmanager: layoutmanager,
    history: lmhistory,
    savestate: savestate
};

},{"../fields/submit":8,"../ui":53,"../ui/popover":55,"../utils/field-validation":66,"../utils/flags-state":67,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/history":73,"../utils/save-state":75,"../utils/translate":76,"./builder":23,"./history":25,"./inheritance":28,"./layoutmanager":29,"./particles-sidebar":30,"agent":78,"elements/attributes":106,"elements/domready":109,"elements/zen":135,"mout/array/contains":164,"mout/collection/size":189,"mout/number/enforcePrecision":220,"mout/string/properCase":262,"mout/string/replace":265,"mout/string/trim":270}],28:[function(require,module,exports){
"use strict";

var $                  = require('elements'),
    ready              = require('elements/domready'),
    request            = require('agent'),
    modal              = require('../../ui').modal,

    isArray            = require('mout/lang/isArray'),
    forEach            = require('mout/collection/forEach'),
    filter             = require('mout/object/filter'),
    keys               = require('mout/object/keys'),
    contains           = require('mout/collection/contains'),

    getAjaxSuffix      = require('../../utils/get-ajax-suffix'),
    parseAjaxURI       = require('../../utils/get-ajax-url').parse,
    getAjaxURL         = require('../../utils/get-ajax-url').global,
    getOutlineNameById = require('../../utils/get-outline').getOutlineNameById,
    getCurrentOutline  = require('../../utils/get-outline').getCurrentOutline;


var IDsMap = {
    attributes: ['g-settings-particle', 'g-settings-atom'],
    block: { panel: 'g-settings-block-attributes', tab: 'g-settings-block' },
    particles: 'g-inherit-particle',
    atoms: 'g-inherit-atom'
};

ready(function() {
    var body             = $('body'),
        currentSelection = {},
        currentMode      = {};

    body.delegate('change', '[name="inherit[outline]"]', function(event, element) {
        var label          = element.parent('.settings-param').find('.settings-param-title'),
            text           = element.siblings().find('.g-item'),
            value          = element.value(),
            name           = $('[name="inherit[section]"]') ? $('[name="inherit[section]"]').value() : '',
            form           = element.parent('[data-g-inheritance-settings]'),
            includesFields = $('[data-multicheckbox-field="inherit[include]"]:checked') || [],
            particle       = {
                list: $('#g-inherit-particle, #g-inherit-atom'),
                mode: $('[name="inherit[mode]"]:checked'),
                radios: $('[name="inherit[particle]"], [name="inherit[atom]"]'),
                checked: $('[name="inherit[particle]"]:checked, [name="inherit[atom]"]:checked')
            };

        if (!text) { return true; }

        var hasChanged = currentSelection[name] !== value || currentMode[name] !== particle.mode.value();

        if (hasChanged && !value) {
            includesFields.forEach(function(include) {
                $(include).checked(false);
                body.emit('change', { target: include });
            });
        }

        var formData = JSON.parse(form.data('g-inheritance-settings')),
            data     = {
                outline: value || getCurrentOutline(),
                type: formData.type || '',
                subtype: formData.subtype || '',
                mode: particle.mode.value(),
                inherit: !!value && particle.mode.value() === 'inherit' ? '1' : '0'
            };

        data.id = formData.id;

        label.showIndicator();
        element.selectizeInstance.blur();

        if (particle.radios && particle.checked) {
            if (!hasChanged) {
                data.selected = particle.checked.value();
                data.id = particle.checked.value();
                particle.list = false;
            }
        }

        var URI_mode = data.type === 'atom' ? 'atoms' : 'layouts',
            URI      = particle.list ? URI_mode + '/list' : URI_mode;

        request('POST', parseAjaxURI(getAjaxURL(URI) + getAjaxSuffix()), data, function(error, response) {
            label.hideIndicator();

            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });

                return;
            }

            var data      = response.body,
                includes  = form.find('[name="inherit[include]"]').value().split(','),
                available = form.search('[data-multicheckbox-field="inherit[include]"]').map(function(item) { return $(item).value(); }),
                container = modal.getByID(modal.getLast()),
                element;

            // refresh field values based on settings and ajax response
            forEach(IDsMap, function(id, option) {
                id = id.panel || id;
                id = !isArray(id) ? [id] : id;

                id.forEach(function(currentID) {
                    var shouldRefresh = contains(includes, option),
                        isAvailable   = contains(available, option);

                    if ((shouldRefresh || !isAvailable) && data.html[currentID] && (element = container.find('#' + currentID))) {
                        element.html(data.html[currentID]);
                        var selects = element.search('[data-selectize]');
                        if (selects) { selects.selectize(); }
                    }
                });
            });

            if (hasChanged && includesFields && currentSelection[name] === '') {
                includesFields.forEach(function(include) { body.emit('change', { target: include }); });
            }

            currentSelection[name] = value;
            currentMode[name] = particle.mode.value();
        });
    });

    body.delegate('change', '#g-settings-inheritance [data-multicheckbox-field]', function(event, element) {
        var outline = $('[name="inherit[outline]"]');
        if (!outline) { return true; }

        outline   = outline.value();

        var value     = element.value(),
            isChecked = element.checked(),
            noRefresh = event.noRefresh,
            particle  = {
                mode: $('[name="inherit[mode]"]:checked'),
                radios: $('[name="inherit[particle]"], [name="inherit[atom]"]'),
                checked: $('[name="inherit[particle]"]:checked, [name="inherit[atom]"]:checked')
            };

        var IDs = {
            panel: (IDsMap[value] && IDsMap[value].panel || IDsMap[value]),
            tab: (IDsMap[value] && IDsMap[value].tab || IDsMap[value])
        };

        if (!isArray(IDs.panel)) {
            IDs.panel = [IDs.panel];
            IDs.tab = [IDs.tab];
        }

        IDs.panel.forEach(function(currentPanel, index) {
            var panel = $('#' + currentPanel),
                tab   = $('#' + IDs.tab[index] + '-tab');

            if (!panel || !tab) { return true; }

            var inherit = panel.find('.g-inherit'),
                isClone = particle.mode.value() === 'clone',
                refresh = function(noRefresh) {
                    if (!noRefresh) {
                        body.emit('change', { target: element.parent('.settings-block').find('[name="inherit[outline]"]') });
                    }
                };

            if (!isChecked || !outline || isClone) {
                var lock = tab.find('.fa-lock');

                if (lock) { lock.removeClass('fa-lock').addClass('fa-unlock'); }
                if (inherit) { inherit.hide(); }
                if (isClone) { refresh(noRefresh); }
            } else {
                var unlock = tab.find('.fa-unlock');

                if (unlock) { unlock.removeClass('fa-unlock').addClass('fa-lock'); }
                if (inherit) { inherit.show(); }

                refresh(noRefresh);
            }
        });
    });


    body.delegate('change', '[name="inherit[mode]"], [name="inherit[particle]"], [name="inherit[atom]"]', function(event, element) {
        var container  = modal.getByID(modal.getLast()),
            outline    = container.find('[name="inherit[outline]"]'),
            checkboxes = container.search('[data-multicheckbox-field]') || [],
            noRefresh  = false;

        if (element.attribute('name') === 'inherit[mode]') {
            noRefresh = true;
        }

        body.emit('change', { target: outline, noRefresh: noRefresh });
        checkboxes.forEach(function(checkbox) {
            body.emit('change', { target: checkbox, noRefresh: noRefresh });
        });
    });

    body.delegate('click', '#g-inherit-particle .fa-info-circle, #g-inherit-atom .fa-info-circle', function(event, element) {
        event.preventDefault();

        var container = modal.getByID(modal.getLast()),
            outline   = container.find('[name="inherit[outline]"]'),
            id        = element.siblings('input[name="inherit[particle]"], input[name="inherit[atom]"]');

        if (!id || !outline) { return false; }

        var URI = id.name() === 'inherit[atom]' ? 'atoms/instance' : 'layouts/particle';
        modal.open({
            content: 'Loading',
            method: 'post',
            data: { id: id.value(), outline: outline.value() || getCurrentOutline() },
            remote: parseAjaxURI(getAjaxURL(URI) + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }
            }
        });

        return false;
    });

    body.delegate('mouseup', '.g-tabs .fa-lock, .g-tabs .fa-unlock', function(event, element) {
        if (!element.parent('li').hasClass('active')) { return false; }

        var container = modal.getByID(modal.getLast()),
            isLocked  = element.hasClass('fa-lock'),
            id        = element.parent('a').id().replace(/\-tab$/, ''),
            prop      = keys(filter(IDsMap, function(value) { return value === id || value.tab === id || contains(value, id); }) || []).shift(),
            input     = container.find('[data-multicheckbox-field][value="' + prop + '"]'),
            particle  = {
                mode: $('[name="inherit[mode]"]:checked'),
                radios: $('[name="inherit[particle]"], [name="inherit[atom]"]'),
                checked: $('[name="inherit[particle]"]:checked, [name="inherit[atom]"]:checked')
            };

        if (input) {
            // do not try to refresh attributes/block inheritance when there's no particle selected
            // or if we are in clone mode
            if (particle.mode.value() === 'clone' || (particle.radios && !particle.checked)) {
                return false;
            }

            input.checked(!isLocked);
            body.emit('change', { target: input });
        }
    });
});

},{"../../ui":53,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/get-outline":70,"agent":78,"elements":111,"elements/domready":109,"mout/collection/contains":185,"mout/collection/forEach":187,"mout/lang/isArray":201,"mout/object/filter":227,"mout/object/keys":234}],29:[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    $          = require('../utils/elements.utils'),
    bind       = require('mout/function/bind'),
    zen        = require('elements/zen'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    Blocks     = require('./blocks'),
    DragDrop   = require('../ui/drag.drop'),
    Eraser     = require('../ui/eraser'),
    flags      = require('../utils/flags-state'),
    Resizer    = require('./drag.resizer'),
    get        = require('mout/object/get'),
    keys       = require('mout/object/keys'),

    every      = require('mout/array/every'),
    precision  = require('mout/number/enforcePrecision'),
    isArray    = require('mout/lang/isArray'),
    deepEquals = require('mout/lang/deepEquals'),
    find       = require('mout/collection/find'),
    isObject   = require('mout/lang/isObject'),

    contains   = require('mout/array/contains'),
    forEach    = require('mout/collection/forEach');

var singles = {
    disable: function() {
        var grids = $('[data-lm-root] [data-lm-blocktype="grid"]');
        if (grids) { grids.removeClass('no-hover'); }
    },
    enable: function() {
        var grids = $('[data-lm-root] [data-lm-blocktype="grid"]');
        if (grids) { grids.addClass('no-hover'); }
    },
    cleanup: function(builder, dropLast, start) {
        var emptyGrids = start ? start.search('> .g-grid:empty') : $('[data-lm-blocktype="section"] > .g-grid:empty, [data-lm-blocktype="container"] > .g-grid:empty, [data-lm-blocktype="offcanvas"] > .g-grid:empty');

        if (emptyGrids) {
            emptyGrids.forEach(function(grid) {
                grid = $(grid);
                // empty grids should go away unless they are last and/or dropLast is true
                if (grid.nextSibling('[data-lm-id]') || dropLast) {
                    builder.remove(grid.data('lm-id'));
                    grid.remove();
                }
            });
        }
    }

};

var LayoutManager = new prime({

    mixin: [Bound, Options],
    inherits: Emitter,

    options: {},

    constructor: function(element, options) {
        this.setOptions(options);
        this.refElement = element;

        if (!element || !$(element)) { return; }

        this.init(element);
    },

    init: function() {
        this.dragdrop = new DragDrop(this.refElement, this.options);
        this.resizer = new Resizer(this.refElement, this.options);
        this.eraser = new Eraser('[data-lm-eraseblock]', this.options);
        this.dragdrop
            .on('dragdrop:start', this.bound('start'))
            .on('dragdrop:location', this.bound('location'))
            .on('dragdrop:nolocation', this.bound('nolocation'))
            .on('dragdrop:resize', this.bound('resize'))
            .on('dragdrop:stop:erase', this.bound('removeElement'))
            .on('dragdrop:stop', this.bound('stop'))
            .on('dragdrop:stop:animation', this.bound('stopAnimation'));

        this.builder = this.options.builder;
        this.history = this.options.history;
        this.savestate = this.options.savestate || null;

        singles.disable();
    },

    refresh: function() {
        if (!this.refElement || !$(this.refElement)) { return; }
        this.init();
    },

    singles: function(mode, builder, dropLast, start) {
        singles[mode](builder, dropLast, start);
    },

    clear: function(parent, options) {
        var type, child,
            filter = !parent ? [] : (parent.search('[data-lm-id]') || []).map(function(element) { return $(element).data('lm-id'); });

        options = options || { save: true, dropLastGrid: false, emptyInherits: false };

        forEach(this.builder.map, function(obj, id) {
            if (filter.length && !contains(filter, id)) { return; }
            if (!options.emptyInherits && obj.block.parent('.g-inheriting')) { return; }

            type = obj.getType();
            child = obj.block.find('> [data-lm-id]');
            if (child) { child = child.data('lm-blocktype'); }
            if (contains(['particle', 'spacer', 'position', 'widget', 'system', 'block'], type) && (type == 'block' && (child && (child !== 'section' && child !== 'container')))) {
                this.builder.remove(id);
                obj.block.remove();
            } else if (options.emptyInherits && (type == 'section' || type == 'offcanvas' || type == 'container')) {
                if (obj.hasInheritance) {
                    obj.inherit = {};
                    obj.disableInheritance();
                }
            }
        }, this);

        this.singles('cleanup', this.builder, options.dropLastGrid, parent);
        if (options.save) { this.history.push(this.builder.serialize(), this.history.get().preset); }
    },

    updatePendingChanges: function() {
        var saveData   = this.savestate.getData(),
            serialData = this.builder.serialize(null, true),
            different  = false,

            equals     = deepEquals(saveData, serialData),
            save       = $('[data-save="Layout"]'),
            icon       = save.find('i'),
            indicator  = save.find('.changes-indicator');

        if (equals && indicator) { save.hideIndicator(); }
        if (!equals && !indicator) { save.showIndicator('changes-indicator fa fa-fw fa-circle-o') }
        flags.set('pending', !equals);

        // Emits the changed event for all particles
        // Used for UI to show particles where there have been differences applied
        // After a saved state
        var saved, current, id;
        serialData.forEach(function(block) {
            id = keys(block)[0];
            saved = find(saveData, function(data) { return data[id]; });
            current = find(serialData, function(data) { return data[id]; });
            different = !deepEquals(saved, current);

            id = this.builder.get(id);
            if (id) { id.emit('changed', different); }
        }, this);
    },

    start: function(event, element) {
        var root = $('[data-lm-root]'),
            size = $(element).position(),
            coords = $(element)[0].getBoundingClientRect();

        this.block = null;
        this.mode = root.data('lm-root') || 'page';

        root.addClass('moving');

        var type  = $(element).data('lm-blocktype'),
            clone = element[0].cloneNode(true);

        if (!this.placeholder) { this.placeholder = zen('div.block.placeholder[data-lm-placeholder]'); }
        this.placeholder.style({ display: 'none' });

        clone = $(clone);
        this.original = clone.after(element).style({
            display: clone.hasClass('g-grid') ? 'flex' : 'block',
            opacity: 0.5
        }).addClass('original-placeholder').data('lm-dropzone', null);

        if (type === 'grid') { this.original.style({ display: 'flex' }); }

        this.originalType = type;

        this.block = get(this.builder.map, element.data('lm-id') || '') || new Blocks[type]({
                builder: this.builder,
                subtype: element.data('lm-subtype'),
                title: element.text()
            });

        if (!this.block.isNew()) {
            element.style({
                position: 'fixed',
                zIndex: 2500,
                opacity: 0.5,
                margin: 0,
                width: Math.ceil(size.width),
                height: Math.ceil(size.height),
                left: coords.left,
                top: coords.top
            }).find('[data-lm-blocktype]');

            if (this.block.getType() === 'grid') {
                var siblings = this.block.block.siblings(':not(.original-placeholder):not(.section-header):not(.g-inherit):not(:empty)');
                if (siblings) {
                    siblings.search('[data-lm-id]').style({ 'pointer-events': 'none' });
                }
            }

            this.placeholder.before(element);
            this.eraser.show();
        } else {
            var position = element.position();
            this.original.style({
                position: 'fixed',
                opacity: 0.5
            }).style({
                left: coords.left,
                top: coords.top,
                width: position.width,
                height: position.height
            });
            this.element = this.dragdrop.element;
            this.dragdrop.element = this.original;
        }

        var blocks;
        if (type === 'grid' && (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])'))) {
            blocks.style({ 'pointer-events': 'none' });
        }

        singles.enable();
    },

    location: function(event, location, target/*, element*/) {
        target = $(target);
        (!this.block.isNew() ? this.original : this.element).style({ transform: 'translate(0, 0)' });
        if (!this.placeholder) { this.placeholder = zen('div.block.placeholder[data-lm-placeholder]').style({ display: 'none' }); }

        var position,
            dataType     = target.data('lm-blocktype'),
            originalType = this.block.getType();

        if (!dataType && target.data('lm-root')) { dataType = 'root'; }
        if (this.mode !== 'page' && dataType === 'section') { return; }
        if (dataType === 'grid' && (target.parent().data('lm-root') || (target.parent().data('lm-blocktype') === 'container' && target.parent().parent().data('lm-root')))) { return; }

        // Check for adjacents and avoid inserting any placeholder since it would be the same position
        var exclude   = ':not(.placeholder):not([data-lm-id="' + this.original.data('lm-id') + '"])',
            adjacents = {
                before: this.original.previousSiblings(exclude),
                after: this.original.nextSiblings(exclude)
            };

        if (adjacents.before) { adjacents.before = $(adjacents.before[0]); }
        if (adjacents.after) { adjacents.after = $(adjacents.after[0]); }

        if (dataType === 'block' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (dataType === 'grid' && ((adjacents.before === target && location.y === 'below') || (adjacents.after === target && location.y === 'above'))) {
            return;
        }

        var nonVisible = target.parent('[data-lm-blocktype="atoms"]'),
            child      = this.block.block.find('[data-lm-id]');

        if ((child ? child.data('lm-blocktype') : originalType) == 'atom') {
            if (!nonVisible) { return; }
        } else {
            if (nonVisible) { return; }
        }

        // handles the types cases and normalizes the locations (x and y)
        var grid, block, method;

        switch (dataType) {
            case 'root':
            case 'section':
                break;
            case 'grid':
                var empty = !target.children(':not(.placeholder)');
                // new particles cannot be dropped in existing grids, only empty ones
                if (originalType !== 'grid' && !empty) { return; }


                if (empty) {
                    if (originalType === 'grid') {
                        this.placeholder.before(target);
                    } else {
                        // we are dropping a new particle into an empty grid, placeholder goes inside
                        this.placeholder.bottom(target);
                    }
                } else {
                    // we are sorting grids ordering, placeholder goes above/below
                    method = (location.y === 'above' ? 'before' : 'after');
                    this.placeholder[method](target);
                }

                break;
            case 'block':
                method = (location.y === 'above' ? 'top' : 'bottom');
                position = (location.x === 'other') ? method : location.x;
                this.placeholder[position](target);

                break;
        }

        // If it's not a block we don't want a small version of the placeholder
        this.placeholder.removeClass('in-between').removeClass('in-between-grids').removeClass('in-between-grids-first').removeClass('in-between-grids-last');
        this.placeholder.style({ display: 'block' })[dataType !== 'block' ? 'removeClass' : 'addClass']('in-between');

        if (originalType === 'grid' && dataType === 'grid') {
            var next     = this.placeholder.nextSibling(),
                previous = this.placeholder.previousSibling();

            this.placeholder.addClass('in-between-grids');
            if (previous && !previous.data('lm-blocktype')) { this.placeholder.addClass('in-between-grids-first'); }
            if (!next || !next.data('lm-blocktype')) { this.placeholder.addClass('in-between-grids-last'); }
        }
    },

    nolocation: function(event) {
        (!this.block.isNew() ? this.original : this.element).style({ transform: 'translate(0, 0)' });
        if (this.placeholder) { this.placeholder.remove(); }
        if (!this.block) { return; }

        var target = event.type.match(/^touch/i) ? document.elementFromPoint(event.touches.item(0).clientX, event.touches.item(0).clientY) : event.target;

        if (!this.block.isNew()) {
            target = $(target);
            if (target.matches(this.eraser.element) || this.eraser.element.find(target)) {
                this.dragdrop.removeElement = true;
                this.eraser.over();
            } else {
                this.dragdrop.removeElement = false;
                this.eraser.out();
            }
        }
    },

    resize: function(event, element, siblings, offset) {
        this.resizer.start(event, element, siblings, offset);
    },

    removeElement: function(event, element) {
        this.dragdrop.removeElement = false;

        var transition = {
            opacity: 0
        };

        element.animate(transition, {
            duration: '150ms'
        });

        var root = $('[data-lm-root]'), blocks;
        if (this.block.getType() === 'grid' && (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])'))) {
            blocks.style({ 'pointer-events': 'inherit' });
        }

        var siblings = this.block.block.siblings(':not(.original-placeholder)');

        if (siblings && this.block.getType() == 'block') {
            var size                  = this.block.getSize(),
                diff                  = size / siblings.length,
                newSize, block, total = 0, last;
            siblings.forEach(function(sibling, index) {
                sibling = $(sibling);
                block = get(this.builder.map, sibling.data('lm-id'));
                if (index + 1 == siblings.length) { last = block; }
                newSize = precision(block.getSize() + diff, 0);
                total += newSize;
                block.setSize(newSize, true);
            }, this);

            // ensuring it's always 100%
            if (total != 100 && last) {
                size = last.getSize();
                diff = 100 - total;
                last.setSize(size + diff, true);
            }
        }

        this.eraser.hide();

        this.dragdrop.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $('body').off(event, this.dragdrop.bound('move'));
        }, this));

        this.dragdrop.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $('body').off(event, this.dragdrop.bound('deferStop'));
        }, this));

        this.builder.remove(this.block.getId());

        var children = this.block.block.search('[data-lm-id]');
        if (children && children.length) {
            children.forEach(function(child) {
                this.builder.remove($(child).data('lm-id'));
            }, this);
        }

        this.block.block.remove();

        if (this.placeholder) { this.placeholder.remove(); }
        if (this.original) { this.original.remove(); }
        this.element = this.block = null;

        singles.disable();
        singles.cleanup(this.builder);

        this.history.push(this.builder.serialize(), this.history.get().preset);
        root.removeClass('moving');

    },

    stop: function(event, target/*, element*/) {
        // we are removing the block
        var lastOvered = $(this.dragdrop.lastOvered);
        if (lastOvered && lastOvered.matches(this.eraser.element.find('.trash-zone'))) {
            this.eraser.hide();
            return;
        }

        if (this.block.getType() === 'grid') {
            var siblings = this.block.block.siblings(':not(.original-placeholder):not(.section-header):not(.g-inherit):not(:empty)');
            if (siblings) {
                siblings.search('[data-lm-id]').style({ 'pointer-events': 'inherit' });
            }
        }

        if (!this.block.isNew()) { this.eraser.hide(); }
        if (!this.dragdrop.matched) {
            if (this.placeholder) { this.placeholder.remove(); }

            return;
        }

        target = $(target);

        var wrapper, insider,
            multiLocationResize = false,
            blockWasNew         = this.block.isNew(),
            type                = this.block.getType(),
            targetId            = target.data('lm-id'),
            targetType          = !targetId ? false : get(this.builder.map, targetId) ? get(this.builder.map, targetId).getType() : target.data('lm-blocktype'),
            placeholderParent   = this.placeholder.parent();

        if (!placeholderParent) { return; }

        var parentId   = placeholderParent.data('lm-id'),
            parentType = get(this.builder.map, parentId || '') ? get(this.builder.map, parentId).getType() : false,
            resizeCase = false;

        this.original.remove();

        // case 1: it's a new particle dropped in the LM, we need to wrap it inside a block
        if (type !== 'block' && type !== 'grid' && ((targetType === 'section' || targetType === 'grid') || (targetType === 'block' && parentType !== 'block'))) {
            wrapper = new Blocks.block({
                builder: this.builder
            }).adopt(this.block.block);

            insider = new Blocks[type]({
                id: this.block.block.data('lm-id'),
                type: type,
                subtype: this.element.data('lm-blocksubtype'),
                title: this.element.text(),
                builder: this.builder
            }).setLayout(this.block.block);

            wrapper.setSize();

            this.block = wrapper;
            this.builder.add(wrapper);
            this.builder.add(insider);

            insider.emit('rendered', insider, wrapper);
            wrapper.emit('rendered', wrapper, null);

            resizeCase = { case: 1 };
        }

        // case 2: moving a block around, need to fix sizes if it's a multi location resize
        if (this.originalType === 'block' && this.block.getType() === 'block') {
            resizeCase = { case: 3 };
            var previous            = this.block.block.parent('[data-lm-blocktype="grid"]'),
                placeholderPrevious = this.placeholder.parent('[data-lm-blocktype="grid"]');
            //if (previous.find('!> [data-lm-blocktype="container"]')) { previous = previous.parent(); }
            //if (placeholderPrevious.find('!> [data-lm-blocktype="container"]')) { placeholderPrevious = placeholderPrevious.parent(); }
            if (placeholderPrevious !== previous) {
                multiLocationResize = {
                    from: this.block.block.siblings(':not(.placeholder)'),
                    to: this.placeholder.siblings(':not(.placeholder)')
                };
            }

            if (previous.find('!> [data-lm-blocktype="container"]')) { previous = previous.parent(); }
            previous = previous.siblings(':not(.original-placeholder)');
            if (!this.block.isNew() && previous.length) { this.resizer.evenResize(previous); }

            this.block.block.attribute('style', null);
            this.block.setSize();
        }

        if (type === 'grid' && !siblings) {
            var plus = this.block.block.parent('[data-lm-blocktype="section"]').find('.fa-plus');
            if (plus) { plus.emit('click'); }
        }

        if (this.block.hasAttribute('size') && typeof this.block.getSize === 'function') { this.block.setSize(this.placeholder.compute('flex')); }

        this.block.insert(this.placeholder);
        this.placeholder.remove();

        if (blockWasNew) {
            if (resizeCase) { this.resizer.evenResize($([this.block.block, this.block.block.siblings()])); }

            this.element.attribute('style', null);
        }


        if (multiLocationResize.from || (multiLocationResize.to && multiLocationResize.to != this.block.block)) {
            // if !from / !to means it's empty grid, should we remove it?
            var size = this.block.getSize(), diff, block;

            // we are moving the particle to an empty grid, resetting the size to 100%
            if (!multiLocationResize.to) { this.block.setSize(100, true); }

            // we need to compensate the remaining blocks on the FROM with the leaving particle size
            if (multiLocationResize.from) {
                diff = size / multiLocationResize.from.length;
                var total = 0, curSize;
                multiLocationResize.from.forEach(function(sibling) {
                    sibling = $(sibling);
                    block = get(this.builder.map, sibling.data('lm-id'));
                    curSize = block.getSize() + diff;
                    block.setSize(curSize, true);
                    total += curSize;
                }, this);

                if (total !== 100) {
                    diff = (100 - total) / multiLocationResize.from.length;
                    multiLocationResize.from.forEach(function(sibling) {
                        sibling = $(sibling);
                        block = get(this.builder.map, sibling.data('lm-id'));
                        curSize = block.getSize() + diff;
                        block.setSize(curSize, true);
                    }, this);
                }
            }

            // the TO is receiving a new block so we are going to evenize
            if (multiLocationResize.to) {
                size = 100 / (multiLocationResize.to.length + 1);
                multiLocationResize.to.forEach(function(sibling) {
                    sibling = $(sibling);
                    block = get(this.builder.map, sibling.data('lm-id'));
                    block.setSize(size, true);
                }, this);
                this.block.setSize(size, true);
            }
        }

        singles.disable();
        singles.cleanup(this.builder);

        this.history.push(this.builder.serialize(), this.history.get().preset);
    },

    stopAnimation: function(element) {
        var root = $('[data-lm-root]');
        root.removeClass('moving');

        if (this.original) { this.original.remove(); }
        singles.disable();

        if (!this.block) { this.block = get(this.builder.map, element.data('lm-id')); }
        if (this.block && this.block.getType() === 'block') { this.block.setSize(); }
        if (this.block && this.block.isNew() && this.element) { this.element.attribute('style', null); }

        if (this.originalType === 'grid') {
            var blocks, block;
            if (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])')) {
                blocks.forEach(function(element) {
                    element = $(element);
                    block = get(this.builder.map, element.data('lm-id'));
                    element.attribute('style', null);
                    block.setSize();
                }, this);
            }
        }
    }
});

module.exports = LayoutManager;

},{"../ui/drag.drop":50,"../ui/eraser":52,"../utils/elements.utils":64,"../utils/flags-state":67,"./blocks":15,"./drag.resizer":24,"elements/zen":135,"mout/array/contains":164,"mout/array/every":167,"mout/collection/find":186,"mout/collection/forEach":187,"mout/function/bind":190,"mout/lang/deepEquals":199,"mout/lang/isArray":201,"mout/lang/isObject":206,"mout/number/enforcePrecision":220,"mout/object/get":231,"mout/object/keys":234,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],30:[function(require,module,exports){
"use strict";

var ready          = require('elements/domready'),
    $              = require('elements'),
    decouple       = require('../utils/decouple'),
    scrollbarWidth = require('../utils/get-scrollbar-width');

var container, sidebar, search, particles, height, heightTop, heightBottom, excludeTop, excludeBottom,
    initialSidebarCoords, realSidebarTop;

var initSizes = function() {
    // fixed and contained particles sidebar
    container = $('.sidebar-block');
    if (!container) { return; }

    sidebar = container.find('.g5-lm-particles-picker');
    if (!sidebar) { return; }

    search = sidebar.find('> .search');
    particles = sidebar.find('> .particles-container');
    height = window.innerHeight;
    heightTop = 0;
    heightBottom = 0;
    initialSidebarCoords = sidebar[0].getBoundingClientRect();
    realSidebarTop = sidebar.position().top;
    excludeTop = $('body.admin.com_gantry5 nav.navbar-fixed-top, #wpadminbar, #admin-main #titlebar, #admin-main .grav-update.grav');
    excludeBottom = $('body.admin.com_gantry5 #status');

    if (excludeTop) {
        $(excludeTop).forEach(function(element) {
            heightTop += element.offsetHeight;
        });
    }

    if (excludeBottom) {
        $(excludeBottom).forEach(function(element) {
            heightBottom += element.offsetHeight;
        });
    }

    particles.style({
        'max-height': (height - heightTop - heightBottom - search[0].offsetHeight - 30),
        overflow: 'auto'
    });

    if (particles[0].scrollHeight != particles[0].offsetHeight) {
        particles.addClass('has-scrollbar').style({ 'margin-right': -scrollbarWidth() });
    }
};

ready(function() {
    initSizes();

    var scrollElement = $(GANTRY_PLATFORM == 'grav' ? '#admin-main .content-padding' : window) || [window],
        scroll        = function() {
            if (!container || !sidebar) { return; }

            var scrollTop       = this.scrollY || this.scrollTop,
                containerBounds = container[0].getBoundingClientRect(),
                limit           = containerBounds.top + containerBounds.height,
                sidebarCoords   = sidebar[0].getBoundingClientRect(),
                shouldBeFixed   = (scrollTop > (initialSidebarCoords.top - heightTop - 10)) && scrollTop >= realSidebarTop - 10,
                reachedTheLimit = sidebarCoords.height + 10 + heightTop + parseInt(container.compute('padding-bottom'), 10) >= limit,
                sidebarTallerThanContainer = containerBounds.height <= sidebarCoords.height;

            sidebar.style('width', sidebarCoords.width);
            if (shouldBeFixed && !reachedTheLimit) {
                sidebar.removeClass('particles-absolute').addClass('particles-fixed');
                sidebar.style({
                    top: heightTop + 10,
                    bottom: 'inherit'
                });
            } else if (shouldBeFixed && reachedTheLimit) {
                if (sidebarTallerThanContainer) {
                    sidebar.removeClass('particles-fixed').addClass('particles-absolute');
                    sidebar.style({
                        top: 'inherit',
                        bottom: parseInt(container.compute('padding-bottom'), 10)
                    });
                }
            } else {
                sidebar.removeClass('particles-fixed').removeClass('particles-absolute');
                sidebar.style({
                    top: 'inherit',
                    bottom: 'inherit'
                });
            }
        };

    decouple(scrollElement[0], 'scroll', scroll.bind(scrollElement[0]));

    decouple(window, 'resize', function() {
        if (!particles) { return; }

        // initSizes();
        scroll.call(scrollElement[0]);

        particles.style({
            'max-height': (window.innerHeight - heightTop - heightBottom - search[0].offsetHeight - 30)
        });
    });

    $('body').on('statechangeEnd', function() {
        initSizes();
    });
});

module.exports = initSizes;

},{"../utils/decouple":63,"../utils/get-scrollbar-width":71,"elements":111,"elements/domready":109}],31:[function(require,module,exports){
"use strict";
var $              = require('elements'),
    zen            = require('elements/zen'),
    ready          = require('elements/domready'),
    request        = require('agent'),
    ui             = require('./ui'),
    interpolate    = require('mout/string/interpolate'),
    trim           = require('mout/string/trim'),
    setParam       = require('mout/queryString/setParam'),
    modal          = ui.modal,
    toastr         = ui.toastr,

    parseAjaxURI   = require('./utils/get-ajax-url').parse,
    getAjaxURL     = require('./utils/get-ajax-url').global,
    getAjaxSuffix  = require('./utils/get-ajax-suffix'),

    flags          = require('./utils/flags-state'),
    validateField  = require('./utils/field-validation'),
    lm             = require('./lm'),
    mm             = require('./menu'),
    pm             = require('./positions/cards'),
    configurations = require('./configurations'),
    positions      = require('./positions'),
    changelog      = require('./changelog'),
    translate      = require('./utils/translate');

require('elements/attributes');
require('elements/events');
require('elements/delegation');
require('elements/insertion');
require('elements/traversal');
require('./fields');
require('./ui/popover');
require('./utils/ajaxify-links');
require('./utils/rAF-polyfill');

var createHandler = function(divisor, noun, restOfString) {
    return function(diff) {
        var n = Math.floor(diff / divisor);
        var pluralizedNoun = noun + ( n > 1 ? 's' : '' );
        return "" + n + " " + pluralizedNoun + " " + restOfString;
    }
};

var formatters = [
    { threshold: -31535999, handler: createHandler(-31536000,	"year",     "from now" ) },
    { threshold: -2591999, 	handler: createHandler(-2592000,  	"month",    "from now" ) },
    { threshold: -604799,  	handler: createHandler(-604800,   	"week",     "from now" ) },
    { threshold: -172799,   handler: createHandler(-86400,    	"day",      "from now" ) },
    { threshold: -86399,   	handler: function(){ return      	"tomorrow" } },
    { threshold: -3599,    	handler: createHandler(-3600,     	"hour",     "from now" ) },
    { threshold: -59,     	handler: createHandler(-60,       	"minute",   "from now" ) },
    { threshold: -0.9999,   handler: createHandler(-1,			"second",   "from now" ) },
    { threshold: 1,        	handler: function(){ return      	"just now" } },
    { threshold: 60,       	handler: createHandler(1,        	"second",	"ago" ) },
    { threshold: 3600,     	handler: createHandler(60,       	"minute",	"ago" ) },
    { threshold: 86400,    	handler: createHandler(3600,     	"hour",     "ago" ) },
    { threshold: 172800,   	handler: function(){ return      	"yesterday" } },
    { threshold: 604800,   	handler: createHandler(86400,    	"day",      "ago" ) },
    { threshold: 2592000,  	handler: createHandler(604800,   	"week",     "ago" ) },
    { threshold: 31536000, 	handler: createHandler(2592000,  	"month",    "ago" ) },
    { threshold: Infinity, 	handler: createHandler(31536000, 	"year",     "ago" ) }
];

var prettyDate = {
    format: function(date) {
        var diff = (((new Date()).getTime() - date.getTime()) / 1000);
        for (var i = 0; i < formatters.length; i++) {
            if (diff < formatters[i].threshold) {
                return formatters[i].handler(diff);
            }
        }
        throw new Error("exhausted all formatter options, none found"); //should never be reached
    }
};

window.onbeforeunload = function() {
    if (flags.get('pending')) {
        return translate('GANTRY5_PLATFORM_JS_NO_SAVE_DETECTED');
    }
};

ready(function() {
    var body     = $('body'),
        sentence = translate('GANTRY5_PLATFORM_JS_SAVE_SUCCESS');

    // Close notification
    body.delegate('click', '[data-g-close]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var parent = element.data('g-close');
        parent = parent ? element.parent(parent) : element;

        parent.slideUp(function() {
            parent.remove();
        });
    });

    // Generic Popovers
    body.delegate('click', '[data-g-popover]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        if (!element.PopoverDefined) {
            var content = element.find('[data-popover-content]') || element.siblings('[data-popover-content]'),
                popover = element.getPopover({
                    style: element.data('g-popover-style') || 'generic',
                    width: element.data('g-popover-width') || 220,
                    content: zen('ul').html(content.html())[0].outerHTML,
                    allowElementsClick: element.data('g-popover-elementsclick') || '.toggle'
                });
            element.on('shown.popover', function(popover){
                var enabler = element.find('.enabler');
                element.attribute('aria-expanded', true).attribute('aria-hidden', false);

                if (enabler) {
                    enabler[0].focus();
                }
            });

            element.on('hide.popover', function(popover){
                element.attribute('aria-expanded', false).attribute('aria-hidden', true);
            });

            element.getPopover().show();
        }
    });

    // Platform Settings redirect
    body.delegate('mousedown', '[data-settings-key]', function(event, element) {
        var key = element.data('settings-key');
        if (!key) { return true; }

        var redirect = window.location.search,
            settings = element.attribute('href'),
            uri      = window.location.href.split('?');
        if (uri.length > 1 && uri[0].match(/index.php$/)) { redirect = 'index.php' + redirect; }

        redirect = setParam(settings, key, btoa(redirect));
        element.href(redirect);
    });

    // Save Tooltip
    body.delegate('mouseover', '.button-save', function(event, element) {
        if (!element.lastSaved) { return true; }
        var feedback = translate('GANTRY5_PLATFORM_LAST_SAVED') + ': ' + prettyDate.format(element.lastSaved);
        element
            .data('tip', feedback)
            .data('title', feedback);
    });

    // Save
    body.delegate('click', '.button-save', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var saves = $('.button-save');

        if (saves.disabled()) {
            return false;
        }

        saves.disabled(true);
        saves.hideIndicator();
        saves.showIndicator();

        var data    = {},
            invalid = [],
            type    = element.data('save'),
            extras  = '',
            page    = $('[data-lm-root]') ? 'layout' : ($('[data-mm-id]') ? 'menu' : ($('[data-position]') ? 'positions' : 'other')),
            saveURL = parseAjaxURI(trim(window.location.href, '#') + getAjaxSuffix());

        switch (page) {
            case 'layout':
                var preset = $('[data-lm-preset]');
                lm.layoutmanager.singles('cleanup', lm.builder, false);
                lm.savestate.setSession(lm.builder.serialize(null, true));

                data.preset = preset && preset.data('lm-preset') ? preset.data('lm-preset') : 'default';

                var layout = JSON.stringify(lm.builder.serialize());

                // base64 encoding doesn't quite work with mod_security
                // data.layout = btoa ? btoa(encodeURIComponent(layout)) : layout;

                data.layout = layout;
                break;

            case 'menu':
                data.menutype = $('select.menu-select-wrap').value();
                data.settings = JSON.stringify(mm.menumanager.settings);
                data.ordering = JSON.stringify(mm.menumanager.ordering);

                var items = JSON.stringify(mm.menumanager.items);

                // base64 encoding doesn't quite work with mod_security
                // data.items = btoa ? btoa(encodeURIComponent(items)) : items;

                data.items = items;

                saveURL = parseAjaxURI(element.parent('form').attribute('action') + getAjaxSuffix());
                break;

            case 'positions':
                data.positions = pm.serialize();
                break;

            case 'other':
            default:
                var form = element.parent('form');

                if (form && element.attribute('type') == 'submit') {
                    $(form[0].elements).forEach(function(input) {
                        input = $(input);
                        var name     = input.attribute('name'),
                            type     = input.attribute('type'),
                            value    = input.value(),
                            parent   = input.parent('.settings-param, .card-overrideable'),
                            override = parent ? parent.find('> input[type="checkbox"]') : null;

                        override = override || $(input.data('override-target'));

                        if (!name || input.disabled() || (override && !override.checked()) || (type == 'radio' && !input.checked())) { return; }
                        if (!validateField(input)) { invalid.push(input); }
                        data[name] = value;
                    });
                }
        }

        if (invalid.length) {
            saves.disabled(false);
            saves.hideIndicator();
            saves.showIndicator('fa fa-fw fa-exclamation-triangle');
            toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
            return;
        }

        if (page == 'other') { $('.settings-param-title, .card.settings-block > h4').hideIndicator(); }
        body.emit('updateOriginalFields');

        request('post', saveURL, data, function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
            } else {
                modal.close();

                if ($('#styles')) {
                    extras = '<br />' + (response.body.warning ? '<hr />' + response.body.title + '<br />' + response.body.html : translate('GANTRY5_PLATFORM_JS_CSS_COMPILED'));
                }

                toastr[response.body.warning ? 'warning' : 'success'](interpolate(sentence, {
                    verb: type.slice(-1) == 's' ? 'have' : 'has',
                    type: type,
                    extras: extras
                }), type + ' ' + translate('GANTRY5_PLATFORM_SAVED'));
            }

            saves.disabled(false);
            saves.hideIndicator();
            saves.forEach(function(save) {
                $(save).lastSaved = new Date();
            });

            if (page == 'layout') { lm.layoutmanager.updatePendingChanges(); }

            // all good, disable 'pending' flag
            flags.set('pending', false);
            flags.emit('update:pending');
        });
    });

    // Editable titles
    body.delegate('keydown', '[data-title-edit]', function(event, element) {
        var key = (event.which ? event.which : event.keyCode);
        if (key == 32 || key == 13) { // ARIA support: Space / Enter toggle
            event.preventDefault();
            body.emit('click', event);
        }
    });

    body.delegate('click', '[data-title-edit]', function(event, element) {
        element = $(element);
        if (element.hasClass('disabled')) { return false; }

        var $title = element.siblings('[data-title-editable]') || element.previousSiblings().find('[data-title-editable]') || element.nextSiblings().find('[data-title-editable]'), title;
        if (!$title) { return true; }

        title = $title[0];
        $title.text(trim($title.text()));

        $title.attribute('contenteditable', true);
        title.focus();

        var range = document.createRange(), selection;
        range.selectNodeContents(title);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        $title.storedTitle = trim($title.text());
        $title.titleEditCanceled = false;
        $title.emit('title-edit-start', $title.storedTitle);
    });

    body.delegate('keydown', '[data-title-editable]', function(event, element) {
        element = $(element);
        switch (event.keyCode) {
            case 13: // return
            case 27: // esc
                event.stopPropagation();

                if (event.keyCode == 27) {
                    if (typeof element.storedTitle !== 'undefined') {
                        element.text(element.storedTitle);
                        element.titleEditCanceled = true;
                    }
                }

                element.attribute('contenteditable', null);
                element[0].blur();

                element.emit('title-edit-exit', element.data('title-editable'), event.keyCode == 13 ? 'enter' : 'esc');
                return false;
            default:
                return true;
        }
    });

    body.delegate('blur', '[data-title-editable]', function(event, element) {
        element = $(element);
        element[0].scrollLeft = 0;
        element.attribute('contenteditable', null);
        element.data('title-editable', trim(element.text()));
        window.getSelection().removeAllRanges();
        element.emit('title-edit-end', element.data('title-editable'), element.storedTitle, element.titleEditCanceled);
    }, true);

    // Quick Ajax Calls [data-ajax-action]
    body.delegate('click', '[data-ajax-action]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var href      = element.attribute('href') || element.data('ajax-action'),
            method    = element.data('ajax-action-method') || 'post',
            indicator = $(element.data('ajax-action-indicator')) || element;

        if (!href) { return false; }

        indicator.showIndicator();
        request(method, parseAjaxURI(href + getAjaxSuffix()), function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });

                indicator.hideIndicator();
                return false;
            } else {
                toastr[response.body.warning ? 'warning' : 'success'](response.body.html || 'Action successfully completed.', response.body.title || '');
            }

            indicator.hideIndicator();
        })
    });
});

var modules = {
    /*mout    : require('mout'),
     prime   : require('prime'),
     "$"     : elements,
     zen     : zen,
     domready: domready,
     agent   : require('agent'),*/
    lm: lm,
    mm: mm,
    assingments: require('./assignments'),
    ui: require('./ui'),
    styles: require('./styles'),
    "$": $,
    domready: require('elements/domready'),
    particles: require('./particles'),
    zen: require('elements/zen'),
    moofx: require('moofx'),
    atoms: require('./pagesettings'),
    tips: require('./ui/tooltips')
};

window.G5 = modules;
module.exports = modules;

},{"./assignments":2,"./changelog":3,"./configurations":5,"./fields":6,"./lm":27,"./menu":34,"./pagesettings":36,"./particles":42,"./positions":47,"./positions/cards":46,"./styles":48,"./ui":53,"./ui/popover":55,"./ui/tooltips":60,"./utils/ajaxify-links":61,"./utils/field-validation":66,"./utils/flags-state":67,"./utils/get-ajax-suffix":68,"./utils/get-ajax-url":69,"./utils/rAF-polyfill":74,"./utils/translate":76,"agent":78,"elements":111,"elements/attributes":106,"elements/delegation":108,"elements/domready":109,"elements/events":110,"elements/insertion":112,"elements/traversal":134,"elements/zen":135,"moofx":136,"mout/queryString/setParam":247,"mout/string/interpolate":259,"mout/string/trim":270}],32:[function(require,module,exports){
"use strict";
var DragEvents = require('../ui/drag.events'),
    prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    isString   = require('mout/lang/isString'),
    nMap       = require('mout/math/map'),
    clamp      = require('mout/math/clamp'),
    precision  = require('mout/number/enforcePrecision'),
    get        = require('mout/object/get'),
    $          = require('../utils/elements.utils');

require('elements/events');
require('elements/delegation');

var Resizer = new prime({
    mixin: [Bound, Options],
    DRAG_EVENTS: DragEvents,
    options: {
        minSize: 5
    },
    constructor: function(container, options, menumanager) {
        this.setOptions(options);
        this.history = this.options.history || {};
        this.builder = this.options.builder || {};
        this.map = this.builder.map;
        this.menumanager = menumanager;
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };
    },

    getBlock: function(element) {
        return get(this.map, isString(element) ? element : $(element).data('lm-id') || '');
    },

    getAttribute: function(element, prop) {
        return this.getBlock(element).getAttribute(prop);
    },

    getSize: function(element) {
        element = $(element);
        var parent = element.matches('[data-mm-id]') ? element : element.parent('[data-mm-id]'),
            size = parent.find('.percentage input');

        return Number(size.value());
    },

    setSize: function(element, size, animated) {
        element = $(element);
        animated = typeof animated === 'undefined' ? false : animated;

        var parent = element.matches('[data-mm-id]') ? element : element.parent('[data-mm-id]'),
            pc = parent.find('.percentage input');

        parent[animated ? 'animate' : 'style']({'flex': '0 1 '+size+'%'});
        pc.value(precision(size, 1));
    },

    start: function(event, element, siblings, offset) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }
        if (event.which && event.which !== 1) { return true; }

        // Stops text selection
        event.preventDefault();

        this.element = $(element);

        var parent = this.element.parent('.submenu-selector');
        if (!parent) { return false; }

        parent.addClass('moving');
        
        this.siblings = {
            occupied: 0,
            elements: siblings,
            next: this.element.parent('[data-mm-id]').nextSibling().find('> .submenu-column'),
            prevs: this.element.parent('[data-mm-id]').previousSiblings(),
            sizeBefore: 0
        };

        if (this.siblings.elements.length > 1) {
            this.siblings.occupied -= this.getSize(this.siblings.next);
            this.siblings.elements.forEach(function(sibling) {
                this.siblings.occupied += this.getSize(sibling);
            }, this);
        }

        if (this.siblings.prevs) {
            this.siblings.prevs.forEach(function(sibling) {
                this.siblings.sizeBefore += this.getSize(sibling);
            }, this);
        }

        this.origin = {
            size: this.getSize(this.element),
            maxSize: this.getSize(this.element) + this.getSize(this.siblings.next),
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX + 6,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
        };

        var clientRect = this.element[0].getBoundingClientRect(),
            parentRect = this.element.parent()[0].getBoundingClientRect();

        this.origin.offset = {
            clientRect: clientRect,
            parentRect: {left: parentRect.left, right: parentRect.right},
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y,
            down: offset
        };

        this.origin.offset.parentRect.left = this.element.parent('.submenu-selector').find('> [data-mm-id]:first-child')[0].getBoundingClientRect().left;
        this.origin.offset.parentRect.right = this.element.parent('.submenu-selector').find('> [data-mm-id]:last-child')[0].getBoundingClientRect().right;


        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).on(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).on(event, this.bound('stop'));
        }, this));
    },

    move: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        var clientX = event.clientX || event.touches[0].clientX || 0,
            clientY = event.clientY || event.touches[0].clientY || 0,
            parentRect = this.origin.offset.parentRect;

        var deltaX = (this.lastX || clientX) - clientX,
            deltaY = (this.lastY || clientY) - clientY;

        this.direction =
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
            Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                                                                 'down';
        var size,
            diff = 100 - this.siblings.occupied,
            value = clientX + (!this.siblings.prevs ? this.origin.offset.x - this.origin.offset.down : this.siblings.prevs.length),
            normalized = clamp(value, parentRect.left, parentRect.right);

        size = nMap(normalized, parentRect.left, parentRect.right, 0, 100);
        size = size - this.siblings.sizeBefore;
        size = precision(clamp(size, this.options.minSize, this.origin.maxSize - this.options.minSize), 0);

        diff = precision(diff - size, 0);

        this.setSize(this.element, size);
        this.setSize(this.siblings.next, diff);

        // Hack to handle cases where size is not an integer
        var siblings = this.siblings.elements,
            amount = siblings ? siblings.length + 1 : 1;
        if (amount == 3 || amount == 6 || amount == 7 || amount == 8 || amount == 9 || amount == 11 || amount == 12) {
            var total = 0, blocks;

            blocks = $([siblings, this.element.parent('[data-mm-id]')]);
            blocks.forEach(function(block, index){
                block = $(block);
                size = this.getSize(block);
                if (size % 1) {
                    size = precision(100 / amount, 0);
                    this.setSize(block, size);
                }

                total += size;

                if (blocks.length == index + 1 && total != 100) {
                    diff = 100 - total;
                    this.setSize(block, (size + diff));
                }

            }, this);
        }

        this.lastX = clientX;
        this.lastY = clientY;
    },

    stop: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('stop'));
        }, this));

        this.element.parent('.submenu-selector').removeClass('moving');

        this.menumanager.emit('dragEnd', this.menumanager.map, 'resize');
        //if (this.origin.size !== this.getSize(this.element)) { this.history.push(this.builder.serialize()); }
    },

    updateItemSizes: function(elements) {
        var parent = this.element ? this.element.parent('.submenu-selector') : null;
        if (!parent && !elements) { return false; }

        var blocks = elements || parent.search('> [data-mm-id]'),
            sizes = [],
            active = $('.menu-selector .active'),
            path = active ? active.data('mm-id') : null;

        blocks.forEach(function(block){
            sizes.push(this.getSize(block));
        }, this);

        // update active path with new columns sizes
        this.menumanager.items[path].columns = sizes;

        this.updateMaxValues(elements);

        return sizes;
    },

    updateMaxValues: function(elements) {
        var parent = this.element ? this.element.parent('.submenu-selector') : null;
        if (!parent && !elements) { return false; }

        var blocks = elements || parent.search('> [data-mm-id]'), sizes, inputs;

        blocks.forEach(function(block){
            block = $(block);
            var sibling = block.nextSibling() || block.previousSibling();
            if (!sibling) { return; }

            inputs = {
                block: block.find('input.column-pc'),
                sibling: sibling.find('input.column-pc')
            };

            sizes = {
                current: this.getSize(block),
                sibling: this.getSize(sibling)
            };

            sizes.total = sizes.current + sizes.sibling;
            inputs.block.attribute('max', sizes.total - Number(inputs.block.attribute('min')));
            inputs.sibling.attribute('max', sizes.total - Number(inputs.sibling.attribute('min')));
        }, this);
    },

    evenResize: function(elements, animated) {
        var total = elements.length,
            size = precision(100 / total, 4);

        elements.forEach(function(element) {
            element = $(element);
            this.setSize(element, size, (typeof animated == 'undefined' ? false : animated));
        }, this);

        this.updateItemSizes(elements);
        this.menumanager.emit('dragEnd', this.menumanager.map, 'evenResize');
    }
});

module.exports = Resizer;

},{"../ui/drag.events":51,"../utils/elements.utils":64,"elements/delegation":108,"elements/events":110,"mout/function/bind":190,"mout/lang/isString":209,"mout/math/clamp":214,"mout/math/map":216,"mout/number/enforcePrecision":220,"mout/object/get":231,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],33:[function(require,module,exports){
"use strict";
var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    Submit        = require('../fields/submit'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    request       = require('agent'),
    indexOf       = require('mout/array/indexOf'),
    trim          = require('mout/string/trim'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    flags         = require('../utils/flags-state'),
    deepEquals    = require('mout/lang/deepEquals'),
    translate     = require('../utils/translate'),

    Cards         = require('../positions/cards'); // required for Positions

var WordpressWidgetsCustomizer = require('../utils/wp-widgets-customizer');

var menumanager = null;

var randomID = function randomString(len, an) {
    an = an && an.toLowerCase();
    var str = "", i = 0, min = an == 'a' ? 10 : 0, max = an == 'n' ? 10 : 62;

    for (; i++ < len;) {
        var r = Math.random() * (max - min) + min << 0;
        str += String.fromCharCode(r += r > 9 ? r < 36 ? 55 : 61 : 48);
    }
    return str;
};

var StepOne = function(map, mode) { // mode [reorder, resize, evenResize]
    if (this.isNewParticle && mode !== 'reorder') { return; }
    this.resizer.updateItemSizes();

    menumanager = this;

    var save = $('[data-save]'),
        current = {
            settings: this.settings,
            ordering: this.ordering,
            items: this.items
        };

    if (!this.isNewParticle) {
        if (!deepEquals(map, current)) {
            save.showIndicator('fa fa-fw changes-indicator fa-circle-o');
            flags.set('pending', true);
        } else {
            save.hideIndicator();
            flags.set('pending', false);
        }
    }

    if (this.isParticle && this.isNewParticle) {
        var blocktype = this.block.data('mm-blocktype');
        this.block.attribute('data-mm-blocktype', null).addClass('g-menu-item-' + blocktype).data('mm-original-type', blocktype);
        zen('span.menu-item-type.badge').text(blocktype).after(this.block.find('.menu-item .title'));

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'post',
            //data: data,
            remote: parseAjaxURI($(this.block).find('.config-cog').attribute('href') + getAjaxSuffix()),
            remoteLoaded: function(response, modal) {
                var search = modal.elements.content.find('.search input'),
                    blocks = modal.elements.content.search('[data-mm-type]'),
                    filters = modal.elements.content.search('[data-mm-filter]');

                if (!search || !filters || !blocks) { return; }

                search.on('input', function() {
                    if (!this.value()) {
                        blocks.removeClass('hidden');
                        return;
                    }

                    blocks.addClass('hidden');

                    var found = [], value = this.value().toLowerCase(), text;

                    filters.forEach(function(filter) {
                        filter = $(filter);
                        text = trim(filter.data('mm-filter')).toLowerCase();
                        if (text.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                            found.push(filter.matches('[data-mm-type]') ? filter : filter.parent('[data-mm-type]'));
                        }
                    }, this);

                    if (found.length) { $(found).removeClass('hidden'); }
                });

                setTimeout(function(){
                    search[0].focus();
                }, 5);
            }
        });
    }

    this.type = undefined;
};

var StepTwo = function(data, content, button) {
    var uri = content.find('[data-mm-particle-stepone]').data('mm-particle-stepone'),
        picker = data.instancepicker,
        moduleType = {
            wordpress: 'widget',
            joomla: 'particle'
        };

    if (picker) {
        var item = JSON.parse(data.item);
        picker = JSON.parse(picker);
        delete(data.instancepicker);
        //uri = getAjaxURL(item.type + '/' + item[moduleType[GANTRY_PLATFORM]]);
        uri = getAjaxURL(item.type + '/' + item[item.type]);
    }

    request('post', parseAjaxURI(uri + getAjaxSuffix()), data, function(error, response) {
        if (!response.body.success) {
            modal.open({
                content: response.body.html || response.body,
                afterOpen: function(container) {
                    if (!response.body.html) { container.style({ width: '90%' }); }
                }
            });

            button.hideIndicator();

            return;
        }

        content.html(response.body.html);

        var selects = $('[data-selectize]');
        if (selects) { selects.selectize(); }

        var urlTemplate = content.find('.g-urltemplate');
        if (urlTemplate) { $('body').emit('input', { target: urlTemplate }); }

        var form = content.find('form'),
            submit = content.find('input[type="submit"], button[type="submit"]'),
            fakeDOM = zen('div').html(response.body.html).find('form');

        if ((!form && !fakeDOM) || !submit) { return true; }

        var applyAndSave = content.search('[data-apply-and-save]');
        if (applyAndSave) { applyAndSave.remove(); }

        // Module / Particle Settings apply
        submit.on('click', function(e) {
            e.preventDefault();

            submit.showIndicator();

            var post = Submit(fakeDOM[0].elements, content, { submitUnchecked: true });

            request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&') || {}, function(error, response) {
                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });
                } else {
                    // it's menu
                    // FIXME: this is now handling both the Menu and the Positions when inserting a new Particle. Needs to be separated
                    if (!picker) {
                        if (menumanager) {
                            // case for Menu Manager
                            var element = menumanager.element,
                                path    = element.data('mm-id') + '-',
                                id      = randomID(5),
                                base    = element.parent('[data-mm-base]').data('mm-base'),
                                col     = (element.parent('[data-mm-id]').data('mm-id').match(/\d+$/) || [0])[0],
                                index   = indexOf(element.parent().children('[data-mm-id]'), element[0]);

                            while (menumanager.items[path + id]) { id = randomID(5); }

                            menumanager.items[path + id] = response.body.item;
                            if (!menumanager.ordering[base]) menumanager.ordering[base] = [];
                            if (!menumanager.ordering[base][col]) menumanager.ordering[base][col] = [];
                            menumanager.ordering[base][col].splice(index, 1, path + id);
                            element.data('mm-id', path + id);

                            if (response.body.html) {
                                element.html(response.body.html);
                            }

                            menumanager.isNewParticle = false;
                            menumanager.emit('dragEnd', menumanager.map);
                            toastr.success(translate('GANTRY5_PLATFORM_JS_MENU_SETTINGS_APPLIED'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));

                        } else {
                            // case for Positions
                            var position = $('[data-position-name="' + response.body.position + '"]'),
                                dummy = zen('div').html(response.body.html);

                            position.find('> ul').appendChild(dummy.children());

                            Cards.serialize(position);

                            toastr.success(translate('GANTRY5_PLATFORM_JS_POSITIONS_SETTINGS_APPLIED'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }
                    } else { // it's field picker
                        var field = $('[name="' + picker.field + '"]'),
                            btnPicker = field.siblings('[data-g-instancepicker]'),
                            label = field.siblings('.g-instancepicker-title');

                        if (field) {
                            field.value(JSON.stringify(response.body.item));
                            $('body').emit('change', { target: field });
                        }
                        if (label) { label.text(response.body.item.title); }

                        if (item.type == 'particle') {
                            btnPicker.text(btnPicker.data('g-instancepicker-alttext'));
                        }
                    }
                }

                modal.close();
                submit.hideIndicator();
                WordpressWidgetsCustomizer(field);
            });
        });
    });
};


ready(function() {
    var body = $('body');

    body.delegate('click', '.menu-editor-extras [data-lm-blocktype], .menu-editor-extras [data-mm-module]', function(event, element) {
        var container = element.parent('.menu-editor-extras'),
            elements = container.search('[data-lm-blocktype], [data-mm-module]'),
            selectButton = container.find('[data-mm-select]');

        elements.removeClass('selected');
        element.addClass('selected');

        selectButton.attribute('disabled', null);
    });

    // second step
    body.delegate('click', '.menu-editor-extras [data-mm-select]', function(event, element) {
        event.preventDefault();

        if (element.hasClass('disabled') || element.attribute('disabled')) { return false; }

        var container = element.parent('.menu-editor-extras'),
            selected = container.find('[data-lm-blocktype].selected, [data-mm-module].selected'),
            type = selected.data('mm-type');

        data = { type: type };

        switch (type) {
            case 'particle':
                data['particle'] = selected.data('lm-subtype');
                break;

            case 'widget':
                data['widget'] = selected.data('lm-subtype');
                break;

            case 'module':
                data['particle'] = type;
                data['title'] = selected.find('[data-mm-title]').data('mm-title');
                data['options'] = { particle: { module_id: selected.data('mm-module') } };
                break;
        }

        element.showIndicator();


        var data, instancepicker = element.data('g-instancepicker');

        if (instancepicker && type == 'module') {
            data = JSON.parse(instancepicker);
            var field = $('[name="' + data.field + '"]');
            if (field) {
                field.value(selected.data('mm-module'));
                body.emit('input', { target: field });
            }

            element.hideIndicator();
            modal.close();

            return false;
        } else {
            var ip = instancepicker;
            element.data('g-instancepicker', null);
            StepTwo({
                item: JSON.stringify(data),
                instancepicker: ip ? ip : null
            }, element.parent('.g5-content'), element);
        }
    });
});

module.exports = StepOne;

},{"../fields/submit":8,"../positions/cards":46,"../ui":53,"../utils/flags-state":67,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/translate":76,"../utils/wp-widgets-customizer":77,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/array/indexOf":173,"mout/lang/deepEquals":199,"mout/string/trim":270}],34:[function(require,module,exports){
"use strict";
var ready         = require('elements/domready'),
    MenuManager   = require('./menumanager'),
    Submit        = require('../fields/submit'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    extraItems    = require('./extra-items'),
    request       = require('agent'),
    trim          = require('mout/string/trim'),
    clamp         = require('mout/math/clamp'),
    contains      = require('mout/array/contains'),
    indexOf       = require('mout/array/indexOf'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    translate     = require('../utils/translate');

var menumanager;

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;

var FOCUSIN  = isFirefox ? 'focus' : 'focusin',
    FOCUSOUT = isFirefox ? 'blur' : 'focusout';

ready(function() {
    var body = $('body');

    menumanager = new MenuManager('[data-mm-container]', {
        delegate: '.g5-mm-particles-picker ul li, #menu-editor > section ul li, .submenu-column, .submenu-column li[data-mm-id], .column-container .g-block',
        droppables: '#menu-editor [data-mm-id]',
        exclude: '[data-lm-nodrag], .menu-item-back, .fa-cog, .config-cog',
        resize_handles: '.submenu-column:not(:last-child)',
        catchClick: true
    });


    // Handles Modules / Particles items in the Menu
    menumanager.on('dragEnd', extraItems);

    module.exports.menumanager = menumanager;

    // Menu Manager
    menumanager.setRoot();

    // Refresh ordering/items on menu type change or Menu navigation link
    body.delegate('statechangeAfter', '#main-header [data-g5-ajaxify], select.menu-select-wrap', function(/*event, element*/) {
        menumanager.setRoot();
        menumanager.refresh();

        // refresh MM eraser
        if (menumanager.eraser) {
            menumanager.eraser.element = $('[data-mm-eraseparticle]');
            menumanager.eraser.hide();
        }
    });

    body.delegate(FOCUSIN, '.percentage input', function(event, element) {
        element = $(element);
        element.currentSize = Number(element.value());

        element[0].focus();
        element[0].select();
    }, true);

    body.delegate('keydown', '.percentage input', function(event/*, element*/) {
        if (contains([46, 8, 9, 27, 13, 110, 190], event.keyCode) ||
                // Allow: [Ctrl|Cmd]+A | [Ctrl|Cmd]+R
            (event.keyCode == 65 && (event.ctrlKey === true || event.ctrlKey === true)) ||
            (event.keyCode == 82 && (event.ctrlKey === true || event.metaKey === true)) ||
                // Allow: home, end, left, right, down, up
            (event.keyCode >= 35 && event.keyCode <= 40)) {
            // let it happen, don't do anything
            return;
        }
        // Ensure that it is a number and stop the keypress
        if ((event.shiftKey || (event.keyCode < 48 || event.keyCode > 57)) && (event.keyCode < 96 || event.keyCode > 105)) {
            event.preventDefault();
        }
    });

    body.delegate('keydown', '.percentage input', function(event, element) {
        element = $(element);
        var value  = Number(element.value()),
            min    = Number(element.attribute('min')),
            max    = Number(element.attribute('max')),
            upDown = event.keyCode == 38 || event.keyCode == 40;

        if (upDown) {
            value += event.keyCode == 38 ? +1 : -1;
            value = clamp(value, min, max);
            element.value(value);
            body.emit('keyup', { target: element });
        }
    });

    body.delegate('keyup', '.percentage input', function(event, element) {
        element = $(element);
        var value = Number(element.value()),
            min   = Number(element.attribute('min')),
            max   = Number(element.attribute('max'));

        var resizer = menumanager.resizer,
            parent  = element.parent('[data-mm-id]'),
            sibling = parent.nextSibling('[data-mm-id]') || parent.previousSibling('[data-mm-id]');

        if (!value || value < min || value > max) { return; }

        var sizes = {
            current: Number(element.currentSize),
            sibling: Number(resizer.getSize(sibling))
        };

        element.currentSize = value;

        sizes.total = sizes.current + sizes.sibling;
        sizes.diff = sizes.total - value;

        resizer.setSize(parent, value);
        resizer.setSize(sibling, sizes.diff);

        menumanager.resizer.updateItemSizes(parent.parent('.submenu-selector').search('> [data-mm-id]'));
        menumanager.emit('dragEnd', menumanager.map, 'inputChange');
    });

    body.delegate(FOCUSOUT, '.percentage input', function(event, element) {
        element = $(element);
        var value = Number(element.value());
        if (value < Number(element.attribute('min')) || value > Number(element.attribute('max'))) {
            element.value(element.currentSize);
        }
    }, true);

    // Add new columns
    body.delegate('click', '.add-column', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);

        var container = element.parent('[data-g5-menu-columns]').find('.submenu-selector'),
            children  = container.children(),
            last      = container.find('> :last-child'),
            count     = children ? children.length : 0,
            active    = $('.menu-selector .active'),
            path      = active ? active.data('mm-id') : null;

        // do not allow to create a new column if there's already one and it's empty
        if (count == 1 && !children.search('.submenu-items > [data-mm-id]')) { return false; }

        var block = $(last[0].cloneNode(true));
        block.data('mm-id', 'list-' + count);
        block.find('.submenu-items').empty();
        block.find('[data-mm-base-level]').data('mm-base-level', 1);
        block.find('.submenu-level').text('Level 1');
        block.after(last);

        if (!menumanager.ordering[path]) {
            menumanager.ordering[path] = [[]];
        }

        menumanager.ordering[path].push([]);
        menumanager.resizer.evenResize($('.submenu-selector > [data-mm-id]'));
    });

    // Attach events to pseudo (x) for deleting a column
    ['click', 'touchend'].forEach(function(evt) {
        body.delegate(evt, '[data-g5-menu-columns] .submenu-items:empty', function(event, element) {
            var bounding = element[0].getBoundingClientRect(),
                x        = event.pageX || event.changedTouches[0].pageX || 0, y = event.pageY || event.changedTouches[0].pageY || 0,
                siblings = $('.submenu-selector > [data-mm-id]'),
                deleter  = {
                    width: 36,
                    height: 36
                };

            if (siblings.length <= 1) {
                return false;
            }

            if (x >= bounding.left + bounding.width - deleter.width && x <= bounding.left + bounding.width &&
                Math.abs(window.scrollY - y) - bounding.top < deleter.height) {
                var parent    = element.parent('[data-mm-id]'),
                    container = parent.parent('.submenu-selector').children('[data-mm-id]'),
                    index     = indexOf(container, parent),
                    active    = $('.menu-selector .active'),
                    path      = active ? active.data('mm-id') : null;

                parent.remove();
                siblings = $('.submenu-selector > [data-mm-id]');
                menumanager.ordering[path].splice(index, 1);
                menumanager.resizer.evenResize(siblings);
            }
        });
    });

    // Menu Items settings
    body.delegate('click', '#menu-editor .config-cog, #menu-editor .global-menu-settings', function(event, element) {
        event.preventDefault();

        var data = {}, isRoot = element.hasClass('global-menu-settings');

        if (isRoot) {
            data.settings = JSON.stringify(menumanager.settings);
        } else {
            data.item = JSON.stringify(menumanager.items[element.parent('[data-mm-id]').data('mm-id')]);
        }

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'post',
            data: data,
            overlayClickToClose: false,
            remote: parseAjaxURI($(element).attribute('href') + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }
                
                var form       = content.elements.content.find('form'),
                    fakeDOM    = zen('div').html(response.body.html).find('form'),
                    submit     = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]'),
                    path;

                var search      = content.elements.content.find('.search input'),
                    blocks      = content.elements.content.search('[data-mm-type]'),
                    filters     = content.elements.content.search('[data-mm-filter]'),
                    urlTemplate = content.elements.content.find('.g-urltemplate');

                if (urlTemplate) { body.emit('input', { target: urlTemplate }); }

                var editable = content.elements.content.find('[data-title-editable]');
                if (editable) {
                    editable.on('title-edit-end', function(title, original/*, canceled*/) {
                        title = trim(title);
                        if (!title) {
                            title = trim(original) || 'Title';
                            this.text(title).data('title-editable', title);

                            return true;
                        }
                    });
                }

                if (search && filters && blocks) {
                    search.on('input', function() {
                        if (!this.value()) {
                            blocks.removeClass('hidden');
                            return;
                        }

                        blocks.addClass('hidden');

                        var found = [], value = this.value().toLowerCase(), text;

                        filters.forEach(function(filter) {
                            filter = $(filter);
                            text = trim(filter.data('mm-filter')).toLowerCase();
                            if (text.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                                found.push(filter.matches('[data-mm-type]') ? filter : filter.parent('[data-mm-type]'));
                            }
                        }, this);

                        if (found.length) { $(found).removeClass('hidden'); }
                    });
                }

                if (search) {
                    setTimeout(function() {
                        search[0].focus();
                    }, 5);
                }

                if ((!form && !fakeDOM) || !submit) { return true; }

                // Menuitems Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();

                    var target = $(e.currentTarget);
                    target.disabled(true);
                    target.hideIndicator();
                    target.showIndicator();

                    var post = Submit(fakeDOM[0].elements, content.elements.content, {isRoot: isRoot});

                    if (post.invalid.length) {
                        target.disabled(false);
                        target.hideIndicator();
                        target.showIndicator('fa fa-fw fa-exclamation-triangle');
                        toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
                        return;
                    }

                    request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&'), function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            if (response.body.path || (response.body.item && response.body.item.type == 'particle')) {
                                path = response.body.path || element.parent('[data-mm-id]').data('mm-id');
                                menumanager.items[path] = response.body.item;
                            } else if (response.body.item && response.body.item.type == 'particle') {

                            } else {
                                menumanager.settings = response.body.settings;
                            }

                            if (response.body.html) {
                                var parent = element.parent('[data-mm-id]');
                                if (parent) {
                                    var status = response.body.item.enabled || response.body.item.options.particle.enabled;
                                    parent.html(response.body.html);
                                    parent[status == '0' ? 'addClass' : 'removeClass']('g-menu-item-disabled');
                                }
                            }

                            menumanager.emit('dragEnd', menumanager.map);

                            // if it's apply and save we also save the panel
                            if (target.data('apply-and-save') !== null) {
                                var save = $('body').find('.button-save');
                                if (save) { body.emit('click', { target: save }); }
                            }

                            modal.close();
                            toastr.success(translate('GANTRY5_PLATFORM_JS_MENU_SETTINGS_APPLIED'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }

                        target.hideIndicator();
                    });
                });
            }
        });
    });
});

module.exports = {
    menumanager: menumanager
};

},{"../fields/submit":8,"../ui":53,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/translate":76,"./extra-items":33,"./menumanager":35,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/array/contains":164,"mout/array/indexOf":173,"mout/math/clamp":214,"mout/string/trim":270}],35:[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    $         = require('../utils/elements.utils'),
    bind       = require('mout/function/bind'),
    zen       = require('elements/zen'),
    Emitter   = require('prime/emitter'),
    Bound     = require('prime-util/prime/bound'),
    Options   = require('prime-util/prime/options'),
    DragDrop  = require('../ui/drag.drop'),
    Eraser     = require('../ui/eraser'),
    Resizer   = require('./drag.resizer'),
    get       = require('mout/object/get'),

    ltrim     = require('mout/string/ltrim'),
    every     = require('mout/array/every'),
    last      = require('mout/array/last'),
    indexOf   = require('mout/array/indexOf'),
    isArray   = require('mout/lang/isArray'),
    isObject  = require('mout/lang/isObject'),
    deepClone = require('mout/lang/deepClone'),
    equals    = require('mout/object/equals');


var MenuManager = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    options: {},

    constructor: function(element, options) {
        this.setOptions(options);
        this.refElement = element;
        this.map = {};

        if (!element || !$(element)) { return; }

        this.init(element);
    },

    init: function() {
        this.setRoot();

        this.dragdrop = new DragDrop(this.refElement, this.options, this);
        this.resizer = new Resizer(this.refElement, this.options, this);
        this.eraser = new Eraser('[data-mm-eraseparticle]', this.options);
        this.dragdrop
            .on('dragdrop:click', this.bound('click'))
            .on('dragdrop:start', this.bound('start'))
            .on('dragdrop:move:once', this.bound('moveOnce'))
            .on('dragdrop:location', this.bound('location'))
            .on('dragdrop:nolocation', this.bound('nolocation'))
            .on('dragdrop:resize', this.bound('resize'))
            .on('dragdrop:stop:erase', this.bound('removeElement'))
            .on('dragdrop:stop', this.bound('stop'))
            .on('dragdrop:stop:animation', this.bound('stopAnimation'));
    },

    refresh: function() {
        if (!this.refElement || !$(this.refElement)) { return; }
        this.init();
    },

    setRoot: function() {
        this.root = $('#menu-editor');

        if (this.root) {
            this.settings = JSON.parse(this.root.data('menu-settings'));
            this.ordering = JSON.parse(this.root.data('menu-ordering'));
            this.items = JSON.parse(this.root.data('menu-items'));

            this.map = {
                settings: deepClone(this.settings),
                ordering: deepClone(this.ordering),
                items: deepClone(this.items)
            };

            var submenus = $('[data-g5-menu-columns] .submenu-selector'), columns;
            if (this.resizer && submenus && (columns = submenus.search('> [data-mm-id]'))) { this.resizer.updateMaxValues(columns); }
        }
    },

    click: function(event, element) {
        var target = $(event.target);
        if (target.matches('.g-menu-addblock') || target.parent('.g-menu-addblock')) {
            return false;
        }

        if (element.hasClass('g-block')) {
            this.stopAnimation();
            return true;
        }

        if (element.find('[data-g5-ajaxify]')) {
            var siblings = element.siblings();
            element.addClass('active');
            if (siblings) { siblings.removeClass('active'); }
        }

        element.emit('click');

        var link = element.find('a');
        if (link) { link[0].click(); }
    },

    resize: function(event, element, siblings, offset) {
        this.resizer.start(event, element, siblings, offset);
    },

    start: function(event, element) {
        var root = element.parent('.menu-selector') || element.parent('.submenu-column') || element.parent('.submenu-selector') || element.parent('.g5-mm-particles-picker'),
            size = $(element).position(),
            coords = $(element)[0].getBoundingClientRect();

        this.block = null;
        this.targetLevel = undefined;
        this.addNewItem = false;
        this.type =  element.parent('.g-toplevel') || element.matches('.g-toplevel') ? 'main' : (element.matches('.g-block') ? 'column' : 'columns_items');
        this.isParticle = element.matches('[data-mm-blocktype]') || element.matches('[data-mm-original-type]');
        this.wasActive = element.hasClass('active');
        this.isNewParticle = element.parent('.g5-mm-particles-picker');
        this.ParticleIndex = -1;
        this.root = root;

        this.itemID = element.data('mm-id');
        this.itemLevel = element.data('mm-level');
        this.itemFrom = element.parent('[data-mm-id]');
        this.itemTo = null;

        if (this.isParticle && !this.isNewParticle) {
            var children = element.parent().children('[data-mm-id]');
            this.ParticleIndex = indexOf(children, element[0]);
        }

        root.addClass('moving');

        var type = $(element).data('mm-id'),
            clone = element[0].cloneNode(true);

        if (!this.placeholder) { this.placeholder = zen((this.type == 'column' ? 'div' : 'li') + '.block.placeholder[data-mm-placeholder]'); }
        this.placeholder.style({ display: 'none' });
        this.original = $(clone).after(element).style({
            display: 'inline-block',
            opacity: 1
        }).addClass('original-placeholder').data('lm-dropzone', null);
        this.originalType = type;
        this.block = element;

        if (!this.isNewParticle) {
            element.style({
                position: 'fixed',
                zIndex: 1500,
                width: Math.ceil(size.width),
                height: Math.ceil(size.height),
                left: coords.left,
                top: coords.top
            }).addClass('active');

            this.placeholder.before(element);
        } else {
            var position = element.position();
            this.original.style({
                position: 'fixed',
                opacity: 0.5
            }).style({
                left: coords.left,
                top: coords.top,
                width: position.width,
                height: position.height
            });
            this.element = this.dragdrop.element;
            this.block = this.dragdrop.element;
            this.dragdrop.element = this.original;
        }

        if (this.type == 'column') {
            root.search('.g-block > *').style({ 'pointer-events': 'none' });
        }
    },

    moveOnce: function(element) {
        var type = $(element).data('mm-id');
        if (this.original) { this.original.style({ opacity: 0.5 }); }

        // it's a module or a particle and we allow for them to be deleted
        if (!this.isNewParticle && (type && type.match(/__(module|particle|widget)(-[a-z0-9]{5,})?$/i))) {
            this.eraser.show();
        }
    },

    location: function(event, location, target/*, element*/) {
        target = $(target);
        (!this.isNewParticle ? this.original : this.block).style({transform: 'translate(0, 0)'});
        if (!this.placeholder) { this.placeholder = zen((this.type == 'column' ? 'div' : 'li') + '.block.placeholder[data-mm-placeholder]').style({ display: 'none' }); }

        var targetType = target.parent('.g-toplevel') || target.matches('.g-toplevel') ? 'main' : (target.matches('.g-block') ? 'column' : 'columns_items'),
            dataLevel = target.data('mm-level'),
            originalLevel = this.block.data('mm-level');

        if (this.isParticle && (targetType === 'main' && !dataLevel)) {
            this.dragdrop.matched = false;
            return;
        }

        // Support for nested new particles/modules/widgets
        if (dataLevel === null && this.type === 'columns_items' && this.isParticle && this.isNewParticle) {
            var submenu_items = target.find('.submenu-items');
            if (!submenu_items) {
                this.dragdrop.matched = false;
                return;
            }

            this.placeholder.style({ display: 'block' }).bottom(submenu_items);
            this.addNewItem = submenu_items;
            this.targetLevel = 2;
            this.dragdrop.matched = false;
            return;
        }

        // Workaround for layout and style of columns
        if (dataLevel === null && (this.type === 'columns_items' || this.isParticle)) {
            var submenu_items = target.find('.submenu-items'),
                submenu_items_level = submenu_items.data('mm-base-level');

            // extend drop areas and ensure items cannot be dragged between different levels
            if ((!target.hasClass('g-block') || target.find(this.block)) || (!this.isParticle && originalLevel != submenu_items_level) && (!submenu_items || submenu_items.children() || originalLevel > 2)) {
                this.dragdrop.matched = false;
                return;
            }

            this.placeholder.style({ display: 'block' }).bottom(submenu_items);
            this.addNewItem = submenu_items;
            this.targetLevel = 2;
            this.dragdrop.matched = false;
            return;
        }


        if (!this.isParticle) {

            // We only allow sorting between same level items
            if (this.type !== 'column' && originalLevel !== dataLevel) {
                this.dragdrop.matched = false;
                return;
            }

            // Ensuring columns can only be dragged before/after other columns
            if (this.type == 'column' && dataLevel) {
                this.dragdrop.matched = false;
                return;
            }

            // For levels > 2 we only allow sorting within the same column
            if (dataLevel > 2 && target.parent('ul') != this.block.parent('ul')) {
                this.dragdrop.matched = false;
                return;
            }
        }

        // Check for adjacents and avoid inserting any placeholder since it would be the same position
        var exclude = ':not(.placeholder):not([data-mm-id="' + this.original.data('mm-id') + '"])',
            adjacents = {
                before: this.original.previousSiblings(exclude),
                after: this.original.nextSiblings(exclude)
            };

        if (adjacents.before) { adjacents.before = $(adjacents.before[0]); }
        if (adjacents.after) { adjacents.after = $(adjacents.after[0]); }


        if (targetType === 'main' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (targetType === 'column' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (targetType === 'columns_items' && ((adjacents.before === target && location.y === 'below') || (adjacents.after === target && location.y === 'above'))) {
            return;
        }

        // Handles the types cases and normalizes the locations (x and y)
        switch (targetType) {
            case 'main':
            case 'column':
                this.placeholder[location.x](target);
                break;
            case 'columns_items':
                this.placeholder[location.y === 'above' ? 'before' : 'after'](target);

                break;
        }

        this.targetLevel = dataLevel;

        // If it's not a block we don't want a small version of the placeholder
        this.placeholder.style({ display: 'block' })[targetType !== 'main' ? 'removeClass' : 'addClass']('in-between');

    },

    nolocation: function(event) {
        (!this.isNewParticle ? this.original : this.block).style({transform: 'translate(0, 0)'});
        if (this.placeholder) { this.placeholder.remove(); }
        this.targetLevel = undefined;

        var target = event.type.match(/^touch/i) ? document.elementFromPoint(event.touches.item(0).clientX, event.touches.item(0).clientY) : event.target;

        if (!this.isNewParticle && this.itemID.match(/__(module|particle|widget)(-[a-z0-9]{5})?$/i)) {
            target = $(target);
            if (target.matches(this.eraser.element) || this.eraser.element.find(target)) {
                this.dragdrop.removeElement = true;
                this.eraser.over();
            } else {
                this.dragdrop.removeElement = false;
                this.eraser.out();
            }
        }
    },

    removeElement: function(event, element) {
        this.dragdrop.removeElement = false;

        var transition = {
            opacity: 0
        };

        element.animate(transition, {
            duration: '150ms'
        });

        if (this.type == 'column') {
            this.root.search('.g-block > *').style({ 'pointer-events': 'none' });
        }

        this.eraser.hide();

        this.dragdrop.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $('body').off(event, this.dragdrop.bound('move'));
        }, this));

        this.dragdrop.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $('body').off(event, this.dragdrop.bound('deferStop'));
        }, this));

        var particle = this.block,
            base = particle.parent('[data-mm-base]').data('mm-base'),
            col = (particle.parent('[data-mm-id]').data('mm-id').match(/\d+$/) || [0])[0],
            index = indexOf(particle.parent().children('[data-mm-id]:not(.original-placeholder)'), particle[0]);

        delete this.items[this.itemID];
        this.ordering[base][col].splice(index, 1);

        this.block.remove();
        this.original.remove();
        this.root.removeClass('moving');

        if (this.root.find('.submenu-items')) {
            if (!this.root.find('.submenu-items').children()) { this.root.find('.submenu-items').text(''); }
        }

        this.emit('dragEnd', this.map, 'reorder');
    },

    stop: function(event, target, element) {
        target = $(target);

        // we are removing the block
        var lastOvered = $(this.dragdrop.lastOvered);
        if (lastOvered && lastOvered.matches(this.eraser.element.find('.trash-zone'))) {
            this.eraser.hide();
            return;
        }

        if (target) { element.removeClass('active'); }
        if (this.type == 'column') {
            this.root.search('.g-block > *').attribute('style', null);
        }

        if (!this.dragdrop.matched && !this.addNewItem) {
            if (this.placeholder) { this.placeholder.remove(); }

            this.type = undefined;
            this.targetLevel = false;
            this.isParticle = undefined;
            this.eraser.hide();
            return;
        }

        var placeholderParent = this.placeholder.parent();
        if (!placeholderParent) {
            this.type = undefined;
            this.targetLevel = false;
            this.isParticle = undefined;
            return;
        }

        if (this.addNewItem) { this.block.attribute('style', null).removeClass('active'); }

        var parent = this.block.parent();
        this.eraser.hide();

        if (this.original) {
            if (!this.isNewParticle) { this.original.remove(); }
            else { this.original.attribute('style', null).removeClass('original-placeholder'); }
        }


        this.block.after(this.placeholder);
        this.placeholder.remove();
        this.itemTo = this.block.parent('[data-mm-id]');
        this.currentLevel = this.itemLevel;
        if (this.wasActive) { element.addClass('active'); }

        if (this.isParticle) {
            var id = last(this.itemID.split('/')),
                targetItem = (target || this.itemTo),
                base = targetItem[target && !target.hasClass('g-block') ? 'parent' : 'find']('[data-mm-base]').data('mm-base');

            this.itemID = base ? base + '/' + id : id;
            this.itemLevel = this.targetLevel;
            this.block.data('mm-id', this.itemID).data('mm-level', this.targetLevel);
        }

        var path = this.itemID.split('/'),
            items, column;

        path.splice(this.itemLevel - 1);
        path = path.join('/');

        // Items reorder for root or sublevels with logic to reorder FROM and TO sublevel column if needed
        if (this.itemFrom || this.itemTo) {
            var sources = this.itemFrom == this.itemTo ? [this.itemFrom] : [this.itemFrom, this.itemTo];
            sources.forEach(function(source) {
                if (!source) { return; }

                items = source.search('[data-mm-id]');
                column = Number(this.block.data('mm-level') > 2 ? 0 : (source.data('mm-id').match(/\d+$/) || [0])[0]);

                if (!items) {
                    this.ordering[path][column] = [];
                    return;
                }

                items = items.map(function(element) {
                    return $(element).data('mm-id');
                });

                if (!this.ordering[path]) { this.ordering[path] = []; }
                this.ordering[path][column] = items;
            }, this);

            // Refresh the origin if it's a particle
            base = this.itemFrom ? (this.itemFrom.attribute('data-mm-base') !== null ? this.itemFrom : this.itemFrom.find('[data-mm-base]')) : null;
            if (this.isParticle && base && this.targetLevel != this.currentLevel) {
                var list = (this.itemFrom.data('mm-id').match(/\d+$/) || [0])[0],
                    location = base.data('mm-base') || '',
                    currentLocation = ltrim([location, id].join('/'), ['/']);

                this.ordering[location][list].splice(this.ParticleIndex, 1);
                this.items[this.itemID] = this.items[currentLocation];
                delete this.items[currentLocation];
            }
        }

        // Column reordering, we just need to swap the array indexes
        if (!this.itemFrom && !this.itemTo && !this.isParticle) {
            var colsOrder = [],
                active = $('.g-toplevel [data-mm-id].active').data('mm-id');
            items = parent.search('> [data-mm-id]');

            items.forEach(function(element, index) {
                element = $(element);

                var id = element.data('mm-id'),
                    column = Number((id.match(/\d+$/) || [0])[0]);

                element.data('mm-id', id.replace(/\d+$/, index));
                colsOrder.push(this.ordering[active][column]);
            }, this);

            this.ordering[active] = colsOrder;
        }

        if (!parent.children()) { parent.empty(); }

        /*if (console && console.group && console.info && console.table && console.groupEnd) {
         console.group();
         console.info('New Ordering');
         console.table(this.ordering);
         console.groupEnd();
         }*/

        var selector = this.block.parent('.submenu-selector');
        if (selector) { this.resizer.updateItemSizes(selector.search('> [data-mm-id]')); }

        this.emit('dragEnd', this.map, 'reorder');
    },

    stopAnimation: function(/*element*/) {
        var flex = null;
        if (this.type == 'column') { flex = this.resizer.getSize(this.block); }
        if (this.root) { this.root.removeClass('moving'); }
        if (this.block) {
            this.block.attribute('style', null);
            if (flex) { this.block.style('flex', '0 1 ' + flex + ' %'); }
        }

        if (this.original) {
            if (!this.isNewParticle || (!this.dragdrop.matched && !this.targetLevel)) { this.original.remove(); }
            else { this.original.attribute('style', null).removeClass('original-placeholder'); }
        }

        if (!this.wasActive && this.block) { this.block.removeClass('active'); }
    }
});


module.exports = MenuManager;

},{"../ui/drag.drop":50,"../ui/eraser":52,"../utils/elements.utils":64,"./drag.resizer":32,"elements/zen":135,"mout/array/every":167,"mout/array/indexOf":173,"mout/array/last":177,"mout/function/bind":190,"mout/lang/deepClone":198,"mout/lang/isArray":201,"mout/lang/isObject":206,"mout/object/equals":225,"mout/object/get":231,"mout/string/ltrim":261,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],36:[function(require,module,exports){
(function (global){
'use strict';
var $                  = require('elements'),
    ready              = require('elements/domready'),
    zen                = require('elements/zen'),
    Submit             = require('../fields/submit'),
    modal              = require('../ui').modal,
    toastr             = require('../ui').toastr,
    Eraser             = require('../ui/eraser'),
    request            = require('agent'),
    indexOf            = require('mout/array/indexOf'),
    simpleSort         = require('sortablejs'),

    trim               = require('mout/string/trim'),
    size               = require('mout/object/size'),

    parseAjaxURI       = require('../utils/get-ajax-url').parse,
    getAjaxSuffix      = require('../utils/get-ajax-suffix'),
    getOutlineNameById = require('../utils/get-outline').getOutlineNameById,
    translate          = require('../utils/translate');

var AtomsField   = '[name="page[head][atoms][_json]"]',
    groupOptions = [
        { name: 'atoms', pull: 'clone', put: false },
        { name: 'atoms', pull: true, put: true },
        { name: 'atoms', pull: false, put: false }
    ];

var Atoms = {
    eraser: null,
    lists: {
        picker: null,
        items: null
    },

    serialize: function() {
        var output = [],
            list   = $('.atoms-list'),
            atoms  = list.search('[data-atom-picked]');

        if (!atoms) {
            list.empty();
            return '[]';
        }

        atoms.forEach(function(item) {
            item = $(item);
            output.push(JSON.parse(item.data('atom-picked')));
        });

        return JSON.stringify(output).replace(/\//g, '\\/');
    },

    attachEraser: function() {
        if (Atoms.eraser) {
            Atoms.eraser.element = $('[data-atoms-erase]');
            return;
        }

        Atoms.eraser = new Eraser('[data-atoms-erase]');
    },

    createSortables: function(element) {
        var list, sort;

        Atoms.attachEraser();

        groupOptions.forEach(function(groupOption, i) {
            list = !i ? '.atoms-picker' : (i == 1 ? '.atoms-list' : '#trash');
            list = $(list);
            sort = simpleSort.create(list[0], {
                sort: i == 1,
                filter: '[data-atom-ignore]',
                group: groupOption,
                scroll: false,
                forceFallback: true,
                animation: 100,

                onStart: function(event) {
                    Atoms.attachEraser();

                    var item = $(event.item);
                    item.addClass('atom-dragging');

                    if ($(event.from).hasClass('atoms-list')) {
                        Atoms.eraser.show();
                    }
                },

                onEnd: function(event) {
                    var item       = $(event.item),
                        trash      = $('#trash'),
                        target     = $(this.originalEvent.target),
                        touchTrash = false;

                    // workaround for touch devices
                    if (this.originalEvent.type === 'touchend') {
                        var trashSize = trash[0].getBoundingClientRect(),
                            oE        = this.originalEvent,
                            position  = (oE.pageY || oE.changedTouches[0].pageY) - window.scrollY;

                        touchTrash = position <= trashSize.height;
                    }

                    if (target.matches('#trash') || target.parent('#trash') || touchTrash) {
                        item.remove();
                        Atoms.eraser.hide();
                        this.options.onSort();
                        return;
                    }

                    item.removeClass('atom-dragging');

                    if ($(event.from).hasClass('atoms-list')) {
                        Atoms.eraser.hide();
                    }
                },

                onSort: function() {
                    var serial = Atoms.serialize(),
                        field  = $(AtomsField);

                    if (!field) { throw new Error('Field "' + AtomsField + '" not found in the DOM.'); }

                    field.value(serial);
                    $('body').emit('change', { target: field });
                },

                onOver: function(evt) {
                    if (!$(evt.from).matches('.atoms-list')) { return; }

                    var over = $(evt.newIndex);
                    if (over.matches('#trash') || over.parent('#trash')) {
                        Atoms.eraser.over();
                    } else {
                        Atoms.eraser.out();
                    }
                }
            });

            Atoms.lists[!i ? 'picker' : 'items'] = sort;
            if (i == 1) {
                element.SimpleSort = sort;
            }
        });
    }
};

var AttachSettings = function() {
    var body = $('body');

    body.delegate('click', '.atoms-list [data-atom-picked] .config-cog', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var list      = element.parent('ul'),
            dataField = $(AtomsField),
            data      = dataField.value(),
            items     = list.search('> [data-atom-picked]'),
            item      = element.parent('[data-atom-picked]'),
            itemData  = item.data('atom-picked');

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'post',
            data: { data: itemData },
            overlayClickToClose: false,
            remote: parseAjaxURI(element.attribute('href') + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                var form       = content.elements.content.find('form'),
                    fakeDOM    = zen('div').html(response.body.html).find('form'),
                    submit     = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]'),
                    dataValue  = JSON.parse(data);

                if (modal.getAll().length > 1) {
                    var applyAndSave = content.elements.content.search('[data-apply-and-save]');
                    if (applyAndSave) { applyAndSave.remove(); }
                }

                if ((!form && !fakeDOM) || !submit) {
                    return true;
                }

                // Atom Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();

                    var target = $(e.currentTarget);

                    target.hideIndicator();
                    target.showIndicator();

                    // Refresh the form to collect fresh and dynamic fields
                    var formElements = content.elements.content.find('form')[0].elements;
                    var post = Submit(formElements, content.elements.content);

                    if (post.invalid.length) {
                        target.hideIndicator();
                        target.showIndicator('fa fa-fw fa-exclamation-triangle');
                        toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
                        return;
                    }

                    request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&') || {}, function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            var index = indexOf(items, item[0]);
                            dataValue[index] = response.body.item;

                            dataField.value(JSON.stringify(dataValue).replace(/\//g, '\\/'));
                            item.find('.atom-title').text(dataValue[index].title);
                            item.data('atom-picked', JSON.stringify(dataValue[index]).replace(/\//g, '\\/'));

                            // toggle enabled/disabled status as needed
                            var enabled    = Number(dataValue[index].attributes.enabled),
                                inheriting = response.body.item.inherit && size(response.body.item.inherit);
                            item[enabled ? 'removeClass' : 'addClass']('atom-disabled');
                            item[!inheriting ? 'removeClass' : 'addClass']('g-inheriting');
                            item.attribute('title', enabled ? '' : translate('GANTRY5_PLATFORM_JS_LM_DISABLED_PARTICLE', 'atom'));

                            item.data('tip', null);
                            if (inheriting) {
                                var inherit = response.body.item.inherit,
                                    outline = getOutlineNameById(inherit ? inherit.outline : null),
                                    atom = inherit.atom || '',
                                    include = (inherit.include || []).join(', ');

                                item.data('tip', translate('GANTRY5_PLATFORM_INHERITING_FROM_X', '<strong>' + outline + '</strong>') + '<br />ID: ' + atom + '<br />Replace: ' + include);
                            }

                            body.emit('change', { target: dataField });
                            global.G5.tips.reload();

                            // if it's apply and save we also save the panel
                            if (target.data('apply-and-save') !== null) {
                                var save = $('body').find('.button-save');
                                if (save) { body.emit('click', { target: save }); }
                            }

                            modal.close();
                            toastr.success(translate('GANTRY5_PLATFORM_JS_GENERIC_SETTINGS_APPLIED', 'Atom'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }

                        target.hideIndicator();
                    });
                });
            }
        });
    });
};

var AttachSortableAtoms = function(atoms) {
    if (!atoms) { return; }
    if (!atoms.SimpleSort) { Atoms.createSortables(atoms); }
};

ready(function() {
    var atoms = $('#atoms');

    $('body').delegate('mouseover', '#atoms', function(event, element) {
        AttachSortableAtoms(element);
    });

    AttachSortableAtoms(atoms);
    AttachSettings();
});

module.exports = Atoms;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../fields/submit":8,"../ui":53,"../ui/eraser":52,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/get-outline":70,"../utils/translate":76,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/array/indexOf":173,"mout/object/size":240,"mout/string/trim":270,"sortablejs":314}],37:[function(require,module,exports){
"use strict";

var ready         = require('elements/domready'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    Submit        = require('../../fields/submit'),
    modal         = require('../../ui').modal,
    toastr        = require('../../ui').toastr,
    request       = require('agent'),
    lastItem      = require('mout/array/last'),
    indexOf       = require('mout/array/indexOf'),
    simpleSort    = require('sortablejs'),

    trim          = require('mout/string/trim'),

    parseAjaxURI  = require('../../utils/get-ajax-url').parse,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    translate     = require('../../utils/translate');

require('elements/insertion');

ready(function() {
    var body = $('body');

    var addNewByEnter = function(title, key) {
        if (key == 'enter' && this.CollectionNew) {
            this.CollectionNew = false;
            body.emit('click', { target: this.parent('.settings-param').find('[data-collection-addnew]') });
        }

        if (key == 'esc' && this.CollectionNew) {
            this.CollectionNew = false;
            body.emit('click', { target: this.parent('[data-collection-item]').find('[data-collection-remove]') });
        }
    };

    var createSortables = function(list) {
        var lists = list || $('.collection-list ul');
        if (!lists) { return; }
        lists.forEach(function(list) {
            list = $(list);
            list.SimpleSort = simpleSort.create(list[0], {
                handle: '.fa-reorder',
                filter: '[data-collection-nosort]',
                scroll: false,
                animation: 150,
                onStart: function() {
                    $(this.el).addClass('collection-sorting');
                },
                onEnd: function(evt) {
                    var element = $(this.el);
                    element.removeClass('collection-sorting');

                    if (evt.oldIndex === evt.newIndex) { return; }

                    var dataField = element.parent('.settings-param').find('[data-collection-data]'),
                        data = dataField.value();

                    data = JSON.parse(data);

                    data.splice(evt.newIndex, 0, data.splice(evt.oldIndex, 1)[0]);
                    dataField.value(JSON.stringify(data));
                    body.emit('change', { target: dataField });
                }
            });
        });
    };

    createSortables();

    // delegate sortables collections for ajax support
    body.delegate('mouseover', '.collection-list ul', function(event, element) {
        if (!element.SimpleSort) { createSortables(element); }
    });

    // Add new item
    body.delegate('click', '[data-collection-addnew]', function(event, element) {
        var param = element.parent('.settings-param'),
            list = param.find('ul'),
            editall = list.parent('[data-field-name]').find('[data-collection-editall]'),
            dataField = param.find('[data-collection-data]'),
            tmpl = param.find('[data-collection-template]'),
            items = list.search('> [data-collection-item]') || [],
            last = $(lastItem(items));

        var clone = $(tmpl[0].cloneNode(true)), title, editable;

        if (last) { clone.after(last); }
        else { clone.top(list); }
        
        if (items.length && editall) { editall.style('display', 'inline-block'); }

        title = clone.find('a');
        editable = title.find('[data-title-editable]');

        var re = new RegExp('%id%', 'g');
        title.href(title.href().replace(re, items.length));

        clone.attribute('style', null).data('collection-item', clone.data('collection-template'));
        clone.attribute('data-collection-template', null);
        clone.attribute('data-collection-nosort', null);
        editable.CollectionNew = true;
        body.emit('click', { target: title.siblings('[data-title-edit]') });

        editable.on('title-edit-exit', addNewByEnter);
        body.emit('change', { target: dataField });
    });

    // Edit Title
    body.delegate('blur', '[data-collection-item] [data-title-editable]', function(event, element) {
        var text = trim(element.text()),
            item = element.parent('[data-collection-item]'),
            key = item.data('collection-item'),
            items = element.parent('ul').search('> [data-collection-item]'),
            dataField = element.parent('.settings-param').find('[data-collection-data]'),
            data = dataField.value(),
            index = indexOf(items, item[0]);

        if (index == -1) { return; }

        data = JSON.parse(data);
        if (!data[index]) { data.splice(index, 0, {}); }
        data[index][key] = text;
        dataField.value(JSON.stringify(data));
        body.emit('change', { target: dataField });
    }, true);

    // Remove item
    body.delegate('click', '[data-collection-remove]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var item = element.parent('[data-collection-item]'),
            list = element.parent('ul'),
            editall = list.parent('[data-field-name]').find('[data-collection-editall]'),
            items = list.search('> [data-collection-item]'),
            index = indexOf(items, item[0]),
            dataField = element.parent('.settings-param').find('[data-collection-data]'),
            data = dataField.value();

        data = JSON.parse(data);
        data.splice(index, 1);
        dataField.value(JSON.stringify(data));
        item.remove();
        if (items.length <= 2 && editall) { editall.style('display', 'none'); }
        body.emit('change', { target: dataField });
    });

    // Duplicate item
    body.delegate('click', '[data-collection-duplicate]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var param = element.parent('.settings-param'),
            item = element.parent('[data-collection-item]'),
            list = element.parent('ul'),
            editall = list.parent('[data-field-name]').find('[data-collection-editall]'),
            url = param.find('[data-collection-template]').find('a').href(),
            items = list.search('> [data-collection-item]'),
            index = indexOf(items, item[0]),
            clone = $(item[0].cloneNode(true)).after(item),
            dataField = element.parent('.settings-param').find('[data-collection-data]'),
            data = dataField.value();

        var re = new RegExp('%id%', 'g');
        clone.find('a').href(url.replace(re, items.length + 1));

        data = JSON.parse(data);
        data.splice(index, 0, data[index]);
        dataField.value(JSON.stringify(data));

        if (items.length >= 1) { editall.style('display', 'inline-block'); }
        body.emit('change', { target: dataField });
    });

    // Preventing click of links when title is being edited
    body.delegate('click', '[data-collection-item] a', function(event, element) {
        if (element.find('[contenteditable]')) {
            event.preventDefault();
            event.stopPropagation();
        }
    });

    // Load item settings
    body.delegate('click', '[data-collection-item] .config-cog, [data-collection-editall]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var editable = element.find('[data-title-editable]');
        if (editable && editable.attribute('contenteditable')) {
            event.stopPropagation();
            return false;
        }

        var isEditAll = element.data('collection-editall') !== null,
            parent = element.parent('.settings-param'),
            dataField = parent.find('[data-collection-data]'),
            data = dataField.value(),
            item = element.parent('[data-collection-item]'),
            items = parent.search('ul > [data-collection-item]');

        var dataPost = { data: isEditAll ? data : JSON.stringify(JSON.parse(data)[indexOf(items, item[0])]) };
        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'post',
            className: 'g5-dialog-theme-default g5-modal-collection g5-modal-collection-' + (isEditAll ? 'editall' : 'single'),
            data: dataPost,
            overlayClickToClose: false,
            remote: parseAjaxURI(element.attribute('href') + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }
                
                var form = content.elements.content.find('form'),
                    fakeDOM = zen('div').html(response.body.html).find('form'),
                    submit = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]'),
                    dataValue = JSON.parse(data);

                if (modal.getAll().length > 1) {
                    var applyAndSave = content.elements.content.search('[data-apply-and-save]');
                    if (applyAndSave) { applyAndSave.remove(); }
                }

                if (dataValue.length == 1) {
                    // TODO: need to determine better how to handle single collections cards
                    //content.elements.content.style({ width: 450 });
                }

                if ((!form && !fakeDOM) || !submit) {
                    return true;
                }

                // Collection Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();

                    var target = $(e.currentTarget);

                    target.hideIndicator();
                    target.showIndicator();

                    var post = Submit(fakeDOM[0].elements, content.elements.content);

                    if (post.invalid.length) {
                        target.hideIndicator();
                        target.showIndicator('fa fa-fw fa-exclamation-triangle');
                        toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
                        return;
                    }

                    request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&') || {}, function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            if (item) { // single editing
                                dataValue[indexOf(items, item[0])] = response.body.data;
                            } else { // multi editing
                                dataValue = response.body.data;
                            }

                            dataField.value(JSON.stringify(dataValue));
                            body.emit('change', { target: dataField });

                            element.parent('.settings-param-field').search('ul > [data-collection-item]').forEach(function(item, index) {
                                item = $(item);
                                var label = item.find('[data-title-editable]'),
                                    text = dataValue[index][item.data('collection-item')];

                                label.data('title-editable', text).text(text);
                            });

                            // if it's apply and save we also save the panel
                            if (target.data('apply-and-save') !== null) {
                                var save = $('body').find('.button-save');
                                if (save) { body.emit('click', { target: save }); }
                            }

                            modal.close();
                            toastr.success(translate('GANTRY5_PLATFORM_JS_GENERIC_SETTINGS_APPLIED', 'Collection'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }

                        target.hideIndicator();
                    });
                });
            }
        });
    });
});

module.exports = {};

},{"../../fields/submit":8,"../../ui":53,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/translate":76,"agent":78,"elements":111,"elements/domready":109,"elements/insertion":112,"elements/zen":135,"mout/array/indexOf":173,"mout/array/last":177,"mout/string/trim":270,"sortablejs":314}],38:[function(require,module,exports){
"use strict";

var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    $          = require('elements'),
    ready      = require('elements/domready'),
    zen        = require('elements/zen'),

    DragEvents = require('../../ui/drag.events'),

    forEach    = require('mout/collection/forEach'),
    bind       = require('mout/function/bind'),
    clamp      = require('mout/math/clamp');

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;

var MOUSEDOWN = DragEvents.EVENTS.START,
    MOUSEMOVE = DragEvents.EVENTS.MOVE,
    MOUSEUP   = DragEvents.EVENTS.STOP,
    FOCUSIN   = isFirefox ? 'focus' : 'focusin';

var ColorPicker = new prime({
    mixin: [Options, Bound],
    inherits: Emitter,
    options: {},
    constructor: function(options) {
        this.setOptions(options);
        this.built = false;
        this.attach();
    },

    attach: function() {
        var body = $('body');

        MOUSEDOWN.forEach(bind(function(mousedown) {
            body.delegate(mousedown, '#g5-container .g-colorpicker i', this.bound('iconClick'));
        }, this));

        body.delegate(FOCUSIN, '#g5-container .g-colorpicker input', this.bound('show'), true);


        body.delegate('keydown', '#g5-container .g-colorpicker input', bind(function(event, element) {
            switch (event.keyCode) {
                case 9: // tab
                    this.hide();
                    break;
                case 13: // enter
                case 27: // esc
                    this.hide();
                    element[0].blur();
                    break;
            }
            return true;
        }, this));

        // Update on keyup
        body.delegate('keyup', '#g5-container .g-colorpicker input', bind(function(event, element) {
            this.updateFromInput(true, element);
            return true;
        }, this));

        // Update on paste
        body.delegate('paste', '#g5-container .g-colorpicker input', bind(function(event, element) {
            setTimeout(bind(function() {
                this.updateFromInput(true, element);
            }, this), 1);
        }, this));
    },

    show: function(event, element) {
        var body = $('body');

        if (!this.built) {
            this.build();
        }

        this.element = element;
        this.reposition();
        this.wrapper.addClass('cp-visible');
        this.updateFromInput();

        MOUSEMOVE.forEach(bind(function(mousemove) {
            body.on(mousemove, this.bound('bodyMove'));
        }, this));

        MOUSEDOWN.forEach(bind(function(mousedown) {
            this.wrapper.delegate(mousedown, '.cp-grid, .cp-slider, .cp-opacity-slider', this.bound('bodyDown'));
            body.on(mousedown, this.bound('bodyClick'));
        }, this));

        MOUSEUP.forEach(bind(function(mouseup) {
            body.on(mouseup, this.bound('targetReset'));
        }, this));
    },

    hide: function() {
        var body = $('body');

        if (!this.built) { return; }
        this.wrapper.removeClass('cp-visible');

        MOUSEMOVE.forEach(bind(function(mousemove) {
            body.off(mousemove, this.bound('bodyMove'));
        }, this));

        MOUSEDOWN.forEach(bind(function(mousedown) {
            this.wrapper.undelegate(mousedown, '.cp-grid, .cp-slider, .cp-opacity-slider', this.bound('bodyDown'));
            body.off(mousedown, this.bound('bodyClick'));
        }, this));

        MOUSEUP.forEach(bind(function(mouseup) {
            body.off(mouseup, this.bound('targetReset'));
        }, this));
    },

    iconClick: function(event, element) {
        event.preventDefault();

        var input = $(element).sibling('input');
        input[0].focus();

        this.show(event, input);
    },

    bodyMove: function(event) {
        event.preventDefault();

        if (this.target) { this.move(this.target, event); }
    },

    bodyClick: function(event) {
        var target = $(event.target);
        if (!target.parent('.cp-wrapper') && !target.parent('.g-colorpicker')) {
            this.hide();
        }
    },

    bodyDown: function(event, element) {
        event.preventDefault();

        this.target = element;
        this.move(this.target, event, true);
    },

    targetReset: function(event) {
        event.preventDefault();

        this.target = null;
    },

    move: function(target, event) {
        var input = this.element,
            picker = target.find('.cp-picker'),
            clientRect = target[0].getBoundingClientRect(),
            offsetX = clientRect.left + window.scrollX,
            offsetY = clientRect.top + window.scrollY,
            x = Math.round((event ? event.pageX : 0) - offsetX),
            y = Math.round((event ? event.pageY : 0) - offsetY),
            wx, wy, r, phi;

        // Touch support
        if (event && event.changedTouches) {
            x = (event.changedTouches ? event.changedTouches[0].pageX : 0) - offsetX;
            y = (event.changedTouches ? event.changedTouches[0].pageY : 0) - offsetY;
        }

        if (event && event.manualOpacity) {
            y = clientRect.height;
        }

        // Constrain picker to its container
        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x > clientRect.width) x = clientRect.width;
        if (y > clientRect.height) y = clientRect.height;

        // Constrain color wheel values to the wheel
        if (target.parent('.cp-mode-wheel') && picker.parent('.cp-grid')) {
            wx = 75 - x;
            wy = 75 - y;
            r = Math.sqrt(wx * wx + wy * wy);
            phi = Math.atan2(wy, wx);

            if (phi < 0) phi += Math.PI * 2;
            if (r > 75) {
                x = 75 - (75 * Math.cos(phi));
                y = 75 - (75 * Math.sin(phi));
            }

            x = Math.round(x);
            y = Math.round(y);
        }

        // Move the picker
        if (target.hasClass('cp-grid')) {
            picker.style({
                top: y,
                left: x
            });

            this.updateFromPicker(input, target);
        } else {
            picker.style({
                top: y
            });
            this.updateFromPicker(input, target);
        }
    },

    build: function() {
        this.wrapper = zen('div.cp-wrapper.cp-with-opacity.cp-mode-hue');
        this.slider = zen('div.cp-slider.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-picker'));
        this.opacitySlider = zen('div.cp-opacity-slider.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-picker'));
        this.grid = zen('div.cp-grid.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-grid-inner')).appendChild(zen('div.cp-picker'));

        zen('div').bottom(this.grid.find('.cp-picker'));

        var tabs = zen('div.cp-tabs').bottom(this.wrapper);

        this.tabs = {
            hue: zen('div.cp-tab-hue.active').text('HUE').bottom(tabs),
            brightness: zen('div.cp-tab-brightness').text('BRI').bottom(tabs),
            saturation: zen('div.cp-tab-saturation').text('SAT').bottom(tabs),
            wheel: zen('div.cp-tab-wheel').text('WHEEL').bottom(tabs),
            transparent: zen('div.cp-tab-transp').text('TRANSPARENT').bottom(tabs)
        };

        MOUSEDOWN.forEach(bind(function(mousedown) {
            tabs.delegate(mousedown, '> div', bind(function(event, element) {
                if (element == this.tabs.transparent) {
                    this.opacity = 0;
                    var sliderHeight = this.opacitySlider.position().height;
                    this.opacitySlider.find('.cp-picker').style({ 'top': clamp(sliderHeight - (sliderHeight * this.opacity), 0, sliderHeight) });
                    this.move(this.opacitySlider, { manualOpacity: true });
                    return;
                }

                var active = tabs.find('.active'),
                    mode = active.attribute('class').replace(/\s|active|cp-tab-/g, ''),
                    newMode = element.attribute('class').replace(/\s|active|cp-tab-/g, '');

                this.wrapper.removeClass('cp-mode-' + mode).addClass('cp-mode-' + newMode);
                active.removeClass('active');
                element.addClass('active');

                this.mode = newMode;
                this.updateFromInput();
            }, this));
        }, this));

        this.wrapper.bottom('#g5-container');

        this.built = true;
        this.mode = 'hue';
    },

    updateFromInput: function(dontFireEvent, element) {
        element = $(element) || this.element;
        var value = element.value(),
            opacity = value.replace(/\s/g, '').match(/^rgba?\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(.+)\)/),
            hex, hsb;

        value = rgbstr2hex(value) || value;
        opacity = opacity ? clamp(opacity[1], 0, 1) : 1;

        if (!(hex = parseHex(value))) { hex = '#ffffff'; }
        hsb = hex2hsb(hex);

        if (this.built) {
            // opacity
            this.opacity = Math.max(opacity, 0);
            var sliderHeight = this.opacitySlider.position().height;
            this.opacitySlider.find('.cp-picker').style({ 'top': clamp(sliderHeight - (sliderHeight * this.opacity), 0, sliderHeight) });

            // bg color
            var gridHeight = this.grid.position().height,
                gridWidth = this.grid.position().width,
                r, phi, x, y;

            sliderHeight = this.slider.position().height;

            switch (this.mode) {
                case 'wheel':
                    // Set grid position
                    r = clamp(Math.ceil(hsb.s * 0.75), 0, gridHeight / 2);
                    phi = hsb.h * Math.PI / 180;
                    x = clamp(75 - Math.cos(phi) * r, 0, gridWidth);
                    y = clamp(75 - Math.sin(phi) * r, 0, gridHeight);
                    this.grid.style({ backgroundColor: 'transparent' }).find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = 150 - (hsb.b / (100 / gridHeight));
                    if (hex === '') y = 0;
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update panel color
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: hsb.s,
                            b: 100
                        })
                    });
                    break;

                case 'saturation':
                    // Set grid position
                    x = clamp((5 * hsb.h) / 12, 0, 150);
                    y = clamp(gridHeight - Math.ceil(hsb.b / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.s * (sliderHeight / 100)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update UI
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: 100,
                            b: hsb.b
                        })
                    });
                    this.grid.find('.cp-grid-inner').style({ opacity: hsb.s / 100 });
                    break;

                case 'brightness':
                    // Set grid position
                    x = clamp((5 * hsb.h) / 12, 0, 150);
                    y = clamp(gridHeight - Math.ceil(hsb.s / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.b * (sliderHeight / 100)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update UI
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: hsb.s,
                            b: 100
                        })
                    });
                    this.grid.find('.cp-grid-inner').style({ opacity: 1 - (hsb.b / 100) });
                    break;
                case 'hue':
                default:
                    // Set grid position
                    x = clamp(Math.ceil(hsb.s / (100 / gridWidth)), 0, gridWidth);
                    y = clamp(gridHeight - Math.ceil(hsb.b / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.h / (360 / sliderHeight)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update panel color
                    this.grid.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: 100,
                            b: 100
                        })
                    });
                    break;
            }
        }

        if (!dontFireEvent) { element.value(this.getValue(hex)); }

        this.emit('change', element, hex, opacity);

    },

    updateFromPicker: function(input, target) {
        var getCoords = function(picker, container) {

            var left, top;
            if (!picker.length || !container) return null;
            left = picker[0].getBoundingClientRect().left;
            top = picker[0].getBoundingClientRect().top;

            return {
                x: left - container[0].getBoundingClientRect().left + (picker[0].offsetWidth / 2),
                y: top - container[0].getBoundingClientRect().top + (picker[0].offsetHeight / 2)
            };

        };

        var hex, hue, saturation, brightness, x, y, r, phi,

            // Panel objects
            grid = this.wrapper.find('.cp-grid'),
            slider = this.wrapper.find('.cp-slider'),
            opacitySlider = this.wrapper.find('.cp-opacity-slider'),

            // Picker objects
            gridPicker = grid.find('.cp-picker'),
            sliderPicker = slider.find('.cp-picker'),
            opacityPicker = opacitySlider.find('.cp-picker'),

            // Picker positions
            gridPos = getCoords(gridPicker, grid),
            sliderPos = getCoords(sliderPicker, slider),
            opacityPos = getCoords(opacityPicker, opacitySlider),

            // Sizes
            gridWidth = grid[0].getBoundingClientRect().width,
            gridHeight = grid[0].getBoundingClientRect().height,
            sliderHeight = slider[0].getBoundingClientRect().height,
            opacitySliderHeight = opacitySlider[0].getBoundingClientRect().height;

        var value = this.element.value();
        value = rgbstr2hex(value) || value;
        if (!(hex = parseHex(value))) { hex = '#ffffff'; }

        // Handle colors
        if (target.hasClass('cp-grid') || target.hasClass('cp-slider')) {

            // Determine HSB values
            switch (this.mode) {
                case 'wheel':
                    // Calculate hue, saturation, and brightness
                    x = (gridWidth / 2) - gridPos.x;
                    y = (gridHeight / 2) - gridPos.y;
                    r = Math.sqrt(x * x + y * y);
                    phi = Math.atan2(y, x);
                    if (phi < 0) phi += Math.PI * 2;
                    if (r > 75) {
                        r = 75;
                        gridPos.x = 69 - (75 * Math.cos(phi));
                        gridPos.y = 69 - (75 * Math.sin(phi));
                    }
                    saturation = clamp(r / 0.75, 0, 100);
                    hue = clamp(phi * 180 / Math.PI, 0, 360);
                    brightness = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: saturation,
                            b: 100
                        })
                    });
                    break;

                case 'saturation':
                    // Calculate hue, saturation, and brightness
                    hue = clamp(parseInt(gridPos.x * (360 / gridWidth), 10), 0, 360);
                    saturation = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    brightness = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: 100,
                            b: brightness
                        })
                    });
                    grid.find('.cp-grid-inner').style({ opacity: saturation / 100 });
                    break;

                case 'brightness':
                    // Calculate hue, saturation, and brightness
                    hue = clamp(parseInt(gridPos.x * (360 / gridWidth), 10), 0, 360);
                    saturation = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    brightness = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: saturation,
                            b: 100
                        })
                    });
                    grid.find('.cp-grid-inner').style({ opacity: 1 - (brightness / 100) });
                    break;

                default:
                    // Calculate hue, saturation, and brightness
                    hue = clamp(360 - parseInt(sliderPos.y * (360 / sliderHeight), 10), 0, 360);
                    saturation = clamp(Math.floor(gridPos.x * (100 / gridWidth)), 0, 100);
                    brightness = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    grid.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: 100,
                            b: 100
                        })
                    });
                    break;

            }
        }

        // Handle opacity
        if (target.hasClass('cp-opacity-slider')) {
            this.opacity = Math.max(parseFloat(1 - (opacityPos.y / opacitySliderHeight)).toFixed(2), 0);
        }

        // Adjust case
        input.value(this.getValue(hex));

        // Handle change event
        this.emit('change', this.element, hex, this.opacity);

    },

    reposition: function() {
        var offset = this.element[0].getBoundingClientRect(),
            ct = $('#g5-container')[0].getBoundingClientRect();
        this.wrapper.style({
            top: offset.top + offset.height - ct.top,
            left: offset.left - ct.left
        });
    },

    getValue: function(hex) {
        if (this.opacity == 1) { return hex; }
        var rgb = hex2rgb(hex);
        return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + this.opacity + ')';
    }
});

// Parses a string and returns a valid hex string when possible
var parseHex = function(string) {
    string = string.replace(/[^A-F0-9]/ig, '');
    if (string.length !== 3 && string.length !== 6) return '';
    if (string.length === 3) {
        string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
    }

    return '#' + string.toLowerCase();
};

// Converts an HSB object to an RGB object
var hsb2rgb = function(hsb) {
    var rgb = {};
    var h = Math.round(hsb.h);
    var s = Math.round(hsb.s * 255 / 100);
    var v = Math.round(hsb.b * 255 / 100);
    if (s === 0) {
        rgb.r = rgb.g = rgb.b = v;
    } else {
        var t1 = v;
        var t2 = (255 - s) * v / 255;
        var t3 = (t1 - t2) * (h % 60) / 60;
        if (h === 360) h = 0;
        if (h < 60) {
            rgb.r = t1;
            rgb.b = t2;
            rgb.g = t2 + t3;
        }
        else if (h < 120) {
            rgb.g = t1;
            rgb.b = t2;
            rgb.r = t1 - t3;
        }
        else if (h < 180) {
            rgb.g = t1;
            rgb.r = t2;
            rgb.b = t2 + t3;
        }
        else if (h < 240) {
            rgb.b = t1;
            rgb.r = t2;
            rgb.g = t1 - t3;
        }
        else if (h < 300) {
            rgb.b = t1;
            rgb.g = t2;
            rgb.r = t2 + t3;
        }
        else if (h < 360) {
            rgb.r = t1;
            rgb.g = t2;
            rgb.b = t1 - t3;
        }
        else {
            rgb.r = 0;
            rgb.g = 0;
            rgb.b = 0;
        }
    }
    return {
        r: Math.round(rgb.r),
        g: Math.round(rgb.g),
        b: Math.round(rgb.b)
    };
};

// Converts an RGB object to a hex string
var rgb2hex = function(rgb) {
    var hex = [
        rgb.r.toString(16),
        rgb.g.toString(16),
        rgb.b.toString(16)
    ];

    forEach(hex, function(val, nr) {
        if (val.length === 1) hex[nr] = '0' + val;
    });

    return '#' + hex.join('');
};

var rgbstr2hex = function(rgb) {
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return (rgb && rgb.length === 4) ? "#" +
    ("0" + parseInt(rgb[1], 10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[2], 10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
};

// Converts an HSB object to a hex string
var hsb2hex = function(hsb) {
    return rgb2hex(hsb2rgb(hsb));
};

// Converts a hex string to an HSB object
var hex2hsb = function(hex) {
    var hsb = rgb2hsb(hex2rgb(hex));
    if (hsb.s === 0) hsb.h = 360;
    return hsb;
};

// Converts an RGB object to an HSB object
var rgb2hsb = function(rgb) {
    var hsb = {
        h: 0,
        s: 0,
        b: 0
    };
    var min = Math.min(rgb.r, rgb.g, rgb.b);
    var max = Math.max(rgb.r, rgb.g, rgb.b);
    var delta = max - min;
    hsb.b = max;
    hsb.s = max !== 0 ? 255 * delta / max : 0;
    if (hsb.s !== 0) {
        if (rgb.r === max) {
            hsb.h = (rgb.g - rgb.b) / delta;
        } else if (rgb.g === max) {
            hsb.h = 2 + (rgb.b - rgb.r) / delta;
        } else {
            hsb.h = 4 + (rgb.r - rgb.g) / delta;
        }
    } else {
        hsb.h = -1;
    }
    hsb.h *= 60;
    if (hsb.h < 0) {
        hsb.h += 360;
    }
    hsb.s *= 100 / 255;
    hsb.b *= 100 / 255;
    return hsb;
};

// Converts a hex string to an RGB object
var hex2rgb = function(hex) {
    hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);
    return {
        /* jshint ignore:start */
        r: hex >> 16,
        g: (hex & 0x00FF00) >> 8,
        b: (hex & 0x0000FF)
        /* jshint ignore:end */
    };
};


ready(function() {
    var x = new ColorPicker(), body = $('body');
    x.on('change', function(element, hex, opacity) {
        clearTimeout(this.timer);
        var rgb = hex2rgb(hex),
            yiq = (((rgb.r * 299) + (rgb.g * 587) + (rgb.b * 114)) / 1000) >= 128 ? 'dark' : 'light',
            check = yiq == 'dark' || (!opacity || opacity < 0.35);

        if (opacity < 1) {
            var str = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + opacity + ')';
            element.style({ backgroundColor: str });
        } else {
            element.style({ backgroundColor: hex });
        }

        element.parent('.g-colorpicker')[!check ? 'addClass' : 'removeClass']('light-text');

        this.timer = setTimeout(function() {
            element.emit('input');
            body.emit('input', { target: element });
        }, 150);

    });
});

module.exports = ColorPicker;

},{"../../ui/drag.events":51,"elements":111,"elements/domready":109,"elements/zen":135,"mout/collection/forEach":187,"mout/function/bind":190,"mout/math/clamp":214,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],39:[function(require,module,exports){
(function (global){
"use strict";

var $             = require('../../utils/elements.utils'),
    prime         = require('prime'),
    request       = require('agent'),
    zen           = require('elements/zen'),
    domready      = require('elements/domready'),
    bind          = require('mout/function/bind'),
    rtrim         = require('mout/string/rtrim'),
    deepClone     = require('mout/lang/deepClone'),
    deepFillIn    = require('mout/object/deepFillIn'),
    modal         = require('../../ui').modal,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../../utils/get-ajax-url').parse,
    getAjaxURL    = require('../../utils/get-ajax-url').global,
    translate     = require('../../utils/translate'),
    dropzone      = require('dropzone');

var FilePicker = new prime({
    constructor: function(element) {
        var data = element.data('g5-filepicker'), value;
        this.data = data ? JSON.parse(data) : false;

        if (this.data && !this.data.value) {
            this.data.value = $(this.data.field).value();
        }

        this.colors = {
            error: '#D84747',
            success: '#9ADF87',
            small: '#aaaaaa',
            gradient: ['#9e38eb', '#4e68fc']
        };

        //console.log(this.data);
    },

    open: function() {
        if (this.data) {
            this.data.value = $(this.data.field).value();
        }

        modal.open({
            method: 'post',
            data: this.data,
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            className: 'g5-dialog-theme-default g5-modal-filepicker',
            remote: parseAjaxURI(getAjaxURL('filepicker') + getAjaxSuffix()),
            remoteLoaded: bind(this.loaded, this),
            afterClose: bind(function() {
                if (this.dropzone) { this.dropzone.destroy(); }
            }, this)
        });
    },

    getPath: function() {
        var actives = this.content.search('.g-folders .active'), active, path;
        if (!actives) { return null; }

        active = $(actives[actives.length - 1]);
        path = JSON.parse(active.data('folder')).pathname;
        return path.replace(/\/$/, '') + '/';
    },

    getPreviewTemplate: function() {
        var li    = zen('li[data-file]'),
            del   = zen('span.g-file-delete[data-g-file-delete][data-dz-remove]').html('<i class="fa fa-fw fa-trash-o"></i>').bottom(li),
            thumb = zen('div.g-thumb[data-dz-thumbnail]').bottom(li),
            name  = zen('span.g-file-name[data-dz-name]').bottom(li),
            size  = zen('span.g-file-size[data-dz-size]').bottom(li),
            mtime = zen('span.g-file-mtime[data-dz-mtime]').bottom(li);

        zen('span.g-file-progress[data-file-uploadprogress]').html('<span class="g-file-progress-text"></span>').bottom(li);
        zen('div').bottom(thumb);

        li.bottom('body');
        var html = li[0].outerHTML;
        li.remove();

        return html;
    },

    loaded: function(response, modalInstance) {
        var content   = modalInstance.elements.content,
            bookmarks = content.search('.g-bookmark'),
            files     = content.find('.g-files'),
            fieldData = deepClone(this.data),
            colors    = this.colors,
            self      = this;

        this.content = content;

        if (files) {
            this.dropzone = new dropzone('body', {
                previewTemplate: this.getPreviewTemplate(),
                previewsContainer: files.find('ul:not(.g-list-labels)')[0],
                thumbnailWidth: 100,
                thumbnailHeight: 100,
                clickable: '[data-upload]',
                acceptedFiles: this.acceptedFiles(this.data.filter) || '',
                accept: bind(function(file, done) {
                    if (!this.data.filter) { done(); }
                    else {
                        if (file.name.match(this.data.filter)) { done(); }
                        else { done('<code>' + file.name + '</code> ' + translate('GANTRY5_PLATFORM_JS_FILTER_MISMATCH') + ': <br />  <code>' + this.data.filter + '</code>'); }
                    }
                }, this),
                url: bind(function(file) {
                    return parseAjaxURI(getAjaxURL('filepicker/upload/' + global.btoa(encodeURIComponent(this.getPath() + file[0].name))) + getAjaxSuffix());
                }, this)
            });

            // dropzone events
            this.dropzone.on('thumbnail', function(file, dataUrl) {
                var ext = file.name.split('.');
                ext = (!ext.length || ext.length == 1) ? '-' : ext.reverse()[0];
                $(file.previewElement).addClass('g-image g-image-' + ext.toLowerCase()).find('[data-dz-thumbnail] > div').attribute('style', 'background-image: url(' + encodeURI(dataUrl) + ');');
            });

            this.dropzone.on('addedfile', function(file) {
                var element      = $(file.previewElement),
                    uploader     = element.find('[data-file-uploadprogress]'),
                    isList       = files.hasClass('g-filemode-list'),
                    progressConf = {
                        value: 0,
                        animation: false,
                        insertLocation: 'bottom'
                    };

                var ext = file.name.split('.');
                ext = (!ext.length || ext.length == 1) ? '-' : ext.reverse()[0];

                if (!file.type.match(/image.*/)) {
                    element.find('.g-thumb').text(ext);
                } else {
                    element.find('.g-thumb').addClass('g-image g-image-' + ext.toLowerCase());
                }

                progressConf = deepFillIn((isList ? {
                    size: 20,
                    thickness: 10,
                    fill: {
                        color: colors.small,
                        gradient: false
                    }
                } : {
                    size: 50,
                    thickness: 'auto',
                    fill: {
                        gradient: colors.gradient,
                        color: false
                    }
                }), progressConf);

                element.addClass('g-file-uploading');
                uploader.progresser(progressConf);
                uploader.attribute('title', translate('GANTRY5_PLATFORM_JS_PROCESSING')).find('.g-file-progress-text').html('&bull;&bull;&bull;').attribute('title', translate('GANTRY5_PLATFORM_JS_PROCESSING'));

            }).on('processing', function(file) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.find('.g-file-progress-text').text('0%').attribute('title', '0%');

            }).on('sending', function(file, xhr, formData) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.attribute('title', '0%').find('.g-file-progress-text').text('0%').attribute('title', '0%');

            }).on('uploadprogress', function(file, progress, bytesSent) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.progresser({ value: progress / 100 });
                element.attribute('title', Math.round(progress) + '%').find('.g-file-progress-text').text(Math.round(progress) + '%').attribute('title', Math.round(progress) + '%');

            }).on('complete', function(file) {
                self.refreshFiles(content);
            }).on('error', function(file, error) {
                var element  = $(file.previewElement),
                    uploader = element.find('[data-file-uploadprogress]'),
                    text     = element.find('.g-file-progress-text'),
                    isList   = files.hasClass('g-filemode-list');

                element.addClass('g-file-error');

                uploader.title('Error').progresser({
                    fill: {
                        color: colors.error,
                        gradient: false
                    },
                    value: 1,
                    thickness: isList ? 10 : 25
                });

                text.title('Error').html('<i class="fa fa-exclamation"></i>').parent('[data-file-uploadprogress]').popover({
                    content: error.html ? error.html : (error.error && error.error.message ? error.error.message : error),
                    placement: 'auto',
                    trigger: 'mouse',
                    style: 'filepicker, above-modal',
                    width: 'auto',
                    targetEvents: false
                });

            }).on('success', function(file, response, xhr) {
                var element  = $(file.previewElement),
                    uploader = element.find('[data-file-uploadprogress]'),
                    mtime    = element.find('.g-file-mtime'),
                    text     = element.find('.g-file-progress-text'),
                    thumb    = element.find('.g-thumb'),
                    isList   = files.hasClass('g-filemode-list');

                uploader.progresser({
                    fill: {
                        color: colors.success,
                        gradient: false
                    },
                    value: 1,
                    thickness: isList ? 10 : 25
                });

                text.html('<i class="fa fa-check"></i>');

                setTimeout(bind(function() {
                    uploader.animate({ opacity: 0 }, { duration: 500 });
                    thumb.animate({ opacity: 1 }, {
                        duration: 500,
                        callback: function() {
                            element.data('file', JSON.stringify(response.finfo)).data('file-url', response.url).removeClass('g-file-uploading');
                            element.dropzone = file;
                            uploader.remove();
                            mtime.text(translate('GANTRY5_PLATFORM_JUST_NOW'));
                        }
                    });
                }, this), 500);
            });
        }

        // g5 events
        content.delegate('click', '.g-bookmark-title', function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var sibling = element.nextSibling('.g-folders'),
                parent  = element.parent('.g-bookmark');

            if (!sibling) { return; }
            sibling.slideToggle(function() {
                parent.toggleClass('collapsed', sibling.gSlideCollapsed);
            });
        });

        content.delegate('click', '[data-folder]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var data     = JSON.parse(element.data('folder')),
                selected = $('[data-file].selected');

            fieldData.root = data.pathname;
            fieldData.value = selected ? selected.data('file-url') : false;
            fieldData.subfolder = true;

            element.showIndicator('fa fa-li fa-fw fa-spin-fast fa-spinner');
            request(parseAjaxURI(getAjaxURL('filepicker') + getAjaxSuffix()), fieldData).send(bind(function(error, response) {
                element.hideIndicator();
                this.addActiveState(element);

                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });
                } else {
                    var dummy, next;
                    if (response.body.subfolder) {
                        dummy = zen('div').html(response.body.subfolder);
                        next = element.nextSibling();

                        if (next && !next.attribute('data-folder')) { next.remove(); }
                        dummy.children().after(element);
                    }

                    if (response.body.files) {
                        files.empty();
                        dummy = zen('div').html(response.body.files);
                        dummy.children().bottom(files).style({ opacity: 0 }).animate({ opacity: 1 }, { duration: '250ms' });
                    } else {
                        files.find('> ul:not(.g-list-labels)').empty();
                    }

                    this.dropzone.previewsContainer = files.find('ul:not(.g-list-labels)')[0];
                }
            }, this));
        }, this));

        content.delegate('click', '[data-g-file-preview]', bind(function(event, element) {
            event.preventDefault();
            event.stopPropagation();
            var parent    = element.parent('[data-file]'),
                data      = JSON.parse(parent.data('file'));

            if (data.isImage) {
                var thumb = parent.find('.g-thumb > div');
                modal.open({
                    className: 'g5-dialog-theme-default g5-modal-filepreview center',
                    content: '<img src="' + thumb[0].style.backgroundImage.slice(4, -1).replace(/"/g, '') + '" />'
                });
            }
        }, this));

        content.delegate('click', '[data-g-file-delete]', bind(function(event, element) {
            event.preventDefault();
            var parent    = element.parent('[data-file]'),
                data      = JSON.parse(parent.data('file')),
                deleteURI = parseAjaxURI(getAjaxURL('filepicker/' + global.btoa(encodeURIComponent(data.pathname)) + getAjaxSuffix()));

            if (!data.isInCustom) { return false; }

            request('delete', deleteURI, function(error, response) {
                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });
                } else {
                    parent.addClass('g-file-deleted');
                    setTimeout(function() {
                        parent.remove();

                        self.refreshFiles(content);
                    }, 210);
                }
            });
        }, this));

        content.delegate('click', '[data-file]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var target = $(event.target),
                remove = target.data('g-file-delete') !== null || target.parent('[data-g-file-delete]'),
                preview = target.data('g-file-preview') !== null || target.parent('[data-g-file-preview]');

            if (element.hasClass('g-file-error') || element.hasClass('g-file-uploading') || remove || preview) { return; }
            var data = JSON.parse(element.data('file'));

            files.search('[data-file]').removeClass('selected');
            element.addClass('selected');
        }, this));

        content.delegate('click', '[data-select]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var selected = files.find('[data-file].selected'),
                value    = selected ? selected.data('file-url') : '';

            $(this.data.field).value(value);
            modal.close();
        }, this));

        content.delegate('click', '[data-files-mode]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            if (element.hasClass('active')) { return; }

            var modes = $('[data-files-mode]');
            modes.removeClass('active');
            element.addClass('active');

            files.animate({ opacity: 0 }, {
                duration: 200,
                callback: function() {
                    var mode           = element.data('files-mode'),
                        uploadProgress = files.search('[data-file-uploadprogress]'),
                        progressConf   = (mode == 'list') ? {
                            size: 20,
                            thickness: 10,
                            fill: {
                                color: colors.small,
                                gradient: false
                            }
                        } : {
                            size: 50,
                            thickness: 'auto',
                            fill: {
                                gradient: colors.gradient,
                                color: false
                            }
                        };


                    files.attribute('class', 'g-files g-block g-filemode-' + mode);
                    if (uploadProgress) {
                        uploadProgress.forEach(function(element) {
                            element = $(element);
                            var config = deepClone(progressConf);

                            if (element.parent('.g-file-error')) {
                                config.fill = { color: colors.error };
                                config.value = 1;
                                config.thickness = mode == 'list' ? 10 : 25;
                            }

                            element.progresser(config);
                        });
                    }
                    files.animate({ opacity: 1 }, { duration: 200 });
                }
            });

        }, this));
    },

    addActiveState: function(element) {
        var opened = this.content.search('[data-folder].active, .g-folders > .active'), parent = element.parent();
        if (opened) { opened.removeClass('active'); }

        element.addClass('active');

        while (parent.tag() == 'ul' && !parent.hasClass('g-folders')) {
            parent.previousSibling().addClass('active');
            parent = parent.parent();
        }
    },

    acceptedFiles: function(filter) {
        var attr = '';
        switch (filter) {
            case '.(jpe?g|gif|png|svg)$':
                attr = '.jpg,.jpeg,.gif,.png,.svg';
                break;
            case '.(mp4|webm|ogv|mov)$':
                attr = '.mp4,.webm,.ogv,.mov';
                break;
        }

        return attr;
    },

    refreshFiles: function(content) {
        var active = $('[data-folder].active'),
            folder = active[active.length - 1];
        if (folder) {
            content.emit('click', { target: $(folder) });
        }
    }
});

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-filepicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);
        if (!element.GantryFilePicker) {
            element.GantryFilePicker = new FilePicker(element);
        }

        element.GantryFilePicker.open();
    });
});


module.exports = FilePicker;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../ui":53,"../../utils/elements.utils":64,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/translate":76,"agent":78,"dropzone":105,"elements/domready":109,"elements/zen":135,"mout/function/bind":190,"mout/lang/deepClone":198,"mout/object/deepFillIn":223,"mout/string/rtrim":268,"prime":299}],40:[function(require,module,exports){
"use strict";
// fonts list: https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyB2yJM8DBwt66u2MVRgb6M4t9CqkW7_IRY
var prime         = require('prime'),
    $             = require('../../utils/elements.utils'),
    zen           = require('elements/zen'),
    storage       = require('prime/map')(),
    Emitter       = require('prime/emitter'),
    Bound         = require('prime-util/prime/bound'),
    Options       = require('prime-util/prime/options'),
    domready      = require('elements/domready'),

    decouple      = require('../../utils/decouple'),

    bind          = require('mout/function/bind'),
    map           = require('mout/array/map'),
    forEach       = require('mout/array/forEach'),
    contains      = require('mout/array/contains'),
    last          = require('mout/array/last'),
    split         = require('mout/array/split'),
    removeAll     = require('mout/array/removeAll'),
    insert        = require('mout/array/insert'),
    append        = require('mout/array/append'),
    find          = require('mout/array/find'),
    combine       = require('mout/array/combine'),
    intersection  = require('mout/array/intersection'),
    merge         = require('mout/object/merge'),

    unhyphenate   = require('mout/string/unhyphenate'),
    properCase    = require('mout/string/properCase'),
    trim          = require('mout/string/trim'),
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../../utils/get-ajax-url').parse,
    getAjaxURL    = require('../../utils/get-ajax-url').global,

    modal         = require('../../ui').modal,
    asyncForEach  = require('../../utils/async-foreach'),
    translate     = require('../../utils/translate'),

    request       = require('agent'),

    wf            = require('webfontloader');

require('../../utils/elements.viewport');

var isIE = function() {
    var ua = window.navigator.userAgent;
    return ua.indexOf('MSIE ') > 0 || ua.indexOf('Trident/') > 0 || ua.indexOf('Edge/') > 0 || false;
};

var Fonts = new prime({

    mixin: Bound,

    inherits: Emitter,

    previewSentence: {
        'latin': 'Wizard boy Jack loves the grumpy Queen\'s fox.',
        'latin-ext': 'Wizard boy Jack loves the grumpy Queen\'s fox.',
        'arabic': 'نص حكيم له سر قاطع وذو شأن عظيم مكتوب على ثوب أخضر ومغلف بجلد أزرق',
        'cyrillic': 'В чащах юга жил бы цитрус? Да, но фальшивый экземпляр!',
        'cyrillic-ext': 'В чащах юга жил бы цитрус? Да, но фальшивый экземпляр!',
        'devanagari': 'एक पल का क्रोध आपका भविष्य बिगाड सकता है',
        'greek': 'Τάχιστη αλώπηξ βαφής ψημένη γη, δρασκελίζει υπέρ νωθρού κυνός',
        'greek-ext': 'Τάχιστη αλώπηξ βαφής ψημένη γη, δρασκελίζει υπέρ νωθρού κυνός',
        'hebrew': 'דג סקרן שט בים מאוכזב ולפתע מצא חברה',
        'khmer': 'ខ្ញុំអាចញ៉ាំកញ្ចក់បាន ដោយគ្មានបញ្ហា',
        'telugu': 'దేశ భాషలందు తెలుగు లెస్స',
        'vietnamese': 'Tôi có thể ăn thủy tinh mà không hại gì.'
    },

    constructor: function() {
        this.wf = wf;
        this.field = null;
        this.element = null;
        this.throttle = false;
        this.selected = null;
        this.loadedFonts = [];
        this.filters = {
            search: '',
            script: 'latin',
            categories: []
        };
    },

    open: function(event, element) {
        var data = element.data('g5-fontpicker');
        if (!data) {
            throw new Error('No fontpicker data found');
        }

        data = JSON.parse(data);
        this.field = $(data.field);

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            className: 'g5-dialog-theme-default g5-modal-fonts',
            remote: parseAjaxURI(getAjaxURL('fontpicker') + getAjaxSuffix()),
            remoteLoaded: bind(function(response, content) {
                var container = content.elements.content;

                this.attachEvents(container);
                this.updateCategories(container);

                this.search();

                this.scroll(container.find('ul.g-fonts-list'));
                this.updateTotal();
                this.selectFromValue();

                setTimeout(function() {
                    container.find('.particle-search-wrapper input')[0].focus();
                }, 5);
            }, this)
        });
    },

    scroll: function(container) {
        clearTimeout(this.throttle);
        this.throttle = setTimeout(bind(function() {
            if (!container) {
                clearTimeout(this.throttle);
                return;
            }

            // 550 = container height, 5 = pages
            var elements = (container.find('ul.g-fonts-list') || container).inviewport(' > li:not(.g-font-hide)', (550 * (isIE() ? 2 : 7))),
                list     = [];

            if (!elements) { return; }

            $(elements).forEach(function(element) {
                element = $(element);
                var dataFont = element.data('font'),
                    variant  = element.data('variant');

                if (!contains(this.loadedFonts, dataFont) && variant) {
                    list.push(dataFont + (variant != 'regular' ? ':' + variant : ''));
                }
                else {
                    if (variant) {
                        element.find('[data-variant="' + variant + '"] .preview').style({
                            fontFamily: dataFont,
                            fontWeight: variant == 'regular' ? 'normal' : variant
                        });
                    }
                }
            }, this);

            if (!list || !list.length) { return; }

            this.wf.load({
                classes: false,
                google: {
                    families: list
                },
                fontactive: bind(function(family, fvd) {
                    container.find('li[data-font="' + family + '"]:not(.g-variant-hide) > .preview').style({
                        fontFamily: family,
                        fontWeight: fvd
                    });
                    this.loadedFonts.push(family);
                }, this)
            });
        }, this), 100);
    },

    unselect: function(selected) {
        selected = selected || this.selected;
        if (!selected) { return false; }

        var baseVariant = selected.element.data('variant');
        selected.element.removeClass('selected');
        selected.element.search('input[type=checkbox]').checked(false);
        selected.element.search('[data-font]').addClass('g-variant-hide');
        selected.element.find('[data-variant="' + baseVariant + '"]').removeClass('g-variant-hide');
        selected.variants = [selected.baseVariant];
        selected.selected = [];
    },

    selectFromValue: function() {
        var value = this.field.value(), name, variants, subset, isLocal = false;

        if (!value.match('family=')) {
            var locals = $('[data-category="local-fonts"][data-font]') || [], intersect;
            locals = locals.map(function(l) { return $(l).data('font'); });
            value = value.replace(/(\s{1,})?,(\s{1,})?/gi, ',').split(',');
            intersect = intersection(locals, value);
            if (!intersect.length) { return false; }

            isLocal = true;
            name = intersect.shift();
        } else {
            var split  = value.split('&'),
                family = split[0],
                split2 = family.split(':');

            name = split2[0].replace('family=', '').replace(/\+/g, ' ');
            variants = split2[1] ? split2[1].split(',') : ['regular'];
            subset = split[1] ? split[1].replace('subset=', '').split(',') : ['latin'];
        }

        var noConflict = isLocal ? '[data-category="local-fonts"]' : ':not([data-category="local-fonts"])',
            element = $('ul.g-fonts-list > [data-font="' + name + '"]' + noConflict);
        variants = variants || element.data('variants').split(',') || ['regular'];

        if (contains(variants, '400')) {
            removeAll(variants, '400');
            insert(variants, 'regular');
        }

        if (contains(variants, '400italic')) {
            removeAll(variants, '400italic');
            insert(variants, 'italic');
        }

        this.selected = {
            font: name,
            baseVariant: element.data('variant'),
            element: element,
            variants: variants,
            selected: [],
            local: isLocal,
            charsets: subset,
            availableVariants: element.data('variants').split(','),
            expanded: isLocal,
            loaded: isLocal
        };

        (isLocal ? [name] : variants).forEach(function(variant) {
            this.select(element, variant);
            variant = element.find('> ul > [data-variant="' + variant + '"]');
            if (variant) { variant.removeClass('g-variant-hide'); }
        }, this);

        var charsetSelected = element.find('.font-charsets-selected');
        if (charsetSelected) {
            var subsetsLength = element.data('subsets').split(',').length;
            charsetSelected.html('(<i class="fa fa-fw fa-check-square-o"></i>  <span class="font-charsets-details">' + subset.length + ' of ' + subsetsLength + '</span> selected)');
        }

        if (!isLocal) { $('ul.g-fonts-list')[0].scrollTop = element[0].offsetTop; }

        this.toggleExpansion();
        setTimeout(bind(function() { this.toggleExpansion(); }, this), 50);
        if (!isLocal) { setTimeout(bind(function() { $('ul.g-fonts-list')[0].scrollTop = element[0].offsetTop; }, this, 250)); }
    },

    select: function(element, variant/*, target*/) {
        var baseVariant = element.data('variant'),
            isLocal     = !baseVariant;

        if (!this.selected || this.selected.element != element) {
            if (variant && this.selected) {
                var charsetSelected = this.selected.element.find('.font-charsets-selected');
                if (charsetSelected) {
                    var subsetsLength = element.data('subsets').split(',').length;
                    charsetSelected.html('(<i class="fa fa-fw fa-check-square-o"></i>  <span class="font-charsets-details">1 of ' + subsetsLength + '</span> selected)');
                }
            }
            this.selected = {
                font: element.data('font'),
                baseVariant: baseVariant,
                element: element,
                variants: [baseVariant],
                selected: [],
                local: isLocal,
                charsets: ['latin'],
                availableVariants: element.data('variants').split(','),
                expanded: isLocal,
                loaded: isLocal
            };
        }

        if (!variant) {
            this.toggleExpansion();
        }


        if (variant || isLocal) {
            var selected = ($('ul.g-fonts-list > [data-font]:not([data-font="' + this.selected.font + '"]) input[type="checkbox"]:checked'));
            if (selected) {
                selected.checked(false);
                selected.parent('[data-variants]').removeClass('font-selected');
            }
            var checkbox = this.selected.element.find('input[type="checkbox"][value="' + (isLocal ? this.selected.font : variant) + '"]'),
                checked  = checkbox.checked();
            if (checkbox) {
                checkbox.checked(!checked);
            }

            if (!checked) {
                insert(this.selected.variants, variant);
                insert(this.selected.selected, variant);
            } else {
                if (variant != this.selected.baseVariant) { removeAll(this.selected.variants, variant); }
                removeAll(this.selected.selected, variant);
            }

            this.updateSelection();
        }
    },

    toggleExpansion: function() {
        if (this.selected.availableVariants.length <= 1) { return; }
        if (this.selected.local) {
            this.selected.expanded = true;
            return;
        }

        if (!this.selected.expanded) {
            var variants = this.selected.element.data('variants'), variant;
            if (variants.split(',').length > 1) {
                this.manipulateLink(this.selected.font);
                this.selected.element.search('[data-font]').removeClass('g-variant-hide');

                if (!this.selected.loaded) {
                    this.wf.load({
                        classes: false,
                        google: {
                            families: [this.selected.font.replace(/\s/g, '+') + ':' + variants]
                        },
                        fontactive: bind(function(family, fvd) {
                            var style  = this.fvdToStyle(family, fvd),
                                search = style.fontWeight;

                            if (search == '400') {
                                search = style.fontStyle == 'normal' ? 'regular' : 'italic';
                            } else if (style.fontStyle == 'italic') {
                                search += 'italic';
                            }

                            this.selected.element.find('li[data-variant="' + search + '"] .preview').style(style);
                            this.selected.loaded = true;
                        }, this)
                    });
                }
            }
        } else {
            var exclude = ':not([data-variant="' + this.selected.variants.join('"]):not([data-variant="') + '"])';
            exclude = this.selected.element.search('[data-font]' + exclude);
            if (exclude) { exclude.addClass('g-variant-hide'); }
        }

        this.selected.expanded = !this.selected.expanded;
    },

    manipulateLink: function(family) {
        family = family.replace(/\s/g, '+');
        var link = $('head link[href*="' + family + '"]');
        if (!link) { return; }

        var parts = decodeURIComponent(link.href()).split('|');
        if (!parts || parts.length <= 1) { return; }

        removeAll(parts, family);

        link.attribute('href', encodeURI(parts.join('|')));
    },

    toggle: function(event, element) {
        element = $(element);
        var target = $(event.target);

        if (target.attribute('type') == 'checkbox') {
            target.checked(!target.checked());
        }

        this.select(element.parent('[data-font]') || element, element.parent('[data-font]') ? element.data('variant') : false, element);

        return false;
    },

    updateSelection: function() {
        var preview = $('.g-particles-footer .font-selected'), selected, variants;
        if (!preview) { return; }

        if (!this.selected.selected.length) {
            preview.empty();
            this.selected.element.removeClass('font-selected');
            return;
        }

        selected = this.selected.selected.sort();
        variants = this.selected.local ? '(<small>local</small>)' : '(<small>' + selected.join(', ').replace('regular', 'normal') + '</small>)';
        this.selected.element.addClass('font-selected');
        preview.html('<strong>' + this.selected.font + '</strong> ' + variants);
    },

    updateTotal: function() {
        var totals = $('.g-particles-header .particle-search-total'),
            count  = $('.g-fonts-list > [data-font]:not(.g-font-hide)');

        totals.text(count ? count.length : 0);
    },

    updateCategories: function(container) {
        var categories = container.find('[data-font-categories]');
        if (!categories) { return; }

        this.filters.categories = categories.data('font-categories').split(',');
    },

    attachEvents: function(container) {
        var header  = container.find('.g-particles-header'),
            list    = container.find('.g-fonts-list'),
            search  = header.find('input.font-search'),
            preview = header.find('input.font-preview');

        decouple(list, 'scroll', bind(this.scroll, this, list));
        container.delegate('click', '.g-fonts-list li[data-font]', bind(this.toggle, this));

        if (search) { search.on('keyup', bind(this.search, this, search)); }
        if (preview) { preview.on('keyup', bind(this.updatePreview, this, preview)); }

        this.attachCharsets(container);
        this.attachLocalVariants(container);
        this.attachFooter(container);
    },

    attachCharsets: function(container) {
        container.delegate('mouseover', '.font-charsets-selected', bind(function(event, element) {
            if (!element.PopoverDefined) {
                var popover = element.getPopover({
                    placement: 'auto',
                    width: '200',
                    trigger: 'mouse',
                    style: 'font-categories, above-modal'
                });

                element.on('beforeshow.popover', bind(function(popover) {
                    var subsets = element.parent('[data-subsets]').data('subsets').split(','),
                        content = popover.$target.find('.g5-popover-content'),
                        checked;

                    content.empty();

                    var div, current;
                    subsets.forEach(function(cs) {
                        current = contains(this.selected.charsets, cs) ? (cs == 'latin' ? 'checked disabled' : 'checked') : '';
                        zen('div').html('<label><input type="checkbox" ' + current + ' value="' + cs + '"/> ' + properCase(unhyphenate(cs.replace('ext', 'extended'))) + '</label>').bottom(content);
                    }, this);

                    content.delegate('click', 'input[type="checkbox"]', bind(function(event, input) {
                        input = $(input);
                        checked = content.search('input[type="checkbox"]:checked');
                        this.selected.charsets = checked ? checked.map('value') : [];

                        element.html('(<i class="fa fa-fw fa-check-square-o"></i>  <span class="font-charsets-details">' + this.selected.charsets.length + ' of ' + subsets.length + '</span> selected)');
                    }, this));

                    popover.displayContent();
                }, this));

                element.getPopover().show();
            }
        }, this));
    },

    attachLocalVariants: function(container) {
        container.delegate('mouseover', '.g-font-variants-list', bind(function(event, element) {
            if (!element.PopoverDefined) {
                var popover = element.getPopover({
                    placement: 'auto',
                    width: '200',
                    trigger: 'mouse',
                    style: 'font-categories, above-modal'
                });

                element.on('beforeshow.popover', bind(function(popover) {
                    var content  = popover.$target.find('.g5-popover-content'),
                        variants = element.parent('[data-variants]').data('variants').split(',');

                    content.empty();

                    asyncForEach(variants, bind(function(variant) {
                        variant = variant == '400' ? 'regular' : (variant == '400italic' ? 'italic' : variant + '');
                        zen('div').text(this.mapVariant(variant)).bottom(content);
                    }, this));

                    popover.displayContent();
                }, this));
            }
        }, this));
    },

    attachFooter: function(container) {
        var footer     = container.find('.g-particles-footer'),
            select     = footer.find('button.button-primary'),
            categories = footer.find('.font-category'),
            subsets    = footer.find('.font-subsets'),
            current;

        select.on('click', bind(function() {
            if (!$('ul.g-fonts-list > [data-font] input[type="checkbox"]:checked')) {
                this.field.value('');
                modal.close();
                return;
            }

            var name      = this.selected.font.replace(/\s/g, '+'),
                variation = this.selected.selected,
                charset   = this.selected.charsets;

            if (variation && variation.length == 1 && variation[0] == 'regular') { variation = []; }
            if (charset && charset.length == 1 && charset[0] == 'latin') { charset = []; }

            if (contains(variation, 'regular')) {
                removeAll(variation, 'regular');
                insert(variation, '400');
            }
            if (contains(variation, 'italic')) {
                removeAll(variation, 'italic');
                insert(variation, '400italic');
            }

            if (!this.selected.local) {
                this.field.value('family=' + name + (variation.length ? ':' + variation.join(',') : '') + (charset.length ? '&subset=' + charset.join(',') : ''));
            } else {
                this.field.value(name);
            }

            this.field.emit('input');
            $('body').emit('input', { target: this.field });

            modal.close();
        }, this));

        categories.popover({
            placement: 'top',
            width: '200',
            trigger: 'mouse',
            style: 'font-categories, above-modal'
        }).on('beforeshow.popover', bind(function(popover) {
            var cats    = categories.data('font-categories').split(','),
                content = popover.$target.find('.g5-popover-content'),
                checked;

            content.empty();

            cats.forEach(function(category) {
                if (category == 'local-fonts') { return; }
                current = contains(this.filters.categories, category) ? 'checked' : '';
                zen('div').html('<label><input type="checkbox" ' + current + ' value="' + category + '"/> ' + properCase(unhyphenate(category)) + '</label>').bottom(content);
            }, this);

            content.delegate('click', 'input[type="checkbox"]', bind(function(event, input) {
                input = $(input);
                checked = content.search('input[type="checkbox"]:checked');
                this.filters.categories = checked ? checked.map('value') : [];
                categories.find('small').text(this.filters.categories.length);
                this.search();
            }, this));

            popover.displayContent();
        }, this));

        subsets.popover({
            placement: 'top',
            width: '200',
            trigger: 'mouse',
            style: 'font-subsets, above-modal'
        }).on('beforeshow.popover', bind(function(popover) {
            var subs    = subsets.data('font-subsets').split(','),
                content = popover.$target.find('.g5-popover-content');

            content.empty();

            var div;
            subs.forEach(function(sub) {
                current = sub == this.filters.script ? 'checked' : '';
                zen('div').html('<label><input name="font-subset[]" type="radio" ' + current + ' value="' + sub + '"/> ' + properCase(unhyphenate(sub.replace('ext', 'extended'))) + '</label>').bottom(content);
            }, this);

            content.delegate('change', 'input[type="radio"]', bind(function(event, input) {
                input = $(input);
                this.filters.script = input.value();
                $('.g-particles-header input.font-preview').value(this.previewSentence[this.filters.script]);
                subsets.find('small').text(properCase(unhyphenate(input.value().replace('ext', 'extended'))));
                this.search();
                this.updatePreview();
            }, this));

            popover.displayContent();
        }, this));

        return container;
    },

    search: function(input) {
        input = input || $('.g-particles-header input.font-search');
        var list  = $('.g-fonts-list'),
            value = input.value(),
            name, subsets, category, data;

        list.search('> [data-font]').forEach(function(font) {
            font = $(font);
            name = font.data('font');
            subsets = font.data('subsets').split(',');
            category = font.data('category');
            font.removeClass('g-font-hide');

            // We dont want to hide selected fonts
            if (this.selected && this.selected.font == name && this.selected.selected.length) { return; }

            // Filter by Subset
            if (!contains(subsets, this.filters.script)) {
                font.addClass('g-font-hide');
                return;
            }

            // Filter by Category
            if (!contains(this.filters.categories, category)) {
                font.addClass('g-font-hide');
                return;
            }

            // Filter by Name
            if (!name.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                font.addClass('g-font-hide');
            } else {
                font.removeClass('g-font-hide');
            }
        }, this);

        this.updateTotal();

        clearTimeout(input.refreshTimer);

        input.refreshTimer = setTimeout(bind(function() {
            this.scroll($('ul.g-fonts-list'));
        }, this), 400);

        input.previousValue = value;
    },

    updatePreview: function(input) {
        input = input || $('.g-particles-header input.font-preview');

        clearTimeout(input.refreshTimer);

        var value = input.value(),
            list  = $('.g-fonts-list');

        value = trim(value) ? trim(value) : this.previewSentence[this.filters.script];

        if (input.previousValue == value) { return true; }

        list.search('[data-font] .preview').text(value);

        input.previousValue = value;
    },

    fvdToStyle: function(family, fvd) {
        var match = fvd.match(/([a-z])([0-9])/);
        if (!match) return '';

        var styleMap = {
            n: 'normal',
            i: 'italic',
            o: 'oblique'
        };
        return {
            fontFamily: family,
            fontStyle: styleMap[match[1]],
            fontWeight: (match[2] * 100).toString()
        }
    },

    mapVariant: function(variant) {
        switch (variant) {
            case '100':
                return 'Thin 100';
                break;
            case '100italic':
                return 'Thin 100 Italic';
                break;
            case '200':
                return 'Extra-Light 200';
                break;
            case '200italic':
                return 'Extra-Light 200 Italic';
                break;
            case '300':
                return 'Light 300';
                break;
            case '300italic':
                return 'Light 300 Italic';
                break;
            case '400':
            case 'regular':
                return 'Normal 400';
                break;
            case '400italic':
            case 'italic':
                return 'Normal 400 Italic';
                break;
            case '500':
                return 'Medium 500';
                break;
            case '500italic':
                return 'Medium 500 Italic';
                break;
            case '600':
                return 'Semi-Bold 600';
                break;
            case '600italic':
                return 'Semi-Bold 600 Italic';
                break;
            case '700':
                return 'Bold 700';
                break;
            case '700italic':
                return 'Bold 700 Italic';
                break;
            case '800':
                return 'Extra-Bold 800';
                break;
            case '800italic':
                return 'Extra-Bold 800 Italic';
                break;
            case '900':
                return 'Ultra-Bold 900';
                break;
            case '900italic':
                return 'Ultra-Bold 900 Italic';
                break;
            default:
                return 'Unknown Variant';
        }
    }
});

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-fontpicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var FontPicker = storage.get(element);
        if (!FontPicker) {
            FontPicker = new Fonts();
            storage.set(element, FontPicker);
        }

        FontPicker.open(event, element);
    });
});

module.exports = Fonts;

},{"../../ui":53,"../../utils/async-foreach":62,"../../utils/decouple":63,"../../utils/elements.utils":64,"../../utils/elements.viewport":65,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/translate":76,"agent":78,"elements/domready":109,"elements/zen":135,"mout/array/append":162,"mout/array/combine":163,"mout/array/contains":164,"mout/array/find":169,"mout/array/forEach":172,"mout/array/insert":174,"mout/array/intersection":175,"mout/array/last":177,"mout/array/map":178,"mout/array/removeAll":180,"mout/array/split":183,"mout/function/bind":190,"mout/object/merge":235,"mout/string/properCase":262,"mout/string/trim":270,"mout/string/unhyphenate":273,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298,"prime/map":300,"webfontloader":315}],41:[function(require,module,exports){
"use strict";
var $             = require('../../utils/elements.utils'),
    domready      = require('elements/domready'),
    modal         = require('../../ui').modal,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../../utils/get-ajax-url').parse,
    getAjaxURL    = require('../../utils/get-ajax-url').global,
    translate     = require('../../utils/translate'),

    trim          = require('mout/string/trim'),
    contains      = require('mout/array/contains');

domready(function() {
    var body = $('body');
    body.delegate('keyup', '.g-icons input[type="text"]', function(event, element){
        element = $(element);
        var preview = element.sibling('[data-g5-iconpicker]') || element.siblings().find('[data-g5-iconpicker]'),
            value = element.value(),
            size;

        preview.find('i').attribute('class', value || 'fa fa-hand-o-up picker');

        size = preview[0].offsetWidth;

        if (!size) { preview.find('i').attribute('class', 'fa fa-hand-o-up picker'); }
    });

    body.delegate('click', '[data-g5-iconpicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);
        var field = $(element.data('g5-iconpicker')),
            realPreview = element,
            value = trim(field.value()).replace(/\s{2,}/g, ' ').split(' ');

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            className: 'g5-dialog-theme-default g5-modal-icons',
            remote: parseAjaxURI(getAjaxURL('icons') + getAjaxSuffix()),
            afterClose: function() {
                var popovers = $('.g5-popover');
                if (popovers) { popovers.remove(); }
            },
            remoteLoaded: function(response, content) {
                var html, large,
                    container = content.elements.content,
                    icons = container.search('[data-g-icon]');

                if (!icons || !response.body.success) {
                    container.html(response.body.html || response.body);
                    return false;
                }

                var updatePreview = function() {
                    var data = [],
                        active = container.find('[data-g-icon].active'),
                        options = container.search('.g-particles-header .float-right input:checked, .g-particles-header .float-right select');

                    if (active) { data.push(active.data('g-icon')); }
                    if (options) {
                        options.forEach(function(option) {
                            var v = $(option).value();
                            if (v && v !== 'fa-') { data.push(v); }
                        });
                    }

                    container.find('.g-icon-preview').html('<i class="fa ' + data.join(' ') + '"></i> <span>' + data[0] + '</span>');
                    container.find('[data-g-select]').disabled(container.find('[data-g-icon].active') ? null : true);
                };

                var updateTotal = function() {
                    var total = container.search('[data-g-icon]:not(.hide-icon)');
                    container.find('.particle-search-total').text(total ? total.length : 0);
                };

                container.find('[data-g-select]').disabled(container.find('[data-g-icon].active') ? null : true);

                container.delegate('click', '[data-g-icon]', function(event, element) {
                    if (event && event.preventDefault) { event.preventDefault(); }
                    element = $(element);

                    var active = container.find('[data-g-icon].active');
                    if (active) { active.removeClass('active'); }

                    element.addClass('active');
                    container.find('[data-g-select]').disabled(null);

                    updatePreview();
                });

                container.delegate('click', '[data-g-select]', function(event){
                    event.preventDefault();

                    if (!container.find('[data-g-icon].active')) { return false; }

                    var output = container.find('.g-icon-preview i');
                    field.value(output.attribute('class'));
                    realPreview.find('i').attribute('class', output.attribute('class'));

                    field.emit('input');

                    $('body').emit('input', {target: field});

                    modal.close();
                });

                container.delegate('change', '.g-particles-header .float-right input[type="checkbox"], .g-particles-header .float-right select', function(/*e, input*/) {
                    updatePreview();
                });

                container.delegate('keyup', '.particle-search-wrapper input[type="text"]', function(e, input) {
                    input = $(input);
                    var value = input.value(),
                        hidden = container.search('[data-g-icon].hide-icon');

                    if (!value) {
                        if (hidden) {
                            hidden.removeClass('hide-icon');
                            updateTotal();
                        }
                        return true;
                    }

                    var found = container.search('[data-g-icon*="' + value + '"]');
                    container.search('[data-g-icon]').addClass('hide-icon');
                    if (found) {
                        found.removeClass('hide-icon');
                    }

                    updateTotal();

                });

                icons.forEach(function(icon) {
                    icon = $(icon);
                    html = '';

                    for (var i = 5, l = 0; i > l; i--) {
                        large = (!i) ? 'lg' : i + 'x';
                        html += '<i class="fa ' + icon.data('g-icon') + ' fa-' + large + '"></i> ';
                    }

                    html += '<h3>' + icon.data('g-icon') + '</h3>';

                    icon.popover({
                        content: html,
                        placement: 'auto',
                        trigger: 'mouse',
                        style: 'above-modal, icons-preview',
                        width: 'auto',
                        targetEvents: false,
                        delay: 1
                    }).on('hidden.popover', function(instance) {
                        if (instance.$target) { instance.$target.remove(); }
                    });

                    if (contains(value, icon.data('g-icon'))) {
                        // set active icon
                        icon.addClass('active');

                        // toggle options
                        value.forEach(function(name) {
                            var field = container.find('[name="' + name + '"]');
                            if (field) { field.checked(true); }
                            else {
                                field = container.find('option[value="' + name + '"]');
                                if (field) { field.parent().value(name); }
                            }
                        });

                        // scroll into place of active icon
                        var wrap = icon.parent('.icons-wrapper'),
                            wrapHeight = wrap[0].offsetHeight;
                        wrap[0].scrollTop = icon[0].offsetTop - (wrapHeight / 2);

                        // update preview
                        updatePreview();
                    }
                });

                setTimeout(function() {
                    container.find('.particle-search-wrapper input')[0].focus();
                }, 5);
            }
        });
    });
});

module.exports = {};

},{"../../ui":53,"../../utils/elements.utils":64,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/translate":76,"elements/domready":109,"mout/array/contains":164,"mout/string/trim":270}],42:[function(require,module,exports){
"use strict";

module.exports = {
    colorpicker: require('./colorpicker'),
    fonts: require('./fonts'),
    menu: require('./menu'),
    icons: require('./icons'),
    filepicker: require('./filepicker'),
    collections: require('./collections'),
    keyvalue: require('./keyvalue'),
    instancepicker: require('./instancepicker')
};
},{"./collections":37,"./colorpicker":38,"./filepicker":39,"./fonts":40,"./icons":41,"./instancepicker":43,"./keyvalue":44,"./menu":45}],43:[function(require,module,exports){
"use strict";

var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    Submit        = require('../../fields/submit'),
    modal         = require('../../ui').modal,
    request       = require('agent'),
    trim          = require('mout/string/trim'),
    parseAjaxURI  = require('../../utils/get-ajax-url').parse,
    getAjaxURL    = require('../../utils/get-ajax-url').global,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    translate     = require('../../utils/translate');

var WordpressWidgetsCustomizer = require('../../utils/wp-widgets-customizer');

ready(function() {
    var body = $('body'),
        particleField = $('[data-g-instancepicker] ~ input[type="hidden"]'),
        moduleType = {
            wordpress: 'widget',
            joomla: 'module'
        };

    //if (particleField) {
        //particleField.on('change', function(){
        body.delegate('input', '[data-g-instancepicker] ~ input[type="hidden"]', function(event, element){
            if (!element.value()) {
                var title = element.siblings('.g-instancepicker-title'),
                    label = element.siblings('[data-g-instancepicker]'),
                    reset = element.sibling('.g-reset-field');

                title.text('');
                label.text(label.data('g-instancepicker-text'));
                reset.style('display', 'none');
            }
        });
    //}


    body.delegate('click', '[data-g-instancepicker]', function(event, element) {
        if (event) { event.preventDefault(); }

        var data = JSON.parse(element.data('g-instancepicker')),
            field = $('[name="' + data.field + '"]'),
            value, uri; // = 'particle' + ((data.type == moduleType[GANTRY_PLATFORM]) ? '/' + moduleType[GANTRY_PLATFORM] : ''),

        if (data.type == moduleType[GANTRY_PLATFORM]) {
            uri = (data.type != 'widget' ? 'particle/' : '') + moduleType[GANTRY_PLATFORM];
        } else {
            uri = 'particle';
        }

        if (!field) { return false; }

        value = field.value();

        if ((data.type == 'particle' || data.type == 'widget') && value) {
            value = JSON.parse(value || {});
            uri = value.type + '/' + value[data.type];
        }

        if (data.modal_close) { return true; }

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: !value || data.type == 'module' ? 'get' : 'post', // data.type == moduleType[GANTRY_PLATFORM]
            data: !value || data.type == 'module' ? {} : value, // data.type == moduleType[GANTRY_PLATFORM]
            overlayClickToClose: false,
            remote: parseAjaxURI(getAjaxURL(uri) + getAjaxSuffix()),
            remoteLoaded: function(response, modalInstance) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }

                var content = modalInstance.elements.content,
                    select = content.find('[data-mm-select]');

                var search = content.find('.search input'),
                    blocks = content.search('[data-mm-type]'),
                    filters = content.search('[data-mm-filter]');

                if (search && filters && blocks) {
                    search.on('input', function() {
                        if (!this.value()) {
                            blocks.removeClass('hidden');
                            return;
                        }

                        blocks.addClass('hidden');

                        var found = [], value = this.value().toLowerCase(), text;

                        filters.forEach(function(filter) {
                            filter = $(filter);
                            text = trim(filter.data('mm-filter')).toLowerCase();
                            if (text.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                                found.push(filter.matches('[data-mm-type]') ? filter : filter.parent('[data-mm-type]'));
                            }
                        }, this);

                        if (found.length) { $(found).removeClass('hidden'); }
                    });

                    setTimeout(function() {
                        search[0].focus();
                    }, 5);
                }

                var elementData = JSON.parse(element.data('g-instancepicker'));
                if (elementData.type == moduleType[GANTRY_PLATFORM]) { elementData.modal_close = true; }
                if (select) { select.data('g-instancepicker', JSON.stringify(elementData)); }
                else {
                    var form = content.find('form'),
                        fakeDOM = zen('div').html(response.body.html || response.body).find('form'),
                        submit = content.find('input[type="submit"], button[type="submit"]');

                    if ((!form && !fakeDOM) || !submit) { return true; }

                    var applyAndSave = content.search('[data-apply-and-save]');
                    if (applyAndSave) { applyAndSave.remove(); }

                    submit.on('click', function(e) {
                        e.preventDefault();

                        submit.showIndicator();

                        var post = Submit(fakeDOM[0].elements, content);

                        request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&') || {}, function(error, response) {
                            if (!response.body.success) {
                                modal.open({
                                    content: response.body.html || response.body,
                                    afterOpen: function(container) {
                                        if (!response.body.html) { container.style({ width: '90%' }); }
                                    }
                                });
                            } else {

                                var label = field.siblings('.g-instancepicker-title');

                                if (field) {
                                    field.value(JSON.stringify(response.body.item));
                                    $('body').emit('change', { target: field });
                                }

                                if (label) { label.text(response.body.item.title); }
                            }

                            modal.close();
                            submit.hideIndicator();

                            WordpressWidgetsCustomizer(field);
                        });
                    });

                }
            }
        });
    });
});

module.exports = {};

},{"../../fields/submit":8,"../../ui":53,"../../utils/get-ajax-suffix":68,"../../utils/get-ajax-url":69,"../../utils/translate":76,"../../utils/wp-widgets-customizer":77,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/string/trim":270}],44:[function(require,module,exports){
"use strict";

var ready         = require('elements/domready'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    has           = require('mout/object/has'),
    some          = require('mout/array/some'),
    modal         = require('../../ui').modal,
    toastr        = require('../../ui').toastr,
    request       = require('agent'),
    indexOf       = require('mout/array/indexOf'),
    contains      = require('mout/array/contains'),
    lastItem      = require('mout/array/last'),
    keys          = require('mout/object/keys'),
    simpleSort    = require('sortablejs'),
    escapeUnicode = require('mout/string/escapeUnicode'),

    trim          = require('mout/string/trim'),

    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    translate     = require('../../utils/translate');

require('elements/insertion');

ready(function() {
    var body = $('body');

    var createSortables = function(list) {
        var lists = list || $('.g-keyvalue-field ul');
        if (!lists) { return; }
        lists.forEach(function(list) {
            list = $(list);
            list.SimpleSort = simpleSort.create(list[0], {
                handle: '.fa-reorder',
                filter: '[data-keyvalue-nosort]',
                scroll: false,
                animation: 150,
                onStart: function() {
                    $(this.el).addClass('keyvalue-sorting');
                },
                onEnd: function(evt) {
                    var element = $(this.el);
                    element.removeClass('keyvalue-sorting');

                    if (evt.oldIndex === evt.newIndex) { return; }

                    var dataField = element.parent('.settings-param').find('[data-keyvalue-data]'),
                        data      = dataField.value();

                    data = JSON.parse(data);

                    data.splice(evt.newIndex, 0, data.splice(evt.oldIndex, 1)[0]);
                    dataField.value(JSON.stringify(data));
                    body.emit('change', { target: dataField });
                }
            });
        });
    };

    createSortables();

    // delegate sortables collections for ajax support
    body.delegate('mouseover', '.g-keyvalue-field ul', function(event, element) {
        if (!element.SimpleSort) { createSortables(element); }
    });

    // Add new item
    body.delegate('click', '[data-keyvalue-addnew]', function(event, element) {
        var param = element.parent('.settings-param'),
            list  = param.find('ul'),
            tmpl  = param.find('[data-keyvalue-template]'),
            items = list.search('> [data-keyvalue-item]') || [],
            last  = $(lastItem(items));

        var clone = $(tmpl[0].cloneNode(true));

        if (last) { clone.after(last); }
        else { clone.top(list); }

        clone.attribute('style', null).data('keyvalue-item', clone.data('keyvalue-template'));
        clone.attribute('data-keyvalue-template', null);
        clone.attribute('data-keyvalue-nosort', null);
        clone.find('[data-keyvalue-key]')[0].focus();

        //body.emit('change', { target: dataField });
    });

    // Remove item
    body.delegate('click', '[data-keyvalue-remove]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var item      = element.parent('[data-keyvalue-item]'),
            key       = item.find('input[type="text"]').data('keyvalue-key'),
            dataField = element.parent('.settings-param').find('[data-keyvalue-data]'),
            items     = element.parent('ul').search('> [data-keyvalue-item]'),
            index     = indexOf(items, item[0]),
            data      = JSON.parse(dataField.value());

        data.splice(index, 1);
        dataField.value(escapeUnicode(JSON.stringify(data)));
        item.remove();

        body.emit('change', { target: dataField });
    });

    // Change values
    body.delegate('blur', '[data-keyvalue-item] input[type="text"]', function(event, element) {
        var parent     = element.parent('[data-keyvalue-item]'),
            wrapper    = parent.find('.g-keyvalue-wrapper'),
            keyElement = parent.find('[data-keyvalue-key]'),
            valElement = parent.find('[data-keyvalue-value]'),
            key        = keyElement.data('keyvalue-key'),
            keyValue   = trim(keyElement.value()),
            valValue   = trim(valElement.value()),
            items      = element.parent('ul').search('> [data-keyvalue-item]:not(.g-keyvalue-warning):not(.g-keyvalue-excluded)'),
            index      = indexOf(items, parent[0]),

            dataField  = element.parent('.settings-param').find('[data-keyvalue-data]'),
            data       = JSON.parse(dataField.value()),
            exclude    = JSON.parse(dataField.data('keyvalue-exclude')),
            excluded   = contains(exclude, keyValue),
            duplicate  = some(data, function(obj) { return has(obj, keyValue); }) && key !== keyValue;

        if (keyElement == element) {
            // renamed or cleared key, need to cleanup JSON
            if (key !== keyValue && !duplicate) {
                data.splice(index, 1);
                keyElement.data('keyvalue-key', keyValue || '');
            }

            parent[duplicate ? 'addClass' : 'removeClass']('g-keyvalue-warning');
            parent[excluded ? 'addClass' : 'removeClass']('g-keyvalue-excluded');

            wrapper
                .data('tip', duplicate ? translate('GANTRY5_PLATFORM_JS_KEYVALUE_DUPLICATE', keyValue) : (excluded ? translate('GANTRY5_PLATFORM_JS_KEYVALUE_EXCLUDED', keyValue) : null))
                .data('tip-place', 'top-right')
                .data('tip-spacing', 2)
                .data('tip-offset', 8);

            if (excluded || duplicate) {
                window.G5.tips.get(wrapper[0]).show();
            } else {
                window.G5.tips.remove(wrapper[0]);
            }
        }

        if (keyValue && !excluded && !duplicate) {
            if (!data[index]) { data.splice(index, 0, {}); }
            data[index][keyValue] = valValue;
        }

        dataField.value(escapeUnicode(JSON.stringify(data)));
        body.emit('change', { target: dataField });

    }, true);

    body.delegate('update', '[data-keyvalue-data]', function(event, element) {
        var parent = element.parent(),
            items  = parent.search('[data-keyvalue-item]'),
            list   = parent.find('ul'),
            data   = JSON.parse(element.value()),
            tmpl   = parent.find('[data-keyvalue-template]');

        if (items) { items.remove(); }

        data.forEach(function(obj, index) {
            var clone = $(tmpl[0].cloneNode(true)),
                key   = keys(obj).shift(),
                value = obj[key];

            list.appendChild(clone);

            clone.attribute('style', null).data('keyvalue-item', clone.data('keyvalue-template'));
            clone.attribute('data-keyvalue-template', null);
            clone.attribute('data-keyvalue-nosort', null);
            clone.find('[data-keyvalue-key]').value(key);
            clone.find('[data-keyvalue-value]').value(value);
        });
    });

});

module.exports = {};

},{"../../ui":53,"../../utils/get-ajax-suffix":68,"../../utils/translate":76,"agent":78,"elements":111,"elements/domready":109,"elements/insertion":112,"elements/zen":135,"mout/array/contains":164,"mout/array/indexOf":173,"mout/array/last":177,"mout/array/some":182,"mout/object/has":232,"mout/object/keys":234,"mout/string/escapeUnicode":258,"mout/string/trim":270,"sortablejs":314}],45:[function(require,module,exports){
"use strict";
var $             = require('../../utils/elements.utils'),
    domready      = require('elements/domready');

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-content] .g-main-nav .g-toplevel [data-g5-ajaxify]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var items = $('[data-g5-content] .g-main-nav .g-toplevel [data-g5-ajaxify] !> li');
        if (items) { items.removeClass('active'); }
        element.parent('li').addClass('active');
    });
});

module.exports = {};
},{"../../utils/elements.utils":64,"elements/domready":109}],46:[function(require,module,exports){
"use strict";

var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    trim          = require('mout/string/trim'),
    keys          = require('mout/object/keys'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    request       = require('agent'),
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,

    Eraser        = require('../ui/eraser'),
    simpleSort    = require('sortablejs'),

    flags         = require('../utils/flags-state');


var PositionsField = '[name="page[head][atoms][_json]"]',
    groupOptions   = [
        { name: 'positions', pull: true, put: true },
        { name: 'positions', pull: false, put: false }
    ];

var Positions = {
    eraser: null,
    lists: [],

    serialize: function(position) {
        var data,
            output = [],
            positions  = $(position) || $('[data-position]');

        if (!positions) {
            return '[]';
        }

        positions.forEach(function(position) {
            position = $(position);
            data = JSON.parse(position.data('position'));
            data.modules = [];

            // collect positions items
            (position.search('[data-pm-data]') || []).forEach(function(item) {
                item = $(item);
                data.modules.push(JSON.parse(item.data('pm-data') || '{}'));
            });

            output.push(data);
            position.data('position', JSON.stringify(data));
        });

        return JSON.stringify(output).replace(/\//g, '\\/');
    },

    attachEraser: function() {
        if (Positions.eraser) {
            Positions.eraser.element = $('[data-positions-erase]');
            Positions.eraser.hide('fast');
            return;
        }

        Positions.eraser = new Eraser('[data-positions-erase]');
    },

    createSortables: function(element) {
        var list, sort;

        Positions.attachEraser();

        groupOptions.forEach(function(groupOption, i) {
            list = !i ? '[data-position] ul' : '#trash';
            list = $(list);

            list.forEach(function(element, listIndex){
                sort = simpleSort.create(element, {
                    sort: !i,
                    filter: '[data-position-ignore]',
                    group: groupOption,
                    scroll: true,
                    forceFallback: true,
                    animation: 100,

                    onStart: function(event) {
                        Positions.attachEraser();

                        var item = $(event.item);
                        item.addClass('position-dragging');

                        Positions.eraser.show();
                    },

                    onEnd: function(event) {
                        var item       = $(event.item),
                            trash      = $('#trash'),
                            target     = $(this.originalEvent.target),
                            touchTrash = false;

                        // workaround for touch devices
                        if (this.originalEvent.type === 'touchend') {
                            var trashSize = trash[0].getBoundingClientRect(),
                                oE        = this.originalEvent,
                                position  = (oE.pageY || oE.changedTouches[0].pageY) - window.scrollY;

                            touchTrash = position <= trashSize.height;
                        }

                        if (target.matches('#trash') || target.parent('#trash') || touchTrash) {
                            item.remove();
                            Positions.eraser.hide();
                            this.options.onSort(event);
                            return;
                        }

                        item.removeClass('position-dragging');

                        Positions.eraser.hide();
                    },

                    onSort: function(event) {
                        var from = $(event.from),
                            to = $(event.to),
                            lists = [from.parent('[data-position]'), to.parent('[data-position]')];

                        if (event.from[0] === event.to[0]) {
                            lists.shift();
                        }

                        Positions.serialize(lists);
                    },

                    onOver: function(event) {
                        if (!$(event.from).matches('ul')) { return; }

                        var over = $(event.newIndex);
                        if (over.matches('#trash') || over.parent('#trash')) {
                            Positions.eraser.over();
                        } else {
                            Positions.eraser.out();
                        }
                    }
                });

                if (!i) {
                    if (!Positions.lists[listIndex]) {
                        Positions.lists[listIndex] = sort;
                    }
                }
            });

            if (!i) {
                element.SimpleSort = sort;
            }
        });
    }
};


var AttachSortablePositions = function(positions) {
    if (!positions) { return; }
    if (!positions.SimpleSort) { Positions.createSortables(positions); }
};

ready(function() {
    var positions = $('#positions');

    $('body').delegate('mouseover', '#positions', function(event, element) {
        AttachSortablePositions(element);
    });

    AttachSortablePositions(positions);
});

module.exports = Positions;
},{"../ui":53,"../ui/eraser":52,"../utils/flags-state":67,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/object/keys":234,"mout/string/trim":270,"sortablejs":314}],47:[function(require,module,exports){
"use strict";

var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    trim          = require('mout/string/trim'),
    keys          = require('mout/object/keys'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    request       = require('agent'),
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global,
    Submit        = require('../fields/submit'),

    flags         = require('../utils/flags-state'),
    translate     = require('../utils/translate'),
    Cards         = require('./cards');

ready(function() {
    var body = $('body'),
        warningURL = parseAjaxURI(getAjaxURL('confirmdeletion') + getAjaxSuffix());

    // Handles Positions Duplicate / Remove
    body.delegate('click', '#positions [data-g-config]', function(event, element) {
        var mode = element.data('g-config'),
            href = element.data('g-config-href'),
            encode = window.btoa(href),//.substr(-20, 20), // in case the strings gets too long
            method = (element.data('g-config-method') || 'post').toLowerCase();

        if (event && event.preventDefault) { event.preventDefault(); }

        if (mode == 'delete' && !flags.get('free:to:delete:' + encode, false)) {
            // confirm before proceeding
            flags.warning({
                url: warningURL,
                data: {page_type: 'POSITION'},
                callback: function(response, content) {
                    var confirm = content.find('[data-g-delete-confirm]'),
                        cancel  = content.find('[data-g-delete-cancel]');

                    if (!confirm) { return; }

                    confirm.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        flags.get('free:to:delete:' + encode, true);
                        $([confirm, cancel]).attribute('disabled');
                        body.emit('click', { target: element });

                        modal.close();
                    });

                    cancel.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([confirm, cancel]).attribute('disabled');
                        flags.get('free:to:delete:' + encode, false);

                        modal.close();
                    });
                }
            });

            return false;
        }

        element.hideIndicator();
        element.showIndicator();

        request(method, parseAjaxURI(href + getAjaxSuffix()), {}, function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
            } else {
                var positionDeleted = response.body.position,
                    reload = $('[href="' + getAjaxURL('positions') + '"]');

                if (!reload) { window.location = window.location; }
                else {
                    body.emit('click', {target: reload});
                }

                toastr.success(response.body.html || 'Action successfully completed.', response.body.title || '');
                if (positionDeleted) {
                    body.positionDeleted = positionDeleted;
                }
            }

            element.hideIndicator();
        });

    });

    // Positions Add
    body.delegate('click', '#positions .position-add', function(event, element) {
        event.preventDefault();

        var data = {};

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'get',
            overlayClickToClose: false,
            remote: parseAjaxURI(element.attribute('href') + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }

                var form       = content.elements.content.find('form'),
                    fakeDOM    = zen('div').html(response.body.html).find('form'),
                    submit     = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]');

                var search      = content.elements.content.find('.search input'),
                    blocks      = content.elements.content.search('[data-mm-type]'),
                    filters     = content.elements.content.search('[data-mm-filter]'),
                    urlTemplate = content.elements.content.find('.g-urltemplate');

                if (urlTemplate) { body.emit('input', { target: urlTemplate }); }

                var editable = content.elements.content.find('[data-title-editable]');
                if (editable) {
                    editable.on('title-edit-end', function(title, original/*, canceled*/) {
                        title = trim(title);
                        if (!title) {
                            title = trim(original) || 'Title';
                            this.text(title).data('title-editable', title);

                            return true;
                        }
                    });
                }

                if (search && filters && blocks) {
                    search.on('input', function() {
                        if (!this.value()) {
                            blocks.removeClass('hidden');
                            return;
                        }

                        blocks.addClass('hidden');

                        var found = [], value = this.value().toLowerCase(), text;

                        filters.forEach(function(filter) {
                            filter = $(filter);
                            text = trim(filter.data('mm-filter')).toLowerCase();
                            if (text.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                                found.push(filter.matches('[data-mm-type]') ? filter : filter.parent('[data-mm-type]'));
                            }
                        }, this);

                        if (found.length) { $(found).removeClass('hidden'); }
                    });
                }

                if (search) {
                    setTimeout(function() {
                        search[0].focus();
                    }, 5);
                }

                if ((!form && !fakeDOM) || !submit) { return true; }
            }
        });
    });

    // Positions Items settings
    body.delegate('click', '#positions .item-settings', function(event, element) {
        event.preventDefault();

        var data = {},
            parent = element.parent('[data-pm-data]'),
            position = JSON.parse(element.parent('[data-position]').data('position'));

        data.position = position.name;
        data.item = parent.data('pm-data');

        modal.open({
            content: translate('GANTRY5_PLATFORM_JS_LOADING'),
            method: 'post',
            data: data,
            overlayClickToClose: false,
            remote: parseAjaxURI(getAjaxURL('positions/edit/' + parent.data('pm-blocktype')) + getAjaxSuffix()),
            remoteLoaded: function(response, content) {
                if (!response.body.success) {
                    modal.enableCloseByOverlay();
                    return;
                }

                var form       = content.elements.content.find('form'),
                    fakeDOM    = zen('div').html(response.body.html).find('form'),
                    submit     = content.elements.content.search('input[type="submit"], button[type="submit"], [data-apply-and-save]');

                var editable = content.elements.content.find('[data-title-editable]');
                if (editable) {
                    editable.on('title-edit-end', function(title, original/*, canceled*/) {
                        title = trim(title);
                        if (!title) {
                            title = trim(original) || 'Title';
                            this.text(title).data('title-editable', title);

                            return true;
                        }
                    });
                }

                if ((!form && !fakeDOM) || !submit) { return true; }

                // Position Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();
                    fakeDOM = content.elements.content.find('form');

                    var target = $(e.currentTarget);
                    target.disabled(true);
                    target.hideIndicator();
                    target.showIndicator();

                    var post = Submit(fakeDOM[0].elements, content.elements.content);

                    if (post.invalid.length) {
                        target.disabled(false);
                        target.hideIndicator();
                        target.showIndicator('fa fa-fw fa-exclamation-triangle');
                        toastr.error(translate('GANTRY5_PLATFORM_JS_REVIEW_FIELDS'), translate('GANTRY5_PLATFORM_JS_INVALID_FIELDS'));
                        return;
                    }

                    request(fakeDOM.attribute('method'), parseAjaxURI(fakeDOM.attribute('action') + getAjaxSuffix()), post.valid.join('&'), function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            var parent = element.parent('[data-pm-data]');

                            if (parent) {
                                parent.data('pm-data', JSON.stringify(response.body.item));

                                var status = response.body.item.enabled || response.body.item.options.attributes.enabled;
                                var dummy = zen('div').html(response.body.html);
                                parent.html(dummy.firstChild().html());
                                parent[status == '0' ? 'addClass' : 'removeClass']('g-menu-item-disabled');
                            }

                            // if it's apply and save we also save the panel
                            if (target.data('apply-and-save') !== null) {
                                var save = $('body').find('.button-save');
                                if (save) { body.emit('click', { target: save }); }
                            }

                            Cards.serialize(element.parent('[data-position]'));

                            modal.close();
                            toastr.success(translate('GANTRY5_PLATFORM_JS_POSITIONS_SETTINGS_APPLIED'), translate('GANTRY5_PLATFORM_JS_SETTINGS_APPLIED'));
                        }

                        target.hideIndicator();
                    });
                });
            }
        });
    });

    // Handles Positions Titles Rename
    var updateTitle = function(title, original, wasCanceled) {
            this.style('text-overflow', 'ellipsis');
            if (wasCanceled || title == original) { return; }
            var element = this,
                href = element.data('g-config-href'),
                type = element.data('title-editable-type'),
                method = (element.data('g-config-method') || 'post').toLowerCase(),
                parent = element.parent('[id]'),
                data = {};

            parent.showIndicator();
            parent.find('[data-title-edit]').addClass('disabled');

            data = type === 'title' ? { title: trim(title) } : { key: trim(title) };

            request(method, parseAjaxURI(href + getAjaxSuffix()), data, function(error, response) {
                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });

                    element.data('title-editable', original).text(original);
                } else {
                    element.data('title', title).data('tip', title);

                    // refresh ID label and actions buttons
                    var dummy = zen('div').html(response.body.position),
                        actions = dummy.find('.position-actions'),
                        card = element.parent('.card');

                    card.find('h4 .position-key').html(response.body.id);
                    card.find('.position-actions').html(actions.html());

                    var position = card.find('[data-position]'),
                        data = JSON.parse(position.data('position'));

                    data.title = title;
                    position.data('position', JSON.stringify(data));
                }

                parent.hideIndicator();
                parent.find('[data-title-edit]').removeClass('disabled');
            });
        },

        attachEditables = function(editables) {
            if (!editables || !editables.length) { return; }
            editables.forEach(function(editable) {
                editable = $(editable);
                editable.confWasAttached = true;
                editable.on('title-edit-start', function(){
                    editable.style('text-overflow', 'inherit');
                });
                editable.on('title-edit-end', updateTitle);
            });
        };

    // Toggle all assignments on/off
    body.delegate('change', '[data-positions-assignments] input[type="hidden"]', function(event, element) {
        var card = element.parent('.card'),
            wrapper = card.find('.settings-param-wrapper');

        wrapper[element.value() == 1 ? 'addClass' : 'removeClass']('hide');
        wrapper.search('input[type="hidden"]').forEach(function(element) {
            element = $(element);
            element.value(0).disabled(true);
        });
    });

    // Global state change
    body.on('statechangeAfter', function(event, element) {
        var editables = $('#positions [data-title-editable]');
        if (!editables) { return true; }

        editables = editables.filter(function(editable) {
            return (typeof $(editable).confWasAttached) === 'undefined';
        });

        attachEditables(editables);
    });

    attachEditables($('#positions [data-title-editable]'));
});

module.exports = {};

},{"../fields/submit":8,"../ui":53,"../utils/flags-state":67,"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"../utils/translate":76,"./cards":46,"agent":78,"elements":111,"elements/domready":109,"elements/zen":135,"mout/object/keys":234,"mout/string/trim":270}],48:[function(require,module,exports){
"use strict";
var ready = require('elements/domready'),
    $ = require('elements/attributes'),
    modal = require('../ui').modal,
    contains = require('mout/array/contains'),
    forEach = require('mout/collection/forEach');

require('../ui/popover');

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1,
    FOCUSIN   = isFirefox ? 'focus' : 'focusin';

ready(function() {

    var body = $('body');

    body.delegate('click', '[data-g-styles]', function(event, element) {
        var target = $(event.target);
        if (event && event.preventDefault) { event.preventDefault(); }
        if (target.hasClass('swatch-preview') || target.parent('.swatch-preview')) { return true; }

        var data = JSON.parse(element.data('g-styles')), input, value, type, evt;
        forEach(data, function(preset, name) {
            input = $('[name="' + name + '"]');
            value = input ? input.value() : false;

            if (!input || value === preset) { return; }

            evt = {
                target: input,
                forceOverride: true
            };

            type = (input.tag() == 'select' || contains(['hidden', 'checkbox'], input.type())) ? 'change' : 'input';

            input.value(preset);
            body.emit(type, evt);
            body.emit('keyup', evt);
        });
    });

    body.delegate('click', '[data-g-styles] .swatch-preview', function(event, element) {
        var image = element.parent('[data-g-styles]').find('img');
        if (!image) { return false; }

        modal.open({
            content: image[0].outerHTML,
            afterOpen: function(container) {
                var padding = parseInt(container.compute('padding-left'), 10) + parseInt(container.compute('padding-right'), 10);
                container.style({
                    maxWidth: '80%',
                    width: padding + (image[0].naturalWidth || image[0].width)
                });
            }
        });
    });

});

module.exports = {};

},{"../ui":53,"../ui/popover":55,"elements/attributes":106,"elements/domready":109,"mout/array/contains":164,"mout/collection/forEach":187}],49:[function(require,module,exports){
"use strict";
var ready  = require('elements/domready'),
    trim   = require('mout/string/trim'),
    forOwn = require('mout/object/forOwn'),
    $      = require('elements');

var Cookie = {
    write: function(name, value) {
        var date = new Date();
        date.setTime(date.getTime() + 3600 * 1000 * 24 * 365 * 10); // 10 years

        var host   = window.location.host.toString(),
            domain = host.substring(host.lastIndexOf(".", host.lastIndexOf(".") - 1) + 1);

        if (host.match(/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)) { domain = host; }
        var cookie = [name, '=', JSON.stringify(value), '; expires=', date.toGMTString(), '; domain=.', domain, '; path=/;'];

        document.cookie = cookie.join('');
    },

    read: function(name) {
        name = name.replace(/([-.*+?^${}()|[\]\/\\])/g, '\\$1');
        var value = document.cookie.match('(?:^|;)\\s*' + name + '=([^;]*)');
        return (value) ? JSON.parse(decodeURIComponent(value[1])) : null;
    }
};

var loadFromStorage = function() {
    var storage    = Cookie.read('g5-collapsed') || {},
        collapsers = $('[data-g-collapse]');
    if (!collapsers) { return false; }

    var item, data, handle, panel, card;
    forOwn(storage, function(value, key) {
        item = $('[data-g-collapse-id="' + key + '"]');
        if (!item) { return; }

        data = JSON.parse(item.data('g-collapse'));
        handle = data.handle ? item.find(data.handle) : item.find('.g-collapse');
        panel = data.target ? item.find(data.target) : item;
        card = item.parent('.card') || panel;
        handle
            .data('title', value ? data.expand : data.collapse)
            .data('tip', value ? data.expand : data.collapse);

        panel.attribute('style', null);
        card[!value ? 'removeClass' : 'addClass']('g-collapsed');
        item[!value ? 'removeClass' : 'addClass']('g-collapsed-main');
    });
};

ready(function() {
    var body = $('body'), data, target, storage;

    // single collapser
    body.delegate('click', '[data-g-collapse]', function(event, element) {
        element = event.element || element;

        data = JSON.parse(element.data('g-collapse'));
        target = $(event.target);
        storage = ((data.store !== false) ? Cookie.read('g5-collapsed') : storage) || {};
        if (!data.handle) { data.handle = element.find('.g-collapse'); }

        if (!target.matches(data.handle) && !target.parent(data.handle)) { return false; }

        if (storage[data.id] === undefined) {
            storage[data.id] = data.collapsed;

            if (data.store !== false) { Cookie.write('g5-collapsed', storage); }
        }

        var collapsed = storage[data.id],
            panel     = data.target ? element.find(data.target) : element,
            card      = panel.parent('.card') || panel;

        if (card && card.hasClass('g-collapsed')) {
            card.removeClass('g-collapsed');
            element.removeClass('g-collapsed-main');
            /* for animations
             panel.style({
             overflow: 'hidden',
             height: 0
             });*/
        }

        var slide = function(override) {
            collapsed = typeof override != 'number' ? override : collapsed;
            if (!collapsed) {
                card.addClass('g-collapsed');
                element.addClass('g-collapsed-main');
                element.attribute('style', null);
            }

            data.handle
                .data('title', !collapsed ? data.expand : data.collapse)
                .data('tip', !collapsed ? data.expand : data.collapse);
            storage[data.id] = !collapsed;
            data.collapsed = !collapsed;

            var refreshData = JSON.parse(element.data('g-collapse'));
            refreshData.collapsed = !collapsed;
            element.data('g-collapse', JSON.stringify(refreshData));

            if (data.store !== false) {
                Cookie.write('g5-collapsed', storage);
            }
        };

        if (element.gFastCollapse) {
            panel[collapsed ? 'removeClass' : 'addClass']('g-collapsed');
            element[collapsed ? 'removeClass' : 'addClass']('g-collapsed-main');
            slide(collapsed);
        } else {
            element.removeClass('g-collapsed-main');
            // for animations
            // panel.removeClass('g-collapsed')[collapsed ? 'slideDown' : 'slideUp'](slide);
            panel.removeClass('g-collapsed')[collapsed ? 'removeClass' : 'addClass']('g-collapsed');
            slide(collapsed);
        }

        element.gFastCollapse = false;
    });

    // global collapse togglers
    body.delegate('click', '[data-g-collapse-all]', function(event, element) {
        var mode          = element.data('g-collapse-all') == 'true',
            parent        = element.parent('.g-filter-actions'),
            container     = parent.nextSibling(),
            collapsers    = container.search('[data-g-collapse]'),
            CookieStorage = Cookie.read('g5-collapsed') || {},
            panel, data, handle, card, inner;

        if (!collapsers) { return; }

        collapsers.forEach(function(collapser) {
            collapser = $(collapser);
            card = collapser.parent('.card');
            inner = card.find('> .g-collapsed');
            data = JSON.parse(collapser.data('g-collapse'));
            handle = data.handle ? collapser.find(data.handle) : collapser.find('.g-collapse');
            panel = data.target ? collapser.find(data.target) : collapser;

            storage = ((data.store !== false) ? CookieStorage : storage) || {};

            storage[data.id] = mode;
            if (data.store !== false) {
                Cookie.write('g5-collapsed', storage);
            }

            panel.attribute('style', null);
            collapser[!mode ? 'removeClass' : 'addClass']('g-collapsed-main');
            card[!mode ? 'removeClass' : 'addClass']('g-collapsed');

            if (inner) {
                inner[!mode ? 'removeClass' : 'addClass']('g-collapsed');
            }
        });
    });

    // filter by card title
    body.delegate('input', '[data-g-collapse-filter]', function(event, element) {
        var filter    = JSON.parse(element.data('g-collapse-filter') || '{}'),
            parent    = element.parent('.g-filter-actions'),
            container = parent.nextSibling(),
            cards     = container.search(filter.element || '.card'),
            value     = element.value();

        if (!cards) { return; }

        if (!value) { cards.attribute('style', null); }
        cards.forEach(function(element, index) {
            element = $(element);
            var title   = trim(element.find(filter.title || 'h4 .g-title').text()),
                matches = title.match(new RegExp("^" + value + '|\\s' + value, 'gi'));

            if (matches) { element.attribute('style', null); }
            else { element.style('display', 'none'); }
        });
    });

    // this is now handled from the twig files
    // no need to run on domready
    //loadFromStorage();
});

module.exports = loadFromStorage;

},{"elements":111,"elements/domready":109,"mout/object/forOwn":230,"mout/string/trim":270}],50:[function(require,module,exports){
"use strict";

var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    contains   = require('mout/array/contains'),
    DragEvents = require('./drag.events'),
    $          = require('../utils/elements.utils');

// $ utils
require('elements/events');
require('elements/delegation');

var isIE = (navigator.appName === "Microsoft Internet Explorer");

var DragDrop = new prime({

    mixin: [Bound, Options],
    inherits: Emitter,

    options: {
        delegate: null,
        droppables: false,
        catchClick: false
    },

    DRAG_EVENTS: DragEvents,

    constructor: function(container, options) {
        this.container = $(container);
        if (!this.container) { return; }
        this.setOptions(options);

        this.element = null;
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };

        this.matched = false;
        this.lastMatched = false;
        this.lastOvered = null;

        this.attach();
    },

    attach: function() {
        this.DRAG_EVENTS.EVENTS.START.forEach(bind(function(event) {
            this.container.delegate(event, this.options.delegate, this.bound('start'));
        }, this));
    },

    detach: function() {
        this.DRAG_EVENTS.EVENTS.START.forEach(bind(function(event) {
            this.container.undelegate(event, this.options.delegate, this.bound('start'));
        }, this));
    },

    start: function(event, element) {
        //if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        clearTimeout(this.scrollInterval);
        if (element.LMTooltip) { element.LMTooltip.remove(); }
        $('html').attribute('style', 'height: 100% !important');
        this.scrollHeight = document.body.scrollHeight;

        // Prevents dragging a column from itself and limiting to its handle
        var target = $(event.target);
        if (!element.parent('[data-lm-root]') && element.hasClass('g-block') && (!target.matches('.submenu-reorder') && !target.parent('.submenu-reorder'))) { return true; }

        if (event.which && event.which !== 1 || $(event.target).matches(this.options.exclude)) { return true; }
        this.element = $(element);
        this.original = this.element;
        this.matched = false;
        if (this.options.catchClick) { this.moved = false; }

        // we force the menu column reorder handle to the g-block parent
        if (target.matches('.submenu-reorder') || target.parent('.submenu-reorder')) {
            this.element = target.parent('[data-mm-id]');
        }

        this.emit('dragdrop:beforestart', event, this.element);

        // Stops default MS touch actions since preventDefault doesn't work
        if (isIE) {
            this.element.style({
                '-ms-touch-action': 'none',
                'touch-action': 'none'
            });
        }

        // Stops text selection
        event.preventDefault();

        this.origin = {
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY,
            transform: this.element.compute('transform')
        };

        var clientRect = this.element[0].getBoundingClientRect();
        this.origin.offset = {
            clientRect: clientRect,
            scroll: {
                x: window.scrollX,
                y: window.scrollY
            },
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y
        };

        // Only allow to sort grids when targeting the left handle
        if (this.element.data('lm-blocktype') === 'grid' && Math.abs(this.origin.offset.x) < clientRect.width) {
            return false;
        }

        var offset  = Math.abs(this.origin.offset.x),
            columns = (this.element.parent().data('lm-blocktype') === 'grid' && this.element.parent().parent().data('lm-root')) ||
                (this.element.parent().parent().data('lm-blocktype') == 'container' && (this.element.parent().parent().parent().data('lm-root') || this.element.parent().parent().parent().data('lm-blocktype') == 'wrapper'));

        if (
            this.element.data('lm-blocktype') == 'grid' &&
            (this.element.parent().data('lm-blocktype') === 'container' && this.element.parent().parent().parent().data('lm-root')) ||
            (this.element.parent().data('lm-blocktype') === 'section' && this.element.parent().parent().parent().data('lm-root'))
        ) { columns = false; }

        // Resizing and only if it's not a non-visible (atoms) section
        if ((offset < 6 && this.element.parent().find(':last-child') !== this.element) || (columns && offset > 3 && offset < 10)) {
            if (this.element.parent('[data-lm-blocktype="atoms"]')) { return false; }

            this.emit('dragdrop:resize', event, this.element, (this.element.parent('[data-mm-id]') || this.element).siblings(':not(.placeholder)'), this.origin.offset.x);
            return false;
        }

        if (columns || (element.hasClass('submenu-column') && (!target.matches('.submenu-reorder') && !target.parent('.submenu-reorder')))) { return true; }

        this.element.style({
            'pointer-events': 'none',
            zIndex: 100
        });

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $('body').on(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            // Trackpads `tap` (mousedown + mouseup) happens too fast and the stop event
            // won't get attached. We need to defer it to avoid issues

            $('body').on(event, this.bound('deferStop'));
        }, this));

        this.emit('dragdrop:start', event, this.element);

        return this.element;
    },

    deferStop: function(event) {
        var self = this;
        setTimeout(function() {
            self.stop(event);
        }, 0);
    },

    stop: function(event) {
        //if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        clearTimeout(this.scrollInterval);
        $('html').attribute('style', null);
        if (!this.moved && this.options.catchClick) {
            // this is just a click
            this.element.style({ transform: this.origin.transform || 'translate(0, 0)' });
            this.emit('dragdrop:stop', event, this.matched, this.element);
            this._removeStyleAttribute(this.element);
            this.emit('dragdrop:stop:animation', this.element);
            this.emit('dragdrop:click', event, this.element);

            this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
                $('body').off(event, this.bound('move'));
            }, this));

            this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
                $('body').off(event, this.bound('deferStop'));
            }, this));

            this.element = null;

            return;
        }

        var settings = { duration: '250ms' };

        if (this.removeElement) {
            this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
                $('body').off(event, this.bound('move'));
            }, this));

            this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
                $('body').off(event, this.bound('deferStop'));
            }, this));

            return this.emit('dragdrop:stop:erase', event, this.element);
        }

        if (this.element) {

            this.emit('dragdrop:stop', event, this.matched, this.element);

            if (this.matched) {
                this.element.style({
                    opacity: 0,
                    transform: 'translate(0, 0)'
                }).removeClass('active');
            }

            if (!this.matched) {

                settings.callback = bind(function(element) {
                    this._removeStyleAttribute(element);
                    setTimeout(bind(function() {
                        this.emit('dragdrop:stop:animation', element);
                    }, this), 1);
                }, this, this.element);

                this.element.animate({
                    transform: this.origin.transform || 'translate(0, 0)',
                    opacity: 1
                }, settings);
            } else {

                this.element.style({
                    transform: this.origin.transform || 'translate(0, 0)',
                    opacity: 1
                });

                this._removeStyleAttribute(this.element);
                this.emit('dragdrop:stop:animation', this.element);
            }
        }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $('body').off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $('body').off(event, this.bound('deferStop'));
        }, this));

        this.element = null;
    },

    move: function(event) {
        //if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        if (this.options.catchClick) {
            var didItMove = {
                x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX,
                y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
            };

            if (Math.abs(didItMove.x - this.origin.x) <= 3 && Math.abs(didItMove.y - this.origin.y) <= 3) {
                return;
            }

            if (!this.moved) {
                this.element.style({ opacity: 0.5 });
                this.emit('dragdrop:move:once', this.element);
            }

            this.moved = true;
        }

        var clientX = event.clientX || (event.touches && event.touches[0].clientX) || 0,
            clientY = event.clientY || (event.touches && event.touches[0].clientY) || 0,
            overing = document.elementFromPoint(clientX, clientY),
            isGrid  = this.element.data('lm-blocktype') === 'grid';


        // Logic to auto-scroll on drag
        var scrollHeight = this.scrollHeight,
            Height       = document.body.clientHeight,
            Scroll       = window.pageYOffset;

        clearTimeout(this.scrollInterval);
        if (!overing) { return; }

        if (!$(overing).matches('#trash') && !$(overing).parent('#trash')) {
            var st, sl, trash = $('#g5-container #trash');
            if (clientY + 50 >= Height && Scroll + Height < scrollHeight) {
                this.scrollInterval = setInterval(function() {
                    sl = (window.pageXOffset || document.documentElement.scrollLeft) - (document.documentElement.clientLeft || 0);
                    st = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
                    window.scrollTo(sl, Math.min(scrollHeight, st + 4));
                }, 8);
            } else if (clientY - 50 <= (trash ? trash[0].offsetHeight : 0) && scrollHeight > 0) {
                this.scrollInterval = setInterval(function() {
                    sl = (window.pageXOffset || document.documentElement.scrollLeft) - (document.documentElement.clientLeft || 0);
                    st = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
                    window.scrollTo(sl, Math.max(0, st - 4));
                }, 8);
            }
        }

        // We tweak the overing to take into account the negative offset for the handle
        if (isGrid) {
            // More accurate is: clientX + (this.element[0].getBoundingClientRect().left - clientX)
            overing = document.elementFromPoint(clientX + 30, clientY);
        }

        if (!overing) { return false; }

        this.matched = $(overing).matches(this.options.droppables) ? overing : ($(overing).parent(this.options.droppables) || [false])[0];
        this.isPlaceHolder = $(overing).matches('[data-lm-placeholder]') ? true : ($(overing).parent('[data-lm-placeholder]') ? true : false);

        var deltaX    = this.lastX - clientX,
            deltaY    = this.lastY - clientY,
            direction = Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
                Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
                Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                'down';


        deltaX = (event.changedTouches ? event.changedTouches[0].pageX : event.pageX) - this.origin.x;
        deltaY = (event.changedTouches ? event.changedTouches[0].pageY : event.pageY) - this.origin.y;

        var isNew = this.element.parent('.particles-container');
        if (isNew) {
            deltaY += this.origin.offset.scroll.y - window.scrollY;
        }

        this.direction = direction;
        this.element.style({ transform: 'translate(' + deltaX + 'px, ' + deltaY + 'px)' });

        if (!this.isPlaceHolder) {
            if (this.lastMatched && this.matched !== this.lastMatched) {
                this.emit('dragdrop:leave', event, this.lastMatched, this.element);
                this.lastMatched = false;
            }

            if (this.matched && this.matched !== this.lastMatched && overing !== this.lastOvered) {
                this.emit('dragdrop:enter', event, this.matched, this.element);
                this.lastMatched = this.matched;
            }

            if (this.matched && this.lastMatched) {
                var rect = this.matched.getBoundingClientRect();
                // Note: you can divide x axis by 3 rather than 2 for 4 directions
                var location = {
                    x: Math.abs((clientX - rect.left)) < (rect.width / 2) && 'before' ||
                    Math.abs((clientX - rect.left)) >= (rect.width - (rect.width / 2)) && 'after' ||
                    'other',
                    y: Math.abs((clientY - rect.top)) < (rect.height / 2) && 'above' ||
                    Math.abs((clientY - rect.top)) >= (rect.height / 2) && 'below' ||
                    'other'
                };

                this.emit('dragdrop:location', event, location, this.matched, this.element);
            } else {
                this.emit('dragdrop:nolocation', event);
            }
        }

        this.lastOvered = overing;
        this.lastX = clientX;
        this.lastY = clientY;

        this.emit('dragdrop:move', event, this.element);
    },

    _removeStyleAttribute: function(element) {
        element = $(element || this.element);
        if (element.data('mm-id')) { return; }

        element.attribute('style', null);//.style({flex: flex});
    }

});

module.exports = DragDrop;

},{"../utils/elements.utils":64,"./drag.events":51,"elements/delegation":108,"elements/events":110,"mout/array/contains":164,"mout/function/bind":190,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],51:[function(require,module,exports){
"use strict";
var getSupportedEvent = function(events) {
    events = events.split(' ');

    var element = document.createElement('div'), event;
    var isSupported = false;

    for (var i = events.length - 1; i >= 0; i--) {
        event = 'on' + events[i];
        isSupported = (event in element);

        if (!isSupported) {
            element.setAttribute(event, 'return;');
            isSupported = typeof element[event] === 'function';
        }

        if (isSupported) {
            isSupported = events[i];
            break;
        }
    }

    element = null;
    return isSupported;
};

var getSupportedEvents = function(events) {
    events = events.split(' ');

    var isSupported = false, supported = [];
    for (var i = events.length - 1; i >= 0; i--) {
        isSupported = getSupportedEvent(events[i]);
        if (isSupported) { supported.push(isSupported); }
    }

    return supported;
};

var EVENT = {
        START: getSupportedEvent('mousedown touchstart MSPointerDown pointerdown'),
        MOVE: getSupportedEvent('mousemove touchmove MSPointerMove pointermove'),
        STOP: getSupportedEvent('mouseup touchend MSPointerUp pointerup')
    },
    EVENTS = {
        START: getSupportedEvents('mousedown touchstart MSPointerDown pointerdown'),
        MOVE: getSupportedEvents('mousemove touchmove MSPointerMove pointermove'),
        STOP: getSupportedEvents('mouseup touchend MSPointerUp pointerup')
    };


module.exports = {
    EVENT: EVENT,
    EVENTS: EVENTS
};

},{}],52:[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    $         = require('../utils/elements.utils'),
    Emitter   = require('prime/emitter'),
    Bound     = require('prime-util/prime/bound'),
    Options   = require('prime-util/prime/options');


var Eraser = new prime({
    mixin: [Options, Bound],

    inherits: Emitter,

    constructor: function(element, options){
        this.setOptions(options);

        this.element = $(element);

        if (!this.element) { return; }

        this.hide(true);
    },

    setTop: function() {
        if (typeof this.top !== 'undefined') { return; }
        this.top = parseInt(this.element.compute('top'), 10);
        this.left = $('#g5-container')[0].getBoundingClientRect().left;
        if (GANTRY_PLATFORM == 'grav') {
            this.left = 0;
        }
    },

    show: function(fast){
        if (!this.element) { return; }
        this.setTop();
        this.out();
        this.element[fast ? 'style' : 'animate']({top: this.top, left: this.left}, {duration: '150ms'});
    },

    hide: function(fast){
        if (!this.element) { return; }
        this.setTop();
        this.element.style('display', 'block');
        var top = {top: -(this.element[0].offsetHeight)};
        this.out();
        this.element[fast ? 'style' : 'animate'](top, {duration: '150ms'});
    },

    over: function(){
        this.element.find('.trash-zone').animate({transform: 'scale(1.2)'}, {duration: '150ms', equation: 'cubic-bezier(0.5,0,0.5,1)'});
    },

    out: function(){
        this.element.find('.trash-zone').animate({transform: 'scale(1)'}, {duration: '150ms', equation: 'cubic-bezier(0.5,0,0.5,1)'});
    }
});

module.exports = Eraser;

},{"../utils/elements.utils":64,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],53:[function(require,module,exports){
"use strict";

var Selectize = require('./selectize');

module.exports = {
    modal: require('./modal'),
    togglers: require('./togglers'),
    collapse: require('./collapse'),
    selectize: Selectize,
    toastr: require('./toastr')
};

},{"./collapse":49,"./modal":54,"./selectize":57,"./toastr":58,"./togglers":59}],54:[function(require,module,exports){
"use strict";
// Based on Vex (https://github.com/hubspot/vex)

var prime    = require('prime'),
    $        = require('../utils/elements.utils'),
    zen      = require('elements/zen'),
    storage  = require('prime/map')(),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    domready = require('elements/domready'),

    bind     = require('mout/function/bind'),
    map      = require('mout/array/map'),
    forEach  = require('mout/array/forEach'),
    last     = require('mout/array/last'),
    merge    = require('mout/object/merge'),
    trim     = require('mout/string/trim'),

    request  = require('agent');

var animationEndSupport = false;

var Modal = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    animationEndEvent: ['animationend', 'webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend'],

    globalID: 1,

    options: {
        baseClassNames: {
            container: 'g5-dialog',
            content: 'g5-content',
            overlay: 'g5-overlay',
            close: 'g5-close',
            closing: 'g5-closing',
            open: 'g5-dialog-open'
        },

        content: '',
        remote: '',
        showCloseButton: true,
        escapeToClose: true,
        overlayClickToClose: true,
        appendNode: '#g5-container',
        className: 'g5-dialog-theme-default',
        css: {},
        overlayClassName: '',
        overlayCSS: '',
        contentClassName: '',
        contentCSS: '',
        closeClassName: 'g5-dialog-close',
        closeCSS: '',

        afterOpen: null,
        afterClose: null
    },

    constructor: function(options) {
        this.setOptions(options);
        this.defaults = this.options;

        var self = this;
        domready(function() {
            $(window).on('keydown', function(event) {
                if (event.keyCode === 27) {
                    return self.closeByEscape();
                }
            });

            self.animationEndEvent = animationEndSupport;
        });

        this
            .on('dialogOpen', function(options) {
                $('body').addClass(options.baseClassNames.open);
                $('html').addClass(options.baseClassNames.open);
            })
            .on('dialogAfterClose', bind(function(options) {
                var all = this.getAll();
                if (!all || !all.length) {
                    $('body').removeClass(options.baseClassNames.open);
                    $('html').removeClass(options.baseClassNames.open);
                }
            }, this));
    },

    storage: function() {
        return storage;
    },

    open: function(options) {
        options = merge(this.options, options);
        options.id = this.globalID++;

        var elements = {};

        // container
        elements.container = zen('div')
            .addClass(options.baseClassNames.container)
            .addClass(options.className)
            .style(options.css)
            .attribute('tabindex', '0')
            .attribute('role', 'dialog')
            .attribute('aria-hidden', 'true')
            .attribute('aria-labelledby', 'g-modal-labelledby')
            .attribute('aria-describedby', 'g-modal-describedby');

        storage.set(elements.container, { dialog: options });

        // overlay
        elements.overlay = zen('div')
            .addClass(options.baseClassNames.overlay)
            .addClass(options.overlayClassName)
            .style(options.overlayCSS);

        storage.set(elements.overlay, { dialog: options });

        if (options.overlayClickToClose) {
            elements.container.on('click', bind(this._overlayClick, this, elements.container[0]));
            elements.overlay.on('click', bind(this._overlayClick, this, elements.overlay[0]));
        }

        elements.container.appendChild(elements.overlay);

        // content
        elements.content = zen('div')
            .addClass(options.baseClassNames.content)
            .addClass(options.contentClassName)
            .style(options.contentCSS)
            .attribute('aria-live', 'assertive')
            .attribute('tabindex', '0')
            .html(options.content);

        storage.set(elements.content, { dialog: options });
        elements.container.appendChild(elements.content);

        if (options.overlayClickToClose) {
            elements.content.on('click', function(/*e*/){
                return true;
            });
        }

        // remote
        if (options.remote && options.remote.length > 1) {
            this.showLoading();

            options.method = options.method || 'get';
            var agent = request();
            agent.method(options.method);
            agent.url(options.remote);
            if (options.data) { agent.data(options.data); }

            agent.send(bind(function(error, response) {
                if (elements.container.hasClass(options.baseClassNames.closing)) {
                    this.hideLoading();
                    return;
                }

                elements.content.html(response.body.html || response.body);

                if (!response.body.success) {
                    if (!response.body.html) { elements.content.style({ width: '90%' }); }
                }

                this.hideLoading();
                if (options.remoteLoaded && !elements.container.hasClass(options.baseClassNames.closing)) {
                    options.remoteLoaded(response, options);
                }

                elements.container.attribute('aria-hidden', 'false');
                setTimeout(function(){ elements.content[0].focus(); }, 0);

                var selects = $('[data-selectize]');
                if (selects) { selects.selectize(); }
            }, this));
        } else {
            elements.container.attribute('aria-hidden', 'false');
            setTimeout(function(){ elements.content[0].focus(); }, 0);
        }

        // close button
        if (options.showCloseButton) {
            elements.closeButton = zen('div')
                .addClass(options.baseClassNames.close)
                .addClass(options.closeClassName)
                .attribute('role', 'button').attribute('aria-label', 'Close')
                .style(options.closeCSS);

            storage.set(elements.closeButton, { dialog: options });
            elements.content.appendChild(elements.closeButton);
        }

        // delegate container to pick g5-close clicks
        elements.container.delegate('click', '.g5-dialog-close', bind(function(event){
            event.preventDefault();
            this._closeButtonClick(elements.container);
        }, this));

        // inject the dialog in the DOM
        var container = $(options.appendNode);

        // wordpress workaround for out-of-scope cases
        if (GANTRY_PLATFORM == 'wordpress') {
            container = $('#customize-preview') || $('#widgets-right') || $(options.appendNode);
            if ('#' + container.id() != options.appendNode) {
                var wpwrap = $('#wpwrap') || $('.wp-customizer'), sibling, workaround;
                if (wpwrap.id() == 'wpwrap') {
                    sibling = wpwrap.nextSibling(options.appendNode);
                    workaround =  sibling ? sibling : zen('div.g5wp-out-of-scope' + options.appendNode).after(wpwrap);
                } else {
                    sibling = wpwrap.find('> ' + options.appendNode);
                    workaround =  sibling ? sibling : zen('div.g5wp-out-of-scope' + options.appendNode).top(wpwrap);
                }
                container = workaround;
            }
        }

        container.appendChild(elements.container);

        options.elements = elements;

        if (options.afterOpen) {
            options.afterOpen(elements.content, options);
        }

        setTimeout(bind(function() {
            return this.emit('dialogOpen', options);
        }, this), 0);

        return elements.content;
    },

    getAll: function() {
        var options = this.options;
        return $("." + options.baseClassNames.container + ":not(." + options.baseClassNames.closing + ") ." + options.baseClassNames.content);
    },

    getByID: function(id) {
        var all = this.getAll();
        if (!all) { return []; }

        return $(all.filter(function(element) {
            element = $(element);
            return storage.get(element).dialog.id === id;
        }));
    },

    getLast: function() {
        var ids, id;

        ids = map(this.getAll(), function(element) {
            element = $(element);

            return storage.get(element).dialog.id;
        });

        if (!ids.length) {
            return false;
        }

        return Math.max.apply(Math, ids);
    },

    close: function(id) {
        if (!id) {
            var element = $(last(this.getAll()));
            if (!element) {
                return false;
            }

            id = storage.get(element).dialog.id;
        }

        return this.closeByID(id);
    },

    closeAll: function() {
        var ids;

        ids = map(this.getAll(), function(element) {
            element = $(element);

            return storage.get(element).dialog.id;
        });

        if (!ids.length) {
            return false;
        }

        forEach(ids.reverse(), function(id) {
            return this.closeByID(id);
        }, this);

        return true;
    },

    closeByID: function(id) {
        var content = this.getByID(id);
        if (!content || !content.length) {
            return false;
        }

        var container, options;

        container = storage.get(content).dialog.elements.container;
        options = merge({}, storage.get(content).dialog);

        var beforeClose = function() {
                if (options.beforeClose) {
                    return options.beforeClose(content, options);
                }
            },
            close = bind(function() {
                if (options.remoteLoaded) { options.remoteLoaded = function(){}; }
                content.emit('dialogClose', options);
                container.remove();
                this.emit('dialogAfterClose', options);
                if (options.afterClose) {
                    return options.afterClose(content, options);
                }

            }, this);

        if (animationEndSupport) {
            beforeClose();
            container.off(this.animationEndEvent).on(this.animationEndEvent, function() {
                return close();
            }).addClass(options.baseClassNames.closing);
        } else {
            beforeClose();
            close();
        }

        return true;
    },

    closeByEscape: function() {
        var id = this.getLast();

        if (id === false) {
            return false;
        }

        var element = this.getByID(id);

        if (!storage.get(element).dialog.escapeToClose) {
            return false;
        }

        return this.closeByID(id);

    },

    enableCloseByOverlay: function() {
        var id = this.getLast();

        if (id === false) {
            return false;
        }

        var elements = storage.get(this.getByID(id)).dialog.elements;

        elements.container.on('click', bind(this._overlayClick, this, elements.container[0]));
        elements.overlay.on('click', bind(this._overlayClick, this, elements.overlay[0]));

        elements.content.on('click', function(/*e*/){
            return true;
        });
    },

    showLoading: function() {
        this.hideLoading();
        return $('#g5-container').appendChild(zen('div.g5-dialog-loading-spinner.' + this.options.className));
    },

    hideLoading: function() {
        var spinner = $('.g5-dialog-loading-spinner');
        return spinner ? spinner.remove() : false;
    },

    // private
    _overlayClick: function(element, event) {
        if (event.target !== element) {
            return;
        }

        return this.close(storage.get($(element)).dialog.id);
    },

    _closeButtonClick: function(element) {
        return this.close(storage.get($(element)).dialog.id);
    }
});

domready(function() {
    var style = (document.body || document.documentElement).style;

    forEach(['animation', 'WebkitAnimation', 'MozAnimation', 'MsAnimation', 'OAnimation'], function(animation, index) {
        if (animationEndSupport) {
            return;
        }
        animationEndSupport = style[animation] !== undefined ? Modal.prototype.animationEndEvent[index] : false;
    });
});

var modal = new Modal();

module.exports = modal;

},{"../utils/elements.utils":64,"agent":78,"elements/domready":109,"elements/zen":135,"mout/array/forEach":172,"mout/array/last":177,"mout/array/map":178,"mout/function/bind":190,"mout/object/merge":235,"mout/string/trim":270,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298,"prime/map":300}],55:[function(require,module,exports){
"use strict";

var prime    = require('prime'),
    $        = require('../utils/elements.utils'),
    zen      = require('elements/zen'),
    storage  = require('prime/map')(),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    domready = require('elements/domready'),

    bind     = require('mout/function/bind'),
    map      = require('mout/array/map'),
    forEach  = require('mout/array/forEach'),
    last     = require('mout/array/last'),
    merge    = require('mout/object/merge'),
    isFunct  = require('mout/lang/isFunction'),

    request  = require('agent');

var Popover = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        mainClass: 'g5-popover',
        placement: 'auto',
        width: 'auto',
        height: 'auto',
        trigger: 'click',
        style: '',
        delay: 300,
        cache: true,
        multi: false,
        arrow: true,
        title: '',
        content: '',
        closeable: false,
        padding: true,
        targetEvents: true,
        allowElementsClick: false,
        url: '',
        type: 'html',
        where: '#g5-container',
        template: '<div class="g5-popover">' +
        '<div class="g-arrow"></div>' +
        '<div class="g5-popover-inner">' +
        '<a href="#" class="close">x</a>' +
        '<h3 class="g5-popover-title"></h3>' +
        '<div class="g5-popover-content"><i class="icon-refresh"></i> <p>&nbsp;</p></div>' +
        '</div>' +
        '</div>'
    },

    constructor: function(element, options) {
        this.setOptions(options);
        this.element = $(element);

        if (this.options.trigger === 'click') {
            this.element.off('click', this.bound('toggle')).on('click', this.bound('toggle'));
        } else {
            this.element.off('mouseenter', this.bound('mouseenterHandler')).off('mouseleave', this.bound('mouseleaveHandler'))
                .on('mouseenter', this.bound('mouseenterHandler'))
                .on('mouseleave', this.bound('mouseleaveHandler'));
        }

        this._poped = false;
        //this._inited = true;
    },

    destroy: function() {
        this.hide();
        storage.set(this.element[0], null);
        this.element.off('click', this.bound('toggle')).off('mouseenter', this.bound('mouseenterHandler')).off('mouseleave', this.bound('mouseleaveHandler'));

        if (this.$target) {
            this.$target.remove();
        }
    },

    hide: function(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        //var e = $.Event('hide.' + pluginType);
        this.element.emit('hide.popover', this);
        if (this.$target) {
            this.$target.removeClass('in').style({ display: 'none' });
            this.$target.remove();
        }
        this.element.emit('hidden.popover', this);

        if (this._focusAttached) {
            $('body').off('focus', this.bound('focus'), true);
            this._focusAttached = false;
            this.restoreFocus();
        }
    },

    toggle: function(e) {
        if (e) {
            e.preventDefault();
            e.stopPropagation();
        }
        this[this.getTarget().hasClass('in') ? 'hide' : 'show']();
    },

    focus: function(e) {
        if (!this.getTarget().hasClass('in')) { return; }
        var self = this,
            target = $(e.target || e);

        if (
            this.$target[0] === target[0] || target.parent(this.$target) ||
            this.element[0] === target[0] || target.parent(this.element)
        ) { return; }

        this.hide();
        if (this._focusAttached) this.restoreFocus();
    },

    restoreFocus: function(element) {
        element = $(element || this.element);
        var tag = element.tag();

        setTimeout(function(){
            if (tag != 'a' && tag != 'input' && tag != 'button') {
                var items = element.find('a, button, input');
                if (items) items[0].focus();
            } else {
                element[0].focus();
            }
        }, 0);
    },

    hideAll: function(force) {
        var css = '';
        if (force) { css = 'div.' + this.options.mainClass; }
        else { css = 'div.' + this.options.mainClass + ':not(.' + this.options.mainClass + '-fixed)'; }

        var elements = $(css);
        if (!elements) { return this; }
        elements.removeClass('in').style({ display: 'none' }).attribute('tabindex', '-1');
        if (!force && this._focusAttached) this.restoreFocus();

        if (this._focusAttached) {
            $('body').off('focus', this.bound('focus'), true);
            this._focusAttached = false;
        }
        return this;
    },

    show: function() {
        var target = this.getTarget().attribute('class', null).addClass(this.options.mainClass).attribute('tabindex', '0');

        if (!this.options.multi) {
            this.hideAll();
        }

        // use cache by default, if not cache setted  , reInit the contents
        this.element.emit('beforeshow.popover', this);
        if (!this.options.cache || !this._poped) {
            this.setTitle(this.getTitle());

            if (!this.options.closeable) {
                target.find('.close').off('click').remove();
            }

            if (!this.isAsync()) {
                this.setContent(this.getContent());
            } else {
                this.setContentASync(this.options.content);
                this.displayContent();
                return;
            }

            target.style({ display: 'block' });
        }

        this.displayContent();
        this.bindBodyEvents();

        setTimeout(function(){
            target[0].focus();
        }, 0);

        if (!this._focusAttached) {
            $('body').on('focus', this.bound('focus'), true);
            this._focusAttached = true;
        }
    },

    displayContent: function() {
        var elementPos = this.element.position(),
            target = this.getTarget().attribute('class', null).addClass(this.options.mainClass),
            targetContent = this.getContentElement(),
            targetWidth, targetHeight, placement;

        this.element.emit('show.popover', this);

        if (this.options.width !== 'auto') {
            target.style({ width: this.options.width });
        }
        if (this.options.height !== 'auto') {
            targetContent.style({ height: this.options.height });
        }

        // init the popover and insert into the document body
        if (!this.options.arrow && target.find('.g-arrow')) {
            target.find('.g-arrow').remove();
        }

        var container = $(this.options.where);

        // wordpress workaround for out-of-scope cases
        if (GANTRY_PLATFORM == 'wordpress') {
            container = $('#customize-preview') || $('#widgets-right') || $(this.options.where);
            if ('#' + container.id() != this.options.where) {
                var wpwrap = $('#wpwrap') || $('.wp-customizer'), sibling, workaround;
                if (wpwrap.id() == 'wpwrap') {
                    sibling = wpwrap.nextSibling(this.options.where);
                    workaround =  sibling ? sibling : zen('div.g5wp-out-of-scope' + this.options.where).after(wpwrap);
                } else {
                    sibling = wpwrap.find('> ' + this.options.where);
                    workaround =  sibling ? sibling : zen('div.g5wp-out-of-scope' + this.options.where).top(wpwrap);
                }
                container = workaround;
            }
        }

        target.remove().style({
            top: -1000,
            left: -1000,
            display: 'block'
        }).bottom(container);

        if (this.options.style) {
            if (typeof this.options.style === 'string') {
                this.options.style = this.options.style.split(',').map(Function.prototype.call, String.prototype.trim);
            }

            this.options.style.forEach(function(style) {
                this.$target.addClass(this.options.mainClass + '-' + style);
            }, this);
        }

        if (!this.options.padding) {
            targetContent.css('height', targetContent.position().height);
            this.$target.addClass('g5-popover-no-padding');
        }

        targetWidth = target[0].offsetWidth;
        targetHeight = target[0].offsetHeight;
        placement = this.getPlacement(elementPos, targetHeight);
        if (this.options.targetEvents) { this.initTargetEvents(); }
        var positionInfo = this.getTargetPosition(elementPos, placement, targetWidth, targetHeight);
        this.$target.style(positionInfo.position).addClass(placement).addClass('in');

        if (this.options.type === 'iframe') {
            var iframe = target.find('iframe');
            iframe.style({
                width: target.position().width,
                height: iframe.parent().position.height
            });
        }

        if (!this.options.arrow) {
            this.$target.style({ 'margin': 0 });
        }
        if (this.options.arrow) {
            var arrow = this.$target.find('.g-arrow');
            arrow.attribute('style', null);
            if (positionInfo.arrowOffset) {
                arrow.style(positionInfo.arrowOffset);
            }
        }

        this._poped = true;
        this.element[0].focus();
        this.element.emit('shown.popover', this);

    },


    /*getter setters */
    getTarget: function() {
        if (!this.$target) {
            this.$target = $(zen('div').html(this.options.template).children()[0]);
        }
        return this.$target;
    },

    getTitleElement: function() {
        return this.getTarget().find('.' + this.options.mainClass + '-title');
    },

    getContentElement: function() {
        return this.getTarget().find('.' + this.options.mainClass + '-content');
    },

    getTitle: function() {
        return this.options.title || this.element.data('g5-popover-title') || this.element.attribute('title');
    },

    setTitle: function(title) {
        var element = this.getTitleElement();
        if (title) {
            element.html(title);
        }
        else {
            element.remove();
        }
    },

    hasContent: function() {
        return this.getContent();
    },

    getContent: function() {
        if (this.options.url) {
            if (this.options.type === 'iframe') {
                this.content = $('<iframe frameborder="0"></iframe>').attribute('src', this.options.url);
            }
        } else if (!this.content) {
            var content = '';
            if (isFunct(this.options.content)) {
                content = this.options.content.apply(this.element[0], arguments);
            } else {
                content = this.options.content;
            }
            this.content = this.element.data('g5-popover-content') || content;
        }
        return this.content;
    },

    setContent: function(content) {
        var target = this.getTarget();
        this.getContentElement().html(content);
        this.$target = target;
    },

    isAsync: function() {
        return this.options.type === 'async';
    },

    setContentASync: function(content) {
        request('get', this.options.url, bind(function(error, response) {
            if (content && isFunct(content)) {
                this.content = content.apply(this.element[0], [response]);
            } else {
                this.content = response.body.html;
            }

            this.setContent(this.content);

            var target = this.getContentElement();
            target.attribute('style', null);

            setTimeout(bind(function(){
                target.parent('.' + this.options.mainClass)[0].focus();
            }, this), 0);

            this.displayContent();
            this.bindBodyEvents();

            var selects = $('[data-selectize]');
            if (selects) { selects.selectize(); }
        }, this));
    },

    bindBodyEvents: function() {
        var body = $('body');
        body.off('keyup', this.bound('escapeHandler')).on('keyup', this.bound('escapeHandler'));
        body.off('click', this.bound('bodyClickHandler')).on('click', this.bound('bodyClickHandler'));
    },


    /* event handlers */
    mouseenterHandler: function() {
        if (this._timeout) {
            clearTimeout(this._timeout);
        }
        if (!(this.getTarget()[0].offsetWidth > 0 || this.getTarget()[0].offsetHeight > 0)) {
            this.show();
        }
    },
    mouseleaveHandler: function() {
        // key point, set the _timeout  then use clearTimeout when mouse leave
        this._timeout = setTimeout(bind(function() {
            this.hide();
        }, this), this.options.delay);
    },

    escapeHandler: function(e) {
        if (e.keyCode === 27) {
            this.hideAll();
        }
    },

    bodyClickHandler: function() {
        this.hideAll();
    },

    targetClickHandler: function(e) {
        var target = $(e.target);
        if (target.matches(this.options.allowElementsClick)) { e.preventDefault(); }
        if (!target.parent('[data-g-popover-follow]') && target.data('g-popover-follow') === null) { e.stopPropagation(); }
    },

    initTargetEvents: function() {
        if (this.options.trigger !== 'click') {
            this.$target
                .off('mouseenter', this.bound('mouseenter'))
                .off('mouseleave', this.bound('mouseleave'))
                .on('mouseenter', this.bound('mouseenterHandler'))
                .on('mouseleave', this.bound('mouseleaveHandler'));
        }

        var close = this.$target.find('.close');
        if (close) {
            close.off('click', this.bound('hide')).on('click', this.bound('hide'));
        }

        this.$target.off('click', this.bound('targetClickHandler')).on('click', this.bound('targetClickHandler'));
    },

    /* utils methods */
    getPlacement: function(pos, targetHeight) {
        var
            placement,
            de = document.documentElement,
            db = document.body,
            clientWidth = de.clientWidth,
            clientHeight = de.clientHeight,
            scrollTop = Math.max(db.scrollTop, de.scrollTop),
            scrollLeft = Math.max(db.scrollLeft, de.scrollLeft),
            pageX = Math.max(0, pos.left - scrollLeft),
            pageY = Math.max(0, pos.top - scrollTop),
            arrowSize = 20;

        // if placement equals auto，caculate the placement by element information;
        if (typeof(this.options.placement) === 'function') {
            placement = this.options.placement.call(this, this.getTarget()[0], this.element[0]);
        } else {
            placement = this.element.data('g5-popover-placement') || this.options.placement;
        }

        if (placement === 'auto') {
            if (pageX < clientWidth / 3) {
                if (pageY < clientHeight / 3) {
                    placement = 'bottom-right';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'right';
                } else {
                    placement = 'top-right';
                }
                //placement= pageY>targetHeight+arrowSize?'top-right':'bottom-right';
            } else if (pageX < clientWidth * 2 / 3) {
                if (pageY < clientHeight / 3) {
                    placement = 'bottom';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'bottom';
                } else {
                    placement = 'top';
                }
            } else {
                placement = pageY > targetHeight + arrowSize ? 'top-left' : 'bottom-left';
                if (pageY < clientHeight / 3) {
                    placement = 'bottom-left';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'left';
                } else {
                    placement = 'top-left';
                }
            }
        }
        return placement;
    },

    getTargetPosition: function(elementPos, placement, targetWidth, targetHeight) {
        var pos = elementPos,
            elementW = this.element[0].offsetWidth,
            elementH = this.element[0].offsetHeight,
            position = {},
            arrowOffset = null,
            arrowSize = this.options.arrow ? 28 : 0,
            fixedW = elementW < arrowSize + 10 ? arrowSize : 0,
            fixedH = elementH < arrowSize + 10 ? arrowSize : 0;

        switch (placement) {
            case 'bottom':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left + pos.width / 2 - targetWidth / 2
                };
                break;
            case 'top':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left + pos.width / 2 - targetWidth / 2
                };
                break;
            case 'left':
                position = {
                    top: pos.top + pos.height / 2 - targetHeight / 2,
                    left: pos.left - targetWidth
                };
                break;
            case 'right':
                position = {
                    top: pos.top + pos.height / 2 - targetHeight / 2,
                    left: pos.left + pos.width
                };
                break;
            case 'top-right':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left - fixedW
                };
                arrowOffset = { left: elementW / 2 + fixedW };
                break;
            case 'top-left':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left - targetWidth + pos.width + fixedW
                };
                arrowOffset = { left: targetWidth - elementW / 2 - fixedW };
                break;
            case 'bottom-right':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left - fixedW
                };
                arrowOffset = { left: elementW / 2 + fixedW };
                break;
            case 'bottom-left':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left - targetWidth + pos.width + fixedW
                };
                arrowOffset = { left: targetWidth - elementW / 2 - fixedW };
                break;
            case 'right-top':
                position = {
                    top: pos.top - targetHeight + pos.height + fixedH,
                    left: pos.left + pos.width
                };
                arrowOffset = { top: targetHeight - elementH / 2 - fixedH };
                break;
            case 'right-bottom':
                position = {
                    top: pos.top - fixedH,
                    left: pos.left + pos.width
                };
                arrowOffset = { top: elementH / 2 + fixedH };
                break;
            case 'left-top':
                position = {
                    top: pos.top - targetHeight + pos.height + fixedH,
                    left: pos.left - targetWidth
                };
                arrowOffset = { top: targetHeight - elementH / 2 - fixedH };
                break;
            case 'left-bottom':
                position = {
                    top: pos.top,
                    left: pos.left - targetWidth
                };
                arrowOffset = { top: elementH / 2 };
                break;

        }

        return {
            position: position,
            arrowOffset: arrowOffset
        };
    }

});

$.implement({
    getPopover: function(options) {
        var popover = storage.get(this);

        if (!popover && options !== 'destroy') {
            options = options || {};
            popover = new Popover(this, options);
            storage.set(this, popover);
            this.PopoverDefined = true;
        }

        return popover;
    },

    popover: function(options) {
        return this.forEach(function(element) {
            var popover = storage.get(element);

            if (!popover && options !== 'destroy') {
                options = options || {};
                popover = new Popover(element, options);
                storage.set(element, popover);
            }
        });
    },

    position: function() {
        var node = this[0],
            ct = $('#g5-container')[0].getBoundingClientRect(),
            box = {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0
            };

        if (typeof node.getBoundingClientRect !== "undefined") {
            box = node.getBoundingClientRect();
        }

        return {
            x: box.left - ct.left,
            left: box.left - ct.left,
            y: box.top - ct.top,
            top: box.top - ct.top,
            right: box.right - ct.right,
            bottom: box.bottom - ct.bottom,
            width: box.right - box.left,
            height: box.bottom - box.top
        };
    }
});

module.exports = $;

},{"../utils/elements.utils":64,"agent":78,"elements/domready":109,"elements/zen":135,"mout/array/forEach":172,"mout/array/last":177,"mout/array/map":178,"mout/function/bind":190,"mout/lang/isFunction":203,"mout/object/merge":235,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298,"prime/map":300}],56:[function(require,module,exports){
"use strict";

var $        = require('elements'),
    prime    = require('prime'),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    zen      = require('elements/zen'),
    moofx    = require('moofx'),

    bind     = require('mout/function/bind'),
    isArray  = require('mout/lang/isArray'),
    isNumber = require('mout/lang/isNumber');

var Progresser = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        value: 0.0,
        size: 50.0,
        startAngle: -Math.PI / 2,
        thickness: 'auto',
        fill: { // { color: 'hex|rgba' } || { gradient: [from, to], gradientAngle: Math.PI / 4, gradientDirection: [x0, y0, x1, y1] }
            gradient: ['#9e38eb', '#4e68fc']//['#3aeabb', '#fdd250']
        },
        emptyFill: 'rgba(0, 0, 0, .1)',
        animation: {
            duration: 1200,
            equation: 'cubic-bezier(0.645, 0.045, 0.355, 1)'
        },
        animationStartValue: 0.0,
        reverse: false,
        lineCap: 'butt', // butt, round, square
        insertElement: null,
        insertLocation: 'before'
    },

    constructor: function(element, options) {
        this.setOptions(options);

        this.element = this.element || $(element);
        this.canvas = this.canvas || zen('canvas')[this.options.insertLocation || 'before'](this.options.insertElement || this.element)[0];
        this.radius = this.options.size / 2;
        this.arcFill = null;
        this.lastFrameValue = 0.0;

        this.canvas.width = this.options.size;
        this.canvas.height = this.options.size;
        this.ctx = this.canvas.getContext('2d');

        this.initFill();
        this.draw();
    },

    initFill: function() {
        var fill = this.options.fill,
            size = this.options.size,
            ctx  = this.ctx;

        if (!fill) { throw Error('The fill is not specified.'); }

        if (fill.color) {
            this.arcFill = fill.color;
        }

        if (fill.gradient) {
            var gr = fill.gradient;

            if (gr.length == 1) { this.arcFill = gr[0]; }
            else {
                var ga = fill.gradientAngle || 0,  // gradient direction angle; 0 by default
                    gd = fill.gradientDirection || [
                            size / 2 * (1 - Math.cos(ga)), // x0
                            size / 2 * (1 + Math.sin(ga)), // y0
                            size / 2 * (1 + Math.cos(ga)), // x1
                            size / 2 * (1 - Math.sin(ga))  // y1
                        ],
                    lg = ctx.createLinearGradient.apply(ctx, gd);

                for (var i = 0; i < gr.length; i++) {
                    var color = gr[i],
                        pos   = i / (gr.length - 1);

                    if (isArray(color)) {
                        pos = color[1];
                        color = color[0];
                    }

                    lg.addColorStop(pos, color);
                }

                this.arcFill = lg;
            }
        }
    },

    draw: function() {
        this[this.options.animation ? 'drawAnimated' : 'drawFrame'](this.options.value);
    },

    drawFrame: function(v) {
        this.lastFrameValue = v;
        this.ctx.clearRect(0, 0, this.options.size, this.options.size);
        this.drawEmptyArc(v);
        this.drawArc(v);
    },

    drawArc: function(v) {
        var ctx = this.ctx,
            r   = this.radius,
            t   = this.getThickness(),
            a   = this.options.startAngle;

        ctx.save();
        ctx.beginPath();

        if (!this.options.reverse) {
            ctx.arc(r, r, r - t / 2, a, a + Math.PI * 2 * v);
        } else {
            ctx.arc(r, r, r - t / 2, a - Math.PI * 2 * v, a);
        }

        ctx.lineWidth = t;
        ctx.lineCap = this.options.lineCap;
        ctx.strokeStyle = this.arcFill;
        ctx.stroke();
        ctx.restore();
    },

    drawEmptyArc: function(v) {
        var ctx = this.ctx,
            r   = this.radius,
            t   = this.getThickness(),
            a   = this.options.startAngle;

        if (v < 1) {
            ctx.save();
            ctx.beginPath();

            if (v <= 0) {
                ctx.arc(r, r, r - t / 2, 0, Math.PI * 2);
            } else {
                if (!this.reverse) {
                    ctx.arc(r, r, r - t / 2, a + Math.PI * 2 * v, a);
                } else {
                    ctx.arc(r, r, r - t / 2, a, a - Math.PI * 2 * v);
                }
            }

            ctx.lineWidth = t;
            ctx.strokeStyle = this.options.emptyFill;
            ctx.stroke();
            ctx.restore();
        }
    },

    drawAnimated: function(v) {
        this.element.emit('progress-animation-start');

        moofx(bind(function(now) {
            var stepValue = this.options.animationStartValue * (1 - now) + v * now;
            this.drawFrame(stepValue);
            this.element.emit('progress-animation-change', now, stepValue);
        }, this), {
            duration: this.options.animation.duration || '1200',
            equation: this.options.animation.equation || 'linear',
            callback: bind(function() {
                if (this.options.animation.callback) { this.options.animation.callback(); }
                this.element.emit('progress-animation-end');
            }, this)
        }).start(0, 1);
    },

    getThickness: function() {
        return isNumber(this.options.thickness) ? this.options.thickness : this.options.size / 14;
    }
});

module.exports = Progresser;

},{"elements":111,"elements/zen":135,"moofx":136,"mout/function/bind":190,"mout/lang/isArray":201,"mout/lang/isNumber":205,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298}],57:[function(require,module,exports){
"use strict";
// selectize (v0.12.1) (commit: 4dae761)

var prime      = require('prime'),
    ready      = require('elements/domready'),
    zen        = require('elements/zen'),

    sifter     = require('sifter'),

    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),

    $          = require('../utils/elements.utils'),
    moofx      = require('moofx'),

    bind       = require('mout/function/bind'),
    forEach    = require('mout/collection/forEach'),
    indexOf    = require('mout/array/indexOf'),
    last       = require('mout/array/last'),
    debounce   = require('mout/function/debounce'),
    isArray    = require('mout/lang/isArray'),
    isBoolean  = require('mout/lang/isBoolean'),
    merge      = require('mout/object/merge'),
    unset      = require('mout/object/unset'),
    size       = require('mout/object/size'),
    values     = require('mout/object/values'),
    escapeHTML = require('mout/string/escapeHtml'),
    trim       = require('mout/string/trim'),
    slugify    = require('mout/string/slugify');


var IS_MAC                = /Mac/.test(navigator.userAgent),
    IS_IE                 = /MSIE 9/i.test(navigator.userAgent) || /MSIE 10/i.test(navigator.userAgent) || /rv:11.0/i.test(navigator.userAgent),
    COUNT                 = 0,

    KEY_A                 = 65,
    KEY_COMMA             = 188,
    KEY_RETURN            = 13,
    KEY_ESC               = 27,
    KEY_LEFT              = 37,
    KEY_UP                = 38,
    KEY_P                 = 80,
    KEY_RIGHT             = 39,
    KEY_DOWN              = 40,
    KEY_N                 = 78,
    KEY_BACKSPACE         = 8,
    KEY_DELETE            = 46,
    KEY_SHIFT             = 16,
    KEY_CMD               = IS_MAC ? 91 : 17,
    KEY_CTRL              = IS_MAC ? 18 : 17,
    KEY_TAB               = 9,

    TAG_SELECT            = 1,
    TAG_INPUT             = 2,

    // for now, android support in general is too spotty to support validity
    SUPPORTS_VALIDITY_API = !/android/i.test(window.navigator.userAgent) && !!document.createElement('form').validity;

var hash_key = function(value) {
    if (typeof value === 'undefined' || value === null) return null;
    if (typeof value === 'boolean') return value ? '1' : '0';
    return value + '';
};

var isset = function(object) {
    return typeof object !== 'undefined';
};

var escape_replace = function(str) {
    return (str + '').replace(/\$/g, '$$$$');
};

var once = function(fn) {
    var called = false;
    return function() {
        if (called) return;
        called = true;
        fn.apply(this, arguments);
    };
};

var debounce_events = function(self, types, fn) {
    var type;
    var trigger = self.emit;
    var event_args = {};

    // override trigger method
    self.emit = function() {
        var type = arguments[0];
        if (types.indexOf(type) !== -1) {
            event_args[type] = arguments;
        } else {
            return trigger.apply(self, arguments);
        }
    };

    // invoke provided function
    fn.apply(self, []);
    self.emit = trigger;

    // trigger queued events
    for (type in event_args) {
        if (event_args.hasOwnProperty(type)) {
            trigger.apply(self, event_args[type]);
        }
    }
};

var build_hash_table = function(key, objects) {
    if (!isArray(objects)) return objects;
    var i, n, table = {};
    for (i = 0, n = objects.length; i < n; i++) {
        if (objects[i].hasOwnProperty(key)) {
            table[objects[i][key]] = objects[i];
        }
    }
    return table;
};

var domToString = function(d) {
    var tmp = document.createElement('div');
    tmp.appendChild(d.cloneNode(true));
    return tmp.innerHTML;
};

var getSelection = function(input) {
    var result = {};
    if ('selectionStart' in input) {
        result.start = input.selectionStart;
        result.length = input.selectionEnd - result.start;
    } else if (document.selection) {
        input.focus();
        var sel = document.selection.createRange();
        var selLen = document.selection.createRange().text.length;
        sel.moveStart('character', -input.value.length);
        result.start = sel.text.length - selLen;
        result.length = selLen;
    }
    return result;
};

var transferStyles = function($from, $to, properties) {
    var i, n, styles = {};
    if (properties) {
        for (i = 0, n = properties.length; i < n; i++) {
            styles[properties[i]] = $from.compute(properties[i]);
        }
    } else {
        styles = $from.compute();
    }
    $to.style(styles);
};

var measured = null;
var measureString = function(str, $parent) {
    if (!str) {
        return 0;
    }

    var $test;
    if (!measured) {
        $test = zen('test').style({
            position: 'absolute',
            top: -99999,
            left: -99999,
            width: 'auto',
            padding: 0,
            whiteSpace: 'pre'
        }).text(str).bottom('body');

        transferStyles($parent, $test, [
            'letterSpacing',
            'fontSize',
            'fontFamily',
            'fontWeight',
            'textTransform'
        ]);

        measured = $test;
    } else {
        $test = measured;
        $test.text(str);
    }

    //var width = $test[0].offsetWidth;
    //$test.remove();

    return $test[0].offsetWidth;
};

var highlight = function($element, pattern) {
    if (typeof pattern === 'string' && !pattern.length) return;
    var regex = (typeof pattern === 'string') ? new RegExp(pattern, 'i') : pattern;

    var highlight = function(node) {
        var skip = 0;
        if (node.nodeType === 3) {
            var pos = node.data.search(regex);
            if (pos >= 0 && node.data.length > 0) {
                var match = node.data.match(regex);
                var spannode = document.createElement('span');
                spannode.className = 'g-highlight';
                var middlebit = node.splitText(pos);
                var endbit = middlebit.splitText(match[0].length);
                var middleclone = middlebit.cloneNode(true);
                spannode.appendChild(middleclone);
                middlebit.parentNode.replaceChild(spannode, middlebit);
                skip = 1;
            }
        } else if (node.nodeType === 1 && node.childNodes && !/(script|style)/i.test(node.tagName)) {
            for (var i = 0; i < node.childNodes.length; ++i) {
                i += highlight(node.childNodes[i]);
            }
        }
        return skip;
    };

    return forEach($element, function(el) {
        highlight(el);
    });
};

var autoGrow = function(input) {
    input = $(input);
    var currentWidth = null;

    var update = function(options, e) {
        var value, keyCode, printable, placeholder, width;
        var shift, character, selection;
        e = e || window.event || {};
        options = options || {};

        if (e.metaKey || e.altKey) return;
        if (!options.force && input.selectizeGrow === false) return;

        value = input.value();
        if (e.type && e.type.toLowerCase() === 'keydown') {
            keyCode = e.keyCode;
            printable = (
                (keyCode >= 97 && keyCode <= 122) || // a-z
                (keyCode >= 65 && keyCode <= 90) || // A-Z
                (keyCode >= 48 && keyCode <= 57) || // 0-9
                keyCode === 32 // space
            );

            if (keyCode === KEY_DELETE || keyCode === KEY_BACKSPACE) {
                selection = getSelection(input[0]);
                if (selection.length) {
                    value = value.substring(0, selection.start) + value.substring(selection.start + selection.length);
                } else if (keyCode === KEY_BACKSPACE && selection.start) {
                    value = value.substring(0, selection.start - 1) + value.substring(selection.start + 1);
                } else if (keyCode === KEY_DELETE && typeof selection.start !== 'undefined') {
                    value = value.substring(0, selection.start) + value.substring(selection.start + 1);
                }
            } else if (printable) {
                shift = e.shiftKey;
                character = String.fromCharCode(e.keyCode);
                if (shift) character = character.toUpperCase();
                else character = character.toLowerCase();
                value += character;
            }
        }

        placeholder = input.attribute('placeholder');
        if (!value && placeholder) {
            value = placeholder;
        }

        width = measureString(value, input) + 4;
        if (width !== currentWidth) {
            currentWidth = width;
            input[0].style.width = width + 'px';
            input.emit('resize');
        }
    };

    input.on('keydown', update);
    input.on('keyup', update);
    input.on('update', update);
    input.on('blur', update);

    update();
};

var Selectize = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        delimiter: ' ',
        splitOn: null, // regexp or string for splitting up values from a paste command
        persist: true,
        diacritics: true,
        create: false,
        createOnBlur: true,
        createFilter: null,
        highlight: true,
        openOnFocus: true,
        maxOptions: 1000,
        maxItems: null,
        hideSelected: null,
        addPrecedence: false,
        selectOnTab: false,
        preload: false,
        allowEmptyOption: false,
        closeAfterSelect: false,
        searchOnKeypress: true,

        scrollDuration: 60,
        loadThrottle: 300,
        loadingClass: 'g-loading',

        dataAttr: 'data-data',
        optgroupField: 'optgroup',
        valueField: 'value',
        labelField: 'text',
        optgroupLabelField: 'label',
        optgroupValueField: 'value',
        lockOptgroupOrder: false,

        sortField: '$order',
        searchField: ['text'],
        searchConjunction: 'and',

        mode: null,
        wrapperClass: 'g-selectize-control',
        inputClass: 'g-selectize-input',
        dropdownClass: 'g-selectize-dropdown',
        dropdownContentClass: 'g-selectize-dropdown-content',

        dropdownParent: null,

        copyClassesToDropdown: true,

        /*
         load            : null, // function(query, callback) { ... }
         score           : null, // function(search) { ... }
         onInitialize    : null, // function() { ... }
         onChange        : null, // function(value) { ... }
         onItemAdd       : null, // function(value, $item) { ... }
         onItemRemove    : null, // function(value) { ... }
         onClear         : null, // function() { ... }
         onOptionAdd     : null, // function(value, data) { ... }
         onOptionRemove  : null, // function(value) { ... }
         onOptionClear   : null, // function() { ... }
         onOptionGroupAdd     : null, // function(id, data) { ... }
         onOptionGroupRemove  : null, // function(id) { ... }
         onOptionGroupClear   : null, // function() { ... }
         onDropdownOpen  : null, // function($dropdown) { ... }
         onDropdownClose : null, // function($dropdown) { ... }
         onType          : null, // function(str) { ... }
         onDelete        : null, // function(values) { ... }
         */

        render: {
            /*
             item: null,
             optgroup: null,
             optgroup_header: null,
             option: null,
             option_create: null
             */
        }
    },

    constructor: function(input, options) {
        input = $(input);
        this.setOptions(options);

        // detect rtl environment
        var computedStyle = window.getComputedStyle && window.getComputedStyle(input[0], null);
        var dir = computedStyle ? computedStyle.getPropertyValue('direction') : input[0].currentStyle && input[0].currentStyle.direction;
        dir = dir || input.parents('[dir]:first').attr('dir') || '';

        this.rand = 'selectize-id-' + (Math.random() + 1).toString(36).substring(5);
        this.input = input;
        this.input.selectizeInstance = this;

        this.order = 0;
        this.tabIndex = input.attribute('tabindex') || '';
        this.tagType = input.tag() == 'select' ? TAG_SELECT : TAG_INPUT;
        this.rtl = /rtl/i.test(dir);
        this.highlightedValue = null;
        this.isRequired = input.attribute('required');
        forEach(['isOpen', 'isDisabled',  'isInvalid', 'isLocked', 'isFocused', 'isInputHidden', 'isSetup', 'isShiftDown', 'isCmdDown', 'isCtrlDown', 'ignoreFocus', 'ignoreBlur', 'ignoreHover', 'hasOptions'], function(option) {
            this[option] = false;
        }, this);
        this.currentResults = null;
        this.lastValue = '';
        this.caretPos = 0;
        this.loading = 0;
        this.loadedSearches = {};

        this.$activeOption = null;
        this.$activeItems = [];

        this.Optgroups = {};
        this.Options = {};
        this.UserOptions = {};
        this.items = [];
        this.renderCache = {};
        this.onSearchChange = this.options.loadThrottle === null ? this.onSearchChange : debounce(this.onSearchChange, this.options.loadThrottle);

        // search system
        this.sifter = new sifter(this.Options, { diacritics: this.options.diacritics });

        var i, n;

        // build options table
        if (this.options.Options) {
            for (i = 0, n = this.options.Options.length; i < n; i++) {
                this.registerOption(this.options.Options[i]);
            }
            delete this.options.Options;
        }

        // build optgroup table
        if (this.options.Optgroups) {
            for (i = 0, n = this.options.Optgroups.length; i < n; i++) {
                this.registerOptionGroup(this.options.Optgroups[i]);
            }
            delete this.options.Optgroups;
        }

        // option-demand defaults
        this.options.mode = this.options.mode || (this.options.maxItems === 1 ? 'single' : 'multi');
        if (!isBoolean(this.options.hideSelected)) { this.options.hideSelected = (this.options.mode === 'multi'); }

        this.setupCallbacks();
        this.setupTemplates();
        this.setup();

    },

    setup: function() {
        var $input = this.input,
            $wrapper,
            $control,
            $control_input,
            $dropdown,
            $dropdown_content,
            $dropdown_parent,
            inputMode,
            timeout_blur,
            timeout_focus,
            classes;

        inputMode = this.options.mode;
        classes = $input.attribute('class') || '';

        $wrapper = zen('div').addClass(this.options.wrapperClass).addClass(classes).addClass('g-' + inputMode).after(this.input);
        $control = zen('div').addClass(this.options.inputClass).addClass('g-items').bottom($wrapper);
        $control_input = zen('input[type="text"][autocomplete="off"][role="textbox"]').bottom($control).attribute('tabindex', $input.disabled() ? '-1' : this.tabIndex);
        $dropdown_parent = $(this.options.dropdownParent || $wrapper);
        $dropdown = zen('div').addClass(this.options.dropdownClass).addClass('g-' + inputMode).hide().bottom($dropdown_parent);
        $dropdown_content = zen('div[id="' + this.rand + '"]').addClass(this.options.dropdownContentClass).bottom($dropdown);

        if (this.options.copyClassesToDropdown) {
            $dropdown.addClass(classes);
        }

        if (inputMode == 'single') {
            $wrapper.style('width', parseInt($input[0].offsetWidth) + 12 + 24); // padding compensation
        }

        if ((this.options.maxItems === null || this.options.maxItems > 1) && this.tagType === TAG_SELECT) {
            $input.attribute('multiple', 'multiple');
        }

        if (this.options.placeholder) {
            $control_input.attribute('placeholder', this.options.placeholder);
        }

        // if splitOn was not passed in, construct it from the delimiter to allow pasting universally
        if (!this.options.splitOn && this.options.delimiter) {
            var delimiterEscaped = this.options.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
            this.options.splitOn = new RegExp('\\s*' + delimiterEscaped + '+\\s*');
        }

        if ($input.attribute('autocorrect')) {
            $control_input.attribute('autocorrect', $input.attribute('autocorrect'));
        }

        if ($input.attribute('autocapitalize')) {
            $control_input.attribute('autocapitalize', $input.attribute('autocapitalize'));
        }

        this.$wrapper = $wrapper;
        this.$control = $control;
        this.$control_input = $control_input;
        this.$dropdown = $dropdown;
        this.$dropdown_content = $dropdown_content;

        $dropdown.delegate('mouseover', '[data-selectable]', bind(function() { return this.onOptionHover.apply(this, arguments); }, this));
        $dropdown.delegate('mousedown', '[data-selectable]', bind(function() { return this.onOptionSelect.apply(this, arguments); }, this));
        $dropdown.delegate('click', '[data-selectable]', bind(function() { return this.onOptionSelect.apply(this, arguments); }, this));

        autoGrow($control_input);

        $control.delegate('mousedown', '*:not(input)', bind(function(event, element) {
            if (element == $control) { return true; }
            return this.onItemSelect.apply(this, arguments);
        }, this));

        $control.on('mousedown', bind(function() { return this.onMouseDown.apply(this, arguments); }, this));
        $control.on('click', bind(function() { return this.onClick.apply(this, arguments); }, this));
        $control.delegate('click', '.g-remove-single-item', bind(function() { return this.onItemRemoveViaX.apply(this, arguments); }, this));

        $control_input.on('mousedown', function(e) { e.stopPropagation(); });
        $control_input.on('keydown', bind(function() { return this.onKeyDown.apply(this, arguments); }, this));
        $control_input.on('keyup', bind(function() { return this.onKeyUp.apply(this, arguments); }, this));
        $control_input.on('keypress', bind(function() { return this.onKeyPress.apply(this, arguments); }, this));
        $control_input.on('resize', bind(function() { this.positionDropdown.apply(this, []); }, this));
        $control_input.on('blur', bind(function() { return this.onBlur.apply(this, arguments); }, this));
        $control_input.on('focus', bind(function() {
            this.ignoreBlur = false;
            return this.onFocus.apply(this, arguments);
        }, this));
        $control_input.on('paste', bind(function() { return this.onPaste.apply(this, arguments); }, this));

        $(document).on('keydown', bind(function(e) {
            this.isCmdDown = e[IS_MAC ? 'metaKey' : 'ctrlKey'];
            this.isCtrlDown = e[IS_MAC ? 'altKey' : 'ctrlKey'];
            this.isShiftDown = e.shiftKey;
        }, this));

        $(document).on('keyup', bind(function(e) {
            if (e.keyCode === KEY_CTRL) this.isCtrlDown = false;
            if (e.keyCode === KEY_SHIFT) this.isShiftDown = false;
            if (e.keyCode === KEY_CMD) this.isCmdDown = false;
        }, this));

        $(document).on('mousedown', bind(function(e) {
            if (this.isFocused) {
                // prevent events on the dropdown scrollbar from causing the control to blur
                if (e.target === this.$dropdown[0] || e.target.parentNode === this.$dropdown[0]) {
                    e.preventDefault();
                    return false;
                }
                // blur on click outside
                if (!this.$control.find($(e.target)) && e.target !== this.$control[0]) {
                    this.blur(e.target);
                }
            }
        }, this));

        $(window).on('scroll', bind(function() {
            if (this.isOpen) {
                this.positionDropdown.apply(this, arguments);
            }
        }, this));
        $(window).on('resize', bind(function() {
            if (this.isOpen) {
                this.positionDropdown.apply(this, arguments);
            }
        }, this));
        $(window).on('mousemove', bind(function() {
            this.ignoreHover = false;
        }, this));

        // store original children and tab index so that they can be
        // restored when the destroy() method is called.
        this.revertSettings = {
            $children: this.input.children(),//.detach(),
            tabindex: this.input.attribute('tabindex')
        };

        this.input.attribute('tabindex', -1).attribute('aria-hidden', true).hide().after($wrapper);

        if (isArray(this.options.items)) {
            this.setValue(this.options.items);
            delete this.options.items;
        }

        // feature detect for the validation API
        if (SUPPORTS_VALIDITY_API) {
            this.input.on('invalid', bind(function(e) {
                e.preventDefault();
                this.isInvalid = true;
                this.refreshState();
            }, this));
        }

        this.updateOriginalInput();
        this.refreshItems();
        this.refreshState();
        this.updatePlaceholder();
        this.isSetup = true;

        if (this.input.disabled()) {
            this.disable();
        }

        this.on('change', this.onChange);

        this.input.selectizeInstance = this;
        this.input.addClass('selectized');
        this.emit('initialize');

        // preload options
        if (this.options.preload === true) {
            this.onSearchChange('');
        }
        // ARIA
        $wrapper
            .attribute('role', 'combobox')
            .attribute('aria-autocomplete', 'list')
            .attribute('aria-haspopup', true)
            .attribute('aria-expanded', false)
            .attribute('aria-labelledby', this.rand + '-' + slugify(this.getValue()));

        $dropdown_content
            .attribute('role', 'tree')
            .attribute('aria-expanded', false)
            .attribute('aria-hidden', true);


    },

    setupTemplates: function() {
        var field_label    = this.options.labelField,
            field_value    = this.options.valueField,
            field_optgroup = this.options.optgroupLabelField,
            mode           = this.options.mode;

        var templates = {
            'optgroup': function(data) {
                return '<div class="g-optgroup">' + data.html + '</div>';
            },
            'optgroup_header': function(data, escape) {
                return '<div class="g-optgroup-header">' + escape(data[field_optgroup]) + '</div>';
            },
            'option': function(data, escape) {
                var label = '<div class="g-option">' + escape(data[field_label]) + '</div>';
                if (this.options.Subtitles) {
                    label = '<div class="g-option"><span>' + escape(data[field_label]) + '</span> <div class="g-option-subtitle"><small>' + escape(data[field_value]) + '</small></div></div>';
                }
                return label;
            },
            'item': function(data, escape) {
                var removeButton = '',
                    title = escape(data[field_value]);

                if (mode !== 'single') {
                    removeButton = '<span  class="g-remove-single-item" tabindex="-1" title="Remove">&times;</span></div>';
                }

                if (this.options.Subtitles) {
                    title = 'class name: ' + title;
                }

                return '<div class="g-item" title="' + title + '">' + escape(data[field_label]) + removeButton;
            },
            'option_create': function(data, escape) {
                return '<div class="g-create">Add <strong>' + escape(data.input) + '</strong>&hellip;</div>';
            }
        };

        this.options.render = merge({}, templates, this.options.render);
    },

    setupCallbacks: function() {
        var key, fn, callbacks = {
            'initialize': 'onInitialize',
            'change': 'onChange',
            'item_add': 'onItemAdd',
            'item_remove': 'onItemRemove',
            'clear': 'onClear',
            'option_add': 'onOptionAdd',
            'option_remove': 'onOptionRemove',
            'option_clear': 'onOptionClear',
            'optgroup_add': 'onOptionGroupAdd',
            'optgroup_remove': 'onOptionGroupRemove',
            'optgroup_clear': 'onOptionGroupClear',
            'dropdown_open': 'onDropdownOpen',
            'dropdown_close': 'onDropdownClose',
            'type': 'onType',
            'load': 'onLoad',
            'focus': 'onFocus',
            'blur': 'onBlur'
        };

        for (key in callbacks) {
            if (callbacks.hasOwnProperty(key)) {
                fn = this.options[callbacks[key]];
                if (fn) { this.on(key, fn); }
            }
        }
    },



    onClick: function(e) {
        // necessary for mobile webkit devices (manual focus triggering
        // is ignored unless invoked within a click event)
        if (!this.isFocused) {
            this.focus();
            e.preventDefault();
        }
    },

    onMouseDown: function(e) {
        var defaultPrevented = e.defaultPrevented || (typeof e.defaultPrevented === 'undefined');
        var $target = $(e.target);

        if (this.isFocused) {
            // retain focus by preventing native handling. if the
            // event target is the input it should not be modified.
            // otherwise, text selection within the input won't work.
            if (e.target !== this.$control_input[0]) {
                if (this.options.mode === 'single') {
                    // toggle dropdown
                    this.isOpen ? this.close() : this.open();
                } else if (!defaultPrevented) {
                    this.setActiveItem(null);
                }

                /*e.preventDefault();
                 e.stopPropagation();*/
                return false;
            }
        } else {
            // give control focus
            if (!defaultPrevented) {
                window.setTimeout(bind(function() {
                    this.focus();
                }, this), 0);
            }
        }
    },

    onChange: function() {
        this.input.emit('change', this.input.value(), this);
        $('body').emit('change', { target: this.input });
    },

    onPaste: function(e) {
        if (this.isFull() || this.isInputHidden || this.isLocked) {
            e.preventDefault();
        } else {
            // If a regex or string is included, this will split the pasted
            // input and create Items for each separate value
            if (this.options.splitOn) {
                setTimeout(bind(function() {
                    var splitInput = trim(this.$control_input.value() || '').split(this.options.splitOn);
                    for (var i = 0, n = splitInput.length; i < n; i++) {
                        this.createItem(splitInput[i]);
                    }
                }, this), 0);
            }
        }
    },

    onKeyPress: function(e) {
        if (this.isLocked) return e && e.preventDefault();
        var character = String.fromCharCode(e.keyCode || e.which);
        if (this.options.create && this.options.mode === 'multi' && character === this.options.delimiter) {
            this.createItem();
            e.preventDefault();
            return false;
        }
    },

    onKeyDown: function(e) {
        var isInput = e.target === this.$control_input[0];

        if (this.isLocked) {
            if (e.keyCode !== KEY_TAB) {
                e.preventDefault();
            }
            return;
        }

        switch (e.keyCode) {
            case KEY_A:
                if (this.isCmdDown) {
                    this.selectAll();
                    return;
                }
                break;
            case KEY_ESC:
                if (this.isOpen) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.close();
                    //this.blur();
                }
                return;
            case KEY_N:
                if (!e.ctrlKey || e.altKey) break;
            case KEY_DOWN:
                if (!this.isOpen && this.hasOptions) {
                    this.open();
                } else if (this.$activeOption) {
                    this.ignoreHover = true;
                    var $next = this.getAdjacentOption(this.$activeOption, 1);
                    if ($next) { this.setActiveOption($next, true, true); }
                }
                e.preventDefault();
                return;
            case KEY_P:
                if (!e.ctrlKey || e.altKey) break;
            case KEY_UP:
                if (this.$activeOption) {
                    this.ignoreHover = true;
                    var $prev = this.getAdjacentOption(this.$activeOption, -1);
                    if ($prev) { this.setActiveOption($prev, true, true); }
                }
                e.preventDefault();
                return;
            case KEY_RETURN:
                if (this.isOpen && this.$activeOption) {
                    this.onOptionSelect({ currentTarget: this.$activeOption });
                    e.preventDefault();
                }
                return;
            case KEY_LEFT:
                this.advanceSelection(-1, e);
                return;
            case KEY_RIGHT:
                this.advanceSelection(1, e);
                return;
            case KEY_TAB:
                if (this.options.selectOnTab && this.isOpen && this.$activeOption) {
                    this.onOptionSelect({ currentTarget: this.$activeOption });

                    // Default behaviour is to jump to the next field, we only want this
                    // if the current field doesn't accept any more entries
                    if (!self.isFull()) {
                        e.preventDefault();
                    }
                }
                if (this.options.create && this.createItem()) {
                    e.preventDefault();
                }
                return;
            case KEY_BACKSPACE:
            case KEY_DELETE:
                this.deleteSelection(e);
                return;
        }

        if ((this.isFull() || this.isInputHidden) && !(IS_MAC ? e.metaKey : e.ctrlKey)) {
            e.preventDefault();
            return;
        }
    },

    onKeyUp: function(e) {

        if (this.isLocked) return e && e.preventDefault();
        var value = this.$control_input.value() || '';
        if (this.lastValue !== value) {
            this.lastValue = value;
            this.onSearchChange(value);
            this.refreshOptions();
            this.emit('type', value);
        }
    },

    onSearchChange: function(value) {
        var fn = this.options.load;
        if (!fn) return;
        if (this.loadedSearches.hasOwnProperty(value)) return;
        this.loadedSearches[value] = true;
        this.load(bind(function(callback) {
            fn.apply(this, [value, callback]);
        }, this));
    },

    onFocus: function(e) {
        var wasFocused = this.isFocused;

        if (this.isDisabled) {
            this.blur();
            e && e.preventDefault();
            return false;
        }

        if (this.ignoreFocus) return;
        this.isFocused = true;
        if (this.options.preload === 'focus') this.onSearchChange('');

        if (!wasFocused) this.emit('focus');

        if (!this.$activeItems.length) {
            this.showInput();
            this.setActiveItem(null);
            this.refreshOptions(!!this.options.openOnFocus);
        }

        this.refreshState();
    },

    onBlur: function(e, dest) {
        if (!this.isFocused) return;
        this.isFocused = false;

        if (this.ignoreFocus) {
            return;
        } else if (!this.ignoreBlur && (document.activeElement === this.$dropdown_content[0])) {
            // ^- g5 custom [before: no e.target && ..]
            // necessary to prevent IE closing the dropdown when the scrollbar is clicked
            this.ignoreBlur = true;
            this.onFocus(e);
            return;
        }

        var deactivate = bind(function() {
            this.close();
            this.setTextboxValue('');
            this.setActiveItem(null);
            this.setActiveOption(null);
            this.setCaret(this.items.length);
            this.refreshState();

            dest && dest.focus();

            this.ignoreFocus = false;
            this.emit('blur');

        }, this);

        this.ignoreFocus = true;
        if (this.options.create && this.options.createOnBlur) {
            this.createItem(null, false, deactivate);
        } else {
            deactivate();
        }
    },

    onOptionHover: function(e, element) {
        element = $(element);
        if (this.ignoreHover) return;
        this.setActiveOption(element || e.currentTarget, false);
    },

    onOptionSelect: function(e, element) {
        var value, $target, $option, self = this;

        if (e.preventDefault) {
            e.preventDefault();
            e.stopPropagation();
        }

        $target = $(element || e.currentTarget);
        if ($target.hasClass('g-create')) {
            this.createItem(null, bind(function() {
                if (this.options.closeAfterSelect) {
                    this.close();
                }
            }, this));
        } else {
            value = $target.attribute('data-value');
            if (typeof value !== 'undefined') {
                this.lastQuery = null;
                this.setTextboxValue('');
                this.addItem(value);
                if (this.options.closeAfterSelect) {
                    this.close();
                } else if (!this.options.hideSelected && e.type && /mouse/.test(e.type)) {
                    this.setActiveOption(this.getOption(value));
                }
            }
        }
    },

    onItemSelect: function(e, element) {
        if (this.isLocked) return;
        if (this.options.mode === 'multi') {
            e.preventDefault();
            this.setActiveItem(element || e.currentTarget, e);
        }
    },

    onItemRemoveViaX: function(e, element) {
        e.preventDefault();
        if (this.isLocked || this.options.mode == 'single') return;

        var $item = element.parent();
        this.setActiveItem($item);
        if (this.deleteSelection()) {
            this.setCaret(this.items.length);
        }
    },

    load: function(fn) {
        var $wrapper = this.$wrapper.addClass(this.options.loadingClass);

        this.loading++;
        fn.apply(this, [bind(function(results) {
            this.loading = Math.max(this.loading - 1, 0);
            if (results && results.length) {
                this.addOption(results);
                this.refreshOptions(this.isFocused && !this.isInputHidden);
            }
            if (!this.loading) {
                $wrapper.removeClass(this.options.loadingClass);
            }
            this.emit('load', results);
        }, this)]);
    },

    setTextboxValue: function(value) {
        var $input = this.$control_input;
        var changed = $input.value() !== value;
        if (changed) {
            $input.value(value).emit('update');
            this.lastValue = value;
        }
    },

    getValue: function(value) {
        // g5 custom
        if (this.tagType === TAG_SELECT && this.input.attribute('multiple')) {
            return value || this.items;
        } else {
            return (value || this.items).join(this.options.delimiter);
        }
    },

    setValue: function(value, silent) {
        var events = silent ? [] : ['change'];

        debounce_events(this, events, function() {
            this.clear(silent);
            this.previousValue = this.getValue() || value;
            this.addItems(value, silent);
        });
    },

    setActiveItem: function(item, e) {
        var eventName, idx, begin, end, $item, swap, $last;

        if (this.options.mode === 'single') { return; }
        item = $(item);

        // clear the active selection
        if (!item) {
            if (this.$activeItems.length) { $(this.$activeItems).removeClass('g-active'); }
            this.$activeItems = [];
            if (this.isFocused) {
                this.showInput();
            }
            return;
        }

        // modify selection
        eventName = e && e.type.toLowerCase();

        if (eventName === 'mousedown' && this.isShiftDown && this.$activeItems.length) {
            $last = $(last(this.$control.children('.g-active')));
            begin = Array.prototype.indexOf.apply(this.$control[0].childNodes, [$last[0]]);
            end = Array.prototype.indexOf.apply(this.$control[0].childNodes, [item[0]]);
            if (begin > end) {
                swap = begin;
                begin = end;
                end = swap;
            }
            for (var i = begin; i <= end; i++) {
                $item = this.$control[0].childNodes[i];
                if (this.$activeItems.indexOf($item) === -1) {
                    $($item).addClass('g-active');
                    this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + $($item).attribute('data-value')));
                    this.$activeItems.push($item);
                }
            }
            e.preventDefault();
        } else if ((eventName === 'mousedown' && this.isCtrlDown) || (eventName === 'keydown' && this.isShiftDown)) {
            if (item.hasClass('g-active')) {
                idx = this.$activeItems.indexOf(item[0]);
                this.$activeItems.splice(idx, 1);
                item.removeClass('g-active');
            } else {
                this.$activeItems.push(item.addClass('g-active')[0]);
                this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + item.attribute('data-value')));
            }
        } else {
            if ($(this.$activeItems)) $(this.$activeItems).removeClass('g-active');
            this.$activeItems = [item.addClass('g-active')[0]];
            this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + item.attribute('data-value')));
        }

        // ensure control has focus
        this.hideInput();
        if (!this.isFocused) {
            this.focus();
        }
    },

    setActiveOption: function($option, scroll, animate) {
        var height_menu, height_item, y;
        var scroll_top, scroll_bottom;

        if (this.$activeOption) this.$activeOption.removeClass('g-active');
        this.$activeOption = null;

        $option = $($option);
        if (!$option) return;

        this.$activeOption = $option.addClass('g-active');
        this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + $option.attribute('data-value')));

        if (scroll || !isset(scroll)) {

            height_menu = this.$dropdown_content[0].offsetHeight;
            height_item = this.$activeOption[0].offsetHeight;
            scroll = this.$dropdown_content[0].scrollTop || 0;
            y = this.$activeOption.position().top - this.$dropdown_content.position().top + scroll;
            scroll_top = y;
            scroll_bottom = y - height_menu + height_item;

            if (y + height_item > height_menu + scroll) {
                this.$dropdown_content[0].scrollTop = scroll_bottom;
                /*moofx(bind(function(value){
                 this.$dropdown_content[0].scrollTop = value;
                 }, this), {
                 duration: animate ? this.options.scrollDuration : 0,
                 equation: 'linear'
                 }).start(scroll, scroll_bottom);*/
            } else if (y < scroll) {
                this.$dropdown_content[0].scrollTop = scroll_top;
                /*moofx(bind(function(value){
                 this.$dropdown_content[0].scrollTop = value;
                 }, this), {
                 duration: animate ? this.options.scrollDuration : 0,
                 equation: 'linear'
                 }).start(scroll, scroll_top);*/
            }

        }
    },

    selectAll: function() {
        if (this.options.mode === 'single') return;

        var items = this.$control.children(':not(input)');
        if (items) {
            items.addClass('g-active');
            this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + items.attribute('data-value')));
        }

        this.$activeItems = Array.prototype.slice.apply(items || []);
        if (this.$activeItems.length) {
            this.hideInput();
            this.close();
        }
        this.focus();
    },

    hideInput: function() {

        this.setTextboxValue('');
        this.$control_input.style({
            opacity: 0,
            position: 'absolute',
            left: this.rtl ? 10000 : -10000
        });
        this.isInputHidden = true;
    },

    showInput: function() {
        this.$control_input.style({
            opacity: 1,
            position: 'relative',
            left: 0
        });
        this.isInputHidden = false;
    },

    focus: function() {
        if (this.isDisabled) { return; }

        this.ignoreFocus = true;
        this.$control_input[0].focus();
        setTimeout(bind(function() {
            this.ignoreFocus = false;
            this.onFocus();
        }, this), 0);
    },

    blur: function(dest) {
        this.$control_input[0].blur();
        this.onBlur(null, dest);
        // g5 custom
        //this.$control_input[0].blur();
    },

    getScoreFunction: function(query) {
        return this.sifter.getScoreFunction(query, this.getSearchOptions());
    },

    getSearchOptions: function() {
        var sort = this.options.sortField;
        if (typeof sort === 'string') {
            sort = [{ field: sort }];
        }

        return {
            fields: this.options.searchField,
            conjunction: this.options.searchConjunction,
            sort: sort
        };
    },

    search: function(query) {
        var i, value, score, result, calculateScore;
        var options = this.getSearchOptions();

        // validate user-provided result scoring function
        if (this.options.score) {
            calculateScore = this.options.score.apply(this, [query]);
            if (typeof calculateScore !== 'function') {
                throw new Error('Selectize "score" setting must be a function that returns a function');
            }
        }

        // perform search
        if (query !== this.lastQuery) {
            this.lastQuery = query;
            result = this.sifter.search(query, merge(options, { score: calculateScore }));
            this.currentResults = result;
        } else {
            result = merge({}, this.currentResults);
        }

        // filter out selected items
        if (this.options.hideSelected) {
            for (i = result.items.length - 1; i >= 0; i--) {
                if (this.items.indexOf(hash_key(result.items[i].id)) !== -1) {
                    result.items.splice(i, 1);
                }
            }
        }

        return result;
    },

    refreshOptions: function(triggerDropdown) {
        var i, j, k, n, groups, groups_order, option, option_html, optgroup, optgroups, html, html_children, has_create_option;
        var $active, $active_before, $create;

        if (typeof triggerDropdown === 'undefined') {
            triggerDropdown = true;
        }

        var query = trim(this.$control_input.value());
        var results = this.search(query);
        var $dropdown_content = this.$dropdown_content;
        var active_before = this.$activeOption && hash_key(this.$activeOption.attribute('data-value'));

        // build markup
        n = results.items.length;
        if (typeof this.options.maxOptions === 'number') {
            n = Math.min(n, this.options.maxOptions);
        }

        // render and group available options individually
        groups = {};
        groups_order = [];

        // g5 custom
        //if (this.options.optgroupOrder) {
        //    groups_order = this.options.optgroupOrder;
        //    for (i = 0; i < groups_order.length; i++) {
        //        groups[groups_order[i]] = [];
        //    }
        //} else {
        //    groups_order = [];
        //}

        for (i = 0; i < n; i++) {
            option = this.Options[results.items[i].id];
            option_html = this.render('option', option);
            optgroup = option[this.options.optgroupField] || '';
            optgroups = isArray(optgroup) ? optgroup : [optgroup];

            for (j = 0, k = optgroups && optgroups.length; j < k; j++) {
                optgroup = optgroups[j];
                if (!this.Optgroups.hasOwnProperty(optgroup)) {
                    optgroup = '';
                }
                if (!groups.hasOwnProperty(optgroup)) {
                    groups[optgroup] = document.createDocumentFragment();
                    groups_order.push(optgroup);
                }
                groups[optgroup].appendChild(option_html);
            }
        }

        // sort optgroups
        if (this.options.lockOptgroupOrder) {
            groups_order.sort(function(a, b) {
                var a_order = this.Optgroups[a].$order || 0;
                var b_order = this.Optgroups[b].$order || 0;
                return a_order - b_order;
            });
        }

        // render optgroup headers & join groups
        html = document.createDocumentFragment();
        for (i = 0, n = groups_order.length; i < n; i++) {
            optgroup = groups_order[i];
            if (this.Optgroups.hasOwnProperty(optgroup) && groups[optgroup].childNodes.length) {
                // render the optgroup header and options within it,
                // then pass it to the wrapper template
                html_children = document.createDocumentFragment();
                html_children.appendChild(this.render('optgroup_header', this.Optgroups[optgroup]));
                html_children.appendChild(groups[optgroup]);
                html.appendChild(this.render('optgroup', merge({}, this.Optgroups[optgroup], {
                    html: domToString(html_children),
                    dom: html_children
                })));
            } else {
                html.appendChild(groups[optgroup]);
            }
        }

        $dropdown_content.html(domToString(html));

        // highlight matching terms inline
        if (this.options.highlight && results.query.length && results.tokens.length) {
            for (i = 0, n = results.tokens.length; i < n; i++) {
                highlight($dropdown_content, results.tokens[i].regex);
            }
        }

        // add "selected" class to selected options
        if (!this.options.hideSelected) {
            for (i = 0, n = this.items.length; i < n; i++) {
                this.getOption(this.items[i]).addClass('g-selected').attribute('aria-selected', true);
            }
        }

        // add create option
        has_create_option = this.canCreate(query);
        if (has_create_option) {
            //$dropdown_content.prepend(this.render('option_create', { input: query }));
            $(this.render('option_create', { input: query })).top($dropdown_content);
            $create = $($dropdown_content[0].childNodes[0]);
        }

        // activate
        this.hasOptions = results.items.length > 0 || has_create_option;
        if (this.hasOptions) {
            if (results.items.length > 0) {
                $active_before = active_before && this.getOption(active_before);
                if ($active_before && $active_before.length) {
                    $active = $active_before;
                } else if (this.options.mode === 'single' && this.items.length) {
                    $active = this.getOption(this.items[0]);
                }
                if (!$active || !$active.length) {
                    if ($create && !this.options.addPrecedence) {
                        $active = this.getAdjacentOption($create, 1);
                    } else {
                        $active = $dropdown_content.find('[data-selectable]:first-child');
                    }
                }
            } else {
                $active = $create;
            }
            this.setActiveOption($active);
            if (triggerDropdown && !this.isOpen) { this.open(); }
        } else {
            this.setActiveOption(null);
            if (triggerDropdown && this.isOpen) { this.close(); }
        }
    },

    addOption: function(data) {
        var value;

        if (isArray(data)) {
            for (var i = 0, n = data.length; i < n; i++) {
                this.addOption(data[i]);
            }
            return;
        }

        if (value = this.registerOption(data)) {
            this.UserOptions[value] = true;
            this.lastQuery = null;
            this.emit('option_add', value, data);
        }

        // g5 custom
        /*value = hash_key(data[this.options.valueField]);
         if (typeof value !== 'string' || this.Options.hasOwnProperty(value)) return;

         this.UserOptions[value] = true;
         this.Options[value] = data;
         this.lastQuery = null;
         this.emit('option_add', value, data);*/
    },

    registerOption: function(data) {
        var key = hash_key(data[this.options.valueField]);
        if ((!key && !this.options.allowEmptyOption) || this.options.hasOwnProperty(key)) return false;
        data.$order = data.$order || ++this.order;
        this.Options[key] = data;

        return key;
    },

    registerOptionGroup: function(data) {
        var key = hash_key(data[this.options.optgroupValueField]);
        if (!key) return false;

        data.$order = data.$order || ++this.order;
        this.Optgroups[key] = data;

        return key;
    },


    addOptionGroup: function(id, data) {
        data[this.options.optgroupValueField] = id;
        if (id = this.registerOptionGroup(data)) {
            this.emit('optgroup_add', id, data);
        }
    },

    removeOptionGroup: function(id) {
        if (this.Optgroups.hasOwnProperty(id)) {
            delete this.Optgroups[id];
            this.renderCache = {};
            this.emit('optgroup_remove', id);
        }
    },

    clearOptionGroups: function() {
        this.Optgroups = {};
        this.renderCache = {};
        this.emit('optgroup_clear');
    },

    updateOption: function(value, data) {
        var self = this;
        var $item, $item_new, dummy;
        var value_new, index_item, cache_items, cache_options, order_old;

        value = hash_key(value);
        value_new = hash_key(data[this.options.valueField]);

        // sanity checks
        if (value === null) return;
        if (!this.Options.hasOwnProperty(value)) return;
        if (typeof value_new !== 'string') throw new Error('Value must be set in option data');

        order_old = this.Options[value].$order;

        // update references
        if (value_new !== value) {
            delete this.Options[value];
            index_item = this.items.indexOf(value);
            if (index_item !== -1) {
                this.items.splice(index_item, 1, value_new);
            }
        }
        data.$order = data.$order || order_old;
        this.Options[value_new] = data;

        // invalidate render cache
        cache_items = this.renderCache['item'];
        cache_options = this.renderCache['option'];

        if (cache_items) {
            delete cache_items[value];
            delete cache_items[value_new];
        }
        if (cache_options) {
            delete cache_options[value];
            delete cache_options[value_new];
        }

        // update the item if it's selected
        if (this.items.indexOf(value_new) !== -1) {
            $item = this.getItem(value);
            $item_new = $(this.render('item', data));
            if ($item.hasClass('g-active')) {
                $item_new.addClass('g-active');
                this.$wrapper.attribute('aria-activedescendant', slugify(this.rand + '-' + $item_new.attribute('data-value')));
            }

            $item_new.after($item);
            $item.remove();
        }

        // invalidate last query because we might have updated the sortField
        this.lastQuery = null;

        // update dropdown contents
        if (this.isOpen) {
            this.refreshOptions(false);
        }
    },

    removeOption: function(value, silent) {
        value = hash_key(value);

        var cache_items = this.renderCache['item'];
        var cache_options = this.renderCache['option'];
        if (cache_items) delete cache_items[value];
        if (cache_options) delete cache_options[value];

        delete this.UserOptions[value];
        delete this.Options[value];
        this.lastQuery = null;
        this.emit('option_remove', value);
        this.removeItem(value, silent);
    },

    clearOptions: function() {
        this.loadedSearches = {};
        this.UserOptions = {};
        this.renderCache = {};
        this.Options = this.sifter.items = {};
        this.lastQuery = null;
        this.emit('option_clear');
        this.clear();
    },

    getOption: function(value) {
        return this.getElementWithValue(value, this.$dropdown_content.search('[data-selectable]'));
    },

    getAdjacentOption: function($option, direction) {
        var $options = this.$dropdown.search('[data-selectable]');
        var index = indexOf($options, ($option ? $option[0] : null)) + direction;

        return index >= 0 && index < ($options ? $options.length : 0) ? $($options[index]) : $();
    },

    getElementWithValue: function(value, $els) {
        value = hash_key(value);

        if (typeof value !== 'undefined' && value !== null) {
            for (var i = 0, n = ($els ? $els.length : 0); i < n; i++) {
                if ($els[i].getAttribute('data-value') === value) {
                    return $($els[i]);
                }
            }
        }

        return $();
    },

    getItem: function(value) {
        return this.getElementWithValue(value, this.$control.children());
    },

    addItems: function(values, silent) {
        var items = isArray(values) ? values : [values];
        for (var i = 0, n = items.length; i < n; i++) {
            this.isPending = (i < n - 1);
            this.addItem(items[i], silent);
        }
    },

    addItem: function(value, silent) {
        var events = silent ? [] : ['change'];

        debounce_events(this, events, function() {
            var $item, $option, $options;
            var inputMode = this.options.mode;
            var i, active, value_next, wasFull;
            value = hash_key(value);

            if (this.items.indexOf(value) !== -1) {
                // g5 custom [before: && this.isOpen]
                if (inputMode === 'single') this.close();
                return;
            }

            if (!this.Options.hasOwnProperty(value)) return;
            if (inputMode === 'single') this.clear(silent);
            if (inputMode === 'multi' && this.isFull()) return;

            $item = $(this.render('item', this.Options[value]));
            // if (inputMode !== 'multi') $item.find('.g-remove-single-item').remove();

            // ARIA
            $item.attribute('id', this.rand + '-' + slugify($item.attribute('data-value')));
            if (inputMode === 'multi') $item.attribute('aria-selected', true);

            wasFull = this.isFull();
            this.items.splice(this.caretPos, 0, value);
            this.insertAtCaret($item);
            if (!this.isPending || (!wasFull && this.isFull())) {
                this.refreshState();
            }

            if (this.isSetup) {
                $options = this.$dropdown_content.search('[data-selectable]');

                // update menu / remove the option (if this is not one item being added as part of series)
                if (!this.isPending) {
                    $option = this.getOption(value);
                    var adj = this.getAdjacentOption($option, 1);
                    value_next = (adj) ? adj.attribute('data-value') : null;
                    this.refreshOptions(this.isFocused && inputMode !== 'single');
                    if (value_next) {
                        this.setActiveOption(this.getOption(value_next));
                    }
                }

                // hide the menu if the maximum number of items have been selected or no options are left
                if (!$options || this.isFull()) {
                    this.close();
                } else {
                    this.positionDropdown();
                }

                this.updatePlaceholder();
                this.emit('item_add', value, $item);
                this.updateOriginalInput({ silent: silent });
            }
        });
    },

    removeItem: function(value, silent) {
        var $item, i, idx;

        $item = (value instanceof $) ? value : this.getItem(value);
        value = hash_key($item.attribute('data-value'));
        i = this.items.indexOf(value);

        if (i !== -1) {
            $item.remove();
            if ($item.hasClass('g-active')) {
                idx = this.$activeItems.indexOf($item[0]);
                this.$activeItems.splice(idx, 1);
            }

            this.items.splice(i, 1);
            this.lastQuery = null;
            if (!this.options.persist && this.UserOptions.hasOwnProperty(value)) {
                this.removeOption(value, silent);
            }

            if (i < this.caretPos) {
                this.setCaret(this.caretPos - 1);
            }

            this.refreshState();
            this.updatePlaceholder();
            this.updateOriginalInput({ silent: silent });
            this.positionDropdown();
            this.emit('item_remove', value, $item);
        }
    },

    createItem: function(input, triggerDropdown) {
        var caret = this.caretPos;
        input = input || trim(this.$control_input.value() || '');

        var callback = arguments[arguments.length - 1];
        if (typeof callback !== 'function') callback = function() {};

        if (!isBoolean(triggerDropdown)) {
            triggerDropdown = true;
        }

        if (!this.canCreate(input)) {
            callback();
            return false;
        }

        this.lock();

        var setup = (typeof this.options.create === 'function') ? this.options.create : bind(function(input) {
            var data = {};
            data[this.options.labelField] = input;
            data[this.options.valueField] = input;
            return data;
        }, this);

        var create = once(bind(function(data) {
            this.unlock();

            if (!data || typeof data !== 'object') return callback();
            var value = hash_key(data[this.options.valueField]);
            if (typeof value !== 'string') return callback();

            this.setTextboxValue('');
            this.addOption(data);
            this.setCaret(caret);
            this.addItem(value);
            this.refreshOptions(triggerDropdown && this.options.mode !== 'single');
            callback(data);
        }, this));

        var output = setup.apply(this, [input, create]);
        if (typeof output !== 'undefined') {
            create(output);
        }

        return true;
    },

    refreshItems: function() {
        this.lastQuery = null;

        if (this.isSetup) {
            this.addItem(this.items);
        }

        this.refreshState();
        this.updateOriginalInput();
    },

    refreshState: function() {
        var invalid;
        if (this.isRequired) {
            if (this.items.length) this.isInvalid = false;
            this.$control_input.attribute('required', this.isInvalid || null);
        }
        this.refreshClasses();
    },

    refreshClasses: function() {
        var isFull   = this.isFull(),
            isLocked = this.isLocked;

        this.$wrapper.toggleClass('g-rtl', this.rtl);

        this.$control.toggleClass('g-focus', this.isFocused);
        this.$control.toggleClass('g-disabled', this.isDisabled);
        this.$control.toggleClass('g-required', this.isRequired);
        this.$control.toggleClass('g-invalid', this.isInvalid);
        this.$control.toggleClass('g-locked', isLocked);
        this.$control.toggleClass('g-full', isFull);
        this.$control.toggleClass('g-not-full', !isFull);
        this.$control.toggleClass('g-input-active', this.isFocused && !this.isInputHidden);
        this.$control.toggleClass('g-dropdown-active', this.isOpen);
        this.$control.toggleClass('g-has-options', !size(this.options.Options));
        this.$control.toggleClass('g-has-items', this.items.length > 0);

        // ARIA
        if (this.isOpen) {
            this.$wrapper
                .attribute('aria-owns', this.rand)
                .attribute('aria-activedescendant', slugify(this.rand + '-' + this.getValue()))
                .attribute('aria-expanded', true);

            this.$dropdown_content
                .attribute('aria-expanded', true)
                .attribute('aria-hidden', false);
        } else {
            this.$wrapper
                .attribute('aria-owns', null)
                .attribute('aria-activedescendant', null)
                .attribute('aria-expanded', false);

            this.$dropdown_content
                .attribute('aria-expanded', false)
                .attribute('aria-hidden', true);
        }

        this.$control_input.selectizeGrow = !isFull && !isLocked;
    },

    isFull: function() {
        return this.options.maxItems !== null && this.items.length >= this.options.maxItems;
    },

    updateOriginalInput: function(opts) {
        var options, label;
        opts = opts || {};

        if (this.tagType === TAG_SELECT) {
            options = [];
            for (var i = 0, n = this.items.length; i < n; i++) {
                label = this.Options[this.items[i]][this.options.labelField] || '';
                options.push('<option value="' + escapeHTML(this.items[i]) + '" selected="selected">' + escapeHTML(label) + '</option>');
            }
            if (!options.length && !this.input.attribute('multiple')) {
                options.push('<option value="" selected="selected"></option>');
            }
            this.input.html(options.join(''));
        } else {
            this.input.value(this.getValue());
            this.input.attribute('value', this.input.value());
        }

        if (this.isSetup && !opts.silent) {
            this.emit('change', this.input.value());
        }
    },

    updatePlaceholder: function() {
        if (!this.options.placeholder) return;
        var control_input = this.$control_input;

        if (this.items.length) {
            control_input.attribute('placeholder', null);
        } else {
            control_input.attribute('placeholder', this.options.placeholder);
        }
        control_input.emit('update', { force: true });
    },

    open: function() {
        if (this.isLocked || this.isOpen || (this.options.mode === 'multi' && this.isFull())) return;
        this.focus();
        this.isOpen = true;
        this.refreshState();
        this.$dropdown.style({
            visibility: 'hidden',
            display: 'block'
        });
        this.positionDropdown();
        this.$dropdown.style({ visibility: 'visible' });
        this.emit('dropdown_open', this.$dropdown);
    },

    close: function() {
        var trigger = this.isOpen;

        if (this.options.mode === 'single' && this.items.length) {
            this.hideInput();
        }

        this.isOpen = false;
        this.$dropdown.hide();
        this.setActiveOption(null);
        this.refreshState();

        if (trigger) this.emit('dropdown_close', this.$dropdown);
    },

    positionDropdown: function() {
        var control = this.$control,
            offset  = control.position();//this.options.dropdownParent === 'body' ? control.offset() : control.position();
        offset.top += control[0].offsetHeight;

        this.$dropdown.style({
            width: control[0].offsetWidth,
            top: control[0].offsetTop + control[0].offsetHeight,
            left: control[0].offsetLeft
        });
    },

    clear: function(silent) {
        if (!this.items.length) return;

        var non_input = this.$control.children(':not(input)');
        if (non_input) non_input.remove();

        this.items = [];
        this.lastQuery = null;
        this.setCaret(0);
        this.setActiveItem(null);
        this.updatePlaceholder();
        this.updateOriginalInput({ silent: silent });
        this.refreshState();
        this.showInput();
        this.emit('clear');
    },

    insertAtCaret: function($el) {
        var caret = Math.min(this.caretPos, this.items.length);
        if (caret === 0) {
            $el.top(this.$control);//.prepend($el);
        } else {
            //$(this.$control[0].childNodes[caret]).before($el);
            $el.after(this.$control.find(':nth-child(' + caret + ')'));
            //this.$control.find(':nth-child(' + caret + ')').before($el);
        }
        this.setCaret(caret + 1);
    },

    deleteSelection: function(e) {
        var i, n, direction, selection, values, caret, option_select, $option_select, $tail;

        direction = (e && e.keyCode === KEY_BACKSPACE) ? -1 : 1;
        selection = getSelection(this.$control_input[0]);

        if (this.$activeOption && !this.options.hideSelected) {
            option_select = this.getAdjacentOption(this.$activeOption, -1);
            if (option_select) { option_select = option_select.attribute('data-value'); }
        }

        // determine items that will be removed
        values = [];

        if (this.$activeItems.length) {
            var children = this.$control.children(':not(input)');
            $tail = this.$control.children('.g-active');
            if ($tail) { $tail = $(direction > 0 ? last($tail) : $tail[0]); }
            caret = (!children ? -1 : indexOf(children, $tail[0]));
            if (direction > 0) { caret++; }

            for (i = 0, n = this.$activeItems.length; i < n; i++) {
                values.push($(this.$activeItems[i]).attribute('data-value'));
            }
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
        } else if ((this.isFocused || this.options.mode === 'single') && this.items.length) {
            if (direction < 0 && selection.start === 0 && selection.length === 0) {
                values.push(this.items[this.caretPos - 1]);
            } else if (direction > 0 && selection.start === this.$control_input.value().length) {
                values.push(this.items[this.caretPos]);
            }
        }

        // allow the callback to abort
        if (!values.length || (typeof this.options.onDelete === 'function' && this.options.onDelete.apply(this, [values]) === false)) {
            return false;
        }

        // perform removal
        if (typeof caret !== 'undefined') {
            this.setCaret(caret);
        }
        while (values.length) {
            this.removeItem(values.pop());
        }

        this.showInput();
        this.positionDropdown();
        this.refreshOptions(true);

        // select previous option
        if (option_select) {
            $option_select = this.getOption(option_select);
            if ($option_select.length) {
                this.setActiveOption($option_select);
            }
        }

        return true;
    },

    advanceSelection: function(direction, e) {
        var tail, selection, idx, valueLength, cursorAtEdge, $tail;

        if (direction === 0) return;
        if (this.rtl) direction *= -1;

        tail = direction > 0 ? 'last-child' : 'first-child';
        selection = getSelection(this.$control_input[0]);

        if (this.isFocused && !this.isInputHidden) {
            valueLength = this.$control_input.value().length;
            cursorAtEdge = direction < 0
                ? selection.start === 0 && selection.length === 0
                : selection.start === valueLength;

            if (cursorAtEdge && !valueLength) {
                this.advanceCaret(direction, e);
            }
        } else {
            $tail = this.$control.children('.g-active:' + tail);
            if ($tail) {
                idx = indexOf(this.$control.children(':not(input)'), $tail);
                this.setActiveItem(null);
                this.setCaret(direction > 0 ? idx + 1 : idx);
            }
        }
    },

    advanceCaret: function(direction, e) {
        var fn, $adj;

        if (direction === 0) return;

        fn = direction > 0 ? 'nextSibling' : 'previousSibling';
        if (this.isShiftDown) {
            $adj = this.$control_input[fn]();
            if ($adj) {
                this.hideInput();
                this.setActiveItem($adj);
                e && e.preventDefault();
            }
        } else {
            this.setCaret(this.caretPos + direction);
        }
    },

    setCaret: function(i) {

        if (this.options.mode === 'single') {
            i = this.items.length;
        } else {
            i = Math.max(0, Math.min(this.items.length, i));
        }

        if (!this.isPending) {
            // the input must be moved by leaving it in place and moving the
            // siblings, due to the fact that focus cannot be restored once lost
            // on mobile webkit devices
            var j, n, fn, $children, $child;
            $children = this.$control.children(':not(input)');
            for (j = 0, n = ($children ? $children.length : 0); j < n; j++) {
                $child = $($children[j]);//.detach();
                if (j < i) {
                    $child.before(this.$control_input);
                } else {
                    this.$control.appendChild($child);
                }
            }
        }

        this.caretPos = i;
    },

    lock: function() {
        this.close();
        this.isLocked = true;
        this.refreshState();
    },

    unlock: function() {
        this.isLocked = false;
        this.refreshState();
    },

    disable: function() {
        this.input.disabled(true);
        this.$control_input.attribute('disabled', true).attribute('tabindex', -1);
        this.isDisabled = true;
        this.lock();
    },

    enable: function() {
        this.input.attribute('disabled', null);
        this.$control_input.attribute('disabled', null).attribute('tabindex', this.tabIndex);
        this.isDisabled = false;
        this.unlock();
    },

    destroy: function() {
        var revertSettings = this.revertSettings;

        this.emit('destroy');
        this.off();
        this.$wrapper.remove();
        this.$dropdown.remove();

        this.input
            .html('')
            .appendChild(revertSettings.$children)
            .attribute('tabindex', null)
            .removeClass('selectized')
            .attribute({ tabindex: revertSettings.tabindex })
            .show();

        /*$(window).off(eventNS);
         $(document).off(eventNS);
         $(document.body).off(eventNS);*/

        delete this.$control_input.selectizeGrow;
        delete this.input.selectizeInstance;
        delete this.input[0].selectize;
    },

    render: function(templateName, data) {
        var value, id, label;
        var name = '';
        var cache = false;
        var regex_tag = /^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;

        if (templateName === 'option' || templateName === 'item') {
            value = hash_key(data[this.options.valueField]);
            cache = !!value;
        }

        // pull markup from cache if it exists
        if (cache) {
            if (!isset(this.renderCache[templateName])) {
                this.renderCache[templateName] = {};
            }
            if (this.renderCache[templateName].hasOwnProperty(value)) {
                return this.renderCache[templateName][value];
            }
        }

        // render markup
        var html = zen('div').html(this.options.render[templateName].apply(this, [data, escapeHTML]));
        html = html.firstChild();

        // add mandatory attributes
        if (templateName === 'option' || templateName === 'option_create') {
            html = html.data('selectable', '');
        }
        if (templateName === 'optgroup') {
            id = data[this.options.optgroupValueField] || '';
            name = escape_replace(escapeHTML(id));
            html = html.data('group', name).attribute('role', 'group').attribute('aria-label', name);
        }
        if (templateName === 'option' || templateName === 'item') {
            name = escape_replace(escapeHTML(value || ''));
            html = html.data('value', name).attribute('id', slugify(this.rand + '-' + name)).attribute('role', 'treeitem').attribute('aria-label', trim(data.text)).attribute('aria-selected', 'false');
        }

        // update cache
        if (cache) {
            this.renderCache[templateName][value] = html[0];
        }

        return html[0];
    },

    clearCache: function(templateName) {
        if (typeof templateName === 'undefined') {
            this.renderCache = {};
        } else {
            delete this.renderCache[templateName];
        }
    },

    canCreate: function(input) {
        if (!this.options.create) return false;
        var filter = this.options.createFilter;
        return input.length
            && (typeof filter !== 'function' || filter.apply(self, [input]))
            && (typeof filter !== 'string' || new RegExp(filter).test(input))
            && (!(filter instanceof RegExp) || filter.test(input));
    },

    getPreviousValue: function() {
        return this.previousValue;
    }
});

$.implement({
    selectize: function(settings_user) {
        settings_user = settings_user || {};
        var defaults             = Selectize.prototype.options,
            settings             = merge({}, defaults, settings_user),
            attr_data            = settings.dataAttr,
            field_label          = settings.labelField,
            field_value          = settings.valueField,
            field_optgroup       = settings.optgroupField,
            field_optgroup_label = settings.optgroupLabelField,
            field_optgroup_value = settings.optgroupValueField;

        var init_textbox = function(input, settings_element) {
            input = $(input);
            var i, n, values, option;

            var data_raw = input.attribute(attr_data);

            if (!data_raw) {
                var value = trim(input.value() || '');
                if (!settings.allowEmptyOption && !value.length) return;

                values = value.split(settings.delimiter);
                for (i = 0, n = values.length; i < n; i++) {
                    option = {};
                    option[field_label] = values[i];
                    option[field_value] = values[i];

                    settings_element.Options.push(option);
                }

                settings_element.items = values;
            } else {
                settings_element.Options = JSON.parse(data_raw);
                for (i = 0, n = settings_element.Options.length; i < n; i++) {
                    settings_element.items.push(settings_element.Options[i][field_value]);
                }
            }
        };

        var init_select = function(input, settings_element) {
            var i, n, tagName, children, order = 0;
            var options = settings_element.Options;
            var optionsMap = {};

            var readData = function(el) {
                var data = attr_data && el.attribute(attr_data);
                if (typeof data === 'string' && data.length) {
                    return JSON.parse(data);
                }
                return null;
            };

            var addOption = function(option, group) {
                var value, opt;

                option = $(option);

                value = hash_key(option.value());
                if (!value.length && !settings.allowEmptyOption) return;

                // if the option already exists, it's probably been
                // duplicated in another optgroup. in this case, push
                // the current group to the "optgroup" property on the
                // existing option so that it's rendered in both places.
                if (optionsMap.hasOwnProperty(value)) {
                    if (group) {
                        var arr = optionsMap[value][field_optgroup];
                        if (!arr) {
                            optionsMap[value][field_optgroup] = group;
                        } else if (!isArray(arr)) {
                            optionsMap[value][field_optgroup] = [arr, group];
                        } else {
                            arr.push(group);
                        }
                    }
                    return;
                }

                opt = readData(option) || {};
                opt[field_label] = opt[field_label] || option.text();
                opt[field_value] = opt[field_value] || value;
                opt[field_optgroup] = opt[field_optgroup] || group;

                optionsMap[value] = opt;
                options.push(opt);

                if (option.matches(':selected')) {
                    settings_element.items.push(value);
                }
            };

            var addGroup = function(optgroup) {
                var i, n, id, optgrp, options;

                optgroup = $(optgroup);
                id = optgroup.attribute('label');

                if (id) {
                    optgrp = readData(optgroup) || {};
                    optgrp[field_optgroup_label] = id;
                    optgrp[field_optgroup_value] = id;
                    settings_element.Optgroups.push(optgrp);
                }

                options = optgroup.search('option');
                for (i = 0, n = options.length; i < n; i++) {
                    addOption(options[i], id);
                }
            };

            settings_element.maxItems = input.attribute('multiple') ? null : 1;

            children = input.children() || 0;
            for (i = 0, n = children.length; i < n; i++) {
                tagName = children[i].tagName.toLowerCase();
                if (tagName === 'optgroup') {
                    addGroup(children[i]);
                } else if (tagName === 'option') {
                    addOption(children[i]);
                }
            }
        };

        return this.forEach(function($input, i) {
            settings = merge({}, defaults, settings_user),
            $input = $($input);
            if ($input.selectizeInstance) return;

            var instance,
                dataOptions = $input.data('selectize'),
                tag_name    = $input.tag().toLowerCase(),
                placeholder = $input.attribute('placeholder') || $input.attribute('data-placeholder');

            // g5 custom
            if (dataOptions) { dataOptions = JSON.parse(dataOptions); }
            settings = merge({}, settings, dataOptions);
            // end g5 custom

            if (!placeholder && !settings.allowEmptyOption) {
                var chlds = $input.children('option[value=""]');
                placeholder = chlds ? $input.children('option[value=""]').text() : '';
            }

            var settings_element = {
                'placeholder': placeholder,
                'Options': [],
                'Optgroups': [],
                'items': []
            };

            if (tag_name === 'select') {
                init_select($input, settings_element);
            } else {
                init_textbox($input, settings_element);
            }

            instance = new Selectize($input, merge({}, defaults, settings_element, settings_user, dataOptions));
            $input.selectizeInstance = instance;
        });
    }
});

ready(function() {
    var selects = $('[data-selectize]');
    if (!selects) { return; }

    selects.selectize();
});


module.exports = Selectize;

},{"../utils/elements.utils":64,"elements/domready":109,"elements/zen":135,"moofx":136,"mout/array/indexOf":173,"mout/array/last":177,"mout/collection/forEach":187,"mout/function/bind":190,"mout/function/debounce":191,"mout/lang/isArray":201,"mout/lang/isBoolean":202,"mout/object/merge":235,"mout/object/size":240,"mout/object/unset":242,"mout/object/values":243,"mout/string/escapeHtml":257,"mout/string/slugify":269,"mout/string/trim":270,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298,"sifter":310}],58:[function(require,module,exports){
"use strict";

var prime   = require('prime'),
    Emitter = require('prime/emitter'),
    Bound   = require('prime-util/prime/bound'),
    Options = require('prime-util/prime/options'),
    zen     = require('elements/zen'),
    $       = require('../utils/elements.utils.js'),
    storage = require('prime/map')(),

    bind    = require('mout/function/bind'),
    merge   = require('mout/object/merge');

var Toaster = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        tapToDismiss: true,
        noticeClass: 'g-notifications',
        containerID: 'g-notifications-container',

        types: {
            base: '',
            error: 'fa-minus-circle',
            info: 'fa-info-circle',
            success: 'fa-check-circle',
            warning: 'fa-exclamation-triangle'
        },

        showDuration: 300,
        showEquation: 'cubic-bezier(0.02, 0.01, 0.47, 1)',
        hideDuration: 500,
        hideEquation: 'cubic-bezier(0.02, 0.01, 0.47, 1)',

        timeOut: 2500, // timeOut and extendedTimeout to 0 == sticky
        extendedTimeout: 2500,

        location: 'bottom-right',

        titleClass: 'g-notifications-title',
        messageClass: 'g-notifications-message',
        closeButton: true,

        target: '#g5-container',
        targetLocation: 'bottom',

        newestOnTop: true,
        preventDuplicates: false,
        progressBar: true


        /*
        onShow: function() {},
        onHidden: function() {},
        onClick: function() {}
        */
    },

    constructor: function(options) {
        this.setOptions(options);

        this.id = 0;
        this.previousNotice = null;
        this.map = storage;
    },

    mergeOptions: function(options) {
        return merge(this.options, options || {});
    },

    base: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || '',
            type: options.type || 'base',
            message: message
        }));
    },

    success: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Success!',
            type: 'success',
            message: message
        }));
    },

    info: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Info',
            type: 'info',
            message: message
        }));
    },
    warning: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Warning!',
            type: 'warning',
            message: message
        }));
    },

    error: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Error!',
            type: 'error',
            message: message
        }));
    },

    notify: function(options) {
        options = this.mergeOptions(options);

        if (options.preventDuplicates && this.previousNotice === options.message) { return; }

        this.id++;
        this.previousNotice = options.message;

        var container = this.getContainer(options, true),
            element = zen('div'), title = zen('div'), message = zen('div'),
            icon = zen('i.fa'),
            progress = zen('div.g-notifications-progress'),
            close = zen('a.fa.fa-close[href="#"]');

        this.map.set(element, {
            container: container,
            interval: null,
            progressBar: {
                interval: null,
                hideETA: null,
                maxHideTime: null
            },
            response: {
                id: this.id,
                state: 'visible',
                start: new Date(),
                options: options
            },
            options: options
        });

        if (options.title) {
            element.appendChild(title.html(options.title).addClass(options.titleClass));
        }

        if (options.message) {
            element.appendChild(message.html(options.message).addClass(options.messageClass));
        }

        if (options.closeButton) {
            close.top(element);
        }

        if (options.progressBar) {
            progress.top(element);
        }

        if (options.type && options.title) {
            if (options.types[options.type]) {
                element.addClass('g-notifications-theme-' + options.type);
                icon.top(title).addClass(options.types[options.type]);
            }
        }

        element.style({ opacity: 0 });
        element[options.newestOnTop ? 'top' : 'bottom'](container);
        element.animate({ opacity: 1 }, {
            duration: options.showDuration,
            equation: options.showEquation,
            callback: options.onShow
        });

        if (options.timeOut > 0) {
            var map = this.map.get(element);
            map.interval = setTimeout(bind(function() {
                this.hide(element);
            }, this), options.timeOut);
            map.progressBar.maxHideTime = parseFloat(options.timeOut);
            map.progressBar.hideETA = new Date().getTime() + map.progressBar.maxHideTime;

            if (options.progressBar) {
                map.progressBar.interval = setInterval(bind(function() {
                    this.updateProgress(element, progress);
                }, this), 10);
            }

            this.map.set(element, map);
        }

        var stick = bind(function() { this.stickAround(element); }, this),
            delay = bind(function() { this.delayedHide(element); }, this);
        element.on('mouseover', stick);
        element.on('mouseout', delay);

        if (!options.onClick && options.tapToDismiss) {
            element.on('click', bind(function(){
                element.off('mouseover', stick);
                element.off('mouseout', delay);

                this.hide(element);
            }, this));
        }

        if (options.closeButton && close) {
            close.on('click', bind(function(event){
                event.stopPropagation();
                event.preventDefault();

                element.off('mouseover', stick);
                element.off('mouseout', delay);
                this.hide(element, true);
            }, this));
        }

    },

    stickAround: function(element) {
        var map = this.map.get(element);

        clearTimeout(map.interval);
        map.progressBar.hideETA = 0;
        element.animate({ opacity: 1 }, {
            duration: map.options.showDuration,
            equation: map.options.showEquation,
            callback: map.options.onShow
        });

        this.map.set(element, map);
    },

    hide: function(element, override) {
        if (element.find(':focus') && !override) { return; }

        var map = this.map.get(element);

        clearTimeout(map.progressBar.interval);

        this.map.set(element, map);
        return element.animate({ opacity: 0 }, {
            duration: map.options.hideDuration,
            equation: map.options.hideEquation,
            callback: bind(function() {
                this.remove(element);
                if (map.options.onHidden && map.response.state !== 'hidden') { map.options.onHidden(); }
                map.response.state = 'hidden';
                map.response.endTime = new Date();

                this.map.set(element, map);
            }, this)
        });
    },

    delayedHide: function(element, override) {
        var map = this.map.get(element);

        if (map.options.timeOut > 0 || map.options.extendedTimeout > 0) {
            map.interval = setTimeout(bind(function() {
                this.hide(element);
            }, this), map.options.extendedTimeout);
            map.progressBar.maxHideTime = parseFloat(map.options.extendedTimeout);
            map.progressBar.hideETA = new Date().getTime() + map.progressBar.maxHideTime;
        }

        this.map.set(element, map);
    },

    updateProgress: function(element, progress) {
        var map = this.map.get(element),
            percentage = ((map.progressBar.hideETA - (new Date().getTime())) / map.progressBar.maxHideTime) * 100;

        this.map.set(element, map);
        progress.style({ width: percentage + '%' });
    },

    getContainer: function(options, create) {
        options = this.mergeOptions(options);

        var container = $('#' + options.containerID);
        if (container) { return container; }

        if (create) { container = this.createContainer(options); }

        return container;
    },

    createContainer: function(options) {
        options = this.mergeOptions(options);

        return zen('div#' + options.containerID + '.' + options.location)[options.targetLocation](options.target).attribute('aria-live', 'polite').attribute('role', 'alert');
    },

    remove: function(element) {
        if (!element) { return; }

        var map = this.map.get(element);
        if (!map.container) { map.container = this.getContainer(map.options); }
        /*if ($toastElement.is(':visible')) {
            return;
        }*/

        element.remove();
        if (!map.container.children()) {
            map.container.remove();
            this.previousNotice = null;
        }

        this.map.set(element, map);
    }
});

var toaster = new Toaster();

module.exports = toaster;

},{"../utils/elements.utils.js":64,"elements/zen":135,"mout/function/bind":190,"mout/object/merge":235,"prime":299,"prime-util/prime/bound":295,"prime-util/prime/options":296,"prime/emitter":298,"prime/map":300}],59:[function(require,module,exports){
"use strict";
var ready         = require('elements/domready'),
    $             = require('elements'),

    modal         = require('./modal'),
    toastr        = require('./toastr'),
    request       = require('agent'),

    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    parseAjaxURI  = require('../utils/get-ajax-url').parse,
    getAjaxURL    = require('../utils/get-ajax-url').global;

var hiddens,
    toggles = function(event, element) {
        if (event.type.match(/^touch/) || event.type == 'click') { event.preventDefault(); }
        if (event.type == 'click') { return false; }
        element = $(element);
        hiddens = element.find('~~ [type=hidden]');

        if (!hiddens) return true;
        hiddens.value(hiddens.value() == '0' ? '1' : '0');
        element.parent('.enabler').attribute('aria-checked', hiddens.value() == '1' ? 'true' : 'false');

        hiddens.emit('change');
        $('body').emit('change', { target: hiddens });

        return false;
    };

ready(function() {
    var body = $('body');
    body.delegate('keydown', '.enabler', function(event, element){
        element = $(element);
        if (element.disabled() || element.find('[disabled]')) {
            return;
        }

        var key = (event.which ? event.which : event.keyCode);
        if (key == 32 || key == 13) { // ARIA support: Space / Enter toggle
            event.preventDefault();
            toggles(event, element.find('.toggle'));
        }
    });

    ['touchend', 'mouseup', 'click'].forEach(function(event) {
        body.delegate(event, '.enabler .toggle', toggles);
    });

    var URI = parseAjaxURI(getAjaxURL('devprod') + getAjaxSuffix());
    body.delegate('change', '[data-g-devprod] input[type="hidden"]', function(event, element) {
        var value = element.value(),
            parent = element.parent('[data-g-devprod]'),
            labels = JSON.parse(parent.data('g-devprod'));

        parent.showIndicator();

        request('post', URI, { mode: value }, function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });

                element.value(!value);
            } else {
                parent.find('.devprod-mode').text(labels[response.body.mode] || 'Unknown');
                toastr.success(response.body.html, response.body.title);
            }

            parent.hideIndicator();
        });
    });
});

module.exports = {};

},{"../utils/get-ajax-suffix":68,"../utils/get-ajax-url":69,"./modal":54,"./toastr":58,"agent":78,"elements":111,"elements/domready":109}],60:[function(require,module,exports){
"use strict";

var ready    = require('elements/domready'),
    tooltips = require('ext/tooltips');

tooltips.defaults = {
    baseClass: 'g-tips',
    typeClass: null,
    effectClass: 'g-fade',
    inClass: 'g-tip-in',
    place: 'top',
    spacing: 10,
    offset: -3,
    auto: 1
};

var Instance = null;

ready(function() {
    Instance = new tooltips(document, {
        tooltip: tooltips.defaults,
        key: 'tip',
        showOn: 'mouseenter',
        hideOn: 'mouseleave',
        observe: 1
    });

    window.G5.tips = Instance;
});

module.exports = Instance;

},{"elements/domready":109,"ext/tooltips":"ext/tooltips"}],61:[function(require,module,exports){
"use strict";

var prime         = require('prime'),
    $             = require('../utils/elements.utils'),
    zen           = require('elements/zen'),
    domready      = require('elements/domready'),
    storage       = require('prime/map')(),
    modal         = require('../ui').modal,

    size          = require('mout/collection/size'),
    indexOf       = require('mout/array/indexOf'),
    merge         = require('mout/object/merge'),
    keys          = require('mout/object/keys'),
    guid          = require('mout/random/guid'),
    toQueryString = require('mout/queryString/encode'),
    contains      = require('mout/string/contains'),

    getParam      = require('mout/queryString/getParam'),
    setParam      = require('mout/queryString/setParam'),

    request       = require('agent')(),
    History       = require('./history'),
    flags         = require('./flags-state'),
    parseAjaxURI  = require('./get-ajax-url').parse,
    getAjaxSuffix = require('./get-ajax-suffix'),
    lm            = require('../lm'),
    mm            = require('../menu'),
    assignments   = require('../assignments');

require('../ui/popover');

var ERROR = false, TMP_SELECTIZE_DISABLE = false, ConfNavIndex = -1;

History.Adapter.bind(window, 'statechange', function() {
    if (request.running()) {
        return false;
    }
    var body = $('body'),
        State = History.getState(),
        URI = State.url,
        Data = State.data,
        sidebar = $('#navbar'),
        mainheader = $('#main-header'),
        params = '';

    if (Data.doNothing) { return true; }

    if (size(Data) && Data.parsed !== false && storage.get(Data.uuid)) {
        Data = storage.get(Data.uuid);
    }

    if (Data.element) {
        var isTopNavOrMenu = Data.element.parent('#main-header') || Data.element.matches('.menu-select-wrap');
        body.emit('statechangeBefore', {
            target: Data.element,
            Data: Data
        });
    } else {
        var url = URI.replace(window.location.origin, '');
        Data.element = $('[href="' + url + '"]');
    }

    URI = parseAjaxURI(URI + getAjaxSuffix());

    var lis;
    if (sidebar && Data.element) {
        var active = sidebar.search('li.active');
        lis = sidebar.search('li');
        lis.removeClass('active');

        if (Data.element.parent('#navbar')) {
            Data.element.parent('li').addClass('active');
        }
    }

    if (mainheader && Data.element && (!Data.element.matches('a.menu-item') && !Data.element.matches('select.menu-select-wrap'))) {
        lis = mainheader.search('.float-right li');
        lis.removeClass('active');

        if (Data.element.parent('#main-header')) {
            Data.element.parent('li').addClass('active');
        }
    }

    if (Data.params) {
        params = toQueryString(JSON.parse(Data.params));
        if (contains(URI, '?')) { params = params.replace(/^\?/, '&'); }
    }

    if (!ERROR) { modal.closeAll(); }
    request.url(URI + params).data(Data.extras || {}).method(Data.extras ? 'post' : 'get').send(function(error, response) {
        if (!response.body.success) {
            if (!ERROR) {
                ERROR = true;
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });

                History.back();
            } else {
                ERROR = false;
            }

            if (Data.element) {
                Data.element.hideIndicator();
            }

            return false;

        }

        var target = Data.parent ? Data.element.parent(Data.parent) : $(Data.target),
            destination = (target || $('[data-g5-content]') || body);

        if (response.body && response.body.html) {
            var fader;
            destination.html(response.body.html);
            if (fader = (destination.matches('[data-g5-content]') ? destination : destination.find('[data-g5-content]'))) {
                fader.style({ opacity: 0 });
                if (isTopNavOrMenu) { $(navbar).attribute('tabindex', '-1').attribute('aria-hidden', 'true'); }
                $('#navbar')[isTopNavOrMenu ? 'slideUp' : 'slideDown']();
                fader.animate({ opacity: 1 });
            }
        } else { destination.html(response.body); }

        body.getPopover().hideAll(true).destroy();

        if (Data.element) {
            body.emit('statechangeAfter', {
                target: Data.element,
                Data: Data
            });
        }

        var element = (Data.event && Data.event.activeSpinner) || Data.element;
        if (element) {
            element.hideIndicator();
        }

        var selects = $('[data-selectize]');
        if (selects) { selects.selectize(); }
        selectorChangeEvent();
        assignments.chromeFix();

        body.emit('statechangeEnd');
    });
});

var selectorChangeEvent = function() {
    var selectors = $('[data-selectize-ajaxify]');
    if (!selectors) { return; }

    selectors.forEach(function(selector) {
        selector = $(selector);
        var selectize = selector.selectize().selectizeInstance;
        if (!selectize || selectize.HasChangeEvent) { return; }

        selectize.on('change', function() {
            if (TMP_SELECTIZE_DISABLE) {
                TMP_SELECTIZE_DISABLE = false;
                return false;
            }
            var value = selectize.getValue(),
                options = selectize.Options,
                flagCallback = function() {
                    flags.off('update:pending', flagCallback);
                    modal.close();

                    selectize.input
                        .data('g5-ajaxify', '')
                        .data('g5-ajaxify-target', selector.data('g5-ajaxify-target') || '[data-g5-content-wrapper]')
                        .data('g5-ajaxify-target-parent', selector.data('g5-ajaxify-target-parent') || null)
                        .data('g5-ajaxify-href', options[value].url)
                        .data('g5-ajaxify-params', options[value].params ? JSON.stringify(options[value].params) : null);


                    var active = $('#navbar li.active') || $('#main-header li.active') || $('#navbar li:nth-child(2)');
                    if (active) { active.showIndicator(); }

                    $('body').emit('click', {
                        target: selectize.input,
                        activeSpinner: active
                    });
                };

            if (!options[value]) { return; }

            if (flags.get('pending')) {
                flags.warning({
                    callback: function(response, content) {
                        var saveContinue = content.find('[data-g-unsaved-save]'),
                            discardContinue = content.find('[data-g-unsaved-discard]');

                        if (!saveContinue) { return; }
                        saveContinue.on('click', function(e) {
                            e.preventDefault();
                            if (this.attribute('disabled')) { return false; }

                            $([saveContinue, discardContinue]).attribute('disabled');
                            flags.on('update:pending', flagCallback);
                            $('body').emit('click', { target: $('.button-save') });
                        });

                        discardContinue.on('click', function(e) {
                            e.preventDefault();
                            if (this.attribute('disabled')) { return false; }

                            $([saveContinue, discardContinue]).attribute('disabled');
                            flags.set('pending', false);
                            flagCallback();
                        });
                    },

                    afterclose: function() {
                        TMP_SELECTIZE_DISABLE = true;
                        selectize.setValue(selectize.getPreviousValue());
                    }
                });

                return;
            }

            flagCallback();
        });

        selectize.HasChangeEvent = true;
    });
};


domready(function() {
    var body = $('body');

    // Update NONCE if any
    if (GANTRY_AJAX_NONCE) {
        var currentURI = History.getPageUrl(),
            currentNonce, currentView;

        // hack to inject the default view in WP/Grav in case it's missing
        switch (GANTRY_PLATFORM) {
            case 'wordpress':
                currentNonce = getParam(currentURI, '_wpnonce');
                currentView = getParam(currentURI, 'view');

                if (!currentView) {
                    currentURI = setParam(currentURI, 'view', 'configurations/default/styles');
                    History.replaceState({ uuid: guid(), doNothing: true }, window.document.title, currentURI);
                }

                // refresh nonce
                if (currentNonce !== GANTRY_AJAX_NONCE) {
                    currentURI = setParam(currentURI, '_wpnonce', GANTRY_AJAX_NONCE);
                    History.replaceState({ uuid: guid(), doNothing: true }, window.document.title, currentURI);
                }
                break;

            case 'grav':
                currentNonce = getParam(currentURI, 'nonce');
                currentView = contains(currentURI, 'configurations/default/styles');

                if (!currentView) {
                    currentURI += 'configurations/default/styles';
                    History.replaceState({ uuid: guid(), doNothing: true }, window.document.title, currentURI);
                }

                // refresh nonce
                if (currentNonce !== GANTRY_AJAX_NONCE) {
                    currentURI = setParam(currentURI, 'nonce', GANTRY_AJAX_NONCE);
                    History.replaceState({ uuid: guid(), doNothing: true }, window.document.title, currentURI);
                }
                break;
        }


    }

    // back to configuration
    body.delegate('click', '.button-back-to-conf', function(event, element) {
        event.preventDefault();

        var confSelector = $('#configuration-selector'),
            outlineDeleted = body.outlineDeleted,
            currentOutline = confSelector.value();

        ConfNavIndex = ConfNavIndex == -1 ? 1 : ConfNavIndex;
        var navbar = $('#navbar'),
            item = navbar.find('li:nth-child(' + (ConfNavIndex + 1) + ') [data-g5-ajaxify]');

        if (flags.get('pending')) {
            flags.warning({
                callback: function(response, content) {
                    var saveContinue = content.find('[data-g-unsaved-save]'),
                        discardContinue = content.find('[data-g-unsaved-discard]'),
                        flagCallback = function() {
                            flags.off('update:pending', flagCallback);
                            modal.close();

                            body.emit('click', { target: item });
                            navbar.attribute('tabindex', null).attribute('aria-hidden', 'false');
                            navbar.slideDown();
                        };

                    if (!saveContinue) { return; }
                    saveContinue.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([saveContinue, discardContinue]).attribute('disabled');
                        flags.on('update:pending', flagCallback);
                        body.emit('click', { target: $('.button-save') });
                    });

                    discardContinue.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([saveContinue, discardContinue]).attribute('disabled');
                        flags.set('pending', false);
                        flagCallback();
                    });
                }
            });

            return;
        }

        element.showIndicator();

        if (outlineDeleted == currentOutline) {
            var ids = keys(confSelector.selectizeInstance.Options),
                id = ids.shift();
            body.outlineDeleted = null;
            item.href(item.href().replace('/' + outlineDeleted + '/', '/' + id + '/').replace('style=' + outlineDeleted, 'style=' + id));
        }

        body.emit('click', { target: item });
        navbar.attribute('tabindex', null);
        navbar.slideDown();
    });

    body.delegate('click', '#navbar a[data-g5-ajaxify]', function(event, element) {
        var navbar = $('#navbar'),
            lis = navbar.search('li a[data-g5-ajaxify]');

        ConfNavIndex = indexOf(lis, element[0]) + 1;
    });

    // generic ajaxified links
    body.delegate('click', '[data-g5-ajaxify]', function(event, element) {
        if (event && event.preventDefault) {
            if (event.which === 2 || event.metaKey || event.ctrlKey || event.altKey || event.shiftKey) {
                return true;
            }

            event.preventDefault();
        }

        if (flags.get('pending') && (!element.matches('a.menu-item') && !element.parent('[data-menu-items]'))) {
            flags.warning({
                callback: function(response, content) {
                    var saveContinue = content.find('[data-g-unsaved-save]'),
                        discardContinue = content.find('[data-g-unsaved-discard]'),
                        flagCallback = function() {
                            flags.off('update:pending', flagCallback);
                            modal.close();
                            body.emit('click', event);
                        };

                    if (!saveContinue) { return; }
                    saveContinue.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([saveContinue, discardContinue]).attribute('disabled');
                        flags.on('update:pending', flagCallback);
                        body.emit('click', { target: $('.button-save') });
                    });

                    discardContinue.on('click', function(e) {
                        e.preventDefault();
                        if (this.attribute('disabled')) { return false; }

                        $([saveContinue, discardContinue]).attribute('disabled');
                        flags.set('pending', false);
                        flagCallback();
                    });
                }
            });

            return;
        }

        element.showIndicator();

        var data = element.data('g5-ajaxify'),
            target = element.data('g5-ajaxify-target'),
            parent = element.data('g5-ajaxify-target-parent'),
            url = element.attribute('href') || element.data('g5-ajaxify-href'),
            params = element.data('g5-ajaxify-params') || false,
            title = element.attribute('title') || window.document.title;

        data = data ? JSON.parse(data) : { parsed: false };
        if (data) {
            var uuid = guid(), extras;

            // TODO: The menu needs to be able to receive POST
            if (element.data('mm-id') || element.parent('[data-mm-id]')) {
                extras = {};
                extras.menutype = $('select.menu-select-wrap').value();
                extras.settings = JSON.stringify(mm.menumanager.settings);
                extras.ordering = JSON.stringify(mm.menumanager.ordering);
                extras.items = JSON.stringify(mm.menumanager.items);
            }

            storage.set(uuid, merge({}, data, {
                target: target,
                parent: parent,
                element: element,
                params: params,
                extras: extras,
                event: event
            }));
            data = { uuid: uuid };
        }

        History.pushState(data, title, url);

        var navbar, active, actives = $('#navbar .active, #main-header .active');

        if (navbar = element.parent('#navbar, #main-header')) {
            if (actives) { actives.removeClass('active'); }

            active = navbar.search('.active');
            if (active) { active.removeClass('active'); }
            element.parent('li').addClass('active');
        }
    });

    // attach change events to configurations selector
    selectorChangeEvent();
});


module.exports = {};

},{"../assignments":2,"../lm":27,"../menu":34,"../ui":53,"../ui/popover":55,"../utils/elements.utils":64,"./flags-state":67,"./get-ajax-suffix":68,"./get-ajax-url":69,"./history":73,"agent":78,"elements/domready":109,"elements/zen":135,"mout/array/indexOf":173,"mout/collection/size":189,"mout/object/keys":234,"mout/object/merge":235,"mout/queryString/encode":244,"mout/queryString/getParam":245,"mout/queryString/setParam":247,"mout/random/guid":249,"mout/string/contains":255,"prime":299,"prime/map":300}],62:[function(require,module,exports){
"use strict";

// credits: https://github.com/cowboy/javascript-sync-async-foreach
var asyncForEach = function(arr, eachFn, doneFn) {
    arr = arr || [];
    var i = -1;
    // Resolve array length to a valid (ToUint32) number.
    var len = arr.length >>> 0;

    (function next(result) {
        // This flag will be set to true if `this.async` is called inside the
        // eachFn` callback.
        var async;
        // Was false returned from the `eachFn` callback or passed to the
        // `this.async` done function?
        var abort = result === false;

        // Increment counter variable and skip any indices that don't exist. This
        // allows sparse arrays to be iterated.
        do { ++i; } while (!(i in arr) && i !== len);

        // Exit if result passed to `this.async` done function or returned from
        // the `eachFn` callback was false, or when done iterating.
        if (abort || i === len) {
            // If a `doneFn` callback was specified, invoke that now. Pass in a
            // boolean value representing "not aborted" state along with the array.
            if (doneFn) {
                doneFn(!abort, arr);
            }
            return;
        }

        // Invoke the `eachFn` callback, setting `this` inside the callback to a
        // custom object that contains one method, and passing in the array item,
        // index, and the array.
        result = eachFn.call({
            // If `this.async` is called inside the `eachFn` callback, set the async
            // flag and return a function that can be used to continue iterating.
            async: function() {
                async = true;
                return next;
            }
        }, arr[i], i, arr);

        // If the async flag wasn't set, continue by calling `next` synchronously,
        // passing in the result of the `eachFn` callback.
        if (!async) {
            next(result);
        }
    }());
};

module.exports = asyncForEach;

},{}],63:[function(require,module,exports){
'use strict';

var rAF = (function() {
    return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        function(callback) { window.setTimeout(callback, 1000 / 60); };
}());

var decouple = function(element, event, callback) {
    var evt, tracking = false;
    element = element[0] || element;

    var capture = function(e) {
        evt = e;
        track();
    };

    var track = function() {
        if (!tracking) {
            rAF(update);
            tracking = true;
        }
    };

    var update = function() {
        callback.call(element, evt);
        tracking = false;
    };

    try {
        element.addEventListener(event, capture, false);
    } catch (e) {}

    return capture;
};

module.exports = decouple;
},{}],64:[function(require,module,exports){
"use strict";
var $          = require('elements'),
    moofx      = require('moofx'),
    map        = require('mout/array/map'),
    series     = require('mout/function/series'),
    slick      = require('slick'),
    zen        = require('elements/zen'),
    progresser = require('../ui/progresser');

var walk = function(combinator, method) {

    return function(expression) {
        var parts = slick.parse(expression || "*");

        expression = map(parts, function(part) {
            return combinator + " " + part;
        }).join(', ');

        return this[method](expression);
    };

};


$.implement({
    style: function() {
        var moo = moofx(this);
        moo.style.apply(moo, arguments);
        return this;
    },

    animate: function() {
        var moo = moofx(this);
        moo.animate.apply(moo, arguments);
        return this;
    },

    hide: function() {
        return this.style('display', 'none');
    },

    show: function(mode) {
        return this.style('display', mode || 'inherit');
    },

    progresser: function(options) {
        var instance;

        this.forEach(function(node) {
            instance = node.ProgresserInstance;

            if (!instance) { instance = new progresser(node, options); }
            else { instance.constructor(node, options); }

            node.ProgresserInstance = instance;
            return instance;
        });
    },

    compute: function() {
        var moo = moofx(this);
        return moo.compute.apply(moo, arguments);
    },

    showIndicator: function(klass, keepIcon) {
        this.forEach(function(node) {
            node = $(node);
            if (typeof klass == 'boolean') {
                keepIcon = klass;
                klass = null;
            }

            var icon = keepIcon ? false : node.find('i');
            node.gHadIcon = !!icon;

            if (!icon) {
                if (!node.find('span') && !node.children()) { zen('span').text(node.text()).top(node.empty()); }

                icon = zen('i');
                icon.top(node);
            }

            if (!node.gIndicator) { node.gIndicator = icon.attribute('class') || true; }
            icon.attribute('class', klass || 'fa fa-fw fa-spin-fast fa-spinner');
        });
    },

    hideIndicator: function() {
        this.forEach(function(node) {
            node = $(node);
            if (!node.gIndicator) { return; }

            var icon = node.find('i');

            if (!icon) { return; }

            if (!node.gHadIcon) { icon.remove(); }
            else { icon.attribute('class', node.gIndicator); }

            node.gIndicator = null;
        });
    },

    slideDown: function(animation, callback) {
        var element       = this,
            size          = this.getRealSize(),
            callbackStart = function() {
                element.gSlideCollapsed = false;
            },
            callbackEnd   = function() {
                element.attribute('style', element.gSlideStyle);
            };

        callback = typeof animation == 'function' ? animation : (callback || function() {});
        if (this.gSlideCollapsed === false) { return callback(); }
        callback = series(callbackStart, callback, callbackEnd);

        animation = typeof animation == 'string' ? animation : {
            duration: '250ms',
            callback: callback
        };

        this.style('visibility', 'visible').attribute('aria-hidden', false);
        this.animate({ height: size.height }, animation);
    },

    slideUp: function(animation, callback) {
        if (typeof this.gSlideCollapsed == 'undefined') {
            this.gSlideStyle = this.attribute('style');
        }

        var element       = this,
            callbackStart = function() {
                element.gSlideCollapsed = true;
            },
            callbackEnd = function() {
                element.style('visibility', 'hidden').attribute('aria-hidden', true);
            };

        callback = typeof animation == 'function' ? animation : (callback || function() {});
        if (this.gSlideCollapsed === true) { return callback(); }
        callback = series(callbackStart, callback, callbackEnd);

        animation = typeof animation == 'string' ? animation : {
            duration: '250ms',
            callback: callback
        };
        this.style({ overflow: 'hidden' }).animate({ height: 0 }, animation);
    },

    slideToggle: function(animation, callback) {
        var size = this.getRealSize();
        return this[size.height && !this.gSlideCollapsed ? 'slideUp' : 'slideDown'](animation, callback);
    },

    getRealSize: function() {
        var style = this.attribute('style'), size;
        this.style({
            position: 'relative',
            overflow: 'inherit',
            top: -50000,
            height: 'auto',
            width: 'auto'
        });

        size = {
            width: parseInt(this.compute('width'), 10),
            height: parseInt(this.compute('height'), 10)
        };

        this.attribute('style', style);

        return size;
    },

    sibling: walk('++', 'find'),

    siblings: walk('~~', 'search')
});

module.exports = $;

},{"../ui/progresser":56,"elements":111,"elements/zen":135,"moofx":136,"mout/array/map":178,"mout/function/series":195,"slick":312}],65:[function(require,module,exports){
"use strict";
var $     = require('elements');

$.implement({
    belowthefold: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var fold = this.position().height + this[0].scrollTop;
        return elements.filter(function(element) {
            return fold <= $(element)[0].offsetTop - treshold;
        });
    },

    abovethetop: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var top = this[0].scrollTop;
        return elements.filter(function(element) {
            return top >= $(element)[0].offsetTop + $(element).position().height - treshold;
        });
    },

    rightofscreen: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var fold = this.position().width + this[0].scrollLeft;
        return elements.filter(function(element) {
            return fold <= $(element)[0].offsetLeft - treshold;
        });
    },

    leftofscreen: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var left = this[0].scrollLeft;
        return elements.filter(function(element) {
            return left >= $(element)[0].offsetLeft + $(element).position().width - treshold;
        });
    },

    inviewport: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var position = this.position();
        return elements.filter(function(element) {
            element = $(element);
            return element[0].offsetTop + treshold >= this[0].scrollTop &&
                element[0].offsetTop - treshold <= this[0].scrollTop + position.height;
        }, this);
    }
});

module.exports = $;

},{"elements":111}],66:[function(require,module,exports){
"use strict";

var $ = require('elements');

var fieldValidation = function(field) {
    field = $(field);
    var _field = field[0],
        tag = field.tag(),
        type = field.type(),
        isValid = true;

    // only validate input, textarea, select
    if (!~['input', 'textarea', 'select'].indexOf(tag)) { return isValid; }

    // use native validation if available
    if (typeof _field.willValidate !== 'undefined') {
        if (tag == 'input' && (_field.type.toLowerCase() !== type || field.hasClass('custom-validation-field'))) {
            // type not supported or custom, fallback validation
            _field.setCustomValidity(validate(field) ? '' : 'The field value is invalid');
        }

        // native validity check
        _field.checkValidity();

    } else {
        _field.validity = _field.validity || {};
        _field.validity.valid = validate(field);
    }

    isValid = _field.validity.valid;

    return isValid;
};

var validate = function(field) {
    field = $(field);

    var isValid = true,
        value = field.value(),
        type = field.type(),
        isCheckbox = (type == 'checkbox' || type == 'radio'),
        disabled = field.attribute('disabled'),
        required = field.attribute('required'),
        minlength = field.attribute('minlength'),
        maxlength = field.attribute('maxlength'),
        min = field.attribute('min'),
        max = field.attribute('max'),
        pattern = field.attribute('pattern');

    // disabled fields should not be validated
    if (disabled) { return isValid; }

    // required
    isValid = isValid && (!required || (isCheckbox && field.checked()) || (!isCheckbox && value));

    // minlength / maxlength
    isValid = isValid && (isCheckbox || ((!minlength || value.length >= minlength) && (!maxlength || value.length <= maxlength)));

    // pattern
    if (isValid && pattern) {
        pattern = new RegExp(pattern);
        isValid = pattern.test(value);
    }

    // min / max
    if (isValid && (min !== null || max !== null)) {
        if (min !== null) {
            isValid = parseFloat(value) >= parseFloat(min);
        }

        if (max !== null) {
            isValid = parseFloat(value) <= parseFloat(max);
        }
    }

    return isValid;
};

module.exports = fieldValidation;

},{"elements":111}],67:[function(require,module,exports){
"use strict";

var prime         = require('prime'),
    map           = require('prime/map'),
    Emitter       = require('prime/emitter'),
    modal         = require('../ui').modal,

    getAjaxURL    = require('./get-ajax-url').global,
    parseAjaxURI  = require('./get-ajax-url').parse,
    getAjaxSuffix = require('./get-ajax-suffix');

var FlagsState = new prime({

    inherits: Emitter,

    constructor: function() {
        this.flags = map();
    },

    set: function(key, value) {
        return this.flags.set(key, value).get(key);
    },

    get: function(key, def) {
        var value = this.flags.get(key);
        return value ? value : this.set(key, def);
    },

    keys: function() {
        return this.flags.keys();
    },

    values: function() {
        return this.flags.values();
    },

    warning: function(options){
        var callback = options.callback || function() {},
            afterclose = options.afterclose || function() {},
            warningURL = parseAjaxURI(options.url || getAjaxURL('unsaved') + getAjaxSuffix());

        if (!options.url && !options.message) { options.url = true; }
        if (options.url) {
            modal.open({
                content: 'Loading...',
                remote: warningURL,
                data: options.data || false,
                remoteLoaded: function(response, modal) {
                    var content = modal.elements.content;
                    if (!callback) { return; }

                    callback.call(this, response, content, modal);
                },
                afterClose: afterclose || function() {}
            });
        } else {
            modal.open({
                content: options.message,
                afterOpen: function(response, modal) {
                    var content = modal.elements.content;
                    if (!callback) { return; }

                    callback.call(this, response, content, modal);
                },
                afterClose: afterclose || function() {}
            });
        }
    }

});

module.exports = new FlagsState();

},{"../ui":53,"./get-ajax-suffix":68,"./get-ajax-url":69,"prime":299,"prime/emitter":298,"prime/map":300}],68:[function(require,module,exports){
"use strict";

var getAjaxSuffix = function() {
    var GANTRY_AJAX_SUFFIX = window.GANTRY_AJAX_SUFFIX || undefined;
    return typeof GANTRY_AJAX_SUFFIX == 'undefined' ? '' : GANTRY_AJAX_SUFFIX;
};

module.exports = getAjaxSuffix;

},{}],69:[function(require,module,exports){
"use strict";
var unescapeHtml  = require('mout/string/unescapeHtml'),
    getAjaxSuffix = require('./get-ajax-suffix'),
    endsWith      = require('mout/string/endsWith'),
    getQuery      = require('mout/queryString/getQuery'),
    getParam      = require('mout/queryString/getParam'),
    setParam      = require('mout/queryString/setParam');

var getAjaxURL = function(view, search) {
    var GANTRY_AJAX_URL = window.GANTRY_AJAX_URL || '';
    if (!search) { search = '%ajax%'; }
    var re  = new RegExp(search, 'g'),
        url = typeof GANTRY_AJAX_URL == 'undefined' ? '' : GANTRY_AJAX_URL;

    return unescapeHtml(url.replace(re, view));
};

var getConfAjaxURL = function(view, search) {
    var GANTRY_AJAX_CONF_URL = window.GANTRY_AJAX_CONF_URL || '';
    if (!search) { search = '%ajax%'; }
    var re  = new RegExp(search, 'g'),
        url = typeof GANTRY_AJAX_CONF_URL == 'undefined' ? '' : GANTRY_AJAX_CONF_URL;

    return unescapeHtml(url.replace(re, view));
};

var parseAjaxURI = function(uri) {
    var GANTRY_PLATFORM = window.GANTRY_PLATFORM || '',
        platform        = typeof GANTRY_PLATFORM == 'undefined' ? '' : GANTRY_PLATFORM;

    switch (platform) {
        case 'wordpress':
            uri = uri.replace(/themes\.php/ig, 'admin-ajax.php');
            break;
        case 'grav':
            // converts foo/bar?nonce=1234.json to foo/bar.json?nonce=1234
            var suffix = getAjaxSuffix();
            if (endsWith(uri, suffix)) {
                var query  = '' + getQuery(uri),
                    nonce  = '' + getParam(uri, 'nonce');

                uri = uri.replace(query, suffix) + query.replace(nonce, (nonce.replace(suffix, '')));
            }
            break;
        default:
    }

    return uri;
};

module.exports = {
    global: getAjaxURL,
    config: getConfAjaxURL,
    parse: parseAjaxURI
};

},{"./get-ajax-suffix":68,"mout/queryString/getParam":245,"mout/queryString/getQuery":246,"mout/queryString/setParam":247,"mout/string/endsWith":256,"mout/string/unescapeHtml":272}],70:[function(require,module,exports){
"use strict";
var $    = require('elements'),
    trim = require('mout/string/trim');

var getOutlineNameById = function(outline) {
    if (outline == null) { return ''; }
    return trim($('#configuration-selector').selectizeInstance.Options[outline].text);
};

var getCurrentOutline = function() {
    return trim($('#configuration-selector').selectizeInstance.getValue());
};

module.exports = { getOutlineNameById: getOutlineNameById, getCurrentOutline: getCurrentOutline };

},{"elements":111,"mout/string/trim":270}],71:[function(require,module,exports){
"use strict";

var zen = require('elements/zen');

var cached            = null,
    getScrollbarWidth = function() {
        if (cached !== null) { return cached; }

        var size, dummy = zen('div').bottom('#g5-container');
        dummy.style({
            width: 100,
            height: 100,
            overflow: 'scroll',
            position: 'absolute',
            zIndex: -9999
        });

        size = dummy[0].offsetWidth - dummy[0].clientWidth;
        dummy.remove();

        cached = size;
        return size;
    };

module.exports = getScrollbarWidth;

},{"elements/zen":135}],72:[function(require,module,exports){
"use strict";

var $        = require('elements'),
    domready = require('elements/domready');

// Localise Globals
var History = {};

// Check Existence
if (typeof History.Adapter !== 'undefined') {
    throw new Error('History.js Adapter has already been loaded...');
}

// Add the Adapter
History.Adapter = {
    /**
     * History.Adapter.bind(el,event,callback)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {function} callback
     * @return {void}
     */
    bind: function(el, event, callback) {
        $(el).on(event, callback);
    },

    /**
     * History.Adapter.trigger(el,event)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {Object=} extra - a object of extra event data (optional)
     * @return void
     */
    trigger: function(el, event, extra) {
        $(el).emit(event, extra);
    },

    /**
     * History.Adapter.extractEventData(key,event,extra)
     * @param {string} key - key for the event data to extract
     * @param {string} event - custom and standard events
     */
    extractEventData: function(key, event) {
        // MooTools Native then MooTools Custom
        return (event && event.event && event.event[key]) || (event && event[key]) || undefined;
    },

    /**
     * History.Adapter.onDomLoad(callback)
     * @param {function} callback
     * @return {void}
     */
    onDomLoad: function(callback) {
        domready(callback);
    }
};

// Try and Initialise History
if (typeof History.init !== 'undefined') {
    History.init();
}

module.exports = History;
},{"elements":111,"elements/domready":109}],73:[function(require,module,exports){
"use strict";

// ========================================================================
// Initialise

// Localise Globals
var
    console        = window.console || undefined, // Prevent a JSLint complain
    document       = window.document, // Make sure we are using the correct document
    navigator      = window.navigator, // Make sure we are using the correct navigator
    sessionStorage = false, // sessionStorage
    setTimeout     = window.setTimeout,
    clearTimeout   = window.clearTimeout,
    setInterval    = window.setInterval,
    clearInterval  = window.clearInterval,
    JSON           = window.JSON,
    alert          = window.alert,
    History        = window.History = require('./history-adapter') || {}, // Public History Object
    history        = window.history; // Old History Object

try {
    sessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)
    sessionStorage.setItem('TEST', '1');
    sessionStorage.removeItem('TEST');
} catch (e) {
    sessionStorage = false;
}

// MooTools Compatibility
JSON.stringify = JSON.stringify || JSON.encode;
JSON.parse = JSON.parse || JSON.decode;

// Check Existence
if (typeof History.init === 'undefined') {

    // Initialise History
    History.init = function (options) {
        // Check Load Status of Adapter
        if (typeof History.Adapter === 'undefined') {
            return false;
        }

        // Check Load Status of Core
        if (typeof History.initCore !== 'undefined') {
            History.initCore();
        }

        // Check Load Status of HTML4 Support
        if (typeof History.initHtml4 !== 'undefined') {
            History.initHtml4();
        }

        // Return true
        return true;
    };


    // ========================================================================
    // Initialise Core

    // Initialise Core
    History.initCore = function (options) {
        // Initialise
        if (typeof History.initCore.initialized !== 'undefined') {
            // Already Loaded
            return false;
        }
        else {
            History.initCore.initialized = true;
        }


        // ====================================================================
        // Options

        /**
         * History.options
         * Configurable options
         */
        History.options = History.options || {};

        /**
         * History.options.hashChangeInterval
         * How long should the interval be before hashchange checks
         */
        History.options.hashChangeInterval = History.options.hashChangeInterval || 100;

        /**
         * History.options.safariPollInterval
         * How long should the interval be before safari poll checks
         */
        History.options.safariPollInterval = History.options.safariPollInterval || 500;

        /**
         * History.options.doubleCheckInterval
         * How long should the interval be before we perform a double check
         */
        History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;

        /**
         * History.options.disableSuid
         * Force History not to append suid
         */
        History.options.disableSuid = History.options.disableSuid || false;

        /**
         * History.options.storeInterval
         * How long should we wait between store calls
         */
        History.options.storeInterval = History.options.storeInterval || 1000;

        /**
         * History.options.busyDelay
         * How long should we wait between busy events
         */
        History.options.busyDelay = History.options.busyDelay || 250;

        /**
         * History.options.debug
         * If true will enable debug messages to be logged
         */
        History.options.debug = History.options.debug || false;

        /**
         * History.options.initialTitle
         * What is the title of the initial state
         */
        History.options.initialTitle = History.options.initialTitle || document.title;

        /**
         * History.options.html4Mode
         * If true, will force HTMl4 mode (hashtags)
         */
        History.options.html4Mode = History.options.html4Mode || false;

        /**
         * History.options.delayInit
         * Want to override default options and call init manually.
         */
        History.options.delayInit = History.options.delayInit || false;


        // ====================================================================
        // Interval record

        /**
         * History.intervalList
         * List of intervals set, to be cleared when document is unloaded.
         */
        History.intervalList = [];

        /**
         * History.clearAllIntervals
         * Clears all setInterval instances.
         */
        History.clearAllIntervals = function () {
            var i, il = History.intervalList;
            if (typeof il !== "undefined" && il !== null) {
                for (i = 0; i < il.length; i++) {
                    clearInterval(il[i]);
                }
                History.intervalList = null;
            }
        };


        // ====================================================================
        // Debug

        /**
         * History.debug(message,...)
         * Logs the passed arguments if debug enabled
         */
        History.debug = function () {
            if ((History.options.debug || false)) {
                History.log.apply(History, arguments);
            }
        };

        /**
         * History.log(message,...)
         * Logs the passed arguments
         */
        History.log = function () {
            // Prepare
            var
                consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),
                textarea = document.getElementById('log'),
                message,
                i, n,
                args, arg
                ;

            // Write to Console
            if (consoleExists) {
                args = Array.prototype.slice.call(arguments);
                message = args.shift();
                if (typeof console.debug !== 'undefined') {
                    console.debug.apply(console, [message, args]);
                }
                else {
                    console.log.apply(console, [message, args]);
                }
            }
            else {
                message = ("\n" + arguments[0] + "\n");
            }

            // Write to log
            for (i = 1, n = arguments.length; i < n; ++i) {
                arg = arguments[i];
                if (typeof arg === 'object' && typeof JSON !== 'undefined') {
                    try {
                        arg = JSON.stringify(arg);
                    }
                    catch (Exception) {
                        // Recursive Object
                    }
                }
                message += "\n" + arg + "\n";
            }

            // Textarea
            if (textarea) {
                textarea.value += message + "\n-----\n";
                textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;
            }
            // No Textarea, No Console
            else if (!consoleExists) {
                alert(message);
            }

            // Return true
            return true;
        };


        // ====================================================================
        // Emulated Status

        /**
         * History.getInternetExplorerMajorVersion()
         * Get's the major version of Internet Explorer
         * @return {integer}
         * @license Public Domain
         * @author Benjamin Arthur Lupton <contact@balupton.com>
         * @author James Padolsey <https://gist.github.com/527683>
         */
        History.getInternetExplorerMajorVersion = function () {
            var result = History.getInternetExplorerMajorVersion.cached =
                    (typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')
                        ? History.getInternetExplorerMajorVersion.cached
                        : (function () {
                        var v = 3,
                            div = document.createElement('div'),
                            all = div.getElementsByTagName('i');
                        while ((div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0]) {
                        }
                        return (v > 4) ? v : false;
                    })()
                ;
            return result;
        };

        /**
         * History.isInternetExplorer()
         * Are we using Internet Explorer?
         * @return {boolean}
         * @license Public Domain
         * @author Benjamin Arthur Lupton <contact@balupton.com>
         */
        History.isInternetExplorer = function () {
            var result =
                    History.isInternetExplorer.cached =
                        (typeof History.isInternetExplorer.cached !== 'undefined')
                            ? History.isInternetExplorer.cached
                            : Boolean(History.getInternetExplorerMajorVersion())
                ;
            return result;
        };

        /**
         * History.emulated
         * Which features require emulating?
         */

        if (History.options.html4Mode) {
            History.emulated = {
                pushState: true,
                hashChange: true
            };
        }

        else {

            History.emulated = {
                pushState: !Boolean(
                    window.history && window.history.pushState && window.history.replaceState
                    && !(
                    (/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */
                    || (/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */
                    )
                ),
                hashChange: Boolean(
                    !(('onhashchange' in window) || ('onhashchange' in document))
                    ||
                    (History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)
                )
            };
        }

        /**
         * History.enabled
         * Is History enabled?
         */
        History.enabled = !History.emulated.pushState;

        /**
         * History.bugs
         * Which bugs are present
         */
        History.bugs = {
            /**
             * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call
             * https://bugs.webkit.org/show_bug.cgi?id=56249
             */
            setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

            /**
             * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions
             * https://bugs.webkit.org/show_bug.cgi?id=42940
             */
            safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

            /**
             * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)
             */
            ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),

            /**
             * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event
             */
            hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)
        };

        /**
         * History.isEmptyObject(obj)
         * Checks to see if the Object is Empty
         * @param {Object} obj
         * @return {boolean}
         */
        History.isEmptyObject = function (obj) {
            for (var name in obj) {
                if (obj.hasOwnProperty(name)) {
                    return false;
                }
            }
            return true;
        };

        /**
         * History.cloneObject(obj)
         * Clones a object and eliminate all references to the original contexts
         * @param {Object} obj
         * @return {Object}
         */
        History.cloneObject = function (obj) {
            var hash, newObj;
            if (obj) {
                hash = JSON.stringify(obj);
                newObj = JSON.parse(hash);
            }
            else {
                newObj = {};
            }
            return newObj;
        };


        // ====================================================================
        // URL Helpers

        /**
         * History.getRootUrl()
         * Turns "http://mysite.com/dir/page.html?asd" into "http://mysite.com"
         * @return {String} rootUrl
         */
        History.getRootUrl = function () {
            // Create
            var rootUrl = document.location.protocol + '//' + (document.location.hostname || document.location.host);
            if (document.location.port || false) {
                rootUrl += ':' + document.location.port;
            }
            rootUrl += '/';

            // Return
            return rootUrl;
        };

        /**
         * History.getBaseHref()
         * Fetches the `href` attribute of the `<base href="...">` element if it exists
         * @return {String} baseHref
         */
        History.getBaseHref = function () {
            // Create
            var
                baseElements = document.getElementsByTagName('base'),
                baseElement = null,
                baseHref = '';

            // Test for Base Element
            if (baseElements.length === 1) {
                // Prepare for Base Element
                baseElement = baseElements[0];
                baseHref = baseElement.href.replace(/[^\/]+$/, '');
            }

            // Adjust trailing slash
            baseHref = baseHref.replace(/\/+$/, '');
            if (baseHref) baseHref += '/';

            // Return
            return baseHref;
        };

        /**
         * History.getBaseUrl()
         * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)
         * @return {String} baseUrl
         */
        History.getBaseUrl = function () {
            // Create
            var baseUrl = History.getBaseHref() || History.getBasePageUrl() || History.getRootUrl();

            // Return
            return baseUrl;
        };

        /**
         * History.getPageUrl()
         * Fetches the URL of the current page
         * @return {String} pageUrl
         */
        History.getPageUrl = function () {
            // Fetch
            var
                State = History.getState(false, false),
                stateUrl = (State || {}).url || History.getLocationHref(),
                pageUrl;

            // Create
            pageUrl = stateUrl.replace(/\/+$/, '').replace(/[^\/]+$/, function (part, index, string) {
                return (/\./).test(part) ? part : part + '/';
            });

            // Return
            return pageUrl;
        };

        /**
         * History.getBasePageUrl()
         * Fetches the Url of the directory of the current page
         * @return {String} basePageUrl
         */
        History.getBasePageUrl = function () {
            // Create
            var basePageUrl = (History.getLocationHref()).replace(/[#\?].*/, '').replace(/[^\/]+$/, function (part, index, string) {
                    return (/[^\/]$/).test(part) ? '' : part;
                }).replace(/\/+$/, '') + '/';

            // Return
            return basePageUrl;
        };

        /**
         * History.getFullUrl(url)
         * Ensures that we have an absolute URL and not a relative URL
         * @param {string} url
         * @param {Boolean} allowBaseHref
         * @return {string} fullUrl
         */
        History.getFullUrl = function (url, allowBaseHref) {
            // Prepare
            var fullUrl = url, firstChar = url.substring(0, 1);
            allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;

            // Check
            if (/[a-z]+\:\/\//.test(url)) {
                // Full URL
            }
            else if (firstChar === '/') {
                // Root URL
                fullUrl = History.getRootUrl() + url.replace(/^\/+/, '');
            }
            else if (firstChar === '#') {
                // Anchor URL
                fullUrl = History.getPageUrl().replace(/#.*/, '') + url;
            }
            else if (firstChar === '?') {
                // Query URL
                fullUrl = History.getPageUrl().replace(/[\?#].*/, '') + url;
            }
            else {
                // Relative URL
                if (allowBaseHref) {
                    fullUrl = History.getBaseUrl() + url.replace(/^(\.\/)+/, '');
                } else {
                    fullUrl = History.getBasePageUrl() + url.replace(/^(\.\/)+/, '');
                }
                // We have an if condition above as we do not want hashes
                // which are relative to the baseHref in our URLs
                // as if the baseHref changes, then all our bookmarks
                // would now point to different locations
                // whereas the basePageUrl will always stay the same
            }

            // Return
            return fullUrl.replace(/\#$/, '');
        };

        /**
         * History.getShortUrl(url)
         * Ensures that we have a relative URL and not a absolute URL
         * @param {string} url
         * @return {string} url
         */
        History.getShortUrl = function (url) {
            // Prepare
            var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();

            // Trim baseUrl
            if (History.emulated.pushState) {
                // We are in a if statement as when pushState is not emulated
                // The actual url these short urls are relative to can change
                // So within the same session, we the url may end up somewhere different
                shortUrl = shortUrl.replace(baseUrl, '');
            }

            // Trim rootUrl
            shortUrl = shortUrl.replace(rootUrl, '/');

            // Ensure we can still detect it as a state
            if (History.isTraditionalAnchor(shortUrl)) {
                shortUrl = './' + shortUrl;
            }

            // Clean It
            shortUrl = shortUrl.replace(/^(\.\/)+/g, './').replace(/\#$/, '');

            // Return
            return shortUrl;
        };

        /**
         * History.getLocationHref(document)
         * Returns a normalized version of document.location.href
         * accounting for browser inconsistencies, etc.
         *
         * This URL will be URI-encoded and will include the hash
         *
         * @param {object} document
         * @return {string} url
         */
        History.getLocationHref = function (doc) {
            doc = doc || document;

            // most of the time, this will be true
            if (doc.URL === doc.location.href)
                return doc.location.href;

            // some versions of webkit URI-decode document.location.href
            // but they leave document.URL in an encoded state
            if (doc.location.href === decodeURIComponent(doc.URL))
                return doc.URL;

            // FF 3.6 only updates document.URL when a page is reloaded
            // document.location.href is updated correctly
            if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, "")) === doc.location.hash)
                return doc.location.href;

            if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)
                return doc.location.href;

            return doc.URL || doc.location.href;
        };


        // ====================================================================
        // State Storage

        /**
         * History.store
         * The store for all session specific data
         */
        History.store = {};

        /**
         * History.idToState
         * 1-1: State ID to State Object
         */
        History.idToState = History.idToState || {};

        /**
         * History.stateToId
         * 1-1: State String to State ID
         */
        History.stateToId = History.stateToId || {};

        /**
         * History.urlToId
         * 1-1: State URL to State ID
         */
        History.urlToId = History.urlToId || {};

        /**
         * History.storedStates
         * Store the states in an array
         */
        History.storedStates = History.storedStates || [];

        /**
         * History.savedStates
         * Saved the states in an array
         */
        History.savedStates = History.savedStates || [];

        /**
         * History.noramlizeStore()
         * Noramlize the store by adding necessary values
         */
        History.normalizeStore = function () {
            History.store.idToState = History.store.idToState || {};
            History.store.urlToId = History.store.urlToId || {};
            History.store.stateToId = History.store.stateToId || {};
        };

        /**
         * History.getState()
         * Get an object containing the data, title and url of the current state
         * @param {Boolean} friendly
         * @param {Boolean} create
         * @return {Object} State
         */
        History.getState = function (friendly, create) {
            // Prepare
            if (typeof friendly === 'undefined') {
                friendly = true;
            }
            if (typeof create === 'undefined') {
                create = true;
            }

            // Fetch
            var State = History.getLastSavedState();

            // Create
            if (!State && create) {
                State = History.createStateObject();
            }

            // Adjust
            if (friendly) {
                State = History.cloneObject(State);
                State.url = State.cleanUrl || State.url;
            }

            // Return
            return State;
        };

        /**
         * History.getIdByState(State)
         * Gets a ID for a State
         * @param {State} newState
         * @return {String} id
         */
        History.getIdByState = function (newState) {

            // Fetch ID
            var id = History.extractId(newState.url),
                str;

            if (!id) {
                // Find ID via State String
                str = History.getStateString(newState);
                if (typeof History.stateToId[str] !== 'undefined') {
                    id = History.stateToId[str];
                }
                else if (typeof History.store.stateToId[str] !== 'undefined') {
                    id = History.store.stateToId[str];
                }
                else {
                    // Generate a new ID
                    while (true) {
                        id = (new Date()).getTime() + String(Math.random()).replace(/\D/g, '');
                        if (typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined') {
                            break;
                        }
                    }

                    // Apply the new State to the ID
                    History.stateToId[str] = id;
                    History.idToState[id] = newState;
                }
            }

            // Return ID
            return id;
        };

        /**
         * History.normalizeState(State)
         * Expands a State Object
         * @param {object} State
         * @return {object}
         */
        History.normalizeState = function (oldState) {
            // Variables
            var newState, dataNotEmpty;

            // Prepare
            if (!oldState || (typeof oldState !== 'object')) {
                oldState = {};
            }

            // Check
            if (typeof oldState.normalized !== 'undefined') {
                return oldState;
            }

            // Adjust
            if (!oldState.data || (typeof oldState.data !== 'object')) {
                oldState.data = {};
            }

            // ----------------------------------------------------------------

            // Create
            newState = {};
            newState.normalized = true;
            newState.title = oldState.title || '';
            newState.url = History.getFullUrl(oldState.url ? oldState.url : (History.getLocationHref()));
            newState.hash = History.getShortUrl(newState.url);
            newState.data = History.cloneObject(oldState.data);

            // Fetch ID
            newState.id = History.getIdByState(newState);

            // ----------------------------------------------------------------

            // Clean the URL
            newState.cleanUrl = newState.url.replace(/\??\&_suid.*/, '');
            newState.url = newState.cleanUrl;

            // Check to see if we have more than just a url
            dataNotEmpty = !History.isEmptyObject(newState.data);

            // Apply
            if ((newState.title || dataNotEmpty) && History.options.disableSuid !== true) {
                // Add ID to Hash
                newState.hash = History.getShortUrl(newState.url).replace(/\??\&_suid.*/, '');
                if (!/\?/.test(newState.hash)) {
                    newState.hash += '?';
                }
                newState.hash += '&_suid=' + newState.id;
            }

            // Create the Hashed URL
            newState.hashedUrl = History.getFullUrl(newState.hash);

            // ----------------------------------------------------------------

            // Update the URL if we have a duplicate
            if ((History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState)) {
                newState.url = newState.hashedUrl;
            }

            // ----------------------------------------------------------------

            // Return
            return newState;
        };

        /**
         * History.createStateObject(data,title,url)
         * Creates a object based on the data, title and url state params
         * @param {object} data
         * @param {string} title
         * @param {string} url
         * @return {object}
         */
        History.createStateObject = function (data, title, url) {
            // Hashify
            var State = {
                'data': data,
                'title': title,
                'url': url
            };

            // Expand the State
            State = History.normalizeState(State);

            // Return object
            return State;
        };

        /**
         * History.getStateById(id)
         * Get a state by it's UID
         * @param {String} id
         */
        History.getStateById = function (id) {
            // Prepare
            id = String(id);

            // Retrieve
            var State = History.idToState[id] || History.store.idToState[id] || undefined;

            // Return State
            return State;
        };

        /**
         * Get a State's String
         * @param {State} passedState
         */
        History.getStateString = function (passedState) {
            // Prepare
            var State, cleanedState, str;

            // Fetch
            State = History.normalizeState(passedState);

            // Clean
            cleanedState = {
                data: State.data,
                title: passedState.title,
                url: passedState.url
            };

            // Fetch
            str = JSON.stringify(cleanedState);

            // Return
            return str;
        };

        /**
         * Get a State's ID
         * @param {State} passedState
         * @return {String} id
         */
        History.getStateId = function (passedState) {
            // Prepare
            var State, id;

            // Fetch
            State = History.normalizeState(passedState);

            // Fetch
            id = State.id;

            // Return
            return id;
        };

        /**
         * History.getHashByState(State)
         * Creates a Hash for the State Object
         * @param {State} passedState
         * @return {String} hash
         */
        History.getHashByState = function (passedState) {
            // Prepare
            var State, hash;

            // Fetch
            State = History.normalizeState(passedState);

            // Hash
            hash = State.hash;

            // Return
            return hash;
        };

        /**
         * History.extractId(url_or_hash)
         * Get a State ID by it's URL or Hash
         * @param {string} url_or_hash
         * @return {string} id
         */
        History.extractId = function (url_or_hash) {
            // Prepare
            var id, parts, url, tmp;

            // Extract

            // If the URL has a #, use the id from before the #
            if (url_or_hash.indexOf('#') != -1) {
                tmp = url_or_hash.split("#")[0];
            }
            else {
                tmp = url_or_hash;
            }

            parts = /(.*)\&_suid=([0-9]+)$/.exec(tmp);
            url = parts ? (parts[1] || url_or_hash) : url_or_hash;
            id = parts ? String(parts[2] || '') : '';

            // Return
            return id || false;
        };

        /**
         * History.isTraditionalAnchor
         * Checks to see if the url is a traditional anchor or not
         * @param {String} url_or_hash
         * @return {Boolean}
         */
        History.isTraditionalAnchor = function (url_or_hash) {
            // Check
            var isTraditional = !(/[\/\?\.]/.test(url_or_hash));

            // Return
            return isTraditional;
        };

        /**
         * History.extractState
         * Get a State by it's URL or Hash
         * @param {String} url_or_hash
         * @return {State|null}
         */
        History.extractState = function (url_or_hash, create) {
            // Prepare
            var State = null, id, url;
            create = create || false;

            // Fetch SUID
            id = History.extractId(url_or_hash);
            if (id) {
                State = History.getStateById(id);
            }

            // Fetch SUID returned no State
            if (!State) {
                // Fetch URL
                url = History.getFullUrl(url_or_hash);

                // Check URL
                id = History.getIdByUrl(url) || false;
                if (id) {
                    State = History.getStateById(id);
                }

                // Create State
                if (!State && create && !History.isTraditionalAnchor(url_or_hash)) {
                    State = History.createStateObject(null, null, url);
                }
            }

            // Return
            return State;
        };

        /**
         * History.getIdByUrl()
         * Get a State ID by a State URL
         */
        History.getIdByUrl = function (url) {
            // Fetch
            var id = History.urlToId[url] || History.store.urlToId[url] || undefined;

            // Return
            return id;
        };

        /**
         * History.getLastSavedState()
         * Get an object containing the data, title and url of the current state
         * @return {Object} State
         */
        History.getLastSavedState = function () {
            return History.savedStates[History.savedStates.length - 1] || undefined;
        };

        /**
         * History.getLastStoredState()
         * Get an object containing the data, title and url of the current state
         * @return {Object} State
         */
        History.getLastStoredState = function () {
            return History.storedStates[History.storedStates.length - 1] || undefined;
        };

        /**
         * History.hasUrlDuplicate
         * Checks if a Url will have a url conflict
         * @param {Object} newState
         * @return {Boolean} hasDuplicate
         */
        History.hasUrlDuplicate = function (newState) {
            // Prepare
            var hasDuplicate = false,
                oldState;

            // Fetch
            oldState = History.extractState(newState.url);

            // Check
            hasDuplicate = oldState && oldState.id !== newState.id;

            // Return
            return hasDuplicate;
        };

        /**
         * History.storeState
         * Store a State
         * @param {Object} newState
         * @return {Object} newState
         */
        History.storeState = function (newState) {
            // Store the State
            History.urlToId[newState.url] = newState.id;

            // Push the State
            History.storedStates.push(History.cloneObject(newState));

            // Return newState
            return newState;
        };

        /**
         * History.isLastSavedState(newState)
         * Tests to see if the state is the last state
         * @param {Object} newState
         * @return {boolean} isLast
         */
        History.isLastSavedState = function (newState) {
            // Prepare
            var isLast = false,
                newId, oldState, oldId;

            // Check
            if (History.savedStates.length) {
                newId = newState.id;
                oldState = History.getLastSavedState();
                oldId = oldState.id;

                // Check
                isLast = (newId === oldId);
            }

            // Return
            return isLast;
        };

        /**
         * History.saveState
         * Push a State
         * @param {Object} newState
         * @return {boolean} changed
         */
        History.saveState = function (newState) {
            // Check Hash
            if (History.isLastSavedState(newState)) {
                return false;
            }

            // Push the State
            History.savedStates.push(History.cloneObject(newState));

            // Return true
            return true;
        };

        /**
         * History.getStateByIndex()
         * Gets a state by the index
         * @param {integer} index
         * @return {Object}
         */
        History.getStateByIndex = function (index) {
            // Prepare
            var State = null;

            // Handle
            if (typeof index === 'undefined') {
                // Get the last inserted
                State = History.savedStates[History.savedStates.length - 1];
            }
            else if (index < 0) {
                // Get from the end
                State = History.savedStates[History.savedStates.length + index];
            }
            else {
                // Get from the beginning
                State = History.savedStates[index];
            }

            // Return State
            return State;
        };

        /**
         * History.getCurrentIndex()
         * Gets the current index
         * @return (integer)
         */
        History.getCurrentIndex = function () {
            // Prepare
            var index = null;

            // No states saved
            if (History.savedStates.length < 1) {
                index = 0;
            }
            else {
                index = History.savedStates.length - 1;
            }
            return index;
        };

        // ====================================================================
        // Hash Helpers

        /**
         * History.getHash()
         * @param {Location=} location
         * Gets the current document hash
         * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers
         * @return {string}
         */
        History.getHash = function (doc) {
            var url = History.getLocationHref(doc),
                hash;
            hash = History.getHashByUrl(url);
            return hash;
        };

        /**
         * History.unescapeHash()
         * normalize and Unescape a Hash
         * @param {String} hash
         * @return {string}
         */
        History.unescapeHash = function (hash) {
            // Prepare
            var result = History.normalizeHash(hash);

            // Unescape hash
            result = decodeURIComponent(result);

            // Return result
            return result;
        };

        /**
         * History.normalizeHash()
         * normalize a hash across browsers
         * @return {string}
         */
        History.normalizeHash = function (hash) {
            // Prepare
            var result = hash.replace(/[^#]*#/, '').replace(/#.*/, '');

            // Return result
            return result;
        };

        /**
         * History.setHash(hash)
         * Sets the document hash
         * @param {string} hash
         * @return {History}
         */
        History.setHash = function (hash, queue) {
            // Prepare
            var State, pageUrl;

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.setHash: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.setHash,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Log
            //History.debug('History.setHash: called',hash);

            // Make Busy + Continue
            History.busy(true);

            // Check if hash is a state
            State = History.extractState(hash, true);
            if (State && !History.emulated.pushState) {
                // Hash is a state so skip the setHash
                //History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);

                // PushState
                History.pushState(State.data, State.title, State.url, false);
            }
            else if (History.getHash() !== hash) {
                // Hash is a proper hash, so apply it

                // Handle browser bugs
                if (History.bugs.setHash) {
                    // Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249

                    // Fetch the base page
                    pageUrl = History.getPageUrl();

                    // Safari hash apply
                    History.pushState(null, null, pageUrl + '#' + hash, false);
                }
                else {
                    // Normal hash apply
                    document.location.hash = hash;
                }
            }

            // Chain
            return History;
        };

        /**
         * History.escape()
         * normalize and Escape a Hash
         * @return {string}
         */
        History.escapeHash = function (hash) {
            // Prepare
            var result = History.normalizeHash(hash);

            // Escape hash
            result = window.encodeURIComponent(result);

            // IE6 Escape Bug
            if (!History.bugs.hashEscape) {
                // Restore common parts
                result = result
                    .replace(/\%21/g, '!')
                    .replace(/\%26/g, '&')
                    .replace(/\%3D/g, '=')
                    .replace(/\%3F/g, '?');
            }

            // Return result
            return result;
        };

        /**
         * History.getHashByUrl(url)
         * Extracts the Hash from a URL
         * @param {string} url
         * @return {string} url
         */
        History.getHashByUrl = function (url) {
            // Extract the hash
            var hash = String(url)
                    .replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')
                ;

            // Unescape hash
            hash = History.unescapeHash(hash);

            // Return hash
            return hash;
        };

        /**
         * History.setTitle(title)
         * Applies the title to the document
         * @param {State} newState
         * @return {Boolean}
         */
        History.setTitle = function (newState) {
            // Prepare
            var title = newState.title,
                firstState;

            // Initial
            if (!title) {
                firstState = History.getStateByIndex(0);
                if (firstState && firstState.url === newState.url) {
                    title = firstState.title || History.options.initialTitle;
                }
            }

            // Apply
            try {
                document.getElementsByTagName('title')[0].innerHTML = title.replace('<', '&lt;').replace('>', '&gt;').replace(' & ', ' &amp; ');
            }
            catch (Exception) {
            }
            document.title = title;

            // Chain
            return History;
        };


        // ====================================================================
        // Queueing

        /**
         * History.queues
         * The list of queues to use
         * First In, First Out
         */
        History.queues = [];

        /**
         * History.busy(value)
         * @param {boolean} value [optional]
         * @return {boolean} busy
         */
        History.busy = function (value) {
            // Apply
            if (typeof value !== 'undefined') {
                //History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);
                History.busy.flag = value;
            }
            // Default
            else if (typeof History.busy.flag === 'undefined') {
                History.busy.flag = false;
            }

            // Queue
            if (!History.busy.flag) {
                // Execute the next item in the queue
                clearTimeout(History.busy.timeout);
                var fireNext = function () {
                    var i, queue, item;
                    if (History.busy.flag) return;
                    for (i = History.queues.length - 1; i >= 0; --i) {
                        queue = History.queues[i];
                        if (queue.length === 0) continue;
                        item = queue.shift();
                        History.fireQueueItem(item);
                        History.busy.timeout = setTimeout(fireNext, History.options.busyDelay);
                    }
                };
                History.busy.timeout = setTimeout(fireNext, History.options.busyDelay);
            }

            // Return
            return History.busy.flag;
        };

        /**
         * History.busy.flag
         */
        History.busy.flag = false;

        /**
         * History.fireQueueItem(item)
         * Fire a Queue Item
         * @param {Object} item
         * @return {Mixed} result
         */
        History.fireQueueItem = function (item) {
            return item.callback.apply(item.scope || History, item.args || []);
        };

        /**
         * History.pushQueue(callback,args)
         * Add an item to the queue
         * @param {Object} item [scope,callback,args,queue]
         */
        History.pushQueue = function (item) {
            // Prepare the queue
            History.queues[item.queue || 0] = History.queues[item.queue || 0] || [];

            // Add to the queue
            History.queues[item.queue || 0].push(item);

            // Chain
            return History;
        };

        /**
         * History.queue (item,queue), (func,queue), (func), (item)
         * Either firs the item now if not busy, or adds it to the queue
         */
        History.queue = function (item, queue) {
            // Prepare
            if (typeof item === 'function') {
                item = {
                    callback: item
                };
            }
            if (typeof queue !== 'undefined') {
                item.queue = queue;
            }

            // Handle
            if (History.busy()) {
                History.pushQueue(item);
            } else {
                History.fireQueueItem(item);
            }

            // Chain
            return History;
        };

        /**
         * History.clearQueue()
         * Clears the Queue
         */
        History.clearQueue = function () {
            History.busy.flag = false;
            History.queues = [];
            return History;
        };


        // ====================================================================
        // IE Bug Fix

        /**
         * History.stateChanged
         * States whether or not the state has changed since the last double check was initialised
         */
        History.stateChanged = false;

        /**
         * History.doubleChecker
         * Contains the timeout used for the double checks
         */
        History.doubleChecker = false;

        /**
         * History.doubleCheckComplete()
         * Complete a double check
         * @return {History}
         */
        History.doubleCheckComplete = function () {
            // Update
            History.stateChanged = true;

            // Clear
            History.doubleCheckClear();

            // Chain
            return History;
        };

        /**
         * History.doubleCheckClear()
         * Clear a double check
         * @return {History}
         */
        History.doubleCheckClear = function () {
            // Clear
            if (History.doubleChecker) {
                clearTimeout(History.doubleChecker);
                History.doubleChecker = false;
            }

            // Chain
            return History;
        };

        /**
         * History.doubleCheck()
         * Create a double check
         * @return {History}
         */
        History.doubleCheck = function (tryAgain) {
            // Reset
            History.stateChanged = false;
            History.doubleCheckClear();

            // Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)
            // Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940
            if (History.bugs.ieDoubleCheck) {
                // Apply Check
                History.doubleChecker = setTimeout(
                    function () {
                        History.doubleCheckClear();
                        if (!History.stateChanged) {
                            //History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);
                            // Re-Attempt
                            tryAgain();
                        }
                        return true;
                    },
                    History.options.doubleCheckInterval
                );
            }

            // Chain
            return History;
        };


        // ====================================================================
        // Safari Bug Fix

        /**
         * History.safariStatePoll()
         * Poll the current state
         * @return {History}
         */
        History.safariStatePoll = function () {
            // Poll the URL

            // Get the Last State which has the new URL
            var
                urlState = History.extractState(History.getLocationHref()),
                newState;

            // Check for a difference
            if (!History.isLastSavedState(urlState)) {
                newState = urlState;
            }
            else {
                return;
            }

            // Check if we have a state with that url
            // If not create it
            if (!newState) {
                //History.debug('History.safariStatePoll: new');
                newState = History.createStateObject();
            }

            // Apply the New State
            //History.debug('History.safariStatePoll: trigger');
            History.Adapter.trigger(window, 'popstate');

            // Chain
            return History;
        };


        // ====================================================================
        // State Aliases

        /**
         * History.back(queue)
         * Send the browser history back one item
         * @param {Integer} queue [optional]
         */
        History.back = function (queue) {
            //History.debug('History.back: called', arguments);

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.back: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.back,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Make Busy + Continue
            History.busy(true);

            // Fix certain browser bugs that prevent the state from changing
            History.doubleCheck(function () {
                History.back(false);
            });

            // Go back
            history.go(-1);

            // End back closure
            return true;
        };

        /**
         * History.forward(queue)
         * Send the browser history forward one item
         * @param {Integer} queue [optional]
         */
        History.forward = function (queue) {
            //History.debug('History.forward: called', arguments);

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.forward: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.forward,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Make Busy + Continue
            History.busy(true);

            // Fix certain browser bugs that prevent the state from changing
            History.doubleCheck(function () {
                History.forward(false);
            });

            // Go forward
            history.go(1);

            // End forward closure
            return true;
        };

        /**
         * History.go(index,queue)
         * Send the browser history back or forward index times
         * @param {Integer} queue [optional]
         */
        History.go = function (index, queue) {
            //History.debug('History.go: called', arguments);

            // Prepare
            var i;

            // Handle
            if (index > 0) {
                // Forward
                for (i = 1; i <= index; ++i) {
                    History.forward(queue);
                }
            }
            else if (index < 0) {
                // Backward
                for (i = -1; i >= index; --i) {
                    History.back(queue);
                }
            }
            else {
                throw new Error('History.go: History.go requires a positive or negative integer passed.');
            }

            // Chain
            return History;
        };


        // ====================================================================
        // HTML5 State Support

        // Non-Native pushState Implementation
        if (History.emulated.pushState) {
            /*
             * Provide Skeleton for HTML4 Browsers
             */

            // Prepare
            var emptyFunction = function () {};
            History.pushState = History.pushState || emptyFunction;
            History.replaceState = History.replaceState || emptyFunction;
        } // History.emulated.pushState

        // Native pushState Implementation
        else {
            /*
             * Use native HTML5 History API Implementation
             */

            /**
             * History.onPopState(event,extra)
             * Refresh the Current State
             */
            History.onPopState = function (event, extra) {
                // Prepare
                var stateId = false, newState = false, currentHash, currentState;

                // Reset the double check
                History.doubleCheckComplete();

                // Check for a Hash, and handle apporiatly
                currentHash = History.getHash();
                if (currentHash) {
                    // Expand Hash
                    currentState = History.extractState(currentHash || History.getLocationHref(), true);
                    if (currentState) {
                        // We were able to parse it, it must be a State!
                        // Let's forward to replaceState
                        //History.debug('History.onPopState: state anchor', currentHash, currentState);
                        History.replaceState(currentState.data, currentState.title, currentState.url, false);
                    }
                    else {
                        // Traditional Anchor
                        //History.debug('History.onPopState: traditional anchor', currentHash);
                        History.Adapter.trigger(window, 'anchorchange');
                        History.busy(false);
                    }

                    // We don't care for hashes
                    History.expectedStateId = false;
                    return false;
                }

                // Ensure
                stateId = History.Adapter.extractEventData('state', event, extra) || false;

                // Fetch State
                if (stateId) {
                    // Vanilla: Back/forward button was used
                    newState = History.getStateById(stateId);
                }
                else if (History.expectedStateId) {
                    // Vanilla: A new state was pushed, and popstate was called manually
                    newState = History.getStateById(History.expectedStateId);
                }
                else {
                    // Initial State
                    newState = History.extractState(History.getLocationHref());
                }

                // The State did not exist in our store
                if (!newState) {
                    // Regenerate the State
                    newState = History.createStateObject(null, null, History.getLocationHref());
                }

                // Clean
                History.expectedStateId = false;

                // Check if we are the same state
                if (History.isLastSavedState(newState)) {
                    // There has been no change (just the page's hash has finally propagated)
                    //History.debug('History.onPopState: no change', newState, History.savedStates);
                    History.busy(false);
                    return false;
                }

                // Store the State
                History.storeState(newState);
                History.saveState(newState);

                // Force update of the title
                History.setTitle(newState);

                // Fire Our Event
                History.Adapter.trigger(window, 'statechange');
                History.busy(false);

                // Return true
                return true;
            };
            History.Adapter.bind(window, 'popstate', History.onPopState);

            /**
             * History.pushState(data,title,url)
             * Add a new State to the history object, become it, and trigger onpopstate
             * We have to trigger for HTML4 compatibility
             * @param {object} data
             * @param {string} title
             * @param {string} url
             * @return {true}
             */
            History.pushState = function (data, title, url, queue) {
                //History.debug('History.pushState: called', arguments);

                // Check the State
                if (History.getHashByUrl(url) && History.emulated.pushState) {
                    throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
                }

                // Handle Queueing
                if (queue !== false && History.busy()) {
                    // Wait + Push to Queue
                    //History.debug('History.pushState: we must wait', arguments);
                    History.pushQueue({
                        scope: History,
                        callback: History.pushState,
                        args: arguments,
                        queue: queue
                    });
                    return false;
                }

                // Make Busy + Continue
                History.busy(true);

                // Create the newState
                var newState = History.createStateObject(data, title, url);

                // Check it
                if (History.isLastSavedState(newState)) {
                    // Won't be a change
                    History.busy(false);
                }
                else {
                    // Store the newState
                    History.storeState(newState);
                    History.expectedStateId = newState.id;

                    // Push the newState
                    history.pushState(newState.id, newState.title, newState.url);

                    // Fire HTML5 Event
                    History.Adapter.trigger(window, 'popstate');
                }

                // End pushState closure
                return true;
            };

            /**
             * History.replaceState(data,title,url)
             * Replace the State and trigger onpopstate
             * We have to trigger for HTML4 compatibility
             * @param {object} data
             * @param {string} title
             * @param {string} url
             * @return {true}
             */
            History.replaceState = function (data, title, url, queue) {
                //History.debug('History.replaceState: called', arguments);

                // Check the State
                if (History.getHashByUrl(url) && History.emulated.pushState) {
                    throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
                }

                // Handle Queueing
                if (queue !== false && History.busy()) {
                    // Wait + Push to Queue
                    //History.debug('History.replaceState: we must wait', arguments);
                    History.pushQueue({
                        scope: History,
                        callback: History.replaceState,
                        args: arguments,
                        queue: queue
                    });
                    return false;
                }

                // Make Busy + Continue
                History.busy(true);

                // Create the newState
                var newState = History.createStateObject(data, title, url);

                // Check it
                if (History.isLastSavedState(newState)) {
                    // Won't be a change
                    History.busy(false);
                }
                else {
                    // Store the newState
                    History.storeState(newState);
                    History.expectedStateId = newState.id;

                    // Push the newState
                    history.replaceState(newState.id, newState.title, newState.url);

                    // Fire HTML5 Event
                    History.Adapter.trigger(window, 'popstate');
                }

                // End replaceState closure
                return true;
            };

        } // !History.emulated.pushState


        // ====================================================================
        // Initialise

        /**
         * Load the Store
         */
        if (sessionStorage) {
            // Fetch
            try {
                History.store = JSON.parse(sessionStorage.getItem('History.store')) || {};
            }
            catch (err) {
                History.store = {};
            }

            // Normalize
            History.normalizeStore();
        }
        else {
            // Default Load
            History.store = {};
            History.normalizeStore();
        }

        /**
         * Clear Intervals on exit to prevent memory leaks
         */
        History.Adapter.bind(window, "unload", History.clearAllIntervals);

        /**
         * Create the initial State
         */
        History.saveState(History.storeState(History.extractState(History.getLocationHref(), true)));

        /**
         * Bind for Saving Store
         */
        if (sessionStorage) {
            // When the page is closed
            History.onUnload = function () {
                // Prepare
                var currentStore, item, currentStoreString;

                // Fetch
                try {
                    currentStore = JSON.parse(sessionStorage.getItem('History.store')) || {};
                }
                catch (err) {
                    currentStore = {};
                }

                // Ensure
                currentStore.idToState = currentStore.idToState || {};
                currentStore.urlToId = currentStore.urlToId || {};
                currentStore.stateToId = currentStore.stateToId || {};

                // Sync
                for (item in History.idToState) {
                    if (!History.idToState.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.idToState[item] = History.idToState[item];
                }
                for (item in History.urlToId) {
                    if (!History.urlToId.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.urlToId[item] = History.urlToId[item];
                }
                for (item in History.stateToId) {
                    if (!History.stateToId.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.stateToId[item] = History.stateToId[item];
                }

                // Update
                History.store = currentStore;
                History.normalizeStore();

                // In Safari, going into Private Browsing mode causes the
                // Session Storage object to still exist but if you try and use
                // or set any property/function of it it throws the exception
                // "QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to
                // add something to storage that exceeded the quota." infinitely
                // every second.
                currentStoreString = JSON.stringify(currentStore);
                try {
                    // Store
                    sessionStorage.setItem('History.store', currentStoreString);
                }
                catch (e) {
                    if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {
                        if (sessionStorage.length) {
                            // Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply
                            // removing/resetting the storage can work.
                            sessionStorage.removeItem('History.store');
                            sessionStorage.setItem('History.store', currentStoreString);
                        } else {
                            // Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.
                        }
                    } else {
                        throw e;
                    }
                }
            };

            // For Internet Explorer
            History.isInternetExplorer() && History.intervalList.push(setInterval(History.onUnload, History.options.storeInterval));

            // For Other Browsers
            History.Adapter.bind(window, 'beforeunload', History.onUnload);
            History.Adapter.bind(window, 'unload', History.onUnload);

            // Both are enabled for consistency
        }

        // Non-Native pushState Implementation
        if (!History.emulated.pushState) {
            // Be aware, the following is only for native pushState implementations
            // If you are wanting to include something for all browsers
            // Then include it above this if block

            /**
             * Setup Safari Fix
             */
            if (History.bugs.safariPoll) {
                History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));
            }

            /**
             * Ensure Cross Browser Compatibility
             */
            if (navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName || '') === 'Mozilla') {
                /**
                 * Fix Safari HashChange Issue
                 */

                    // Setup Alias
                History.Adapter.bind(window, 'hashchange', function () {
                    History.Adapter.trigger(window, 'popstate');
                });

                // Initialise Alias
                if (History.getHash()) {
                    History.Adapter.onDomLoad(function () {
                        History.Adapter.trigger(window, 'hashchange');
                    });
                }
            }

        } // !History.emulated.pushState


    }; // History.initCore

    // Try to Initialise History
    if (!History.options || !History.options.delayInit) {
        History.init();
    }
}

module.exports = History;
},{"./history-adapter":72}],74:[function(require,module,exports){
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
        || window[vendors[x]+'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };

    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());

module.exports = {};
},{}],75:[function(require,module,exports){
var prime      = require('prime'),
    deepClone  = require('mout/lang/deepClone');

//var objectDiff = require('objectdiff');

var SaveState = new prime({

    constructor: function(session) {
        session = deepClone(session);
        this.setSession(session);
    },

    setSession: function(session) {
        session = !session ? {}
            : {
            time: +(new Date()),
            data: deepClone(session)
        };

        this.session = session;
        return this.session;
    },

    getTime: function() {
        return this.session.time;
    },

    getData: function() {
        return this.session.data;
    },

    getSession: function() {
        return this.session;
    },

    getDiff: function(data) {
        // Unsupported at this state
        return data;
        /*
        var diff = objectDiff.diff(this.getData(), data);
        return {
            diff: diff,
            xml: objectDiff.convertToXMLString(diff)
        };
        */
    }
});

module.exports = SaveState;

},{"mout/lang/deepClone":198,"prime":299}],76:[function(require,module,exports){
(function (global){
"use strict";

var replace = require('mout/string/replace');

module.exports = function(key, replacement) {
    var G5T = global.G5T || function(key) { return key; };
    return replace(G5T(key), '%s', replacement || '');
};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"mout/string/replace":265}],77:[function(require,module,exports){
var $ = require('elements');

module.exports = function(field) {
    if (!field) { return false; }

    if ($('body').hasClass('wp-customizer') && jQuery) {
        var widgetContainer = field.parent('.widget-content'),
            title = field.siblings('.g-instancepicker-title');

        if (widgetContainer) {
            var jQueryEvent = jQuery.Event('change');
            jQueryEvent.target = field[0];
            jQuery(widgetContainer[0]).trigger(jQueryEvent);
        }

        if (title) {
            setTimeout(function(){
                title.hideIndicator();
            }, 5);
        }
    }
};
},{"elements":111}],78:[function(require,module,exports){
/*
Agent
- heavily inspired by superagent by visionmedia https://github.com/visionmedia/superagent, released under the MIT license
- code derived from MooTools 1.4 Request.js && superagent
- MIT-License
*/"use strict";
/* global ActiveXObject */

var prime   = require("prime"),
    Emitter = require("prime/emitter")

var isObject   = require("mout/lang/isObject"),
    isString   = require("mout/lang/isString"),
    isArray    = require("mout/lang/isArray"),
    isFunction = require("mout/lang/isFunction"),
    trim       = require("mout/string/trim"),
    upperCase  = require("mout/string/upperCase"),
    forIn      = require("mout/object/forIn"),
    mixIn      = require("mout/object/mixIn"),
    remove     = require("mout/array/remove"),
    forEach    = require("mout/array/forEach")

var capitalize = function(str){
    return str.replace(/\b[a-z]/g, upperCase)
}

// MooTools

var getRequest = (function(){

    var XMLHTTP = function(){
        return new XMLHttpRequest()
    }, MSXML2 = function(){
        return new ActiveXObject("MSXML2.XMLHTTP")
    }, MSXML = function(){
        return new ActiveXObject("Microsoft.XMLHTTP")
    }

    try {
      XMLHTTP()
      return XMLHTTP
    } catch(e){}
    try {
        MSXML2()
        return MSXML2
    } catch(e){}
    try {
        MSXML()
        return MSXML
    } catch(e){}

    return null

})()

var encodeJSON = function(object){
    if (object == null) return ""
    if (object.toJSON) return object.toJSON()
    return JSON.stringify(object)
}

// MooTools

var encodeQueryString = function(object, base){

    if (object == null) return ""
    if (object.toQueryString) return object.toQueryString()

    var queryString = []

    forIn(object, function(value, key){
        if (base) key = base + "[" + key + "]"
        var result

        if (value == null) return

        if (isArray(value)){
            var qs = {}
            for (var i = 0; i < value.length; i++) qs[i] = value[i]
            result = encodeQueryString(qs, key)
        } else if (isObject(value)){
            result = encodeQueryString(value, key)
        } else {
            result = key + "=" + encodeURIComponent(value)
        }

        queryString.push(result)
    })

    return queryString.join("&")

}

var decodeJSON = JSON.parse

// decodeQueryString by Brian Donovan
// http://stackoverflow.com/users/549363/brian-donovan

var decodeQueryString = function(params){

    var pairs  = params.split('&'),
        result = {}

    for (var i = 0; i < pairs.length; i++){

        var pair      = pairs[i].split('='),
            key       = decodeURIComponent(pair[0]),
            value     = decodeURIComponent(pair[1]),
            isArray   = /\[\]$/.test(key),
            dictMatch = key.match(/^(.+)\[([^\]]+)\]$/)

        if (dictMatch){
            key = dictMatch[1]
            var subkey = dictMatch[2]

            result[key] = result[key] || {}
            result[key][subkey] = value
        } else if (isArray){
            key = key.substring(0, key.length - 2)
            result[key] = result[key] || []
            result[key].push(value)
        } else {
            result[key] = value
        }

    }

    return result

}

var encoders = {
    "application/json" : encodeJSON,
    "application/x-www-form-urlencoded" : encodeQueryString
}

var decoders = {
    "application/json": decodeJSON,
    "application/x-www-form-urlencoded": decodeQueryString
}

// parseHeader from superagent
// https://github.com/visionmedia/superagent
// MIT

var parseHeader = function(str){
    var lines = str.split(/\r?\n/), fields = {}

    lines.pop() // trailing CRLF

    for (var i = 0, l = lines.length; i < l; ++i){
        var line  = lines[i],
            index = line.indexOf(':'),
            field = capitalize(line.slice(0, index)),
            value = trim(line.slice(index + 1))

        fields[field] = value
    }

    return fields
}

var REQUESTS = 0, Q = [] // Queue stuff

var Request = prime({

    constructor: function Request(){
        this._header = {
            "Content-Type": "application/x-www-form-urlencoded"
        }
    },

    header: function(name, value){
        if (isObject(name)) for (var key in name) this.header(key, name[key])
        else if (!arguments.length) return this._header
        else if (arguments.length === 1) return this._header[capitalize(name)]
        else if (arguments.length === 2){
            if (value == null) delete this._header[capitalize(name)]
            else this._header[capitalize(name)] = value
        }
        return this
    },

    running: function(){
        return !!this._running
    },

    abort: function(){

        if (this._queued){
            remove(Q, this._queued)
            delete this._queued
        }

        if (this._xhr){
            this._xhr.abort()
            this._end()
        }

        return this
    },

    method: function(m){
        if (!arguments.length) return this._method
        this._method = m.toUpperCase()
        return this
    },

    data: function(d){
        if (!arguments.length) return this._data
        this._data = d
        return this
    },

    url: function(u){
        if (!arguments.length) return this._url
        this._url = u
        return this
    },

    user: function(u){
        if (!arguments.length) return this._user
        this._user = u
        return this
    },

    password: function(p){
        if (!arguments.length) return this._password
        this._password = p
        return this
    },

    _send: function(method, url, data, header, user, password, callback){
        var self = this

        if (REQUESTS === agent.MAX_REQUESTS) return Q.unshift(this._queued = function(){
            delete self._queued
            self._send(method, url, data, header, user, password, callback)
        })

        REQUESTS++

        var xhr = this._xhr = agent.getRequest()

        if (xhr.addEventListener) forEach(['progress', 'load', 'error' , 'abort', 'loadend'], function(method){
            xhr.addEventListener(method, function(event){
                self.emit(method, event)
            }, false)
        })

        xhr.open(method, url, true, user, password)
        if (user != null && "withCredentials" in xhr) xhr.withCredentials = true

        xhr.onreadystatechange = function(){
            if (xhr.readyState === 4){
                var status = xhr.status
                var response = new Response(xhr.responseText, status, parseHeader(xhr.getAllResponseHeaders()))
                var error = response.error ? new Error(method + " " + url + " " + status) : null
                self._end()
                callback(error, response)
            }
        }

        for (var field in header) xhr.setRequestHeader(field, header[field])
        xhr.send(data || null)
    },

    _end: function(){
        this._xhr.onreadystatechange = function(){}

        delete this._xhr
        delete this._running

        REQUESTS--

        var queued = Q.pop()
        if (queued) queued()
    },

    send: function(callback){
        if (this._running) this.abort()
        this._running = true

        if (!callback) callback = function(){}

        var method   = this._method || "POST",
            data     = this._data || null,
            url      = this._url,
            user     = this._user || null,
            password = this._password || null

        if (data && !isString(data)){
            var contentType = this._header['Content-Type'].split(/ *; */).shift(),
                encode      = encoders[contentType]
            if (encode) data = encode(data)
        }

        if (/GET|HEAD/.test(method) && data) url += (url.indexOf("?") > -1 ? "&" : "?") + data

        var header = mixIn({}, this._header);

        this._send(method, url, data, header, user, password, callback)

        return this

    }

})

Request.implement(new Emitter)

var Response = prime({

    constructor: function Response(text, status, header){

        this.text   = text
        this.status = status

        this.header = header

        // statuses from superagent
        // https://github.com/visionmedia/superagent
        // MIT

        var t = status / 100 | 0

        this.info        = t === 1
        this.ok          = t === 2
        this.clientError = t === 4
        this.serverError = t === 5
        this.error       = t === 4 || t === 5
        var length = '' + header['Content-Length']

        // sugar
        this.accepted      = status === 202
        this.noContent     = length === '0' || status === 204 || status === 1223
        this.badRequest    = status === 400
        this.unauthorized  = status === 401
        this.notAcceptable = status === 406
        this.notFound      = status === 404

        var contentType = header['Content-Type'] ? header['Content-Type'].split(/ *; */).shift() : '',
            decode

        if (!this.noContent) decode = decoders[contentType]

        this.body = decode ? decode(this.text) : this.text

    }

})

var methods  = "get|post|put|delete|head|patch|options",
    rMethods = new RegExp("^(" + methods + ")$", "i")

var agent = function(method, url, data, callback){
    var request = new Request()

    if (!arguments.length) return request

    if (!rMethods.test(method)){ // shift
        callback = data
        data     = url
        url      = method
        method   = "post"
    }

    if (isFunction(data)){
        callback = data
        data = null
    }

    request.method(method)

    if (url) request.url(url)
    if (data) request.data(data)
    if (callback) request.send(callback)

    return request
}

agent.encoder = function(ct, encode){
    if (arguments.length === 1) return encoders[ct]
    encoders[ct] = encode
    return agent
}

agent.decoder = function(ct, decode){
    if (arguments.length === 1) return decoders[ct]
    decoders[ct] = decode
    return agent
}

forEach(methods.split("|"), function(method){
    agent[method] = function(url, data, callback){
        return agent(method, url, data, callback)
    }
})

agent.MAX_REQUESTS = Infinity
agent.getRequest = getRequest
agent.Request  = Request
agent.Response = Response

module.exports = agent

},{"mout/array/forEach":79,"mout/array/remove":81,"mout/lang/isArray":83,"mout/lang/isFunction":84,"mout/lang/isObject":86,"mout/lang/isString":87,"mout/object/forIn":90,"mout/object/mixIn":93,"mout/string/trim":97,"mout/string/upperCase":98,"prime":102,"prime/emitter":101}],79:[function(require,module,exports){


    /**
     * Array forEach
     */
    function forEach(arr, callback, thisObj) {
        if (arr == null) {
            return;
        }
        var i = -1,
            len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if ( callback.call(thisObj, arr[i], i, arr) === false ) {
                break;
            }
        }
    }

    module.exports = forEach;



},{}],80:[function(require,module,exports){


    /**
     * Array.indexOf
     */
    function indexOf(arr, item, fromIndex) {
        fromIndex = fromIndex || 0;
        if (arr == null) {
            return -1;
        }

        var len = arr.length,
            i = fromIndex < 0 ? len + fromIndex : fromIndex;
        while (i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if (arr[i] === item) {
                return i;
            }

            i++;
        }

        return -1;
    }

    module.exports = indexOf;


},{}],81:[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Remove a single item from the array.
     * (it won't remove duplicates, just a single item)
     */
    function remove(arr, item){
        var idx = indexOf(arr, item);
        if (idx !== -1) arr.splice(idx, 1);
    }

    module.exports = remove;


},{"./indexOf":80}],82:[function(require,module,exports){
var mixIn = require('../object/mixIn');

    /**
     * Create Object using prototypal inheritance and setting custom properties.
     * - Mix between Douglas Crockford Prototypal Inheritance <http://javascript.crockford.com/prototypal.html> and the EcmaScript 5 `Object.create()` method.
     * @param {object} parent    Parent Object.
     * @param {object} [props] Object properties.
     * @return {object} Created object.
     */
    function createObject(parent, props){
        function F(){}
        F.prototype = parent;
        return mixIn(new F(), props);

    }
    module.exports = createObject;



},{"../object/mixIn":93}],83:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    var isArray = Array.isArray || function (val) {
        return isKind(val, 'Array');
    };
    module.exports = isArray;


},{"./isKind":85}],84:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isFunction(val) {
        return isKind(val, 'Function');
    }
    module.exports = isFunction;


},{"./isKind":85}],85:[function(require,module,exports){
var kindOf = require('./kindOf');
    /**
     * Check if value is from a specific "kind".
     */
    function isKind(val, kind){
        return kindOf(val) === kind;
    }
    module.exports = isKind;


},{"./kindOf":88}],86:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isObject(val) {
        return isKind(val, 'Object');
    }
    module.exports = isObject;


},{"./isKind":85}],87:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isString(val) {
        return isKind(val, 'String');
    }
    module.exports = isString;


},{"./isKind":85}],88:[function(require,module,exports){


    var _rKind = /^\[object (.*)\]$/,
        _toString = Object.prototype.toString,
        UNDEF;

    /**
     * Gets the "kind" of value. (e.g. "String", "Number", etc)
     */
    function kindOf(val) {
        if (val === null) {
            return 'Null';
        } else if (val === UNDEF) {
            return 'Undefined';
        } else {
            return _rKind.exec( _toString.call(val) )[1];
        }
    }
    module.exports = kindOf;


},{}],89:[function(require,module,exports){


    /**
     * Typecast a value to a String, using an empty string value for null or
     * undefined.
     */
    function toString(val){
        return val == null ? '' : val.toString();
    }

    module.exports = toString;



},{}],90:[function(require,module,exports){
var hasOwn = require('./hasOwn');

    var _hasDontEnumBug,
        _dontEnums;

    function checkDontEnum(){
        _dontEnums = [
                'toString',
                'toLocaleString',
                'valueOf',
                'hasOwnProperty',
                'isPrototypeOf',
                'propertyIsEnumerable',
                'constructor'
            ];

        _hasDontEnumBug = true;

        for (var key in {'toString': null}) {
            _hasDontEnumBug = false;
        }
    }

    /**
     * Similar to Array/forEach but works over object properties and fixes Don't
     * Enum bug on IE.
     * based on: http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation
     */
    function forIn(obj, fn, thisObj){
        var key, i = 0;
        // no need to check if argument is a real object that way we can use
        // it for arrays, functions, date, etc.

        //post-pone check till needed
        if (_hasDontEnumBug == null) checkDontEnum();

        for (key in obj) {
            if (exec(fn, obj, key, thisObj) === false) {
                break;
            }
        }


        if (_hasDontEnumBug) {
            var ctor = obj.constructor,
                isProto = !!ctor && obj === ctor.prototype;

            while (key = _dontEnums[i++]) {
                // For constructor, if it is a prototype object the constructor
                // is always non-enumerable unless defined otherwise (and
                // enumerated above).  For non-prototype objects, it will have
                // to be defined on this object, since it cannot be defined on
                // any prototype objects.
                //
                // For other [[DontEnum]] properties, check if the value is
                // different than Object prototype value.
                if (
                    (key !== 'constructor' ||
                        (!isProto && hasOwn(obj, key))) &&
                    obj[key] !== Object.prototype[key]
                ) {
                    if (exec(fn, obj, key, thisObj) === false) {
                        break;
                    }
                }
            }
        }
    }

    function exec(fn, obj, key, thisObj){
        return fn.call(thisObj, obj[key], key, obj);
    }

    module.exports = forIn;



},{"./hasOwn":92}],91:[function(require,module,exports){
var hasOwn = require('./hasOwn');
var forIn = require('./forIn');

    /**
     * Similar to Array/forEach but works over object properties and fixes Don't
     * Enum bug on IE.
     * based on: http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation
     */
    function forOwn(obj, fn, thisObj){
        forIn(obj, function(val, key){
            if (hasOwn(obj, key)) {
                return fn.call(thisObj, obj[key], key, obj);
            }
        });
    }

    module.exports = forOwn;



},{"./forIn":90,"./hasOwn":92}],92:[function(require,module,exports){


    /**
     * Safer Object.hasOwnProperty
     */
     function hasOwn(obj, prop){
         return Object.prototype.hasOwnProperty.call(obj, prop);
     }

     module.exports = hasOwn;



},{}],93:[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
    * Combine properties from all the objects into first one.
    * - This method affects target object in place, if you want to create a new Object pass an empty object as first param.
    * @param {object} target    Target Object
    * @param {...object} objects    Objects to be combined (0...n objects).
    * @return {object} Target Object.
    */
    function mixIn(target, objects){
        var i = 0,
            n = arguments.length,
            obj;
        while(++i < n){
            obj = arguments[i];
            if (obj != null) {
                forOwn(obj, copyProp, target);
            }
        }
        return target;
    }

    function copyProp(val, key){
        this[key] = val;
    }

    module.exports = mixIn;


},{"./forOwn":91}],94:[function(require,module,exports){

    /**
     * Contains all Unicode white-spaces. Taken from
     * http://en.wikipedia.org/wiki/Whitespace_character.
     */
    module.exports = [
        ' ', '\n', '\r', '\t', '\f', '\v', '\u00A0', '\u1680', '\u180E',
        '\u2000', '\u2001', '\u2002', '\u2003', '\u2004', '\u2005', '\u2006',
        '\u2007', '\u2008', '\u2009', '\u200A', '\u2028', '\u2029', '\u202F',
        '\u205F', '\u3000'
    ];


},{}],95:[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
    /**
     * Remove chars from beginning of string.
     */
    function ltrim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;

        var start = 0,
            len = str.length,
            charLen = chars.length,
            found = true,
            i, c;

        while (found && start < len) {
            found = false;
            i = -1;
            c = str.charAt(start);

            while (++i < charLen) {
                if (c === chars[i]) {
                    found = true;
                    start++;
                    break;
                }
            }
        }

        return (start >= len) ? '' : str.substr(start, len);
    }

    module.exports = ltrim;


},{"../lang/toString":89,"./WHITE_SPACES":94}],96:[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
    /**
     * Remove chars from end of string.
     */
    function rtrim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;

        var end = str.length - 1,
            charLen = chars.length,
            found = true,
            i, c;

        while (found && end >= 0) {
            found = false;
            i = -1;
            c = str.charAt(end);

            while (++i < charLen) {
                if (c === chars[i]) {
                    found = true;
                    end--;
                    break;
                }
            }
        }

        return (end >= 0) ? str.substring(0, end + 1) : '';
    }

    module.exports = rtrim;


},{"../lang/toString":89,"./WHITE_SPACES":94}],97:[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
var ltrim = require('./ltrim');
var rtrim = require('./rtrim');
    /**
     * Remove white-spaces from beginning and end of string.
     */
    function trim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;
        return ltrim(rtrim(str, chars), chars);
    }

    module.exports = trim;


},{"../lang/toString":89,"./WHITE_SPACES":94,"./ltrim":95,"./rtrim":96}],98:[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * "Safer" String.toUpperCase()
     */
    function upperCase(str){
        str = toString(str);
        return str.toUpperCase();
    }
    module.exports = upperCase;


},{"../lang/toString":89}],99:[function(require,module,exports){


    /**
     * Get current time in miliseconds
     */
    function now(){
        // yes, we defer the work to another function to allow mocking it
        // during the tests
        return now.get();
    }

    now.get = (typeof Date.now === 'function')? Date.now : function(){
        return +(new Date());
    };

    module.exports = now;



},{}],100:[function(require,module,exports){
(function (process,global){
/*
defer
*/"use strict"

var kindOf  = require("mout/lang/kindOf"),
    now     = require("mout/time/now"),
    forEach = require("mout/array/forEach"),
    indexOf = require("mout/array/indexOf")

var callbacks = {
    timeout: {},
    frame: [],
    immediate: []
}

var push = function(collection, callback, context, defer){

    var iterator = function(){
        iterate(collection)
    }

    if (!collection.length) defer(iterator)

    var entry = {
        callback: callback,
        context: context
    }

    collection.push(entry)

    return function(){
        var io = indexOf(collection, entry)
        if (io > -1) collection.splice(io, 1)
    }
}

var iterate = function(collection){
    var time = now()

    forEach(collection.splice(0), function(entry) {
        entry.callback.call(entry.context, time)
    })
}

var defer = function(callback, argument, context){
    return (kindOf(argument) === "Number") ? defer.timeout(callback, argument, context) : defer.immediate(callback, argument)
}

if (global.process && process.nextTick){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, process.nextTick)
    }

} else if (global.setImmediate){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, setImmediate)
    }

} else if (global.postMessage && global.addEventListener){

    addEventListener("message", function(event){
        if (event.source === global && event.data === "@deferred"){
            event.stopPropagation()
            iterate(callbacks.immediate)
        }
    }, true)

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(){
            postMessage("@deferred", "*")
        })
    }

} else {

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(iterator){
            setTimeout(iterator, 0)
        })
    }

}

var requestAnimationFrame = global.requestAnimationFrame ||
    global.webkitRequestAnimationFrame ||
    global.mozRequestAnimationFrame ||
    global.oRequestAnimationFrame ||
    global.msRequestAnimationFrame ||
    function(callback) {
        setTimeout(callback, 1e3 / 60)
    }

defer.frame = function(callback, context){
    return push(callbacks.frame, callback, context, requestAnimationFrame)
}

var clear

defer.timeout = function(callback, ms, context){
    var ct = callbacks.timeout

    if (!clear) clear = defer.immediate(function(){
        clear = null
        callbacks.timeout = {}
    })

    return push(ct[ms] || (ct[ms] = []), callback, context, function(iterator){
        setTimeout(iterator, ms)
    })
}

module.exports = defer

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":1,"mout/array/forEach":79,"mout/array/indexOf":80,"mout/lang/kindOf":88,"mout/time/now":99}],101:[function(require,module,exports){
/*
Emitter
*/"use strict"

var indexOf = require("mout/array/indexOf"),
    forEach = require("mout/array/forEach")

var prime = require("./index"),
    defer = require("./defer")

var slice = Array.prototype.slice;

var Emitter = prime({

    on: function(event, fn){
        var listeners = this._listeners || (this._listeners = {}),
            events = listeners[event] || (listeners[event] = [])

        if (indexOf(events, fn) === -1) events.push(fn)

        return this
    },

    off: function(event, fn){
        var listeners = this._listeners, events, key, length = 0
        if (listeners && (events = listeners[event])){

            var io = indexOf(events, fn)
            if (io > -1) events.splice(io, 1)
            if (!events.length) delete listeners[event];
            for (var l in listeners) return this
            delete this._listeners
        }
        return this
    },

    emit: function(event){
        var self = this,
            args = slice.call(arguments, 1)

        var emit = function(){
            var listeners = self._listeners, events
            if (listeners && (events = listeners[event])){
                forEach(events.slice(0), function(event){
                    return event.apply(self, args)
                })
            }
        }

        if (args[args.length - 1] === Emitter.EMIT_SYNC){
            args.pop()
            emit()
        } else {
            defer(emit)
        }

        return this
    }

})

Emitter.EMIT_SYNC = {}

module.exports = Emitter

},{"./defer":100,"./index":102,"mout/array/forEach":79,"mout/array/indexOf":80}],102:[function(require,module,exports){
/*
prime
 - prototypal inheritance
*/"use strict"

var hasOwn = require("mout/object/hasOwn"),
    mixIn  = require("mout/object/mixIn"),
    create = require("mout/lang/createObject"),
    kindOf = require("mout/lang/kindOf")

var hasDescriptors = true

try {
    Object.defineProperty({}, "~", {})
    Object.getOwnPropertyDescriptor({}, "~")
} catch (e){
    hasDescriptors = false
}

// we only need to be able to implement "toString" and "valueOf" in IE < 9
var hasEnumBug = !({valueOf: 0}).propertyIsEnumerable("valueOf"),
    buggy      = ["toString", "valueOf"]

var verbs = /^constructor|inherits|mixin$/

var implement = function(proto){
    var prototype = this.prototype

    for (var key in proto){
        if (key.match(verbs)) continue
        if (hasDescriptors){
            var descriptor = Object.getOwnPropertyDescriptor(proto, key)
            if (descriptor){
                Object.defineProperty(prototype, key, descriptor)
                continue
            }
        }
        prototype[key] = proto[key]
    }

    if (hasEnumBug) for (var i = 0; (key = buggy[i]); i++){
        var value = proto[key]
        if (value !== Object.prototype[key]) prototype[key] = value
    }

    return this
}

var prime = function(proto){

    if (kindOf(proto) === "Function") proto = {constructor: proto}

    var superprime = proto.inherits

    // if our nice proto object has no own constructor property
    // then we proceed using a ghosting constructor that all it does is
    // call the parent's constructor if it has a superprime, else an empty constructor
    // proto.constructor becomes the effective constructor
    var constructor = (hasOwn(proto, "constructor")) ? proto.constructor : (superprime) ? function(){
        return superprime.apply(this, arguments)
    } : function(){}

    if (superprime){

        mixIn(constructor, superprime)

        var superproto = superprime.prototype
        // inherit from superprime
        var cproto = constructor.prototype = create(superproto)

        // setting constructor.parent to superprime.prototype
        // because it's the shortest possible absolute reference
        constructor.parent = superproto
        cproto.constructor = constructor
    }

    if (!constructor.implement) constructor.implement = implement

    var mixins = proto.mixin
    if (mixins){
        if (kindOf(mixins) !== "Array") mixins = [mixins]
        for (var i = 0; i < mixins.length; i++) constructor.implement(create(mixins[i].prototype))
    }

    // implement proto and return constructor
    return constructor.implement(proto)

}

module.exports = prime

},{"mout/lang/createObject":82,"mout/lang/kindOf":88,"mout/object/hasOwn":92,"mout/object/mixIn":93}],103:[function(require,module,exports){

module.exports = function(x1, y1, x2, y2, epsilon){

	var curveX = function(t){
		var v = 1 - t;
		return 3 * v * v * t * x1 + 3 * v * t * t * x2 + t * t * t;
	};

	var curveY = function(t){
		var v = 1 - t;
		return 3 * v * v * t * y1 + 3 * v * t * t * y2 + t * t * t;
	};

	var derivativeCurveX = function(t){
		var v = 1 - t;
		return 3 * (2 * (t - 1) * t + v * v) * x1 + 3 * (- t * t * t + 2 * v * t) * x2;
	};

	return function(t){

		var x = t, t0, t1, t2, x2, d2, i;

		// First try a few iterations of Newton's method -- normally very fast.
		for (t2 = x, i = 0; i < 8; i++){
			x2 = curveX(t2) - x;
			if (Math.abs(x2) < epsilon) return curveY(t2);
			d2 = derivativeCurveX(t2);
			if (Math.abs(d2) < 1e-6) break;
			t2 = t2 - x2 / d2;
		}

		t0 = 0, t1 = 1, t2 = x;

		if (t2 < t0) return curveY(t0);
		if (t2 > t1) return curveY(t1);

		// Fallback to the bisection method for reliability.
		while (t0 < t1){
			x2 = curveX(t2);
			if (Math.abs(x2 - x) < epsilon) return curveY(t2);
			if (x > x2) t0 = t2;
			else t1 = t2;
			t2 = (t1 - t0) * .5 + t0;
		}

		// Failure
		return curveY(t2);

	};

};

},{}],104:[function(require,module,exports){
(function (global){
/*!
 * deep-diff.
 * Licensed under the MIT License.
 */
;(function(root, factory) {
  'use strict';
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define([], function() {
      return factory();
    });
  } else if (typeof exports === 'object') {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.DeepDiff = factory();
  }
}(this, function(undefined) {
  'use strict';

  var $scope, conflict, conflictResolution = [];
  if (typeof global === 'object' && global) {
    $scope = global;
  } else if (typeof window !== 'undefined') {
    $scope = window;
  } else {
    $scope = {};
  }
  conflict = $scope.DeepDiff;
  if (conflict) {
    conflictResolution.push(
      function() {
        if ('undefined' !== typeof conflict && $scope.DeepDiff === accumulateDiff) {
          $scope.DeepDiff = conflict;
          conflict = undefined;
        }
      });
  }

  // nodejs compatible on server side and in the browser.
  function inherits(ctor, superCtor) {
    ctor.super_ = superCtor;
    ctor.prototype = Object.create(superCtor.prototype, {
      constructor: {
        value: ctor,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
  }

  function Diff(kind, path) {
    Object.defineProperty(this, 'kind', {
      value: kind,
      enumerable: true
    });
    if (path && path.length) {
      Object.defineProperty(this, 'path', {
        value: path,
        enumerable: true
      });
    }
  }

  function DiffEdit(path, origin, value) {
    DiffEdit.super_.call(this, 'E', path);
    Object.defineProperty(this, 'lhs', {
      value: origin,
      enumerable: true
    });
    Object.defineProperty(this, 'rhs', {
      value: value,
      enumerable: true
    });
  }
  inherits(DiffEdit, Diff);

  function DiffNew(path, value) {
    DiffNew.super_.call(this, 'N', path);
    Object.defineProperty(this, 'rhs', {
      value: value,
      enumerable: true
    });
  }
  inherits(DiffNew, Diff);

  function DiffDeleted(path, value) {
    DiffDeleted.super_.call(this, 'D', path);
    Object.defineProperty(this, 'lhs', {
      value: value,
      enumerable: true
    });
  }
  inherits(DiffDeleted, Diff);

  function DiffArray(path, index, item) {
    DiffArray.super_.call(this, 'A', path);
    Object.defineProperty(this, 'index', {
      value: index,
      enumerable: true
    });
    Object.defineProperty(this, 'item', {
      value: item,
      enumerable: true
    });
  }
  inherits(DiffArray, Diff);

  function arrayRemove(arr, from, to) {
    var rest = arr.slice((to || from) + 1 || arr.length);
    arr.length = from < 0 ? arr.length + from : from;
    arr.push.apply(arr, rest);
    return arr;
  }

  function realTypeOf(subject) {
    var type = typeof subject;
    if (type !== 'object') {
      return type;
    }

    if (subject === Math) {
      return 'math';
    } else if (subject === null) {
      return 'null';
    } else if (Array.isArray(subject)) {
      return 'array';
    } else if (Object.prototype.toString.call(subject) === '[object Date]') {
      return 'date';
    } else if (typeof subject.toString !== 'undefined' && /^\/.*\//.test(subject.toString())) {
      return 'regexp';
    }
    return 'object';
  }

  function deepDiff(lhs, rhs, changes, prefilter, path, key, stack) {
    path = path || [];
    var currentPath = path.slice(0);
    if (typeof key !== 'undefined') {
      if (prefilter) {
        if (typeof(prefilter) === 'function' && prefilter(currentPath, key)) { return; }
        else if (typeof(prefilter) === 'object') {
          if (prefilter.prefilter && prefilter.prefilter(currentPath, key)) { return; }
          if (prefilter.normalize) {
            var alt = prefilter.normalize(currentPath, key, lhs, rhs);
            if (alt) {
              lhs = alt[0];
              rhs = alt[1];
            }
          }
        }
      }
      currentPath.push(key);
    }

    // Use string comparison for regexes
    if (realTypeOf(lhs) === 'regexp' && realTypeOf(rhs) === 'regexp') {
      lhs = lhs.toString();
      rhs = rhs.toString();
    }

    var ltype = typeof lhs;
    var rtype = typeof rhs;
    if (ltype === 'undefined') {
      if (rtype !== 'undefined') {
        changes(new DiffNew(currentPath, rhs));
      }
    } else if (rtype === 'undefined') {
      changes(new DiffDeleted(currentPath, lhs));
    } else if (realTypeOf(lhs) !== realTypeOf(rhs)) {
      changes(new DiffEdit(currentPath, lhs, rhs));
    } else if (Object.prototype.toString.call(lhs) === '[object Date]' && Object.prototype.toString.call(rhs) === '[object Date]' && ((lhs - rhs) !== 0)) {
      changes(new DiffEdit(currentPath, lhs, rhs));
    } else if (ltype === 'object' && lhs !== null && rhs !== null) {
      stack = stack || [];
      if (stack.indexOf(lhs) < 0) {
        stack.push(lhs);
        if (Array.isArray(lhs)) {
          var i, len = lhs.length;
          for (i = 0; i < lhs.length; i++) {
            if (i >= rhs.length) {
              changes(new DiffArray(currentPath, i, new DiffDeleted(undefined, lhs[i])));
            } else {
              deepDiff(lhs[i], rhs[i], changes, prefilter, currentPath, i, stack);
            }
          }
          while (i < rhs.length) {
            changes(new DiffArray(currentPath, i, new DiffNew(undefined, rhs[i++])));
          }
        } else {
          var akeys = Object.keys(lhs);
          var pkeys = Object.keys(rhs);
          akeys.forEach(function(k, i) {
            var other = pkeys.indexOf(k);
            if (other >= 0) {
              deepDiff(lhs[k], rhs[k], changes, prefilter, currentPath, k, stack);
              pkeys = arrayRemove(pkeys, other);
            } else {
              deepDiff(lhs[k], undefined, changes, prefilter, currentPath, k, stack);
            }
          });
          pkeys.forEach(function(k) {
            deepDiff(undefined, rhs[k], changes, prefilter, currentPath, k, stack);
          });
        }
        stack.length = stack.length - 1;
      }
    } else if (lhs !== rhs) {
      if (!(ltype === 'number' && isNaN(lhs) && isNaN(rhs))) {
        changes(new DiffEdit(currentPath, lhs, rhs));
      }
    }
  }

  function accumulateDiff(lhs, rhs, prefilter, accum) {
    accum = accum || [];
    deepDiff(lhs, rhs,
      function(diff) {
        if (diff) {
          accum.push(diff);
        }
      },
      prefilter);
    return (accum.length) ? accum : undefined;
  }

  function applyArrayChange(arr, index, change) {
    if (change.path && change.path.length) {
      var it = arr[index],
          i, u = change.path.length - 1;
      for (i = 0; i < u; i++) {
        it = it[change.path[i]];
      }
      switch (change.kind) {
        case 'A':
          applyArrayChange(it[change.path[i]], change.index, change.item);
          break;
        case 'D':
          delete it[change.path[i]];
          break;
        case 'E':
        case 'N':
          it[change.path[i]] = change.rhs;
          break;
      }
    } else {
      switch (change.kind) {
        case 'A':
          applyArrayChange(arr[index], change.index, change.item);
          break;
        case 'D':
          arr = arrayRemove(arr, index);
          break;
        case 'E':
        case 'N':
          arr[index] = change.rhs;
          break;
      }
    }
    return arr;
  }

  function applyChange(target, source, change) {
    if (target && source && change && change.kind) {
      var it = target,
          i = -1,
          last = change.path ? change.path.length - 1 : 0;
      while (++i < last) {
        if (typeof it[change.path[i]] === 'undefined') {
          it[change.path[i]] = (typeof change.path[i] === 'number') ? [] : {};
        }
        it = it[change.path[i]];
      }
      switch (change.kind) {
        case 'A':
          applyArrayChange(change.path ? it[change.path[i]] : it, change.index, change.item);
          break;
        case 'D':
          delete it[change.path[i]];
          break;
        case 'E':
        case 'N':
          it[change.path[i]] = change.rhs;
          break;
      }
    }
  }

  function revertArrayChange(arr, index, change) {
    if (change.path && change.path.length) {
      // the structure of the object at the index has changed...
      var it = arr[index],
          i, u = change.path.length - 1;
      for (i = 0; i < u; i++) {
        it = it[change.path[i]];
      }
      switch (change.kind) {
        case 'A':
          revertArrayChange(it[change.path[i]], change.index, change.item);
          break;
        case 'D':
          it[change.path[i]] = change.lhs;
          break;
        case 'E':
          it[change.path[i]] = change.lhs;
          break;
        case 'N':
          delete it[change.path[i]];
          break;
      }
    } else {
      // the array item is different...
      switch (change.kind) {
        case 'A':
          revertArrayChange(arr[index], change.index, change.item);
          break;
        case 'D':
          arr[index] = change.lhs;
          break;
        case 'E':
          arr[index] = change.lhs;
          break;
        case 'N':
          arr = arrayRemove(arr, index);
          break;
      }
    }
    return arr;
  }

  function revertChange(target, source, change) {
    if (target && source && change && change.kind) {
      var it = target,
          i, u;
      u = change.path.length - 1;
      for (i = 0; i < u; i++) {
        if (typeof it[change.path[i]] === 'undefined') {
          it[change.path[i]] = {};
        }
        it = it[change.path[i]];
      }
      switch (change.kind) {
        case 'A':
          // Array was modified...
          // it will be an array...
          revertArrayChange(it[change.path[i]], change.index, change.item);
          break;
        case 'D':
          // Item was deleted...
          it[change.path[i]] = change.lhs;
          break;
        case 'E':
          // Item was edited...
          it[change.path[i]] = change.lhs;
          break;
        case 'N':
          // Item is new...
          delete it[change.path[i]];
          break;
      }
    }
  }

  function applyDiff(target, source, filter) {
    if (target && source) {
      var onChange = function(change) {
        if (!filter || filter(target, source, change)) {
          applyChange(target, source, change);
        }
      };
      deepDiff(target, source, onChange);
    }
  }

  Object.defineProperties(accumulateDiff, {

    diff: {
      value: accumulateDiff,
      enumerable: true
    },
    observableDiff: {
      value: deepDiff,
      enumerable: true
    },
    applyDiff: {
      value: applyDiff,
      enumerable: true
    },
    applyChange: {
      value: applyChange,
      enumerable: true
    },
    revertChange: {
      value: revertChange,
      enumerable: true
    },
    isConflict: {
      value: function() {
        return 'undefined' !== typeof conflict;
      },
      enumerable: true
    },
    noConflict: {
      value: function() {
        if (conflictResolution) {
          conflictResolution.forEach(function(it) {
            it();
          });
          conflictResolution = null;
        }
        return accumulateDiff;
      },
      enumerable: true
    }
  });

  return accumulateDiff;
}));

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],105:[function(require,module,exports){

/*
 *
 * More info at [www.dropzonejs.com](http://www.dropzonejs.com)
 *
 * Copyright (c) 2012, Matias Meno
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 */

(function() {
  var Dropzone, Emitter, camelize, contentLoaded, detectVerticalSquash, drawImageIOSFix, noop, without,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  noop = function() {};

  Emitter = (function() {
    function Emitter() {}

    Emitter.prototype.addEventListener = Emitter.prototype.on;

    Emitter.prototype.on = function(event, fn) {
      this._callbacks = this._callbacks || {};
      if (!this._callbacks[event]) {
        this._callbacks[event] = [];
      }
      this._callbacks[event].push(fn);
      return this;
    };

    Emitter.prototype.emit = function() {
      var args, callback, callbacks, event, _i, _len;
      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      this._callbacks = this._callbacks || {};
      callbacks = this._callbacks[event];
      if (callbacks) {
        for (_i = 0, _len = callbacks.length; _i < _len; _i++) {
          callback = callbacks[_i];
          callback.apply(this, args);
        }
      }
      return this;
    };

    Emitter.prototype.removeListener = Emitter.prototype.off;

    Emitter.prototype.removeAllListeners = Emitter.prototype.off;

    Emitter.prototype.removeEventListener = Emitter.prototype.off;

    Emitter.prototype.off = function(event, fn) {
      var callback, callbacks, i, _i, _len;
      if (!this._callbacks || arguments.length === 0) {
        this._callbacks = {};
        return this;
      }
      callbacks = this._callbacks[event];
      if (!callbacks) {
        return this;
      }
      if (arguments.length === 1) {
        delete this._callbacks[event];
        return this;
      }
      for (i = _i = 0, _len = callbacks.length; _i < _len; i = ++_i) {
        callback = callbacks[i];
        if (callback === fn) {
          callbacks.splice(i, 1);
          break;
        }
      }
      return this;
    };

    return Emitter;

  })();

  Dropzone = (function(_super) {
    var extend, resolveOption;

    __extends(Dropzone, _super);

    Dropzone.prototype.Emitter = Emitter;


    /*
    This is a list of all available events you can register on a dropzone object.
    
    You can register an event handler like this:
    
        dropzone.on("dragEnter", function() { });
     */

    Dropzone.prototype.events = ["drop", "dragstart", "dragend", "dragenter", "dragover", "dragleave", "addedfile", "addedfiles", "removedfile", "thumbnail", "error", "errormultiple", "processing", "processingmultiple", "uploadprogress", "totaluploadprogress", "sending", "sendingmultiple", "success", "successmultiple", "canceled", "canceledmultiple", "complete", "completemultiple", "reset", "maxfilesexceeded", "maxfilesreached", "queuecomplete"];

    Dropzone.prototype.defaultOptions = {
      url: null,
      method: "post",
      withCredentials: false,
      parallelUploads: 2,
      uploadMultiple: false,
      maxFilesize: 256,
      paramName: "file",
      createImageThumbnails: true,
      maxThumbnailFilesize: 10,
      thumbnailWidth: 120,
      thumbnailHeight: 120,
      filesizeBase: 1000,
      maxFiles: null,
      params: {},
      clickable: true,
      ignoreHiddenFiles: true,
      acceptedFiles: null,
      acceptedMimeTypes: null,
      autoProcessQueue: true,
      autoQueue: true,
      addRemoveLinks: false,
      previewsContainer: null,
      hiddenInputContainer: "body",
      capture: null,
      renameFilename: null,
      dictDefaultMessage: "Drop files here to upload",
      dictFallbackMessage: "Your browser does not support drag'n'drop file uploads.",
      dictFallbackText: "Please use the fallback form below to upload your files like in the olden days.",
      dictFileTooBig: "File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",
      dictInvalidFileType: "You can't upload files of this type.",
      dictResponseError: "Server responded with {{statusCode}} code.",
      dictCancelUpload: "Cancel upload",
      dictCancelUploadConfirmation: "Are you sure you want to cancel this upload?",
      dictRemoveFile: "Remove file",
      dictRemoveFileConfirmation: null,
      dictMaxFilesExceeded: "You can not upload any more files.",
      accept: function(file, done) {
        return done();
      },
      init: function() {
        return noop;
      },
      forceFallback: false,
      fallback: function() {
        var child, messageElement, span, _i, _len, _ref;
        this.element.className = "" + this.element.className + " dz-browser-not-supported";
        _ref = this.element.getElementsByTagName("div");
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          child = _ref[_i];
          if (/(^| )dz-message($| )/.test(child.className)) {
            messageElement = child;
            child.className = "dz-message";
            continue;
          }
        }
        if (!messageElement) {
          messageElement = Dropzone.createElement("<div class=\"dz-message\"><span></span></div>");
          this.element.appendChild(messageElement);
        }
        span = messageElement.getElementsByTagName("span")[0];
        if (span) {
          if (span.textContent != null) {
            span.textContent = this.options.dictFallbackMessage;
          } else if (span.innerText != null) {
            span.innerText = this.options.dictFallbackMessage;
          }
        }
        return this.element.appendChild(this.getFallbackForm());
      },
      resize: function(file) {
        var info, srcRatio, trgRatio;
        info = {
          srcX: 0,
          srcY: 0,
          srcWidth: file.width,
          srcHeight: file.height
        };
        srcRatio = file.width / file.height;
        info.optWidth = this.options.thumbnailWidth;
        info.optHeight = this.options.thumbnailHeight;
        if ((info.optWidth == null) && (info.optHeight == null)) {
          info.optWidth = info.srcWidth;
          info.optHeight = info.srcHeight;
        } else if (info.optWidth == null) {
          info.optWidth = srcRatio * info.optHeight;
        } else if (info.optHeight == null) {
          info.optHeight = (1 / srcRatio) * info.optWidth;
        }
        trgRatio = info.optWidth / info.optHeight;
        if (file.height < info.optHeight || file.width < info.optWidth) {
          info.trgHeight = info.srcHeight;
          info.trgWidth = info.srcWidth;
        } else {
          if (srcRatio > trgRatio) {
            info.srcHeight = file.height;
            info.srcWidth = info.srcHeight * trgRatio;
          } else {
            info.srcWidth = file.width;
            info.srcHeight = info.srcWidth / trgRatio;
          }
        }
        info.srcX = (file.width - info.srcWidth) / 2;
        info.srcY = (file.height - info.srcHeight) / 2;
        return info;
      },

      /*
      Those functions register themselves to the events on init and handle all
      the user interface specific stuff. Overwriting them won't break the upload
      but can break the way it's displayed.
      You can overwrite them if you don't like the default behavior. If you just
      want to add an additional event handler, register it on the dropzone object
      and don't overwrite those options.
       */
      drop: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      dragstart: noop,
      dragend: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      dragenter: function(e) {
        return this.element.classList.add("dz-drag-hover");
      },
      dragover: function(e) {
        return this.element.classList.add("dz-drag-hover");
      },
      dragleave: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      paste: noop,
      reset: function() {
        return this.element.classList.remove("dz-started");
      },
      addedfile: function(file) {
        var node, removeFileEvent, removeLink, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _results;
        if (this.element === this.previewsContainer) {
          this.element.classList.add("dz-started");
        }
        if (this.previewsContainer) {
          file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());
          file.previewTemplate = file.previewElement;
          this.previewsContainer.appendChild(file.previewElement);
          _ref = file.previewElement.querySelectorAll("[data-dz-name]");
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            node.textContent = this._renameFilename(file.name);
          }
          _ref1 = file.previewElement.querySelectorAll("[data-dz-size]");
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            node = _ref1[_j];
            node.innerHTML = this.filesize(file.size);
          }
          if (this.options.addRemoveLinks) {
            file._removeLink = Dropzone.createElement("<a class=\"dz-remove\" href=\"javascript:undefined;\" data-dz-remove>" + this.options.dictRemoveFile + "</a>");
            file.previewElement.appendChild(file._removeLink);
          }
          removeFileEvent = (function(_this) {
            return function(e) {
              e.preventDefault();
              e.stopPropagation();
              if (file.status === Dropzone.UPLOADING) {
                return Dropzone.confirm(_this.options.dictCancelUploadConfirmation, function() {
                  return _this.removeFile(file);
                });
              } else {
                if (_this.options.dictRemoveFileConfirmation) {
                  return Dropzone.confirm(_this.options.dictRemoveFileConfirmation, function() {
                    return _this.removeFile(file);
                  });
                } else {
                  return _this.removeFile(file);
                }
              }
            };
          })(this);
          _ref2 = file.previewElement.querySelectorAll("[data-dz-remove]");
          _results = [];
          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
            removeLink = _ref2[_k];
            _results.push(removeLink.addEventListener("click", removeFileEvent));
          }
          return _results;
        }
      },
      removedfile: function(file) {
        var _ref;
        if (file.previewElement) {
          if ((_ref = file.previewElement) != null) {
            _ref.parentNode.removeChild(file.previewElement);
          }
        }
        return this._updateMaxFilesReachedClass();
      },
      thumbnail: function(file, dataUrl) {
        var thumbnailElement, _i, _len, _ref;
        if (file.previewElement) {
          file.previewElement.classList.remove("dz-file-preview");
          _ref = file.previewElement.querySelectorAll("[data-dz-thumbnail]");
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            thumbnailElement = _ref[_i];
            thumbnailElement.alt = file.name;
            thumbnailElement.src = dataUrl;
          }
          return setTimeout(((function(_this) {
            return function() {
              return file.previewElement.classList.add("dz-image-preview");
            };
          })(this)), 1);
        }
      },
      error: function(file, message) {
        var node, _i, _len, _ref, _results;
        if (file.previewElement) {
          file.previewElement.classList.add("dz-error");
          if (typeof message !== "String" && message.error) {
            message = message.error;
          }
          _ref = file.previewElement.querySelectorAll("[data-dz-errormessage]");
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            _results.push(node.textContent = message);
          }
          return _results;
        }
      },
      errormultiple: noop,
      processing: function(file) {
        if (file.previewElement) {
          file.previewElement.classList.add("dz-processing");
          if (file._removeLink) {
            return file._removeLink.textContent = this.options.dictCancelUpload;
          }
        }
      },
      processingmultiple: noop,
      uploadprogress: function(file, progress, bytesSent) {
        var node, _i, _len, _ref, _results;
        if (file.previewElement) {
          _ref = file.previewElement.querySelectorAll("[data-dz-uploadprogress]");
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            if (node.nodeName === 'PROGRESS') {
              _results.push(node.value = progress);
            } else {
              _results.push(node.style.width = "" + progress + "%");
            }
          }
          return _results;
        }
      },
      totaluploadprogress: noop,
      sending: noop,
      sendingmultiple: noop,
      success: function(file) {
        if (file.previewElement) {
          return file.previewElement.classList.add("dz-success");
        }
      },
      successmultiple: noop,
      canceled: function(file) {
        return this.emit("error", file, "Upload canceled.");
      },
      canceledmultiple: noop,
      complete: function(file) {
        if (file._removeLink) {
          file._removeLink.textContent = this.options.dictRemoveFile;
        }
        if (file.previewElement) {
          return file.previewElement.classList.add("dz-complete");
        }
      },
      completemultiple: noop,
      maxfilesexceeded: noop,
      maxfilesreached: noop,
      queuecomplete: noop,
      addedfiles: noop,
      previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n  <div class=\"dz-details\">\n    <div class=\"dz-size\"><span data-dz-size></span></div>\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n  </div>\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n  <div class=\"dz-success-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Check</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\" sketch:type=\"MSShapeGroup\"></path>\n      </g>\n    </svg>\n  </div>\n  <div class=\"dz-error-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Error</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <g id=\"Check-+-Oval-2\" sketch:type=\"MSLayerGroup\" stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" sketch:type=\"MSShapeGroup\"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>"
    };

    extend = function() {
      var key, object, objects, target, val, _i, _len;
      target = arguments[0], objects = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      for (_i = 0, _len = objects.length; _i < _len; _i++) {
        object = objects[_i];
        for (key in object) {
          val = object[key];
          target[key] = val;
        }
      }
      return target;
    };

    function Dropzone(element, options) {
      var elementOptions, fallback, _ref;
      this.element = element;
      this.version = Dropzone.version;
      this.defaultOptions.previewTemplate = this.defaultOptions.previewTemplate.replace(/\n*/g, "");
      this.clickableElements = [];
      this.listeners = [];
      this.files = [];
      if (typeof this.element === "string") {
        this.element = document.querySelector(this.element);
      }
      if (!(this.element && (this.element.nodeType != null))) {
        throw new Error("Invalid dropzone element.");
      }
      if (this.element.dropzone) {
        throw new Error("Dropzone already attached.");
      }
      Dropzone.instances.push(this);
      this.element.dropzone = this;
      elementOptions = (_ref = Dropzone.optionsForElement(this.element)) != null ? _ref : {};
      this.options = extend({}, this.defaultOptions, elementOptions, options != null ? options : {});
      if (this.options.forceFallback || !Dropzone.isBrowserSupported()) {
        return this.options.fallback.call(this);
      }
      if (this.options.url == null) {
        this.options.url = this.element.getAttribute("action");
      }
      if (!this.options.url) {
        throw new Error("No URL provided.");
      }
      if (this.options.acceptedFiles && this.options.acceptedMimeTypes) {
        throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");
      }
      if (this.options.acceptedMimeTypes) {
        this.options.acceptedFiles = this.options.acceptedMimeTypes;
        delete this.options.acceptedMimeTypes;
      }
      this.options.method = this.options.method.toUpperCase();
      if ((fallback = this.getExistingFallback()) && fallback.parentNode) {
        fallback.parentNode.removeChild(fallback);
      }
      if (this.options.previewsContainer !== false) {
        if (this.options.previewsContainer) {
          this.previewsContainer = Dropzone.getElement(this.options.previewsContainer, "previewsContainer");
        } else {
          this.previewsContainer = this.element;
        }
      }
      if (this.options.clickable) {
        if (this.options.clickable === true) {
          this.clickableElements = [this.element];
        } else {
          this.clickableElements = Dropzone.getElements(this.options.clickable, "clickable");
        }
      }
      this.init();
    }

    Dropzone.prototype.getAcceptedFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.accepted) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getRejectedFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (!file.accepted) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getFilesWithStatus = function(status) {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status === status) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getQueuedFiles = function() {
      return this.getFilesWithStatus(Dropzone.QUEUED);
    };

    Dropzone.prototype.getUploadingFiles = function() {
      return this.getFilesWithStatus(Dropzone.UPLOADING);
    };

    Dropzone.prototype.getAddedFiles = function() {
      return this.getFilesWithStatus(Dropzone.ADDED);
    };

    Dropzone.prototype.getActiveFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.init = function() {
      var eventName, noPropagation, setupHiddenFileInput, _i, _len, _ref, _ref1;
      if (this.element.tagName === "form") {
        this.element.setAttribute("enctype", "multipart/form-data");
      }
      if (this.element.classList.contains("dropzone") && !this.element.querySelector(".dz-message")) {
        this.element.appendChild(Dropzone.createElement("<div class=\"dz-default dz-message\"><span>" + this.options.dictDefaultMessage + "</span></div>"));
      }
      if (this.clickableElements.length) {
        setupHiddenFileInput = (function(_this) {
          return function() {
            if (_this.hiddenFileInput) {
              _this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput);
            }
            _this.hiddenFileInput = document.createElement("input");
            _this.hiddenFileInput.setAttribute("type", "file");
            if ((_this.options.maxFiles == null) || _this.options.maxFiles > 1) {
              _this.hiddenFileInput.setAttribute("multiple", "multiple");
            }
            _this.hiddenFileInput.className = "dz-hidden-input";
            if (_this.options.acceptedFiles != null) {
              _this.hiddenFileInput.setAttribute("accept", _this.options.acceptedFiles);
            }
            if (_this.options.capture != null) {
              _this.hiddenFileInput.setAttribute("capture", _this.options.capture);
            }
            _this.hiddenFileInput.style.visibility = "hidden";
            _this.hiddenFileInput.style.position = "absolute";
            _this.hiddenFileInput.style.top = "0";
            _this.hiddenFileInput.style.left = "0";
            _this.hiddenFileInput.style.height = "0";
            _this.hiddenFileInput.style.width = "0";
            document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput);
            return _this.hiddenFileInput.addEventListener("change", function() {
              var file, files, _i, _len;
              files = _this.hiddenFileInput.files;
              if (files.length) {
                for (_i = 0, _len = files.length; _i < _len; _i++) {
                  file = files[_i];
                  _this.addFile(file);
                }
              }
              _this.emit("addedfiles", files);
              return setupHiddenFileInput();
            });
          };
        })(this);
        setupHiddenFileInput();
      }
      this.URL = (_ref = window.URL) != null ? _ref : window.webkitURL;
      _ref1 = this.events;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        eventName = _ref1[_i];
        this.on(eventName, this.options[eventName]);
      }
      this.on("uploadprogress", (function(_this) {
        return function() {
          return _this.updateTotalUploadProgress();
        };
      })(this));
      this.on("removedfile", (function(_this) {
        return function() {
          return _this.updateTotalUploadProgress();
        };
      })(this));
      this.on("canceled", (function(_this) {
        return function(file) {
          return _this.emit("complete", file);
        };
      })(this));
      this.on("complete", (function(_this) {
        return function(file) {
          if (_this.getAddedFiles().length === 0 && _this.getUploadingFiles().length === 0 && _this.getQueuedFiles().length === 0) {
            return setTimeout((function() {
              return _this.emit("queuecomplete");
            }), 0);
          }
        };
      })(this));
      noPropagation = function(e) {
        e.stopPropagation();
        if (e.preventDefault) {
          return e.preventDefault();
        } else {
          return e.returnValue = false;
        }
      };
      this.listeners = [
        {
          element: this.element,
          events: {
            "dragstart": (function(_this) {
              return function(e) {
                return _this.emit("dragstart", e);
              };
            })(this),
            "dragenter": (function(_this) {
              return function(e) {
                noPropagation(e);
                return _this.emit("dragenter", e);
              };
            })(this),
            "dragover": (function(_this) {
              return function(e) {
                var efct;
                try {
                  efct = e.dataTransfer.effectAllowed;
                } catch (_error) {}
                e.dataTransfer.dropEffect = 'move' === efct || 'linkMove' === efct ? 'move' : 'copy';
                noPropagation(e);
                return _this.emit("dragover", e);
              };
            })(this),
            "dragleave": (function(_this) {
              return function(e) {
                return _this.emit("dragleave", e);
              };
            })(this),
            "drop": (function(_this) {
              return function(e) {
                noPropagation(e);
                return _this.drop(e);
              };
            })(this),
            "dragend": (function(_this) {
              return function(e) {
                return _this.emit("dragend", e);
              };
            })(this)
          }
        }
      ];
      this.clickableElements.forEach((function(_this) {
        return function(clickableElement) {
          return _this.listeners.push({
            element: clickableElement,
            events: {
              "click": function(evt) {
                if ((clickableElement !== _this.element) || (evt.target === _this.element || Dropzone.elementInside(evt.target, _this.element.querySelector(".dz-message")))) {
                  _this.hiddenFileInput.click();
                }
                return true;
              }
            }
          });
        };
      })(this));
      this.enable();
      return this.options.init.call(this);
    };

    Dropzone.prototype.destroy = function() {
      var _ref;
      this.disable();
      this.removeAllFiles(true);
      if ((_ref = this.hiddenFileInput) != null ? _ref.parentNode : void 0) {
        this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);
        this.hiddenFileInput = null;
      }
      delete this.element.dropzone;
      return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1);
    };

    Dropzone.prototype.updateTotalUploadProgress = function() {
      var activeFiles, file, totalBytes, totalBytesSent, totalUploadProgress, _i, _len, _ref;
      totalBytesSent = 0;
      totalBytes = 0;
      activeFiles = this.getActiveFiles();
      if (activeFiles.length) {
        _ref = this.getActiveFiles();
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          file = _ref[_i];
          totalBytesSent += file.upload.bytesSent;
          totalBytes += file.upload.total;
        }
        totalUploadProgress = 100 * totalBytesSent / totalBytes;
      } else {
        totalUploadProgress = 100;
      }
      return this.emit("totaluploadprogress", totalUploadProgress, totalBytes, totalBytesSent);
    };

    Dropzone.prototype._getParamName = function(n) {
      if (typeof this.options.paramName === "function") {
        return this.options.paramName(n);
      } else {
        return "" + this.options.paramName + (this.options.uploadMultiple ? "[" + n + "]" : "");
      }
    };

    Dropzone.prototype._renameFilename = function(name) {
      if (typeof this.options.renameFilename !== "function") {
        return name;
      }
      return this.options.renameFilename(name);
    };

    Dropzone.prototype.getFallbackForm = function() {
      var existingFallback, fields, fieldsString, form;
      if (existingFallback = this.getExistingFallback()) {
        return existingFallback;
      }
      fieldsString = "<div class=\"dz-fallback\">";
      if (this.options.dictFallbackText) {
        fieldsString += "<p>" + this.options.dictFallbackText + "</p>";
      }
      fieldsString += "<input type=\"file\" name=\"" + (this._getParamName(0)) + "\" " + (this.options.uploadMultiple ? 'multiple="multiple"' : void 0) + " /><input type=\"submit\" value=\"Upload!\"></div>";
      fields = Dropzone.createElement(fieldsString);
      if (this.element.tagName !== "FORM") {
        form = Dropzone.createElement("<form action=\"" + this.options.url + "\" enctype=\"multipart/form-data\" method=\"" + this.options.method + "\"></form>");
        form.appendChild(fields);
      } else {
        this.element.setAttribute("enctype", "multipart/form-data");
        this.element.setAttribute("method", this.options.method);
      }
      return form != null ? form : fields;
    };

    Dropzone.prototype.getExistingFallback = function() {
      var fallback, getFallback, tagName, _i, _len, _ref;
      getFallback = function(elements) {
        var el, _i, _len;
        for (_i = 0, _len = elements.length; _i < _len; _i++) {
          el = elements[_i];
          if (/(^| )fallback($| )/.test(el.className)) {
            return el;
          }
        }
      };
      _ref = ["div", "form"];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tagName = _ref[_i];
        if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {
          return fallback;
        }
      }
    };

    Dropzone.prototype.setupEventListeners = function() {
      var elementListeners, event, listener, _i, _len, _ref, _results;
      _ref = this.listeners;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        elementListeners = _ref[_i];
        _results.push((function() {
          var _ref1, _results1;
          _ref1 = elementListeners.events;
          _results1 = [];
          for (event in _ref1) {
            listener = _ref1[event];
            _results1.push(elementListeners.element.addEventListener(event, listener, false));
          }
          return _results1;
        })());
      }
      return _results;
    };

    Dropzone.prototype.removeEventListeners = function() {
      var elementListeners, event, listener, _i, _len, _ref, _results;
      _ref = this.listeners;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        elementListeners = _ref[_i];
        _results.push((function() {
          var _ref1, _results1;
          _ref1 = elementListeners.events;
          _results1 = [];
          for (event in _ref1) {
            listener = _ref1[event];
            _results1.push(elementListeners.element.removeEventListener(event, listener, false));
          }
          return _results1;
        })());
      }
      return _results;
    };

    Dropzone.prototype.disable = function() {
      var file, _i, _len, _ref, _results;
      this.clickableElements.forEach(function(element) {
        return element.classList.remove("dz-clickable");
      });
      this.removeEventListeners();
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        _results.push(this.cancelUpload(file));
      }
      return _results;
    };

    Dropzone.prototype.enable = function() {
      this.clickableElements.forEach(function(element) {
        return element.classList.add("dz-clickable");
      });
      return this.setupEventListeners();
    };

    Dropzone.prototype.filesize = function(size) {
      var cutoff, i, selectedSize, selectedUnit, unit, units, _i, _len;
      selectedSize = 0;
      selectedUnit = "b";
      if (size > 0) {
        units = ['TB', 'GB', 'MB', 'KB', 'b'];
        for (i = _i = 0, _len = units.length; _i < _len; i = ++_i) {
          unit = units[i];
          cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;
          if (size >= cutoff) {
            selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);
            selectedUnit = unit;
            break;
          }
        }
        selectedSize = Math.round(10 * selectedSize) / 10;
      }
      return "<strong>" + selectedSize + "</strong> " + selectedUnit;
    };

    Dropzone.prototype._updateMaxFilesReachedClass = function() {
      if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {
        if (this.getAcceptedFiles().length === this.options.maxFiles) {
          this.emit('maxfilesreached', this.files);
        }
        return this.element.classList.add("dz-max-files-reached");
      } else {
        return this.element.classList.remove("dz-max-files-reached");
      }
    };

    Dropzone.prototype.drop = function(e) {
      var files, items;
      if (!e.dataTransfer) {
        return;
      }
      this.emit("drop", e);
      files = e.dataTransfer.files;
      this.emit("addedfiles", files);
      if (files.length) {
        items = e.dataTransfer.items;
        if (items && items.length && (items[0].webkitGetAsEntry != null)) {
          this._addFilesFromItems(items);
        } else {
          this.handleFiles(files);
        }
      }
    };

    Dropzone.prototype.paste = function(e) {
      var items, _ref;
      if ((e != null ? (_ref = e.clipboardData) != null ? _ref.items : void 0 : void 0) == null) {
        return;
      }
      this.emit("paste", e);
      items = e.clipboardData.items;
      if (items.length) {
        return this._addFilesFromItems(items);
      }
    };

    Dropzone.prototype.handleFiles = function(files) {
      var file, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        _results.push(this.addFile(file));
      }
      return _results;
    };

    Dropzone.prototype._addFilesFromItems = function(items) {
      var entry, item, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = items.length; _i < _len; _i++) {
        item = items[_i];
        if ((item.webkitGetAsEntry != null) && (entry = item.webkitGetAsEntry())) {
          if (entry.isFile) {
            _results.push(this.addFile(item.getAsFile()));
          } else if (entry.isDirectory) {
            _results.push(this._addFilesFromDirectory(entry, entry.name));
          } else {
            _results.push(void 0);
          }
        } else if (item.getAsFile != null) {
          if ((item.kind == null) || item.kind === "file") {
            _results.push(this.addFile(item.getAsFile()));
          } else {
            _results.push(void 0);
          }
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Dropzone.prototype._addFilesFromDirectory = function(directory, path) {
      var dirReader, errorHandler, readEntries;
      dirReader = directory.createReader();
      errorHandler = function(error) {
        return typeof console !== "undefined" && console !== null ? typeof console.log === "function" ? console.log(error) : void 0 : void 0;
      };
      readEntries = (function(_this) {
        return function() {
          return dirReader.readEntries(function(entries) {
            var entry, _i, _len;
            if (entries.length > 0) {
              for (_i = 0, _len = entries.length; _i < _len; _i++) {
                entry = entries[_i];
                if (entry.isFile) {
                  entry.file(function(file) {
                    if (_this.options.ignoreHiddenFiles && file.name.substring(0, 1) === '.') {
                      return;
                    }
                    file.fullPath = "" + path + "/" + file.name;
                    return _this.addFile(file);
                  });
                } else if (entry.isDirectory) {
                  _this._addFilesFromDirectory(entry, "" + path + "/" + entry.name);
                }
              }
              readEntries();
            }
            return null;
          }, errorHandler);
        };
      })(this);
      return readEntries();
    };

    Dropzone.prototype.accept = function(file, done) {
      if (file.size > this.options.maxFilesize * 1024 * 1024) {
        return done(this.options.dictFileTooBig.replace("{{filesize}}", Math.round(file.size / 1024 / 10.24) / 100).replace("{{maxFilesize}}", this.options.maxFilesize));
      } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {
        return done(this.options.dictInvalidFileType);
      } else if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {
        done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}", this.options.maxFiles));
        return this.emit("maxfilesexceeded", file);
      } else {
        return this.options.accept.call(this, file, done);
      }
    };

    Dropzone.prototype.addFile = function(file) {
      file.upload = {
        progress: 0,
        total: file.size,
        bytesSent: 0
      };
      this.files.push(file);
      file.status = Dropzone.ADDED;
      this.emit("addedfile", file);
      this._enqueueThumbnail(file);
      return this.accept(file, (function(_this) {
        return function(error) {
          if (error) {
            file.accepted = false;
            _this._errorProcessing([file], error);
          } else {
            file.accepted = true;
            if (_this.options.autoQueue) {
              _this.enqueueFile(file);
            }
          }
          return _this._updateMaxFilesReachedClass();
        };
      })(this));
    };

    Dropzone.prototype.enqueueFiles = function(files) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        this.enqueueFile(file);
      }
      return null;
    };

    Dropzone.prototype.enqueueFile = function(file) {
      if (file.status === Dropzone.ADDED && file.accepted === true) {
        file.status = Dropzone.QUEUED;
        if (this.options.autoProcessQueue) {
          return setTimeout(((function(_this) {
            return function() {
              return _this.processQueue();
            };
          })(this)), 0);
        }
      } else {
        throw new Error("This file can't be queued because it has already been processed or was rejected.");
      }
    };

    Dropzone.prototype._thumbnailQueue = [];

    Dropzone.prototype._processingThumbnail = false;

    Dropzone.prototype._enqueueThumbnail = function(file) {
      if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {
        this._thumbnailQueue.push(file);
        return setTimeout(((function(_this) {
          return function() {
            return _this._processThumbnailQueue();
          };
        })(this)), 0);
      }
    };

    Dropzone.prototype._processThumbnailQueue = function() {
      if (this._processingThumbnail || this._thumbnailQueue.length === 0) {
        return;
      }
      this._processingThumbnail = true;
      return this.createThumbnail(this._thumbnailQueue.shift(), (function(_this) {
        return function() {
          _this._processingThumbnail = false;
          return _this._processThumbnailQueue();
        };
      })(this));
    };

    Dropzone.prototype.removeFile = function(file) {
      if (file.status === Dropzone.UPLOADING) {
        this.cancelUpload(file);
      }
      this.files = without(this.files, file);
      this.emit("removedfile", file);
      if (this.files.length === 0) {
        return this.emit("reset");
      }
    };

    Dropzone.prototype.removeAllFiles = function(cancelIfNecessary) {
      var file, _i, _len, _ref;
      if (cancelIfNecessary == null) {
        cancelIfNecessary = false;
      }
      _ref = this.files.slice();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {
          this.removeFile(file);
        }
      }
      return null;
    };

    Dropzone.prototype.createThumbnail = function(file, callback) {
      var fileReader;
      fileReader = new FileReader;
      fileReader.onload = (function(_this) {
        return function() {
          if (file.type === "image/svg+xml") {
            _this.emit("thumbnail", file, fileReader.result);
            if (callback != null) {
              callback();
            }
            return;
          }
          return _this.createThumbnailFromUrl(file, fileReader.result, callback);
        };
      })(this);
      return fileReader.readAsDataURL(file);
    };

    Dropzone.prototype.createThumbnailFromUrl = function(file, imageUrl, callback, crossOrigin) {
      var img;
      img = document.createElement("img");
      if (crossOrigin) {
        img.crossOrigin = crossOrigin;
      }
      img.onload = (function(_this) {
        return function() {
          var canvas, ctx, resizeInfo, thumbnail, _ref, _ref1, _ref2, _ref3;
          file.width = img.width;
          file.height = img.height;
          resizeInfo = _this.options.resize.call(_this, file);
          if (resizeInfo.trgWidth == null) {
            resizeInfo.trgWidth = resizeInfo.optWidth;
          }
          if (resizeInfo.trgHeight == null) {
            resizeInfo.trgHeight = resizeInfo.optHeight;
          }
          canvas = document.createElement("canvas");
          ctx = canvas.getContext("2d");
          canvas.width = resizeInfo.trgWidth;
          canvas.height = resizeInfo.trgHeight;
          drawImageIOSFix(ctx, img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);
          thumbnail = canvas.toDataURL("image/png");
          _this.emit("thumbnail", file, thumbnail);
          if (callback != null) {
            return callback();
          }
        };
      })(this);
      if (callback != null) {
        img.onerror = callback;
      }
      return img.src = imageUrl;
    };

    Dropzone.prototype.processQueue = function() {
      var i, parallelUploads, processingLength, queuedFiles;
      parallelUploads = this.options.parallelUploads;
      processingLength = this.getUploadingFiles().length;
      i = processingLength;
      if (processingLength >= parallelUploads) {
        return;
      }
      queuedFiles = this.getQueuedFiles();
      if (!(queuedFiles.length > 0)) {
        return;
      }
      if (this.options.uploadMultiple) {
        return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength));
      } else {
        while (i < parallelUploads) {
          if (!queuedFiles.length) {
            return;
          }
          this.processFile(queuedFiles.shift());
          i++;
        }
      }
    };

    Dropzone.prototype.processFile = function(file) {
      return this.processFiles([file]);
    };

    Dropzone.prototype.processFiles = function(files) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.processing = true;
        file.status = Dropzone.UPLOADING;
        this.emit("processing", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("processingmultiple", files);
      }
      return this.uploadFiles(files);
    };

    Dropzone.prototype._getFilesWithXhr = function(xhr) {
      var file, files;
      return files = (function() {
        var _i, _len, _ref, _results;
        _ref = this.files;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          file = _ref[_i];
          if (file.xhr === xhr) {
            _results.push(file);
          }
        }
        return _results;
      }).call(this);
    };

    Dropzone.prototype.cancelUpload = function(file) {
      var groupedFile, groupedFiles, _i, _j, _len, _len1, _ref;
      if (file.status === Dropzone.UPLOADING) {
        groupedFiles = this._getFilesWithXhr(file.xhr);
        for (_i = 0, _len = groupedFiles.length; _i < _len; _i++) {
          groupedFile = groupedFiles[_i];
          groupedFile.status = Dropzone.CANCELED;
        }
        file.xhr.abort();
        for (_j = 0, _len1 = groupedFiles.length; _j < _len1; _j++) {
          groupedFile = groupedFiles[_j];
          this.emit("canceled", groupedFile);
        }
        if (this.options.uploadMultiple) {
          this.emit("canceledmultiple", groupedFiles);
        }
      } else if ((_ref = file.status) === Dropzone.ADDED || _ref === Dropzone.QUEUED) {
        file.status = Dropzone.CANCELED;
        this.emit("canceled", file);
        if (this.options.uploadMultiple) {
          this.emit("canceledmultiple", [file]);
        }
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    resolveOption = function() {
      var args, option;
      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (typeof option === 'function') {
        return option.apply(this, args);
      }
      return option;
    };

    Dropzone.prototype.uploadFile = function(file) {
      return this.uploadFiles([file]);
    };

    Dropzone.prototype.uploadFiles = function(files) {
      var file, formData, handleError, headerName, headerValue, headers, i, input, inputName, inputType, key, method, option, progressObj, response, updateProgress, url, value, xhr, _i, _j, _k, _l, _len, _len1, _len2, _len3, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;
      xhr = new XMLHttpRequest();
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.xhr = xhr;
      }
      method = resolveOption(this.options.method, files);
      url = resolveOption(this.options.url, files);
      xhr.open(method, url, true);
      xhr.withCredentials = !!this.options.withCredentials;
      response = null;
      handleError = (function(_this) {
        return function() {
          var _j, _len1, _results;
          _results = [];
          for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
            file = files[_j];
            _results.push(_this._errorProcessing(files, response || _this.options.dictResponseError.replace("{{statusCode}}", xhr.status), xhr));
          }
          return _results;
        };
      })(this);
      updateProgress = (function(_this) {
        return function(e) {
          var allFilesFinished, progress, _j, _k, _l, _len1, _len2, _len3, _results;
          if (e != null) {
            progress = 100 * e.loaded / e.total;
            for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
              file = files[_j];
              file.upload = {
                progress: progress,
                total: e.total,
                bytesSent: e.loaded
              };
            }
          } else {
            allFilesFinished = true;
            progress = 100;
            for (_k = 0, _len2 = files.length; _k < _len2; _k++) {
              file = files[_k];
              if (!(file.upload.progress === 100 && file.upload.bytesSent === file.upload.total)) {
                allFilesFinished = false;
              }
              file.upload.progress = progress;
              file.upload.bytesSent = file.upload.total;
            }
            if (allFilesFinished) {
              return;
            }
          }
          _results = [];
          for (_l = 0, _len3 = files.length; _l < _len3; _l++) {
            file = files[_l];
            _results.push(_this.emit("uploadprogress", file, progress, file.upload.bytesSent));
          }
          return _results;
        };
      })(this);
      xhr.onload = (function(_this) {
        return function(e) {
          var _ref;
          if (files[0].status === Dropzone.CANCELED) {
            return;
          }
          if (xhr.readyState !== 4) {
            return;
          }
          response = xhr.responseText;
          if (xhr.getResponseHeader("content-type") && ~xhr.getResponseHeader("content-type").indexOf("application/json")) {
            try {
              response = JSON.parse(response);
            } catch (_error) {
              e = _error;
              response = "Invalid JSON response from server.";
            }
          }
          updateProgress();
          if (!((200 <= (_ref = xhr.status) && _ref < 300))) {
            return handleError();
          } else {
            return _this._finished(files, response, e);
          }
        };
      })(this);
      xhr.onerror = (function(_this) {
        return function() {
          if (files[0].status === Dropzone.CANCELED) {
            return;
          }
          return handleError();
        };
      })(this);
      progressObj = (_ref = xhr.upload) != null ? _ref : xhr;
      progressObj.onprogress = updateProgress;
      headers = {
        "Accept": "application/json",
        "Cache-Control": "no-cache",
        "X-Requested-With": "XMLHttpRequest"
      };
      if (this.options.headers) {
        extend(headers, this.options.headers);
      }
      for (headerName in headers) {
        headerValue = headers[headerName];
        if (headerValue) {
          xhr.setRequestHeader(headerName, headerValue);
        }
      }
      formData = new FormData();
      if (this.options.params) {
        _ref1 = this.options.params;
        for (key in _ref1) {
          value = _ref1[key];
          formData.append(key, value);
        }
      }
      for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
        file = files[_j];
        this.emit("sending", file, xhr, formData);
      }
      if (this.options.uploadMultiple) {
        this.emit("sendingmultiple", files, xhr, formData);
      }
      if (this.element.tagName === "FORM") {
        _ref2 = this.element.querySelectorAll("input, textarea, select, button");
        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
          input = _ref2[_k];
          inputName = input.getAttribute("name");
          inputType = input.getAttribute("type");
          if (input.tagName === "SELECT" && input.hasAttribute("multiple")) {
            _ref3 = input.options;
            for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
              option = _ref3[_l];
              if (option.selected) {
                formData.append(inputName, option.value);
              }
            }
          } else if (!inputType || ((_ref4 = inputType.toLowerCase()) !== "checkbox" && _ref4 !== "radio") || input.checked) {
            formData.append(inputName, input.value);
          }
        }
      }
      for (i = _m = 0, _ref5 = files.length - 1; 0 <= _ref5 ? _m <= _ref5 : _m >= _ref5; i = 0 <= _ref5 ? ++_m : --_m) {
        formData.append(this._getParamName(i), files[i], this._renameFilename(files[i].name));
      }
      return this.submitRequest(xhr, formData, files);
    };

    Dropzone.prototype.submitRequest = function(xhr, formData, files) {
      return xhr.send(formData);
    };

    Dropzone.prototype._finished = function(files, responseText, e) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.status = Dropzone.SUCCESS;
        this.emit("success", file, responseText, e);
        this.emit("complete", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("successmultiple", files, responseText, e);
        this.emit("completemultiple", files);
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    Dropzone.prototype._errorProcessing = function(files, message, xhr) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.status = Dropzone.ERROR;
        this.emit("error", file, message, xhr);
        this.emit("complete", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("errormultiple", files, message, xhr);
        this.emit("completemultiple", files);
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    return Dropzone;

  })(Emitter);

  Dropzone.version = "4.3.0";

  Dropzone.options = {};

  Dropzone.optionsForElement = function(element) {
    if (element.getAttribute("id")) {
      return Dropzone.options[camelize(element.getAttribute("id"))];
    } else {
      return void 0;
    }
  };

  Dropzone.instances = [];

  Dropzone.forElement = function(element) {
    if (typeof element === "string") {
      element = document.querySelector(element);
    }
    if ((element != null ? element.dropzone : void 0) == null) {
      throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");
    }
    return element.dropzone;
  };

  Dropzone.autoDiscover = true;

  Dropzone.discover = function() {
    var checkElements, dropzone, dropzones, _i, _len, _results;
    if (document.querySelectorAll) {
      dropzones = document.querySelectorAll(".dropzone");
    } else {
      dropzones = [];
      checkElements = function(elements) {
        var el, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = elements.length; _i < _len; _i++) {
          el = elements[_i];
          if (/(^| )dropzone($| )/.test(el.className)) {
            _results.push(dropzones.push(el));
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      };
      checkElements(document.getElementsByTagName("div"));
      checkElements(document.getElementsByTagName("form"));
    }
    _results = [];
    for (_i = 0, _len = dropzones.length; _i < _len; _i++) {
      dropzone = dropzones[_i];
      if (Dropzone.optionsForElement(dropzone) !== false) {
        _results.push(new Dropzone(dropzone));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  Dropzone.blacklistedBrowsers = [/opera.*Macintosh.*version\/12/i];

  Dropzone.isBrowserSupported = function() {
    var capableBrowser, regex, _i, _len, _ref;
    capableBrowser = true;
    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {
      if (!("classList" in document.createElement("a"))) {
        capableBrowser = false;
      } else {
        _ref = Dropzone.blacklistedBrowsers;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          regex = _ref[_i];
          if (regex.test(navigator.userAgent)) {
            capableBrowser = false;
            continue;
          }
        }
      }
    } else {
      capableBrowser = false;
    }
    return capableBrowser;
  };

  without = function(list, rejectedItem) {
    var item, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      item = list[_i];
      if (item !== rejectedItem) {
        _results.push(item);
      }
    }
    return _results;
  };

  camelize = function(str) {
    return str.replace(/[\-_](\w)/g, function(match) {
      return match.charAt(1).toUpperCase();
    });
  };

  Dropzone.createElement = function(string) {
    var div;
    div = document.createElement("div");
    div.innerHTML = string;
    return div.childNodes[0];
  };

  Dropzone.elementInside = function(element, container) {
    if (element === container) {
      return true;
    }
    while (element = element.parentNode) {
      if (element === container) {
        return true;
      }
    }
    return false;
  };

  Dropzone.getElement = function(el, name) {
    var element;
    if (typeof el === "string") {
      element = document.querySelector(el);
    } else if (el.nodeType != null) {
      element = el;
    }
    if (element == null) {
      throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector or a plain HTML element.");
    }
    return element;
  };

  Dropzone.getElements = function(els, name) {
    var e, el, elements, _i, _j, _len, _len1, _ref;
    if (els instanceof Array) {
      elements = [];
      try {
        for (_i = 0, _len = els.length; _i < _len; _i++) {
          el = els[_i];
          elements.push(this.getElement(el, name));
        }
      } catch (_error) {
        e = _error;
        elements = null;
      }
    } else if (typeof els === "string") {
      elements = [];
      _ref = document.querySelectorAll(els);
      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
        el = _ref[_j];
        elements.push(el);
      }
    } else if (els.nodeType != null) {
      elements = [els];
    }
    if (!((elements != null) && elements.length)) {
      throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");
    }
    return elements;
  };

  Dropzone.confirm = function(question, accepted, rejected) {
    if (window.confirm(question)) {
      return accepted();
    } else if (rejected != null) {
      return rejected();
    }
  };

  Dropzone.isValidFile = function(file, acceptedFiles) {
    var baseMimeType, mimeType, validType, _i, _len;
    if (!acceptedFiles) {
      return true;
    }
    acceptedFiles = acceptedFiles.split(",");
    mimeType = file.type;
    baseMimeType = mimeType.replace(/\/.*$/, "");
    for (_i = 0, _len = acceptedFiles.length; _i < _len; _i++) {
      validType = acceptedFiles[_i];
      validType = validType.trim();
      if (validType.charAt(0) === ".") {
        if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {
          return true;
        }
      } else if (/\/\*$/.test(validType)) {
        if (baseMimeType === validType.replace(/\/.*$/, "")) {
          return true;
        }
      } else {
        if (mimeType === validType) {
          return true;
        }
      }
    }
    return false;
  };

  if (typeof jQuery !== "undefined" && jQuery !== null) {
    jQuery.fn.dropzone = function(options) {
      return this.each(function() {
        return new Dropzone(this, options);
      });
    };
  }

  if (typeof module !== "undefined" && module !== null) {
    module.exports = Dropzone;
  } else {
    window.Dropzone = Dropzone;
  }

  Dropzone.ADDED = "added";

  Dropzone.QUEUED = "queued";

  Dropzone.ACCEPTED = Dropzone.QUEUED;

  Dropzone.UPLOADING = "uploading";

  Dropzone.PROCESSING = Dropzone.UPLOADING;

  Dropzone.CANCELED = "canceled";

  Dropzone.ERROR = "error";

  Dropzone.SUCCESS = "success";


  /*
  
  Bugfix for iOS 6 and 7
  Source: http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
  based on the work of https://github.com/stomita/ios-imagefile-megapixel
   */

  detectVerticalSquash = function(img) {
    var alpha, canvas, ctx, data, ey, ih, iw, py, ratio, sy;
    iw = img.naturalWidth;
    ih = img.naturalHeight;
    canvas = document.createElement("canvas");
    canvas.width = 1;
    canvas.height = ih;
    ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    data = ctx.getImageData(0, 0, 1, ih).data;
    sy = 0;
    ey = ih;
    py = ih;
    while (py > sy) {
      alpha = data[(py - 1) * 4 + 3];
      if (alpha === 0) {
        ey = py;
      } else {
        sy = py;
      }
      py = (ey + sy) >> 1;
    }
    ratio = py / ih;
    if (ratio === 0) {
      return 1;
    } else {
      return ratio;
    }
  };

  drawImageIOSFix = function(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {
    var vertSquashRatio;
    vertSquashRatio = detectVerticalSquash(img);
    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);
  };


  /*
   * contentloaded.js
   *
   * Author: Diego Perini (diego.perini at gmail.com)
   * Summary: cross-browser wrapper for DOMContentLoaded
   * Updated: 20101020
   * License: MIT
   * Version: 1.2
   *
   * URL:
   * http://javascript.nwbox.com/ContentLoaded/
   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE
   */

  contentLoaded = function(win, fn) {
    var add, doc, done, init, poll, pre, rem, root, top;
    done = false;
    top = true;
    doc = win.document;
    root = doc.documentElement;
    add = (doc.addEventListener ? "addEventListener" : "attachEvent");
    rem = (doc.addEventListener ? "removeEventListener" : "detachEvent");
    pre = (doc.addEventListener ? "" : "on");
    init = function(e) {
      if (e.type === "readystatechange" && doc.readyState !== "complete") {
        return;
      }
      (e.type === "load" ? win : doc)[rem](pre + e.type, init, false);
      if (!done && (done = true)) {
        return fn.call(win, e.type || e);
      }
    };
    poll = function() {
      var e;
      try {
        root.doScroll("left");
      } catch (_error) {
        e = _error;
        setTimeout(poll, 50);
        return;
      }
      return init("poll");
    };
    if (doc.readyState !== "complete") {
      if (doc.createEventObject && root.doScroll) {
        try {
          top = !win.frameElement;
        } catch (_error) {}
        if (top) {
          poll();
        }
      }
      doc[add](pre + "DOMContentLoaded", init, false);
      doc[add](pre + "readystatechange", init, false);
      return win[add](pre + "load", init, false);
    }
  };

  Dropzone._autoDiscoverFunction = function() {
    if (Dropzone.autoDiscover) {
      return Dropzone.discover();
    }
  };

  contentLoaded(window, Dropzone._autoDiscoverFunction);

}).call(this);

},{}],106:[function(require,module,exports){
/*
attributes
*/"use strict"

var $       = require("./base")

var trim    = require("mout/string/trim"),
    forEach = require("mout/array/forEach"),
    filter  = require("mout/array/filter"),
    indexOf = require("mout/array/indexOf")

// attributes

$.implement({

    setAttribute: function(name, value){
        return this.forEach(function(node){
            node.setAttribute(name, value)
        })
    },

    getAttribute: function(name){
        var attr = this[0].getAttributeNode(name)
        return (attr && attr.specified) ? attr.value : null
    },

    hasAttribute: function(name){
        var node = this[0]
        if (node.hasAttribute) return node.hasAttribute(name)
        var attr = node.getAttributeNode(name)
        return !!(attr && attr.specified)
    },

    removeAttribute: function(name){
        return this.forEach(function(node){
            var attr = node.getAttributeNode(name)
            if (attr) node.removeAttributeNode(attr)
        })
    }

})

var accessors = {}

forEach(["type", "value", "name", "href", "title", "id"], function(name){

    accessors[name] = function(value){
        return (value !== undefined) ? this.forEach(function(node){
            node[name] = value
        }) : this[0][name]
    }

})

// booleans

forEach(["checked", "disabled", "selected"], function(name){

    accessors[name] = function(value){
        return (value !== undefined) ? this.forEach(function(node){
            node[name] = !!value
        }) : !!this[0][name]
    }

})

// className

var classes = function(className){
    var classNames = trim(className).replace(/\s+/g, " ").split(" "),
        uniques    = {}

    return filter(classNames, function(className){
        if (className !== "" && !uniques[className]) return uniques[className] = className
    }).sort()
}

accessors.className = function(className){
    return (className !== undefined) ? this.forEach(function(node){
        node.className = classes(className).join(" ")
    }) : classes(this[0].className).join(" ")
}

// attribute

$.implement({

    attribute: function(name, value){
        var accessor = accessors[name]
        if (accessor) return accessor.call(this, value)
        if (value != null) return this.setAttribute(name, value)
        if (value === null) return this.removeAttribute(name)
        if (value === undefined) return this.getAttribute(name)
    }

})

$.implement(accessors)

// shortcuts

$.implement({

    check: function(){
        return this.checked(true)
    },

    uncheck: function(){
        return this.checked(false)
    },

    disable: function(){
        return this.disabled(true)
    },

    enable: function(){
        return this.disabled(false)
    },

    select: function(){
        return this.selected(true)
    },

    deselect: function(){
        return this.selected(false)
    }

})

// classNames, has / add / remove Class

$.implement({

    classNames: function(){
        return classes(this[0].className)
    },

    hasClass: function(className){
        return indexOf(this.classNames(), className) > -1
    },

    addClass: function(className){
        return this.forEach(function(node){
            var nodeClassName = node.className
            var classNames = classes(nodeClassName + " " + className).join(" ")
            if (nodeClassName !== classNames) node.className = classNames
        })
    },

    removeClass: function(className){
        return this.forEach(function(node){
            var classNames = classes(node.className)
            forEach(classes(className), function(className){
                var index = indexOf(classNames, className)
                if (index > -1) classNames.splice(index, 1)
            })
            node.className = classNames.join(" ")
        })
    },

    toggleClass: function(className, force){
        var add = force !== undefined ? force : !this.hasClass(className)
        if (add)
            this.addClass(className)
        else
            this.removeClass(className)
        return !!add
    }

})

// toString

$.prototype.toString = function(){
    var tag     = this.tag(),
        id      = this.id(),
        classes = this.classNames()

    var str = tag
    if (id) str += '#' + id
    if (classes.length) str += '.' + classes.join(".")
    return str
}

var textProperty = (document.createElement('div').textContent == null) ? 'innerText' : 'textContent'

// tag, html, text, data

$.implement({

    tag: function(){
        return this[0].tagName.toLowerCase()
    },

    html: function(html){
        return (html !== undefined) ? this.forEach(function(node){
            node.innerHTML = html
        }) : this[0].innerHTML
    },

    text: function(text){
        return (text !== undefined) ? this.forEach(function(node){
            node[textProperty] = text
        }) : this[0][textProperty]
    },

    data: function(key, value){
        switch(value) {
            case undefined: return this.getAttribute("data-" + key)
            case null: return this.removeAttribute("data-" + key)
            default: return this.setAttribute("data-" + key, value)
        }
    }

})

module.exports = $

},{"./base":107,"mout/array/filter":114,"mout/array/forEach":115,"mout/array/indexOf":116,"mout/string/trim":133}],107:[function(require,module,exports){
/*
elements
*/"use strict"

var prime   = require("prime")

var forEach = require("mout/array/forEach"),
    map     = require("mout/array/map"),
    filter  = require("mout/array/filter"),
    every   = require("mout/array/every"),
    some    = require("mout/array/some")

// uniqueID

var index = 0,
    __dc = document.__counter,
    counter = document.__counter = (__dc ? parseInt(__dc, 36) + 1 : 0).toString(36),
    key = "uid:" + counter

var uniqueID = function(n){
    if (n === window) return "window"
    if (n === document) return "document"
    if (n === document.documentElement) return "html"
    return n[key] || (n[key] = (index++).toString(36))
}

var instances = {}

// elements prime

var $ = prime({constructor: function $(n, context){

    if (n == null) return (this && this.constructor === $) ? new Elements : null

    var self, uid

    if (n.constructor !== Elements){

        self = new Elements

        if (typeof n === "string"){
            if (!self.search) return null
            self[self.length++] = context || document
            return self.search(n)
        }

        if (n.nodeType || n === window){

            self[self.length++] = n

        } else if (n.length){

            // this could be an array, or any object with a length attribute,
            // including another instance of elements from another interface.

            var uniques = {}

            for (var i = 0, l = n.length; i < l; i++){ // perform elements flattening
                var nodes = $(n[i], context)
                if (nodes && nodes.length) for (var j = 0, k = nodes.length; j < k; j++){
                    var node = nodes[j]
                    uid = uniqueID(node)
                    if (!uniques[uid]){
                        self[self.length++] = node
                        uniques[uid] = true
                    }
                }
            }

        }

    } else {
      self = n
    }

    if (!self.length) return null

    // when length is 1 always use the same elements instance

    if (self.length === 1){
        uid = uniqueID(self[0])
        return instances[uid] || (instances[uid] = self)
    }

    return self

}})

var Elements = prime({

    inherits: $,

    constructor: function Elements(){
        this.length = 0
    },

    unlink: function(){
        return this.map(function(node){
            delete instances[uniqueID(node)]
            return node
        })
    },

    // methods

    forEach: function(method, context){
        forEach(this, method, context)
        return this
    },

    map: function(method, context){
        return map(this, method, context)
    },

    filter: function(method, context){
        return filter(this, method, context)
    },

    every: function(method, context){
        return every(this, method, context)
    },

    some: function(method, context){
        return some(this, method, context)
    }

})

module.exports = $

},{"mout/array/every":113,"mout/array/filter":114,"mout/array/forEach":115,"mout/array/map":117,"mout/array/some":118,"prime":299}],108:[function(require,module,exports){
/*
delegation
*/"use strict"

var Map = require("prime/map")

var $ = require("./events")
        require('./traversal')

$.implement({

    delegate: function(event, selector, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node)

            var delegation = self._delegation || (self._delegation = {}),
                events     = delegation[event] || (delegation[event] = {}),
                map        = (events[selector] || (events[selector] = new Map))

            if (map.get(handle)) return

            var action = function(e){
                var target = $(e.target || e.srcElement),
                    match  = target.matches(selector) ? target : target.parent(selector)

                var res

                if (match) res = handle.call(self, e, match)

                return res
            }

            map.set(handle, action)

            self.on(event, action, useCapture)

        })

    },

    undelegate: function(event, selector, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node), delegation, events, map

            if (!(delegation = self._delegation) || !(events = delegation[event]) || !(map = events[selector])) return;

            var action = map.get(handle)

            if (action){
                self.off(event, action, useCapture)
                map.remove(action)

                // if there are no more handles in a given selector, delete it
                if (!map.count()) delete events[selector]
                // var evc = evd = 0, x
                var e1 = true, e2 = true, x
                for (x in events){
                    e1 = false
                    break
                }
                // if no more selectors in a given event type, delete it
                if (e1) delete delegation[event]
                for (x in delegation){
                    e2 = false
                    break
                }
                // if there are no more delegation events in the element, delete the _delegation object
                if (e2) delete self._delegation
            }

        })

    }

})

module.exports = $

},{"./events":110,"./traversal":134,"prime/map":300}],109:[function(require,module,exports){
/*
domready
*/"use strict"

var $ = require("./events")

var readystatechange = 'onreadystatechange' in document,
    shouldPoll       = false,
    loaded           = false,
    readys           = [],
    checks           = [],
    ready            = null,
    timer            = null,
    test             = document.createElement('div'),
    doc              = $(document),
    win              = $(window)

var domready = function(){

    if (timer) timer = clearTimeout(timer)

    if (!loaded){

        if (readystatechange) doc.off('readystatechange', check)
        doc.off('DOMContentLoaded', domready)
        win.off('load', domready)

        loaded = true

        for (var i = 0; ready = readys[i++];) ready()
    }

    return loaded

}

var check = function(){
    for (var i = checks.length; i--;) if (checks[i]()) return domready()
    return false
}

var poll = function(){
    clearTimeout(timer)
    if (!check()) timer = setTimeout(poll, 1e3 / 60)
}

if (document.readyState){ // use readyState if available

    var complete = function(){
        return !!(/loaded|complete/).test(document.readyState)
    }

    checks.push(complete)

    if (!complete()){ // unless dom is already loaded
        if (readystatechange) doc.on('readystatechange', check) // onreadystatechange event
        else shouldPoll = true //or poll readyState check
    } else { // dom is already loaded
        domready()
    }

}

if (test.doScroll){ // also use doScroll if available (doscroll comes before readyState "complete")

    // LEGAL DEPT:
    // doScroll technique discovered by, owned by, and copyrighted to Diego Perini http://javascript.nwbox.com/IEContentLoaded/

    // testElement.doScroll() throws when the DOM is not ready, only in the top window

    var scrolls = function(){
        try {
            test.doScroll()
            return true
        } catch (e){}
        return false
    }

    // If doScroll works already, it can't be used to determine domready
    // e.g. in an iframe

    if (!scrolls()){
        checks.push(scrolls)
        shouldPoll = true
    }

}

if (shouldPoll) poll()

// make sure that domready fires before load, also if not onreadystatechange and doScroll and DOMContentLoaded load will fire
doc.on('DOMContentLoaded', domready)
win.on('load', domready)

module.exports = function(ready){
    (loaded) ? ready() : readys.push(ready)
    return null
}

},{"./events":110}],110:[function(require,module,exports){
/*
events
*/"use strict"

var Emitter = require("prime/emitter")

var $ = require("./base")

var html = document.documentElement

var addEventListener = html.addEventListener ? function(node, event, handle, useCapture){
    node.addEventListener(event, handle, useCapture || false)
    return handle
} : function(node, event, handle){
    node.attachEvent('on' + event, handle)
    return handle
}

var removeEventListener = html.removeEventListener ? function(node, event, handle, useCapture){
    node.removeEventListener(event, handle, useCapture || false)
} : function(node, event, handle){
    node.detachEvent("on" + event, handle)
}

$.implement({

    on: function(event, handle, useCapture){

        return this.forEach(function(node){
            var self = $(node)

            var internalEvent = event + (useCapture ? ":capture" : "")

            Emitter.prototype.on.call(self, internalEvent, handle)

            var domListeners = self._domListeners || (self._domListeners = {})
            if (!domListeners[internalEvent]) domListeners[internalEvent] = addEventListener(node, event, function(e){
                Emitter.prototype.emit.call(self, internalEvent, e || window.event, Emitter.EMIT_SYNC)
            }, useCapture)
        })
    },

    off: function(event, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node)

            var internalEvent = event + (useCapture ? ":capture" : "")

            var domListeners = self._domListeners, domEvent, listeners = self._listeners, events

            if (domListeners && (domEvent = domListeners[internalEvent]) && listeners && (events = listeners[internalEvent])){

                Emitter.prototype.off.call(self, internalEvent, handle)

                if (!self._listeners || !self._listeners[event]){
                    removeEventListener(node, event, domEvent)
                    delete domListeners[event]

                    for (var l in domListeners) return
                    delete self._domListeners
                }

            }
        })
    },

    emit: function(){
        var args = arguments
        return this.forEach(function(node){
            Emitter.prototype.emit.apply($(node), args)
        })
    }

})

module.exports = $

},{"./base":107,"prime/emitter":298}],111:[function(require,module,exports){
/*
elements
*/"use strict"

var $ = require("./base")
        require("./attributes")
        require("./events")
        require("./insertion")
        require("./traversal")
        require("./delegation")

module.exports = $

},{"./attributes":106,"./base":107,"./delegation":108,"./events":110,"./insertion":112,"./traversal":134}],112:[function(require,module,exports){
/*
insertion
*/"use strict"

var $ = require("./base")

// base insertion

$.implement({

    appendChild: function(child){
        this[0].appendChild($(child)[0])
        return this
    },

    insertBefore: function(child, ref){
        this[0].insertBefore($(child)[0], $(ref)[0])
        return this
    },

    removeChild: function(child){
        this[0].removeChild($(child)[0])
        return this
    },

    replaceChild: function(child, ref){
        this[0].replaceChild($(child)[0], $(ref)[0])
        return this
    }

})

// before, after, bottom, top

$.implement({

    before: function(element){
        element = $(element)[0]
        var parent = element.parentNode
        if (parent) this.forEach(function(node){
            parent.insertBefore(node, element)
        })
        return this
    },

    after: function(element){
        element = $(element)[0]
        var parent = element.parentNode
        if (parent) this.forEach(function(node){
            parent.insertBefore(node, element.nextSibling)
        })
        return this
    },

    bottom: function(element){
        element = $(element)[0]
        return this.forEach(function(node){
            element.appendChild(node)
        })
    },

    top: function(element){
        element = $(element)[0]
        return this.forEach(function(node){
            element.insertBefore(node, element.firstChild)
        })
    }

})

// insert, replace

$.implement({

    insert: $.prototype.bottom,

    remove: function(){
        return this.forEach(function(node){
            var parent = node.parentNode
            if (parent) parent.removeChild(node)
        })
    },

    replace: function(element){
        element = $(element)[0]
        element.parentNode.replaceChild(this[0], element)
        return this
    }

})

module.exports = $

},{"./base":107}],113:[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array every
     */
    function every(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = true;
        if (arr == null) {
            return result;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if (!callback(arr[i], i, arr) ) {
                result = false;
                break;
            }
        }

        return result;
    }

    module.exports = every;


},{"../function/makeIterator_":120}],114:[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array filter
     */
    function filter(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var results = [];
        if (arr == null) {
            return results;
        }

        var i = -1, len = arr.length, value;
        while (++i < len) {
            value = arr[i];
            if (callback(value, i, arr)) {
                results.push(value);
            }
        }

        return results;
    }

    module.exports = filter;



},{"../function/makeIterator_":120}],115:[function(require,module,exports){
arguments[4][79][0].apply(exports,arguments)
},{"dup":79}],116:[function(require,module,exports){
arguments[4][80][0].apply(exports,arguments)
},{"dup":80}],117:[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array map
     */
    function map(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var results = [];
        if (arr == null){
            return results;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            results[i] = callback(arr[i], i, arr);
        }

        return results;
    }

     module.exports = map;


},{"../function/makeIterator_":120}],118:[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array some
     */
    function some(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = false;
        if (arr == null) {
            return result;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if ( callback(arr[i], i, arr) ) {
                result = true;
                break;
            }
        }

        return result;
    }

    module.exports = some;


},{"../function/makeIterator_":120}],119:[function(require,module,exports){


    /**
     * Returns the first argument provided to it.
     */
    function identity(val){
        return val;
    }

    module.exports = identity;



},{}],120:[function(require,module,exports){
var identity = require('./identity');
var prop = require('./prop');
var deepMatches = require('../object/deepMatches');

    /**
     * Converts argument into a valid iterator.
     * Used internally on most array/object/collection methods that receives a
     * callback/iterator providing a shortcut syntax.
     */
    function makeIterator(src, thisObj){
        if (src == null) {
            return identity;
        }
        switch(typeof src) {
            case 'function':
                // function is the first to improve perf (most common case)
                // also avoid using `Function#call` if not needed, which boosts
                // perf a lot in some cases
                return (typeof thisObj !== 'undefined')? function(val, i, arr){
                    return src.call(thisObj, val, i, arr);
                } : src;
            case 'object':
                return function(val){
                    return deepMatches(val, src);
                };
            case 'string':
            case 'number':
                return prop(src);
        }
    }

    module.exports = makeIterator;



},{"../object/deepMatches":126,"./identity":119,"./prop":121}],121:[function(require,module,exports){


    /**
     * Returns a function that gets a property of the passed object
     */
    function prop(name){
        return function(obj){
            return obj[name];
        };
    }

    module.exports = prop;



},{}],122:[function(require,module,exports){
arguments[4][83][0].apply(exports,arguments)
},{"./isKind":123,"dup":83}],123:[function(require,module,exports){
arguments[4][85][0].apply(exports,arguments)
},{"./kindOf":124,"dup":85}],124:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],125:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],126:[function(require,module,exports){
var forOwn = require('./forOwn');
var isArray = require('../lang/isArray');

    function containsMatch(array, pattern) {
        var i = -1, length = array.length;
        while (++i < length) {
            if (deepMatches(array[i], pattern)) {
                return true;
            }
        }

        return false;
    }

    function matchArray(target, pattern) {
        var i = -1, patternLength = pattern.length;
        while (++i < patternLength) {
            if (!containsMatch(target, pattern[i])) {
                return false;
            }
        }

        return true;
    }

    function matchObject(target, pattern) {
        var result = true;
        forOwn(pattern, function(val, key) {
            if (!deepMatches(target[key], val)) {
                // Return false to break out of forOwn early
                return (result = false);
            }
        });

        return result;
    }

    /**
     * Recursively check if the objects match.
     */
    function deepMatches(target, pattern){
        if (target && typeof target === 'object') {
            if (isArray(target) && isArray(pattern)) {
                return matchArray(target, pattern);
            } else {
                return matchObject(target, pattern);
            }
        } else {
            return target === pattern;
        }
    }

    module.exports = deepMatches;



},{"../lang/isArray":122,"./forOwn":128}],127:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"./hasOwn":129,"dup":90}],128:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"./forIn":127,"./hasOwn":129,"dup":91}],129:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],130:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],131:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"../lang/toString":125,"./WHITE_SPACES":130,"dup":95}],132:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"../lang/toString":125,"./WHITE_SPACES":130,"dup":96}],133:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"../lang/toString":125,"./WHITE_SPACES":130,"./ltrim":131,"./rtrim":132,"dup":97}],134:[function(require,module,exports){
/*
traversal
*/"use strict"

var map = require("mout/array/map")

var slick = require("slick")

var $ = require("./base")

var gen = function(combinator, expression){
    return map(slick.parse(expression || "*"), function(part){
        return combinator + " " + part
    }).join(", ")
}

var push_ = Array.prototype.push

$.implement({

    search: function(expression){
        if (this.length === 1) return $(slick.search(expression, this[0], new $))

        var buffer = []
        for (var i = 0, node; node = this[i]; i++) push_.apply(buffer, slick.search(expression, node))
        buffer = $(buffer)
        return buffer && buffer.sort()
    },

    find: function(expression){
        if (this.length === 1) return $(slick.find(expression, this[0]))

        for (var i = 0, node; node = this[i]; i++) {
            var found = slick.find(expression, node)
            if (found) return $(found)
        }

        return null
    },

    sort: function(){
        return slick.sort(this)
    },

    matches: function(expression){
        return slick.matches(this[0], expression)
    },

    contains: function(node){
        return slick.contains(this[0], node)
    },

    nextSiblings: function(expression){
        return this.search(gen('~', expression))
    },

    nextSibling: function(expression){
        return this.find(gen('+', expression))
    },

    previousSiblings: function(expression){
        return this.search(gen('!~', expression))
    },

    previousSibling: function(expression){
        return this.find(gen('!+', expression))
    },

    children: function(expression){
        return this.search(gen('>', expression))
    },

    firstChild: function(expression){
        return this.find(gen('^', expression))
    },

    lastChild: function(expression){
        return this.find(gen('!^', expression))
    },

    parent: function(expression){
        var buffer = []
        loop: for (var i = 0, node; node = this[i]; i++) while ((node = node.parentNode) && (node !== document)){
            if (!expression || slick.matches(node, expression)){
                buffer.push(node)
                break loop
                break
            }
        }
        return $(buffer)
    },

    parents: function(expression){
        var buffer = []
        for (var i = 0, node; node = this[i]; i++) while ((node = node.parentNode) && (node !== document)){
            if (!expression || slick.matches(node, expression)) buffer.push(node)
        }
        return $(buffer)
    }

})

module.exports = $

},{"./base":107,"mout/array/map":117,"slick":312}],135:[function(require,module,exports){
/*
zen
*/"use strict"

var forEach = require("mout/array/forEach"),
    map     = require("mout/array/map")

var parse = require("slick/parser")

var $ = require("./base")

module.exports = function(expression, doc){

    return $(map(parse(expression), function(expression){

        var previous, result

        forEach(expression, function(part, i){

            var node = (doc || document).createElement(part.tag)

            if (part.id) node.id = part.id

            if (part.classList) node.className = part.classList.join(" ")

            if (part.attributes) forEach(part.attributes, function(attribute){
                node.setAttribute(attribute.name, attribute.value || "")
            })

            if (part.pseudos) forEach(part.pseudos, function(pseudo){
                var n = $(node), method = n[pseudo.name]
                if (method) method.call(n, pseudo.value)
            })

            if (i === 0){

                result = node

            } else if (part.combinator === " "){

                previous.appendChild(node)

            } else if (part.combinator === "+"){
                var parentNode = previous.parentNode
                if (parentNode) parentNode.appendChild(node)
            }

            previous = node

        })

        return result

    }))

}

},{"./base":107,"mout/array/forEach":115,"mout/array/map":117,"slick/parser":313}],136:[function(require,module,exports){
/*          .-   3
.-.-..-..-.-|-._.
' ' '`-'`-' ' ' '
*/"use strict"

// color and timer
var color = require("./lib/color"),
    frame = require("./lib/frame")

// if we're in a browser we need ./browser, otherwise ./fx
var moofx = (typeof document !== "undefined") ? require("./lib/browser") : require("./lib/fx")

moofx.requestFrame = function(callback){
    frame.request(callback)
    return this
}

moofx.cancelFrame = function(callback){
    frame.cancel(callback)
    return this
}

moofx.color = color

// and export moofx

module.exports = moofx

},{"./lib/browser":137,"./lib/color":138,"./lib/frame":139,"./lib/fx":140}],137:[function(require,module,exports){
(function (global){
/*
MooFx
*/"use strict"

// requires

var color  = require("./color"),
    frame  = require("./frame")

var cancelFrame = frame.cancel,
    requestFrame = frame.request

var prime  = require("prime")

var camelize        = require("prime/string/camelize"),
    clean           = require("prime/string/clean"),
    capitalize      = require("prime/string/capitalize"),
    hyphenateString = require("prime/string/hyphenate")

var map     = require("prime/array/map"),
    forEach = require("prime/array/forEach"),
    indexOf = require("prime/array/indexOf")

var elements = require("elements")

var fx = require("./fx")

// util

var matchString = function(s, r){
    return String.prototype.match.call(s, r);
}

var hyphenated = {}
var hyphenate = function(self){
    return hyphenated[self] || (hyphenated[self] = hyphenateString(self))
}

var round = function(n){
    return Math.round(n * 1e3) / 1e3
}

// compute > node > property

var compute = global.getComputedStyle ? function(node){
    var cts = getComputedStyle(node, null)
    return function(property){
        return cts ? cts.getPropertyValue(hyphenate(property)) : ""
    }
} : /*(css3)?*/function(node){
    var cts = node.currentStyle
    return function(property){
        return cts ? cts[camelize(property)] : ""
    }
}/*:null*/

// pixel ratio retriever

var test = document.createElement("div")

var cssText = "border:none;margin:none;padding:none;visibility:hidden;position:absolute;height:0;";

// returns the amount of pixels that takes to make one of the unit

var pixelRatio = function(element, u){
    var parent = element.parentNode, ratio = 1
    if (parent){
        test.style.cssText = cssText + ("width:100" + u + ";")
        parent.appendChild(test)
        ratio = test.offsetWidth / 100
        parent.removeChild(test)
    }
    return ratio
}

// mirror 4 values

var mirror4 = function(values){
    var length = values.length
    if      (length === 1) values.push(values[0], values[0], values[0])
    else if (length === 2) values.push(values[0], values[1])
    else if (length === 3) values.push(values[1])
    return values
}

// regular expressions strings

var sLength      = "([-.\\d]+)(%|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vm)",
    sLengthNum   = sLength + "?",
    sBorderStyle = "none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset|inherit"

// regular expressions

var rgLength     = RegExp(sLength, "g"),
    rLengthNum   = RegExp(sLengthNum),
    rgLengthNum  = RegExp(sLengthNum, "g"),
    rBorderStyle = RegExp(sBorderStyle)

// normalize > css

var parseString = function(value){
    return (value == null) ? "" : value + ""
}

var parseOpacity = function(value, normalize){
    if (value == null || value === "") return normalize ? "1" : ""
    return (isFinite((value = +value))) ? (value < 0 ? "0" : value + "") : "1"
}

try {test.style.color = "rgba(0,0,0,0.5)"} catch(e){}
var rgba = /^rgba/.test(test.style.color)

var parseColor = function(value, normalize){
    var black = "rgba(0,0,0,1)", c
    if (!value || !(c = color(value, true))) return normalize ? black : ""
    if (normalize) return "rgba(" + c + ")"

    var alpha = c[3]
    if (alpha === 0) return "transparent"
    return (!rgba || alpha === 1) ? "rgb(" + c.slice(0, 3) + ")" : "rgba(" + c + ")"
}

var parseLength = function(value, normalize){
    if (value == null || value === "") return normalize ? "0px" : ""
    var match = matchString(value, rLengthNum)
    return match ? match[1] + (match[2] || "px") : value // cannot be parsed. probably "auto"
}

var parseBorderStyle = function(value, normalize){
    if (value == null || value === "") return normalize ? "none" : ""
    var match = value.match(rBorderStyle)
    return match ? value : normalize ? "none" : ""
}

var parseBorder = function(value, normalize){
    var normalized = "0px none rgba(0,0,0,1)"
    if (value == null || value === "")     return normalize ? normalized : ""
    if (value === 0   || value === "none") return normalize ? normalized : value + ""

    var c
    value = value.replace(color.x, function(match){
        c = match
        return ""
    })

    var s = value.match(rBorderStyle),
        l = value.match(rgLengthNum)

    return clean([
        parseLength(l ? l[0] : "", normalize),
        parseBorderStyle(s ? s[0] : "", normalize),
        parseColor(c, normalize)
    ].join(" "))
}

var parseShort4 = function(value, normalize){
    if (value == null || value === "") return normalize ? "0px 0px 0px 0px" : ""
    return clean(mirror4(map(clean(value).split(" "), function(v){
        return parseLength(v, normalize)
    })).join(" "))
}

var parseShadow = function(value, normalize, len){
    var transparent = "rgba(0,0,0,0)",
        normalized  = (len === 3) ? transparent + " 0px 0px 0px" : transparent + " 0px 0px 0px 0px"

    if (value ==  null || value === "") return normalize ? normalized : ""
    if (value === "none") return normalize ? normalized : value

    var colors = [], value = clean(value).replace(color.x, function(match){
        colors.push(match)
        return ""
    })

    return map(value.split(","), function(shadow, i){

        var c       = parseColor(colors[i], normalize),
            inset   = /inset/.test(shadow),
            lengths = shadow.match(rgLengthNum) || ["0px"]

        lengths = map(lengths, function(m){
            return parseLength(m, normalize)
        })

        while (lengths.length < len) lengths.push("0px")

        var ret = inset ? ["inset", c] : [c]

        return ret.concat(lengths).join(" ")

    }).join(", ")
}

var parse = function(value, normalize){
    if (value == null || value === "") return "" // cant normalize "" || null
    return value.replace(color.x, function(match){
        return parseColor(match, normalize)
    }).replace(rgLength, function(match){
        return parseLength(match, normalize)
    })
}

// get && set

var getters = {}, setters = {}, parsers = {}, aliases = {}

var getter = function(key){
    return getters[key] || (getters[key] = (function(){
        var alias  = aliases[key] || key,
            parser = parsers[key] || parse

        return function(){
            return parser(compute(this)(alias), true)
        }

    }()))
}

var setter = function(key){
    return setters[key] || (setters[key] = (function(){

        var alias  = aliases[key] || key,
            parser = parsers[key] || parse

        return function(value){
            this.style[alias] = parser(value, false)
        }

    }()))
}

// parsers

var trbl = ["Top", "Right", "Bottom", "Left"], tlbl = ["TopLeft", "TopRight", "BottomRight", "BottomLeft"]

forEach(trbl, function(d){
    var bd = "border" + d
    forEach([ "margin" + d, "padding" + d, bd + "Width", d.toLowerCase()], function(n){
        parsers[n] = parseLength
    })
    parsers[bd + "Color"] = parseColor
    parsers[bd + "Style"] = parseBorderStyle

    // borderDIR
    parsers[bd] = parseBorder
    getters[bd] = function(){
        return [
            getter(bd + "Width").call(this),
            getter(bd + "Style").call(this),
            getter(bd + "Color").call(this)
        ].join(" ")
    }
})

forEach(tlbl, function(d){
    parsers["border" + d + "Radius"] = parseLength
})

parsers.color = parsers.backgroundColor = parseColor
parsers.width = parsers.height = parsers.minWidth = parsers.minHeight = parsers.maxWidth = parsers.maxHeight = parsers.fontSize = parsers.backgroundSize = parseLength

// margin + padding

forEach(["margin", "padding"], function(name){
    parsers[name] = parseShort4
    getters[name] = function(){
        return map(trbl, function(d){
            return getter(name + d).call(this)
        }, this).join(" ")
    }
})

// borders

// borderDIRWidth, borderDIRStyle, borderDIRColor

parsers.borderWidth = parseShort4

parsers.borderStyle = function(value, normalize){
    if (value == null || value === "") return normalize ? mirror4(["none"]).join(" ") : ""
    value = clean(value).split(" ")
    return clean(mirror4(map(value, function(v){
        parseBorderStyle(v, normalize)
    })).join(" "))
}

parsers.borderColor = function(value, normalize){
    if (!value || !(value = matchString(value, color.x))) return normalize ? mirror4(["rgba(0,0,0,1)"]).join(" ") : ""
    return clean(mirror4(map(value, function(v){
        return parseColor(v, normalize)
    })).join(" "))
}

forEach(["Width", "Style", "Color"], function(name){
    getters["border" + name] = function(){
        return map(trbl, function(d){
            return getter("border" + d + name).call(this)
        }, this).join(" ")
    }
})

// borderRadius

parsers.borderRadius = parseShort4

getters.borderRadius = function(){
    return map(tlbl, function(d){
        return getter("border" + d + "Radius").call(this)
    }, this).join(" ")
}

// border

parsers.border = parseBorder

getters.border = function(){
    var pvalue
    for (var i = 0; i < trbl.length; i++){
        var value = getter("border" + trbl[i]).call(this)
        if (pvalue && value !== pvalue) return null
        pvalue = value
    }
    return pvalue
}

// zIndex

parsers.zIndex = parseString

// opacity

parsers.opacity = parseOpacity

/*(css3)?*/

var filterName = (test.style.MsFilter != null && "MsFilter") || (test.style.filter != null && "filter")

if (filterName && test.style.opacity == null){

    var matchOp = /alpha\(opacity=([\d.]+)\)/i

    setters.opacity = function(value){
        value = ((value = parseOpacity(value)) === "1") ? "" : "alpha(opacity=" + Math.round(value * 100) + ")"
        var filter = compute(this)(filterName)
        return this.style[filterName] = matchOp.test(filter) ? filter.replace(matchOp, value) : filter + " " + value
    }

    getters.opacity = function(){
        var match = compute(this)(filterName).match(matchOp)
        return (!match ? 1 : match[1] / 100) + ""
    }

}/*:*/

var parseBoxShadow = parsers.boxShadow = function(value, normalize){
    return parseShadow(value, normalize, 4)
}

var parseTextShadow = parsers.textShadow = function(value, normalize){
    return parseShadow(value, normalize, 3)
}

// Aliases

forEach(['Webkit', "Moz", "ms", "O", null], function(prefix){
    forEach([
        "transition", "transform", "transformOrigin", "transformStyle", "perspective", "perspectiveOrigin", "backfaceVisibility"
    ], function(style){
        var cc = prefix ? prefix + capitalize(style) : style
        if (prefix === "ms") hyphenated[cc] = "-ms-" + hyphenate(style)
        if (test.style[cc] != null) aliases[style] = cc
    })
})

var transitionName = aliases.transition,
    transformName  = aliases.transform

// manually disable css3 transitions in Opera, because they do not work properly.

if (transitionName === "OTransition") transitionName = null


// this takes care of matrix decomposition on browsers that support only 2d transforms but no CSS3 transitions.
// basically, IE9 (and Opera as well, since we disabled CSS3 transitions manually)

var parseTransform2d, Transform2d

/*(css3)?*/

if (!transitionName && transformName) (function(){

    var unmatrix = require("./unmatrix2d")

    var v = "\\s*([-\\d\\w.]+)\\s*"

    var rMatrix = RegExp("matrix\\(" + [v, v, v, v, v, v] + "\\)")

    var decomposeMatrix = function(matrix){

        var d = unmatrix.apply(null, matrix.match(rMatrix).slice(1)) || [[0, 0], 0, 0, [0, 0]]

        return [

            "translate(" + map(d[0], function(v){return round(v) + "px"}) + ")",
            "rotate(" + round(d[1] * 180 / Math.PI) + "deg)",
            "skewX(" + round(d[2] * 180 / Math.PI) + "deg)",
            "scale(" + map(d[3], round) + ")"

        ].join(" ")

    }

    var def0px  = function(value){return value || "0px"},
        def1    = function(value){return value || "1"},
        def0deg = function(value){return value || "0deg"}

    var transforms = {

        translate: function(value){
            if (!value) value = "0px,0px"
            var values = value.split(",")
            if (!values[1]) values[1] = "0px"
            return map(values, clean) + ""
        },
        translateX: def0px,
        translateY: def0px,
        scale: function(value){
            if (!value) value = "1,1"
            var values = value.split(",")
            if (!values[1]) values[1] = values[0]
            return map(values, clean) + ""
        },
        scaleX: def1,
        scaleY: def1,
        rotate: def0deg,
        skewX: def0deg,
        skewY: def0deg

    }

    Transform2d = prime({

        constructor: function(transform){

            var names = this.names = []
            var values = this.values = []

            transform.replace(/(\w+)\(([-.\d\s\w,]+)\)/g, function(match, name, value){
                names.push(name)
                values.push(value)
            })

        },

        identity: function(){
            var functions = []
            forEach(this.names, function(name){
                var fn = transforms[name]
                if (fn) functions.push(name + "(" + fn() + ")")
            })
            return functions.join(" ")
        },

        sameType: function(transformObject){
            return this.names.toString() === transformObject.names.toString()
        },

        // this is, basically, cheating.
        // retrieving the matrix value from the dom, rather than calculating it

        decompose: function(){
            var transform = this.toString()

            test.style.cssText = cssText + hyphenate(transformName) + ":" + transform + ";"
            document.body.appendChild(test)
            var m = compute(test)(transformName)
            if (!m || m === "none") m = "matrix(1, 0, 0, 1, 0, 0)"
            document.body.removeChild(test)
            return decomposeMatrix(m)
        }

    })

    Transform2d.prototype.toString = function(clean){
        var values = this.values, functions = []
        forEach(this.names, function(name, i){
            var fn = transforms[name]
            if (!fn) return
            var value = fn(values[i])
            if (!clean || value !== fn()) functions.push(name + "(" + value + ")")
        })
        return functions.length ? functions.join(" ") : "none"
    }

    Transform2d.union = function(from, to){

        if (from === to) return // nothing to do

        var fromMap, toMap

        if (from === "none"){

            toMap   = new Transform2d(to)
            to      = toMap.toString()
            from    = toMap.identity()
            fromMap = new Transform2d(from)

        } else if (to === "none"){

            fromMap = new Transform2d(from)
            from    = fromMap.toString()
            to      = fromMap.identity()
            toMap   = new Transform2d(to)

        } else {

            fromMap = new Transform2d(from)
            from    = fromMap.toString()
            toMap   = new Transform2d(to)
            to      = toMap.toString()

        }

        if (from === to) return // nothing to do

        if (!fromMap.sameType(toMap)){

            from = fromMap.decompose()
            to   = toMap.decompose()

        }

        if (from === to) return // nothing to do

        return [from, to]

    }

    // this parser makes sure it never gets "matrix"

    parseTransform2d = parsers.transform = function(transform){
        if (!transform || transform === "none") return "none"
        return new Transform2d(rMatrix.test(transform) ? decomposeMatrix(transform) : transform).toString(true)
    }

    // this getter makes sure we read from the dom only the first time
    // this way we save the actual transform and not "matrix"
    // setting matrix() will use parseTransform2d as well, thus setting the decomposed matrix

    getters.transform = function(){
        var s = this.style
        return s[transformName] || (s[transformName] = parseTransform2d(compute(this)(transformName)))
    }


})()/*:*/

// tries to match from and to values

var prepare = function(node, property, to){

    var parser = parsers[property] || parse,
        from   = getter(property).call(node), // "normalized" by the getter
        to     = parser(to, true) // normalize parsed property

    if (from === to) return

    if (parser === parseLength || parser === parseBorder || parser === parseShort4){

        var toAll = to.match(rgLength), i = 0 // this should always match something

        if (toAll) from = from.replace(rgLength, function(fromFull, fromValue, fromUnit){

            var toFull    = toAll[i++],
                toMatched = toFull.match(rLengthNum),
                toUnit    = toMatched[2]

            if (fromUnit !== toUnit){
                var fromPixels = (fromUnit === "px") ? fromValue : pixelRatio(node, fromUnit) * fromValue
                return round(fromPixels / pixelRatio(node, toUnit)) + toUnit
            }

            return fromFull

        })

        if (i > 0) setter(property).call(node, from)

    }/*(css3)?*/else if (parser === parseTransform2d){ // IE9/Opera

        return Transform2d.union(from, to)

    }/*:*/

    return (from !== to) ? [from, to] : null

}

// BrowserAnimation

var BrowserAnimation = prime({

    inherits: fx,

    constructor: function BrowserAnimation(node, property){

        var _getter = getter(property),
            _setter = setter(property)

        this.get = function(){
            return _getter.call(node)
        }

        this.set = function(value){
            return _setter.call(node, value)
        }

        BrowserAnimation.parent.constructor.call(this, this.set)

        this.node = node
        this.property = property

    }

})

var JSAnimation

/*(css3)?*/

JSAnimation = prime({

    inherits: BrowserAnimation,

    constructor: function JSAnimation(){
        return JSAnimation.parent.constructor.apply(this, arguments)
    },

    start: function(to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        var fromTo = prepare(this.node, this.property, to)

        if (!fromTo){
            this.cancel(to)
            return this
        }

        JSAnimation.parent.start.apply(this, fromTo)

        if (!this.cancelStep) return this

        // the animation would have started but we need additional checks

        var parser = parsers[this.property] || parse

        // complex interpolations JSAnimation can't handle
        // even CSS3 animation gracefully fail with some of those edge cases
        // other "simple" properties, such as `border` can have different templates
        // because of string properties like "solid" and "dashed"

        if ((parser === parseBoxShadow || parser === parseTextShadow || parser === parse) &&
            (this.templateFrom !== this.templateTo)){
                this.cancelStep()
                delete this.cancelStep
                this.cancel(to)
        }

        return this
    },

    parseEquation: function(equation){
        if (typeof equation === "string") return JSAnimation.parent.parseEquation.call(this, equation)
    }


})/*:*/

// CSSAnimation

var remove3 = function(value, a, b, c){
    var index = indexOf(a, value)
    if (index !== -1){
        a.splice(index, 1)
        b.splice(index, 1)
        c.splice(index, 1)
    }
}

var CSSAnimation = prime({

    inherits: BrowserAnimation,

    constructor: function CSSAnimation(node, property){
        CSSAnimation.parent.constructor.call(this, node, property)

        this.hproperty = hyphenate(aliases[property] || property)

        var self = this

        this.bSetTransitionCSS = function(time){
            self.setTransitionCSS(time)
        }

        this.bSetStyleCSS = function(time){
            self.setStyleCSS(time)
        }

        this.bComplete = function(){
            self.complete()
        }
    },

    start: function(to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        var fromTo = prepare(this.node, this.property, to)

        if (!fromTo){
            this.cancel(to)
            return this
        }

        this.to = fromTo[1]
        // setting transition styles immediately will make good browsers behave weirdly
        // because DOM changes are always deferred, so we requestFrame
        this.cancelSetTransitionCSS = requestFrame(this.bSetTransitionCSS)

        return this
    },

    setTransitionCSS: function(time){
        delete this.cancelSetTransitionCSS
        this.resetCSS(true)
        // firefox flickers if we set css for transition as well as styles at the same time
        // so, other than deferring transition styles we defer actual styles as well on a requestFrame
        this.cancelSetStyleCSS = requestFrame(this.bSetStyleCSS)
    },

    setStyleCSS: function(time){
        delete this.cancelSetStyleCSS
        var duration = this.duration
        // we use setTimeout instead of transitionEnd because some browsers (looking at you foxy)
        // incorrectly set event.propertyName, so we cannot check which animation we are canceling
        this.cancelComplete = setTimeout(this.bComplete, duration)
        this.endTime = time + duration
        this.set(this.to)
    },

    complete: function(){
        delete this.cancelComplete
        this.resetCSS()
        this.callback(this.endTime)
    },

    stop: function(hard){
        if (this.cancelExit){
            this.cancelExit()
            delete this.cancelExit
        } else if (this.cancelSetTransitionCSS){
            // if cancelSetTransitionCSS is set, means nothing is set yet
            this.cancelSetTransitionCSS() //so we cancel and we're good
            delete this.cancelSetTransitionCSS
        } else if (this.cancelSetStyleCSS){
            // if cancelSetStyleCSS is set, means transition css has been set, but no actual styles.
            this.cancelSetStyleCSS()
            delete this.cancelSetStyleCSS
            // if its a hard stop (and not another start on top of the current animation)
            // we need to reset the transition CSS
            if (hard) this.resetCSS()
        } else if (this.cancelComplete){
            // if cancelComplete is set, means style and transition css have been set, not yet completed.
            clearTimeout(this.cancelComplete)
            delete this.cancelComplete
            // if its a hard stop (and not another start on top of the current animation)
            // we need to reset the transition CSS set the current animation styles
            if (hard){
                this.resetCSS()
                this.set(this.get())
            }
        }
        return this
    },

    resetCSS: function(inclusive){
        var rules      = compute(this.node),
            properties = (rules(transitionName + "Property").replace(/\s+/g, "") || "all").split(","),
            durations  = (rules(transitionName + "Duration").replace(/\s+/g, "") || "0s").split(","),
            equations  = (rules(transitionName + "TimingFunction").replace(/\s+/g, "") || "ease").match(/cubic-bezier\([\d-.,]+\)|([a-z-]+)/g)

        remove3("all",          properties, durations, equations)
        remove3(this.hproperty, properties, durations, equations)

        if (inclusive){
            properties.push(this.hproperty)
            durations.push(this.duration + "ms")
            equations.push("cubic-bezier(" + this.equation + ")")
        }

        var nodeStyle = this.node.style

        nodeStyle[transitionName + "Property"]       = properties
        nodeStyle[transitionName + "Duration"]       = durations
        nodeStyle[transitionName + "TimingFunction"] = equations
    },

    parseEquation: function(equation){
        if (typeof equation === "string") return CSSAnimation.parent.parseEquation.call(this, equation, true)
    }

})

// elements methods

var BaseAnimation = transitionName ? CSSAnimation : JSAnimation

var moofx = function(x, y){
    return (typeof x === "function") ? fx(x) : elements(x, y)
}

elements.implement({

    // {properties}, options or
    // property, value options
    animate: function(A, B, C){

        var styles = A, options = B

        if (typeof A === "string"){
            styles = {}
            styles[A] = B
            options = C
        }

        if (options == null) options = {}

        var type = typeof options

        options = type === "function" ? {
            callback: options
        } : (type === "string" || type === "number") ? {
            duration: options
        } : options

        var callback  = options.callback || function(){},
            completed = 0,
            length    = 0

        options.callback = function(t){
            if (++completed === length) callback(t)
        }

        for (var property in styles){

            var value    = styles[property],
                property = camelize(property)

            this.forEach(function(node){
                length++
                var self = elements(node), anims = self._animations || (self._animations = {})
                var anim  = anims[property] || (anims[property] = new BaseAnimation(node, property))
                anim.setOptions(options).start(value)
            })
        }

        return this

    },

    // {properties} or
    // property, value
    style: function(A, B){

        var styles = A

        if (typeof A === "string"){
            styles = {}
            styles[A] = B
        }

        for (var property in styles){
            var value = styles[property],
                set   = setter(property = camelize(property))

            this.forEach(function(node){
                var self = elements(node), anims = self._animations, anim
                if (anims && (anim = anims[property])) anim.stop(true)
                set.call(node, value)
            })
        }

        return this

    },

    compute: function(property){

        property = camelize(property)
        var node = this[0]

        // return default matrix for transform, instead of parsed (for consistency)

        if (property === "transform" && parseTransform2d) return compute(node)(transformName)

        var value = getter(property).call(node)

        // unit conversion to `px`

        return (value != null) ? value.replace(rgLength, function(match, value, unit){
            return (unit === "px") ? match : pixelRatio(node, unit) * value + "px"
        }) : ''

    }

})

moofx.parse = function(property, value, normalize){
    return (parsers[camelize(property)] || parse)(value, normalize)
}

module.exports = moofx

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./color":138,"./frame":139,"./fx":140,"./unmatrix2d":141,"elements":142,"prime":149,"prime/array/forEach":145,"prime/array/indexOf":146,"prime/array/map":147,"prime/string/camelize":156,"prime/string/capitalize":157,"prime/string/clean":158,"prime/string/hyphenate":159}],138:[function(require,module,exports){
/*
color
*/"use strict"

var colors = {
    maroon      : "#800000",
    red         : "#ff0000",
    orange      : "#ffA500",
    yellow      : "#ffff00",
    olive       : "#808000",
    purple      : "#800080",
    fuchsia     : "#ff00ff",
    white       : "#ffffff",
    lime        : "#00ff00",
    green       : "#008000",
    navy        : "#000080",
    blue        : "#0000ff",
    aqua        : "#00ffff",
    teal        : "#008080",
    black       : "#000000",
    silver      : "#c0c0c0",
    gray        : "#808080",
    transparent : "#0000"
}

var RGBtoRGB = function(r, g, b, a){
    if (a == null || a === "") a = 1
    r = parseFloat(r)
    g = parseFloat(g)
    b = parseFloat(b)
    a = parseFloat(a)
    if (!(r <= 255 && r >= 0 && g <= 255 && g >= 0 && b <= 255 && b >= 0 && a <= 1 && a >= 0)) return null

    return [Math.round(r), Math.round(g), Math.round(b), a]
}

var HEXtoRGB = function(hex){
    if (hex.length === 3) hex += "f"
    if (hex.length === 4){
        var h0 = hex.charAt(0),
            h1 = hex.charAt(1),
            h2 = hex.charAt(2),
            h3 = hex.charAt(3)

        hex = h0 + h0 + h1 + h1 + h2 + h2 + h3 + h3
    }
    if (hex.length === 6) hex += "ff"
    var rgb = []
    for (var i = 0, l = hex.length; i < l; i += 2) rgb.push(parseInt(hex.substr(i, 2), 16) / (i === 6 ? 255 : 1))
    return rgb
}

// HSL to RGB conversion from:
// http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript
// thank you!

var HUEtoRGB = function(p, q, t){
    if (t < 0) t += 1
    if (t > 1) t -= 1
    if (t < 1 / 6) return p + (q - p) * 6 * t
    if (t < 1 / 2) return q
    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6
    return p
}

var HSLtoRGB = function(h, s, l, a){
    var r, b, g
    if (a == null || a === "") a = 1
    h = parseFloat(h) / 360
    s = parseFloat(s) / 100
    l = parseFloat(l) / 100
    a = parseFloat(a) / 1
    if (h > 1 || h < 0 || s > 1 || s < 0 || l > 1 || l < 0 || a > 1 || a < 0) return null
    if (s === 0){
        r = b = g = l
    } else {
        var q = l < 0.5 ? l * (1 + s) : l + s - l * s
        var p = 2 * l - q
        r = HUEtoRGB(p, q, h + 1 / 3)
        g = HUEtoRGB(p, q, h)
        b = HUEtoRGB(p, q, h - 1 / 3)
    }
    return [r * 255, g * 255, b * 255, a]
}

var keys = []
for (var c in colors) keys.push(c)

var shex  = "(?:#([a-f0-9]{3,8}))",
    sval  = "\\s*([.\\d%]+)\\s*",
    sop   = "(?:,\\s*([.\\d]+)\\s*)?",
    slist = "\\(" + [sval, sval, sval] + sop + "\\)",
    srgb  = "(?:rgb)a?",
    shsl  = "(?:hsl)a?",
    skeys = "(" + keys.join("|") + ")"


var xhex   = RegExp(shex, "i"),
    xrgb   = RegExp(srgb + slist, "i"),
    xhsl   = RegExp(shsl + slist, "i")

var color = function(input, array){
    if (input == null) return null
    input = (input + "").replace(/\s+/, "")

    var match = colors[input]
    if (match){
        return color(match, array)
    } else if (match = input.match(xhex)){
        input = HEXtoRGB(match[1])
    } else if (match = input.match(xrgb)){
        input = match.slice(1)
    } else if (match = input.match(xhsl)){
        input = HSLtoRGB.apply(null, match.slice(1))
    } else return null

    if (!(input && (input = RGBtoRGB.apply(null, input)))) return null
    if (array) return input
    if (input[3] === 1) input.splice(3, 1)
    return "rgb" + (input.length === 4 ? "a" : "") + "(" + input + ")"
}

color.x = RegExp([skeys, shex, srgb + slist, shsl + slist].join("|"), "gi")

module.exports = color

},{}],139:[function(require,module,exports){
(function (global){
/*
requestFrame / cancelFrame
*/"use strict"

var indexOf = require("prime/array/indexOf")

var requestFrame = global.requestAnimationFrame ||
                   global.webkitRequestAnimationFrame ||
                   global.mozRequestAnimationFrame ||
                   global.oRequestAnimationFrame ||
                   global.msRequestAnimationFrame ||
                   function(callback){
                       return setTimeout(function(){
                           callback()
                       }, 1e3 / 60)
                   }

var callbacks = []

var iterator = function(time){
    var split = callbacks.splice(0, callbacks.length)
    for (var i = 0, l = split.length; i < l; i++) split[i](time || (time = +(new Date)))
}

var cancel = function(callback){
    var io = indexOf(callbacks, callback)
    if (io > -1) callbacks.splice(io, 1)
}

var request = function(callback){
    var i = callbacks.push(callback)
    if (i === 1) requestFrame(iterator)
    return function(){
        cancel(callback)
    }
}

exports.request = request
exports.cancel = cancel

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"prime/array/indexOf":146}],140:[function(require,module,exports){
/*
fx
*/"use strict"

var prime        = require("prime"),
    requestFrame = require("./frame").request,
    bezier       = require("cubic-bezier")

var map = require("prime/array/map")

var sDuration    = "([\\d.]+)(s|ms)?",
    sCubicBezier = "cubic-bezier\\(([-.\\d]+),([-.\\d]+),([-.\\d]+),([-.\\d]+)\\)"

var rDuration     = RegExp(sDuration),
    rCubicBezier  = RegExp(sCubicBezier),
    rgCubicBezier = RegExp(sCubicBezier, "g")

    // equations collection

var equations = {
    "default"     : "cubic-bezier(0.25, 0.1, 0.25, 1.0)",
    "linear"      : "cubic-bezier(0, 0, 1, 1)",
    "ease-in"     : "cubic-bezier(0.42, 0, 1.0, 1.0)",
    "ease-out"    : "cubic-bezier(0, 0, 0.58, 1.0)",
    "ease-in-out" : "cubic-bezier(0.42, 0, 0.58, 1.0)"
}

equations.ease = equations["default"]

var compute = function(from, to, delta){
    return (to - from) * delta + from
}

var divide = function(string){
    var numbers = []
    var template = (string + "").replace(/[-.\d]+/g, function(number){
        numbers.push(+number)
        return "@"
    })
    return [numbers, template]
}

var Fx = prime({

    constructor: function Fx(render, options){

        // set options

        this.setOptions(options)

        // renderer

        this.render = render || function(){}

        // bound functions

        var self = this

        this.bStep = function(t){
            return self.step(t)
        }

        this.bExit = function(time){
            self.exit(time)
        }

    },

    setOptions: function(options){
        if (options == null) options = {}

        if (!(this.duration = this.parseDuration(options.duration || "500ms"))) throw new Error("invalid duration")
        if (!(this.equation = this.parseEquation(options.equation || "default"))) throw new Error("invalid equation")
        this.callback = options.callback || function(){}

        return this
    },

    parseDuration: function(duration){
        if (duration = (duration + "").match(rDuration)){
            var time = +duration[1],
                unit = duration[2] || "ms"

            if (unit === "s")  return time * 1e3
            if (unit === "ms") return time
        }
    },

    parseEquation: function(equation, array){
        var type = typeof equation

        if (type === "function"){ // function
            return equation
        } else if (type === "string"){ // cubic-bezier string
            equation = equations[equation] || equation
            var match = equation.replace(/\s+/g, "").match(rCubicBezier)
            if (match){
                equation = map(match.slice(1), function(v){return +v})
                if (array) return equation
                if (equation.toString() === "0,0,1,1") return function(x){return x}
                type = "object"
            }
        }

        if (type === "object"){ // array
            return bezier(equation[0], equation[1], equation[2], equation[3], 1e3 / 60 / this.duration / 4)
        }
    },

    cancel: function(to){
        this.to = to
        this.cancelExit = requestFrame(this.bExit)
    },

    exit: function(time){
        this.render(this.to)
        delete this.cancelExit
        this.callback(time)
    },

    start: function(from, to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        this.isArray = false
        this.isNumber = false

        var fromType = typeof from,
            toType   = typeof to

        if (fromType === "object" && toType === "object"){
            this.isArray = true
        } else if (fromType === "number" && toType === "number"){
            this.isNumber = true
        }

        var from_ = divide(from),
            to_   = divide(to)

        this.from = from_[0]
        this.to = to_[0]
        this.templateFrom = from_[1]
        this.templateTo = to_[1]

        if (this.from.length !== this.to.length || this.from.toString() === this.to.toString()){
            this.cancel(to)
            return this
        }

        delete this.time
        this.length = this.from.length
        this.cancelStep = requestFrame(this.bStep)

        return this

    },

    stop: function(){

        if (this.cancelExit){
            this.cancelExit()
            delete this.cancelExit
        } else if (this.cancelStep){
            this.cancelStep()
            delete this.cancelStep
        }

        return this
    },

    step: function(now){

        this.time || (this.time = now)

        var factor = (now - this.time) / this.duration

        if (factor > 1) factor = 1

        var delta = this.equation(factor),
            from  = this.from,
            to    = this.to,
            tpl   = this.templateTo

        for (var i = 0, l = this.length; i < l; i++){
            var f = from[i], t = to[i]
            tpl = tpl.replace("@", t !== f ? compute(f, t, delta) : t)
        }

        this.render(this.isArray ? tpl.split(",") : this.isNumber ? +tpl : tpl, factor)

        if (factor !== 1){
            this.cancelStep = requestFrame(this.bStep)
        } else {
            delete this.cancelStep
            this.callback(now)
        }

    }

})

var fx = function(render){

    var ffx = new Fx(render)

    return {

        start: function(from, to, options){
            var type = typeof options
            ffx.setOptions((type === "function") ? {
                callback: options
            } : (type === "string" || type === "number") ? {
                duration: options
            } : options).start(from, to)
            return this
        },

        stop: function(){
            ffx.stop()
            return this
        }

    }

}

fx.prototype = Fx.prototype

module.exports = fx

},{"./frame":139,"cubic-bezier":103,"prime":149,"prime/array/map":147}],141:[function(require,module,exports){
/*
Unmatrix 2d
 - a crude implementation of the slightly bugged pseudo code in http://www.w3.org/TR/css3-2d-transforms/#matrix-decomposition
*/"use strict"

// returns the length of the passed vector

var length = function(a){
    return Math.sqrt(a[0] * a[0] + a[1] * a[1])
}

// normalizes the length of the passed point to 1

var normalize = function(a){
    var l = length(a)
    return l ? [a[0] / l, a[1] / l] : [0, 0]
}

// returns the dot product of the passed points

var dot = function(a, b){
    return a[0] * b[0] + a[1] * b[1]
}

// returns the principal value of the arc tangent of
// y/x, using the signs of both arguments to determine
// the quadrant of the return value

var atan2 = Math.atan2

var combine = function(a, b, ascl, bscl){
    return [
        (ascl * a[0]) + (bscl * b[0]),
        (ascl * a[1]) + (bscl * b[1])
    ]
}

module.exports = function(a, b, c, d, tx, ty){

    // Make sure the matrix is invertible

    if ((a * d - b * c) === 0) return false

    // Take care of translation

    var translate = [tx, ty]

    // Put the components into a 2x2 matrix

    var m = [[a, b], [c, d]]

    // Compute X scale factor and normalize first row.

    var scale = [length(m[0])]
    m[0] = normalize(m[0])

    // Compute shear factor and make 2nd row orthogonal to 1st.

    var skew = dot(m[0], m[1])
    m[1] = combine(m[1], m[0], 1, -skew)

    // Now, compute Y scale and normalize 2nd row.

    scale[1] = length(m[1])
    // m[1] = normalize(m[1]) //
    skew /= scale[1]

    // Now, get the rotation out

    var rotate = atan2(m[0][1], m[0][0])

    return [translate, rotate, skew, scale]

}

},{}],142:[function(require,module,exports){
(function (global){
/*
elements
*/"use strict"

var prime   = require("prime"),
    forEach = require("prime/array/forEach"),
    map     = require("prime/array/map"),
    filter  = require("prime/array/filter"),
    every   = require("prime/array/every"),
    some    = require("prime/array/some")

// uniqueID

var uniqueIndex = 0
var uniqueID = function(n){
    return (n === global) ? "global" : n.uniqueNumber || (n.uniqueNumber = "n:" + (uniqueIndex++).toString(36))
}

var instances = {}

// elements prime

var $ = prime({constructor: function $(n, context){

    if (n == null) return (this && this.constructor === $) ? new elements : null

    var self = n

    if (n.constructor !== elements){

        self = new elements

        var uid

        if (typeof n === "string"){
            if (!self.search) return null
            self[self.length++] = context || document
            return self.search(n)
        }

        if (n.nodeType || n === global){

            self[self.length++] = n

        } else if (n.length){

            // this could be an array, or any object with a length attribute,
            // including another instance of elements from another interface.

            var uniques = {}

            for (var i = 0, l = n.length; i < l; i++){ // perform elements flattening
                var nodes = $(n[i], context)
                if (nodes && nodes.length) for (var j = 0, k = nodes.length; j < k; j++){
                    var node = nodes[j]
                    uid = uniqueID(node)
                    if (!uniques[uid]){
                        self[self.length++] = node
                        uniques[uid] = true
                    }
                }
            }

        }

    }

    if (!self.length) return null

    // when length is 1 always use the same elements instance

    if (self.length === 1){
        uid = uniqueID(self[0])
        return instances[uid] || (instances[uid] = self)
    }

    return self

}})

var elements = prime({

    inherits: $,

    constructor: function elements(){
        this.length = 0
    },

    unlink: function(){
        return this.map(function(node, i){
            delete instances[uniqueID(node)]
            return node
        })
    },

    // straight es5 prototypes (or emulated methods)

    forEach: function(method, context){
        return forEach(this, method, context);
    },

    map: function(method, context){
        return map(this, method, context);
    },

    filter: function(method, context){
        return filter(this, method, context);
    },

    every: function(method, context){
        return every(this, method, context);
    },

    some: function(method, context){
        return some(this, method, context);
    }

})

module.exports = $

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"prime":149,"prime/array/every":143,"prime/array/filter":144,"prime/array/forEach":145,"prime/array/map":147,"prime/array/some":148}],143:[function(require,module,exports){
/*
array:every
*/"use strict"

var every = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (!method.call(context, self[i], i, self)) return false
    }
    return true
}

module.exports = every

},{}],144:[function(require,module,exports){
/*
array:filter
*/"use strict"

var filter = function(self, method, context){
    var results = []
    for (var i = 0, l = self.length >>> 0; i < l; i++) {
        var value = self[i]
        if (method.call(context, value, i, self)) results.push(value)
    }
    return results
}

module.exports = filter

},{}],145:[function(require,module,exports){
/*
array:forEach
*/"use strict"

var forEach = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (method.call(context, self[i], i, self) === false) break
    }
    return self
}

module.exports = forEach

},{}],146:[function(require,module,exports){
/*
array:indexOf
*/"use strict"

var indexOf = function(self, item, from){
    for (var l = self.length >>> 0, i = (from < 0) ? Math.max(0, l + from) : from || 0; i < l; i++){
        if (self[i] === item) return i
    }
    return -1
}

module.exports = indexOf

},{}],147:[function(require,module,exports){
/*
array:map
*/"use strict"

var map = function(self, method, context){
    var length = self.length >>> 0, results = Array(length)
    for (var i = 0, l = length; i < l; i++){
        results[i] = method.call(context, self[i], i, self)
    }
    return results
}

module.exports = map

},{}],148:[function(require,module,exports){
/*
array:some
*/"use strict"

var some = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (method.call(context, self[i], i, self)) return true
    }
    return false
}

module.exports = some

},{}],149:[function(require,module,exports){
/*
prime
 - prototypal inheritance
*/"use strict"

var hasOwn = require("./object/hasOwn"),
    forIn  = require("./object/forIn"),
    mixIn  = require("./object/mixIn"),
    filter = require("./object/filter"),
    create = require("./object/create"),
    type   = require("./type")

var defineProperty           = Object.defineProperty,
    getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor

try {
    defineProperty({}, "~", {})
    getOwnPropertyDescriptor({}, "~")
} catch (e){
    defineProperty = null
    getOwnPropertyDescriptor = null
}

var define = function(value, key, from){
    defineProperty(this, key, getOwnPropertyDescriptor(from, key) || {
        writable: true,
        enumerable: true,
        configurable: true,
        value: value
    })
}

var copy = function(value, key){
    this[key] = value
}

var implement = function(proto){
    forIn(proto, defineProperty ? define : copy, this.prototype)
    return this
}

var verbs = /^constructor|inherits|mixin$/

var prime = function(proto){

    if (type(proto) === "function") proto = {constructor: proto}

    var superprime = proto.inherits

    // if our nice proto object has no own constructor property
    // then we proceed using a ghosting constructor that all it does is
    // call the parent's constructor if it has a superprime, else an empty constructor
    // proto.constructor becomes the effective constructor
    var constructor = (hasOwn(proto, "constructor")) ? proto.constructor : (superprime) ? function(){
        return superprime.apply(this, arguments)
    } : function(){}

    if (superprime){

        mixIn(constructor, superprime)

        var superproto = superprime.prototype
        // inherit from superprime
        var cproto = constructor.prototype = create(superproto)

        // setting constructor.parent to superprime.prototype
        // because it's the shortest possible absolute reference
        constructor.parent = superproto
        cproto.constructor = constructor
    }

    if (!constructor.implement) constructor.implement = implement

    var mixins = proto.mixin
    if (mixins){
        if (type(mixins) !== "array") mixins = [mixins]
        for (var i = 0; i < mixins.length; i++) constructor.implement(create(mixins[i].prototype))
    }

    // implement proto and return constructor
    return constructor.implement(filter(proto, function(value, key){
        return !key.match(verbs)
    }))

}

module.exports = prime

},{"./object/create":150,"./object/filter":151,"./object/forIn":152,"./object/hasOwn":154,"./object/mixIn":155,"./type":161}],150:[function(require,module,exports){
/*
object:create
*/"use strict"

var create = function(self){
    var constructor = function(){}
    constructor.prototype = self
    return new constructor
}

module.exports = create

},{}],151:[function(require,module,exports){
/*
object:filter
*/"use strict"

var forIn = require("./forIn")

var filter = function(self, method, context){
    var results = {}
    forIn(self, function(value, key){
        if (method.call(context, value, key, self)) results[key] = value
    })
    return results
}

module.exports = filter

},{"./forIn":152}],152:[function(require,module,exports){
/*
object:forIn
*/"use strict"

var has = require("./hasOwn")

var forIn = function(self, method, context){
    for (var key in self) if (method.call(context, self[key], key, self) === false) break
    return self
}

if (!({valueOf: 0}).propertyIsEnumerable("valueOf")){ // fix for stupid IE enumeration bug

    var buggy = "constructor,toString,valueOf,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString".split(",")
    var proto = Object.prototype

    forIn = function(self, method, context){
        for (var key in self) if (method.call(context, self[key], key, self) === false) return self
        for (var i = 0; key = buggy[i]; i++){
            var value = self[key]
            if ((value !== proto[key] || has(self, key)) && method.call(context, value, key, self) === false) break
        }
        return self
    }

}

module.exports = forIn

},{"./hasOwn":154}],153:[function(require,module,exports){
/*
object:forOwn
*/"use strict"

var forIn  = require("./forIn"),
    hasOwn = require("./hasOwn")

var forOwn = function(self, method, context){
    forIn(self, function(value, key){
        if (hasOwn(self, key)) return method.call(context, value, key, self)
    })
    return self
}

module.exports = forOwn

},{"./forIn":152,"./hasOwn":154}],154:[function(require,module,exports){
/*
object:hasOwn
*/"use strict"

var hasOwnProperty = Object.hasOwnProperty

var hasOwn = function(self, key){
    return hasOwnProperty.call(self, key)
}

module.exports = hasOwn

},{}],155:[function(require,module,exports){
/*
object:mixIn
*/"use strict"

var forOwn = require("./forOwn")

var copy = function(value, key){
    this[key] = value
}

var mixIn = function(self){
    for (var i = 1, l = arguments.length; i < l; i++) forOwn(arguments[i], copy, self)
    return self
}

module.exports = mixIn

},{"./forOwn":153}],156:[function(require,module,exports){
/*
string:camelize
*/"use strict"

var camelize = function(self){
    return (self + "").replace(/-\D/g, function(match){
        return match.charAt(1).toUpperCase()
    })
}

module.exports = camelize

},{}],157:[function(require,module,exports){
/*
string:capitalize
*/"use strict"

var capitalize = function(self){
    return (self + "").replace(/\b[a-z]/g, function(match){
        return match.toUpperCase()
    })
}

module.exports = capitalize

},{}],158:[function(require,module,exports){
/*
string:clean
*/"use strict"

var trim = require("./trim")

var clean = function(self){
    return trim((self + "").replace(/\s+/g, " "))
}

module.exports = clean

},{"./trim":160}],159:[function(require,module,exports){
/*
string:hyphenate
*/"use strict"

var hyphenate = function(self){
    return (self + "").replace(/[A-Z]/g, function(match){
        return '-' + match.toLowerCase()
    })
}

module.exports = hyphenate

},{}],160:[function(require,module,exports){
/*
string:trim
*/"use strict"

var trim = function(self){
    return (self + "").replace(/^\s+|\s+$/g, "")
}

module.exports = trim

},{}],161:[function(require,module,exports){
/*
type
*/"use strict"

var toString = Object.prototype.toString,
    types = /number|object|array|string|function|date|regexp|boolean/

var type = function(object){
    if (object == null) return "null"
    var string = toString.call(object).slice(8, -1).toLowerCase()
    if (string === "number" && isNaN(object)) return "null"
    if (types.test(string)) return string
    return "object"
}

module.exports = type

},{}],162:[function(require,module,exports){


    /**
     * Appends an array to the end of another.
     * The first array will be modified.
     */
    function append(arr1, arr2) {
        if (arr2 == null) {
            return arr1;
        }

        var pad = arr1.length,
            i = -1,
            len = arr2.length;
        while (++i < len) {
            arr1[pad + i] = arr2[i];
        }
        return arr1;
    }
    module.exports = append;


},{}],163:[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Combines an array with all the items of another.
     * Does not allow duplicates and is case and type sensitive.
     */
    function combine(arr1, arr2) {
        if (arr2 == null) {
            return arr1;
        }

        var i = -1, len = arr2.length;
        while (++i < len) {
            if (indexOf(arr1, arr2[i]) === -1) {
                arr1.push(arr2[i]);
            }
        }

        return arr1;
    }
    module.exports = combine;


},{"./indexOf":173}],164:[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * If array contains values.
     */
    function contains(arr, val) {
        return indexOf(arr, val) !== -1;
    }
    module.exports = contains;


},{"./indexOf":173}],165:[function(require,module,exports){
var unique = require('./unique');
var filter = require('./filter');
var some = require('./some');
var contains = require('./contains');
var slice = require('./slice');


    /**
     * Return a new Array with elements that aren't present in the other Arrays.
     */
    function difference(arr) {
        var arrs = slice(arguments, 1),
            result = filter(unique(arr), function(needle){
                return !some(arrs, function(haystack){
                    return contains(haystack, needle);
                });
            });
        return result;
    }

    module.exports = difference;



},{"./contains":164,"./filter":168,"./slice":181,"./some":182,"./unique":184}],166:[function(require,module,exports){
var is = require('../lang/is');
var isArray = require('../lang/isArray');
var every = require('./every');

    /**
     * Compares if both arrays have the same elements
     */
    function equals(a, b, callback){
        callback = callback || is;

        if (!isArray(a) || !isArray(b)) {
            return callback(a, b);
        }

        if (a.length !== b.length) {
            return false;
        }

        return every(a, makeCompare(callback), b);
    }

    function makeCompare(callback) {
        return function(value, i) {
            return i in this && callback(value, this[i]);
        };
    }

    module.exports = equals;



},{"../lang/is":200,"../lang/isArray":201,"./every":167}],167:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"../function/makeIterator_":193,"dup":113}],168:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"../function/makeIterator_":193,"dup":114}],169:[function(require,module,exports){
var findIndex = require('./findIndex');

    /**
     * Returns first item that matches criteria
     */
    function find(arr, iterator, thisObj){
        var idx = findIndex(arr, iterator, thisObj);
        return idx >= 0? arr[idx] : void(0);
    }

    module.exports = find;



},{"./findIndex":170}],170:[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Returns the index of the first item that matches criteria
     */
    function findIndex(arr, iterator, thisObj){
        iterator = makeIterator(iterator, thisObj);
        if (arr == null) {
            return -1;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            if (iterator(arr[i], i, arr)) {
                return i;
            }
        }

        return -1;
    }

    module.exports = findIndex;


},{"../function/makeIterator_":193}],171:[function(require,module,exports){
var isArray = require('../lang/isArray');
var append = require('./append');

    /*
     * Helper function to flatten to a destination array.
     * Used to remove the need to create intermediate arrays while flattening.
     */
    function flattenTo(arr, result, level) {
        if (level === 0) {
            append(result, arr);
            return result;
        }

        var value,
            i = -1,
            len = arr.length;
        while (++i < len) {
            value = arr[i];
            if (isArray(value)) {
                flattenTo(value, result, level - 1);
            } else {
                result.push(value);
            }
        }
        return result;
    }

    /**
     * Recursively flattens an array.
     * A new array containing all the elements is returned.
     * If level is specified, it will only flatten up to that level.
     */
    function flatten(arr, level) {
        if (arr == null) {
            return [];
        }

        level = level == null ? -1 : level;
        return flattenTo(arr, [], level);
    }

    module.exports = flatten;




},{"../lang/isArray":201,"./append":162}],172:[function(require,module,exports){
arguments[4][79][0].apply(exports,arguments)
},{"dup":79}],173:[function(require,module,exports){
arguments[4][80][0].apply(exports,arguments)
},{"dup":80}],174:[function(require,module,exports){
var difference = require('./difference');
var slice = require('./slice');

    /**
     * Insert item into array if not already present.
     */
    function insert(arr, rest_items) {
        var diff = difference(slice(arguments, 1), arr);
        if (diff.length) {
            Array.prototype.push.apply(arr, diff);
        }
        return arr.length;
    }
    module.exports = insert;


},{"./difference":165,"./slice":181}],175:[function(require,module,exports){
var unique = require('./unique');
var filter = require('./filter');
var every = require('./every');
var contains = require('./contains');
var slice = require('./slice');


    /**
     * Return a new Array with elements common to all Arrays.
     * - based on underscore.js implementation
     */
    function intersection(arr) {
        var arrs = slice(arguments, 1),
            result = filter(unique(arr), function(needle){
                return every(arrs, function(haystack){
                    return contains(haystack, needle);
                });
            });
        return result;
    }

    module.exports = intersection;



},{"./contains":164,"./every":167,"./filter":168,"./slice":181,"./unique":184}],176:[function(require,module,exports){
var slice = require('./slice');

    /**
     * Call `methodName` on each item of the array passing custom arguments if
     * needed.
     */
    function invoke(arr, methodName, var_args){
        if (arr == null) {
            return arr;
        }

        var args = slice(arguments, 2);
        var i = -1, len = arr.length, value;
        while (++i < len) {
            value = arr[i];
            value[methodName].apply(value, args);
        }

        return arr;
    }

    module.exports = invoke;


},{"./slice":181}],177:[function(require,module,exports){


    /**
     * Returns last element of array.
     */
    function last(arr){
        if (arr == null || arr.length < 1) {
            return undefined;
        }

        return arr[arr.length - 1];
    }

    module.exports = last;



},{}],178:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"../function/makeIterator_":193,"dup":117}],179:[function(require,module,exports){
arguments[4][81][0].apply(exports,arguments)
},{"./indexOf":173,"dup":81}],180:[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Remove all instances of an item from array.
     */
    function removeAll(arr, item){
        var idx = indexOf(arr, item);
        while (idx !== -1) {
            arr.splice(idx, 1);
            idx = indexOf(arr, item, idx);
        }
    }

    module.exports = removeAll;


},{"./indexOf":173}],181:[function(require,module,exports){


    /**
     * Create slice of source array or array-like object
     */
    function slice(arr, start, end){
        var len = arr.length;

        if (start == null) {
            start = 0;
        } else if (start < 0) {
            start = Math.max(len + start, 0);
        } else {
            start = Math.min(start, len);
        }

        if (end == null) {
            end = len;
        } else if (end < 0) {
            end = Math.max(len + end, 0);
        } else {
            end = Math.min(end, len);
        }

        var result = [];
        while (start < end) {
            result.push(arr[start++]);
        }

        return result;
    }

    module.exports = slice;



},{}],182:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"../function/makeIterator_":193,"dup":118}],183:[function(require,module,exports){


    /**
     * Split array into a fixed number of segments.
     */
    function split(array, segments) {
        segments = segments || 2;
        var results = [];
        if (array == null) {
            return results;
        }

        var minLength = Math.floor(array.length / segments),
            remainder = array.length % segments,
            i = 0,
            len = array.length,
            segmentIndex = 0,
            segmentLength;

        while (i < len) {
            segmentLength = minLength;
            if (segmentIndex < remainder) {
                segmentLength++;
            }

            results.push(array.slice(i, i + segmentLength));

            segmentIndex++;
            i += segmentLength;
        }

        return results;
    }
    module.exports = split;


},{}],184:[function(require,module,exports){
var filter = require('./filter');

    /**
     * @return {array} Array of unique items
     */
    function unique(arr, compare){
        compare = compare || isEqual;
        return filter(arr, function(item, i, arr){
            var n = arr.length;
            while (++i < n) {
                if ( compare(item, arr[i]) ) {
                    return false;
                }
            }
            return true;
        });
    }

    function isEqual(a, b){
        return a === b;
    }

    module.exports = unique;



},{"./filter":168}],185:[function(require,module,exports){
var make = require('./make_');
var arrContains = require('../array/contains');
var objContains = require('../object/contains');

    /**
     */
    module.exports = make(arrContains, objContains);



},{"../array/contains":164,"../object/contains":222,"./make_":188}],186:[function(require,module,exports){
var make = require('./make_');
var arrFind = require('../array/find');
var objFind = require('../object/find');

    /**
     * Find value that returns true on iterator check.
     */
    module.exports = make(arrFind, objFind);



},{"../array/find":169,"../object/find":228,"./make_":188}],187:[function(require,module,exports){
var make = require('./make_');
var arrForEach = require('../array/forEach');
var objForEach = require('../object/forOwn');

    /**
     */
    module.exports = make(arrForEach, objForEach);



},{"../array/forEach":172,"../object/forOwn":230,"./make_":188}],188:[function(require,module,exports){
var slice = require('../array/slice');

    /**
     * internal method used to create other collection modules.
     */
    function makeCollectionMethod(arrMethod, objMethod, defaultReturn) {
        return function(){
            var args = slice(arguments);
            if (args[0] == null) {
                return defaultReturn;
            }
            // array-like is treated as array
            return (typeof args[0].length === 'number')? arrMethod.apply(null, args) : objMethod.apply(null, args);
        };
    }

    module.exports = makeCollectionMethod;



},{"../array/slice":181}],189:[function(require,module,exports){
var isArray = require('../lang/isArray');
var objSize = require('../object/size');

    /**
     * Get collection size
     */
    function size(list) {
        if (!list) {
            return 0;
        }
        if (isArray(list)) {
            return list.length;
        }
        return objSize(list);
    }

    module.exports = size;



},{"../lang/isArray":201,"../object/size":240}],190:[function(require,module,exports){
var slice = require('../array/slice');

    /**
     * Return a function that will execute in the given context, optionally adding any additional supplied parameters to the beginning of the arguments collection.
     * @param {Function} fn  Function.
     * @param {object} context   Execution context.
     * @param {rest} args    Arguments (0...n arguments).
     * @return {Function} Wrapped Function.
     */
    function bind(fn, context, args){
        var argsArr = slice(arguments, 2); //curried args
        return function(){
            return fn.apply(context, argsArr.concat(slice(arguments)));
        };
    }

    module.exports = bind;



},{"../array/slice":181}],191:[function(require,module,exports){


    /**
     * Debounce callback execution
     */
    function debounce(fn, threshold, isAsap){
        var timeout, result;
        function debounced(){
            var args = arguments, context = this;
            function delayed(){
                if (! isAsap) {
                    result = fn.apply(context, args);
                }
                timeout = null;
            }
            if (timeout) {
                clearTimeout(timeout);
            } else if (isAsap) {
                result = fn.apply(context, args);
            }
            timeout = setTimeout(delayed, threshold);
            return result;
        }
        debounced.cancel = function(){
            clearTimeout(timeout);
        };
        return debounced;
    }

    module.exports = debounce;



},{}],192:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"dup":119}],193:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"../object/deepMatches":224,"./identity":192,"./prop":194,"dup":120}],194:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"dup":121}],195:[function(require,module,exports){


    /**
     * Returns a function that will execute a list of functions in sequence
     * passing the same arguments to each one. (useful for batch processing
     * items during a forEach loop)
     */
    function series(){
        var fns = arguments;
        return function(){
            var i = 0,
                n = fns.length;
            while (i < n) {
                fns[i].apply(this, arguments);
                i += 1;
            }
        };
    }

    module.exports = series;



},{}],196:[function(require,module,exports){


    // Reference to the global context (works on ES3 and ES5-strict mode)
    //jshint -W061, -W064
    module.exports = Function('return this')();



},{}],197:[function(require,module,exports){
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');
var mixIn = require('../object/mixIn');

    /**
     * Clone native types.
     */
    function clone(val){
        switch (kindOf(val)) {
            case 'Object':
                return cloneObject(val);
            case 'Array':
                return cloneArray(val);
            case 'RegExp':
                return cloneRegExp(val);
            case 'Date':
                return cloneDate(val);
            default:
                return val;
        }
    }

    function cloneObject(source) {
        if (isPlainObject(source)) {
            return mixIn({}, source);
        } else {
            return source;
        }
    }

    function cloneRegExp(r) {
        var flags = '';
        flags += r.multiline ? 'm' : '';
        flags += r.global ? 'g' : '';
        flags += r.ignoreCase ? 'i' : '';
        return new RegExp(r.source, flags);
    }

    function cloneDate(date) {
        return new Date(+date);
    }

    function cloneArray(arr) {
        return arr.slice();
    }

    module.exports = clone;



},{"../object/mixIn":236,"./isPlainObject":207,"./kindOf":210}],198:[function(require,module,exports){
var clone = require('./clone');
var forOwn = require('../object/forOwn');
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');

    /**
     * Recursively clone native types.
     */
    function deepClone(val, instanceClone) {
        switch ( kindOf(val) ) {
            case 'Object':
                return cloneObject(val, instanceClone);
            case 'Array':
                return cloneArray(val, instanceClone);
            default:
                return clone(val);
        }
    }

    function cloneObject(source, instanceClone) {
        if (isPlainObject(source)) {
            var out = {};
            forOwn(source, function(val, key) {
                this[key] = deepClone(val, instanceClone);
            }, out);
            return out;
        } else if (instanceClone) {
            return instanceClone(source);
        } else {
            return source;
        }
    }

    function cloneArray(arr, instanceClone) {
        var out = [],
            i = -1,
            n = arr.length,
            val;
        while (++i < n) {
            out[i] = deepClone(arr[i], instanceClone);
        }
        return out;
    }

    module.exports = deepClone;




},{"../object/forOwn":230,"./clone":197,"./isPlainObject":207,"./kindOf":210}],199:[function(require,module,exports){
var is = require('./is');
var isObject = require('./isObject');
var isArray = require('./isArray');
var objEquals = require('../object/equals');
var arrEquals = require('../array/equals');

    /**
     * Recursively checks for same properties and values.
     */
    function deepEquals(a, b, callback){
        callback = callback || is;

        var bothObjects = isObject(a) && isObject(b);
        var bothArrays = !bothObjects && isArray(a) && isArray(b);

        if (!bothObjects && !bothArrays) {
            return callback(a, b);
        }

        function compare(a, b){
            return deepEquals(a, b, callback);
        }

        var method = bothObjects ? objEquals : arrEquals;
        return method(a, b, compare);
    }

    module.exports = deepEquals;



},{"../array/equals":166,"../object/equals":225,"./is":200,"./isArray":201,"./isObject":206}],200:[function(require,module,exports){


    /**
     * Check if both arguments are egal.
     */
    function is(x, y){
        // implementation borrowed from harmony:egal spec
        if (x === y) {
          // 0 === -0, but they are not identical
          return x !== 0 || 1 / x === 1 / y;
        }

        // NaN !== NaN, but they are identical.
        // NaNs are the only non-reflexive value, i.e., if x !== x,
        // then x is a NaN.
        // isNaN is broken: it converts its argument to number, so
        // isNaN("foo") => true
        return x !== x && y !== y;
    }

    module.exports = is;



},{}],201:[function(require,module,exports){
arguments[4][83][0].apply(exports,arguments)
},{"./isKind":204,"dup":83}],202:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isBoolean(val) {
        return isKind(val, 'Boolean');
    }
    module.exports = isBoolean;


},{"./isKind":204}],203:[function(require,module,exports){
arguments[4][84][0].apply(exports,arguments)
},{"./isKind":204,"dup":84}],204:[function(require,module,exports){
arguments[4][85][0].apply(exports,arguments)
},{"./kindOf":210,"dup":85}],205:[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isNumber(val) {
        return isKind(val, 'Number');
    }
    module.exports = isNumber;


},{"./isKind":204}],206:[function(require,module,exports){
arguments[4][86][0].apply(exports,arguments)
},{"./isKind":204,"dup":86}],207:[function(require,module,exports){


    /**
     * Checks if the value is created by the `Object` constructor.
     */
    function isPlainObject(value) {
        return (!!value && typeof value === 'object' &&
            value.constructor === Object);
    }

    module.exports = isPlainObject;



},{}],208:[function(require,module,exports){


    /**
     * Checks if the object is a primitive
     */
    function isPrimitive(value) {
        // Using switch fallthrough because it's simple to read and is
        // generally fast: http://jsperf.com/testing-value-is-primitive/5
        switch (typeof value) {
            case "string":
            case "number":
            case "boolean":
                return true;
        }

        return value == null;
    }

    module.exports = isPrimitive;



},{}],209:[function(require,module,exports){
arguments[4][87][0].apply(exports,arguments)
},{"./isKind":204,"dup":87}],210:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],211:[function(require,module,exports){
var kindOf = require('./kindOf');
var GLOBAL = require('./GLOBAL');

    /**
     * Convert array-like object into array
     */
    function toArray(val){
        var ret = [],
            kind = kindOf(val),
            n;

        if (val != null) {
            if ( val.length == null || kind === 'String' || kind === 'Function' || kind === 'RegExp' || val === GLOBAL ) {
                //string, regexp, function have .length but user probably just want
                //to wrap value into an array..
                ret[ret.length] = val;
            } else {
                //window returns true on isObject in IE7 and may have length
                //property. `typeof NodeList` returns `function` on Safari so
                //we can't use it (#58)
                n = val.length;
                while (n--) {
                    ret[n] = val[n];
                }
            }
        }
        return ret;
    }
    module.exports = toArray;


},{"./GLOBAL":196,"./kindOf":210}],212:[function(require,module,exports){
var isArray = require('./isArray');

    /**
     * covert value into number if numeric
     */
    function toNumber(val){
        // numberic values should come first because of -0
        if (typeof val === 'number') return val;
        // we want all falsy values (besides -0) to return zero to avoid
        // headaches
        if (!val) return 0;
        if (typeof val === 'string') return parseFloat(val);
        // arrays are edge cases. `Number([4]) === 4`
        if (isArray(val)) return NaN;
        return Number(val);
    }

    module.exports = toNumber;



},{"./isArray":201}],213:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],214:[function(require,module,exports){

    /**
     * Clamps value inside range.
     */
    function clamp(val, min, max){
        return val < min? min : (val > max? max : val);
    }
    module.exports = clamp;


},{}],215:[function(require,module,exports){

    /**
    * Linear interpolation.
    * IMPORTANT:will return `Infinity` if numbers overflow Number.MAX_VALUE
    */
    function lerp(ratio, start, end){
        return start + (end - start) * ratio;
    }

    module.exports = lerp;


},{}],216:[function(require,module,exports){
var lerp = require('./lerp');
var norm = require('./norm');
    /**
    * Maps a number from one scale to another.
    * @example map(3, 0, 4, -1, 1) -> 0.5
    */
    function map(val, min1, max1, min2, max2){
        return lerp( norm(val, min1, max1), min2, max2 );
    }
    module.exports = map;


},{"./lerp":215,"./norm":217}],217:[function(require,module,exports){

    /**
    * Gets normalized ratio of value inside range.
    */
    function norm(val, min, max){
        if (val < min || val > max) {
            throw new RangeError('value (' + val + ') must be between ' + min + ' and ' + max);
        }

        return val === max ? 1 : (val - min) / (max - min);
    }
    module.exports = norm;


},{}],218:[function(require,module,exports){
/**
 * @constant Maximum 32-bit signed integer value. (2^31 - 1)
 */

    module.exports = 2147483647;


},{}],219:[function(require,module,exports){
/**
 * @constant Minimum 32-bit signed integer value (-2^31).
 */

    module.exports = -2147483648;


},{}],220:[function(require,module,exports){
var toNumber = require('../lang/toNumber');
    /**
     * Enforce a specific amount of decimal digits and also fix floating
     * point rounding issues.
     */
    function enforcePrecision(val, nDecimalDigits){
        val = toNumber(val);
        var pow = Math.pow(10, nDecimalDigits);
        return +(Math.round(val * pow) / pow).toFixed(nDecimalDigits);
    }
    module.exports = enforcePrecision;


},{"../lang/toNumber":212}],221:[function(require,module,exports){


    /**
     * "Convert" value into an 32-bit integer.
     * Works like `Math.floor` if val > 0 and `Math.ceil` if val < 0.
     * IMPORTANT: val will wrap at 2^31 and -2^31.
     * Perf tests: http://jsperf.com/vs-vs-parseint-bitwise-operators/7
     */
    function toInt(val){
        // we do not use lang/toNumber because of perf and also because it
        // doesn't break the functionality
        return ~~val;
    }

    module.exports = toInt;



},{}],222:[function(require,module,exports){
var some = require('./some');

    /**
     * Check if object contains value
     */
    function contains(obj, needle) {
        return some(obj, function(val) {
            return (val === needle);
        });
    }
    module.exports = contains;



},{"./some":241}],223:[function(require,module,exports){
var forOwn = require('./forOwn');
var isPlainObject = require('../lang/isPlainObject');

    /**
     * Deeply copy missing properties in the target from the defaults.
     */
    function deepFillIn(target, defaults){
        var i = 0,
            n = arguments.length,
            obj;

        while(++i < n) {
            obj = arguments[i];
            if (obj) {
                // jshint loopfunc: true
                forOwn(obj, function(newValue, key) {
                    var curValue = target[key];
                    if (curValue == null) {
                        target[key] = newValue;
                    } else if (isPlainObject(curValue) &&
                               isPlainObject(newValue)) {
                        deepFillIn(curValue, newValue);
                    }
                });
            }
        }

        return target;
    }

    module.exports = deepFillIn;



},{"../lang/isPlainObject":207,"./forOwn":230}],224:[function(require,module,exports){
var forOwn = require('./forOwn');
var isArray = require('../lang/isArray');

    function containsMatch(array, pattern) {
        var i = -1, length = array.length;
        while (++i < length) {
            if (deepMatches(array[i], pattern)) {
                return true;
            }
        }

        return false;
    }

    function matchArray(target, pattern) {
        var i = -1, patternLength = pattern.length;
        while (++i < patternLength) {
            if (!containsMatch(target, pattern[i])) {
                return false;
            }
        }

        return true;
    }

    function matchObject(target, pattern) {
        var result = true;
        forOwn(pattern, function(val, key) {
            if (!deepMatches(target[key], val)) {
                // Return false to break out of forOwn early
                return (result = false);
            }
        });

        return result;
    }

    /**
     * Recursively check if the objects match.
     */
    function deepMatches(target, pattern){
        if (target && typeof target === 'object' &&
            pattern && typeof pattern === 'object') {
            if (isArray(target) && isArray(pattern)) {
                return matchArray(target, pattern);
            } else {
                return matchObject(target, pattern);
            }
        } else {
            return target === pattern;
        }
    }

    module.exports = deepMatches;



},{"../lang/isArray":201,"./forOwn":230}],225:[function(require,module,exports){
var hasOwn = require('./hasOwn');
var every = require('./every');
var isObject = require('../lang/isObject');
var is = require('../lang/is');

    // Makes a function to compare the object values from the specified compare
    // operation callback.
    function makeCompare(callback) {
        return function(value, key) {
            return hasOwn(this, key) && callback(value, this[key]);
        };
    }

    function checkProperties(value, key) {
        return hasOwn(this, key);
    }

    /**
     * Checks if two objects have the same keys and values.
     */
    function equals(a, b, callback) {
        callback = callback || is;

        if (!isObject(a) || !isObject(b)) {
            return callback(a, b);
        }

        return (every(a, makeCompare(callback), b) &&
                every(b, checkProperties, a));
    }

    module.exports = equals;


},{"../lang/is":200,"../lang/isObject":206,"./every":226,"./hasOwn":233}],226:[function(require,module,exports){
var forOwn = require('./forOwn');
var makeIterator = require('../function/makeIterator_');

    /**
     * Object every
     */
    function every(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = true;
        forOwn(obj, function(val, key) {
            // we consider any falsy values as "false" on purpose so shorthand
            // syntax can be used to check property existence
            if (!callback(val, key, obj)) {
                result = false;
                return false; // break
            }
        });
        return result;
    }

    module.exports = every;



},{"../function/makeIterator_":193,"./forOwn":230}],227:[function(require,module,exports){
var forOwn = require('./forOwn');
var makeIterator = require('../function/makeIterator_');

    /**
     * Creates a new object with all the properties where the callback returns
     * true.
     */
    function filterValues(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var output = {};
        forOwn(obj, function(value, key, obj) {
            if (callback(value, key, obj)) {
                output[key] = value;
            }
        });

        return output;
    }
    module.exports = filterValues;


},{"../function/makeIterator_":193,"./forOwn":230}],228:[function(require,module,exports){
var some = require('./some');
var makeIterator = require('../function/makeIterator_');

    /**
     * Returns first item that matches criteria
     */
    function find(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result;
        some(obj, function(value, key, obj) {
            if (callback(value, key, obj)) {
                result = value;
                return true; //break
            }
        });
        return result;
    }

    module.exports = find;



},{"../function/makeIterator_":193,"./some":241}],229:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"./hasOwn":233,"dup":90}],230:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"./forIn":229,"./hasOwn":233,"dup":91}],231:[function(require,module,exports){
var isPrimitive = require('../lang/isPrimitive');

    /**
     * get "nested" object property
     */
    function get(obj, prop){
        var parts = prop.split('.'),
            last = parts.pop();

        while (prop = parts.shift()) {
            obj = obj[prop];
            if (obj == null) return;
        }

        return obj[last];
    }

    module.exports = get;



},{"../lang/isPrimitive":208}],232:[function(require,module,exports){
var get = require('./get');

    var UNDEF;

    /**
     * Check if object has nested property.
     */
    function has(obj, prop){
        return get(obj, prop) !== UNDEF;
    }

    module.exports = has;




},{"./get":231}],233:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],234:[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object keys
     */
     var keys = Object.keys || function (obj) {
            var keys = [];
            forOwn(obj, function(val, key){
                keys.push(key);
            });
            return keys;
        };

    module.exports = keys;



},{"./forOwn":230}],235:[function(require,module,exports){
var hasOwn = require('./hasOwn');
var deepClone = require('../lang/deepClone');
var isObject = require('../lang/isObject');

    /**
     * Deep merge objects.
     */
    function merge() {
        var i = 1,
            key, val, obj, target;

        // make sure we don't modify source element and it's properties
        // objects are passed by reference
        target = deepClone( arguments[0] );

        while (obj = arguments[i++]) {
            for (key in obj) {
                if ( ! hasOwn(obj, key) ) {
                    continue;
                }

                val = obj[key];

                if ( isObject(val) && isObject(target[key]) ){
                    // inception, deep merge objects
                    target[key] = merge(target[key], val);
                } else {
                    // make sure arrays, regexp, date, objects are cloned
                    target[key] = deepClone(val);
                }

            }
        }

        return target;
    }

    module.exports = merge;



},{"../lang/deepClone":198,"../lang/isObject":206,"./hasOwn":233}],236:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"./forOwn":230,"dup":93}],237:[function(require,module,exports){
var forEach = require('../array/forEach');

    /**
     * Create nested object if non-existent
     */
    function namespace(obj, path){
        if (!path) return obj;
        forEach(path.split('.'), function(key){
            if (!obj[key]) {
                obj[key] = {};
            }
            obj = obj[key];
        });
        return obj;
    }

    module.exports = namespace;



},{"../array/forEach":172}],238:[function(require,module,exports){
var slice = require('../array/slice');
var contains = require('../array/contains');

    /**
     * Return a copy of the object, filtered to only contain properties except the blacklisted keys.
     */
    function omit(obj, var_keys){
        var keys = typeof arguments[1] !== 'string'? arguments[1] : slice(arguments, 1),
            out = {};

        for (var property in obj) {
            if (obj.hasOwnProperty(property) && !contains(keys, property)) {
                out[property] = obj[property];
            }
        }
        return out;
    }

    module.exports = omit;



},{"../array/contains":164,"../array/slice":181}],239:[function(require,module,exports){
var namespace = require('./namespace');

    /**
     * set "nested" object property
     */
    function set(obj, prop, val){
        var parts = (/^(.+)\.(.+)$/).exec(prop);
        if (parts){
            namespace(obj, parts[1])[parts[2]] = val;
        } else {
            obj[prop] = val;
        }
    }

    module.exports = set;



},{"./namespace":237}],240:[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object size
     */
    function size(obj) {
        var count = 0;
        forOwn(obj, function(){
            count++;
        });
        return count;
    }

    module.exports = size;



},{"./forOwn":230}],241:[function(require,module,exports){
var forOwn = require('./forOwn');
var makeIterator = require('../function/makeIterator_');

    /**
     * Object some
     */
    function some(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = false;
        forOwn(obj, function(val, key) {
            if (callback(val, key, obj)) {
                result = true;
                return false; // break
            }
        });
        return result;
    }

    module.exports = some;



},{"../function/makeIterator_":193,"./forOwn":230}],242:[function(require,module,exports){
var has = require('./has');

    /**
     * Unset object property.
     */
    function unset(obj, prop){
        if (has(obj, prop)) {
            var parts = prop.split('.'),
                last = parts.pop();
            while (prop = parts.shift()) {
                obj = obj[prop];
            }
            return (delete obj[last]);

        } else {
            // if property doesn't exist treat as deleted
            return true;
        }
    }

    module.exports = unset;



},{"./has":232}],243:[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object values
     */
    function values(obj) {
        var vals = [];
        forOwn(obj, function(val, key){
            vals.push(val);
        });
        return vals;
    }

    module.exports = values;



},{"./forOwn":230}],244:[function(require,module,exports){
var forOwn = require('../object/forOwn');
var isArray = require('../lang/isArray');
var forEach = require('../array/forEach');

    /**
     * Encode object into a query string.
     */
    function encode(obj){
        var query = [],
            arrValues, reg;
        forOwn(obj, function (val, key) {
            if (isArray(val)) {
                arrValues = key + '=';
                reg = new RegExp('&'+key+'+=$');
                forEach(val, function (aValue) {
                    arrValues += encodeURIComponent(aValue) + '&' + key + '=';
                });
                query.push(arrValues.replace(reg, ''));
            } else {
               query.push(key + '=' + encodeURIComponent(val));
            }
        });
        return (query.length) ? '?' + query.join('&') : '';
    }

    module.exports = encode;


},{"../array/forEach":172,"../lang/isArray":201,"../object/forOwn":230}],245:[function(require,module,exports){
var typecast = require('../string/typecast');
var getQuery = require('./getQuery');

    /**
     * Get query parameter value.
     */
    function getParam(url, param, shouldTypecast){
        var regexp = new RegExp('(\\?|&)'+ param + '=([^&]*)'), //matches `?param=value` or `&param=value`, value = $2
            result = regexp.exec( getQuery(url) ),
            val = (result && result[2])? result[2] : null;
        return shouldTypecast === false? val : typecast(val);
    }

    module.exports = getParam;


},{"../string/typecast":271,"./getQuery":246}],246:[function(require,module,exports){


    /**
     * Gets full query as string with all special chars decoded.
     */
    function getQuery(url) {
        // url = url.replace(/#.*\?/, '?'); //removes hash (to avoid getting hash query)
        var queryString = /\?[a-zA-Z0-9\=\&\%\$\-\_\.\+\!\*\'\(\)\,]+/.exec(url); //valid chars according to: http://www.ietf.org/rfc/rfc1738.txt
        return (queryString)? decodeURIComponent(queryString[0].replace(/\+/g,' ')) : '';
    }

    module.exports = getQuery;


},{}],247:[function(require,module,exports){


    /**
     * Set query string parameter value
     */
    function setParam(url, paramName, value){
        url = url || '';

        var re = new RegExp('(\\?|&)'+ paramName +'=[^&]*' );
        var param = paramName +'='+ encodeURIComponent( value );

        if ( re.test(url) ) {
            return url.replace(re, '$1'+ param);
        } else {
            if (url.indexOf('?') === -1) {
                url += '?';
            }
            if (url.indexOf('=') !== -1) {
                url += '&';
            }
            return url + param;
        }

    }

    module.exports = setParam;



},{}],248:[function(require,module,exports){
var randInt = require('./randInt');
var isArray = require('../lang/isArray');

    /**
     * Returns a random element from the supplied arguments
     * or from the array (if single argument is an array).
     */
    function choice(items) {
        var target = (arguments.length === 1 && isArray(items))? items : arguments;
        return target[ randInt(0, target.length - 1) ];
    }

    module.exports = choice;



},{"../lang/isArray":201,"./randInt":252}],249:[function(require,module,exports){
var randHex = require('./randHex');
var choice = require('./choice');

  /**
   * Returns pseudo-random guid (UUID v4)
   * IMPORTANT: it's not totally "safe" since randHex/choice uses Math.random
   * by default and sequences can be predicted in some cases. See the
   * "random/random" documentation for more info about it and how to replace
   * the default PRNG.
   */
  function guid() {
    return (
        randHex(8)+'-'+
        randHex(4)+'-'+
        // v4 UUID always contain "4" at this position to specify it was
        // randomly generated
        '4' + randHex(3) +'-'+
        // v4 UUID always contain chars [a,b,8,9] at this position
        choice(8, 9, 'a', 'b') + randHex(3)+'-'+
        randHex(12)
    );
  }
  module.exports = guid;


},{"./choice":248,"./randHex":251}],250:[function(require,module,exports){
var random = require('./random');
var MIN_INT = require('../number/MIN_INT');
var MAX_INT = require('../number/MAX_INT');

    /**
     * Returns random number inside range
     */
    function rand(min, max){
        min = min == null? MIN_INT : min;
        max = max == null? MAX_INT : max;
        return min + (max - min) * random();
    }

    module.exports = rand;


},{"../number/MAX_INT":218,"../number/MIN_INT":219,"./random":253}],251:[function(require,module,exports){
var choice = require('./choice');

    var _chars = '0123456789abcdef'.split('');

    /**
     * Returns a random hexadecimal string
     */
    function randHex(size){
        size = size && size > 0? size : 6;
        var str = '';
        while (size--) {
            str += choice(_chars);
        }
        return str;
    }

    module.exports = randHex;



},{"./choice":248}],252:[function(require,module,exports){
var MIN_INT = require('../number/MIN_INT');
var MAX_INT = require('../number/MAX_INT');
var rand = require('./rand');

    /**
     * Gets random integer inside range or snap to min/max values.
     */
    function randInt(min, max){
        min = min == null? MIN_INT : ~~min;
        max = max == null? MAX_INT : ~~max;
        // can't be max + 0.5 otherwise it will round up if `rand`
        // returns `max` causing it to overflow range.
        // -0.5 and + 0.49 are required to avoid bias caused by rounding
        return Math.round( rand(min - 0.5, max + 0.499999999999) );
    }

    module.exports = randInt;


},{"../number/MAX_INT":218,"../number/MIN_INT":219,"./rand":250}],253:[function(require,module,exports){


    /**
     * Just a wrapper to Math.random. No methods inside mout/random should call
     * Math.random() directly so we can inject the pseudo-random number
     * generator if needed (ie. in case we need a seeded random or a better
     * algorithm than the native one)
     */
    function random(){
        return random.get();
    }

    // we expose the method so it can be swapped if needed
    random.get = Math.random;

    module.exports = random;



},{}],254:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],255:[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Searches for a given substring
     */
    function contains(str, substring, fromIndex){
        str = toString(str);
        substring = toString(substring);
        return str.indexOf(substring, fromIndex) !== -1;
    }

    module.exports = contains;



},{"../lang/toString":213}],256:[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * Checks if string ends with specified suffix.
     */
    function endsWith(str, suffix) {
        str = toString(str);
        suffix = toString(suffix);

        return str.indexOf(suffix, str.length - suffix.length) !== -1;
    }

    module.exports = endsWith;


},{"../lang/toString":213}],257:[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Escapes a string for insertion into HTML.
     */
    function escapeHtml(str){
        str = toString(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/'/g, '&#39;')
            .replace(/"/g, '&quot;');
        return str;
    }

    module.exports = escapeHtml;



},{"../lang/toString":213}],258:[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Escape string into unicode sequences
     */
    function escapeUnicode(str, shouldEscapePrintable){
        str = toString(str);
        return str.replace(/[\s\S]/g, function(ch){
            // skip printable ASCII chars if we should not escape them
            if (!shouldEscapePrintable && (/[\x20-\x7E]/).test(ch)) {
                return ch;
            }
            // we use "000" and slice(-4) for brevity, need to pad zeros,
            // unicode escape always have 4 chars after "\u"
            return '\\u'+ ('000'+ ch.charCodeAt(0).toString(16)).slice(-4);
        });
    }

    module.exports = escapeUnicode;



},{"../lang/toString":213}],259:[function(require,module,exports){
var toString = require('../lang/toString');
var get = require('../object/get');

    var stache = /\{\{([^\}]+)\}\}/g; //mustache-like

    /**
     * String interpolation
     */
    function interpolate(template, replacements, syntax){
        template = toString(template);
        var replaceFn = function(match, prop){
            return toString( get(replacements, prop) );
        };
        return template.replace(syntax || stache, replaceFn);
    }

    module.exports = interpolate;



},{"../lang/toString":213,"../object/get":231}],260:[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * "Safer" String.toLowerCase()
     */
    function lowerCase(str){
        str = toString(str);
        return str.toLowerCase();
    }

    module.exports = lowerCase;


},{"../lang/toString":213}],261:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"../lang/toString":213,"./WHITE_SPACES":254,"dup":95}],262:[function(require,module,exports){
var toString = require('../lang/toString');
var lowerCase = require('./lowerCase');
var upperCase = require('./upperCase');
    /**
     * UPPERCASE first char of each word.
     */
    function properCase(str){
        str = toString(str);
        return lowerCase(str).replace(/^\w|\s\w/g, upperCase);
    }

    module.exports = properCase;


},{"../lang/toString":213,"./lowerCase":260,"./upperCase":274}],263:[function(require,module,exports){
var toString = require('../lang/toString');
    // This pattern is generated by the _build/pattern-removeNonWord.js script
    var PATTERN = /[^\x20\x2D0-9A-Z\x5Fa-z\xC0-\xD6\xD8-\xF6\xF8-\xFF]/g;

    /**
     * Remove non-word chars.
     */
    function removeNonWord(str){
        str = toString(str);
        return str.replace(PATTERN, '');
    }

    module.exports = removeNonWord;


},{"../lang/toString":213}],264:[function(require,module,exports){
var toString = require('../lang/toString');
var toInt = require('../number/toInt');

    /**
     * Repeat string n times
     */
     function repeat(str, n){
         var result = '';
         str = toString(str);
         n = toInt(n);
        if (n < 1) {
            return '';
        }
        while (n > 0) {
            if (n % 2) {
                result += str;
            }
            n = Math.floor(n / 2);
            str += str;
        }
        return result;
     }

     module.exports = repeat;



},{"../lang/toString":213,"../number/toInt":221}],265:[function(require,module,exports){
var toString = require('../lang/toString');
var toArray = require('../lang/toArray');

    /**
     * Replace string(s) with the replacement(s) in the source.
     */
    function replace(str, search, replacements) {
        str = toString(str);
        search = toArray(search);
        replacements = toArray(replacements);

        var searchLength = search.length,
            replacementsLength = replacements.length;

        if (replacementsLength !== 1 && searchLength !== replacementsLength) {
            throw new Error('Unequal number of searches and replacements');
        }

        var i = -1;
        while (++i < searchLength) {
            // Use the first replacement for all searches if only one
            // replacement is provided
            str = str.replace(
                search[i],
                replacements[(replacementsLength === 1) ? 0 : i]);
        }

        return str;
    }

    module.exports = replace;



},{"../lang/toArray":211,"../lang/toString":213}],266:[function(require,module,exports){
var toString = require('../lang/toString');
    /**
    * Replaces all accented chars with regular ones
    */
    function replaceAccents(str){
        str = toString(str);

        // verifies if the String has accents and replace them
        if (str.search(/[\xC0-\xFF]/g) > -1) {
            str = str
                    .replace(/[\xC0-\xC5]/g, "A")
                    .replace(/[\xC6]/g, "AE")
                    .replace(/[\xC7]/g, "C")
                    .replace(/[\xC8-\xCB]/g, "E")
                    .replace(/[\xCC-\xCF]/g, "I")
                    .replace(/[\xD0]/g, "D")
                    .replace(/[\xD1]/g, "N")
                    .replace(/[\xD2-\xD6\xD8]/g, "O")
                    .replace(/[\xD9-\xDC]/g, "U")
                    .replace(/[\xDD]/g, "Y")
                    .replace(/[\xDE]/g, "P")
                    .replace(/[\xE0-\xE5]/g, "a")
                    .replace(/[\xE6]/g, "ae")
                    .replace(/[\xE7]/g, "c")
                    .replace(/[\xE8-\xEB]/g, "e")
                    .replace(/[\xEC-\xEF]/g, "i")
                    .replace(/[\xF1]/g, "n")
                    .replace(/[\xF2-\xF6\xF8]/g, "o")
                    .replace(/[\xF9-\xFC]/g, "u")
                    .replace(/[\xFE]/g, "p")
                    .replace(/[\xFD\xFF]/g, "y");
        }
        return str;
    }
    module.exports = replaceAccents;


},{"../lang/toString":213}],267:[function(require,module,exports){
var toString = require('../lang/toString');
var repeat = require('./repeat');

    /**
     * Pad string with `char` if its' length is smaller than `minLen`
     */
    function rpad(str, minLen, ch) {
        str = toString(str);
        ch = ch || ' ';
        return (str.length < minLen)? str + repeat(ch, minLen - str.length) : str;
    }

    module.exports = rpad;



},{"../lang/toString":213,"./repeat":264}],268:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"../lang/toString":213,"./WHITE_SPACES":254,"dup":96}],269:[function(require,module,exports){
var toString = require('../lang/toString');
var replaceAccents = require('./replaceAccents');
var removeNonWord = require('./removeNonWord');
var trim = require('./trim');
    /**
     * Convert to lower case, remove accents, remove non-word chars and
     * replace spaces with the specified delimeter.
     * Does not split camelCase text.
     */
    function slugify(str, delimeter){
        str = toString(str);

        if (delimeter == null) {
            delimeter = "-";
        }
        str = replaceAccents(str);
        str = removeNonWord(str);
        str = trim(str) //should come after removeNonWord
                .replace(/ +/g, delimeter) //replace spaces with delimeter
                .toLowerCase();
        return str;
    }
    module.exports = slugify;


},{"../lang/toString":213,"./removeNonWord":263,"./replaceAccents":266,"./trim":270}],270:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"../lang/toString":213,"./WHITE_SPACES":254,"./ltrim":261,"./rtrim":268,"dup":97}],271:[function(require,module,exports){


    var UNDEF;

    /**
     * Parses string and convert it into a native value.
     */
    function typecast(val) {
        var r;
        if ( val === null || val === 'null' ) {
            r = null;
        } else if ( val === 'true' ) {
            r = true;
        } else if ( val === 'false' ) {
            r = false;
        } else if ( val === UNDEF || val === 'undefined' ) {
            r = UNDEF;
        } else if ( val === '' || isNaN(val) ) {
            //isNaN('') returns false
            r = val;
        } else {
            //parseFloat(null || '') returns NaN
            r = parseFloat(val);
        }
        return r;
    }

    module.exports = typecast;


},{}],272:[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Unescapes HTML special chars
     */
    function unescapeHtml(str){
        str = toString(str)
            .replace(/&amp;/g , '&')
            .replace(/&lt;/g  , '<')
            .replace(/&gt;/g  , '>')
            .replace(/&#0*39;/g , "'")
            .replace(/&quot;/g, '"');
        return str;
    }

    module.exports = unescapeHtml;



},{"../lang/toString":213}],273:[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * Replaces hyphens with spaces. (only hyphens between word chars)
     */
    function unhyphenate(str){
        str = toString(str);
        return str.replace(/(\w)(-)(\w)/g, '$1 $3');
    }
    module.exports = unhyphenate;


},{"../lang/toString":213}],274:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"../lang/toString":213,"dup":98}],275:[function(require,module,exports){
arguments[4][181][0].apply(exports,arguments)
},{"dup":181}],276:[function(require,module,exports){
arguments[4][190][0].apply(exports,arguments)
},{"../array/slice":275,"dup":190}],277:[function(require,module,exports){
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');
var mixIn = require('../object/mixIn');

    /**
     * Clone native types.
     */
    function clone(val){
        switch (kindOf(val)) {
            case 'Object':
                return cloneObject(val);
            case 'Array':
                return cloneArray(val);
            case 'RegExp':
                return cloneRegExp(val);
            case 'Date':
                return cloneDate(val);
            default:
                return val;
        }
    }

    function cloneObject(source) {
        if (isPlainObject(source)) {
            return mixIn({}, source);
        } else {
            return source;
        }
    }

    function cloneRegExp(r) {
        var flags = '';
        flags += r.multiline ? 'm' : '';
        flags += r.global ? 'g' : '';
        flags += r.ignorecase ? 'i' : '';
        return new RegExp(r.source, flags);
    }

    function cloneDate(date) {
        return new Date(+date);
    }

    function cloneArray(arr) {
        return arr.slice();
    }

    module.exports = clone;



},{"../object/mixIn":287,"./isPlainObject":281,"./kindOf":282}],278:[function(require,module,exports){
arguments[4][198][0].apply(exports,arguments)
},{"../object/forOwn":284,"./clone":277,"./isPlainObject":281,"./kindOf":282,"dup":198}],279:[function(require,module,exports){
arguments[4][85][0].apply(exports,arguments)
},{"./kindOf":282,"dup":85}],280:[function(require,module,exports){
arguments[4][86][0].apply(exports,arguments)
},{"./isKind":279,"dup":86}],281:[function(require,module,exports){
arguments[4][207][0].apply(exports,arguments)
},{"dup":207}],282:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],283:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"./hasOwn":285,"dup":90}],284:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"./forIn":283,"./hasOwn":285,"dup":91}],285:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],286:[function(require,module,exports){
arguments[4][235][0].apply(exports,arguments)
},{"../lang/deepClone":278,"../lang/isObject":280,"./hasOwn":285,"dup":235}],287:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"./forOwn":284,"dup":93}],288:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"dup":102,"mout/lang/createObject":289,"mout/lang/kindOf":290,"mout/object/hasOwn":293,"mout/object/mixIn":294}],289:[function(require,module,exports){
arguments[4][82][0].apply(exports,arguments)
},{"../object/mixIn":294,"dup":82}],290:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],291:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"./hasOwn":293,"dup":90}],292:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"./forIn":291,"./hasOwn":293,"dup":91}],293:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],294:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"./forOwn":292,"dup":93}],295:[function(require,module,exports){
"use strict";

// credits to @cpojer's Class.Binds, released under the MIT license
// https://github.com/cpojer/mootools-class-extras/blob/master/Source/Class.Binds.js

var prime = require("prime")
var bind = require("mout/function/bind")

var bound = prime({

    bound: function(name){
        var bound = this._bound || (this._bound = {})
        return bound[name] || (bound[name] = bind(this[name], this))
    }

})

module.exports = bound

},{"mout/function/bind":276,"prime":288}],296:[function(require,module,exports){
"use strict";

var prime = require("prime")
var merge = require("mout/object/merge")

var Options = prime({

    setOptions: function(options){
        var args = [{}, this.options]
        args.push.apply(args, arguments)
        this.options = merge.apply(null, args)
        return this
    }

})

module.exports = Options

},{"mout/object/merge":286,"prime":288}],297:[function(require,module,exports){
(function (process,global){
/*
defer
*/"use strict"

var kindOf  = require("mout/lang/kindOf"),
    now     = require("mout/time/now"),
    forEach = require("mout/array/forEach"),
    indexOf = require("mout/array/indexOf")

var callbacks = {
    timeout: {},
    frame: [],
    immediate: []
}

var push = function(collection, callback, context, defer){

    var iterator = function(){
        iterate(collection)
    }

    if (!collection.length) defer(iterator)

    var entry = {
        callback: callback,
        context: context
    }

    collection.push(entry)

    return function(){
        var io = indexOf(collection, entry)
        if (io > -1) collection.splice(io, 1)
    }
}

var iterate = function(collection){
    var time = now()

    forEach(collection.splice(0), function(entry) {
        entry.callback.call(entry.context, time)
    })
}

var defer = function(callback, argument, context){
    return (kindOf(argument) === "Number") ? defer.timeout(callback, argument, context) : defer.immediate(callback, argument)
}

if (global.process && process.nextTick){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, process.nextTick)
    }

} else if (global.setImmediate){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, setImmediate)
    }

} else if (global.postMessage && global.addEventListener){

    addEventListener("message", function(event){
        if (event.source === global && event.data === "@deferred"){
            event.stopPropagation()
            iterate(callbacks.immediate)
        }
    }, true)

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(){
            postMessage("@deferred", "*")
        })
    }

} else {

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(iterator){
            setTimeout(iterator, 0)
        })
    }

}

var requestAnimationFrame = global.requestAnimationFrame ||
    global.webkitRequestAnimationFrame ||
    global.mozRequestAnimationFrame ||
    global.oRequestAnimationFrame ||
    global.msRequestAnimationFrame ||
    function(callback) {
        setTimeout(callback, 1e3 / 60)
    }

defer.frame = function(callback, context){
    return push(callbacks.frame, callback, context, requestAnimationFrame)
}

var clear

defer.timeout = function(callback, ms, context){
    var ct = callbacks.timeout

    if (!clear) clear = defer.immediate(function(){
        clear = null
        callbacks.timeout = {}
    })

    return push(ct[ms] || (ct[ms] = []), callback, context, function(iterator){
        setTimeout(iterator, ms)
    })
}

module.exports = defer

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":1,"mout/array/forEach":301,"mout/array/indexOf":302,"mout/lang/kindOf":304,"mout/time/now":309}],298:[function(require,module,exports){
/*
Emitter
*/"use strict"

var indexOf = require("mout/array/indexOf"),
    forEach = require("mout/array/forEach")

var prime = require("./index"),
    defer = require("./defer")

var slice = Array.prototype.slice;

var Emitter = prime({

    constructor: function(stoppable){
        this._stoppable = stoppable
    },

    on: function(event, fn){
        var listeners = this._listeners || (this._listeners = {}),
            events = listeners[event] || (listeners[event] = [])

        if (indexOf(events, fn) === -1) events.push(fn)

        return this
    },

    off: function(event, fn){
        var listeners = this._listeners, events
        if (listeners && (events = listeners[event])){

            var io = indexOf(events, fn)
            if (io > -1) events.splice(io, 1)
            if (!events.length) delete listeners[event];
            for (var l in listeners) return this
            delete this._listeners
        }
        return this
    },

    emit: function(event){
        var self = this,
            args = slice.call(arguments, 1)

        var emit = function(){
            var listeners = self._listeners, events
            if (listeners && (events = listeners[event])){
                forEach(events.slice(0), function(event){
                    var result = event.apply(self, args)
                    if (self._stoppable) return result
                })
            }
        }

        if (args[args.length - 1] === Emitter.EMIT_SYNC){
            args.pop()
            emit()
        } else {
            defer(emit)
        }

        return this
    }

})

Emitter.EMIT_SYNC = {}

module.exports = Emitter

},{"./defer":297,"./index":299,"mout/array/forEach":301,"mout/array/indexOf":302}],299:[function(require,module,exports){
/*
prime
 - prototypal inheritance
*/"use strict"

var hasOwn = require("mout/object/hasOwn"),
    mixIn  = require("mout/object/mixIn"),
    create = require("mout/lang/createObject"),
    kindOf = require("mout/lang/kindOf")

var hasDescriptors = true

try {
    Object.defineProperty({}, "~", {})
    Object.getOwnPropertyDescriptor({}, "~")
} catch (e){
    hasDescriptors = false
}

// we only need to be able to implement "toString" and "valueOf" in IE < 9
var hasEnumBug = !({valueOf: 0}).propertyIsEnumerable("valueOf"),
    buggy      = ["toString", "valueOf"]

var verbs = /^constructor|inherits|mixin$/

var implement = function(proto){
    var prototype = this.prototype

    for (var key in proto){
        if (key.match(verbs)) continue
        if (hasDescriptors){
            var descriptor = Object.getOwnPropertyDescriptor(proto, key)
            if (descriptor){
                Object.defineProperty(prototype, key, descriptor)
                continue
            }
        }
        prototype[key] = proto[key]
    }

    if (hasEnumBug) for (var i = 0; (key = buggy[i]); i++){
        var value = proto[key]
        if (value !== Object.prototype[key]) prototype[key] = value
    }

    return this
}

var prime = function(proto){

    if (kindOf(proto) === "Function") proto = {constructor: proto}

    var superprime = proto.inherits

    // if our nice proto object has no own constructor property
    // then we proceed using a ghosting constructor that all it does is
    // call the parent's constructor if it has a superprime, else an empty constructor
    // proto.constructor becomes the effective constructor
    var constructor = (hasOwn(proto, "constructor")) ? proto.constructor : (superprime) ? function(){
        return superprime.apply(this, arguments)
    } : function(){}

    if (superprime){

        mixIn(constructor, superprime)

        var superproto = superprime.prototype
        // inherit from superprime
        var cproto = constructor.prototype = create(superproto)

        // setting constructor.parent to superprime.prototype
        // because it's the shortest possible absolute reference
        constructor.parent = superproto
        cproto.constructor = constructor
    }

    if (!constructor.implement) constructor.implement = implement

    var mixins = proto.mixin
    if (mixins){
        if (kindOf(mixins) !== "Array") mixins = [mixins]
        for (var i = 0; i < mixins.length; i++) constructor.implement(create(mixins[i].prototype))
    }

    // implement proto and return constructor
    return constructor.implement(proto)

}

module.exports = prime

},{"mout/lang/createObject":303,"mout/lang/kindOf":304,"mout/object/hasOwn":307,"mout/object/mixIn":308}],300:[function(require,module,exports){
/*
Map
*/"use strict"

var indexOf = require("mout/array/indexOf")

var prime = require("./index")

var Map = prime({

    constructor: function Map(){
        this.length = 0
        this._values = []
        this._keys = []
    },

    set: function(key, value){
        var index = indexOf(this._keys, key)

        if (index === -1){
            this._keys.push(key)
            this._values.push(value)
            this.length++
        } else {
            this._values[index] = value
        }

        return this
    },

    get: function(key){
        var index = indexOf(this._keys, key)
        return (index === -1) ? null : this._values[index]
    },

    count: function(){
        return this.length
    },

    forEach: function(method, context){
        for (var i = 0, l = this.length; i < l; i++){
            if (method.call(context, this._values[i], this._keys[i], this) === false) break
        }
        return this
    },

    map: function(method, context){
        var results = new Map
        this.forEach(function(value, key){
            results.set(key, method.call(context, value, key, this))
        }, this)
        return results
    },

    filter: function(method, context){
        var results = new Map
        this.forEach(function(value, key){
            if (method.call(context, value, key, this)) results.set(key, value)
        }, this)
        return results
    },

    every: function(method, context){
        var every = true
        this.forEach(function(value, key){
            if (!method.call(context, value, key, this)) return (every = false)
        }, this)
        return every
    },

    some: function(method, context){
        var some = false
        this.forEach(function(value, key){
            if (method.call(context, value, key, this)) return !(some = true)
        }, this)
        return some
    },

    indexOf: function(value){
        var index = indexOf(this._values, value)
        return (index > -1) ? this._keys[index] : null
    },

    remove: function(value){
        var index = indexOf(this._values, value)

        if (index !== -1){
            this._values.splice(index, 1)
            this.length--
            return this._keys.splice(index, 1)[0]
        }

        return null
    },

    unset: function(key){
        var index = indexOf(this._keys, key)

        if (index !== -1){
            this._keys.splice(index, 1)
            this.length--
            return this._values.splice(index, 1)[0]
        }

        return null
    },

    keys: function(){
        return this._keys.slice()
    },

    values: function(){
        return this._values.slice()
    }

})

var map = function(){
    return new Map
}

map.prototype = Map.prototype

module.exports = map

},{"./index":299,"mout/array/indexOf":302}],301:[function(require,module,exports){
arguments[4][79][0].apply(exports,arguments)
},{"dup":79}],302:[function(require,module,exports){
arguments[4][80][0].apply(exports,arguments)
},{"dup":80}],303:[function(require,module,exports){
arguments[4][82][0].apply(exports,arguments)
},{"../object/mixIn":308,"dup":82}],304:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],305:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"./hasOwn":307,"dup":90}],306:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"./forIn":305,"./hasOwn":307,"dup":91}],307:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],308:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"./forOwn":306,"dup":93}],309:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"dup":99}],310:[function(require,module,exports){
/**
 * sifter.js
 * Copyright (c) 2013 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

(function(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define(factory);
	} else if (typeof exports === 'object') {
		module.exports = factory();
	} else {
		root.Sifter = factory();
	}
}(this, function() {

	/**
	 * Textually searches arrays and hashes of objects
	 * by property (or multiple properties). Designed
	 * specifically for autocomplete.
	 *
	 * @constructor
	 * @param {array|object} items
	 * @param {object} items
	 */
	var Sifter = function(items, settings) {
		this.items = items;
		this.settings = settings || {diacritics: true};
	};

	/**
	 * Splits a search string into an array of individual
	 * regexps to be used to match results.
	 *
	 * @param {string} query
	 * @returns {array}
	 */
	Sifter.prototype.tokenize = function(query) {
		query = trim(String(query || '').toLowerCase());
		if (!query || !query.length) return [];

		var i, n, regex, letter;
		var tokens = [];
		var words = query.split(/ +/);

		for (i = 0, n = words.length; i < n; i++) {
			regex = escape_regex(words[i]);
			if (this.settings.diacritics) {
				for (letter in DIACRITICS) {
					if (DIACRITICS.hasOwnProperty(letter)) {
						regex = regex.replace(new RegExp(letter, 'g'), DIACRITICS[letter]);
					}
				}
			}
			tokens.push({
				string : words[i],
				regex  : new RegExp(regex, 'i')
			});
		}

		return tokens;
	};

	/**
	 * Iterates over arrays and hashes.
	 *
	 * ```
	 * this.iterator(this.items, function(item, id) {
	 *    // invoked for each item
	 * });
	 * ```
	 *
	 * @param {array|object} object
	 */
	Sifter.prototype.iterator = function(object, callback) {
		var iterator;
		if (is_array(object)) {
			iterator = Array.prototype.forEach || function(callback) {
				for (var i = 0, n = this.length; i < n; i++) {
					callback(this[i], i, this);
				}
			};
		} else {
			iterator = function(callback) {
				for (var key in this) {
					if (this.hasOwnProperty(key)) {
						callback(this[key], key, this);
					}
				}
			};
		}

		iterator.apply(object, [callback]);
	};

	/**
	 * Returns a function to be used to score individual results.
	 *
	 * Good matches will have a higher score than poor matches.
	 * If an item is not a match, 0 will be returned by the function.
	 *
	 * @param {object|string} search
	 * @param {object} options (optional)
	 * @returns {function}
	 */
	Sifter.prototype.getScoreFunction = function(search, options) {
		var self, fields, tokens, token_count, nesting;

		self        = this;
		search      = self.prepareSearch(search, options);
		tokens      = search.tokens;
		fields      = search.options.fields;
		token_count = tokens.length;
		nesting     = search.options.nesting;

		/**
		 * Calculates how close of a match the
		 * given value is against a search token.
		 *
		 * @param {mixed} value
		 * @param {object} token
		 * @return {number}
		 */
		var scoreValue = function(value, token) {
			var score, pos;

			if (!value) return 0;
			value = String(value || '');
			pos = value.search(token.regex);
			if (pos === -1) return 0;
			score = token.string.length / value.length;
			if (pos === 0) score += 0.5;
			return score;
		};

		/**
		 * Calculates the score of an object
		 * against the search query.
		 *
		 * @param {object} token
		 * @param {object} data
		 * @return {number}
		 */
		var scoreObject = (function() {
			var field_count = fields.length;
			if (!field_count) {
				return function() { return 0; };
			}
			if (field_count === 1) {
				return function(token, data) {
					return scoreValue(getattr(data, fields[0], nesting), token);
				};
			}
			return function(token, data) {
				for (var i = 0, sum = 0; i < field_count; i++) {
					sum += scoreValue(getattr(data, fields[i], nesting), token);
				}
				return sum / field_count;
			};
		})();

		if (!token_count) {
			return function() { return 0; };
		}
		if (token_count === 1) {
			return function(data) {
				return scoreObject(tokens[0], data);
			};
		}

		if (search.options.conjunction === 'and') {
			return function(data) {
				var score;
				for (var i = 0, sum = 0; i < token_count; i++) {
					score = scoreObject(tokens[i], data);
					if (score <= 0) return 0;
					sum += score;
				}
				return sum / token_count;
			};
		} else {
			return function(data) {
				for (var i = 0, sum = 0; i < token_count; i++) {
					sum += scoreObject(tokens[i], data);
				}
				return sum / token_count;
			};
		}
	};

	/**
	 * Returns a function that can be used to compare two
	 * results, for sorting purposes. If no sorting should
	 * be performed, `null` will be returned.
	 *
	 * @param {string|object} search
	 * @param {object} options
	 * @return function(a,b)
	 */
	Sifter.prototype.getSortFunction = function(search, options) {
		var i, n, self, field, fields, fields_count, multiplier, multipliers, get_field, implicit_score, sort;

		self   = this;
		search = self.prepareSearch(search, options);
		sort   = (!search.query && options.sort_empty) || options.sort;

		/**
		 * Fetches the specified sort field value
		 * from a search result item.
		 *
		 * @param  {string} name
		 * @param  {object} result
		 * @return {mixed}
		 */
		get_field = function(name, result) {
			if (name === '$score') return result.score;
			return getattr(self.items[result.id], name, options.nesting);
		};

		// parse options
		fields = [];
		if (sort) {
			for (i = 0, n = sort.length; i < n; i++) {
				if (search.query || sort[i].field !== '$score') {
					fields.push(sort[i]);
				}
			}
		}

		// the "$score" field is implied to be the primary
		// sort field, unless it's manually specified
		if (search.query) {
			implicit_score = true;
			for (i = 0, n = fields.length; i < n; i++) {
				if (fields[i].field === '$score') {
					implicit_score = false;
					break;
				}
			}
			if (implicit_score) {
				fields.unshift({field: '$score', direction: 'desc'});
			}
		} else {
			for (i = 0, n = fields.length; i < n; i++) {
				if (fields[i].field === '$score') {
					fields.splice(i, 1);
					break;
				}
			}
		}

		multipliers = [];
		for (i = 0, n = fields.length; i < n; i++) {
			multipliers.push(fields[i].direction === 'desc' ? -1 : 1);
		}

		// build function
		fields_count = fields.length;
		if (!fields_count) {
			return null;
		} else if (fields_count === 1) {
			field = fields[0].field;
			multiplier = multipliers[0];
			return function(a, b) {
				return multiplier * cmp(
					get_field(field, a),
					get_field(field, b)
				);
			};
		} else {
			return function(a, b) {
				var i, result, a_value, b_value, field;
				for (i = 0; i < fields_count; i++) {
					field = fields[i].field;
					result = multipliers[i] * cmp(
						get_field(field, a),
						get_field(field, b)
					);
					if (result) return result;
				}
				return 0;
			};
		}
	};

	/**
	 * Parses a search query and returns an object
	 * with tokens and fields ready to be populated
	 * with results.
	 *
	 * @param {string} query
	 * @param {object} options
	 * @returns {object}
	 */
	Sifter.prototype.prepareSearch = function(query, options) {
		if (typeof query === 'object') return query;

		options = extend({}, options);

		var option_fields     = options.fields;
		var option_sort       = options.sort;
		var option_sort_empty = options.sort_empty;

		if (option_fields && !is_array(option_fields)) options.fields = [option_fields];
		if (option_sort && !is_array(option_sort)) options.sort = [option_sort];
		if (option_sort_empty && !is_array(option_sort_empty)) options.sort_empty = [option_sort_empty];

		return {
			options : options,
			query   : String(query || '').toLowerCase(),
			tokens  : this.tokenize(query),
			total   : 0,
			items   : []
		};
	};

	/**
	 * Searches through all items and returns a sorted array of matches.
	 *
	 * The `options` parameter can contain:
	 *
	 *   - fields {string|array}
	 *   - sort {array}
	 *   - score {function}
	 *   - filter {bool}
	 *   - limit {integer}
	 *
	 * Returns an object containing:
	 *
	 *   - options {object}
	 *   - query {string}
	 *   - tokens {array}
	 *   - total {int}
	 *   - items {array}
	 *
	 * @param {string} query
	 * @param {object} options
	 * @returns {object}
	 */
	Sifter.prototype.search = function(query, options) {
		var self = this, value, score, search, calculateScore;
		var fn_sort;
		var fn_score;

		search  = this.prepareSearch(query, options);
		options = search.options;
		query   = search.query;

		// generate result scoring function
		fn_score = options.score || self.getScoreFunction(search);

		// perform search and sort
		if (query.length) {
			self.iterator(self.items, function(item, id) {
				score = fn_score(item);
				if (options.filter === false || score > 0) {
					search.items.push({'score': score, 'id': id});
				}
			});
		} else {
			self.iterator(self.items, function(item, id) {
				search.items.push({'score': 1, 'id': id});
			});
		}

		fn_sort = self.getSortFunction(search, options);
		if (fn_sort) search.items.sort(fn_sort);

		// apply limits
		search.total = search.items.length;
		if (typeof options.limit === 'number') {
			search.items = search.items.slice(0, options.limit);
		}

		return search;
	};

	// utilities
	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	var cmp = function(a, b) {
		if (typeof a === 'number' && typeof b === 'number') {
			return a > b ? 1 : (a < b ? -1 : 0);
		}
		a = asciifold(String(a || ''));
		b = asciifold(String(b || ''));
		if (a > b) return 1;
		if (b > a) return -1;
		return 0;
	};

	var extend = function(a, b) {
		var i, n, k, object;
		for (i = 1, n = arguments.length; i < n; i++) {
			object = arguments[i];
			if (!object) continue;
			for (k in object) {
				if (object.hasOwnProperty(k)) {
					a[k] = object[k];
				}
			}
		}
		return a;
	};

	/**
	 * A property getter resolving dot-notation
	 * @param  {Object}  obj     The root object to fetch property on
	 * @param  {String}  name    The optionally dotted property name to fetch
	 * @param  {Boolean} nesting Handle nesting or not
	 * @return {Object}          The resolved property value
	 */
	var getattr = function(obj, name, nesting) {
	    if (!obj || !name) return;
	    if (!nesting) return obj[name];
	    var names = name.split(".");
	    while(names.length && (obj = obj[names.shift()]));
	    return obj;
	};

	var trim = function(str) {
		return (str + '').replace(/^\s+|\s+$|/g, '');
	};

	var escape_regex = function(str) {
		return (str + '').replace(/([.?*+^$[\]\\(){}|-])/g, '\\$1');
	};

	var is_array = Array.isArray || (typeof $ !== 'undefined' && $.isArray) || function(object) {
		return Object.prototype.toString.call(object) === '[object Array]';
	};

	var DIACRITICS = {
		'a': '[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]',
		'b': '[b␢βΒB฿𐌁ᛒ]',
		'c': '[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]',
		'd': '[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]',
		'e': '[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]',
		'f': '[fƑƒḞḟ]',
		'g': '[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]',
		'h': '[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]',
		'i': '[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]',
		'j': '[jȷĴĵɈɉʝɟʲ]',
		'k': '[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]',
		'l': '[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]',
		'n': '[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]',
		'o': '[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]',
		'p': '[pṔṕṖṗⱣᵽƤƥᵱ]',
		'q': '[qꝖꝗʠɊɋꝘꝙq̃]',
		'r': '[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]',
		's': '[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]',
		't': '[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]',
		'u': '[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]',
		'v': '[vṼṽṾṿƲʋꝞꝟⱱʋ]',
		'w': '[wẂẃẀẁŴŵẄẅẆẇẈẉ]',
		'x': '[xẌẍẊẋχ]',
		'y': '[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]',
		'z': '[zŹźẐẑŽžŻżẒẓẔẕƵƶ]'
	};

	var asciifold = (function() {
		var i, n, k, chunk;
		var foreignletters = '';
		var lookup = {};
		for (k in DIACRITICS) {
			if (DIACRITICS.hasOwnProperty(k)) {
				chunk = DIACRITICS[k].substring(2, DIACRITICS[k].length - 1);
				foreignletters += chunk;
				for (i = 0, n = chunk.length; i < n; i++) {
					lookup[chunk.charAt(i)] = k;
				}
			}
		}
		var regexp = new RegExp('[' +  foreignletters + ']', 'g');
		return function(str) {
			return str.replace(regexp, function(foreignletter) {
				return lookup[foreignletter];
			}).toLowerCase();
		};
	})();


	// export
	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	return Sifter;
}));


},{}],311:[function(require,module,exports){
/*
Slick Finder
*/"use strict"

// Notable changes from Slick.Finder 1.0.x

// faster bottom -> up expression matching
// prefers mental sanity over *obsessive compulsive* milliseconds savings
// uses prototypes instead of objects
// tries to use matchesSelector smartly, whenever available
// can populate objects as well as arrays
// lots of stuff is broken or not implemented

var parse = require("./parser")

// utilities

var index = 0,
    counter = document.__counter = (parseInt(document.__counter || -1, 36) + 1).toString(36),
    key = "uid:" + counter

var uniqueID = function(n, xml){
    if (n === window) return "window"
    if (n === document) return "document"
    if (n === document.documentElement) return "html"

    if (xml) {
        var uid = n.getAttribute(key)
        if (!uid) {
            uid = (index++).toString(36)
            n.setAttribute(key, uid)
        }
        return uid
    } else {
        return n[key] || (n[key] = (index++).toString(36))
    }
}

var uniqueIDXML = function(n) {
    return uniqueID(n, true)
}

var isArray = Array.isArray || function(object){
    return Object.prototype.toString.call(object) === "[object Array]"
}

// tests

var uniqueIndex = 0;

var HAS = {

    GET_ELEMENT_BY_ID: function(test, id){
        id = "slick_" + (uniqueIndex++);
        // checks if the document has getElementById, and it works
        test.innerHTML = '<a id="' + id + '"></a>'
        return !!this.getElementById(id)
    },

    QUERY_SELECTOR: function(test){
        // this supposedly fixes a webkit bug with matchesSelector / querySelector & nth-child
        test.innerHTML = '_<style>:nth-child(2){}</style>'

        // checks if the document has querySelectorAll, and it works
        test.innerHTML = '<a class="MiX"></a>'

        return test.querySelectorAll('.MiX').length === 1
    },

    EXPANDOS: function(test, id){
        id = "slick_" + (uniqueIndex++);
        // checks if the document has elements that support expandos
        test._custom_property_ = id
        return test._custom_property_ === id
    },

    // TODO: use this ?

    // CHECKED_QUERY_SELECTOR: function(test){
    //
    //     // checks if the document supports the checked query selector
    //     test.innerHTML = '<select><option selected="selected">a</option></select>'
    //     return test.querySelectorAll(':checked').length === 1
    // },

    // TODO: use this ?

    // EMPTY_ATTRIBUTE_QUERY_SELECTOR: function(test){
    //
    //     // checks if the document supports the empty attribute query selector
    //     test.innerHTML = '<a class=""></a>'
    //     return test.querySelectorAll('[class*=""]').length === 1
    // },

    MATCHES_SELECTOR: function(test){

        test.className = "MiX"

        // checks if the document has matchesSelector, and we can use it.

        var matches = test.matchesSelector || test.mozMatchesSelector || test.webkitMatchesSelector

        // if matchesSelector trows errors on incorrect syntax we can use it
        if (matches) try {
            matches.call(test, ':slick')
        } catch(e){
            // just as a safety precaution, also test if it works on mixedcase (like querySelectorAll)
            return matches.call(test, ".MiX") ? matches : false
        }

        return false
    },

    GET_ELEMENTS_BY_CLASS_NAME: function(test){
        test.innerHTML = '<a class="f"></a><a class="b"></a>'
        if (test.getElementsByClassName('b').length !== 1) return false

        test.firstChild.className = 'b'
        if (test.getElementsByClassName('b').length !== 2) return false

        // Opera 9.6 getElementsByClassName doesnt detects the class if its not the first one
        test.innerHTML = '<a class="a"></a><a class="f b a"></a>'
        if (test.getElementsByClassName('a').length !== 2) return false

        // tests passed
        return true
    },

    // no need to know

    // GET_ELEMENT_BY_ID_NOT_NAME: function(test, id){
    //     test.innerHTML = '<a name="'+ id +'"></a><b id="'+ id +'"></b>'
    //     return this.getElementById(id) !== test.firstChild
    // },

    // this is always checked for and fixed

    // STAR_GET_ELEMENTS_BY_TAG_NAME: function(test){
    //
    //     // IE returns comment nodes for getElementsByTagName('*') for some documents
    //     test.appendChild(this.createComment(''))
    //     if (test.getElementsByTagName('*').length > 0) return false
    //
    //     // IE returns closed nodes (EG:"</foo>") for getElementsByTagName('*') for some documents
    //     test.innerHTML = 'foo</foo>'
    //     if (test.getElementsByTagName('*').length) return false
    //
    //     // tests passed
    //     return true
    // },

    // this is always checked for and fixed

    // STAR_QUERY_SELECTOR: function(test){
    //
    //     // returns closed nodes (EG:"</foo>") for querySelector('*') for some documents
    //     test.innerHTML = 'foo</foo>'
    //     return !!(test.querySelectorAll('*').length)
    // },

    GET_ATTRIBUTE: function(test){
        // tests for working getAttribute implementation
        var shout = "fus ro dah"
        test.innerHTML = '<a class="' + shout + '"></a>'
        return test.firstChild.getAttribute('class') === shout
    }

}

// Finder

var Finder = function Finder(document){

    this.document        = document
    var root = this.root = document.documentElement
    this.tested          = {}

    // uniqueID

    this.uniqueID = this.has("EXPANDOS") ? uniqueID : uniqueIDXML

    // getAttribute

    this.getAttribute = (this.has("GET_ATTRIBUTE")) ? function(node, name){

        return node.getAttribute(name)

    } : function(node, name){

        node = node.getAttributeNode(name)
        return (node && node.specified) ? node.value : null

    }

    // hasAttribute

    this.hasAttribute = (root.hasAttribute) ? function(node, attribute){

        return node.hasAttribute(attribute)

    } : function(node, attribute) {

        node = node.getAttributeNode(attribute)
        return !!(node && node.specified)

    }

    // contains

    this.contains = (document.contains && root.contains) ? function(context, node){

        return context.contains(node)

    } : (root.compareDocumentPosition) ? function(context, node){

        return context === node || !!(context.compareDocumentPosition(node) & 16)

    } : function(context, node){

        do {
            if (node === context) return true
        } while ((node = node.parentNode))

        return false
    }

    // sort
    // credits to Sizzle (http://sizzlejs.com/)

    this.sorter = (root.compareDocumentPosition) ? function(a, b){

        if (!a.compareDocumentPosition || !b.compareDocumentPosition) return 0
        return a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1

    } : ('sourceIndex' in root) ? function(a, b){

        if (!a.sourceIndex || !b.sourceIndex) return 0
        return a.sourceIndex - b.sourceIndex

    } : (document.createRange) ? function(a, b){

        if (!a.ownerDocument || !b.ownerDocument) return 0
        var aRange = a.ownerDocument.createRange(),
            bRange = b.ownerDocument.createRange()

        aRange.setStart(a, 0)
        aRange.setEnd(a, 0)
        bRange.setStart(b, 0)
        bRange.setEnd(b, 0)
        return aRange.compareBoundaryPoints(Range.START_TO_END, bRange)

    } : null

    this.failed = {}

    var nativeMatches = this.has("MATCHES_SELECTOR")

    if (nativeMatches) this.matchesSelector = function(node, expression){

        if (this.failed[expression]) return null

        try {
            return nativeMatches.call(node, expression)
        } catch(e){
            if (slick.debug) console.warn("matchesSelector failed on " + expression)
            this.failed[expression] = true
            return null
        }

    }

    if (this.has("QUERY_SELECTOR")){

        this.querySelectorAll = function(node, expression){

            if (this.failed[expression]) return true

            var result, _id, _expression, _combinator, _node


            // non-document rooted QSA
            // credits to Andrew Dupont

            if (node !== this.document){

                _combinator = expression[0].combinator

                _id         = node.getAttribute("id")
                _expression = expression

                if (!_id){
                    _node = node
                    _id = "__slick__"
                    _node.setAttribute("id", _id)
                }

                expression = "#" + _id + " " + _expression


                // these combinators need a parentNode due to how querySelectorAll works, which is:
                // finding all the elements that match the given selector
                // then filtering by the ones that have the specified element as an ancestor
                if (_combinator.indexOf("~") > -1 || _combinator.indexOf("+") > -1){

                    node = node.parentNode
                    if (!node) result = true
                    // if node has no parentNode, we return "true" as if it failed, without polluting the failed cache

                }

            }

            if (!result) try {
                result = node.querySelectorAll(expression.toString())
            } catch(e){
                if (slick.debug) console.warn("querySelectorAll failed on " + (_expression || expression))
                result = this.failed[_expression || expression] = true
            }

            if (_node) _node.removeAttribute("id")

            return result

        }

    }

}

Finder.prototype.has = function(FEATURE){

    var tested        = this.tested,
        testedFEATURE = tested[FEATURE]

    if (testedFEATURE != null) return testedFEATURE

    var root     = this.root,
        document = this.document,
        testNode = document.createElement("div")

    testNode.setAttribute("style", "display: none;")

    root.appendChild(testNode)

    var TEST = HAS[FEATURE], result = false

    if (TEST) try {
        result = TEST.call(document, testNode)
    } catch(e){}

    if (slick.debug && !result) console.warn("document has no " + FEATURE)

    root.removeChild(testNode)

    return tested[FEATURE] = result

}

var combinators = {

    " ": function(node, part, push){

        var item, items

        var noId = !part.id, noTag = !part.tag, noClass = !part.classes

        if (part.id && node.getElementById && this.has("GET_ELEMENT_BY_ID")){
            item = node.getElementById(part.id)

            // return only if id is found, else keep checking
            // might be a tad slower on non-existing ids, but less insane

            if (item && item.getAttribute('id') === part.id){
                items = [item]
                noId = true
                // if tag is star, no need to check it in match()
                if (part.tag === "*") noTag = true
            }
        }

        if (!items){

            if (part.classes && node.getElementsByClassName && this.has("GET_ELEMENTS_BY_CLASS_NAME")){
                items = node.getElementsByClassName(part.classList)
                noClass = true
                // if tag is star, no need to check it in match()
                if (part.tag === "*") noTag = true
            } else {
                items = node.getElementsByTagName(part.tag)
                // if tag is star, need to check it in match because it could select junk, boho
                if (part.tag !== "*") noTag = true
            }

            if (!items || !items.length) return false

        }

        for (var i = 0; item = items[i++];)
            if ((noTag && noId && noClass && !part.attributes && !part.pseudos) || this.match(item, part, noTag, noId, noClass))
                push(item)

        return true

    },

    ">": function(node, part, push){ // direct children
        if ((node = node.firstChild)) do {
            if (node.nodeType == 1 && this.match(node, part)) push(node)
        } while ((node = node.nextSibling))
    },

    "+": function(node, part, push){ // next sibling
        while ((node = node.nextSibling)) if (node.nodeType == 1){
            if (this.match(node, part)) push(node)
            break
        }
    },

    "^": function(node, part, push){ // first child
        node = node.firstChild
        if (node){
            if (node.nodeType === 1){
                if (this.match(node, part)) push(node)
            } else {
                combinators['+'].call(this, node, part, push)
            }
        }
    },

    "~": function(node, part, push){ // next siblings
        while ((node = node.nextSibling)){
            if (node.nodeType === 1 && this.match(node, part)) push(node)
        }
    },

    "++": function(node, part, push){ // next sibling and previous sibling
        combinators['+'].call(this, node, part, push)
        combinators['!+'].call(this, node, part, push)
    },

    "~~": function(node, part, push){ // next siblings and previous siblings
        combinators['~'].call(this, node, part, push)
        combinators['!~'].call(this, node, part, push)
    },

    "!": function(node, part, push){ // all parent nodes up to document
        while ((node = node.parentNode)) if (node !== this.document && this.match(node, part)) push(node)
    },

    "!>": function(node, part, push){ // direct parent (one level)
        node = node.parentNode
        if (node !== this.document && this.match(node, part)) push(node)
    },

    "!+": function(node, part, push){ // previous sibling
        while ((node = node.previousSibling)) if (node.nodeType == 1){
            if (this.match(node, part)) push(node)
            break
        }
    },

    "!^": function(node, part, push){ // last child
        node = node.lastChild
        if (node){
            if (node.nodeType == 1){
                if (this.match(node, part)) push(node)
            } else {
                combinators['!+'].call(this, node, part, push)
            }
        }
    },

    "!~": function(node, part, push){ // previous siblings
        while ((node = node.previousSibling)){
            if (node.nodeType === 1 && this.match(node, part)) push(node)
        }
    }

}

Finder.prototype.search = function(context, expression, found){

    if (!context) context = this.document
    else if (!context.nodeType && context.document) context = context.document

    var expressions = parse(expression)

    // no expressions were parsed. todo: is this really necessary?
    if (!expressions || !expressions.length) throw new Error("invalid expression")

    if (!found) found = []

    var uniques, push = isArray(found) ? function(node){
        found[found.length] = node
    } : function(node){
        found[found.length++] = node
    }

    // if there is more than one expression we need to check for duplicates when we push to found
    // this simply saves the old push and wraps it around an uid dupe check.
    if (expressions.length > 1){
        uniques = {}
        var plush = push
        push = function(node){
            var uid = uniqueID(node)
            if (!uniques[uid]){
                uniques[uid] = true
                plush(node)
            }
        }
    }

    // walker

    var node, nodes, part

    main: for (var i = 0; expression = expressions[i++];){

        // querySelector

        // TODO: more functional tests

        // if there is querySelectorAll (and the expression does not fail) use it.
        if (!slick.noQSA && this.querySelectorAll){

            nodes = this.querySelectorAll(context, expression)
            if (nodes !== true){
                if (nodes && nodes.length) for (var j = 0; node = nodes[j++];) if (node.nodeName > '@'){
                    push(node)
                }
                continue main
            }
        }

        // if there is only one part in the expression we don't need to check each part for duplicates.
        // todo: this might be too naive. while solid, there can be expression sequences that do not
        // produce duplicates. "body div" for instance, can never give you each div more than once.
        // "body div a" on the other hand might.
        if (expression.length === 1){

            part = expression[0]
            combinators[part.combinator].call(this, context, part, push)

        } else {

            var cs = [context], c, f, u, p = function(node){
                var uid = uniqueID(node)
                if (!u[uid]){
                    u[uid] = true
                    f[f.length] = node
                }
            }

            // loop the expression parts
            for (var j = 0; part = expression[j++];){
                f = []; u = {}
                // loop the contexts
                for (var k = 0; c = cs[k++];) combinators[part.combinator].call(this, c, part, p)
                // nothing was found, the expression failed, continue to the next expression.
                if (!f.length) continue main
                cs = f // set the contexts for future parts (if any)
            }

            if (i === 0) found = f // first expression. directly set found.
            else for (var l = 0; l < f.length; l++) push(f[l]) // any other expression needs to push to found.
        }

    }

    if (uniques && found && found.length > 1) this.sort(found)

    return found

}

Finder.prototype.sort = function(nodes){
    return this.sorter ? Array.prototype.sort.call(nodes, this.sorter) : nodes
}

// TODO: most of these pseudo selectors include <html> and qsa doesnt. fixme.

var pseudos = {


    // TODO: returns different results than qsa empty.

    'empty': function(){
        return !(this && this.nodeType === 1) && !(this.innerText || this.textContent || '').length
    },

    'not': function(expression){
        return !slick.matches(this, expression)
    },

    'contains': function(text){
        return (this.innerText || this.textContent || '').indexOf(text) > -1
    },

    'first-child': function(){
        var node = this
        while ((node = node.previousSibling)) if (node.nodeType == 1) return false
        return true
    },

    'last-child': function(){
        var node = this
        while ((node = node.nextSibling)) if (node.nodeType == 1) return false
        return true
    },

    'only-child': function(){
        var prev = this
        while ((prev = prev.previousSibling)) if (prev.nodeType == 1) return false

        var next = this
        while ((next = next.nextSibling)) if (next.nodeType == 1) return false

        return true
    },

    'first-of-type': function(){
        var node = this, nodeName = node.nodeName
        while ((node = node.previousSibling)) if (node.nodeName == nodeName) return false
        return true
    },

    'last-of-type': function(){
        var node = this, nodeName = node.nodeName
        while ((node = node.nextSibling)) if (node.nodeName == nodeName) return false
        return true
    },

    'only-of-type': function(){
        var prev = this, nodeName = this.nodeName
        while ((prev = prev.previousSibling)) if (prev.nodeName == nodeName) return false
        var next = this
        while ((next = next.nextSibling)) if (next.nodeName == nodeName) return false
        return true
    },

    'enabled': function(){
        return !this.disabled
    },

    'disabled': function(){
        return this.disabled
    },

    'checked': function(){
        return this.checked || this.selected
    },

    'selected': function(){
        return this.selected
    },

    'focus': function(){
        var doc = this.ownerDocument
        return doc.activeElement === this && (this.href || this.type || slick.hasAttribute(this, 'tabindex'))
    },

    'root': function(){
        return (this === this.ownerDocument.documentElement)
    }

}

Finder.prototype.match = function(node, bit, noTag, noId, noClass){

    // TODO: more functional tests ?

    if (!slick.noQSA && this.matchesSelector){
        var matches = this.matchesSelector(node, bit)
        if (matches !== null) return matches
    }

    // normal matching

    if (!noTag && bit.tag){

        var nodeName = node.nodeName.toLowerCase()
        if (bit.tag === "*"){
            if (nodeName < "@") return false
        } else if (nodeName != bit.tag){
            return false
        }

    }

    if (!noId && bit.id && node.getAttribute('id') !== bit.id) return false

    var i, part

    if (!noClass && bit.classes){

        var className = this.getAttribute(node, "class")
        if (!className) return false

        for (part in bit.classes) if (!RegExp('(^|\\s)' + bit.classes[part] + '(\\s|$)').test(className)) return false
    }

    var name, value

    if (bit.attributes) for (i = 0; part = bit.attributes[i++];){

        var operator  = part.operator,
            escaped   = part.escapedValue

        name  = part.name
        value = part.value

        if (!operator){

            if (!this.hasAttribute(node, name)) return false

        } else {

            var actual = this.getAttribute(node, name)
            if (actual == null) return false

            switch (operator){
                case '^=' : if (!RegExp(      '^' + escaped            ).test(actual)) return false; break
                case '$=' : if (!RegExp(            escaped + '$'      ).test(actual)) return false; break
                case '~=' : if (!RegExp('(^|\\s)' + escaped + '(\\s|$)').test(actual)) return false; break
                case '|=' : if (!RegExp(      '^' + escaped + '(-|$)'  ).test(actual)) return false; break

                case '='  : if (actual !== value) return false; break
                case '*=' : if (actual.indexOf(value) === -1) return false; break
                default   : return false
            }

        }
    }

    if (bit.pseudos) for (i = 0; part = bit.pseudos[i++];){

        name  = part.name
        value = part.value

        if (pseudos[name]) return pseudos[name].call(node, value)

        if (value != null){
            if (this.getAttribute(node, name) !== value) return false
        } else {
            if (!this.hasAttribute(node, name)) return false
        }

    }

    return true

}

Finder.prototype.matches = function(node, expression){

    var expressions = parse(expression)

    if (expressions.length === 1 && expressions[0].length === 1){ // simplest match
        return this.match(node, expressions[0][0])
    }

    // TODO: more functional tests ?

    if (!slick.noQSA && this.matchesSelector){
        var matches = this.matchesSelector(node, expressions)
        if (matches !== null) return matches
    }

    var nodes = this.search(this.document, expression, {length: 0})

    for (var i = 0, res; res = nodes[i++];) if (node === res) return true
    return false

}

var finders = {}

var finder = function(context){
    var doc = context || document
    if (doc.ownerDocument) doc = doc.ownerDocument
    else if (doc.document) doc = doc.document

    if (doc.nodeType !== 9) throw new TypeError("invalid document")

    var uid = uniqueID(doc)
    return finders[uid] || (finders[uid] = new Finder(doc))
}

// ... API ...

var slick = function(expression, context){
    return slick.search(expression, context)
}

slick.search = function(expression, context, found){
    return finder(context).search(context, expression, found)
}

slick.find = function(expression, context){
    return finder(context).search(context, expression)[0] || null
}

slick.getAttribute = function(node, name){
    return finder(node).getAttribute(node, name)
}

slick.hasAttribute = function(node, name){
    return finder(node).hasAttribute(node, name)
}

slick.contains = function(context, node){
    return finder(context).contains(context, node)
}

slick.matches = function(node, expression){
    return finder(node).matches(node, expression)
}

slick.sort = function(nodes){
    if (nodes && nodes.length > 1) finder(nodes[0]).sort(nodes)
    return nodes
}

slick.parse = parse;

// slick.debug = true
// slick.noQSA  = true

module.exports = slick

},{"./parser":313}],312:[function(require,module,exports){
(function (global){
/*
slick
*/"use strict"

module.exports = "document" in global ? require("./finder") : { parse: require("./parser") }

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./finder":311,"./parser":313}],313:[function(require,module,exports){
/*
Slick Parser
 - originally created by the almighty Thomas Aylott <@subtlegradient> (http://subtlegradient.com)
*/"use strict"

// Notable changes from Slick.Parser 1.0.x

// The parser now uses 2 classes: Expressions and Expression
// `new Expressions` produces an array-like object containing a list of Expression objects
// - Expressions::toString() produces a cleaned up expressions string
// `new Expression` produces an array-like object
// - Expression::toString() produces a cleaned up expression string
// The only exposed method is parse, which produces a (cached) `new Expressions` instance
// parsed.raw is no longer present, use .toString()
// parsed.expression is now useless, just use the indices
// parsed.reverse() has been removed for now, due to its apparent uselessness
// Other changes in the Expressions object:
// - classNames are now unique, and save both escaped and unescaped values
// - attributes now save both escaped and unescaped values
// - pseudos now save both escaped and unescaped values

var escapeRe   = /([-.*+?^${}()|[\]\/\\])/g,
    unescapeRe = /\\/g

var escape = function(string){
    // XRegExp v2.0.0-beta-3
    // « https://github.com/slevithan/XRegExp/blob/master/src/xregexp.js
    return (string + "").replace(escapeRe, '\\$1')
}

var unescape = function(string){
    return (string + "").replace(unescapeRe, '')
}

var slickRe = RegExp(
/*
#!/usr/bin/env ruby
puts "\t\t" + DATA.read.gsub(/\(\?x\)|\s+#.*$|\s+|\\$|\\n/,'')
__END__
    "(?x)^(?:\
      \\s* ( , ) \\s*               # Separator          \n\
    | \\s* ( <combinator>+ ) \\s*   # Combinator         \n\
    |      ( \\s+ )                 # CombinatorChildren \n\
    |      ( <unicode>+ | \\* )     # Tag                \n\
    | \\#  ( <unicode>+       )     # ID                 \n\
    | \\.  ( <unicode>+       )     # ClassName          \n\
    |                               # Attribute          \n\
    \\[  \
        \\s* (<unicode1>+)  (?:  \
            \\s* ([*^$!~|]?=)  (?:  \
                \\s* (?:\
                    ([\"']?)(.*?)\\9 \
                )\
            )  \
        )?  \\s*  \
    \\](?!\\]) \n\
    |   :+ ( <unicode>+ )(?:\
    \\( (?:\
        (?:([\"'])([^\\12]*)\\12)|((?:\\([^)]+\\)|[^()]*)+)\
    ) \\)\
    )?\
    )"
*/
"^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)"
    .replace(/<combinator>/, '[' + escape(">+~`!@$%^&={}\\;</") + ']')
    .replace(/<unicode>/g, '(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])')
    .replace(/<unicode1>/g, '(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])')
)

// Part

var Part = function Part(combinator){
    this.combinator = combinator || " "
    this.tag = "*"
}

Part.prototype.toString = function(){

    if (!this.raw){

        var xpr = "", k, part

        xpr += this.tag || "*"
        if (this.id) xpr += "#" + this.id
        if (this.classes) xpr += "." + this.classList.join(".")
        if (this.attributes) for (k = 0; part = this.attributes[k++];){
            xpr += "[" + part.name + (part.operator ? part.operator + '"' + part.value + '"' : '') + "]"
        }
        if (this.pseudos) for (k = 0; part = this.pseudos[k++];){
            xpr += ":" + part.name
            if (part.value) xpr += "(" + part.value + ")"
        }

        this.raw = xpr

    }

    return this.raw
}

// Expression

var Expression = function Expression(){
    this.length = 0
}

Expression.prototype.toString = function(){

    if (!this.raw){

        var xpr = ""

        for (var j = 0, bit; bit = this[j++];){
            if (j !== 1) xpr += " "
            if (bit.combinator !== " ") xpr += bit.combinator + " "
            xpr += bit
        }

        this.raw = xpr

    }

    return this.raw
}

var replacer = function(
    rawMatch,

    separator,
    combinator,
    combinatorChildren,

    tagName,
    id,
    className,

    attributeKey,
    attributeOperator,
    attributeQuote,
    attributeValue,

    pseudoMarker,
    pseudoClass,
    pseudoQuote,
    pseudoClassQuotedValue,
    pseudoClassValue
){

    var expression, current

    if (separator || !this.length){
        expression = this[this.length++] = new Expression
        if (separator) return ''
    }

    if (!expression) expression = this[this.length - 1]

    if (combinator || combinatorChildren || !expression.length){
        current = expression[expression.length++] = new Part(combinator)
    }

    if (!current) current = expression[expression.length - 1]

    if (tagName){

        current.tag = unescape(tagName)

    } else if (id){

        current.id = unescape(id)

    } else if (className){

        var unescaped = unescape(className)

        var classes = current.classes || (current.classes = {})
        if (!classes[unescaped]){
            classes[unescaped] = escape(className)
            var classList = current.classList || (current.classList = [])
            classList.push(unescaped)
            classList.sort()
        }

    } else if (pseudoClass){

        pseudoClassValue = pseudoClassValue || pseudoClassQuotedValue

        ;(current.pseudos || (current.pseudos = [])).push({
            type         : pseudoMarker.length == 1 ? 'class' : 'element',
            name         : unescape(pseudoClass),
            escapedName  : escape(pseudoClass),
            value        : pseudoClassValue ? unescape(pseudoClassValue) : null,
            escapedValue : pseudoClassValue ? escape(pseudoClassValue) : null
        })

    } else if (attributeKey){

        attributeValue = attributeValue ? escape(attributeValue) : null

        ;(current.attributes || (current.attributes = [])).push({
            operator     : attributeOperator,
            name         : unescape(attributeKey),
            escapedName  : escape(attributeKey),
            value        : attributeValue ? unescape(attributeValue) : null,
            escapedValue : attributeValue ? escape(attributeValue) : null
        })

    }

    return ''

}

// Expressions

var Expressions = function Expressions(expression){
    this.length = 0

    var self = this

    var original = expression, replaced

    while (expression){
        replaced = expression.replace(slickRe, function(){
            return replacer.apply(self, arguments)
        })
        if (replaced === expression) throw new Error(original + ' is an invalid expression')
        expression = replaced
    }
}

Expressions.prototype.toString = function(){
    if (!this.raw){
        var expressions = []
        for (var i = 0, expression; expression = this[i++];) expressions.push(expression)
        this.raw = expressions.join(", ")
    }

    return this.raw
}

var cache = {}

var parse = function(expression){
    if (expression == null) return null
    expression = ('' + expression).replace(/^\s+|\s+$/g, '')
    return cache[expression] || (cache[expression] = new Expressions(expression))
}

module.exports = parse

},{}],314:[function(require,module,exports){
/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */


(function (factory) {
	"use strict";

	if (typeof define === "function" && define.amd) {
		define(factory);
	}
	else if (typeof module != "undefined" && typeof module.exports != "undefined") {
		module.exports = factory();
	}
	else if (typeof Package !== "undefined") {
		Sortable = factory();  // export for Meteor.js
	}
	else {
		/* jshint sub:true */
		window["Sortable"] = factory();
	}
})(function () {
	"use strict";

	if (typeof window == "undefined" || typeof window.document == "undefined") {
		return function() {
			throw new Error( "Sortable.js requires a window with a document" );
		}
	}

	var dragEl,
		parentEl,
		ghostEl,
		cloneEl,
		rootEl,
		nextEl,

		scrollEl,
		scrollParentEl,

		lastEl,
		lastCSS,
		lastParentCSS,

		oldIndex,
		newIndex,

		activeGroup,
		autoScroll = {},

		tapEvt,
		touchEvt,

		moved,

		/** @const */
		RSPACE = /\s+/g,

		expando = 'Sortable' + (new Date).getTime(),

		win = window,
		document = win.document,
		parseInt = win.parseInt,

		supportDraggable = !!('draggable' in document.createElement('div')),
		supportCssPointerEvents = (function (el) {
			el = document.createElement('x');
			el.style.cssText = 'pointer-events:auto';
			return el.style.pointerEvents === 'auto';
		})(),

		_silent = false,

		abs = Math.abs,
		slice = [].slice,

		touchDragOverListeners = [],

		_autoScroll = _throttle(function (/**Event*/evt, /**Object*/options, /**HTMLElement*/rootEl) {
			// Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521
			if (rootEl && options.scroll) {
				var el,
					rect,
					sens = options.scrollSensitivity,
					speed = options.scrollSpeed,

					x = evt.clientX,
					y = evt.clientY,

					winWidth = window.innerWidth,
					winHeight = window.innerHeight,

					vx,
					vy
				;

				// Delect scrollEl
				if (scrollParentEl !== rootEl) {
					scrollEl = options.scroll;
					scrollParentEl = rootEl;

					if (scrollEl === true) {
						scrollEl = rootEl;

						do {
							if ((scrollEl.offsetWidth < scrollEl.scrollWidth) ||
								(scrollEl.offsetHeight < scrollEl.scrollHeight)
							) {
								break;
							}
							/* jshint boss:true */
						} while (scrollEl = scrollEl.parentNode);
					}
				}

				if (scrollEl) {
					el = scrollEl;
					rect = scrollEl.getBoundingClientRect();
					vx = (abs(rect.right - x) <= sens) - (abs(rect.left - x) <= sens);
					vy = (abs(rect.bottom - y) <= sens) - (abs(rect.top - y) <= sens);
				}


				if (!(vx || vy)) {
					vx = (winWidth - x <= sens) - (x <= sens);
					vy = (winHeight - y <= sens) - (y <= sens);

					/* jshint expr:true */
					(vx || vy) && (el = win);
				}


				if (autoScroll.vx !== vx || autoScroll.vy !== vy || autoScroll.el !== el) {
					autoScroll.el = el;
					autoScroll.vx = vx;
					autoScroll.vy = vy;

					clearInterval(autoScroll.pid);

					if (el) {
						autoScroll.pid = setInterval(function () {
							if (el === win) {
								win.scrollTo(win.pageXOffset + vx * speed, win.pageYOffset + vy * speed);
							} else {
								vy && (el.scrollTop += vy * speed);
								vx && (el.scrollLeft += vx * speed);
							}
						}, 24);
					}
				}
			}
		}, 30),

		_prepareGroup = function (options) {
			var group = options.group;

			if (!group || typeof group != 'object') {
				group = options.group = {name: group};
			}

			['pull', 'put'].forEach(function (key) {
				if (!(key in group)) {
					group[key] = true;
				}
			});

			options.groups = ' ' + group.name + (group.put.join ? ' ' + group.put.join(' ') : '') + ' ';
		}
	;



	/**
	 * @class  Sortable
	 * @param  {HTMLElement}  el
	 * @param  {Object}       [options]
	 */
	function Sortable(el, options) {
		if (!(el && el.nodeType && el.nodeType === 1)) {
			throw 'Sortable: `el` must be HTMLElement, and not ' + {}.toString.call(el);
		}

		this.el = el; // root element
		this.options = options = _extend({}, options);


		// Export instance
		el[expando] = this;


		// Default options
		var defaults = {
			group: Math.random(),
			sort: true,
			disabled: false,
			store: null,
			handle: null,
			scroll: true,
			scrollSensitivity: 30,
			scrollSpeed: 10,
			draggable: /[uo]l/i.test(el.nodeName) ? 'li' : '>*',
			ghostClass: 'sortable-ghost',
			chosenClass: 'sortable-chosen',
			ignore: 'a, img',
			filter: null,
			animation: 0,
			setData: function (dataTransfer, dragEl) {
				dataTransfer.setData('Text', dragEl.textContent);
			},
			dropBubble: false,
			dragoverBubble: false,
			dataIdAttr: 'data-id',
			delay: 0,
			forceFallback: false,
			fallbackClass: 'sortable-fallback',
			fallbackOnBody: false
		};


		// Set default options
		for (var name in defaults) {
			!(name in options) && (options[name] = defaults[name]);
		}

		_prepareGroup(options);

		// Bind all private methods
		for (var fn in this) {
			if (fn.charAt(0) === '_') {
				this[fn] = this[fn].bind(this);
			}
		}

		// Setup drag mode
		this.nativeDraggable = options.forceFallback ? false : supportDraggable;

		// Bind events
		_on(el, 'mousedown', this._onTapStart);
		_on(el, 'touchstart', this._onTapStart);

		if (this.nativeDraggable) {
			_on(el, 'dragover', this);
			_on(el, 'dragenter', this);
		}

		touchDragOverListeners.push(this._onDragOver);

		// Restore sorting
		options.store && this.sort(options.store.get(this));
	}


	Sortable.prototype = /** @lends Sortable.prototype */ {
		constructor: Sortable,

		_onTapStart: function (/** Event|TouchEvent */evt) {
			var _this = this,
				el = this.el,
				options = this.options,
				type = evt.type,
				touch = evt.touches && evt.touches[0],
				target = (touch || evt).target,
				originalTarget = target,
				filter = options.filter;


			if (type === 'mousedown' && evt.button !== 0 || options.disabled) {
				return; // only left button or enabled
			}

			target = _closest(target, options.draggable, el);

			if (!target) {
				return;
			}

			// get the index of the dragged element within its parent
			oldIndex = _index(target, options.draggable);

			// Check filter
			if (typeof filter === 'function') {
				if (filter.call(this, evt, target, this)) {
					_dispatchEvent(_this, originalTarget, 'filter', target, el, oldIndex);
					evt.preventDefault();
					return; // cancel dnd
				}
			}
			else if (filter) {
				filter = filter.split(',').some(function (criteria) {
					criteria = _closest(originalTarget, criteria.trim(), el);

					if (criteria) {
						_dispatchEvent(_this, criteria, 'filter', target, el, oldIndex);
						return true;
					}
				});

				if (filter) {
					evt.preventDefault();
					return; // cancel dnd
				}
			}


			if (options.handle && !_closest(originalTarget, options.handle, el)) {
				return;
			}


			// Prepare `dragstart`
			this._prepareDragStart(evt, touch, target);
		},

		_prepareDragStart: function (/** Event */evt, /** Touch */touch, /** HTMLElement */target) {
			var _this = this,
				el = _this.el,
				options = _this.options,
				ownerDocument = el.ownerDocument,
				dragStartFn;

			if (target && !dragEl && (target.parentNode === el)) {
				tapEvt = evt;

				rootEl = el;
				dragEl = target;
				parentEl = dragEl.parentNode;
				nextEl = dragEl.nextSibling;
				activeGroup = options.group;

				dragStartFn = function () {
					// Delayed drag has been triggered
					// we can re-enable the events: touchmove/mousemove
					_this._disableDelayedDrag();

					// Make the element draggable
					dragEl.draggable = true;

					// Chosen item
					_toggleClass(dragEl, _this.options.chosenClass, true);

					// Bind the events: dragstart/dragend
					_this._triggerDragStart(touch);
				};

				// Disable "draggable"
				options.ignore.split(',').forEach(function (criteria) {
					_find(dragEl, criteria.trim(), _disableDraggable);
				});

				_on(ownerDocument, 'mouseup', _this._onDrop);
				_on(ownerDocument, 'touchend', _this._onDrop);
				_on(ownerDocument, 'touchcancel', _this._onDrop);

				if (options.delay) {
					// If the user moves the pointer or let go the click or touch
					// before the delay has been reached:
					// disable the delayed drag
					_on(ownerDocument, 'mouseup', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchend', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);
					_on(ownerDocument, 'mousemove', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchmove', _this._disableDelayedDrag);

					_this._dragStartTimer = setTimeout(dragStartFn, options.delay);
				} else {
					dragStartFn();
				}
			}
		},

		_disableDelayedDrag: function () {
			var ownerDocument = this.el.ownerDocument;

			clearTimeout(this._dragStartTimer);
			_off(ownerDocument, 'mouseup', this._disableDelayedDrag);
			_off(ownerDocument, 'touchend', this._disableDelayedDrag);
			_off(ownerDocument, 'touchcancel', this._disableDelayedDrag);
			_off(ownerDocument, 'mousemove', this._disableDelayedDrag);
			_off(ownerDocument, 'touchmove', this._disableDelayedDrag);
		},

		_triggerDragStart: function (/** Touch */touch) {
			if (touch) {
				// Touch device support
				tapEvt = {
					target: dragEl,
					clientX: touch.clientX,
					clientY: touch.clientY
				};

				this._onDragStart(tapEvt, 'touch');
			}
			else if (!this.nativeDraggable) {
				this._onDragStart(tapEvt, true);
			}
			else {
				_on(dragEl, 'dragend', this);
				_on(rootEl, 'dragstart', this._onDragStart);
			}

			try {
				if (document.selection) {
					document.selection.empty();
				} else {
					window.getSelection().removeAllRanges();
				}
			} catch (err) {
			}
		},

		_dragStarted: function () {
			if (rootEl && dragEl) {
				// Apply effect
				_toggleClass(dragEl, this.options.ghostClass, true);

				Sortable.active = this;

				// Drag start event
				_dispatchEvent(this, rootEl, 'start', dragEl, rootEl, oldIndex);
			}
		},

		_emulateDragOver: function () {
			if (touchEvt) {
				if (this._lastX === touchEvt.clientX && this._lastY === touchEvt.clientY) {
					return;
				}

				this._lastX = touchEvt.clientX;
				this._lastY = touchEvt.clientY;

				if (!supportCssPointerEvents) {
					_css(ghostEl, 'display', 'none');
				}

				var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY),
					parent = target,
					groupName = ' ' + this.options.group.name + '',
					i = touchDragOverListeners.length;

				if (parent) {
					do {
						if (parent[expando] && parent[expando].options.groups.indexOf(groupName) > -1) {
							while (i--) {
								touchDragOverListeners[i]({
									clientX: touchEvt.clientX,
									clientY: touchEvt.clientY,
									target: target,
									rootEl: parent
								});
							}

							break;
						}

						target = parent; // store last element
					}
					/* jshint boss:true */
					while (parent = parent.parentNode);
				}

				if (!supportCssPointerEvents) {
					_css(ghostEl, 'display', '');
				}
			}
		},


		_onTouchMove: function (/**TouchEvent*/evt) {
			if (tapEvt) {
				// only set the status to dragging, when we are actually dragging
				if (!Sortable.active) {
					this._dragStarted();
				}

				// as well as creating the ghost element on the document body
				this._appendGhost();

				var touch = evt.touches ? evt.touches[0] : evt,
					dx = touch.clientX - tapEvt.clientX,
					dy = touch.clientY - tapEvt.clientY,
					translate3d = evt.touches ? 'translate3d(' + dx + 'px,' + dy + 'px,0)' : 'translate(' + dx + 'px,' + dy + 'px)';

				moved = true;
				touchEvt = touch;

				_css(ghostEl, 'webkitTransform', translate3d);
				_css(ghostEl, 'mozTransform', translate3d);
				_css(ghostEl, 'msTransform', translate3d);
				_css(ghostEl, 'transform', translate3d);

				evt.preventDefault();
			}
		},

		_appendGhost: function () {
			if (!ghostEl) {
				var rect = dragEl.getBoundingClientRect(),
					css = _css(dragEl),
					options = this.options,
					ghostRect;

				ghostEl = dragEl.cloneNode(true);

				_toggleClass(ghostEl, options.ghostClass, false);
				_toggleClass(ghostEl, options.fallbackClass, true);

				_css(ghostEl, 'top', rect.top - parseInt(css.marginTop, 10));
				_css(ghostEl, 'left', rect.left - parseInt(css.marginLeft, 10));
				_css(ghostEl, 'width', rect.width);
				_css(ghostEl, 'height', rect.height);
				_css(ghostEl, 'opacity', '0.8');
				_css(ghostEl, 'position', 'fixed');
				_css(ghostEl, 'zIndex', '100000');
				_css(ghostEl, 'pointerEvents', 'none');

				options.fallbackOnBody && document.body.appendChild(ghostEl) || rootEl.appendChild(ghostEl);

				// Fixing dimensions.
				ghostRect = ghostEl.getBoundingClientRect();
				_css(ghostEl, 'width', rect.width * 2 - ghostRect.width);
				_css(ghostEl, 'height', rect.height * 2 - ghostRect.height);
			}
		},

		_onDragStart: function (/**Event*/evt, /**boolean*/useFallback) {
			var dataTransfer = evt.dataTransfer,
				options = this.options;

			this._offUpEvents();

			if (activeGroup.pull == 'clone') {
				cloneEl = dragEl.cloneNode(true);
				_css(cloneEl, 'display', 'none');
				rootEl.insertBefore(cloneEl, dragEl);
			}

			if (useFallback) {

				if (useFallback === 'touch') {
					// Bind touch events
					_on(document, 'touchmove', this._onTouchMove);
					_on(document, 'touchend', this._onDrop);
					_on(document, 'touchcancel', this._onDrop);
				} else {
					// Old brwoser
					_on(document, 'mousemove', this._onTouchMove);
					_on(document, 'mouseup', this._onDrop);
				}

				this._loopId = setInterval(this._emulateDragOver, 50);
			}
			else {
				if (dataTransfer) {
					dataTransfer.effectAllowed = 'move';
					options.setData && options.setData.call(this, dataTransfer, dragEl);
				}

				_on(document, 'drop', this);
				setTimeout(this._dragStarted, 0);
			}
		},

		_onDragOver: function (/**Event*/evt) {
			var el = this.el,
				target,
				dragRect,
				revert,
				options = this.options,
				group = options.group,
				groupPut = group.put,
				isOwner = (activeGroup === group),
				canSort = options.sort;

			if (evt.preventDefault !== void 0) {
				evt.preventDefault();
				!options.dragoverBubble && evt.stopPropagation();
			}

			moved = true;

			_dispatchEvent(this, rootEl, 'over', dragEl, rootEl, evt, evt.target); // Gantry 5
			if (activeGroup && !options.disabled &&
				(isOwner
					? canSort || (revert = !rootEl.contains(dragEl)) // Reverting item into the original list
					: activeGroup.pull && groupPut && (
						(activeGroup.name === group.name) || // by Name
						(groupPut.indexOf && ~groupPut.indexOf(activeGroup.name)) // by Array
					)
				) &&
				(evt.rootEl === void 0 || evt.rootEl === this.el) // touch fallback
			) {
				// Smart auto-scrolling
				_autoScroll(evt, options, this.el);

				if (_silent) {
					return;
				}

				target = _closest(evt.target, options.draggable, el);
				dragRect = dragEl.getBoundingClientRect();

				if (revert) {
					_cloneHide(true);

					if (cloneEl || nextEl) {
						rootEl.insertBefore(dragEl, cloneEl || nextEl);
					}
					else if (!canSort) {
						rootEl.appendChild(dragEl);
					}

					return;
				}


				if ((el.children.length === 0) || (el.children[0] === ghostEl) ||
					(el === evt.target) && (target = _ghostIsLast(el, evt))
				) {

					if (target) {
						if (target.animated) {
							return;
						}

						targetRect = target.getBoundingClientRect();
					}

					_cloneHide(isOwner);

					if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect) !== false) {
						if (!dragEl.contains(el)) {
							el.appendChild(dragEl);
							parentEl = el; // actualization
						}

						this._animate(dragRect, dragEl);
						target && this._animate(targetRect, target);
					}
				}
				else if (target && !target.animated && target !== dragEl && (target.parentNode[expando] !== void 0)) {
					if (lastEl !== target) {
						lastEl = target;
						lastCSS = _css(target);
						lastParentCSS = _css(target.parentNode);
					}


					var targetRect = target.getBoundingClientRect(),
						width = targetRect.right - targetRect.left,
						height = targetRect.bottom - targetRect.top,
						floating = /left|right|inline/.test(lastCSS.cssFloat + lastCSS.display)
							|| (lastParentCSS.display == 'flex' && lastParentCSS['flex-direction'].indexOf('row') === 0),
						isWide = (target.offsetWidth > dragEl.offsetWidth),
						isLong = (target.offsetHeight > dragEl.offsetHeight),
						halfway = (floating ? (evt.clientX - targetRect.left) / width : (evt.clientY - targetRect.top) / height) > 0.5,
						nextSibling = target.nextElementSibling,
						moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect),
						after
					;

					if (moveVector !== false) {
						_silent = true;
						setTimeout(_unsilent, 30);

						_cloneHide(isOwner);

						if (moveVector === 1 || moveVector === -1) {
							after = (moveVector === 1);
						}
						else if (floating) {
							var elTop = dragEl.offsetTop,
								tgTop = target.offsetTop;

							if (elTop === tgTop) {
								after = (target.previousElementSibling === dragEl) && !isWide || halfway && isWide;
							} else {
								after = tgTop > elTop;
							}
						} else {
							after = (nextSibling !== dragEl) && !isLong || halfway && isLong;
						}

						if (!dragEl.contains(el)) {
							if (after && !nextSibling) {
								el.appendChild(dragEl);
							} else {
								target.parentNode.insertBefore(dragEl, after ? nextSibling : target);
							}
						}

						parentEl = dragEl.parentNode; // actualization

						this._animate(dragRect, dragEl);
						this._animate(targetRect, target);
					}
				}
			}
		},

		_animate: function (prevRect, target) {
			var ms = this.options.animation;

			if (ms) {
				var currentRect = target.getBoundingClientRect();

				_css(target, 'transition', 'none');
				_css(target, 'transform', 'translate3d('
					+ (prevRect.left - currentRect.left) + 'px,'
					+ (prevRect.top - currentRect.top) + 'px,0)'
				);

				target.offsetWidth; // repaint

				_css(target, 'transition', 'all ' + ms + 'ms');
				_css(target, 'transform', 'translate3d(0,0,0)');

				clearTimeout(target.animated);
				target.animated = setTimeout(function () {
					_css(target, 'transition', '');
					_css(target, 'transform', '');
					target.animated = false;
				}, ms);
			}
		},

		_offUpEvents: function () {
			var ownerDocument = this.el.ownerDocument;

			_off(document, 'touchmove', this._onTouchMove);
			_off(ownerDocument, 'mouseup', this._onDrop);
			_off(ownerDocument, 'touchend', this._onDrop);
			_off(ownerDocument, 'touchcancel', this._onDrop);
		},

		_onDrop: function (/**Event*/evt) {
			var el = this.el,
				options = this.options;

			clearInterval(this._loopId);
			clearInterval(autoScroll.pid);
			clearTimeout(this._dragStartTimer);

			// Unbind events
			_off(document, 'mousemove', this._onTouchMove);

			if (this.nativeDraggable) {
				_off(document, 'drop', this);
				_off(el, 'dragstart', this._onDragStart);
			}

			this._offUpEvents();

			if (evt) {
				if (moved) {
					evt.preventDefault();
					!options.dropBubble && evt.stopPropagation();
				}

				ghostEl && ghostEl.parentNode.removeChild(ghostEl);

				if (dragEl) {
					if (this.nativeDraggable) {
						_off(dragEl, 'dragend', this);
					}

					_disableDraggable(dragEl);

					// Remove class's
					_toggleClass(dragEl, this.options.ghostClass, false);
					_toggleClass(dragEl, this.options.chosenClass, false);

					if (rootEl !== parentEl) {
						newIndex = _index(dragEl, options.draggable);

						if (newIndex >= 0) {
							// drag from one list and drop into another
							_dispatchEvent(null, parentEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
							_dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);

							// Add event
							_dispatchEvent(null, parentEl, 'add', dragEl, rootEl, oldIndex, newIndex);

							// Remove event
							_dispatchEvent(this, rootEl, 'remove', dragEl, rootEl, oldIndex, newIndex);
						}
					}
					else {
						// Remove clone
						cloneEl && cloneEl.parentNode.removeChild(cloneEl);

						if (dragEl.nextSibling !== nextEl) {
							// Get the index of the dragged element within its parent
							newIndex = _index(dragEl, options.draggable);

							if (newIndex >= 0) {
								// drag & drop within the same list
								_dispatchEvent(this, rootEl, 'update', dragEl, rootEl, oldIndex, newIndex);
								_dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
							}
						}
					}

					if (Sortable.active) {
						if (newIndex === null || newIndex === -1) {
							newIndex = oldIndex;
						}

						this.originalEvent = evt; // Gantry 5
						_dispatchEvent(this, rootEl, 'end', dragEl, rootEl, oldIndex, newIndex);

						// Save sorting
						this.save();
					}
				}

			}
			this._nulling();
		},

		_nulling: function() {
			// Nulling
			rootEl =
			dragEl =
			parentEl =
			ghostEl =
			nextEl =
			cloneEl =

			scrollEl =
			scrollParentEl =

			tapEvt =
			touchEvt =

			moved =
			newIndex =

			lastEl =
			lastCSS =

			activeGroup =
			Sortable.active = null;
		},

		handleEvent: function (/**Event*/evt) {
			var type = evt.type;

			if (type === 'dragover' || type === 'dragenter') {
				if (dragEl) {
					this._onDragOver(evt);
					_globalDragOver(evt);
				}
			}
			else if (type === 'drop' || type === 'dragend') {
				this._onDrop(evt);
			}
		},


		/**
		 * Serializes the item into an array of string.
		 * @returns {String[]}
		 */
		toArray: function () {
			var order = [],
				el,
				children = this.el.children,
				i = 0,
				n = children.length,
				options = this.options;

			for (; i < n; i++) {
				el = children[i];
				if (_closest(el, options.draggable, this.el)) {
					order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));
				}
			}

			return order;
		},


		/**
		 * Sorts the elements according to the array.
		 * @param  {String[]}  order  order of the items
		 */
		sort: function (order) {
			var items = {}, rootEl = this.el;

			this.toArray().forEach(function (id, i) {
				var el = rootEl.children[i];

				if (_closest(el, this.options.draggable, rootEl)) {
					items[id] = el;
				}
			}, this);

			order.forEach(function (id) {
				if (items[id]) {
					rootEl.removeChild(items[id]);
					rootEl.appendChild(items[id]);
				}
			});
		},


		/**
		 * Save the current sorting
		 */
		save: function () {
			var store = this.options.store;
			store && store.set(this);
		},


		/**
		 * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.
		 * @param   {HTMLElement}  el
		 * @param   {String}       [selector]  default: `options.draggable`
		 * @returns {HTMLElement|null}
		 */
		closest: function (el, selector) {
			return _closest(el, selector || this.options.draggable, this.el);
		},


		/**
		 * Set/get option
		 * @param   {string} name
		 * @param   {*}      [value]
		 * @returns {*}
		 */
		option: function (name, value) {
			var options = this.options;

			if (value === void 0) {
				return options[name];
			} else {
				options[name] = value;

				if (name === 'group') {
					_prepareGroup(options);
				}
			}
		},


		/**
		 * Destroy
		 */
		destroy: function () {
			var el = this.el;

			el[expando] = null;

			_off(el, 'mousedown', this._onTapStart);
			_off(el, 'touchstart', this._onTapStart);

			if (this.nativeDraggable) {
				_off(el, 'dragover', this);
				_off(el, 'dragenter', this);
			}

			// Remove draggable attributes
			Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {
				el.removeAttribute('draggable');
			});

			touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver), 1);

			this._onDrop();

			this.el = el = null;
		}
	};


	function _cloneHide(state) {
		if (cloneEl && (cloneEl.state !== state)) {
			_css(cloneEl, 'display', state ? 'none' : '');
			!state && cloneEl.state && rootEl.insertBefore(cloneEl, dragEl);
			cloneEl.state = state;
		}
	}


	function _closest(/**HTMLElement*/el, /**String*/selector, /**HTMLElement*/ctx) {
		if (el) {
			ctx = ctx || document;

			do {
				if (
					(selector === '>*' && el.parentNode === ctx)
					|| _matches(el, selector)
				) {
					return el;
				}
			}
			while (el !== ctx && (el = el.parentNode));
		}

		return null;
	}


	function _globalDragOver(/**Event*/evt) {
		if (evt.dataTransfer) {
			evt.dataTransfer.dropEffect = 'move';
		}
		evt.preventDefault();
	}


	function _on(el, event, fn) {
		el.addEventListener(event, fn, false);
	}


	function _off(el, event, fn) {
		el.removeEventListener(event, fn, false);
	}


	function _toggleClass(el, name, state) {
		if (el) {
			if (el.classList) {
				el.classList[state ? 'add' : 'remove'](name);
			}
			else {
				var className = (' ' + el.className + ' ').replace(RSPACE, ' ').replace(' ' + name + ' ', ' ');
				el.className = (className + (state ? ' ' + name : '')).replace(RSPACE, ' ');
			}
		}
	}


	function _css(el, prop, val) {
		var style = el && el.style;

		if (style) {
			if (val === void 0) {
				if (document.defaultView && document.defaultView.getComputedStyle) {
					val = document.defaultView.getComputedStyle(el, '');
				}
				else if (el.currentStyle) {
					val = el.currentStyle;
				}

				return prop === void 0 ? val : val[prop];
			}
			else {
				if (!(prop in style)) {
					prop = '-webkit-' + prop;
				}

				style[prop] = val + (typeof val === 'string' ? '' : 'px');
			}
		}
	}


	function _find(ctx, tagName, iterator) {
		if (ctx) {
			var list = ctx.getElementsByTagName(tagName), i = 0, n = list.length;

			if (iterator) {
				for (; i < n; i++) {
					iterator(list[i], i);
				}
			}

			return list;
		}

		return [];
	}



	function _dispatchEvent(sortable, rootEl, name, targetEl, fromEl, startIndex, newIndex) {
		var evt = document.createEvent('Event'),
			options = (sortable || rootEl[expando]).options,
			onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1);

		evt.initEvent(name, true, true);

		evt.to = rootEl;
		evt.from = fromEl || rootEl;
		evt.item = targetEl || rootEl;
		evt.clone = cloneEl;

		evt.oldIndex = startIndex;
		evt.newIndex = newIndex;

		rootEl.dispatchEvent(evt);

		if (options[onName]) {
			options[onName].call(sortable, evt);
		}
	}


	function _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect) {
		var evt,
			sortable = fromEl[expando],
			onMoveFn = sortable.options.onMove,
			retVal;

		evt = document.createEvent('Event');
		evt.initEvent('move', true, true);

		evt.to = toEl;
		evt.from = fromEl;
		evt.dragged = dragEl;
		evt.draggedRect = dragRect;
		evt.related = targetEl || toEl;
		evt.relatedRect = targetRect || toEl.getBoundingClientRect();

		fromEl.dispatchEvent(evt);

		if (onMoveFn) {
			retVal = onMoveFn.call(sortable, evt);
		}

		return retVal;
	}


	function _disableDraggable(el) {
		el.draggable = false;
	}


	function _unsilent() {
		_silent = false;
	}


	/** @returns {HTMLElement|false} */
	function _ghostIsLast(el, evt) {
		var lastEl = el.lastElementChild,
				rect = lastEl.getBoundingClientRect();

		// return ((evt.clientY - (rect.top + rect.height) > 5) || (evt.clientX - rect.right > 5)) && lastEl; // min delta // Gantry 5
		return ((evt.clientY - (rect.top + rect.height) > 5) || (evt.clientX - (rect.right + rect.width) > 5)) && lastEl; // min delta
	}


	/**
	 * Generate id
	 * @param   {HTMLElement} el
	 * @returns {String}
	 * @private
	 */
	function _generateId(el) {
		var str = el.tagName + el.className + el.src + el.href + el.textContent,
			i = str.length,
			sum = 0;

		while (i--) {
			sum += str.charCodeAt(i);
		}

		return sum.toString(36);
	}

	/**
	 * Returns the index of an element within its parent for a selected set of
	 * elements
	 * @param  {HTMLElement} el
	 * @param  {selector} selector
	 * @return {number}
	 */
	function _index(el, selector) {
		var index = 0;

		if (!el || !el.parentNode) {
			return -1;
		}

		while (el && (el = el.previousElementSibling)) {
			if (el.nodeName.toUpperCase() !== 'TEMPLATE'
					&& _matches(el, selector)) {
				index++;
			}
		}

		return index;
	}

	function _matches(/**HTMLElement*/el, /**String*/selector) {
		if (el) {
			selector = selector.split('.');

			var tag = selector.shift().toUpperCase(),
				re = new RegExp('\\s(' + selector.join('|') + ')(?=\\s)', 'g');

			return (
				(tag === '' || el.nodeName.toUpperCase() == tag) &&
				(!selector.length || ((' ' + el.className + ' ').match(re) || []).length == selector.length)
			);
		}

		return false;
	}

	function _throttle(callback, ms) {
		var args, _this;

		return function () {
			if (args === void 0) {
				args = arguments;
				_this = this;

				setTimeout(function () {
					if (args.length === 1) {
						callback.call(_this, args[0]);
					} else {
						callback.apply(_this, args);
					}

					args = void 0;
				}, ms);
			}
		};
	}

	function _extend(dst, src) {
		if (dst && src) {
			for (var key in src) {
				if (src.hasOwnProperty(key)) {
					dst[key] = src[key];
				}
			}
		}

		return dst;
	}


	// Export utils
	Sortable.utils = {
		on: _on,
		off: _off,
		css: _css,
		find: _find,
		is: function (el, selector) {
			return !!_closest(el, selector, el);
		},
		extend: _extend,
		throttle: _throttle,
		closest: _closest,
		toggleClass: _toggleClass,
		index: _index
	};


	/**
	 * Create sortable instance
	 * @param {HTMLElement}  el
	 * @param {Object}      [options]
	 */
	Sortable.create = function (el, options) {
		return new Sortable(el, options);
	};


	// Export
	Sortable.version = '1.4.2';
	return Sortable;
});

},{}],315:[function(require,module,exports){
/* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.m=b||a;this.c=this.m.document}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}
function w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}
function z(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:"}function ea(a){return a.m.location.hostname||a.a.location.hostname}
function A(a,b,c){function d(){k&&e&&f&&(k(g),k=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,k=c||null;da?(b.onload=function(){e=!0;d()},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");d()}):setTimeout(function(){e=!0;d()},0);u(a,"head",b)}
function B(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5E3);return f}return null};function C(){this.a=0;this.c=null}function D(a){a.a++;return function(){a.a--;E(a)}}function F(a,b){a.c=b;E(a)}function E(a){0==a.a&&a.c&&(a.c(),a.c=null)};function G(a){this.a=a||"-"}G.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)};function H(a,b){this.c=a;this.f=4;this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function fa(a){return I(a)+" "+(a.f+"00")+" 300px "+J(a.c)}function J(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function K(a){return a.a+a.f}function I(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}
function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new G("-");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);L(a,"loading")}function M(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));w(a.f,c,d)}L(a,"inactive")}function L(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,K(c));else a.h[b]()};function ja(){this.c={}}function ka(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d};function N(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function O(a){u(a.c,"body",a.a)}function P(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+J(a.c)+";"+("font-style:"+I(a)+";font-weight:"+(a.f+"00")+";")};function Q(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}Q.prototype.start=function(){var a=this.c.m.document,b=this,c=q(),d=new Promise(function(d,e){function k(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(k,25)},function(){e()})}k()}),e=new Promise(function(a,d){setTimeout(d,b.f)});Promise.race([e,d]).then(function(){b.g(b.a)},function(){b.j(b.a)})};function R(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new N(this.c,this.s);this.h=new N(this.c,this.s);this.j=new N(this.c,this.s);this.o=new N(this.c,this.s);a=new H(this.a.c+",serif",K(this.a));a=P(a);this.g.a.style.cssText=a;a=new H(this.a.c+",sans-serif",K(this.a));a=P(a);this.h.a.style.cssText=a;a=new H("serif",K(this.a));a=P(a);this.j.a.style.cssText=a;a=new H("sans-serif",K(this.a));a=
P(a);this.o.a.style.cssText=a;O(this.g);O(this.h);O(this.j);O(this.o)}var S={D:"serif",C:"sans-serif"},T=null;function U(){if(null===T){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return T}R.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=q();la(this)};
function ma(a,b,c){for(var d in S)if(S.hasOwnProperty(d)&&b===a.f[S[d]]&&c===a.f[S[d]])return!0;return!1}function la(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=U()&&ma(a,b,c));d?q()-a.A>=a.w?U()&&ma(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):na(a):V(a,a.v)}function na(a){setTimeout(p(function(){la(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a)},a),0)};function W(a,b,c){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=c}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,K(a).toString(),"active")],[b.a.c("wf",a.c,K(a).toString(),"loading"),b.a.c("wf",a.c,K(a).toString(),"inactive")]);L(b,"fontactive",a);this.o=!0;oa(this)};
W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,K(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,K(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,K(a).toString(),"inactive"));w(b.f,d,e)}L(b,"fontinactive",a);oa(this)};function oa(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),L(a,"active")):M(a.a))};function pa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}pa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;qa(this,new ha(this.c,a),a)};
function ra(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,k=d||null||{};if(0===c.length&&f)M(b.a);else{b.f+=c.length;f&&(b.j=f);var h,m=[];for(h=0;h<c.length;h++){var l=c[h],n=k[l.c],r=b.a,x=l;r.g&&w(r.f,[r.a.c("wf",x.c,K(x).toString(),"loading")]);L(r,"fontloading",x);r=null;null===X&&(X=window.FontFace?(x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(x[1],10):!0:!1);X?r=new Q(p(b.g,b),p(b.h,b),b.c,l,b.s,n):r=new R(p(b.g,b),p(b.h,b),b.c,l,b.s,a,
n);m.push(r)}for(h=0;h<m.length;h++)m[h].start()}},0)}function qa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,d,c){ra(a,f,b,d,c)})};function sa(a,b){this.c=a;this.a=b}function ta(a,b,c){var d=z(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return d+"//"+a+"/"+b+".js"+(c?"?v="+c:"")}
sa.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],h;if(c)for(var m=0;m<c.length;m++){var l=c[m].fontfamily;void 0!=c[m].fontStyle&&void 0!=c[m].fontWeight?(h=c[m].fontStyle+c[m].fontWeight,e.push(new H(l,h))):e.push(new H(l))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.m;B(this.c,ta(c,d,e),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+
d}else a([])};function ua(a,b){this.c=a;this.a=b}ua.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new C;b=0;for(c=d.length;b<c;b++)A(this.c,d[b],D(g));var k=[];b=0;for(c=e.length;b<c;b++)if(d=e[b].split(":"),d[1])for(var h=d[1].split(","),m=0;m<h.length;m+=1)k.push(new H(d[0],h[m]));else k.push(new H(d[0]));F(g,function(){a(k,f)})};function va(a,b,c){a?this.c=a:this.c=b+wa;this.a=[];this.f=[];this.g=c||""}var wa="//fonts.googleapis.com/css";function xa(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}
function ya(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b};function za(a){this.f=a;this.a=[];this.c={}}
var Aa={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ca={i:"i",italic:"i",n:"n",normal:"n"},
Da=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
function Ea(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;var k=d[1];g=[];if(k)for(var k=k.split(","),h=k.length,m=0;m<h;m++){var l;l=k[m];if(l.match(/^[\w-]+$/)){var n=Da.exec(l.toLowerCase());if(null==n)l="";else{l=n[2];l=null==l||""==l?"n":Ca[l];n=n[1];if(null==n||""==n)n="4";else var r=Ba[n],n=r?r:isNaN(n)?"4":n.substr(0,1);l=[l,n].join("")}}else l="";l&&g.push(l)}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(","):
g,0<d.length&&(d=Aa[d[0]])&&(a.c[e]=d))}a.c[e]||(d=Aa[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new H(e,f[d]))}};function Fa(a,b){this.c=a;this.a=b}var Ga={Arimo:!0,Cousine:!0,Tinos:!0};Fa.prototype.load=function(a){var b=new C,c=this.c,d=new va(this.a.api,z(c),this.a.text),e=this.a.families;xa(d,e);var f=new za(e);Ea(f);A(c,ya(d),D(b));F(b,function(){a(f.a,f.c,Ga)})};function Ha(a,b){this.c=a;this.a=b}Ha.prototype.load=function(a){var b=this.a.id,c=this.c.m;b?B(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],k=b[f+1],h=0;h<k.length;h++)e.push(new H(g,k[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(m){}a(e)}},2E3):a([])};function Ia(a,b){this.c=a;this.f=b;this.a=[]}Ia.prototype.load=function(a){var b=this.f.id,c=this.c.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,k=c.fonts.length;g<k;++g){var h=c.fonts[g];d.a.push(new H(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.a)},B(this.c,z(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var Y=new pa(window);Y.a.c.custom=function(a,b){return new ua(b,a)};Y.a.c.fontdeck=function(a,b){return new Ia(b,a)};Y.a.c.monotype=function(a,b){return new sa(b,a)};Y.a.c.typekit=function(a,b){return new Ha(b,a)};Y.a.c.google=function(a,b){return new Fa(b,a)};var Z={load:p(Y.load,Y)};"function"===typeof define&&define.amd?define(function(){return Z}):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));}());

},{}],"ext/tooltips":[function(require,module,exports){
/*!
 * tooltips 0.1.0 - 20th Dec 2013
 * https://github.com/darsain/tooltip
 *
 * Licensed under the MIT license.
 * http://opensource.org/licenses/MIT
 *
 * @modified by Djamil Legato
 */
;(function(){

    /**
     * Require the given path.
     *
     * @param {String} path
     * @return {Object} exports
     * @api public
     */

    function fakeRequire(path, parent, orig) {
        var resolved = fakeRequire.resolve(path);

        // lookup failed
        if (null == resolved) {
            orig = orig || path;
            parent = parent || 'root';
            var err = new Error('Failed to fakeRequire "' + orig + '" from "' + parent + '"');
            err.path = orig;
            err.parent = parent;
            err.fakeRequire = true;
            throw err;
        }

        var module = fakeRequire.modules[resolved];

        // perform real fakeRequire()
        // by invoking the module's
        // registered function
        if (!module._resolving && !module.exports) {
            var mod = {};
            mod.exports = {};
            mod.client = mod.component = true;
            module._resolving = true;
            module.call(this, mod.exports, fakeRequire.relative(resolved), mod);
            delete module._resolving;
            module.exports = mod.exports;
        }

        return module.exports;
    }

    /**
     * Registered modules.
     */

    fakeRequire.modules = {};

    /**
     * Registered aliases.
     */

    fakeRequire.aliases = {};

    /**
     * Resolve `path`.
     *
     * Lookup:
     *
     *   - PATH/index.js
     *   - PATH.js
     *   - PATH
     *
     * @param {String} path
     * @return {String} path or null
     * @api private
     */

    fakeRequire.resolve = function(path) {
        if (path.charAt(0) === '/') path = path.slice(1);

        var paths = [
            path,
            path + '.js',
            path + '.json',
            path + '/index.js',
            path + '/index.json'
        ];

        for (var i = 0; i < paths.length; i++) {
            var path = paths[i];
            if (fakeRequire.modules.hasOwnProperty(path)) return path;
            if (fakeRequire.aliases.hasOwnProperty(path)) return fakeRequire.aliases[path];
        }
    };

    /**
     * Normalize `path` relative to the current path.
     *
     * @param {String} curr
     * @param {String} path
     * @return {String}
     * @api private
     */

    fakeRequire.normalize = function(curr, path) {
        var segs = [];

        if ('.' != path.charAt(0)) return path;

        curr = curr.split('/');
        path = path.split('/');

        for (var i = 0; i < path.length; ++i) {
            if ('..' == path[i]) {
                curr.pop();
            } else if ('.' != path[i] && '' != path[i]) {
                segs.push(path[i]);
            }
        }

        return curr.concat(segs).join('/');
    };

    /**
     * Register module at `path` with callback `definition`.
     *
     * @param {String} path
     * @param {Function} definition
     * @api private
     */

    fakeRequire.register = function(path, definition) {
        fakeRequire.modules[path] = definition;
    };

    /**
     * Alias a module definition.
     *
     * @param {String} from
     * @param {String} to
     * @api private
     */

    fakeRequire.alias = function(from, to) {
        if (!fakeRequire.modules.hasOwnProperty(from)) {
            throw new Error('Failed to alias "' + from + '", it does not exist');
        }
        fakeRequire.aliases[to] = from;
    };

    /**
     * Return a fakeRequire function relative to the `parent` path.
     *
     * @param {String} parent
     * @return {Function}
     * @api private
     */

    fakeRequire.relative = function(parent) {
        var p = fakeRequire.normalize(parent, '..');

        /**
         * lastIndexOf helper.
         */

        function lastIndexOf(arr, obj) {
            var i = arr.length;
            while (i--) {
                if (arr[i] === obj) return i;
            }
            return -1;
        }

        /**
         * The relative fakeRequire() itself.
         */

        function localRequire(path) {
            var resolved = localRequire.resolve(path);
            return fakeRequire(resolved, parent, path);
        }

        /**
         * Resolve relative to the parent.
         */

        localRequire.resolve = function(path) {
            var c = path.charAt(0);
            if ('/' == c) return path.slice(1);
            if ('.' == c) return fakeRequire.normalize(p, path);

            // resolve deps by returning
            // the dep in the nearest "deps"
            // directory
            var segs = parent.split('/');
            var i = lastIndexOf(segs, 'deps') + 1;
            if (!i) i = 0;
            path = segs.slice(0, i + 1).join('/') + '/deps/' + path;
            return path;
        };

        /**
         * Check if module is defined at `path`.
         */

        localRequire.exists = function(path) {
            return fakeRequire.modules.hasOwnProperty(localRequire.resolve(path));
        };

        return localRequire;
    };
    fakeRequire.register("darsain-position/index.js", Function("exports, fakeRequire, module",
        "'use strict';\n\
        \n\
        /**\n\
         * Transport.\n\
         */\n\
        module.exports = position;\n\
        \n\
        /**\n\
         * Globals.\n\
         */\n\
        var win = window;\n\
        var doc = win.document;\n\
        var docEl = doc.documentElement;\n\
        \n\
        /**\n\
         * Poor man's shallow object extend.\n\
         *\n\
         * @param {Object} a\n\
         * @param {Object} b\n\
         *\n\
         * @return {Object}\n\
         */\n\
        function extend(a, b) {\n\
        \tfor (var key in b) {\n\
        \t\ta[key] = b[key];\n\
        \t}\n\
        \treturn a;\n\
        }\n\
        \n\
        /**\n\
         * Checks whether object is window.\n\
         *\n\
         * @param {Object} obj\n\
         *\n\
         * @return {Boolean}\n\
         */\n\
        function isWin(obj) {\n\
        \treturn obj && obj.setInterval != null;\n\
        }\n\
        \n\
        /**\n\
         * Returns element's object with `left`, `top`, `bottom`, `right`, `width`, and `height`\n\
         * properties indicating the position and dimensions of element on a page.\n\
         *\n\
         * @param {Element} element\n\
         *\n\
         * @return {Object}\n\
         */\n\
        function position(element) {\n\
        \tvar winTop = win.pageYOffset || docEl.scrollTop;\n\
        \tvar winLeft = win.pageXOffset || docEl.scrollLeft;\n\
        \tvar box = { left: 0, right: 0, top: 0, bottom: 0, width: 0, height: 0 };\n\
        \n\
        \tif (isWin(element)) {\n\
        \t\tbox.width = win.innerWidth || docEl.clientWidth;\n\
        \t\tbox.height = win.innerHeight || docEl.clientHeight;\n\
        \t} else if (docEl.contains(element) && element.getBoundingClientRect != null) {\n\
        \t\textend(box, element.getBoundingClientRect());\n\
        \t\t// width & height don't exist in <IE9\n\
        \t\tbox.width = box.right - box.left;\n\
        \t\tbox.height = box.bottom - box.top;\n\
        \t} else {\n\
        \t\treturn box;\n\
        \t}\n\
        \n\
        \tbox.top = box.top + winTop - docEl.clientTop;\n\
        \tbox.left = box.left + winLeft - docEl.clientLeft;\n\
        \tbox.right = box.left + box.width;\n\
        \tbox.bottom = box.top + box.height;\n\
        \n\
        \treturn box;\n\
        }//# sourceURL=darsain-position/index.js"
    ));
    fakeRequire.register("component-classes/index.js", Function("exports, fakeRequire, module",
        "/**\n\
         * Module dependencies.\n\
         */\n\
        \n\
        var index = fakeRequire('indexof');\n\
        \n\
        /**\n\
         * Whitespace regexp.\n\
         */\n\
        \n\
        var re = /\\s+/;\n\
        \n\
        /**\n\
         * toString reference.\n\
         */\n\
        \n\
        var toString = Object.prototype.toString;\n\
        \n\
        /**\n\
         * Wrap `el` in a `ClassList`.\n\
         *\n\
         * @param {Element} el\n\
         * @return {ClassList}\n\
         * @api public\n\
         */\n\
        \n\
        module.exports = function(el){\n\
          return new ClassList(el);\n\
        };\n\
        \n\
        /**\n\
         * Initialize a new ClassList for `el`.\n\
         *\n\
         * @param {Element} el\n\
         * @api private\n\
         */\n\
        \n\
        function ClassList(el) {\n\
          if (!el) throw new Error('A DOM element reference is fakeRequired');\n\
          this.el = el;\n\
          this.list = el.classList;\n\
        }\n\
        \n\
        /**\n\
         * Add class `name` if not already present.\n\
         *\n\
         * @param {String} name\n\
         * @return {ClassList}\n\
         * @api public\n\
         */\n\
        \n\
        ClassList.prototype.add = function(name){\n\
          // classList\n\
          if (this.list) {\n\
            this.list.add(name);\n\
            return this;\n\
          }\n\
        \n\
          // fallback\n\
          var arr = this.array();\n\
          var i = index(arr, name);\n\
          if (!~i) arr.push(name);\n\
          this.el.className = arr.join(' ');\n\
          return this;\n\
        };\n\
        \n\
        /**\n\
         * Remove class `name` when present, or\n\
         * pass a regular expression to remove\n\
         * any which match.\n\
         *\n\
         * @param {String|RegExp} name\n\
         * @return {ClassList}\n\
         * @api public\n\
         */\n\
        \n\
        ClassList.prototype.remove = function(name){\n\
          if ('[object RegExp]' == toString.call(name)) {\n\
            return this.removeMatching(name);\n\
          }\n\
        \n\
          // classList\n\
          if (this.list) {\n\
            this.list.remove(name);\n\
            return this;\n\
          }\n\
        \n\
          // fallback\n\
          var arr = this.array();\n\
          var i = index(arr, name);\n\
          if (~i) arr.splice(i, 1);\n\
          this.el.className = arr.join(' ');\n\
          return this;\n\
        };\n\
        \n\
        /**\n\
         * Remove all classes matching `re`.\n\
         *\n\
         * @param {RegExp} re\n\
         * @return {ClassList}\n\
         * @api private\n\
         */\n\
        \n\
        ClassList.prototype.removeMatching = function(re){\n\
          var arr = this.array();\n\
          for (var i = 0; i < arr.length; i++) {\n\
            if (re.test(arr[i])) {\n\
              this.remove(arr[i]);\n\
            }\n\
          }\n\
          return this;\n\
        };\n\
        \n\
        /**\n\
         * Toggle class `name`.\n\
         *\n\
         * @param {String} name\n\
         * @return {ClassList}\n\
         * @api public\n\
         */\n\
        \n\
        ClassList.prototype.toggle = function(name){\n\
          // classList\n\
          if (this.list) {\n\
            this.list.toggle(name);\n\
            return this;\n\
          }\n\
        \n\
          // fallback\n\
          if (this.has(name)) {\n\
            this.remove(name);\n\
          } else {\n\
            this.add(name);\n\
          }\n\
          return this;\n\
        };\n\
        \n\
        /**\n\
         * Return an array of classes.\n\
         *\n\
         * @return {Array}\n\
         * @api public\n\
         */\n\
        \n\
        ClassList.prototype.array = function(){\n\
          var str = this.el.className.replace(/^\\s+|\\s+$/g, '');\n\
          var arr = str.split(re);\n\
          if ('' === arr[0]) arr.shift();\n\
          return arr;\n\
        };\n\
        \n\
        /**\n\
         * Check if class `name` is present.\n\
         *\n\
         * @param {String} name\n\
         * @return {ClassList}\n\
         * @api public\n\
         */\n\
        \n\
        ClassList.prototype.has =\n\
        ClassList.prototype.contains = function(name){\n\
          return this.list\n\
            ? this.list.contains(name)\n\
            : !! ~index(this.array(), name);\n\
        };\n\
        //# sourceURL=component-classes/index.js"
    ));
    fakeRequire.register("darsain-tooltip/index.js", Function("exports, fakeRequire, module",
        "'use strict';\n\
        \n\
        /**\n\
         * Dependencies.\n\
         */\n\
        var evt = fakeRequire('event');\n\
        var classes = fakeRequire('classes');\n\
        var indexOf = fakeRequire('indexof');\n\
        var position = fakeRequire('position');\n\
        \n\
        /**\n\
         * Globals.\n\
         */\n\
        var win = window;\n\
        var doc = win.document;\n\
        var body = doc.body;\n\
        var verticalPlaces = ['top', 'bottom'];\n\
        \n\
        /**\n\
         * Transport.\n\
         */\n\
        module.exports = Tooltip;\n\
        \n\
        /**\n\
         * Prototypal inheritance.\n\
         *\n\
         * @param {Object} o\n\
         *\n\
         * @return {Object}\n\
         */\n\
        var objectCreate = Object.create || (function () {\n\
        \tfunction F() {}\n\
        \treturn function (o) {\n\
        \t\tF.prototype = o;\n\
        \t\treturn new F();\n\
        \t};\n\
        })();\n\
        \n\
        /**\n\
         * Poor man's shallow object extend.\n\
         *\n\
         * @param {Object} a\n\
         * @param {Object} b\n\
         *\n\
         * @return {Object}\n\
         */\n\
        function extend(a, b) {\n\
        \tfor (var key in b) {\n\
        \t\ta[key] = b[key];\n\
        \t}\n\
        \treturn a;\n\
        }\n\
        \n\
        /**\n\
         * Parse integer from strings like '-50px'.\n\
         *\n\
         * @param {Mixed} value\n\
         *\n\
         * @return {Integer}\n\
         */\n\
        function parsePx(value) {\n\
        \treturn 0 | Math.round(String(value).replace(/[^\\-0-9.]/g, ''));\n\
        }\n\
        \n\
        /**\n\
         * Get computed style of element.\n\
         *\n\
         * @param {Element} element\n\
         *\n\
         * @type {String}\n\
         */\n\
        var style = win.getComputedStyle ? function style(element, name) {\n\
        \treturn win.getComputedStyle(element, null)[name];\n\
        } : function style(element, name) {\n\
        \treturn element.currentStyle[name];\n\
        };\n\
        \n\
        /**\n\
         * Returns transition duration of element in ms.\n\
         *\n\
         * @param {Element} element\n\
         *\n\
         * @return {Int}\n\
         */\n\
        function transitionDuration(element) {\n\
        \tvar duration = String(style(element, transitionDuration.propName));\n\
        \tvar match = duration.match(/([0-9.]+)([ms]{1,2})/);\n\
        \tif (match) {\n\
        \t\tduration = Number(match[1]);\n\
        \t\tif (match[2] === 's') {\n\
        \t\t\tduration *= 1000;\n\
        \t\t}\n\
        \t}\n\
        \treturn 0|duration;\n\
        }\n\
        transitionDuration.propName = (function () {\n\
        \tvar element = doc.createElement('div');\n\
        \tvar names = ['transitionDuration', 'webkitTransitionDuration'];\n\
        \tvar value = '1s';\n\
        \tfor (var i = 0; i < names.length; i++) {\n\
        \t\telement.style[names[i]] = value;\n\
        \t\tif (element.style[names[i]] === value) {\n\
        \t\t\treturn names[i];\n\
        \t\t}\n\
        \t}\n\
        }());\n\
        \n\
        /**\n\
         * Tooltip construnctor.\n\
         *\n\
         * @param {String|Element} content\n\
         * @param {Object}         options\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        function Tooltip(content, options) {\n\
        \tif (!(this instanceof Tooltip)) {\n\
        \t\treturn new Tooltip(content, options);\n\
        \t}\n\
        \tthis.hidden = 1;\n\
        \tthis.options = extend(objectCreate(Tooltip.defaults), options);\n\
        \tthis._createElement();\n\
        \tthis.content(content);\n\
        }\n\
        \n\
        /**\n\
         * Creates a tooltip element.\n\
         *\n\
         * @return {Void}\n\
         */\n\
        Tooltip.prototype._createElement = function () {\n\
        \tthis.element = doc.createElement('div');\n\
        \tthis.classes = classes(this.element);\n\
        \tthis.classes.add(this.options.baseClass);\n\
        \tvar propName;\n\
        \tfor (var i = 0; i < Tooltip.classTypes.length; i++) {\n\
        \t\tpropName = Tooltip.classTypes[i] + 'Class';\n\
        \t\tif (this.options[propName]) {\n\
        \t\t\tthis.classes.add(this.options[propName]);\n\
        \t\t}\n\
        \t}\n\
        };\n\
        \n\
        /**\n\
         * Changes tooltip's type class type.\n\
         *\n\
         * @param {String} name\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.type = function (name) {\n\
        \treturn this.changeClassType('type', name);\n\
        };\n\
        \n\
        /**\n\
         * Changes tooltip's effect class type.\n\
         *\n\
         * @param {String} name\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.effect = function (name) {\n\
        \treturn this.changeClassType('effect', name);\n\
        };\n\
        \n\
        /**\n\
         * Changes class type.\n\
         *\n\
         * @param {String} propName\n\
         * @param {String} newClass\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.changeClassType = function (propName, newClass) {\n\
        \tpropName += 'Class';\n\
        \tif (this.options[propName]) {\n\
        \t\tthis.classes.remove(this.options[propName]);\n\
        \t}\n\
        \tthis.options[propName] = newClass;\n\
        \tif (newClass) {\n\
        \t\tthis.classes.add(newClass);\n\
        \t}\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Updates tooltip's dimensions.\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.updateSize = function () {\n\
        \tif (this.hidden) {\n\
        \t\tthis.element.style.visibility = 'hidden';\n\
        \t\twindow.document.body.appendChild(this.element);\n\
        \t}\n\
        \tthis.width = this.element.offsetWidth;\n\
        \tthis.height = this.element.offsetHeight;\n\
        \tif (this.spacing == null) {\n\
        \t\tthis.spacing = this.options.spacing != null ? this.options.spacing : parsePx(style(this.element, 'top'));\n\
        \t}\n\
        \tif (this.offset == null) {\n\
        \t\tthis.offset = this.options.offset != null ? this.options.offset : 0;\n\
    \t}\n\
        \tif (this.hidden) {\n\
        \t\twindow.document.body.removeChild(this.element);\n\
        \t\tthis.element.style.visibility = '';\n\
        \t} else {\n\
        \t\tthis.position();\n\
        \t}\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Change tooltip content.\n\
         *\n\
         * When tooltip is visible, its size is automatically\n\
         * synced and tooltip correctly repositioned.\n\
         *\n\
         * @param {String|Element} content\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.content = function (content) {\n\
        \tif (typeof content === 'object') {\n\
        \t\tthis.element.innerHTML = '';\n\
        \t\tthis.element.appendChild(content);\n\
        \t} else {\n\
        \t\tthis.element.innerHTML = content;\n\
        \t}\n\
        \tthis.updateSize();\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Pick new place tooltip should be displayed at.\n\
         *\n\
         * When the tooltip is visible, it is automatically positioned there.\n\
         *\n\
         * @param {String} place\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.place = function (place) {\n\
        \tthis.options.place = place;\n\
        \tif (!this.hidden) {\n\
        \t\tthis.position();\n\
        \t}\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Attach tooltip to an element.\n\
         *\n\
         * @param {Element} element\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.attach = function (element) {\n\
        \tthis.attachedTo = element;\n\
        \tif (!this.hidden) {\n\
        \t\tthis.position();\n\
        \t}\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Detach tooltip from element.\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.detach = function () {\n\
        \tthis.hide();\n\
        \tthis.attachedTo = null;\n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Pick the most reasonable place for target position.\n\
         *\n\
         * @param {Object} target\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype._pickPlace = function (target) {\n\
        \tif (!this.options.auto) {\n\
        \t\treturn this.options.place;\n\
        \t}\n\
        \tvar winPos = position(win);\n\
        \tvar place = this.options.place.split('-');\n\
        \tvar spacing = this.spacing;\n\
        \n\
        \tif (~indexOf(verticalPlaces, place[0])) {\n\
        \t\tif (target.top - this.height - spacing <= winPos.top) {\n\
        \t\t\tplace[0] = 'bottom';\n\
        \t\t} else if (target.bottom + this.height + spacing >= winPos.bottom) {\n\
        \t\t\tplace[0] = 'top';\n\
        \t\t}\n\
        \t\tswitch (place[1]) {\n\
        \t\t\tcase 'left':\n\
        \t\t\t\tif (target.right - this.width <= winPos.left) {\n\
        \t\t\t\t\tplace[1] = 'right';\n\
        \t\t\t\t}\n\
        \t\t\t\tbreak;\n\
        \t\t\tcase 'right':\n\
        \t\t\t\tif (target.left + this.width >= winPos.right) {\n\
        \t\t\t\t\tplace[1] = 'left';\n\
        \t\t\t\t}\n\
        \t\t\t\tbreak;\n\
        \t\t\tdefault:\n\
        \t\t\t\tif (target.left + target.width / 2 + this.width / 2 >= winPos.right) {\n\
        \t\t\t\t\tplace[1] = 'left';\n\
        \t\t\t\t} else if (target.right - target.width / 2 - this.width / 2 <= winPos.left) {\n\
        \t\t\t\t\tplace[1] = 'right';\n\
        \t\t\t\t}\n\
        \t\t}\n\
        \t} else {\n\
        \t\tif (target.left - this.width - spacing <= winPos.left) {\n\
        \t\t\tplace[0] = 'right';\n\
        \t\t} else if (target.right + this.width + spacing >= winPos.right) {\n\
        \t\t\tplace[0] = 'left';\n\
        \t\t}\n\
        \t\tswitch (place[1]) {\n\
        \t\t\tcase 'top':\n\
        \t\t\t\tif (target.bottom - this.height <= winPos.top) {\n\
        \t\t\t\t\tplace[1] = 'bottom';\n\
        \t\t\t\t}\n\
        \t\t\t\tbreak;\n\
        \t\t\tcase 'bottom':\n\
        \t\t\t\tif (target.top + this.height >= winPos.bottom) {\n\
        \t\t\t\t\tplace[1] = 'top';\n\
        \t\t\t\t}\n\
        \t\t\t\tbreak;\n\
        \t\t\tdefault:\n\
        \t\t\t\tif (target.top + target.height / 2 + this.height / 2 >= winPos.bottom) {\n\
        \t\t\t\t\tplace[1] = 'top';\n\
        \t\t\t\t} else if (target.bottom - target.height / 2 - this.height / 2 <= winPos.top) {\n\
        \t\t\t\t\tplace[1] = 'bottom';\n\
        \t\t\t\t}\n\
        \t\t}\n\
        \t}\n\
        \n\
        \treturn place.join('-');\n\
        };\n\
        \n\
        /**\n\
         * Position the element to an element or a specific coordinates.\n\
         *\n\
         * @param {Integer|Element} x\n\
         * @param {Integer}         y\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.position = function (x, y) {\n\
        \tif (this.attachedTo) {\n\
        \t\tx = this.attachedTo;\n\
        \t}\n\
        \tif (x == null && this._p) {\n\
        \t\tx = this._p[0];\n\
        \t\ty = this._p[1];\n\
        \t} else {\n\
        \t\tthis._p = arguments;\n\
        \t}\n\
        \tvar target = typeof x === 'number' ? {\n\
        \t\tleft: 0|x,\n\
        \t\tright: 0|x,\n\
        \t\ttop: 0|y,\n\
        \t\tbottom: 0|y,\n\
        \t\twidth: 0,\n\
        \t\theight: 0\n\
        \t} : position(x);\n\
        \tvar spacing = Number(this.spacing), offset = Number(this.offset);\n\
        \tvar newPlace = this._pickPlace(target);\n\
        \n\
        \t// Add/Change place class when necessary\n\
        \tif (newPlace !== this.curPlace) {\n\
        \t\tif (this.curPlace) {\n\
        \t\t\tthis.classes.remove(this.curPlace);\n\
        \t\t}\n\
        \t\tthis.classes.add(newPlace);\n\
        \t\tthis.curPlace = newPlace;\n\
        \t}\n\
        \n\
        \t// Position the tip\n\
        \tvar top, left;\n\
        \tswitch (this.curPlace) {\n\
        \t\tcase 'top':\n\
        \t\t\ttop = target.top - this.height - spacing;\n\
        \t\t\tleft = target.left + target.width / 2 - this.width / 2;\n\
        \t\t\tbreak;\n\
        \t\tcase 'top-left':\n\
        \t\t\ttop = target.top - this.height - spacing;\n\
        \t\t\tleft = target.right - this.width - offset;\n\
        \t\t\tbreak;\n\
        \t\tcase 'top-right':\n\
        \t\t\ttop = target.top - this.height - spacing;\n\
        \t\t\tleft = target.left + offset;\n\
        \t\t\tbreak;\n\
        \n\
        \t\tcase 'bottom':\n\
        \t\t\ttop = target.bottom + spacing;\n\
        \t\t\tleft = target.left + target.width / 2 - this.width / 2;\n\
        \t\t\tbreak;\n\
        \t\tcase 'bottom-left':\n\
        \t\t\ttop = target.bottom + spacing;\n\
        \t\t\tleft = target.right - this.width - offset;\n\
        \t\t\tbreak;\n\
        \t\tcase 'bottom-right':\n\
        \t\t\ttop = target.bottom + spacing;\n\
        \t\t\tleft = target.left + offset;\n\
        \t\t\tbreak;\n\
        \n\
        \t\tcase 'left':\n\
        \t\t\ttop = target.top + target.height / 2 - this.height / 2;\n\
        \t\t\tleft = target.left - this.width - spacing;\n\
        \t\t\tbreak;\n\
        \t\tcase 'left-top':\n\
        \t\t\ttop = target.bottom - this.height;\n\
        \t\t\tleft = target.left - this.width - spacing;\n\
        \t\t\tbreak;\n\
        \t\tcase 'left-bottom':\n\
        \t\t\ttop = target.top;\n\
        \t\t\tleft = target.left - this.width - spacing;\n\
        \t\t\tbreak;\n\
        \n\
        \t\tcase 'right':\n\
        \t\t\ttop = target.top + target.height / 2 - this.height / 2;\n\
        \t\t\tleft = target.right + spacing;\n\
        \t\t\tbreak;\n\
        \t\tcase 'right-top':\n\
        \t\t\ttop = target.bottom - this.height;\n\
        \t\t\tleft = target.right + spacing;\n\
        \t\t\tbreak;\n\
        \t\tcase 'right-bottom':\n\
        \t\t\ttop = target.top;\n\
        \t\t\tleft = target.right + spacing;\n\
        \t\t\tbreak;\n\
        \t}\n\
        \n\
        \t// Set tip position & class\n\
        \tthis.element.style.top = Math.round(top) + 'px';\n\
        \tthis.element.style.left = Math.round(left) + 'px';\n\
        \n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Show the tooltip.\n\
         *\n\
         * @param {Integer|Element} x\n\
         * @param {Integer}         y\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.show = function (x, y) {\n\
        \tx = this.attachedTo ? this.attachedTo : x;\n\
        \n\
        \t// Clear potential ongoing animation\n\
        \tclearTimeout(this.aIndex);\n\
        \n\
        \t// Position the element when requested\n\
        \tif (x != null) {\n\
        \t\tthis.position(x, y);\n\
        \t}\n\
        \n\
        \t// Stop here if tip is already visible\n\
        \tif (this.hidden) {\n\
        \t\tthis.hidden = 0;\n\
        \t\twindow.document.body.appendChild(this.element);\n\
        \t}\n\
        \n\
        \t// Make tooltip aware of window resize\n\
        \tif (this.attachedTo) {\n\
        \t\tthis._aware();\n\
        \t}\n\
        \n\
        \t// Trigger layout and kick in the transition\n\
        \tif (this.options.inClass) {\n\
        \t\tif (this.options.effectClass) {\n\
        \t\t\tvoid this.element.clientHeight;\n\
        \t\t}\n\
        \t\tthis.classes.add(this.options.inClass);\n\
        \t}\n\
        \n\
        \treturn this;\n\
        };\n\
        \n\
        /**\n\
         * Hide the tooltip.\n\
         *\n\
         * @return {Tooltip}\n\
         */\n\
        Tooltip.prototype.hide = function () {\n\
        \tif (this.hidden) {\n\
        \t\treturn;\n\
        \t}\n\
        \n\
        \tvar self = this;\n\
        \tvar duration = 0;\n\
        \n\
        \t// Remove .in class and calculate transition duration if any\n\
        \tif (this.options.inClass) {\n\
        \t\tthis.classes.remove(this.options.inClass);\n\
        \t\tif (this.options.effectClass) {\n\
        \t\t\tduration = transitionDuration(this.element);\n\
        \t\t}\n\
        \t}\n\
        \n\
        \t// Remove tip from window resize awareness\n\
        \tif (this.attachedTo) {\n\
        \t\tthis._unaware();\n\
        \t}\n\
        \n\
        \t// Remove the tip from the DOM when transition is done\n\
        \tclearTimeout(this.aIndex);\n\
        \tthis.aIndex = setTimeout(function () {\n\
        \t\tself.aIndex = 0;\n\
        \t\twindow.document.body.removeChild(self.element);\n\
        \t\tself.hidden = 1;\n\
        \t}, duration);\n\
        \n\
        \treturn this;\n\
        };\n\
        \n\
        Tooltip.prototype.toggle = function (x, y) {\n\
        \treturn this[this.hidden ? 'show' : 'hide'](x, y);\n\
        };\n\
        \n\
        Tooltip.prototype.destroy = function () {\n\
        \tclearTimeout(this.aIndex);\n\
        \tthis._unaware();\n\
        \tif (!this.hidden) {\n\
        \t\twindow.document.body.removeChild(this.element);\n\
        \t}\n\
        \tthis.element = this.options = null;\n\
        };\n\
        \n\
        /**\n\
         * Make the tip window resize aware.\n\
         *\n\
         * @return {Void}\n\
         */\n\
        Tooltip.prototype._aware = function () {\n\
        \tvar index = indexOf(Tooltip.winAware, this);\n\
        \tif (!~index) {\n\
        \t\tTooltip.winAware.push(this);\n\
        \t}\n\
        };\n\
        \n\
        /**\n\
         * Remove the window resize awareness.\n\
         *\n\
         * @return {Void}\n\
         */\n\
        Tooltip.prototype._unaware = function () {\n\
        \tvar index = indexOf(Tooltip.winAware, this);\n\
        \tif (~index) {\n\
        \t\tTooltip.winAware.splice(index, 1);\n\
        \t}\n\
        };\n\
        \n\
        /**\n\
         * Handles repositioning of tooltips on window resize.\n\
         *\n\
         * @return {Void}\n\
         */\n\
        Tooltip.reposition = (function () {\n\
        \tvar rAF = window.requestAnimationFrame || window.webkitRequestAnimationFrame || function (fn) {\n\
        \t\treturn setTimeout(fn, 17);\n\
        \t};\n\
        \tvar rIndex;\n\
        \n\
        \tfunction requestReposition() {\n\
        \t\tif (rIndex || !Tooltip.winAware.length) {\n\
        \t\t\treturn;\n\
        \t\t}\n\
        \t\trIndex = rAF(reposition, 17);\n\
        \t}\n\
        \n\
        \tfunction reposition() {\n\
        \t\trIndex = 0;\n\
        \t\tvar tip;\n\
        \t\tfor (var i = 0, l = Tooltip.winAware.length; i < l; i++) {\n\
        \t\t\ttip = Tooltip.winAware[i];\n\
        \t\t\ttip.position();\n\
        \t\t}\n\
        \t}\n\
        \n\
        \treturn requestReposition;\n\
        }());\n\
        Tooltip.winAware = [];\n\
        \n\
        // Bind winAware repositioning to window resize event\n\
        evt.bind(window, 'resize', Tooltip.reposition);\n\
        evt.bind(window, 'scroll', Tooltip.reposition);\n\
        \n\
        /**\n\
         * Array with dynamic class types.\n\
         *\n\
         * @type {Array}\n\
         */\n\
        Tooltip.classTypes = ['type', 'effect'];\n\
        \n\
        /**\n\
         * Default options for Tooltip constructor.\n\
         *\n\
         * @type {Object}\n\
         */\n\
        Tooltip.defaults = {\n\
        \tbaseClass:   'tooltip', // Base tooltip class name.\n\
        \ttypeClass:   null,      // Type tooltip class name.\n\
        \teffectClass: null,      // Effect tooltip class name.\n\
        \tinClass:     'in',      // Class used to transition stuff in.\n\
        \tplace:       'top',     // Default place.\n\
        \tspacing:     null,      // Gap between target and tooltip.\n\
        \toffset:      null,      // Horizontal offset to align arrow\n\
        \tauto:        0          // Whether to automatically adjust place to fit into window.\n\
        };//# sourceURL=darsain-tooltip/index.js"
    ));
    fakeRequire.register("darsain-event/index.js", Function("exports, fakeRequire, module",
        "'use strict';\n\
        \n\
        /**\n\
         * Bind `el` event `type` to `fn`.\n\
         *\n\
         * @param {Element}  el\n\
         * @param {String}   type\n\
         * @param {Function} fn\n\
         * @param {Boolean}  capture\n\
         *\n\
         * @return {Function}\n\
         */\n\
        exports.bind = window.addEventListener ? function (el, type, fn, capture) {\n\
        \tel.addEventListener(type, fn, capture || false);\n\
        \treturn fn;\n\
        } : function (el, type, fn) {\n\
        \tvar fnid = type + fn;\n\
        \tel[fnid] = el[fnid] || function () {\n\
        \t\tvar event = window.event;\n\
        \t\tevent.target = event.srcElement;\n\
        \t\tevent.preventDefault = function () {\n\
        \t\t\tevent.returnValue = false;\n\
        \t\t};\n\
        \t\tevent.stopPropagation = function () {\n\
        \t\t\tevent.cancelBubble = true;\n\
        \t\t};\n\
        \t\tfn.call(el, event);\n\
        \t};\n\
        \tel.attachEvent('on' + type, el[fnid]);\n\
        \treturn fn;\n\
        };\n\
        \n\
        /**\n\
         * Unbind `el` event `type`'s callback `fn`.\n\
         *\n\
         * @param {Element}  el\n\
         * @param {String}   type\n\
         * @param {Function} fn\n\
         * @param {Boolean}  capture\n\
         *\n\
         * @return {Function}\n\
         */\n\
        exports.unbind = window.removeEventListener ? function (el, type, fn, capture) {\n\
        \tel.removeEventListener(type, fn, capture || false);\n\
        \treturn fn;\n\
        } : function (el, type, fn) {\n\
        \tvar fnid = type + fn;\n\
        \tel.detachEvent('on' + type, el[fnid]);\n\
        \ttry {\n\
        \t\tdelete el[fnid];\n\
        \t} catch (err) {\n\
        \t\t// can't delete window object properties\n\
        \t\tel[fnid] = undefined;\n\
        \t}\n\
        \treturn fn;\n\
        };//# sourceURL=darsain-event/index.js"
    ));
    fakeRequire.register("component-indexof/index.js", Function("exports, fakeRequire, module",
        "module.exports = function(arr, obj){\n\
          if (arr.indexOf) return arr.indexOf(obj);\n\
          for (var i = 0; i < arr.length; ++i) {\n\
            if (arr[i] === obj) return i;\n\
          }\n\
          return -1;\n\
        };//# sourceURL=component-indexof/index.js"
    ));
    fakeRequire.register("code42day-dataset/index.js", Function("exports, fakeRequire, module",
        "module.exports=dataset;\n\
        \n\
        /*global document*/\n\
        \n\
        \n\
        // replace namesLikeThis with names-like-this\n\
        function toDashed(name) {\n\
          return name.replace(/([A-Z])/g, function(u) {\n\
            return \"-\" + u.toLowerCase();\n\
          });\n\
        }\n\
        \n\
        var fn;\n\
        \n\
        if (document.head.dataset) {\n\
          fn = {\n\
            set: function(node, attr, value) {\n\
               if (!node.dataset) return;\
               node.dataset[attr] = value;\n\
            },\n\
            get: function(node, attr) {\n\
              return node.dataset && node.dataset[attr];\n\
            }\n\
          };\n\
        } else {\n\
          fn = {\n\
            set: function(node, attr, value) {\n\
              node.setAttribute('data-' + toDashed(attr), value);\n\
            },\n\
            get: function(node, attr) {\n\
              return node.getAttribute('data-' + toDashed(attr));\n\
            }\n\
          };\n\
        }\n\
        \n\
        function dataset(node, attr, value) {\n\
          var self = {\n\
            set: set,\n\
            get: get\n\
          };\n\
        \n\
          function set(attr, value) {\n\
            fn.set(node, attr, value);\n\
            return self;\n\
          }\n\
        \n\
          function get(attr) {\n\
            return fn.get(node, attr);\n\
          }\n\
        \n\
          if (arguments.length === 3) {\n\
            return set(attr, value);\n\
          }\n\
          if (arguments.length == 2) {\n\
            return get(attr);\n\
          }\n\
        \n\
          return self;\n\
        }//# sourceURL=code42day-dataset/index.js"
    ));
    fakeRequire.register("tooltips/index.js", Function("exports, fakeRequire, module",
        "'use strict';\n\
        \n\
        /**\n\
         * Dependencies.\n\
         */\n\
        var evt = fakeRequire('event');\n\
        var indexOf = fakeRequire('indexof');\n\
        var Tooltip = fakeRequire('tooltip');\n\
        var dataset = fakeRequire('dataset');\n\
        \n\
        /**\n\
         * Transport.\n\
         */\n\
        module.exports = Tooltips;\n\
        \n\
        /**\n\
         * Globals.\n\
         */\n\
        var MObserver = window.MutationObserver || window.WebkitMutationObserver;\n\
        \n\
        /**\n\
         * Prototypal inheritance.\n\
         *\n\
         * @param {Object} o\n\
         *\n\
         * @return {Object}\n\
         */\n\
        var objectCreate = Object.create || (function () {\n\
        \tfunction F() {}\n\
        \treturn function (o) {\n\
        \t\tF.prototype = o;\n\
        \t\treturn new F();\n\
        \t};\n\
        })();\n\
        \n\
        /**\n\
         * Poor man's shallow object extend.\n\
         *\n\
         * @param {Object} a\n\
         * @param {Object} b\n\
         *\n\
         * @return {Object}\n\
         */\n\
        function extend(a, b) {\n\
        \tfor (var key in b) {\n\
        \t\ta[key] = b[key];\n\
        \t}\n\
        \treturn a;\n\
        }\n\
        \n\
        /**\n\
         * Capitalize the first letter of a string.\n\
         *\n\
         * @param {String} string\n\
         *\n\
         * @return {String}\n\
         */\n\
        function ucFirst(string) {\n\
        \treturn string.charAt(0).toUpperCase() + string.slice(1);\n\
        }\n\
        \n\
        /**\n\
         * Tooltips constructor.\n\
         *\n\
         * @param {Element} container\n\
         * @param {Object}  options\n\
         *\n\
         * @return {Tooltips}\n\
         */\n\
        function Tooltips(container, options) {\n\
        \tif (!(this instanceof Tooltips)) {\n\
        \t\treturn new Tooltips(container, options);\n\
        \t}\n\
        \n\
        \tvar self = this;\n\
        \tvar observer, TID;\n\
        \n\
        \t/**\n\
        \t * Show tooltip attached to an element.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.show = function (element) {\n\
        \t\treturn callTooltipMethod(element, 'show');\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Hide tooltip attached to an element.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.hide = function (element) {\n\
        \t\treturn callTooltipMethod(element, 'hide');\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Toggle tooltip attached to an element.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.toggle = function (element) {\n\
        \t\treturn callTooltipMethod(element, 'toggle');\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Retrieve tooltip attached to an element and call it's method.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t * @param {String}  method\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tfunction callTooltipMethod(element, method) {\n\
        \t\tvar tip = self.get(element);\n\
        \t\tif (tip) {\n\
        \t\t\ttip[method]();\n\
        \t\t}\n\
        \t\treturn self;\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Return a tooltip attached to an element. Tooltip is created if it doesn't exist yet.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Tooltip}\n\
        \t */\n\
        \tself.get = function (element) {\n\
        \t\tvar tip = !!element && (element[TID] || createTip(element));\n\
        \t\tif (tip && !element[TID]) {\n\
        \t\t\telement[TID] = tip;\n\
        \t\t}\n\
        \t\treturn tip;\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Add element(s) to Tooltips instance.\n\
        \t *\n\
        \t * @param {[type]} element Can be element, or container containing elements to be added.\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.add = function (element) {\n\
        \t\tif (!element || element.nodeType !== 1) {\n\
        \t\t\treturn self;\n\
        \t\t}\n\
        \t\tif (dataset(element).get(options.key)) {\n\
        \t\t\tbindElement(element);\n\
        \t\t} else if (element.children) {\n\
        \t\t\tbindElements(element.querySelectorAll(self.selector));\n\
        \t\t}\n\
        \t\treturn self;\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Remove element(s) from Tooltips instance.\n\
        \t *\n\
        \t * @param {Element} element Can be element, or container containing elements to be removed.\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.remove = function (element) {\n\
        \t\tif (!element || element.nodeType !== 1) {\n\
        \t\t\treturn self;\n\
        \t\t}\n\
        \t\tif (dataset(element).get(options.key)) {\n\
        \t\t\tunbindElement(element);\n\
        \t\t} else if (element.children) {\n\
        \t\t\tunbindElements(element.querySelectorAll(self.selector));\n\
        \t\t}\n\
        \t\treturn self;\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Reload Tooltips instance.\n\
        \t *\n\
        \t * Unbinds current tooltipped elements, than selects the\n\
        \t * data-key elements from container and binds them again.\n\
        \t *\n\
        \t * @return {Tooltips}\n\
        \t */\n\
        \tself.reload = function () {\n\
        \t\t// Unbind old elements\n\
        \t\tunbindElements(self.elements);\n\
        \t\t// Bind new elements\n\
        \t\tbindElements(self.container.querySelectorAll(self.selector));\n\
        \t\treturn self;\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Destroy Tooltips instance.\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tself.destroy = function () {\n\
        \t\tunbindElements(this.elements);\n\
        \t\tif (observer) {\n\
        \t\t\tobserver.disconnect();\n\
        \t\t}\n\
        \t\tthis.container = this.elements = this.options = observer = null;\n\
        \t};\n\
        \n\
        \t/**\n\
        \t * Create a tip from element data attributes.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Tooltip}\n\
        \t */\n\
        \tfunction createTip(element) {\n\
        \t\tvar data = dataset(element);\n\
        \t\tvar content = data.get(options.key);\n\
        \t\tif (!content) {\n\
        \t\t\treturn false;\n\
        \t\t}\n\
        \t\tvar tipOptions = objectCreate(options.tooltip);\n\
        \t\tvar keyData;\n\
        \t\tfor (var key in Tooltip.defaults) {\n\
        \t\t\tkeyData = data.get(options.key + ucFirst(key.replace(/Class$/, '')));\n\
        \t\t\tif (!keyData) {\n\
        \t\t\t\tcontinue;\n\
        \t\t\t}\n\
        \t\t\ttipOptions[key] = keyData;\n\
        \t\t}\n\
        \t\treturn new Tooltip(content, tipOptions).attach(element);\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Bind Tooltips events to Array/NodeList of elements.\n\
        \t *\n\
        \t * @param {Array} elements\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction bindElements(elements) {\n\
        \t\tfor (var i = 0, l = elements.length; i < l; i++) {\n\
        \t\t\tbindElement(elements[i]);\n\
        \t\t}\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Bind Tooltips events to element.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction bindElement(element) {\n\
        \t\tif (element[TID] || ~indexOf(self.elements, element)) {\n\
        \t\t\treturn;\n\
        \t\t}\n\
        \t\tevt.bind(element, options.showOn, eventHandler);\n\
        \t\tevt.bind(element, options.hideOn, eventHandler);\n\
        \t\tself.elements.push(element);\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Unbind Tooltips events from Array/NodeList of elements.\n\
        \t *\n\
        \t * @param {Array} elements\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction unbindElements(elements) {\n\
        \t\tif (self.elements === elements) {\n\
        \t\t\telements = elements.slice();\n\
        \t\t}\n\
        \t\tfor (var i = 0, l = elements.length; i < l; i++) {\n\
        \t\t\tunbindElement(elements[i]);\n\
        \t\t}\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Unbind Tooltips events from element.\n\
        \t *\n\
        \t * @param {Element} element\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction unbindElement(element) {\n\
        \t\tvar index = indexOf(self.elements, element);\n\
        \t\tif (!~index) {\n\
        \t\t\treturn;\n\
        \t\t}\n\
        \t\tif (element[TID]) {\n\
        \t\t\telement[TID].destroy();\n\
        \t\t\tdelete element[TID];\n\
        \t\t}\n\
        \t\tevt.unbind(element, options.showOn, eventHandler);\n\
        \t\tevt.unbind(element, options.hideOn, eventHandler);\n\
        \t\tself.elements.splice(index, 1);\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Tooltips events handler.\n\
        \t *\n\
        \t * @param {Event} event\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction eventHandler(event) {\n\
        \t\t/*jshint validthis:true */\n\
        \t\tif (options.showOn === options.hideOn) {\n\
        \t\t\tself.toggle(this);\n\
        \t\t} else {\n\
        \t\t\tself[event.type === options.showOn ? 'show' : 'hide'](this);\n\
        \t\t}\n\
        \t}\n\
        \n\
        \t/**\n\
        \t * Mutations handler.\n\
        \t *\n\
        \t * @param {Array} mutations\n\
        \t *\n\
        \t * @return {Void}\n\
        \t */\n\
        \tfunction mutationsHandler(mutations) {\n\
        \t\tvar added, removed, i, l;\n\
        \t\tfor (var m = 0, ml = mutations.length; m < ml; m++) {\n\
        \t\t\tadded = mutations[m].addedNodes;\n\
        \t\t\tremoved = mutations[m].removedNodes;\n\
        \t\t\tfor (i = 0, l = added.length; i < l; i++) {\n\
        \t\t\t\tself.add(added[i]);\n\
        \t\t\t}\n\
        \t\t\tfor (i = 0, l = removed.length; i < l; i++) {\n\
        \t\t\t\tself.remove(removed[i]);\n\
        \t\t\t}\n\
        \t\t\tif (mutations[m].type == 'attributes' && mutations[m].attributeName == 'data-title'){\n\
        \t\t\t\tif (!self.get(mutations[m])) { self.add(mutations[m].target); }\n\
        \t\t\t\tself.get(mutations[m].target).content(dataset(mutations[m].target).get('title'));\n\
        \t\t\t}\n\
        \t\t}\n\
        \t}\n\
        \n\
        \t// Construct\n\
        \t(function () {\n\
        \t\tself.container = container;\n\
        \t\tself.options = options = extend(objectCreate(Tooltips.defaults), options);\n\
        \t\tself.ID = TID = options.key + Math.random().toString(36).slice(2);\n\
        \t\tself.elements = [];\n\
        \n\
        \t\t// Create tips selector\n\
        \t\tself.selector = '[data-' + options.key + ']';\n\
        \n\
        \t\t// Load tips\n\
        \t\tself.reload();\n\
        \n\
        \t\t// Create mutations observer\n\
        \t\tif (options.observe && MObserver) {\n\
        \t\t\tobserver = new MObserver(mutationsHandler);\n\
        \t\t\tobserver.observe(self.container, {\n\
        \t\t\t\tchildList: true,\n\
        \t\t\t\tsubtree: true,\n\
        \t\t\t\tattributes: true\n\
        \t\t\t});\n\
        \t\t}\n\
        \t}());\n\
        }\n\
        \n\
        /**\n\
         * Expose Tooltip.\n\
         */\n\
        Tooltips.Tooltip = Tooltip;\n\
        \n\
        /**\n\
         * Default Tooltips options.\n\
         *\n\
         * @type {Object}\n\
         */\n\
        Tooltips.defaults = {\n\
        \ttooltip:    {},          // Options for individual Tooltip instances.\n\
        \tkey:       'tooltip',    // Tooltips data attribute key.\n\
        \tshowOn:    'mouseenter', // Show tooltip event.\n\
        \thideOn:    'mouseleave', // Hide tooltip event.\n\
        \tobserve:   0             // Enable mutation observer (used only when supported).\n\
        };//# sourceURL=tooltips/index.js"
    ));










    fakeRequire.alias("darsain-tooltip/index.js", "tooltips/deps/tooltip/index.js");
    fakeRequire.alias("darsain-tooltip/index.js", "tooltip/index.js");
    fakeRequire.alias("darsain-event/index.js", "darsain-tooltip/deps/event/index.js");

    fakeRequire.alias("darsain-position/index.js", "darsain-tooltip/deps/position/index.js");

    fakeRequire.alias("component-classes/index.js", "darsain-tooltip/deps/classes/index.js");
    fakeRequire.alias("component-indexof/index.js", "component-classes/deps/indexof/index.js");

    fakeRequire.alias("component-indexof/index.js", "darsain-tooltip/deps/indexof/index.js");

    fakeRequire.alias("darsain-event/index.js", "tooltips/deps/event/index.js");
    fakeRequire.alias("darsain-event/index.js", "event/index.js");

    fakeRequire.alias("component-indexof/index.js", "tooltips/deps/indexof/index.js");
    fakeRequire.alias("component-indexof/index.js", "indexof/index.js");

    fakeRequire.alias("code42day-dataset/index.js", "tooltips/deps/dataset/index.js");
    fakeRequire.alias("code42day-dataset/index.js", "dataset/index.js");
    if (typeof exports == "object") {
        module.exports = fakeRequire("tooltips");
    } else if (typeof define == "function" && define.amd) {
        define(function(){ return fakeRequire("tooltips"); });
    } else {
        this["Tooltips"] = fakeRequire("tooltips");
    }})();

},{}]},{},[31])

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9hc3NpZ25tZW50cy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vY2hhbmdlbG9nL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9jb25maWd1cmF0aW9ucy9kcm9wZG93bi1lZGl0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9jb25maWd1cmF0aW9ucy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vZmllbGRzL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9maWVsZHMvbXVsdGljaGVja2JveC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vZmllbGRzL3N1Ym1pdC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL2F0b20uanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL2xtL2Jsb2Nrcy9hdG9tcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL2Jhc2UuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL2xtL2Jsb2Nrcy9ibG9jay5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL2NvbnRhaW5lci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL2dyaWQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL2xtL2Jsb2Nrcy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL29mZmNhbnZhcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYmxvY2tzL3BhcnRpY2xlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9ibG9ja3MvcG9zaXRpb24uanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL2xtL2Jsb2Nrcy9zZWN0aW9uLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9ibG9ja3Mvc3BhY2VyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9ibG9ja3Mvc3lzdGVtLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9ibG9ja3Mvd3JhcHBlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vYnVpbGRlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vZHJhZy5yZXNpemVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9oaXN0b3J5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9pZC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbG0vaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL2xtL2luaGVyaXRhbmNlL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9sYXlvdXRtYW5hZ2VyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9sbS9wYXJ0aWNsZXMtc2lkZWJhci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbWFpbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vbWVudS9kcmFnLnJlc2l6ZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL21lbnUvZXh0cmEtaXRlbXMuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL21lbnUvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL21lbnUvbWVudW1hbmFnZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3BhZ2VzZXR0aW5ncy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vcGFydGljbGVzL2NvbGxlY3Rpb25zL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9wYXJ0aWNsZXMvY29sb3JwaWNrZXIvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3BhcnRpY2xlcy9maWxlcGlja2VyL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9wYXJ0aWNsZXMvZm9udHMvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3BhcnRpY2xlcy9pY29ucy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vcGFydGljbGVzL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9wYXJ0aWNsZXMvaW5zdGFuY2VwaWNrZXIvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3BhcnRpY2xlcy9rZXl2YWx1ZS9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vcGFydGljbGVzL21lbnUvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3Bvc2l0aW9ucy9jYXJkcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vcG9zaXRpb25zL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi9zdHlsZXMvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3VpL2NvbGxhcHNlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91aS9kcmFnLmRyb3AuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3VpL2RyYWcuZXZlbnRzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91aS9lcmFzZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3VpL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91aS9tb2RhbC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdWkvcG9wb3Zlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdWkvcHJvZ3Jlc3Nlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdWkvc2VsZWN0aXplLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91aS90b2FzdHIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3VpL3RvZ2dsZXJzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91aS90b29sdGlwcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvYWpheGlmeS1saW5rcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvYXN5bmMtZm9yZWFjaC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvZGVjb3VwbGUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3V0aWxzL2VsZW1lbnRzLnV0aWxzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91dGlscy9lbGVtZW50cy52aWV3cG9ydC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvZmllbGQtdmFsaWRhdGlvbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvZmxhZ3Mtc3RhdGUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3V0aWxzL2dldC1hamF4LXN1ZmZpeC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvZ2V0LWFqYXgtdXJsLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91dGlscy9nZXQtb3V0bGluZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvZ2V0LXNjcm9sbGJhci13aWR0aC5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvaGlzdG9yeS1hZGFwdGVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91dGlscy9oaXN0b3J5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9hcHBsaWNhdGlvbi91dGlscy9yQUYtcG9seWZpbGwuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3V0aWxzL3NhdmUtc3RhdGUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL2FwcGxpY2F0aW9uL3V0aWxzL3RyYW5zbGF0ZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vYXBwbGljYXRpb24vdXRpbHMvd3Atd2lkZ2V0cy1jdXN0b21pemVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9mb3JFYWNoLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvaW5kZXhPZi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L3JlbW92ZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvY3JlYXRlT2JqZWN0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc0FycmF5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc0Z1bmN0aW9uLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc0tpbmQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9sYW5nL2lzT2JqZWN0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc1N0cmluZy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2xhbmcva2luZE9mLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy90b1N0cmluZy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9mb3JJbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9mb3JPd24uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvaGFzT3duLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L21peEluLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL1dISVRFX1NQQUNFUy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9sdHJpbS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9ydHJpbS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy90cmltLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3VwcGVyQ2FzZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3RpbWUvbm93LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL3ByaW1lL2RlZmVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL3ByaW1lL2VtaXR0ZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvcHJpbWUvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9jdWJpYy1iZXppZXIvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9kZWVwLWRpZmYvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9kcm9wem9uZS9kaXN0L2Ryb3B6b25lLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvYXR0cmlidXRlcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL2Jhc2UuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9kZWxlZ2F0aW9uLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvZG9tcmVhZHkuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ldmVudHMuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL2luc2VydGlvbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2V2ZXJ5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvZmlsdGVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvbWFwLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvc29tZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2Z1bmN0aW9uL2lkZW50aXR5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2Z1bmN0aW9uL3Byb3AuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZGVlcE1hdGNoZXMuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy90cmF2ZXJzYWwuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9lbGVtZW50cy96ZW4uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L2xpYi9icm93c2VyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbGliL2NvbG9yLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbGliL2ZyYW1lLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbGliL2Z4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbGliL3VubWF0cml4MmQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvZWxlbWVudHMvaW5kZXguanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvYXJyYXkvZXZlcnkuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvYXJyYXkvZmlsdGVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL2FycmF5L2ZvckVhY2guanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvYXJyYXkvaW5kZXhPZi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9hcnJheS9tYXAuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvYXJyYXkvc29tZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9pbmRleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9vYmplY3QvY3JlYXRlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL29iamVjdC9maWx0ZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvb2JqZWN0L2ZvckluLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL29iamVjdC9mb3JPd24uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvb2JqZWN0L2hhc093bi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9vYmplY3QvbWl4SW4uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvc3RyaW5nL2NhbWVsaXplLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy9jYXBpdGFsaXplLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy9jbGVhbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9zdHJpbmcvaHlwaGVuYXRlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy90cmltLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3R5cGUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2FwcGVuZC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvY29tYmluZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvY29udGFpbnMuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2RpZmZlcmVuY2UuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2VxdWFscy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvZmluZC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvZmluZEluZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9mbGF0dGVuLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9pbnNlcnQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2ludGVyc2VjdGlvbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvaW52b2tlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9sYXN0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9yZW1vdmVBbGwuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L3NsaWNlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9zcGxpdC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvdW5pcXVlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9jb2xsZWN0aW9uL2NvbnRhaW5zLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9jb2xsZWN0aW9uL2ZpbmQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2NvbGxlY3Rpb24vZm9yRWFjaC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvY29sbGVjdGlvbi9tYWtlXy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvY29sbGVjdGlvbi9zaXplLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9mdW5jdGlvbi9iaW5kLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9mdW5jdGlvbi9kZWJvdW5jZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvZnVuY3Rpb24vc2VyaWVzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9sYW5nL0dMT0JBTC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9jbG9uZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9kZWVwQ2xvbmUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvZGVlcEVxdWFscy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pcy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc0Jvb2xlYW4uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNOdW1iZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNQbGFpbk9iamVjdC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc1ByaW1pdGl2ZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy90b0FycmF5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9sYW5nL3RvTnVtYmVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9tYXRoL2NsYW1wLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9tYXRoL2xlcnAuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L21hdGgvbWFwLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9tYXRoL25vcm0uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L251bWJlci9NQVhfSU5ULmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9udW1iZXIvTUlOX0lOVC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L251bWJlci90b0ludC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2NvbnRhaW5zLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZGVlcEZpbGxJbi5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2RlZXBNYXRjaGVzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZXF1YWxzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZXZlcnkuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9maWx0ZXIuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9maW5kLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZ2V0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvaGFzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3Qva2V5cy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L21lcmdlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvbmFtZXNwYWNlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3Qvb21pdC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L3NldC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L3NpemUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9zb21lLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvdW5zZXQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC92YWx1ZXMuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3F1ZXJ5U3RyaW5nL2VuY29kZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvcXVlcnlTdHJpbmcvZ2V0UGFyYW0uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3F1ZXJ5U3RyaW5nL2dldFF1ZXJ5LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9xdWVyeVN0cmluZy9zZXRQYXJhbS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvcmFuZG9tL2Nob2ljZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvcmFuZG9tL2d1aWQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3JhbmRvbS9yYW5kLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9yYW5kb20vcmFuZEhleC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvcmFuZG9tL3JhbmRJbnQuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3JhbmRvbS9yYW5kb20uanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9jb250YWlucy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2VuZHNXaXRoLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvZXNjYXBlSHRtbC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2VzY2FwZVVuaWNvZGUuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9pbnRlcnBvbGF0ZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2xvd2VyQ2FzZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3Byb3BlckNhc2UuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9yZW1vdmVOb25Xb3JkLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvcmVwZWF0LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvcmVwbGFjZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3JlcGxhY2VBY2NlbnRzLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvcnBhZC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3NsdWdpZnkuanMiLCJwbGF0Zm9ybXMvY29tbW9uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy90eXBlY2FzdC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3VuZXNjYXBlSHRtbC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL3VuaHlwaGVuYXRlLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvcHJpbWUtdXRpbC9ub2RlX21vZHVsZXMvbW91dC9sYW5nL2Nsb25lLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvcHJpbWUtdXRpbC9wcmltZS9ib3VuZC5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucy5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3ByaW1lL2RlZmVyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvcHJpbWUvZW1pdHRlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3ByaW1lL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvcHJpbWUvbWFwLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvc2lmdGVyL3NpZnRlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3NsaWNrL2ZpbmRlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3NsaWNrL2luZGV4LmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvc2xpY2svcGFyc2VyLmpzIiwicGxhdGZvcm1zL2NvbW1vbi9ub2RlX21vZHVsZXMvc29ydGFibGVqcy9Tb3J0YWJsZS5qcyIsInBsYXRmb3Jtcy9jb21tb24vbm9kZV9tb2R1bGVzL3dlYmZvbnRsb2FkZXIvd2ViZm9udGxvYWRlci5qcyIsInBsYXRmb3Jtcy9jb21tb24vanMvdG9vbHRpcHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDM0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN09BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9NQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdG5CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9RQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDalRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdlZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDdGdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDL1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDanVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUMxY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM3VCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3bkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaHdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3YvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3RhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2dURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDek5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDcjZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbGZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzd6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzF2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xuXG4vLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXRcbi8vIGRvbid0IGJyZWFrIHRoaW5ncy4gIEJ1dCB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gYSB0cnkgY2F0Y2ggaW4gY2FzZSBpdCBpc1xuLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYVxuLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy5cblxudmFyIGNhY2hlZFNldFRpbWVvdXQ7XG52YXIgY2FjaGVkQ2xlYXJUaW1lb3V0O1xuXG5mdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCAoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbn1cbihmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXRUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhclRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgfVxufSAoKSlcbmZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7XG4gICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIC8vIGlmIHNldFRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRTZXRUaW1lb3V0ID09PSBkZWZhdWx0U2V0VGltb3V0IHx8ICFjYWNoZWRTZXRUaW1lb3V0KSAmJiBzZXRUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfSBjYXRjaChlKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApO1xuICAgICAgICB9IGNhdGNoKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3JcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG59XG5mdW5jdGlvbiBydW5DbGVhclRpbWVvdXQobWFya2VyKSB7XG4gICAgaWYgKGNhY2hlZENsZWFyVGltZW91dCA9PT0gY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIC8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9uc1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIC8vIGlmIGNsZWFyVGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKG51bGwsIG1hcmtlcik7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuXG4gICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwodGhpcywgbWFya2VyKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn1cbnZhciBxdWV1ZSA9IFtdO1xudmFyIGRyYWluaW5nID0gZmFsc2U7XG52YXIgY3VycmVudFF1ZXVlO1xudmFyIHF1ZXVlSW5kZXggPSAtMTtcblxuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgfVxuICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgZHJhaW5RdWV1ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG5cbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB9XG4gICAgY3VycmVudFF1ZXVlID0gbnVsbDtcbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIHJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTtcbn1cblxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHJ1blRpbWVvdXQoZHJhaW5RdWV1ZSk7XG4gICAgfVxufTtcblxuLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gICAgdGhpcy5hcnJheSA9IGFycmF5O1xufVxuSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xufTtcbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9O1xucHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcbnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHJlYWR5ICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgbWFwICAgICAgICAgID0gcmVxdWlyZSgncHJpbWUvbWFwJykoKSxcbiAgICBtZXJnZSAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9tZXJnZScpLFxuICAgIGZvckVhY2ggICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvZm9yRWFjaCcpLFxuICAgIHRyaW0gICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICAkICAgICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIGRlY291cGxlICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2RlY291cGxlJyksXG4gICAgYXN5bmNGb3JFYWNoID0gcmVxdWlyZSgnLi4vdXRpbHMvYXN5bmMtZm9yZWFjaCcpO1xuXG52YXIgTWFwICAgICAgICAgPSBtYXAsXG4gICAgQXNzaWdubWVudHMgPSB7XG4gICAgICAgIHRvZ2dsZVNlY3Rpb246IGZ1bmN0aW9uKGUsIGVsZW1lbnQsIGluZGV4LCBhcnJheSkge1xuICAgICAgICAgICAgaWYgKGUudHlwZS5tYXRjaCgvXnRvdWNoLykpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5zaWJsaW5ncygnW2RhdGEtZy1nbG9iYWwtZmlsdGVyXScpIHx8IGVsZW1lbnQucGFyZW50KCdbZGF0YS1nLWdsb2JhbC1maWx0ZXJdJykpIHsgcmV0dXJuIEFzc2lnbm1lbnRzLmdsb2JhbFRvZ2dsZVNlY3Rpb24oZSwgZWxlbWVudCk7IH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lm1hdGNoZXMoJ2xhYmVsJykpIHsgcmV0dXJuIEFzc2lnbm1lbnRzLnRyZWF0TGFiZWwoZSwgZWxlbWVudCk7IH1cblxuICAgICAgICAgICAgdmFyIGNhcmQgICAgPSBlbGVtZW50LnBhcmVudCgnLmNhcmQnKSxcbiAgICAgICAgICAgICAgICB0b2dnbGVzID0gTWFwLmdldChjYXJkKSxcbiAgICAgICAgICAgICAgICBzYXZlICAgID0gJCgnW2RhdGEtc2F2ZV0nKSxcbiAgICAgICAgICAgICAgICBtb2RlICAgID0gZWxlbWVudC5kYXRhKCdnLWFzc2lnbm1lbnRzLWNoZWNrJykgPT0gbnVsbCA/IDAgOiAxO1xuXG4gICAgICAgICAgICBpZiAoIXRvZ2dsZXMgfHwgIXRvZ2dsZXMuaW5wdXRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0cyA9IGNhcmQuc2VhcmNoKCcuZW5hYmxlciBpbnB1dFt0eXBlPWhpZGRlbl0nKTtcblxuICAgICAgICAgICAgICAgIGlmICghdG9nZ2xlcykgeyB0b2dnbGVzID0gTWFwLnNldChjYXJkLCB7IGlucHV0czogaW5wdXRzIH0pLmdldChjYXJkKTsgfVxuICAgICAgICAgICAgICAgIGlmICghdG9nZ2xlcy5pbnB1dHMpIHsgdG9nZ2xlcyA9IE1hcC5zZXQoY2FyZCwgbWVyZ2UoTWFwLmdldChjYXJkKSwgeyBpbnB1dHM6IGlucHV0cyB9KSkuZ2V0KGNhcmQpOyB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIG5lY2Vzc2FyeSB3ZSBzaG91bGQgbW92ZSB0byBhc3luY0ZvckVhY2ggZm9yIGFuIGFzeW5jaHJvbm91cyBsb29wLCBlbHNlIGZvckVhY2hcbiAgICAgICAgICAgIGFzeW5jRm9yRWFjaCh0b2dnbGVzLmlucHV0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSAkKGl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50KCdsYWJlbCwgaDQnKS5jb21wdXRlKCdkaXNwbGF5JykgPT0gJ25vbmUnKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZShtb2RlKS5lbWl0KCdjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGl0ZW0gfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGluZGV4ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgYXJyYXkgIT09ICd1bmRlZmluZWQnICYmIChpbmRleCArIDEgPT0gYXJyYXkubGVuZ3RoKSkge1xuICAgICAgICAgICAgICAgICAgICBzYXZlLmRpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBmaWx0ZXJTZWN0aW9uOiBmdW5jdGlvbihlLCBlbGVtZW50LCB2YWx1ZSwgZ2xvYmFsKSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5zaWJsaW5ncygnW2RhdGEtZy1nbG9iYWwtZmlsdGVyXScpIHx8IGVsZW1lbnQucGFyZW50KCdbZGF0YS1nLWdsb2JhbC1maWx0ZXJdJykpIHsgcmV0dXJuIEFzc2lnbm1lbnRzLmdsb2JhbEZpbHRlclNlY3Rpb24oZSwgZWxlbWVudCk7IH1cblxuICAgICAgICAgICAgdmFyIGNhcmQgICAgICAgID0gZWxlbWVudC5wYXJlbnQoJy5jYXJkJyksXG4gICAgICAgICAgICAgICAgb25seUVuYWJsZWQgPSAkKCdbZGF0YS1hc3NpZ25tZW50cy1lbmFibGVkb25seV0nKSxcbiAgICAgICAgICAgICAgICBpdGVtcyAgICAgICA9IE1hcC5nZXQoY2FyZCkgfHwgTWFwLnNldChjYXJkLCB7IGxhYmVsczogY2FyZC5zZWFyY2goJ2xhYmVsIC5zZXR0aW5ncy1wYXJhbS10aXRsZScpIH0pLmdldChjYXJkKTtcblxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCBlbGVtZW50LnZhbHVlKCk7XG5cbiAgICAgICAgICAgIGlmICghaXRlbXMgfHwgIWl0ZW1zLmxhYmVscykge1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbHMgPSBjYXJkLnNlYXJjaCgnbGFiZWwgLnNldHRpbmdzLXBhcmFtLXRpdGxlJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zKSB7IGl0ZW1zID0gTWFwLnNldChjYXJkLCB7IGxhYmVsczogbGFiZWxzIH0pLmdldChjYXJkKTsgfVxuICAgICAgICAgICAgICAgIGlmICghaXRlbXMubGFiZWxzKSB7IGl0ZW1zID0gTWFwLnNldChjYXJkLCBtZXJnZShNYXAuZ2V0KGNhcmQpLCB7IGxhYmVsczogbGFiZWxzIH0pKS5nZXQoY2FyZCk7IH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaXRlbXMgPSAkKGl0ZW1zLmxhYmVscyk7XG5cbiAgICAgICAgICAgIGlmICghdmFsdWUgJiYgIW9ubHlFbmFibGVkLmNoZWNrZWQoKSkge1xuICAgICAgICAgICAgICAgIGNhcmQuc3R5bGUoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zID8gaXRlbXMuc2VhcmNoKCchPiBsYWJlbCcpLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJykgOiBpdGVtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNvdW50ID0gMCwgb2ZmID0gMCwgb24gPSAwLCB0ZXh0LCBtYXRjaDtcblxuICAgICAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50KCcuY2FyZCcpLnN0eWxlKCdkaXNwbGF5Jywgb25seUVuYWJsZWQuY2hlY2tlZCgpIHx8IHZhbHVlID8gJ25vbmUnIDogJ2lubGluZS1ibG9jaycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhc3luY0ZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKGl0ZW0sIGkpIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdHJpbShpdGVtLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKG5ldyBSZWdFeHAoXCJeXCIgKyB2YWx1ZSArICd8XFxcXHMnICsgdmFsdWUsICdnaScpKTtcblxuICAgICAgICAgICAgICAgIGlmIChvbmx5RW5hYmxlZC5jaGVja2VkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBOdW1iZXIoISFtYXRjaCkgJiBOdW1iZXIoaXRlbS5wYXJlbnQoJ2xhYmVsLCBoNCcpLmZpbmQoJy5lbmFibGVyIGlucHV0W3R5cGU9XCJoaWRkZW5cIl0nKS52YWx1ZSgpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gaXRlbS5wYXJlbnQoJ1tkYXRhLWctYXNzaWdubWVudHMtcGFyZW50XScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXAgJiYgKGdyb3VwID0gZ3JvdXAuZGF0YSgnZy1hc3NpZ25tZW50cy1wYXJlbnQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRHcm91cCA9IGl0ZW0ucGFyZW50KCcuY2FyZCcpLmZpbmQoJ1tkYXRhLWctYXNzaWdubWVudHMtZ3JvdXA9XCInICsgZ3JvdXAgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50R3JvdXApIHsgcGFyZW50R3JvdXAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnQoJ2xhYmVsLCBoNCcpLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgIG9uKys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnQoJ2xhYmVsLCBoNCcpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgb2ZmKys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICBpZiAoY291bnQgPT0gaXRlbXMubGVuZ3RoICYmIGdsb2JhbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXJkLnN0eWxlKCdkaXNwbGF5JywgIW9uID8gJ25vbmUnIDogJ2lubGluZS1ibG9jaycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZpbHRlckVuYWJsZWRPbmx5OiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgZ2xvYmFsID0gJCgnW2RhdGEtZy1nbG9iYWwtZmlsdGVyXSBpbnB1dFt0eXBlPVwidGV4dFwiXScpO1xuICAgICAgICAgICAgQXNzaWdubWVudHMuZ2xvYmFsRmlsdGVyU2VjdGlvbihlLCBnbG9iYWwsIGVsZW1lbnQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRyZWF0TGFiZWw6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQuc3RvcFByb3BhZ2F0aW9uICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5tYXRjaGVzKCcua25vYiwgLnRvZ2dsZScpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIGlucHV0ID0gZWxlbWVudC5maW5kKCdpbnB1dFt0eXBlPVwiaGlkZGVuXCJdOm5vdChbZGlzYWJsZWRdKScpO1xuICAgICAgICAgICAgaWYgKCFpbnB1dCkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5wdXQudmFsdWUoKTtcbiAgICAgICAgICAgIHZhbHVlID0gISErdmFsdWU7XG4gICAgICAgICAgICBpbnB1dC52YWx1ZShOdW1iZXIoIXZhbHVlKSkuZW1pdCgnY2hhbmdlJyk7XG4gICAgICAgICAgICAkKCdib2R5JykuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGlucHV0IH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2xvYmFsVG9nZ2xlU2VjdGlvbjogZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIG1vZGUgICA9IGVsZW1lbnQuZGF0YSgnZy1hc3NpZ25tZW50cy1jaGVjaycpID09IG51bGwgPyAnW2RhdGEtZy1hc3NpZ25tZW50cy11bmNoZWNrXScgOiAnW2RhdGEtZy1hc3NpZ25tZW50cy1jaGVja10nLFxuICAgICAgICAgICAgICAgIHNhdmUgICA9ICQoJ1tkYXRhLXNhdmVdJyksXG4gICAgICAgICAgICAgICAgc2VhcmNoID0gJCgnI2Fzc2lnbm1lbnRzIC5jYXJkICcgKyBtb2RlICsgJywgJyArICcuc2V0dGluZ3MtYXNzaWdubWVudHMgLmNhcmQgJyArIG1vZGUpO1xuXG4gICAgICAgICAgICBpZiAoIXNlYXJjaCkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgc2F2ZS5kaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICAgIC8vIGlmIG5lY2Vzc2FyeSB3ZSBzaG91bGQgbW92ZSB0byBhc3luY0ZvckVhY2ggZm9yIGFuIGFzeW5jaHJvbm91cyBsb29wXG4gICAgICAgICAgICBhc3luY0ZvckVhY2goc2VhcmNoLCBmdW5jdGlvbihpdGVtLCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICAgICAgICBBc3NpZ25tZW50cy50b2dnbGVTZWN0aW9uKGUsICQoaXRlbSksIGluZGV4LCBhcnJheSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnbG9iYWxGaWx0ZXJTZWN0aW9uOiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgICAgICAgPSBlbGVtZW50LnZhbHVlKCksXG4gICAgICAgICAgICAgICAgb25seUVuYWJsZWQgPSAkKCdbZGF0YS1hc3NpZ25tZW50cy1lbmFibGVkb25seV0nKSxcbiAgICAgICAgICAgICAgICBzZWFyY2ggICAgICA9ICQoJyNhc3NpZ25tZW50cyAuY2FyZCAuc2VhcmNoIGlucHV0W3R5cGU9XCJ0ZXh0XCJdLCAuc2V0dGluZ3MtYXNzaWdubWVudHMgLmNhcmQgLnNlYXJjaCBpbnB1dFt0eXBlPVwidGV4dFwiXScpO1xuXG4gICAgICAgICAgICBpZiAoIXNlYXJjaCAmJiAhb25seUVuYWJsZWQuY2hlY2tlZCgpKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBhc3luY0ZvckVhY2goc2VhcmNoLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgQXNzaWdubWVudHMuZmlsdGVyU2VjdGlvbihlLCAkKGl0ZW0pLCB2YWx1ZSwgJ2dsb2JhbCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGVEZWxlZ2F0aW9uOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGVuYWJsZWQgPSBlbGVtZW50LnZhbHVlKCkgPT0gJzEnO1xuICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ2Rpc2FibGVkJywgIWVuYWJsZWQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIGNocm9tZSB3b3JrYXJvdW5kIGZvciBvdmVyZmxvdyBhbmQgY29sdW1uc1xuICAgICAgICBjaHJvbWVGaXg6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCFBc3NpZ25tZW50cy5pc0Nocm9tZSgpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIHBhbmVscyA9ICQoJyNhc3NpZ25tZW50cyAuc2V0dGluZ3MtcGFyYW0td3JhcHBlciwgLnNldHRpbmdzLWFzc2lnbm1lbnRzIC5zZXR0aW5ncy1wYXJhbS13cmFwcGVyJyksIGhlaWdodCwgbWF4SGVpZ2h0O1xuICAgICAgICAgICAgaWYgKCFwYW5lbHMpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIHBhbmVscy5mb3JFYWNoKGZ1bmN0aW9uKHBhbmVsKXtcbiAgICAgICAgICAgICAgICBwYW5lbCA9ICQocGFuZWwpO1xuICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IHBhcnNlSW50KHBhbmVsLmNvbXB1dGUoJ21heC1oZWlnaHQnKSwgMTApO1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IHBhbmVsWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgICAgICAgICBwYW5lbC5zdHlsZSh7b3ZlcmZsb3c6IGhlaWdodCA+PSBtYXhIZWlnaHQgPyAnYXV0bycgOiAndmlzaWJsZSd9KTtcblxuICAgICAgICAgICAgICAgIGlmIChoZWlnaHQgPj0gbWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHQgPSAxMDA7XG4gICAgICAgICAgICAgICAgICAgIGRlY291cGxlKHBhbmVsLCAnc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbHQgPSBhbHQgPT0gMTAwID8gMTAwLjAxIDogMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFuZWwucGFyZW50KCcuY2FyZCcpLnN0eWxlKCd3aWR0aCcsIGFsdCArICclJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzQ2hyb21lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignY2hyb21lJykgPiAtMTtcbiAgICAgICAgfVxuICAgIH07XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnaW5wdXQnLCAnI2Fzc2lnbm1lbnRzIC5zZWFyY2ggaW5wdXRbdHlwZT1cInRleHRcIl0sIC5zZXR0aW5ncy1hc3NpZ25tZW50cyAuc2VhcmNoIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJywgQXNzaWdubWVudHMuZmlsdGVyU2VjdGlvbik7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnI2Fzc2lnbm1lbnRzIC5jYXJkIGxhYmVsLCAjYXNzaWdubWVudHMgW2RhdGEtZy1hc3NpZ25tZW50cy1jaGVja10sICNhc3NpZ25tZW50cyBbZGF0YS1nLWFzc2lnbm1lbnRzLXVuY2hlY2tdLCAuc2V0dGluZ3MtYXNzaWdubWVudHMgLmNhcmQgbGFiZWwsIC5zZXR0aW5ncy1hc3NpZ25tZW50cyBbZGF0YS1nLWFzc2lnbm1lbnRzLWNoZWNrXSwgLnNldHRpbmdzLWFzc2lnbm1lbnRzIFtkYXRhLWctYXNzaWdubWVudHMtdW5jaGVja10nLCBBc3NpZ25tZW50cy50b2dnbGVTZWN0aW9uKTtcbiAgICBib2R5LmRlbGVnYXRlKCd0b3VjaGVuZCcsICcjYXNzaWdubWVudHMgLmNhcmQgbGFiZWwsICNhc3NpZ25tZW50cyBbZGF0YS1nLWFzc2lnbm1lbnRzLWNoZWNrXSwgI2Fzc2lnbm1lbnRzIFtkYXRhLWctYXNzaWdubWVudHMtdW5jaGVja10sIC5zZXR0aW5ncy1hc3NpZ25tZW50cyAuY2FyZCBsYWJlbCwgLnNldHRpbmdzLWFzc2lnbm1lbnRzIFtkYXRhLWctYXNzaWdubWVudHMtY2hlY2tdLCAuc2V0dGluZ3MtYXNzaWdubWVudHMgW2RhdGEtZy1hc3NpZ25tZW50cy11bmNoZWNrXScsIEFzc2lnbm1lbnRzLnRvZ2dsZVNlY3Rpb24pO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbZGF0YS1hc3NpZ25tZW50cy1lbmFibGVkb25seV0nLCBBc3NpZ25tZW50cy5maWx0ZXJFbmFibGVkT25seSk7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2hhbmdlJywgJyNhc3NpZ25tZW50cyBpbnB1dFt0eXBlPVwiaGlkZGVuXCJdW25hbWVdLCAuc2V0dGluZ3MtYXNzaWdubWVudHMgaW5wdXRbdHlwZT1cImhpZGRlblwiXVtuYW1lXScsIEFzc2lnbm1lbnRzLnRvZ2dsZVN0YXRlRGVsZWdhdGlvbik7XG5cbiAgICAvLyBjaHJvbWUgd29ya2Fyb3VuZCBmb3Igb3ZlcmZsb3cgYW5kIGNvbHVtbnNcbiAgICAvL2lmIChBc3NpZ25tZW50cy5pc0Nocm9tZSgpKSBBc3NpZ25tZW50cy5jaHJvbWVGaXgoKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFzc2lnbm1lbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHVpICAgICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLFxuICAgIGludGVycG9sYXRlICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9pbnRlcnBvbGF0ZScpLFxuICAgIG1vZGFsICAgICAgICAgPSB1aS5tb2RhbCxcbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhVUkwgICAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5nbG9iYWwsXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAvLyBDaGFuZ2Vsb2cgbGlua3NcbiAgICAkKCdib2R5JykuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNoYW5nZWxvZ10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdnNS1kaWFsb2ctdGhlbWUtZGVmYXVsdCBnNS1tb2RhbC1jaGFuZ2Vsb2cnLFxuICAgICAgICAgICAgZGF0YTogeyB2ZXJzaW9uOiBlbGVtZW50LmRhdGEoJ2NoYW5nZWxvZycpIH0sXG4gICAgICAgICAgICByZW1vdGU6IHBhcnNlQWpheFVSSShnZXRBamF4VVJMKCdjaGFuZ2Vsb2cnKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICB2YXIgd3JhcHBlciAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25zID0gd3JhcHBlci5zZWFyY2goJyNnLWNoYW5nZWxvZyA+IG9sID4gbGkgPiBhJyk7XG5cbiAgICAgICAgICAgICAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHNlY3Rpb24sIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbiA9ICQoc2VjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBocmVmICAgICAgPSBzZWN0aW9uLmhyZWYoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlICAgICAgICA9IG5ldyBSZWdFeHAoJyMoY29tbW9ufCcgKyBHQU5UUllfUExBVEZPUk0gKyAnKSQnLCBcImdpXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VkID0gIWhyZWYubWF0Y2gocmUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzICAgID0gJ2NoZXZyb24tJyArICghY29sbGFwc2VkID8gJ3VwJyA6ICdkb3duJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmltKHNlY3Rpb24udGV4dCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGxhdGZvcm1zXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIG5vdCBjb21tb24gYnV0IHRoZSBjdXJyZW50IHBsYXRmb3JtLCBtb3ZlIGl0IGFmdGVyIGNvbW1vblxuICAgICAgICAgICAgICAgICAgICBpZiAoaSAmJiAhY29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLnBhcmVudCgnbGknKS5hZnRlcihzZWN0aW9uLnBhcmVudCgnb2wnKS5maW5kKCc+IGxpJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgemVuKCdpW2NsYXNzPVwiZmEgZy1jaGFuZ2Vsb2ctdG9nZ2xlIGZhLWZ3IGZhLScgKyBzdGF0dXMgKyAnXCJdJykuYm90dG9tKHNlY3Rpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb24ubmV4dFNpYmxpbmcoKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uICAgICAgPSBzZWN0aW9uLmZpbmQoJ2lbY2xhc3MqPVwiZmEtY2hldnJvbi1cIl0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZWQgPSBpY29uLmhhc0NsYXNzKCdmYS1jaGV2cm9uLWRvd24nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxhcHNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb24ucmVtb3ZlQ2xhc3MoJ2ZhLWNoZXZyb24tZG93bicpLmFkZENsYXNzKCdmYS1jaGV2cm9uLXVwJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5uZXh0U2libGluZygpLnNsaWRlRG93bigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uLnJlbW92ZUNsYXNzKCdmYS1jaGV2cm9uLXVwJykuYWRkQ2xhc3MoJ2ZhLWNoZXZyb24tZG93bicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb24ubmV4dFNpYmxpbmcoKS5zbGlkZVVwKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcblxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLm1vZGFsLFxuICAgIGd1aWQgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3JhbmRvbS9ndWlkJyksXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcblxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBwYXJzZUFqYXhVUkkgID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFVSTCAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmdsb2JhbCxcblxuICAgIEhpc3RvcnkgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9oaXN0b3J5JyksXG4gICAgZ2V0UGFyYW0gICAgICA9IHJlcXVpcmUoJ21vdXQvcXVlcnlTdHJpbmcvZ2V0UGFyYW0nKSxcbiAgICBzZXRQYXJhbSAgICAgID0gcmVxdWlyZSgnbW91dC9xdWVyeVN0cmluZy9zZXRQYXJhbScpO1xuXG5cbnZhciByZWZyZXNoV29yZHByZXNzTGlua3MgPSBmdW5jdGlvbiAodGl0bGUsIHZhbHVlKSB7XG4gICAgaWYgKEdBTlRSWV9QTEFURk9STSA9PSAnd29yZHByZXNzJykge1xuICAgICAgICAvLyByZWZyZXNoIFVSSXMgd2l0aCBuZXcgY29uZmlndXJhdGlvbiBuYW1lXG4gICAgICAgIHZhciByZXBsYWNlID0gdGl0bGUucmVwbGFjZSgvW15hLXpcXGRfLVxcc10vaSwgJ18nKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgZmluZCA9ICQoJ1tocmVmKj1cIi8nICsgdmFsdWUgKyAnL1wiXScpLFxuICAgICAgICAgICAgY3VycmVudFVSSSA9IEhpc3RvcnkuZ2V0UGFnZVVybCgpLFxuICAgICAgICAgICAgY3VycmVudFZpZXcgPSBnZXRQYXJhbShjdXJyZW50VVJJLCAndmlldycpO1xuXG4gICAgICAgIGlmIChmaW5kKSB7XG4gICAgICAgICAgICBmaW5kLmZvckVhY2goZnVuY3Rpb24obG5rKXtcbiAgICAgICAgICAgICAgICBsbmsgPSAkKGxuayk7XG4gICAgICAgICAgICAgICAgdmFyIGhyZWYgPSBsbmsuaHJlZigpLnJlcGxhY2UoJy8nICsgdmFsdWUgKyAnLycsICcvJyArIHJlcGxhY2UgKyAnLycpO1xuICAgICAgICAgICAgICAgIGxuay5ocmVmKGhyZWYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50VmlldyA9IGN1cnJlbnRWaWV3LnJlcGxhY2UoJy8nICsgdmFsdWUgKyAnLycsICcvJyArIHJlcGxhY2UgKyAnLycpO1xuICAgICAgICBjdXJyZW50VVJJID0gc2V0UGFyYW0oY3VycmVudFVSSSwgJ3ZpZXcnLCBjdXJyZW50Vmlldyk7XG4gICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlKHsgdXVpZDogZ3VpZCgpLCBkb05vdGhpbmc6IHRydWUgfSwgd2luZG93LmRvY3VtZW50LnRpdGxlLCBjdXJyZW50VVJJKTtcbiAgICB9XG59O1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIHZhciBzZWxlY3RpemVkLCBzZWxlY3QsIGVkaXRhYmxlLCBocmVmO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2tleWRvd24nLCAnLmNvbmZpZy1zZWxlY3Qtd3JhcCBbZGF0YS10aXRsZS1lZGl0XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBrZXkgPSAoZXZlbnQud2hpY2ggPyBldmVudC53aGljaCA6IGV2ZW50LmtleUNvZGUpO1xuICAgICAgICBpZiAoa2V5ID09IDMyIHx8IGtleSA9PSAxMykgeyAvLyBBUklBIHN1cHBvcnQ6IFNwYWNlIC8gRW50ZXIgdG9nZ2xlXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgYm9keS5lbWl0KCdtb3VzZWRvd24nLCBldmVudCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlZG93bicsICcuY29uZmlnLXNlbGVjdC13cmFwIFtkYXRhLXRpdGxlLWVkaXRdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgc2VsZWN0aXplZCA9IGVsZW1lbnQuc2libGluZ3MoJy5nLXNlbGVjdGl6ZS1jb250cm9sJyk7XG4gICAgICAgIHNlbGVjdCA9IGVsZW1lbnQuc2libGluZ3MoJ3NlbGVjdCcpO1xuICAgICAgICBlZGl0YWJsZSA9IGVsZW1lbnQuc2libGluZ3MoJ1tkYXRhLXRpdGxlLWVkaXRhYmxlXScpO1xuXG4gICAgICAgIGlmICghZWRpdGFibGUuZ0NvbmZFZGl0QXR0YWNoZWQpIHtcbiAgICAgICAgICAgIGVkaXRhYmxlLmdDb25mRWRpdEF0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGVkaXRhYmxlLm9uKCd0aXRsZS1lZGl0LWVuZCcsIGZ1bmN0aW9uKHRpdGxlLCBvcmlnaW5hbCwgY2FuY2VsZWQpIHtcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRyaW0odGl0bGUpO1xuICAgICAgICAgICAgICAgIGlmIChjYW5jZWxlZCB8fCB0aXRsZSA9PSBvcmlnaW5hbCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RpemVkLnN0eWxlKCdkaXNwbGF5JywgJ2lubGluZS1ibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZS5zdHlsZSgnZGlzcGxheScsICdub25lJykuYXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCBudWxsKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdmYS1wZW5jaWwnKS5hZGRDbGFzcygnZmEtc3Bpbi1mYXN0IGZhLXNwaW5uZXInKTtcbiAgICAgICAgICAgICAgICBocmVmID0gZWRpdGFibGUuZGF0YSgnZy1jb25maWctaHJlZicpO1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdCgncG9zdCcsIHBhcnNlQWpheFVSSShocmVmICsgZ2V0QWpheFN1ZmZpeCgpKSwgeyB0aXRsZTogdGl0bGUgfSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGFibGUuZGF0YSgndGl0bGUtZWRpdGFibGUnLCBvcmlnaW5hbCkudGV4dChvcmlnaW5hbCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0aXplID0gc2VsZWN0LnNlbGVjdGl6ZUluc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc2VsZWN0LnZhbHVlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHNlbGVjdGl6ZS5PcHRpb25zW3ZhbHVlXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtzZWxlY3RpemUub3B0aW9ucy5sYWJlbEZpZWxkXSA9IHRpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aXplLnVwZGF0ZU9wdGlvbih2YWx1ZSwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGl6ZWQuc3R5bGUoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZS5zdHlsZSgnZGlzcGxheScsICdub25lJylcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGZpeCBXb3JkcHJlc3Mgbm9uIHVuaXF1ZSBJRHMgYnkgcmVmcmVzaGluZyBhbGwgaHJlZnNcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFdvcmRwcmVzc0xpbmtzKHRpdGxlLCB2YWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZmEtc3Bpbi1mYXN0IGZhLXNwaW5uZXInKS5hZGRDbGFzcygnZmEtcGVuY2lsJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVkaXRhYmxlLnN0eWxlKHtcbiAgICAgICAgICAgIHdpZHRoOiBzZWxlY3RpemVkLmNvbXB1dGUoJ3dpZHRoJyksXG4gICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJ1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZWN0aXplZC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgfSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAga2V5cyAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2tleXMnKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vdWknKS5tb2RhbCxcbiAgICB0b2FzdHIgICAgICAgID0gcmVxdWlyZSgnLi4vdWknKS50b2FzdHIsXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpLFxuICAgIHBhcnNlQWpheFVSSSAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuXG4gICAgZmxhZ3MgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2ZsYWdzLXN0YXRlJyk7XG5cbnJlcXVpcmUoJy4vZHJvcGRvd24tZWRpdCcpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIC8vIEhhbmRsZXMgQ3JlYXRpbmcgbmV3IENvbmZpZ3VyYXRpb25zXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtb3V0bGluZS1jcmVhdGVdLCBbZGF0YS1nNS1vdXRsaW5lLWR1cGxpY2F0ZV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBvdmVybGF5Q2xpY2tUb0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGVsZW1lbnQuaHJlZigpICsgZ2V0QWpheFN1ZmZpeCgpKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5lbmFibGVDbG9zZUJ5T3ZlcmxheSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnW25hbWU9XCJ0aXRsZVwiXScpLFxuICAgICAgICAgICAgICAgICAgICBjb25maXJtID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ1tkYXRhLWctb3V0bGluZS1jcmVhdGUtY29uZmlybV0nKTtcblxuICAgICAgICAgICAgICAgIHRpdGxlLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZXZlbnQud2hpY2g7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybS5lbWl0KCdjbGljaycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25maXJtLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25maXJtLmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybS5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIFVSSSAgPSBwYXJzZUFqYXhVUkkoY29uZmlybS5kYXRhKCdnLW91dGxpbmUtY3JlYXRlLWNvbmZpcm0nKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ1tuYW1lPVwiZnJvbVwiXTpjaGVja2VkJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVzZXQgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ1tuYW1lPVwicHJlc2V0XCJdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ1tuYW1lPVwib3V0bGluZVwiXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5oZXJpdCA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCdbbmFtZT1cImluaGVyaXRcIl0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLnZhbHVlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogZnJvbSA/IGZyb20udmFsdWUoKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc2V0OiBwcmVzZXQgPyBwcmVzZXQudmFsdWUoKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0bGluZTogb3V0bGluZSA/IG91dGxpbmUudmFsdWUoKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5oZXJpdDogaW5oZXJpdC5jaGVja2VkKCkgPyAxIDogMFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBbJ3RpdGxlJywgJ2Zyb20nLCAncHJlc2V0JywgJ291dGxpbmUnXS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhW2tleV0pIHsgZGVsZXRlIGRhdGFba2V5XTsgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KCdwb3N0JywgVVJJLCBkYXRhLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm0uaGlkZUluZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXNlICAgID0gJCgnI2NvbmZpZ3VyYXRpb25zJykuZmluZCgndWwnKS5maW5kKCdsaScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lID0gemVuKCdsaScpLmF0dHJpYnV0ZSgnY2xhc3MnLCBiYXNlLmF0dHJpYnV0ZSgnY2xhc3MnKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lLmFmdGVyKGJhc2UpLmh0bWwocmVzcG9uc2UuYm9keS5vdXRsaW5lKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCAnQWN0aW9uIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuJywgcmVzcG9uc2UuYm9keS50aXRsZSB8fCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2hFZGl0YWJsZXMob3V0bGluZS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gSGFuZGxlcyBQcmVzZXQgLyBPdXRsaW5lIHN3aXRjaGVyIGluIE91dGxpbmUgY3JlYXRpb25cbiAgICBib2R5LmRlbGVnYXRlKCdjaGFuZ2UnLCAnaW5wdXRbdHlwZT1cInJhZGlvXCJdI2Zyb20tcHJlc2V0LCBpbnB1dFt0eXBlPVwicmFkaW9cIl0jZnJvbS1vdXRsaW5lJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB2YWx1ZSAgICA9IGVsZW1lbnQudmFsdWUoKSxcbiAgICAgICAgICAgIGVsZW1lbnRzID0gZWxlbWVudC5wYXJlbnQoJy5jYXJkJykuc2VhcmNoKCcuZy1jcmVhdGUtZnJvbScpO1xuXG4gICAgICAgIHZhciBmaWx0ZXJlZCA9IGVsZW1lbnRzLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKS5maWx0ZXIoZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgICAgIGJsb2NrID0gJChibG9jayk7XG4gICAgICAgICAgICByZXR1cm4gYmxvY2suaGFzQ2xhc3MoJ2ctY3JlYXRlLWZyb20tJyArIHZhbHVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGZpbHRlcmVkKSB7XG4gICAgICAgICAgICAkKGZpbHRlcmVkKS5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGVzIENvbmZpZ3VyYXRpb25zIER1cGxpY2F0ZSAvIFJlbW92ZVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJyNjb25maWd1cmF0aW9ucyBbZGF0YS1nLWNvbmZpZ10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgbW9kZSAgICAgICAgPSBlbGVtZW50LmRhdGEoJ2ctY29uZmlnJyksXG4gICAgICAgICAgICBocmVmICAgICAgICA9IGVsZW1lbnQuZGF0YSgnZy1jb25maWctaHJlZicpLFxuICAgICAgICAgICAgaHJlZkNvbmZpcm0gPSBlbGVtZW50LmRhdGEoJ2ctY29uZmlnLWhyZWYtY29uZmlybScpLFxuICAgICAgICAgICAgZW5jb2RlICAgICAgPSB3aW5kb3cuYnRvYShocmVmKSwvLy5zdWJzdHIoLTIwLCAyMCksIC8vIGluIGNhc2UgdGhlIHN0cmluZ3MgZ2V0cyB0b28gbG9uZ1xuICAgICAgICAgICAgbWV0aG9kICAgICAgPSAoZWxlbWVudC5kYXRhKCdnLWNvbmZpZy1tZXRob2QnKSB8fCAncG9zdCcpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBpZiAobW9kZSA9PSAnZGVsZXRlJyAmJiAhZmxhZ3MuZ2V0KCdmcmVlOnRvOmRlbGV0ZTonICsgZW5jb2RlLCBmYWxzZSkpIHtcbiAgICAgICAgICAgIC8vIGNvbmZpcm0gYmVmb3JlIHByb2NlZWRpbmdcbiAgICAgICAgICAgIGZsYWdzLndhcm5pbmcoe1xuICAgICAgICAgICAgICAgIHVybDogcGFyc2VBamF4VVJJKGhyZWYgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybSA9IGNvbnRlbnQuZmluZCgnW2RhdGEtZy1kZWxldGUtY29uZmlybV0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCAgPSBjb250ZW50LmZpbmQoJ1tkYXRhLWctZGVsZXRlLWNhbmNlbF0nKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0pIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uZmlybS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLmdldCgnZnJlZTp0bzpkZWxldGU6JyArIGVuY29kZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFtjb25maXJtLCBjYW5jZWxdKS5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6IGVsZW1lbnQgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoW2NvbmZpcm0sIGNhbmNlbF0pLmF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLmdldCgnZnJlZTp0bzpkZWxldGU6JyArIGVuY29kZSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgIGVsZW1lbnQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgIHJlcXVlc3QobWV0aG9kLCBwYXJzZUFqYXhVUkkoKGhyZWZDb25maXJtIHx8IGhyZWYpICsgZ2V0QWpheFN1ZmZpeCgpKSwge30sIGZ1bmN0aW9uKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZlNlbGVjdG9yICAgPSAkKCcjY29uZmlndXJhdGlvbi1zZWxlY3RvcicpLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50T3V0bGluZSA9IGNvbmZTZWxlY3Rvci52YWx1ZSgpLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lRGVsZXRlZCA9IHJlc3BvbnNlLmJvZHkub3V0bGluZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkICAgICAgICAgPSAkKCdbaHJlZj1cIicgKyBnZXRBamF4VVJMKCdjb25maWd1cmF0aW9ucycpICsgJ1wiXScpO1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIGN1cnJlbnQgb3V0bGluZSBpcyB0aGUgb25lIHRoYXQncyBiZWVuIGRlbGV0ZWQsXG4gICAgICAgICAgICAgICAgLy8gZmFsbGJhY2sgdG8gZGVmYXVsdFxuICAgICAgICAgICAgICAgIGlmIChvdXRsaW5lRGVsZXRlZCAmJiBjdXJyZW50T3V0bGluZSA9PSBvdXRsaW5lRGVsZXRlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWRzID0ga2V5cyhjb25mU2VsZWN0b3Iuc2VsZWN0aXplSW5zdGFuY2UuT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWxvYWQuaHJlZihyZWxvYWQuaHJlZigpLnJlcGxhY2UoJ3N0eWxlPScgKyBvdXRsaW5lRGVsZXRlZCwgJ3N0eWxlPScgKyBpZHMuc2hpZnQoKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFyZWxvYWQpIHsgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uOyB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogcmVsb2FkIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCAnQWN0aW9uIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuJywgcmVzcG9uc2UuYm9keS50aXRsZSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgaWYgKG91dGxpbmVEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkub3V0bGluZURlbGV0ZWQgPSBvdXRsaW5lRGVsZXRlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG4gICAgLy8gSGFuZGxlcyBDb25maWd1cmF0aW9ucyBUaXRsZXMgUmVuYW1lXG4gICAgdmFyIHVwZGF0ZVRpdGxlICAgICA9IGZ1bmN0aW9uKHRpdGxlLCBvcmlnaW5hbCwgd2FzQ2FuY2VsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUoJ3RleHQtb3ZlcmZsb3cnLCAnZWxsaXBzaXMnKTtcbiAgICAgICAgICAgIGlmICh3YXNDYW5jZWxlZCB8fCB0aXRsZSA9PSBvcmlnaW5hbCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBocmVmICAgID0gZWxlbWVudC5kYXRhKCdnLWNvbmZpZy1ocmVmJyksXG4gICAgICAgICAgICAgICAgbWV0aG9kICA9IChlbGVtZW50LmRhdGEoJ2ctY29uZmlnLW1ldGhvZCcpIHx8ICdwb3N0JykudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXJlbnQgID0gZWxlbWVudC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgcGFyZW50LnNob3dJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgIHBhcmVudC5maW5kKCdbZGF0YS10aXRsZS1lZGl0XScpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXG4gICAgICAgICAgICByZXF1ZXN0KG1ldGhvZCwgcGFyc2VBamF4VVJJKGhyZWYgKyBnZXRBamF4U3VmZml4KCkpLCB7IHRpdGxlOiB0cmltKHRpdGxlKSB9LCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZScsIG9yaWdpbmFsKS50ZXh0KG9yaWdpbmFsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoJ3RpdGxlJywgdGl0bGUpLmRhdGEoJ3RpcCcsIHRpdGxlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWZyZXNoIElEIGxhYmVsIGFuZCBhY3Rpb25zIGJ1dHRvbnNcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR1bW15ICAgPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5vdXRsaW5lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgPSBkdW1teS5maW5kKCdoNCBzcGFuOmxhc3QtY2hpbGQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnMgPSBkdW1teS5maW5kKCcub3V0bGluZS1hY3Rpb25zJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnQoJy5jYXJkJykuZmluZCgnaDQgc3BhbjpsYXN0LWNoaWxkJykuaHRtbChpZC5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudCgnLmNhcmQnKS5maW5kKCcub3V0bGluZS1hY3Rpb25zJykuaHRtbChhY3Rpb25zLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcGFyZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICBwYXJlbnQuZmluZCgnW2RhdGEtdGl0bGUtZWRpdF0nKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGF0dGFjaEVkaXRhYmxlcyA9IGZ1bmN0aW9uKGVkaXRhYmxlcykge1xuICAgICAgICAgICAgaWYgKCFlZGl0YWJsZXMgfHwgIWVkaXRhYmxlcy5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBlZGl0YWJsZXMuZm9yRWFjaChmdW5jdGlvbihlZGl0YWJsZSkge1xuICAgICAgICAgICAgICAgIGVkaXRhYmxlID0gJChlZGl0YWJsZSk7XG4gICAgICAgICAgICAgICAgZWRpdGFibGUuY29uZldhc0F0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBlZGl0YWJsZS5vbigndGl0bGUtZWRpdC1zdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZS5zdHlsZSgndGV4dC1vdmVyZmxvdycsICdpbmhlcml0Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWRpdGFibGUub24oJ3RpdGxlLWVkaXQtZW5kJywgdXBkYXRlVGl0bGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICBib2R5Lm9uKCdzdGF0ZWNoYW5nZUFmdGVyJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGVkaXRhYmxlcyA9ICQoJyNjb25maWd1cmF0aW9ucyBbZGF0YS10aXRsZS1lZGl0YWJsZV0nKTtcbiAgICAgICAgaWYgKCFlZGl0YWJsZXMpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICBlZGl0YWJsZXMgPSBlZGl0YWJsZXMuZmlsdGVyKGZ1bmN0aW9uKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiAkKGVkaXRhYmxlKS5jb25mV2FzQXR0YWNoZWQpID09PSAndW5kZWZpbmVkJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXR0YWNoRWRpdGFibGVzKGVkaXRhYmxlcyk7XG4gICAgfSk7XG5cbiAgICBhdHRhY2hFZGl0YWJsZXMoJCgnI2NvbmZpZ3VyYXRpb25zIFtkYXRhLXRpdGxlLWVkaXRhYmxlXScpKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHt9O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcmVhZHkgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2F0dHJpYnV0ZXMnKSxcbiAgICBzdG9yYWdlICAgICAgID0gcmVxdWlyZSgncHJpbWUvbWFwJyksXG4gICAgZGVlcEVxdWFscyAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwRXF1YWxzJyksXG4gICAgaXMgICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pcycpLFxuICAgIGlzU3RyaW5nICAgICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNTdHJpbmcnKSxcbiAgICBoYXNPd24gICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvaGFzJyksXG4gICAgZm9yRWFjaCAgICAgICA9IHJlcXVpcmUoJ21vdXQvY29sbGVjdGlvbi9mb3JFYWNoJyksXG4gICAgaW52b2tlICAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW52b2tlJyksXG4gICAgSGlzdG9yeSAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2hpc3RvcnknKSxcbiAgICBmbGFncyAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZmxhZ3Mtc3RhdGUnKSxcbiAgICBzdWJtaXQgICAgICAgID0gcmVxdWlyZSgnLi9zdWJtaXQnKTtcblxucmVxdWlyZSgnLi9tdWx0aWNoZWNrYm94Jyk7XG5cbnZhciBvcmlnaW5hbHMsXG4gICAgY29sbGVjdEZpZWxkc1ZhbHVlcyA9IGZ1bmN0aW9uKGtleXMpIHtcbiAgICAgICAgdmFyIG1hcCAgICAgID0gbmV3IHN0b3JhZ2UoKSxcbiAgICAgICAgICAgIGRlZmF1bHRzID0gJCgnW2RhdGEtZy1zdHlsZXMtZGVmYXVsdHNdJyksXG4gICAgICAgICAgICBvdmVycmlkYWJsZXMgPSAkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0uc2V0dGluZ3MtcGFyYW0tdG9nZ2xlJyk7XG5cbiAgICAgICAgZGVmYXVsdHMgPSBkZWZhdWx0cyA/IEpTT04ucGFyc2UoZGVmYXVsdHMuZGF0YSgnZy1zdHlsZXMtZGVmYXVsdHMnKSkgOiB7fTtcblxuICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIG92ZXJyaWRlcyBnZXR0aW5nIGVuYWJsZWQgLyBkaXNhYmxlZFxuICAgICAgICAvLyBpbiBvcmRlciB0byBkZXRlY3QgaWYgaGFzIGNoYW5nZWRcbiAgICAgICAgaWYgKG92ZXJyaWRhYmxlcykge1xuICAgICAgICAgICAgdmFyIG92ZXJyaWRlcyA9IHt9O1xuXG4gICAgICAgICAgICBvdmVycmlkYWJsZXMuZm9yRWFjaChmdW5jdGlvbihvdmVycmlkZSkge1xuICAgICAgICAgICAgICAgIG92ZXJyaWRlID0gJChvdmVycmlkZSk7XG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVzW292ZXJyaWRlLmlkKCldID0gb3ZlcnJpZGUuY2hlY2tlZCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1hcC5zZXQoJ19fanNfX292ZXJyaWRlcycsIEpTT04uc3RyaW5naWZ5KG92ZXJyaWRlcykpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleXMpIHtcbiAgICAgICAgICAgIHZhciBmaWVsZDtcbiAgICAgICAgICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgICAgICBmaWVsZCA9ICQoJ1tuYW1lPVwiJyArIGtleSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFwLnNldChrZXksIGZpZWxkLnZhbHVlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbWFwO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZpZWxkcyA9ICQoJy5zZXR0aW5ncy1ibG9jayBbbmFtZV0nKTtcbiAgICAgICAgaWYgKCFmaWVsZHMpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24oZmllbGQpIHtcbiAgICAgICAgICAgIGZpZWxkID0gJChmaWVsZCk7XG4gICAgICAgICAgICB2YXIga2V5ICAgICA9IGZpZWxkLmF0dHJpYnV0ZSgnbmFtZScpLFxuICAgICAgICAgICAgICAgIGlzSW5wdXQgPSAhaGFzT3duKGRlZmF1bHRzLCBrZXkpO1xuXG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSgpID09ICdjaGVja2JveCcgJiYgIWZpZWxkLnZhbHVlKCkubGVuZ3RoKSB7IGZpZWxkLnZhbHVlKCcwJyk7IH1cbiAgICAgICAgICAgIG1hcC5zZXQoa2V5LCBpc0lucHV0ID8gZmllbGQudmFsdWUoKSA6IGRlZmF1bHRzW2tleV0pO1xuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICByZXR1cm4gbWFwO1xuICAgIH0sXG4gICAgY3JlYXRlTWFwRnJvbSAgICAgICA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIG1hcCA9IG5ldyBzdG9yYWdlKCk7XG5cbiAgICAgICAgZm9yRWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbWFwO1xuICAgIH07XG5cbnZhciBjb21wYXJlID0ge1xuICAgIHNpbmdsZTogZnVuY3Rpb24oKSB7fSxcbiAgICB3aG9sZTogZnVuY3Rpb24oKSB7fSxcbiAgICBibGFua3M6IGZ1bmN0aW9uKCkge30sXG4gICAgcHJlc2V0czogZnVuY3Rpb24oKSB7fVxufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5JyksIHByZXNldHNDYWNoZTtcblxuICAgIG9yaWdpbmFscyA9IGNvbGxlY3RGaWVsZHNWYWx1ZXMoKTtcblxuICAgIGNvbXBhcmUuc2luZ2xlID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHBhcmVudCAgICAgID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpIHx8IGVsZW1lbnQucGFyZW50KCdoNCcpIHx8IGVsZW1lbnQucGFyZW50KCcuaW5wdXQtZ3JvdXAnKSxcbiAgICAgICAgICAgIHRhcmdldCAgICAgID0gcGFyZW50ID8gKHBhcmVudC5tYXRjaGVzKCdoNCcpID8gcGFyZW50IDogcGFyZW50LmZpbmQoJy5zZXR0aW5ncy1wYXJhbS10aXRsZSwgLmctaW5zdGFuY2VwaWNrZXItdGl0bGUnKSkgOiBudWxsLFxuICAgICAgICAgICAgaXNPdmVycmlkZSAgPSBwYXJlbnQgPyBwYXJlbnQuZmluZCgnLnNldHRpbmdzLXBhcmFtLXRvZ2dsZScpIDogZmFsc2UsXG4gICAgICAgICAgICBpc05ld1dpZGdldCA9IGZhbHNlLFxuICAgICAgICAgICAgaXNPdmVycmlkZVRvZ2dsZSA9IGVsZW1lbnQuaGFzQ2xhc3MoJ3NldHRpbmdzLXBhcmFtLXRvZ2dsZScpO1xuXG4gICAgICAgIGlmICghcGFyZW50KSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmIChpc092ZXJyaWRlVG9nZ2xlKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcGFyZS53aG9sZSgnZm9yY2UnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbGVtZW50LnR5cGUoKSA9PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICBlbGVtZW50LnZhbHVlKE51bWJlcihlbGVtZW50LmNoZWNrZWQoKSkudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3JpZ2luYWxzICYmIG9yaWdpbmFscy5nZXQoZWxlbWVudC5hdHRyaWJ1dGUoJ25hbWUnKSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgb3JpZ2luYWxzLnNldChlbGVtZW50LmF0dHJpYnV0ZSgnbmFtZScpLCBlbGVtZW50LnZhbHVlKCkpO1xuICAgICAgICAgICAgaXNOZXdXaWRnZXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0YXJnZXQgfHwgIW9yaWdpbmFscyB8fCBvcmlnaW5hbHMuZ2V0KGVsZW1lbnQuYXR0cmlidXRlKCduYW1lJykpID09IG51bGwpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmIChvcmlnaW5hbHMuZ2V0KGVsZW1lbnQuYXR0cmlidXRlKCduYW1lJykpICE9PSBlbGVtZW50LnZhbHVlKCkgfHwgaXNOZXdXaWRnZXQpIHtcbiAgICAgICAgICAgIGlmIChpc092ZXJyaWRlICYmIGV2ZW50LmZvcmNlT3ZlcnJpZGUgJiYgIWlzT3ZlcnJpZGUuY2hlY2tlZCgpKSB7IGlzT3ZlcnJpZGVbMF0uY2xpY2soKTsgfVxuICAgICAgICAgICAgdGFyZ2V0LnNob3dJbmRpY2F0b3IoJ2NoYW5nZXMtaW5kaWNhdG9yIGZvbnQtc21hbGwgZmEgZmEtY2lyY2xlLW8gZmEtZncnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpc092ZXJyaWRlICYmIGV2ZW50LmZvcmNlT3ZlcnJpZGUgJiYgaXNPdmVycmlkZS5jaGVja2VkKCkpIHsgaXNPdmVycmlkZVswXS5jbGljaygpOyB9XG4gICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcGFyZS5ibGFua3MoZXZlbnQsIHBhcmVudC5maW5kKCcuc2V0dGluZ3MtcGFyYW0tZmllbGQnKSk7XG4gICAgICAgIGNvbXBhcmUud2hvbGUoJ2ZvcmNlJyk7XG4gICAgICAgIGNvbXBhcmUucHJlc2V0cygpO1xuICAgIH07XG5cbiAgICBjb21wYXJlLndob2xlID0gZnVuY3Rpb24oZm9yY2UpIHtcbiAgICAgICAgaWYgKCFvcmlnaW5hbHMpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciBlcXVhbHMgPSBkZWVwRXF1YWxzKG9yaWdpbmFscywgY29sbGVjdEZpZWxkc1ZhbHVlcyhmb3JjZSA/IG9yaWdpbmFscy5rZXlzKCkgOiBudWxsKSwgZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgIGlmIChpc1N0cmluZyhhKSAmJiBpc1N0cmluZyhiKSAmJiBhLnN1YnN0cigwLCAxKSA9PSAnIycgJiYgYi5zdWJzdHIoMCwgMSkgPT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnRvTG93ZXJDYXNlKCkgPT0gYi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpcyhhLCBiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHNhdmUgICA9ICQoJ1tkYXRhLXNhdmVdJyk7XG5cbiAgICAgICAgaWYgKCFzYXZlKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGZsYWdzLnNldCgncGVuZGluZycsICFlcXVhbHMpO1xuICAgICAgICBzYXZlW2VxdWFscyA/ICdoaWRlSW5kaWNhdG9yJyA6ICdzaG93SW5kaWNhdG9yJ10oJ2NoYW5nZXMtaW5kaWNhdG9yIGZhIGZhLWNpcmNsZS1vIGZhLWZ3Jyk7XG4gICAgfTtcblxuICAgIGNvbXBhcmUuYmxhbmtzID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFlbGVtZW50KSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgZmllbGQgPSBlbGVtZW50LmZpbmQoJ1tuYW1lXScpLFxuICAgICAgICAgICAgcmVzZXQgPSBlbGVtZW50LmZpbmQoJy5nLXJlc2V0LWZpZWxkJyk7XG4gICAgICAgIGlmICghZmllbGQgfHwgIXJlc2V0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdmFyIHZhbHVlID0gZmllbGQudmFsdWUoKTtcbiAgICAgICAgaWYgKCF2YWx1ZSB8fCBmaWVsZC5kaXNhYmxlZCgpKSB7IHJlc2V0LnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsgfVxuICAgICAgICBlbHNlIHsgcmVzZXQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOyB9XG4gICAgfTtcblxuICAgIGNvbXBhcmUucHJlc2V0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcHJlc2V0cyA9ICQoJ1tkYXRhLWctc3R5bGVzXScpLCBzdG9yZTtcbiAgICAgICAgaWYgKCFwcmVzZXRzKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICghcHJlc2V0c0NhY2hlKSB7XG4gICAgICAgICAgICBwcmVzZXRzQ2FjaGUgPSBuZXcgc3RvcmFnZSgpO1xuICAgICAgICAgICAgZm9yRWFjaChwcmVzZXRzLCBmdW5jdGlvbihwcmVzZXQsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcHJlc2V0ID0gJChwcmVzZXQpO1xuICAgICAgICAgICAgICAgIHN0b3JlID0ge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIG1hcDogY3JlYXRlTWFwRnJvbShKU09OLnBhcnNlKHByZXNldC5kYXRhKCdnLXN0eWxlcycpKSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHByZXNldHNDYWNoZS5zZXQocHJlc2V0LCBzdG9yZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmaWVsZHMsIGVxdWFscztcbiAgICAgICAgcHJlc2V0c0NhY2hlLmZvckVhY2goZnVuY3Rpb24oZGF0YSwgZWxlbWVudCkge1xuICAgICAgICAgICAgZmllbGRzID0gY29sbGVjdEZpZWxkc1ZhbHVlcyhkYXRhLm1hcC5rZXlzKCkpO1xuXG4gICAgICAgICAgICAvLyBEbyBub3QgY29uc2lkZXIgX19qc19fb3ZlcnJpZGVzIHdoZW4gY29tcGFyaW5nIGZvciBlcXVhbGl0eVxuICAgICAgICAgICAgZmllbGRzLnVuc2V0KCdfX2pzX19vdmVycmlkZXMnKTtcblxuICAgICAgICAgICAgZXF1YWxzID0gZGVlcEVxdWFscyhmaWVsZHMsIGRhdGEubWFwLCBmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhID09IGI7IH0pO1xuICAgICAgICAgICAgJCgkKCdbZGF0YS1nLXN0eWxlc10nKVtkYXRhLmluZGV4XSkucGFyZW50KClbZXF1YWxzID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKCdnLXByZXNldC1tYXRjaCcpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnaW5wdXQnLCAnLnNldHRpbmdzLWJsb2NrIGlucHV0W25hbWVdW3R5cGU9XCJ0ZXh0XCJdLCAuc2V0dGluZ3MtYmxvY2sgdGV4dGFyZWFbbmFtZV0nLCBjb21wYXJlLnNpbmdsZSk7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2hhbmdlJywgJy5zZXR0aW5ncy1ibG9jayBpbnB1dFtuYW1lXVt0eXBlPVwiaGlkZGVuXCJdLCAuc2V0dGluZ3MtYmxvY2sgaW5wdXRbbmFtZV1bdHlwZT1cImNoZWNrYm94XCJdLCAuc2V0dGluZ3MtYmxvY2sgc2VsZWN0W25hbWVdLCAuc2V0dGluZ3MtYmxvY2sgLnNlbGVjdGl6ZWRbbmFtZV0sIC5zZXR0aW5ncy1ibG9jayBpbnB1dFtpZF1bdHlwZT1cImNoZWNrYm94XCJdLnNldHRpbmdzLXBhcmFtLXRvZ2dsZScsIGNvbXBhcmUuc2luZ2xlKTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2lucHV0JywgJy5nLXVybHRlbXBsYXRlJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHByZXZpb3VzID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpLnNpYmxpbmdzKCk7XG4gICAgICAgIGlmICghcHJldmlvdXMpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgcHJldmlvdXMgPSBwcmV2aW91cy5maW5kKCdbZGF0YS1nLXVybHRlbXBsYXRlXScpO1xuXG4gICAgICAgIGlmIChwcmV2aW91cykge1xuICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gcHJldmlvdXMuZGF0YSgnZy11cmx0ZW1wbGF0ZScpO1xuICAgICAgICAgICAgcHJldmlvdXMuYXR0cmlidXRlKCdocmVmJywgdGVtcGxhdGUucmVwbGFjZSgvI0lEIy9nLCBlbGVtZW50LnZhbHVlKCkpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZmllbGRzIHJlc2V0c1xuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlZW50ZXInLCAnLnNldHRpbmdzLXBhcmFtLWZpZWxkJywgY29tcGFyZS5ibGFua3MsIHRydWUpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJy5nLXJlc2V0LWZpZWxkJywgZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbS1maWVsZCcpLCBmaWVsZDtcbiAgICAgICAgaWYgKCFwYXJlbnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgZmllbGQgPSBwYXJlbnQuZmluZCgnW25hbWVdJyk7XG4gICAgICAgIGlmIChmaWVsZCAmJiAhZmllbGQuZGlzYWJsZWQoKSkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdGl6ZSA9IGZpZWxkLnNlbGVjdGl6ZUluc3RhbmNlO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGl6ZSkgeyBzZWxlY3RpemUuc2V0VmFsdWUoJycpOyB9XG4gICAgICAgICAgICBlbHNlIHsgZmllbGQudmFsdWUoJycpOyB9XG5cbiAgICAgICAgICAgIGZpZWxkLmVtaXQoJ2NoYW5nZScpO1xuICAgICAgICAgICAgYm9keS5lbWl0KCdpbnB1dCcsIHsgdGFyZ2V0OiBmaWVsZCB9KTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgna2V5dXAnLCB7IHRhcmdldDogZmllbGQgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGJvZHkub24oJ3N0YXRlY2hhbmdlRW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTtcbiAgICAgICAgYm9keS5lbWl0KCd1cGRhdGVPcmlnaW5hbEZpZWxkcycpO1xuICAgIH0pO1xuXG4gICAgYm9keS5vbigndXBkYXRlT3JpZ2luYWxGaWVsZHMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgb3JpZ2luYWxzID0gY29sbGVjdEZpZWxkc1ZhbHVlcygpO1xuICAgICAgICBjb21wYXJlLnByZXNldHMoKTtcbiAgICB9KTtcblxuICAgIC8vIGZvcmNlIGEgcHJlc2V0cyBjb21wYXJpc29uIGNoZWNrXG4gICAgY29tcGFyZS5wcmVzZXRzKCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgY29tcGFyZTogY29tcGFyZSxcbiAgICBjb2xsZWN0OiBjb2xsZWN0RmllbGRzVmFsdWVzLFxuICAgIHN1Ym1pdDogc3VibWl0XG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9hdHRyaWJ1dGVzJyksXG4gICAgcmVhZHkgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHJlbW92ZSAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9yZW1vdmUnKSxcbiAgICBpbnNlcnQgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5zZXJ0JyksXG4gICAgY29udGFpbnMgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbnRhaW5zJyk7XG5cblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjaGFuZ2UnLCAnLmlucHV0LW11bHRpY2hlY2tib3ggLmlucHV0LWdyb3VwIGlucHV0W25hbWVdW3R5cGU9XCJoaWRkZW5cIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgbmFtZSA9IGVsZW1lbnQuYXR0cmlidXRlKCduYW1lJyksXG4gICAgICAgICAgICB2YWx1ZXMgPSBlbGVtZW50LnZhbHVlKCkuc3BsaXQoJywnKSxcbiAgICAgICAgICAgIGZpZWxkcyA9ICQoJ1tkYXRhLW11bHRpY2hlY2tib3gtZmllbGQ9XCInICsgbmFtZSArJ1wiXScpO1xuXG4gICAgICAgIGlmIChmaWVsZHMpIHtcbiAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgZmllbGQgPSAkKGZpZWxkKTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQuY2hlY2tlZCgpKSB7IGluc2VydCh2YWx1ZXMsIGZpZWxkLnZhbHVlKCkpOyB9XG4gICAgICAgICAgICAgICAgaWYgKCFmaWVsZC5jaGVja2VkKCkpIHsgcmVtb3ZlKHZhbHVlcywgZmllbGQudmFsdWUoKSk7IH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC52YWx1ZSh2YWx1ZXMuZmlsdGVyKFN0cmluZykuam9pbignLCcpKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICcuaW5wdXQtbXVsdGljaGVja2JveCAuaW5wdXQtZ3JvdXAgaW5wdXRbZGF0YS1tdWx0aWNoZWNrYm94LWZpZWxkXVt0eXBlPVwiY2hlY2tib3hcIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgZmllbGQgICAgID0gJCgnW25hbWU9XCInICsgZWxlbWVudC5kYXRhKCdtdWx0aWNoZWNrYm94LWZpZWxkJykgKyAnXCJdJyksXG4gICAgICAgICAgICB2YWx1ZSAgICAgPSBlbGVtZW50LnZhbHVlKCksXG4gICAgICAgICAgICB2YWx1ZXMgICAgPSBmaWVsZC52YWx1ZSgpLnNwbGl0KCcsJyksXG4gICAgICAgICAgICBpc0NoZWNrZWQgPSBlbGVtZW50LmNoZWNrZWQoKTtcblxuICAgICAgICBpZiAoaXNDaGVja2VkKSB7IGluc2VydCh2YWx1ZXMsIHZhbHVlKTsgfVxuICAgICAgICBpZiAoIWlzQ2hlY2tlZCkgeyByZW1vdmUodmFsdWVzLCB2YWx1ZSk7IH1cblxuICAgICAgICBmaWVsZC52YWx1ZSh2YWx1ZXMuZmlsdGVyKFN0cmluZykuam9pbignLCcpKTtcblxuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHt0YXJnZXQ6IGZpZWxkfSk7XG4gICAgfSk7XG59KTtcblxuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgaXNBcnJheSAgICAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0FycmF5JyksXG4gICAgY29udGFpbnMgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgIHZhbGlkYXRlRmllbGQgPSByZXF1aXJlKCcuLi91dGlscy9maWVsZC12YWxpZGF0aW9uJyk7XG5cbnZhciBzdWJtaXQgPSBmdW5jdGlvbihlbGVtZW50cywgY29udGFpbmVyLCBvcHRpb25zKSB7XG4gICAgdmFyIHZhbGlkICAgPSBbXSxcbiAgICAgICAgaW52YWxpZCA9IFtdO1xuXG4gICAgZWxlbWVudHMgPSAkKGVsZW1lbnRzKTtcbiAgICBjb250YWluZXIgPSAkKGNvbnRhaW5lcik7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAkKGVsZW1lbnRzKS5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgIHZhciBuYW1lID0gaW5wdXQuYXR0cmlidXRlKCduYW1lJyksXG4gICAgICAgICAgICB0eXBlID0gaW5wdXQuYXR0cmlidXRlKCd0eXBlJyk7XG4gICAgICAgIGlmICghbmFtZSB8fCBpbnB1dC5kaXNhYmxlZCgpIHx8ICh0eXBlID09ICdyYWRpbycgJiYgIWlucHV0LmNoZWNrZWQoKSkpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgaW5wdXQgPSBjb250YWluZXIuZmluZCgnW25hbWU9XCInICsgbmFtZSArICdcIl0nICsgKHR5cGUgPT0gJ3JhZGlvJyA/ICc6Y2hlY2tlZCcgOiAnJykpO1xuXG4gICAgICAgIC8vIHdvcmthcm91bmQgZm9yIGNoZWNrYm94ZXMgdHJpY2sgdGhhdCBoYXMgYm90aCBhIGhpZGRlbiBhbmQgY2hlY2tib3ggZmllbGRcbiAgICAgICAgaWYgKHR5cGUgPT09ICdjaGVja2JveCcgJiYgY29udGFpbmVyLmZpbmQoJ1t0eXBlPVwiaGlkZGVuXCJdW25hbWU9XCInICsgbmFtZSArICdcIl0nKSkge1xuICAgICAgICAgICAgaW5wdXQgPSBjb250YWluZXIuZmluZCgnW25hbWU9XCInICsgbmFtZSArICdcIl1bdHlwZT1cImNoZWNrYm94XCJdJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSAgICA9IGlucHV0LnR5cGUoKSA9PSAnY2hlY2tib3gnID8gTnVtYmVyKGlucHV0LmNoZWNrZWQoKSkgOiBpbnB1dC52YWx1ZSgpLFxuICAgICAgICAgICAgICAgIHBhcmVudCAgID0gaW5wdXQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgICAgICBvdmVycmlkZSA9IHBhcmVudCA/IHBhcmVudC5maW5kKCc+IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXScpIDogbnVsbDtcblxuICAgICAgICAgICAgb3ZlcnJpZGUgPSBvdmVycmlkZSB8fCAkKGlucHV0LmRhdGEoJ292ZXJyaWRlLXRhcmdldCcpKTtcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5zKFsnc2VsZWN0JywgJ3NlbGVjdC1tdWx0aXBsZSddLCBpbnB1dC50eXBlKCkpICYmIGlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gKGlucHV0LnNlYXJjaCgnb3B0aW9uW3NlbGVjdGVkXScpIHx8IFtdKS5tYXAoZnVuY3Rpb24oc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHNlbGVjdGlvbikudmFsdWUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG92ZXJyaWRlICYmICFvdmVycmlkZS5jaGVja2VkKCkpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRlRmllbGQoaW5wdXQpKSB7IGludmFsaWQucHVzaChpbnB1dCk7IH1cblxuICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbihzZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWQucHVzaChuYW1lICsgJ1tdPScgKyBlbmNvZGVVUklDb21wb25lbnQoc2VsZWN0aW9uKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5zdWJtaXRVbmNoZWNrZWQgfHwgKGlucHV0LnR5cGUoKSAhPSAnY2hlY2tib3gnIHx8IChpbnB1dC50eXBlKCkgPT0gJ2NoZWNrYm94JyAmJiAhIXZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWQucHVzaChuYW1lICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgdGl0bGVzID0gY29udGFpbmVyLnNlYXJjaCgnaDQgW2RhdGEtdGl0bGUtZWRpdGFibGVdJyksIGtleTtcbiAgICBpZiAodGl0bGVzKSB7XG4gICAgICAgIHRpdGxlcy5mb3JFYWNoKGZ1bmN0aW9uKHRpdGxlKSB7XG4gICAgICAgICAgICB0aXRsZSA9ICQodGl0bGUpO1xuICAgICAgICAgICAgaWYgKHRpdGxlLnBhcmVudCgnW2RhdGEtY29sbGVjdGlvbi10ZW1wbGF0ZV0nKSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAga2V5ID0gdGl0bGUuZGF0YSgnY29sbGVjdGlvbi1rZXknKSB8fCAob3B0aW9ucy5pc1Jvb3QgPyAnc2V0dGluZ3NbdGl0bGVdJyA6ICd0aXRsZScpO1xuICAgICAgICAgICAgdmFsaWQucHVzaChrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodHJpbSh0aXRsZS5kYXRhKCd0aXRsZS1lZGl0YWJsZScpKSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4geyB2YWxpZDogdmFsaWQsIGludmFsaWQ6IGludmFsaWQgfTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gc3VibWl0OyIsIlwidXNlIHN0cmljdFwiO1xuLy8gZGVwcmVjYXRlZCAoNS4yLjApXG52YXIgcHJpbWUgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgQmFzZSAgICAgICA9IHJlcXVpcmUoJy4vYmFzZScpLFxuICAgIHplbiAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBnZXRBamF4VVJMID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuY29uZmlnO1xuXG52YXIgQXRvbSA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEJhc2UsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnYXRvbSdcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgQmFzZS5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMub24oJ2NoYW5nZWQnLCB0aGlzLmhhc0NoYW5nZWQpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVUaXRsZTogZnVuY3Rpb24odGl0bGUpIHtcbiAgICAgICAgdGhpcy5ibG9jay5maW5kKCcudGl0bGUnKS50ZXh0KHRpdGxlKTtcbiAgICAgICAgdGhpcy5zZXRUaXRsZSh0aXRsZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBsYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2V0dGluZ3NfdXJpID0gZ2V0QWpheFVSTCh0aGlzLmdldFBhZ2VJZCgpICsgJy9sYXlvdXQvJyArIHRoaXMuZ2V0VHlwZSgpICsgJy8nICsgdGhpcy5nZXRJZCgpKSxcbiAgICAgICAgICAgIHN1YnR5cGUgICAgICA9IHRoaXMuZ2V0U3ViVHlwZSgpID8gJ2RhdGEtbG0tYmxvY2tzdWJ0eXBlPVwiJyArIHRoaXMuZ2V0U3ViVHlwZSgpICsgJ1wiJyA6ICcnO1xuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3R5cGU9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCIgJyArIHN1YnR5cGUgKyAnPjxzcGFuPjxzcGFuIGNsYXNzPVwidGl0bGVcIj4nICsgdGhpcy5nZXRUaXRsZSgpICsgJzwvc3Bhbj48c3BhbiBjbGFzcz1cImZvbnQtc21hbGxcIj4nICsgKHRoaXMuZ2V0U3ViVHlwZSgpIHx8IHRoaXMuZ2V0S2V5KCkgfHwgdGhpcy5nZXRUeXBlKCkpICsgJzwvc3Bhbj48L3NwYW4+PGRpdiBjbGFzcz1cImZsb2F0LXJpZ2h0XCI+PGkgYXJpYS1sYWJlbD1cIkNvbmZpZ3VyZSBBdG9tIFNldHRpbmdzXCIgY2xhc3M9XCJmYSBmYS1jb2dcIiBkYXRhLWxtLW5vZHJhZyBkYXRhLWxtLW5vZHJhZyBkYXRhLWxtLXNldHRpbmdzPVwiJyArIHNldHRpbmdzX3VyaSArICdcIj48L2k+PC9kaXY+PC9kaXY+JztcbiAgICB9LFxuXG4gICAgaGFzQ2hhbmdlZDogZnVuY3Rpb24oc3RhdGUsIHBhcmVudCkge1xuICAgICAgICB2YXIgaWNvbiA9IHRoaXMuYmxvY2suZmluZCgnc3BhbiA+IGkuY2hhbmdlcy1pbmRpY2F0b3I6Zmlyc3QtY2hpbGQnKTtcblxuICAgICAgICAvLyBpZiB0aGUgcGFydGljbGUgaGFzIGNoYW5nZXMgYnV0IHRoZSBwYXJlbnQgYmxvY2sgZG9lc24ndCwgd2Ugd2FudCB0byBrZWVwIHRoZSBpbmRpY2F0b3Igc2hvd2luZ1xuICAgICAgICBpZiAoaWNvbiAmJiBwYXJlbnQgJiYgIXBhcmVudC5jaGFuZ2VTdGF0ZSkgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmJsb2NrW3N0YXRlID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKCdibG9jay1oYXMtY2hhbmdlcycpO1xuXG4gICAgICAgIGlmICghc3RhdGUgJiYgaWNvbikgeyBpY29uLnJlbW92ZSgpOyB9XG4gICAgICAgIGlmIChzdGF0ZSAmJiAhaWNvbikgeyB6ZW4oJ2kuZmEuZmEtY2lyY2xlLW8uY2hhbmdlcy1pbmRpY2F0b3InKS5iZWZvcmUodGhpcy5ibG9jay5maW5kKCcuaWNvbicpKTsgfVxuICAgIH0sXG5cbiAgICBvblJlbmRlcmVkOiBmdW5jdGlvbihlbGVtZW50LCBwYXJlbnQpIHtcbiAgICAgICAgdmFyIGdsb2JhbGx5X2Rpc2FibGVkID0gJCgnW2RhdGEtbG0tZGlzYWJsZWRdW2RhdGEtbG0tc3VidHlwZT1cIicgKyB0aGlzLmdldFN1YlR5cGUoKSArICdcIl0nKTtcblxuICAgICAgICBpZiAoZ2xvYmFsbHlfZGlzYWJsZWQgfHwgdGhpcy5nZXRBdHRyaWJ1dGUoJ2VuYWJsZWQnKSA9PT0gMCkgeyB0aGlzLmRpc2FibGUoKTsgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEF0b207XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIGRlcHJlY2F0ZWQgKDUuMi4wKVxudmFyIHByaW1lICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHplbiAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBiaW5kICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgU2VjdGlvbiA9IHJlcXVpcmUoJy4vc2VjdGlvbicpO1xuXG52YXIgQXRvbXMgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBTZWN0aW9uLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ2F0b21zJyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgbmFtZTogXCJBdG9tcyBTZWN0aW9uXCJcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmRlcHJlY2F0ZWQgPSAnPGRpdiBjbGFzcz1cImF0b21zLW5vdGljZVwiPkxvb2tpbmcgZm9yIEF0b21zPyBUbyBtYWtlIGl0IGVhc2llciB3ZSBtb3ZlZCB0aGVtIGluIHRoZSA8YSBocmVmPVwiI1wiPjxpIGNsYXNzPVwiZmEgZmEtZncgZmEtbGlzdC1hbHRcIj48L2k+IFBhZ2UgU2V0dGluZ3M8L2E+LjwvZGl2Pic7XG5cbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiYXRvbXMtc2VjdGlvblwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIiBkYXRhLWxtLWlkPVwiJyArIHRoaXMuZ2V0SWQoKSArICdcIiBkYXRhLWxtLWJsb2NrdHlwZT1cIicgKyB0aGlzLmdldFR5cGUoKSArICdcIj48ZGl2IGNsYXNzPVwic2VjdGlvbi1oZWFkZXIgY2xlYXJmaXhcIj48aDQgY2xhc3M9XCJmbG9hdC1sZWZ0XCI+JyArICh0aGlzLmdldEF0dHJpYnV0ZSgnbmFtZScpKSArICc8L2g0PjwvZGl2PjwvZGl2Pic7XG4gICAgfSxcblxuICAgIGdldElkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaWQgfHwgKHRoaXMuaWQgPSB0aGlzLm9wdGlvbnMudHlwZSk7XG4gICAgfSxcblxuICAgIG9uRG9uZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgLy8gR2FudHJ5IDUuMi4wOiBSZW1vdmUgYXRvbXMgc2VjdGlvbiBpZiBlbXB0eSB0byBrZWVwIHRoZSBsYXlvdXQgY2xlYXJcbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrLnNlYXJjaCgnW2RhdGEtbG0tYmxvY2t0eXBlPVwiYXRvbVwiXScpKSB7XG4gICAgICAgICAgICB2YXIgaWRzID0gW3RoaXMuZ2V0SWQoKV0sIHNlZ21lbnRzID0gdGhpcy5ibG9jay5zZWFyY2goJ1tkYXRhLWxtLWlkXScpO1xuICAgICAgICAgICAgaWYgKHNlZ21lbnRzKSB7XG4gICAgICAgICAgICAgICAgc2VnbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlkcy5wdXNoKCQoZWxlbWVudCkuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlkcy5yZXZlcnNlKCkuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmJ1aWxkZXIucmVtb3ZlKGlkKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAgICAgdGhpcy5ibG9jay5lbXB0eSgpWzBdLm91dGVySFRNTCA9IHRoaXMuZGVwcmVjYXRlZDtcbiAgICAgICAgICAgIHRoaXMuX2F0dGFjaFJlZGlyZWN0KCk7XG5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5ibG9jay5zZWFyY2goJ1tkYXRhLWxtLWlkXScpKSB7XG4gICAgICAgICAgICB0aGlzLmdyaWQuaW5zZXJ0KHRoaXMuYmxvY2ssICdib3R0b20nKTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5idWlsZGVyLmFkZCh0aGlzLmdyaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgemVuKCdkaXYnKS5odG1sKHRoaXMuZGVwcmVjYXRlZCkuZmlyc3RDaGlsZCgpLmFmdGVyKHRoaXMuYmxvY2spO1xuXG4gICAgICAgIHRoaXMuX2F0dGFjaFJlZGlyZWN0KCk7XG4gICAgfSxcblxuICAgIF9hdHRhY2hSZWRpcmVjdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpdGVtID0gJCgnW2RhdGEtZzUtbmF2PVwicGFnZVwiXScpO1xuICAgICAgICBpZiAoIWl0ZW0pIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgJCgnLmF0b21zLW5vdGljZSBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkKCdib2R5JykuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogaXRlbSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXRvbXM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIE9wdGlvbnMgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIEJvdW5kICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBFbWl0dGVyICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgemVuICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgdHJpbSAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgICQgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgSUQgICAgICAgID0gcmVxdWlyZSgnLi4vaWQnKSxcblxuICAgIHNpemUgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L3NpemUnKSxcbiAgICBnZXQgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9nZXQnKSxcbiAgICBoYXMgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9oYXMnKSxcbiAgICBzZXQgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9zZXQnKSxcbiAgICB0cmFuc2xhdGUgPSByZXF1aXJlKCcuLi8uLi91dGlscy90cmFuc2xhdGUnKSxcbiAgICBnZXRDdXJyZW50T3V0bGluZSAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtb3V0bGluZScpLmdldEN1cnJlbnRPdXRsaW5lO1xuXG5yZXF1aXJlKCdlbGVtZW50cy90cmF2ZXJzYWwnKTtcblxudmFyIEJhc2UgPSBuZXcgcHJpbWUoe1xuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgc3VidHlwZTogZmFsc2UsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHt9LFxuICAgICAgICBpbmhlcml0OiB7fVxuICAgIH0sXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuZnJlc2ggPSAhdGhpcy5vcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmlkID0gdGhpcy5vcHRpb25zLmlkIHx8IElEKHRoaXMub3B0aW9ucyk7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVzIHx8IHt9O1xuICAgICAgICB0aGlzLmluaGVyaXQgPSB0aGlzLm9wdGlvbnMuaW5oZXJpdCB8fCB7fTtcblxuICAgICAgICB0aGlzLmJsb2NrID0gemVuKCdkaXYnKS5odG1sKHRoaXMubGF5b3V0KCkpLmZpcnN0Q2hpbGQoKTtcblxuICAgICAgICB0aGlzLm9uKCdyZW5kZXJlZCcsIHRoaXMuYm91bmQoJ29uUmVuZGVyZWQnKSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGd1aWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZ3VpZCgpO1xuICAgIH0sXG5cbiAgICBnZXRJZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkIHx8ICh0aGlzLmlkID0gSUQodGhpcy5vcHRpb25zKSk7XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnR5cGUgfHwgJyc7XG4gICAgfSxcblxuICAgIGdldFN1YlR5cGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN1YnR5cGUgfHwgJyc7XG4gICAgfSxcblxuICAgIGdldFRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRyaW0odGhpcy5vcHRpb25zLnRpdGxlIHx8ICdVbnRpdGxlZCcpO1xuICAgIH0sXG5cbiAgICBzZXRUaXRsZTogZnVuY3Rpb24odGl0bGUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnRpdGxlID0gdHJpbSh0aXRsZSB8fCAnVW50aXRsZWQnKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGdldEtleTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9LFxuXG4gICAgZ2V0UGFnZUlkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJvb3QgPSAkKCdbZGF0YS1sbS1yb290XScpO1xuICAgICAgICBpZiAoIXJvb3QpIHJldHVybiAnZGF0YS1yb290LW5vdC1mb3VuZCc7XG5cbiAgICAgICAgcmV0dXJuIHJvb3QuZGF0YSgnbG0tcGFnZScpO1xuICAgIH0sXG5cbiAgICBnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICByZXR1cm4gZ2V0KHRoaXMuYXR0cmlidXRlcywga2V5KTtcbiAgICB9LFxuXG4gICAgZ2V0QXR0cmlidXRlczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXMgfHwge307XG4gICAgfSxcblxuICAgIGdldEluaGVyaXRhbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5oZXJpdCB8fCB7fTtcbiAgICB9LFxuXG4gICAgdXBkYXRlVGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QXR0cmlidXRlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHNldCh0aGlzLmF0dHJpYnV0ZXMsIGtleSwgdmFsdWUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QXR0cmlidXRlczogZnVuY3Rpb24oYXR0cmlidXRlcykge1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXRJbmhlcml0YW5jZTogZnVuY3Rpb24oaW5oZXJpdGFuY2UpIHtcbiAgICAgICAgdGhpcy5pbmhlcml0ID0gaW5oZXJpdGFuY2U7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGhhc0F0dHJpYnV0ZTogZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHJldHVybiBoYXModGhpcy5hdHRyaWJ1dGVzLCBrZXkpO1xuICAgIH0sXG5cbiAgICBlbmFibGVJbmhlcml0YW5jZTogZnVuY3Rpb24oKSB7fSxcblxuICAgIGRpc2FibGVJbmhlcml0YW5jZTogZnVuY3Rpb24oKSB7fSxcblxuICAgIHJlZnJlc2hJbmhlcml0YW5jZTogZnVuY3Rpb24oKSB7fSxcblxuICAgIGhhc0luaGVyaXRhbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHNpemUodGhpcy5pbmhlcml0KSAmJiB0aGlzLmluaGVyaXQub3V0bGluZSAhPSBnZXRDdXJyZW50T3V0bGluZSgpO1xuICAgIH0sXG5cbiAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5ibG9jay50aXRsZSh0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fRElTQUJMRURfUEFSVElDTEUnLCAncGFydGljbGUnKSk7XG4gICAgICAgIHRoaXMuYmxvY2suYWRkQ2xhc3MoJ3BhcnRpY2xlLWRpc2FibGVkJyk7XG4gICAgfSxcblxuICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYmxvY2sucmVtb3ZlQXR0cmlidXRlKCd0aXRsZScpO1xuICAgICAgICB0aGlzLmJsb2NrLnJlbW92ZUNsYXNzKCdwYXJ0aWNsZS1kaXNhYmxlZCcpO1xuICAgIH0sXG5cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uKHRhcmdldCwgbG9jYXRpb24pIHtcbiAgICAgICAgdGhpcy5ibG9ja1tsb2NhdGlvbiB8fCAnYWZ0ZXInXSh0YXJnZXQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYWRvcHQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5pbnNlcnQodGhpcy5ibG9jayk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBpc05ldzogZnVuY3Rpb24oZnJlc2gpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBmcmVzaCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZnJlc2ggPSAhIWZyZXNoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmZyZXNoO1xuICAgIH0sXG5cbiAgICBkcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAnZGF0YS1sbS1kcm9wem9uZSc7XG4gICAgfSxcblxuICAgIGFkZERyb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5ibG9jay5kYXRhKCdsbS1kcm9wem9uZScsIHRydWUpO1xuICAgIH0sXG5cbiAgICByZW1vdmVEcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYmxvY2suZGF0YSgnbG0tZHJvcHpvbmUnLCBudWxsKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHt9LFxuXG4gICAgb25SZW5kZXJlZDogZnVuY3Rpb24oKSB7fSxcblxuICAgIHNldExheW91dDogZnVuY3Rpb24obGF5b3V0KSB7XG4gICAgICAgIHRoaXMuYmxvY2sgPSBsYXlvdXQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBnZXRMaW1pdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgQmFzZSAgICAgID0gcmVxdWlyZSgnLi9iYXNlJyksXG4gICAgJCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBwcmVjaXNpb24gPSByZXF1aXJlKCdtb3V0L251bWJlci9lbmZvcmNlUHJlY2lzaW9uJyksXG4gICAgYmluZCAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyk7XG5cbnZhciBCbG9jayA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEJhc2UsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnYmxvY2snLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBzaXplOiAxMDBcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBCYXNlLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMgJiYgb3B0aW9ucy5hdHRyaWJ1dGVzLnNpemUpIHRoaXMuc2V0QXR0cmlidXRlKCdzaXplJywgcHJlY2lzaW9uKG9wdGlvbnMuYXR0cmlidXRlcy5zaXplLCAxKSk7XG5cbiAgICAgICAgdGhpcy5vbignY2hhbmdlZCcsIHRoaXMuaGFzQ2hhbmdlZCk7XG4gICAgfSxcblxuICAgIGdldFNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJlY2lzaW9uKHRoaXMuZ2V0QXR0cmlidXRlKCdzaXplJyksIDEpO1xuICAgIH0sXG5cbiAgICBzZXRTaXplOiBmdW5jdGlvbihzaXplLCBzdG9yZSkge1xuICAgICAgICBzaXplID0gdHlwZW9mIHNpemUgPT09ICd1bmRlZmluZWQnID8gdGhpcy5nZXRTaXplKCkgOiBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHBhcnNlRmxvYXQoc2l6ZSkpKTtcbiAgICAgICAgc2l6ZSA9IHByZWNpc2lvbihzaXplLCAxKTtcbiAgICAgICAgaWYgKHN0b3JlKSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgnc2l6ZScsIHNpemUpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCh0aGlzLmJsb2NrKS5zdHlsZSh7XG4gICAgICAgICAgICBmbGV4OiAnMCAxICcgKyBzaXplICsgJyUnLFxuICAgICAgICAgICAgJy13ZWJraXQtZmxleCc6ICcwIDEgJyArIHNpemUgKyAnJScsXG4gICAgICAgICAgICAnLW1zLWZsZXgnOiAnMCAxICcgKyBzaXplICsgJyUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZW1pdCgncmVzaXplZCcsIHNpemUsIHRoaXMpO1xuICAgIH0sXG5cbiAgICBzZXRBbmltYXRlZFNpemU6IGZ1bmN0aW9uKHNpemUsIHN0b3JlKSB7XG4gICAgICAgIHNpemUgPSB0eXBlb2Ygc2l6ZSA9PT0gJ3VuZGVmaW5lZCcgPyB0aGlzLmdldFNpemUoKSA6IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgcGFyc2VGbG9hdChzaXplKSkpO1xuICAgICAgICBzaXplID0gcHJlY2lzaW9uKHNpemUsIDEpO1xuICAgICAgICBpZiAoc3RvcmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdzaXplJywgc2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgJCh0aGlzLmJsb2NrKS5hbmltYXRlKHtcbiAgICAgICAgICAgIGZsZXg6ICcwIDEgJyArIHNpemUgKyAnJScsXG4gICAgICAgICAgICAnLXdlYmtpdC1mbGV4JzogJzAgMSAnICsgc2l6ZSArICclJyxcbiAgICAgICAgICAgICctbXMtZmxleCc6ICcwIDEgJyArIHNpemUgKyAnJSdcbiAgICAgICAgfSwgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICAgICAgdGhpcy5zZXRTaXplKHNpemUpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5lbWl0KCdyZXNpemVkJywgc2l6ZSwgdGhpcyk7XG4gICAgfSxcblxuICAgIHNldExhYmVsU2l6ZTogZnVuY3Rpb24oc2l6ZSkge1xuICAgICAgICB2YXIgbGFiZWwgPSB0aGlzLmJsb2NrLmZpbmQoJz4gLnBhcnRpY2xlLXNpemUnKTtcbiAgICAgICAgaWYgKCFsYWJlbCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICBsYWJlbC50ZXh0KHByZWNpc2lvbihzaXplLCAxKSArICclJyk7XG4gICAgfSxcblxuICAgIGxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImctYmxvY2tcIiBkYXRhLWxtLWlkPVwiJyArIHRoaXMuZ2V0SWQoKSArICdcIicgKyB0aGlzLmRyb3B6b25lKCkgKyAnIGRhdGEtbG0tYmxvY2t0eXBlPVwiYmxvY2tcIj48L2Rpdj4nO1xuICAgIH0sXG5cbiAgICBvblJlbmRlcmVkOiBmdW5jdGlvbihlbGVtZW50LCBwYXJlbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuYmxvY2suZmluZCgnPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJzZWN0aW9uXCJdJykpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRHJvcHpvbmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcGFyZW50KSB7IHJldHVybjsgfVxuXG4gICAgICAgIHZhciBncmFuZHBhID0gcGFyZW50LmJsb2NrLnBhcmVudCgpO1xuICAgICAgICBpZiAoZ3JhbmRwYS5kYXRhKCdsbS1yb290JykgfHwgKGdyYW5kcGEuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT0gJ2NvbnRhaW5lcicgJiYgKGdyYW5kcGEucGFyZW50KCkuZGF0YSgnbG0tcm9vdCcpIHx8IGdyYW5kcGEucGFyZW50KCkuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT0gJ3dyYXBwZXInKSkpIHtcbiAgICAgICAgICAgIHplbignc3Bhbi5wYXJ0aWNsZS1zaXplJykudGV4dCh0aGlzLmdldFNpemUoKSArICclJykudG9wKGVsZW1lbnQuYmxvY2spO1xuICAgICAgICAgICAgZWxlbWVudC5vbigncmVzaXplZCcsIHRoaXMuYm91bmQoJ29uUmVzaXplJykpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUmVzaXplOiBmdW5jdGlvbihyZXNpemUpIHtcbiAgICAgICAgdGhpcy5zZXRMYWJlbFNpemUocmVzaXplKTtcbiAgICB9LFxuXG4gICAgaGFzQ2hhbmdlZDogZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgICAgdmFyIGljb24sXG4gICAgICAgICAgICBjaGlsZCA9IHRoaXMuYmxvY2suZmluZCgnPiBbZGF0YS1sbS1pZF06bm90KFtkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0pOm5vdChbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0pJyk7XG5cbiAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSA9IHN0YXRlO1xuXG4gICAgICAgIGlmICghY2hpbGQpIHtcbiAgICAgICAgICAgIGNoaWxkID0gdGhpcy5ibG9jay5maW5kKCc+IC5wYXJ0aWNsZS1zaXplJykgfHwgdGhpcy5ibG9jay5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cImJsb2NrXCJdJykuZmluZCgnPiAucGFydGljbGUtc2l6ZScpO1xuICAgICAgICAgICAgaWNvbiA9IGNoaWxkLmZpbmQoJ2k6Zmlyc3QtY2hpbGQnKTtcblxuICAgICAgICAgICAgaWYgKCFzdGF0ZSAmJiBpY29uKSB7IGljb24ucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiAhaWNvbikgeyB6ZW4oJ2kuZmEuZmEtY2lyY2xlLW8uY2hhbmdlcy1pbmRpY2F0b3InKS50b3AoY2hpbGQpOyB9XG5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtYXBwZWQgPSB0aGlzLm9wdGlvbnMuYnVpbGRlci5nZXQoY2hpbGQuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgIGlmIChtYXBwZWQpIHsgbWFwcGVkLmVtaXQoJ2NoYW5nZWQnLCBzdGF0ZSwgdGhpcyk7IH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCbG9jaztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEJhc2UgICAgICAgPSByZXF1aXJlKCcuL2Jhc2UnKSxcbiAgICB6ZW4gICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgZ2V0QWpheFVSTCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZyxcbiAgICB0cmFuc2xhdGUgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnZhciBDb250YWluZXIgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBCYXNlLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ2NvbnRhaW5lcidcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgQmFzZS5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9uKCdjaGFuZ2VkJywgdGhpcy5oYXNDaGFuZ2VkKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiZy1sbS1jb250YWluZXJcIiBkYXRhLWxtLWlkPVwiJyArIHRoaXMuZ2V0SWQoKSArICdcIiBkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiPjwvZGl2Pic7XG4gICAgfSxcblxuICAgIG9uUmVuZGVyZWQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHBhcmVudCkge1xuICAgICAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICAgICAgdGhpcy5hZGRTZXR0aW5ncyhlbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihzdGF0ZSwgY2hpbGQpIHtcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLmJsb2NrLmZpbmQoJ3NwYW4udGl0bGUgPiBpOmZpcnN0LWNoaWxkJyk7XG5cbiAgICAgICAgLy8gaWYgdGhlIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQgZnJvbSBhIGdyaWQgd2UgbmVlZCB0byBiZSBjYXV0aW91cyBub3QgdG8gb3ZlcnJpZGUgdGhlIHByb3BlciBzdGF0ZVxuICAgICAgICBpZiAoaWNvbiAmJiBjaGlsZCAmJiAhY2hpbGQuY2hhbmdlU3RhdGUpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5ibG9ja1tzdGF0ZSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnYmxvY2staGFzLWNoYW5nZXMnKTtcblxuICAgICAgICBpZiAoIXN0YXRlICYmIGljb24pIHsgaWNvbi5yZW1vdmUoKTsgfVxuICAgICAgICBpZiAoc3RhdGUgJiYgIWljb24pIHtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IHRoaXMuYmxvY2suZmluZCgnc3Bhbi50aXRsZScpO1xuICAgICAgICAgICAgaWYgKHRpdGxlKSB7IHplbignaS5mYS5mYS1jaXJjbGUtby5jaGFuZ2VzLWluZGljYXRvcicpLnRvcCh0aXRsZSk7IH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRTZXR0aW5nczogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgIHZhciBzZXR0aW5nc191cmkgPSBnZXRBamF4VVJMKHRoaXMuZ2V0UGFnZUlkKCkgKyAnL2xheW91dC8nICsgdGhpcy5nZXRUeXBlKCkgKyAnLycgKyB0aGlzLmdldElkKCkpLFxuICAgICAgICAgICAgd3JhcHBlciAgICAgID0gemVuKCdkaXYuY29udGFpbmVyLXdyYXBwZXIuY2xlYXJmaXgnKS50b3AoY29udGFpbmVyLmJsb2NrKSxcbiAgICAgICAgICAgIHRpdGxlICAgICAgICA9IHplbignZGl2LmNvbnRhaW5lci10aXRsZScpLmJvdHRvbSh3cmFwcGVyKSxcbiAgICAgICAgICAgIGFjdGlvbnMgICAgICA9IHplbignZGl2LmNvbnRhaW5lci1hY3Rpb25zJykuYm90dG9tKHdyYXBwZXIpO1xuXG4gICAgICAgIHRpdGxlLmh0bWwoJzxzcGFuIGNsYXNzPVwidGl0bGVcIj4nICsgdGhpcy5nZXRUeXBlKCkgKyAnPC9zcGFuPicpO1xuICAgICAgICBhY3Rpb25zLmh0bWwoJzxzcGFuIGRhdGEtdGlwPVwiJyArIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19MTV9TRVRUSU5HUycsICdDb250YWluZXInKSArICdcIiBkYXRhLXRpcC1wbGFjZT1cInRvcC1sZWZ0XCI+PGkgYXJpYS1sYWJlbD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQ09ORklHVVJFX1NFVFRJTkdTJywgJ0NvbnRhaW5lcicpICsgJ1wiIGNsYXNzPVwiZmEgZmEtY29nXCIgZGF0YS1sbS1zZXR0aW5ncz1cIicgKyBzZXR0aW5nc191cmkgKyAnXCI+PC9pPjwvc3Bhbj4nKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBDb250YWluZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBCYXNlICAgICAgID0gcmVxdWlyZSgnLi9iYXNlJyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgZ2V0QWpheFVSTCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZztcblxudmFyIEdyaWQgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBCYXNlLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ2dyaWQnXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIEJhc2UuY2FsbCh0aGlzLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLm9uKCdjaGFuZ2VkJywgdGhpcy5oYXNDaGFuZ2VkKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiZy1ncmlkIG5vd3JhcFwiIGRhdGEtbG0taWQ9XCInICsgdGhpcy5nZXRJZCgpICsgJ1wiICcgKyB0aGlzLmRyb3B6b25lKCkgKyAnICBkYXRhLWxtLXNhbWV3aWR0aCBkYXRhLWxtLWJsb2NrdHlwZT1cImdyaWRcIj48L2Rpdj4nO1xuICAgIH0sXG5cbiAgICBvblJlbmRlcmVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuYmxvY2sucGFyZW50KCk7XG4gICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LmRhdGEoJ2xtLWJsb2NrdHlwZScpID09ICdhdG9tcycpIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2sucmVtb3ZlQ2xhc3MoJ25vd3JhcCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQuZGF0YSgnbG0tcm9vdCcpIHx8IChwYXJlbnQuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT0gJ2NvbnRhaW5lcicgJiYgcGFyZW50LnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSkpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRHJvcHpvbmUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgICAvLyBHcmlkcyBkb24ndCBoYXZlIHJvb20gZm9yIGFuIGluZGljYXRvciBzbyB3ZSBmb3J3YXJkIGl0IHRvIHRoZSBwYXJlbnQgU2VjdGlvblxuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5ibG9jay5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0nKSxcbiAgICAgICAgICAgIGlkID0gcGFyZW50ID8gcGFyZW50LmRhdGEoJ2xtLWlkJykgOiBmYWxzZTtcblxuICAgICAgICB0aGlzLmNoYW5nZVN0YXRlID0gc3RhdGU7XG5cbiAgICAgICAgaWYgKCFwYXJlbnQgfHwgIWlkKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYnVpbGRlcikgeyB0aGlzLm9wdGlvbnMuYnVpbGRlci5nZXQoaWQpLmVtaXQoJ2NoYW5nZWQnLCBzdGF0ZSwgdGhpcyk7IH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHcmlkO1xuIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgYmFzZTogcmVxdWlyZSgnLi9iYXNlJyksXG4gICAgYXRvbTogcmVxdWlyZSgnLi9hdG9tJyksXG4gICAgc2VjdGlvbjogcmVxdWlyZSgnLi9zZWN0aW9uJyksXG4gICAgb2ZmY2FudmFzOiByZXF1aXJlKCcuL29mZmNhbnZhcycpLFxuICAgIHdyYXBwZXI6IHJlcXVpcmUoJy4vd3JhcHBlcicpLFxuICAgIGF0b21zOiByZXF1aXJlKCcuL2F0b21zJyksXG4gICAgZ3JpZDogcmVxdWlyZSgnLi9ncmlkJyksXG4gICAgY29udGFpbmVyOiByZXF1aXJlKCcuL2NvbnRhaW5lcicpLFxuICAgIGJsb2NrOiByZXF1aXJlKCcuL2Jsb2NrJyksXG4gICAgcGFydGljbGU6IHJlcXVpcmUoJy4vcGFydGljbGUnKSxcbiAgICBwb3NpdGlvbjogcmVxdWlyZSgnLi9wb3NpdGlvbicpLFxuICAgIHN5c3RlbTogcmVxdWlyZSgnLi9zeXN0ZW0nKSxcbiAgICBzcGFjZXI6IHJlcXVpcmUoJy4vc3BhY2VyJylcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgICAgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIFNlY3Rpb24gICAgICAgICAgICA9IHJlcXVpcmUoJy4vc2VjdGlvbicpLFxuXG4gICAgZ2V0QWpheFVSTCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuY29uZmlnLFxuICAgIGdldE91dGxpbmVOYW1lQnlJZCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1vdXRsaW5lJykuZ2V0T3V0bGluZU5hbWVCeUlkLFxuICAgIHRyYW5zbGF0ZSAgICAgICAgICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3RyYW5zbGF0ZScpO1xuXG52YXIgT2ZmY2FudmFzID0gbmV3IHByaW1lKHtcbiAgICBpbmhlcml0czogU2VjdGlvbixcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdvZmZjYW52YXMnLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBuYW1lOiBcIk9mZmNhbnZhcyBTZWN0aW9uXCJcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2V0dGluZ3NfdXJpID0gZ2V0QWpheFVSTCh0aGlzLmdldFBhZ2VJZCgpICsgJy9sYXlvdXQvJyArIHRoaXMuZ2V0VHlwZSgpICsgJy8nICsgdGhpcy5nZXRJZCgpKSxcbiAgICAgICAgICAgIGluaGVyaXRhbmNlICA9ICcnLFxuICAgICAgICAgICAga2xhc3MgICAgICAgID0gJyc7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzSW5oZXJpdGFuY2UoKSkge1xuICAgICAgICAgICAgdmFyIG91dGxpbmUgPSBnZXRPdXRsaW5lTmFtZUJ5SWQodGhpcy5pbmhlcml0Lm91dGxpbmUpO1xuICAgICAgICAgICAgaW5oZXJpdGFuY2UgPSAnPGRpdiBjbGFzcz1cImctaW5oZXJpdCBnLXNlY3Rpb24taW5oZXJpdFwiPjxkaXYgY2xhc3M9XCJnLWluaGVyaXQtY29udGVudFwiPicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSU5IRVJJVElOR19GUk9NX1gnLCAnPHN0cm9uZz4nICsgb3V0bGluZSArICc8L3N0cm9uZz4nKSArICc8L2Rpdj48L2Rpdj4nO1xuICAgICAgICAgICAga2xhc3MgPSAnIGctaW5oZXJpdGluZyBnLWluaGVyaXRpbmctJyArIHRoaXMuaW5oZXJpdC5pbmNsdWRlLmpvaW4oJyBnLWluaGVyaXRpbmctJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJvZmZjYW52YXMtc2VjdGlvbicgKyBrbGFzcyArICdcIiBkYXRhLWxtLWlkPVwiJyArIHRoaXMuZ2V0SWQoKSArICdcIiBkYXRhLWxtLWJsb2NrdHlwZT1cIicgKyB0aGlzLmdldFR5cGUoKSArICdcIj48ZGl2IGNsYXNzPVwic2VjdGlvbi1oZWFkZXIgY2xlYXJmaXhcIj48aDQgY2xhc3M9XCJmbG9hdC1sZWZ0XCIgdGl0bGU9XCInICsgdGhpcy5nZXRBdHRyaWJ1dGUoJ25hbWUnKSArICdcIj4nICsgdGhpcy5nZXRBdHRyaWJ1dGUoJ25hbWUnKSArICc8L2g0PjxkaXYgY2xhc3M9XCJzZWN0aW9uLWFjdGlvbnMgZmxvYXQtcmlnaHRcIj48c3BhbiBkYXRhLXRpcD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQUREX1JPVycsICdPZmZjYW52YXMnKSArICdcIiBkYXRhLXRpcC1wbGFjZT1cInRvcC1yaWdodFwiPjxpIGFyaWEtbGFiZWw9XCInICsgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xNX0FERF9ST1cnLCAnT2ZmY2FudmFzJykgKyAnXCIgY2xhc3M9XCJmYSBmYS1wbHVzXCI+PC9pPjwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJzZWN0aW9uLXNldHRpbmdzXCIgZGF0YS10aXA9XCInICsgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xNX1NFVFRJTkdTJywgJ09mZmNhbnZhcycpICsgJ1wiIGRhdGEtdGlwLXBsYWNlPVwidG9wLXJpZ2h0XCI+PGkgYXJpYS1sYWJlbD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQ09ORklHVVJFX1NFVFRJTkdTJywgJ09mZmNhbnZhcycpICsgJ1wiIGNsYXNzPVwiZmEgZmEtY29nXCIgZGF0YS1sbS1zZXR0aW5ncz1cIicgKyBzZXR0aW5nc191cmkgKyAnXCI+PC9pPjwvc3Bhbj48L2Rpdj48L2Rpdj4nICsgaW5oZXJpdGFuY2UgKyAnPC9kaXY+JztcbiAgICB9LFxuXG4gICAgZ2V0SWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZCB8fCAodGhpcy5pZCA9IHRoaXMub3B0aW9ucy50eXBlKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBPZmZjYW52YXM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgICAgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgQXRvbSAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi9hdG9tJyksXG4gICAgYmluZCAgICAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgcHJlY2lzaW9uICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9udW1iZXIvZW5mb3JjZVByZWNpc2lvbicpLFxuICAgIGZvck93biAgICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2Zvck93bicpLFxuICAgIGdldEFqYXhVUkwgICAgICAgICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZyxcbiAgICBnZXRPdXRsaW5lTmFtZUJ5SWQgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtb3V0bGluZScpLmdldE91dGxpbmVOYW1lQnlJZCxcbiAgICB0cmFuc2xhdGUgICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy90cmFuc2xhdGUnKTtcblxudmFyIFVJRCA9IDA7XG5cbnZhciBQYXJ0aWNsZSA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEF0b20sXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAncGFydGljbGUnXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICsrVUlEO1xuICAgICAgICBBdG9tLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIGxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZXR0aW5nc191cmkgPSBnZXRBamF4VVJMKHRoaXMuZ2V0UGFnZUlkKCkgKyAnL2xheW91dC8nICsgdGhpcy5nZXRUeXBlKCkgKyAnLycgKyB0aGlzLmdldElkKCkpLFxuICAgICAgICAgICAgc3VidHlwZSAgICAgID0gdGhpcy5nZXRTdWJUeXBlKCkgPyAnZGF0YS1sbS1ibG9ja3N1YnR5cGU9XCInICsgdGhpcy5nZXRTdWJUeXBlKCkgKyAnXCInIDogJycsXG4gICAgICAgICAgICBrbGFzcyAgICAgICAgPSAnJztcblxuICAgICAgICBpZiAodGhpcy5oYXNJbmhlcml0YW5jZSgpKSB7XG4gICAgICAgICAgICBrbGFzcyA9ICcgZy1pbmhlcml0aW5nJztcbiAgICAgICAgICAgIGlmICh0aGlzLmluaGVyaXQuaW5jbHVkZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBrbGFzcyArPSAnIGctaW5oZXJpdGluZy0nICsgdGhpcy5pbmhlcml0LmluY2x1ZGUuam9pbignIGctaW5oZXJpdGluZy0nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cIicgKyB0aGlzLmdldFR5cGUoKSArIGtsYXNzICsgJ1wiIGRhdGEtbG0taWQ9XCInICsgdGhpcy5nZXRJZCgpICsgJ1wiIGRhdGEtbG0tYmxvY2t0eXBlPVwiJyArIHRoaXMuZ2V0VHlwZSgpICsgJ1wiICcgKyBzdWJ0eXBlICsgJz48c3Bhbj48c3BhbiBjbGFzcz1cImljb25cIiAnICsgdGhpcy5hZGRJbmhlcml0YW5jZVRpcCh0cnVlKSArICc+PGkgY2xhc3M9XCJmYSAnICsgdGhpcy5nZXRJY29uKCkgKyAnXCI+PC9pPjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpdGxlXCI+JyArIHRoaXMuZ2V0VGl0bGUoKSArICc8L3NwYW4+PHNwYW4gY2xhc3M9XCJmb250LXNtYWxsXCI+JyArICh0aGlzLmdldEtleSgpIHx8IHRoaXMuZ2V0U3ViVHlwZSgpIHx8IHRoaXMuZ2V0VHlwZSgpKSArICc8L3NwYW4+PC9zcGFuPjxkaXYgY2xhc3M9XCJmbG9hdC1yaWdodFwiPjxzcGFuIGNsYXNzPVwicGFydGljbGUtc2l6ZVwiPjwvc3Bhbj4gPGkgYXJpYS1sYWJlbD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQ09ORklHVVJFX1NFVFRJTkdTJywgJ1BhcnRpY2xlJykgKyAnXCIgY2xhc3M9XCJmYSBmYS1jb2dcIiBkYXRhLWxtLW5vZHJhZyBkYXRhLWxtLXNldHRpbmdzPVwiJyArIHNldHRpbmdzX3VyaSArICdcIj48L2k+PC9kaXY+PC9kaXY+JztcbiAgICB9LFxuXG4gICAgZW5hYmxlSW5oZXJpdGFuY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnY2xhc3MnLCB0aGlzLmNsZWFuS2xhc3ModGhpcy5ibG9jay5hdHRyaWJ1dGUoJ2NsYXNzJykpKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzSW5oZXJpdGFuY2UoKSkge1xuICAgICAgICAgICAgdmFyIG91dGxpbmUgPSBnZXRPdXRsaW5lTmFtZUJ5SWQodGhpcy5pbmhlcml0Lm91dGxpbmUpLFxuICAgICAgICAgICAgICAgIGljb24gICAgPSB0aGlzLmJsb2NrLmZpbmQoJy5pY29uJyk7XG5cbiAgICAgICAgICAgIHRoaXMuYmxvY2suYWRkQ2xhc3MoJ2ctaW5oZXJpdGluZycpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5oZXJpdC5pbmNsdWRlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2suYWRkQ2xhc3MoJ2ctaW5oZXJpdGluZy0nICsgdGhpcy5pbmhlcml0LmluY2x1ZGUuam9pbignIGctaW5oZXJpdGluZy0nKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYmxvY2suZmluZCgnLmljb24gLmZhJykuYXR0cmlidXRlKCdjbGFzcycsICdmYSAnICsgdGhpcy5nZXRJY29uKCkpO1xuXG4gICAgICAgICAgICBmb3JPd24odGhpcy5nZXRJbmhlcml0YW5jZVRpcCgpLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgaWNvbi5kYXRhKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGdsb2JhbC5HNS50aXBzLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRpc2FibGVJbmhlcml0YW5jZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpY29uICAgID0gdGhpcy5ibG9jay5maW5kKCcuaWNvbicpO1xuXG4gICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdjbGFzcycsIHRoaXMuY2xlYW5LbGFzcyh0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnY2xhc3MnKSkpO1xuICAgICAgICB0aGlzLmJsb2NrLnJlbW92ZUNsYXNzKCdnLWluaGVyaXRpbmcnKTtcbiAgICAgICAgdGhpcy5ibG9jay5maW5kKCcuaWNvbiAuZmEnKS5hdHRyaWJ1dGUoJ2NsYXNzJywgJ2ZhICcgKyB0aGlzLmdldEljb24oKSk7XG5cbiAgICAgICAgZm9yT3duKHRoaXMuZ2V0SW5oZXJpdGFuY2VUaXAoKSwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgaWNvbi5kYXRhKGtleSwgbnVsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGdsb2JhbC5HNS50aXBzLnJlbG9hZCgpO1xuICAgIH0sXG5cbiAgICByZWZyZXNoSW5oZXJpdGFuY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmJsb2NrW3RoaXMuaGFzSW5oZXJpdGFuY2UoKSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1pbmhlcml0YW5jZScpO1xuICAgICAgICBpZiAodGhpcy5oYXNJbmhlcml0YW5jZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnY2xhc3MnLCB0aGlzLmNsZWFuS2xhc3ModGhpcy5ibG9jay5hdHRyaWJ1dGUoJ2NsYXNzJykpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRJbmhlcml0YW5jZVRpcDogZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICB2YXIgdG9vbHRpcCA9IHRoaXMuZ2V0SW5oZXJpdGFuY2VUaXAoKTtcblxuICAgICAgICBpZiAoaHRtbCkge1xuICAgICAgICAgICAgdmFyIHRvb2x0aXBIVE1MID0gJyc7XG4gICAgICAgICAgICBmb3JPd24odG9vbHRpcCwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgIHRvb2x0aXBIVE1MICs9ICdkYXRhLScgKyBrZXkgKyAnPVwiJyArIHZhbHVlICsgJ1wiICc7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdG9vbHRpcCA9IHRvb2x0aXBIVE1MO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzSW5oZXJpdGFuY2UoKSA/IHRvb2x0aXAgOiAnJztcbiAgICB9LFxuXG4gICAgZ2V0SW5oZXJpdGFuY2VUaXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgb3V0bGluZSA9IGdldE91dGxpbmVOYW1lQnlJZCh0aGlzLmluaGVyaXQgPyB0aGlzLmluaGVyaXQub3V0bGluZSA6IG51bGwpLFxuICAgICAgICAgICAgcGFydGljbGUgPSB0aGlzLmluaGVyaXQucGFydGljbGUgfHwgJycsXG4gICAgICAgICAgICBpbmNsdWRlID0gKHRoaXMuaW5oZXJpdC5pbmNsdWRlIHx8IFtdKS5qb2luKCcsICcpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAndGlwJzogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0lOSEVSSVRJTkdfRlJPTV9YJywgJzxzdHJvbmc+JyArIG91dGxpbmUgKyAnPC9zdHJvbmc+JykgKyAnPGJyIC8+SUQ6ICcgKyBwYXJ0aWNsZSArICc8YnIgLz5SZXBsYWNlOiAnICsgaW5jbHVkZSxcbiAgICAgICAgICAgICd0aXAtb2Zmc2V0JzogLTEwLFxuICAgICAgICAgICAgJ3RpcC1wbGFjZSc6ICd0b3AtcmlnaHQnXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGNsZWFuS2xhc3M6IGZ1bmN0aW9uKGtsYXNzKSB7XG4gICAgICAgIGtsYXNzID0gKGtsYXNzIHx8ICcnKS5zcGxpdCgnICcpO1xuXG4gICAgICAgIHJldHVybiBrbGFzcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gIWl0ZW0ubWF0Y2goL15nLWluaGVyaXRpbmctLyk7IH0pLmpvaW4oJyAnKTtcbiAgICB9LFxuXG4gICAgc2V0TGFiZWxTaXplOiBmdW5jdGlvbihzaXplKSB7XG4gICAgICAgIHZhciBsYWJlbCA9IHRoaXMuYmxvY2suZmluZCgnLnBhcnRpY2xlLXNpemUnKTtcbiAgICAgICAgaWYgKCFsYWJlbCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICBsYWJlbC50ZXh0KHByZWNpc2lvbihzaXplLCAxKSArICclJyk7XG4gICAgfSxcblxuICAgIG9uUmVuZGVyZWQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHBhcmVudCkge1xuICAgICAgICB2YXIgc2l6ZSAgICAgICAgICAgICAgPSBwYXJlbnQuZ2V0U2l6ZSgpIHx8IDEwMCxcbiAgICAgICAgICAgIGdsb2JhbGx5X2Rpc2FibGVkID0gJCgnW2RhdGEtbG0tZGlzYWJsZWRdW2RhdGEtbG0tc3VidHlwZT1cIicgKyB0aGlzLmdldFN1YlR5cGUoKSArICdcIl0nKTtcblxuICAgICAgICBpZiAoZ2xvYmFsbHlfZGlzYWJsZWQgfHwgdGhpcy5nZXRBdHRyaWJ1dGUoJ2VuYWJsZWQnKSA9PT0gMCkgeyB0aGlzLmRpc2FibGUoKTsgfVxuXG4gICAgICAgIHRoaXMuc2V0TGFiZWxTaXplKHNpemUpO1xuICAgICAgICBwYXJlbnQub24oJ3Jlc2l6ZWQnLCB0aGlzLmJvdW5kKCdvblBhcmVudFJlc2l6ZScpKTtcbiAgICB9LFxuXG4gICAgZ2V0UGFyZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuYmxvY2sucGFyZW50KCdbZGF0YS1sbS1pZF0nKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmJ1aWxkZXIuZ2V0KHBhcmVudC5kYXRhKCdsbS1pZCcpKTtcbiAgICB9LFxuXG4gICAgb25QYXJlbnRSZXNpemU6IGZ1bmN0aW9uKHJlc2l6ZSkge1xuICAgICAgICB0aGlzLnNldExhYmVsU2l6ZShyZXNpemUpO1xuICAgIH0sXG5cbiAgICBnZXRJY29uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzSW5oZXJpdGFuY2UoKSkge1xuICAgICAgICAgICAgcmV0dXJuICdmYS1sb2NrJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB0eXBlICAgICA9IHRoaXMuZ2V0VHlwZSgpLFxuICAgICAgICAgICAgc3VidHlwZSAgPSB0aGlzLmdldFN1YlR5cGUoKSxcbiAgICAgICAgICAgIHRlbXBsYXRlID0gJCgnLnBhcnRpY2xlcy1jb250YWluZXIgW2RhdGEtbG0tYmxvY2t0eXBlPVwiJyArIHR5cGUgKyAnXCJdW2RhdGEtbG0tc3VidHlwZT1cIicgKyBzdWJ0eXBlICsgJ1wiXScpO1xuXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZSA/IHRlbXBsYXRlLmRhdGEoJ2xtLWljb24nKSA6ICdmYS1jdWJlJztcbiAgICB9LFxuXG4gICAgZ2V0TGltaXRzOiBmdW5jdGlvbihwYXJlbnQpIHtcbiAgICAgICAgaWYgKCFwYXJlbnQpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdmFyIHNpYmxpbmcgPSBwYXJlbnQuYmxvY2submV4dFNpYmxpbmcoKSB8fCBwYXJlbnQuYmxvY2sucHJldmlvdXNTaWJsaW5nKCkgfHwgZmFsc2U7XG5cbiAgICAgICAgaWYgKCFzaWJsaW5nKSB7IHJldHVybiBbMTAwLCAxMDBdOyB9XG5cbiAgICAgICAgdmFyIHNpYmxpbmdCbG9jayA9IHRoaXMub3B0aW9ucy5idWlsZGVyLmdldChzaWJsaW5nLmRhdGEoJ2xtLWlkJykpLFxuICAgICAgICAgICAgc2l6ZXMgICAgICAgID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuZ2V0UGFyZW50KCkuZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIHNpYmxpbmc6IHNpYmxpbmdCbG9jay5nZXRTaXplKClcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFs1LCAoc2l6ZXMuY3VycmVudCArIHNpemVzLnNpYmxpbmcpIC0gNV07XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFydGljbGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgdHJpbSAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAgUGFydGljbGUgPSByZXF1aXJlKCcuL3BhcnRpY2xlJyk7XG5cbnZhciBVSUQgPSAwO1xuXG52YXIgUG9zaXRpb24gPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBQYXJ0aWNsZSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdwb3NpdGlvbidcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgKytVSUQ7XG4gICAgICAgIFBhcnRpY2xlLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRoaXMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdrZXknLCB0aGlzLmdldEtleSgpKTtcblxuICAgICAgICBpZiAodGhpcy5pc05ldygpKSB7IC0tVUlEOyB9XG4gICAgfSxcblxuICAgIGdldFRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRyaW0odGhpcy5vcHRpb25zLnRpdGxlIHx8ICdQb3NpdGlvbiAnICsgVUlEKTtcbiAgICB9LFxuXG4gICAgZ2V0S2V5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdldEF0dHJpYnV0ZSgna2V5JykgfHwgdHJpbSh0aGlzLmdldFRpdGxlKCkpLnJlcGxhY2UoL1xccy9nLCAnLScpLnRvTG93ZXJDYXNlKCkpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVLZXk6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMua2V5ID0ga2V5IHx8IHRoaXMuZ2V0S2V5KCk7XG4gICAgICAgIHRoaXMuYmxvY2suZmluZCgnLmZvbnQtc21hbGwnKS50ZXh0KHRoaXMuZ2V0S2V5KCkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUG9zaXRpb247XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgICAgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEJhc2UgICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vYmFzZScpLFxuICAgIEJvdW5kICAgICAgICAgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBHcmlkICAgICAgICAgICAgICAgPSByZXF1aXJlKCcuL2dyaWQnKSxcbiAgICAkICAgICAgICAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHplbiAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuXG4gICAgYmluZCAgICAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgZm9yT3duICAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZm9yT3duJyksXG4gICAgZ2V0QWpheFVSTCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuY29uZmlnLFxuICAgIGdldE91dGxpbmVOYW1lQnlJZCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1vdXRsaW5lJykuZ2V0T3V0bGluZU5hbWVCeUlkLFxuICAgIHRyYW5zbGF0ZSAgICAgICAgICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3RyYW5zbGF0ZScpO1xuXG5yZXF1aXJlKCdlbGVtZW50cy9pbnNlcnRpb24nKTtcblxudmFyIFVJRCA9IDA7XG5cbnZhciBTZWN0aW9uID0gbmV3IHByaW1lKHtcbiAgICBpbmhlcml0czogQmFzZSxcbiAgICBvcHRpb25zOiB7fSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICsrVUlEO1xuICAgICAgICB0aGlzLmdyaWQgPSBuZXcgR3JpZCgpO1xuICAgICAgICBCYXNlLmNhbGwodGhpcywgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5vbignZG9uZScsIHRoaXMuYm91bmQoJ29uRG9uZScpKTtcbiAgICAgICAgdGhpcy5vbignY2hhbmdlZCcsIHRoaXMuaGFzQ2hhbmdlZCk7XG4gICAgfSxcblxuICAgIGxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZXR0aW5nc191cmkgICAgID0gZ2V0QWpheFVSTCh0aGlzLmdldFBhZ2VJZCgpICsgJy9sYXlvdXQvJyArIHRoaXMuZ2V0VHlwZSgpICsgJy8nICsgdGhpcy5nZXRJZCgpKSxcbiAgICAgICAgICAgIGluaGVyaXRhbmNlTGFiZWwgPSAnJyxcbiAgICAgICAgICAgIGtsYXNzICAgICAgICAgICAgPSAnJztcblxuICAgICAgICBpZiAodGhpcy5oYXNJbmhlcml0YW5jZSgpKSB7XG4gICAgICAgICAgICB2YXIgb3V0bGluZSA9IGdldE91dGxpbmVOYW1lQnlJZCh0aGlzLmluaGVyaXQub3V0bGluZSk7XG4gICAgICAgICAgICBpbmhlcml0YW5jZUxhYmVsID0gdGhpcy5yZW5kZXJJbmhlcml0YW5jZUxhYmVsKG91dGxpbmUpO1xuICAgICAgICAgICAga2xhc3MgPSAnIGctaW5oZXJpdGluZyc7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmluaGVyaXQuaW5jbHVkZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBrbGFzcyArPSAnIGctaW5oZXJpdGluZy0nICsgdGhpcy5pbmhlcml0LmluY2x1ZGUuam9pbignIGctaW5oZXJpdGluZy0nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cInNlY3Rpb24nICsga2xhc3MgKyAnXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3R5cGU9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3N1YnR5cGU9XCInICsgdGhpcy5nZXRTdWJUeXBlKCkgKyAnXCI+PGRpdiBjbGFzcz1cInNlY3Rpb24taGVhZGVyIGNsZWFyZml4XCI+PGg0IGNsYXNzPVwiZmxvYXQtbGVmdFwiIHRpdGxlPVwiJyArIHRoaXMuZ2V0VGl0bGUoKSArICdcIj4nICsgdGhpcy5nZXRUaXRsZSgpICsgJzwvaDQ+PGRpdiBjbGFzcz1cInNlY3Rpb24tYWN0aW9ucyBmbG9hdC1yaWdodFwiPjxzcGFuIGNsYXNzPVwic2VjdGlvbi1hZGRyb3dcIiBkYXRhLXRpcD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQUREX1JPVycsICdTZWN0aW9uJykgKyAnXCIgZGF0YS10aXAtcGxhY2U9XCJ0b3AtcmlnaHRcIj48aSBhcmlhLWxhYmVsPVwiJyArIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19MTV9BRERfUk9XJywgJ1NlY3Rpb24nKSArICdcIiBjbGFzcz1cImZhIGZhLXBsdXNcIj48L2k+PC9zcGFuPiA8c3BhbiBjbGFzcz1cInNlY3Rpb24tc2V0dGluZ3NcIiBkYXRhLXRpcD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fU0VUVElOR1MnLCAnU2VjdGlvbicpICsgJ1wiIGRhdGEtdGlwLXBsYWNlPVwidG9wLXJpZ2h0XCI+PGkgYXJpYS1sYWJlbD1cIicgKyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE1fQ09ORklHVVJFX1NFVFRJTkdTJywgJ1NlY3Rpb24nKSArICdcIiBjbGFzcz1cImZhIGZhLWNvZ1wiIGRhdGEtbG0tc2V0dGluZ3M9XCInICsgc2V0dGluZ3NfdXJpICsgJ1wiPjwvaT48L3NwYW4+PC9kaXY+PC9kaXY+JyArIGluaGVyaXRhbmNlTGFiZWwgKyAnPC9kaXY+JztcbiAgICB9LFxuXG4gICAgYWRvcHQ6IGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICQoY2hpbGQpLmluc2VydCh0aGlzLmJsb2NrLmZpbmQoJy5nLWdyaWQnKSk7XG4gICAgfSxcblxuICAgIHJlbmRlckluaGVyaXRhbmNlTGFiZWw6IGZ1bmN0aW9uKG91dGxpbmUpIHtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSU5IRVJJVElOR19GUk9NX1gnLCAnPHN0cm9uZz4nICsgb3V0bGluZSArICc8L3N0cm9uZz4nKTtcblxuICAgICAgICBpZiAodGhpcy5ibG9jayAmJiB0aGlzLmdldFBhcmVudCgpKSB7XG4gICAgICAgICAgICBjb250ZW50ID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJnLWluaGVyaXQgZy1zZWN0aW9uLWluaGVyaXRcIj48ZGl2IGNsYXNzPVwiZy1pbmhlcml0LWNvbnRlbnRcIiAnICsgdGhpcy5hZGRJbmhlcml0YW5jZVRpcCh0cnVlKSArICc+PGkgY2xhc3M9XCJmYSBmYS1sb2NrXCI+PC9pPiAnICsgY29udGVudCArICc8L2Rpdj48L2Rpdj4nO1xuICAgIH0sXG5cbiAgICBlbmFibGVJbmhlcml0YW5jZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0luaGVyaXRhbmNlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdjbGFzcycsIHRoaXMuY2xlYW5LbGFzcyh0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnY2xhc3MnKSkpO1xuICAgICAgICAgICAgdGhpcy5ibG9jay5hZGRDbGFzcygnZy1pbmhlcml0aW5nJyk7XG4gICAgICAgICAgICBpZiAodGhpcy5pbmhlcml0LmluY2x1ZGUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9jay5hZGRDbGFzcygnZy1pbmhlcml0aW5nLScgKyB0aGlzLmluaGVyaXQuaW5jbHVkZS5qb2luKCcgZy1pbmhlcml0aW5nLScpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmZpbmQoJz4gLmctaW5oZXJpdCcpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluaGVyaXQgPSB6ZW4oJ2RpdicpLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lID0gZ2V0T3V0bGluZU5hbWVCeUlkKHRoaXMuaW5oZXJpdC5vdXRsaW5lKSxcbiAgICAgICAgICAgICAgICAgICAgaHRtbCAgICA9IHRoaXMucmVuZGVySW5oZXJpdGFuY2VMYWJlbChvdXRsaW5lKTtcblxuICAgICAgICAgICAgICAgIGluaGVyaXQuaHRtbChodG1sKS5jaGlsZHJlbigpLmFmdGVyKHRoaXMuYmxvY2suZmluZCgnPiAuc2VjdGlvbi1oZWFkZXInKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzYWJsZUluaGVyaXRhbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYmxvY2suZmluZCgnPiAuZy1pbmhlcml0JykpIHtcbiAgICAgICAgICAgIHZhciBpbmhlcml0ID0gdGhpcy5ibG9jay5maW5kKCc+IC5nLWluaGVyaXQuZy1zZWN0aW9uLWluaGVyaXQnKTtcbiAgICAgICAgICAgIGlmIChpbmhlcml0KSB7XG4gICAgICAgICAgICAgICAgaW5oZXJpdC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdjbGFzcycsIHRoaXMuY2xlYW5LbGFzcyh0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnY2xhc3MnKSkpO1xuICAgICAgICB0aGlzLmJsb2NrLnJlbW92ZUNsYXNzKCdnLWluaGVyaXRpbmcnKTtcbiAgICB9LFxuXG4gICAgcmVmcmVzaEluaGVyaXRhbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5ibG9jay5hdHRyaWJ1dGUoJ2NsYXNzJywgdGhpcy5jbGVhbktsYXNzKHRoaXMuYmxvY2suYXR0cmlidXRlKCdjbGFzcycpKSk7XG4gICAgICAgIGlmICh0aGlzLmhhc0luaGVyaXRhbmNlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlSW5oZXJpdGFuY2UoKTtcbiAgICAgICAgICAgIHZhciBvdmVybGF5ID0gdGhpcy5ibG9jay5maW5kKCc+IC5nLWluaGVyaXQnKTtcbiAgICAgICAgICAgIGlmIChvdmVybGF5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG91dGxpbmUgPSBnZXRPdXRsaW5lTmFtZUJ5SWQodGhpcy5pbmhlcml0Lm91dGxpbmUpLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gemVuKCdkaXYnKS5odG1sKHRoaXMucmVuZGVySW5oZXJpdGFuY2VMYWJlbChvdXRsaW5lKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAob3ZlcmxheSAmJiBjb250ZW50KSB7IG92ZXJsYXkuaHRtbChjb250ZW50LmNoaWxkcmVuKCkuaHRtbCgpKTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZEluaGVyaXRhbmNlVGlwOiBmdW5jdGlvbihodG1sKSB7XG4gICAgICAgIHZhciB0b29sdGlwID0gdGhpcy5nZXRJbmhlcml0YW5jZVRpcCgpO1xuXG4gICAgICAgIGlmIChodG1sKSB7XG4gICAgICAgICAgICB2YXIgdG9vbHRpcEhUTUwgPSAnJztcbiAgICAgICAgICAgIGZvck93bih0b29sdGlwLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgdG9vbHRpcEhUTUwgKz0gJ2RhdGEtJyArIGtleSArICc9XCInICsgdmFsdWUgKyAnXCIgJztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0b29sdGlwID0gdG9vbHRpcEhUTUw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5oYXNJbmhlcml0YW5jZSgpID8gdG9vbHRpcCA6ICcnO1xuICAgIH0sXG5cbiAgICBnZXRJbmhlcml0YW5jZVRpcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBvdXRsaW5lID0gdGhpcy5pbmhlcml0ID8gdGhpcy5pbmhlcml0Lm91dGxpbmUgOiBudWxsLFxuICAgICAgICAgICAgbmFtZSAgICA9IGdldE91dGxpbmVOYW1lQnlJZChvdXRsaW5lKSxcbiAgICAgICAgICAgIGluY2x1ZGUgPSAodGhpcy5pbmhlcml0LmluY2x1ZGUgfHwgW10pLmpvaW4oJywgJyk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICd0aXAnOiB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSU5IRVJJVElOR19GUk9NX1gnLCAnPHN0cm9uZz4nICsgbmFtZSArICc8L3N0cm9uZz4nKSArICc8YnIgLz5PdXRsaW5lIElEOiAnICsgb3V0bGluZSArICc8YnIgLz5SZXBsYWNlOiAnICsgaW5jbHVkZSxcbiAgICAgICAgICAgICd0aXAtb2Zmc2V0JzogLTIsXG4gICAgICAgICAgICAndGlwLXBsYWNlJzogJ3RvcC1yaWdodCdcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgY2xlYW5LbGFzczogZnVuY3Rpb24oa2xhc3MpIHtcbiAgICAgICAga2xhc3MgPSAoa2xhc3MgfHwgJycpLnNwbGl0KCcgJyk7XG5cbiAgICAgICAgcmV0dXJuIGtsYXNzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7IHJldHVybiAhaXRlbS5tYXRjaCgvXmctaW5oZXJpdGluZy0vKTsgfSkuam9pbignICcpO1xuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihzdGF0ZSwgY2hpbGQpIHtcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLmJsb2NrLmZpbmQoJ2g0ID4gaTpmaXJzdC1jaGlsZCcpO1xuXG4gICAgICAgIC8vIGlmIHRoZSB0aGUgZXZlbnQgaXMgdHJpZ2dlcmVkIGZyb20gYSBncmlkIHdlIG5lZWQgdG8gYmUgY2F1dGlvdXMgbm90IHRvIG92ZXJyaWRlIHRoZSBwcm9wZXIgc3RhdGVcbiAgICAgICAgaWYgKGljb24gJiYgY2hpbGQgJiYgIWNoaWxkLmNoYW5nZVN0YXRlKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHRoaXMuYmxvY2tbc3RhdGUgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2Jsb2NrLWhhcy1jaGFuZ2VzJyk7XG5cbiAgICAgICAgaWYgKCFzdGF0ZSAmJiBpY29uKSB7IGljb24ucmVtb3ZlKCk7IH1cbiAgICAgICAgaWYgKHN0YXRlICYmICFpY29uKSB7IHplbignaS5mYS5mYS1jaXJjbGUtby5jaGFuZ2VzLWluZGljYXRvcicpLnRvcCh0aGlzLmJsb2NrLmZpbmQoJ2g0JykpOyB9XG4gICAgfSxcblxuICAgIG9uRG9uZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrLnNlYXJjaCgnW2RhdGEtbG0taWRdJykpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC5pbnNlcnQodGhpcy5ibG9jaywgJ2JvdHRvbScpO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmJ1aWxkZXIuYWRkKHRoaXMuZ3JpZCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGx1cyA9IHRoaXMuYmxvY2suZmluZCgnLmZhLXBsdXMnKTtcbiAgICAgICAgaWYgKHBsdXMpIHtcbiAgICAgICAgICAgIHBsdXMub24oJ2NsaWNrJywgYmluZChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ibG9jay5maW5kKCcuZy1ncmlkOmxhc3QtY2hpbGQ6ZW1wdHknKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZCA9IG5ldyBHcmlkKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkLmluc2VydCh0aGlzLmJsb2NrLmZpbmQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpID8gdGhpcy5ibG9jay5maW5kKCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0nKSA6IHRoaXMuYmxvY2ssICdib3R0b20nKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuYnVpbGRlci5hZGQodGhpcy5ncmlkKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaEluaGVyaXRhbmNlKCk7XG4gICAgfSxcblxuICAgIGdldFBhcmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmJsb2NrLnBhcmVudCgnW2RhdGEtbG0taWRdJyk7XG5cbiAgICAgICAgcmV0dXJuIHBhcmVudCA/IHRoaXMub3B0aW9ucy5idWlsZGVyLmdldChwYXJlbnQuZGF0YSgnbG0taWQnKSkgOiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXRMaW1pdHM6IGZ1bmN0aW9uKHBhcmVudCkge1xuICAgICAgICBpZiAoIXBhcmVudCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgc2libGluZyA9IHBhcmVudC5ibG9jay5uZXh0U2libGluZygpIHx8IHBhcmVudC5ibG9jay5wcmV2aW91c1NpYmxpbmcoKSB8fCBmYWxzZTtcblxuICAgICAgICBpZiAoIXNpYmxpbmcpIHsgcmV0dXJuIFsxMDAsIDEwMF07IH1cblxuICAgICAgICB2YXIgc2libGluZ0Jsb2NrID0gdGhpcy5vcHRpb25zLmJ1aWxkZXIuZ2V0KHNpYmxpbmcuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgIGlmIChzaWJsaW5nQmxvY2suZ2V0VHlwZSgpICE9PSAnYmxvY2snKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBzaXplcyA9IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuZ2V0UGFyZW50KCkuZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgc2libGluZzogc2libGluZ0Jsb2NrLmdldFNpemUoKVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBbNSwgKHNpemVzLmN1cnJlbnQgKyBzaXplcy5zaWJsaW5nKSAtIDVdO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlY3Rpb247XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgUGFydGljbGUgPSByZXF1aXJlKCcuL3BhcnRpY2xlJyk7XG5cbnZhciBVSUQgPSAwO1xuXG52YXIgU3BhY2VyID0gbmV3IHByaW1lKHtcbiAgICBpbmhlcml0czogUGFydGljbGUsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnc3BhY2VyJyxcbiAgICAgICAgdGl0bGU6ICdTcGFjZXInLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7fVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwYWNlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBQYXJ0aWNsZSA9IHJlcXVpcmUoJy4vcGFydGljbGUnKTtcblxudmFyIFN5c3RlbSA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IFBhcnRpY2xlLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ3N5c3RlbScsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHt9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gU3lzdGVtO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgU2VjdGlvbiAgICA9IHJlcXVpcmUoJy4vc2VjdGlvbicpLFxuXG4gICAgZ2V0QWpheFVSTCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZztcblxudmFyIFdyYXBwZXIgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBTZWN0aW9uLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ3dyYXBwZXInLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBuYW1lOiBcIldyYXBwZXJcIlxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZXR0aW5nc191cmkgPSBnZXRBamF4VVJMKHRoaXMuZ2V0UGFnZUlkKCkgKyAnL2xheW91dC8nICsgdGhpcy5nZXRUeXBlKCkgKyAnLycgKyB0aGlzLmdldElkKCkpO1xuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJ3cmFwcGVyLXNlY3Rpb25cIiBkYXRhLWxtLWlkPVwiJyArIHRoaXMuZ2V0SWQoKSArICdcIiBkYXRhLWxtLWJsb2NrdHlwZT1cIicgKyB0aGlzLmdldFR5cGUoKSArICdcIiBkYXRhLWxtLWJsb2Nrc3VidHlwZT1cIicgKyB0aGlzLmdldFN1YlR5cGUoKSArICdcIj48L2Rpdj4nO1xuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbigpIHt9LFxuXG4gICAgZ2V0U2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgZ2V0SWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZCB8fCAodGhpcy5pZCA9IHRoaXMub3B0aW9ucy50eXBlKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBXcmFwcGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgJCAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgRW1pdHRlciA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKTtcblxudmFyIEJsb2NrcyA9IHJlcXVpcmUoJy4vYmxvY2tzLycpO1xuXG52YXIgZm9yT3duICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2Zvck93bicpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vZm9yRWFjaCcpLFxuICAgIHNpemUgICAgICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vc2l6ZScpLFxuICAgIGlzQXJyYXkgICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNBcnJheScpLFxuICAgIGZsYXR0ZW4gICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2ZsYXR0ZW4nKSxcbiAgICBJRCAgICAgICAgID0gcmVxdWlyZSgnLi9pZCcpLFxuXG4gICAgc2V0ICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L3NldCcpLFxuICAgIHVuc2V0ICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC91bnNldCcpLFxuICAgIGdldCAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9nZXQnKSxcbiAgICBkZWVwRmlsbEluID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZGVlcEZpbGxJbicpLFxuICAgIG9taXQgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9vbWl0Jyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2F0dHJpYnV0ZXMnKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL3RyYXZlcnNhbCcpO1xuXG5cbi8vIHN0YXJ0IERlYnVnXG52YXIgREVCVUcgID0gZmFsc2UsXG4gICAgcnBhZCAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvcnBhZCcpLFxuICAgIHJlcGVhdCA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3JlcGVhdCcpO1xuLy8gZW5kICAgRGVidWdcblxuJC5pbXBsZW1lbnQoe1xuICAgIGVtcHR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3Q7XG4gICAgICAgICAgICB3aGlsZSAoKGZpcnN0ID0gbm9kZS5maXJzdENoaWxkKSkge1xuICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQoZmlyc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxudmFyIEJ1aWxkZXIgPSBuZXcgcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oc3RydWN0dXJlKSB7XG4gICAgICAgIGlmIChzdHJ1Y3R1cmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RydWN0dXJlKHN0cnVjdHVyZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tYXAgPSB7fTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0U3RydWN0dXJlOiBmdW5jdGlvbihzdHJ1Y3R1cmUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuc3RydWN0dXJlID0gKHR5cGVvZiBzdHJ1Y3R1cmUgPT09ICdvYmplY3QnKSA/IHN0cnVjdHVyZSA6IEpTT04ucGFyc2Uoc3RydWN0dXJlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlBhcnNpbmcgZXJyb3I6XCIsIGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZDogZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgdmFyIGlkID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHNldCh0aGlzLm1hcCwgaWQsIGJsb2NrKTtcbiAgICAgICAgYmxvY2suaXNOZXcoZmFsc2UpO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICAgIGJsb2NrID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHVuc2V0KHRoaXMubWFwLCBibG9jayk7XG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgdmFyIGlkID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHJldHVybiBnZXQodGhpcy5tYXAsIGlkLCBibG9jayk7XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdGhpcy5yZWN1cnNpdmVMb2FkKGRhdGEpO1xuICAgICAgICB0aGlzLmVtaXQoJ2xvYWRlZCcsIGRhdGEpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKHJvb3QsIGZsYXQpIHtcbiAgICAgICAgdmFyIHNlcmllQ2hpbGRyZW4gPSBbXTtcbiAgICAgICAgcm9vdCA9IHJvb3QgfHwgJCgnW2RhdGEtbG0tcm9vdF0nKTtcblxuICAgICAgICBpZiAoIXJvb3QpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIGJsb2NrcyA9IHJvb3Quc2VhcmNoKCghZmxhdCA/ICc+ICcgOiAnJykgKyAnW2RhdGEtbG0taWRdJyksXG4gICAgICAgICAgICBpZCwgdHlwZSwgc3VidHlwZSwgc2VyaWFsLCBoYXNDaGlsZHJlbiwgY2hpbGRyZW47XG5cbiAgICAgICAgZm9yRWFjaChibG9ja3MsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgaWQgPSBlbGVtZW50LmRhdGEoJ2xtLWlkJyk7XG4gICAgICAgICAgICB0eXBlID0gZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKTtcbiAgICAgICAgICAgIHN1YnR5cGUgPSBlbGVtZW50LmRhdGEoJ2xtLWJsb2Nrc3VidHlwZScpIHx8IGZhbHNlO1xuICAgICAgICAgICAgaGFzQ2hpbGRyZW4gPSBlbGVtZW50LnNlYXJjaCgnPiBbZGF0YS1sbS1pZF0nKTtcblxuICAgICAgICAgICAgaWYgKGZsYXQpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGhhc0NoaWxkcmVuID8gaGFzQ2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGVsZW1lbnQpeyByZXR1cm4gJChlbGVtZW50KS5kYXRhKCdsbS1pZCcpOyB9KSA6IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGhhc0NoaWxkcmVuID8gdGhpcy5zZXJpYWxpemUoZWxlbWVudCkgOiBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VyaWFsID0ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgIHN1YnR5cGU6IHN1YnR5cGUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldCh0aGlzLm1hcCwgaWQpID8gZ2V0KHRoaXMubWFwLCBpZCkuZ2V0VGl0bGUoKSA6ICdVbnRpdGxlZCcsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogZ2V0KHRoaXMubWFwLCBpZCkgPyBnZXQodGhpcy5tYXAsIGlkKS5nZXRBdHRyaWJ1dGVzKCkgOiB7fSxcbiAgICAgICAgICAgICAgICBpbmhlcml0OiBnZXQodGhpcy5tYXAsIGlkKSA/IGdldCh0aGlzLm1hcCwgaWQpLmdldEluaGVyaXRhbmNlKCkgOiB7fSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChmbGF0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OyBvYmpbaWRdID0gc2VyaWFsO1xuICAgICAgICAgICAgICAgIHNlcmlhbCA9IG9iajtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VyaWVDaGlsZHJlbi5wdXNoKHNlcmlhbCk7XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHJldHVybiBzZXJpZUNoaWxkcmVuO1xuICAgIH0sXG5cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUsIHBhcmVudC8qLCBvYmplY3QqLykge1xuICAgICAgICB2YXIgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyk7XG4gICAgICAgIGlmICghcm9vdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFCbG9ja3NbdmFsdWUudHlwZV0pIHtcbiAgICAgICAgICAgIGNvbnNvbGVbY29uc29sZS5lcnJvciA/ICdlcnJvcicgOiAnbG9nJ10odmFsdWUudHlwZSArICcgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBFbGVtZW50ID0gbmV3IChCbG9ja3NbdmFsdWUudHlwZV0gfHwgQmxvY2tzWydzZWN0aW9uJ10pKGRlZXBGaWxsSW4oe1xuICAgICAgICAgICAgaWQ6IGtleSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9LFxuICAgICAgICAgICAgaW5oZXJpdDoge30sXG4gICAgICAgICAgICBzdWJ0eXBlOiB2YWx1ZS5zdWJ0eXBlIHx8IGZhbHNlLFxuICAgICAgICAgICAgYnVpbGRlcjogdGhpc1xuICAgICAgICB9LCBvbWl0KHZhbHVlLCAnY2hpbGRyZW4nKSkpO1xuXG4gICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICBFbGVtZW50LmJsb2NrLmluc2VydChyb290KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIEVsZW1lbnQuYmxvY2suaW5zZXJ0KCQoJ1tkYXRhLWxtLWlkPVwiJyArIHBhcmVudCArICdcIl0nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoRWxlbWVudC5nZXRUeXBlKCkgPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgIEVsZW1lbnQuc2V0U2l6ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hZGQoRWxlbWVudCk7XG4gICAgICAgIEVsZW1lbnQuZW1pdCgncmVuZGVyZWQnLCBFbGVtZW50LCBwYXJlbnQgPyBnZXQodGhpcy5tYXAsIHBhcmVudCkgOiBudWxsKTtcblxuICAgICAgICByZXR1cm4gRWxlbWVudDtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdGhpcy5tYXAgPSB7fTtcbiAgICAgICAgdGhpcy5zZXRTdHJ1Y3R1cmUoZGF0YSB8fCB7fSk7XG4gICAgICAgICQoJ1tkYXRhLWxtLXJvb3RdJykuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5sb2FkKCk7XG4gICAgfSxcblxuICAgIGNsZWFudXBMb25lbHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZ2hvc3RzID0gW10sXG4gICAgICAgICAgICBwYXJlbnQsIGNoaWxkcmVuID0gJCgnW2RhdGEtbG0tcm9vdF0gPiAuZy1zZWN0aW9uID4gLmctZ3JpZCA+IC5nLWJsb2NrIC5nLWdyaWQgPiAuZy1ibG9jaywgW2RhdGEtbG0tcm9vdF0gPiAuZy1zZWN0aW9uID4gLmctZ3JpZCA+IC5nLWJsb2NrID4gLmctYmxvY2snKTtcblxuICAgICAgICBpZiAoIWNoaWxkcmVuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuXG4gICAgICAgIHZhciBpc0dyaWQ7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgIGNoaWxkID0gJChjaGlsZCk7XG4gICAgICAgICAgICBwYXJlbnQgPSBudWxsO1xuICAgICAgICAgICAgaXNHcmlkID0gY2hpbGQucGFyZW50KCkuaGFzQ2xhc3MoJ2ctZ3JpZCcpO1xuXG4gICAgICAgICAgICBpZiAoaXNHcmlkICYmIGNoaWxkLnNpYmxpbmdzKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc0dyaWQpIHtcbiAgICAgICAgICAgICAgICBnaG9zdHMucHVzaChjaGlsZC5kYXRhKCdsbS1pZCcpKTtcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBjaGlsZC5wYXJlbnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2hvc3RzLnB1c2goY2hpbGQuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgICAgICBjaGlsZC5jaGlsZHJlbigpLmJlZm9yZShwYXJlbnQgPyBwYXJlbnQgOiBjaGlsZCk7XG4gICAgICAgICAgICAocGFyZW50ID8gcGFyZW50IDogY2hpbGQpLnJlbW92ZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZ2hvc3RzO1xuICAgIH0sXG5cbiAgICByZWN1cnNpdmVMb2FkOiBmdW5jdGlvbihkYXRhLCBjYWxsYmFjaywgZGVwdGgsIHBhcmVudCkge1xuICAgICAgICBkYXRhID0gZGF0YSB8fCB0aGlzLnN0cnVjdHVyZTtcbiAgICAgICAgZGVwdGggPSBkZXB0aCB8fCAwO1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQgfHwgZmFsc2U7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgdGhpcy5pbnNlcnQ7XG5cbiAgICAgICAgZm9yRWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZS8qLCBrZXksIG9iamVjdCovKSB7XG5cbiAgICAgICAgICAgIGlmICghdmFsdWUuaWQpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5pZCA9IElEKHsgYnVpbGRlcjogeyBtYXA6IHRoaXMubWFwIH0sIHR5cGU6IHZhbHVlLnR5cGUsIHN1YnR5cGU6IHZhbHVlLnN1YnR5cGUgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGRlYnVnIChmbGF0IHZpZXcgb2YgdGhlIHN0cnVjdHVyZSlcbiAgICAgICAgICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGUubG9nICYmIERFQlVHKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocnBhZChyZXBlYXQoJyAgICAnLCBkZXB0aCkgKyAnJyArIHZhbHVlLnR5cGUsIDM1KSArICcgKCcgKyBycGFkKHZhbHVlLmlkLCAzNikgKyAnKSBwYXJlbnQ6ICcgKyBwYXJlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2xvYWRpbmcnLCBjYWxsYmFjay5jYWxsKHRoaXMsIHZhbHVlLmlkLCB2YWx1ZSwgcGFyZW50LCBkZXB0aCkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmNoaWxkcmVuICYmIHNpemUodmFsdWUuY2hpbGRyZW4pKSB7XG4gICAgICAgICAgICAgICAgZGVwdGgrKztcblxuICAgICAgICAgICAgICAgIGZvckVhY2godmFsdWUuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkVmFsdWUvKiwgY2hpbGRLZXksIGFycmF5Ki8pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWN1cnNpdmVMb2FkKFtjaGlsZFZhbHVlXSwgY2FsbGJhY2ssIGRlcHRoLCB2YWx1ZS5pZCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0KHZhbHVlLmlkKS5lbWl0KCdkb25lJywgdGhpcy5nZXQodmFsdWUuaWQpKTtcblxuICAgICAgICAgICAgZGVwdGgtLTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQnVpbGRlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIERyYWdFdmVudHMgPSByZXF1aXJlKCcuLi91aS9kcmFnLmV2ZW50cycpLFxuICAgIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGlzU3RyaW5nICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNTdHJpbmcnKSxcbiAgICBuTWFwICAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL21hcCcpLFxuICAgIGNsYW1wICAgICAgPSByZXF1aXJlKCdtb3V0L21hdGgvY2xhbXAnKSxcbiAgICBwcmVjaXNpb24gID0gcmVxdWlyZSgnbW91dC9udW1iZXIvZW5mb3JjZVByZWNpc2lvbicpLFxuICAgIGdldCAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9nZXQnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKTtcblxucmVxdWlyZSgnZWxlbWVudHMvZXZlbnRzJyk7XG5yZXF1aXJlKCdlbGVtZW50cy9kZWxlZ2F0aW9uJyk7XG5cbnZhciBSZXNpemVyID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcbiAgICBEUkFHX0VWRU5UUzogRHJhZ0V2ZW50cyxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIG1pblNpemU6IDVcbiAgICB9LFxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLm9wdGlvbnMuaGlzdG9yeSB8fCB7fTtcbiAgICAgICAgdGhpcy5idWlsZGVyID0gdGhpcy5vcHRpb25zLmJ1aWxkZXIgfHwge307XG4gICAgICAgIHRoaXMub3JpZ2luID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IG51bGwsXG4gICAgICAgICAgICBvZmZzZXQ6IHtcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0QmxvY2s6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldCh0aGlzLmJ1aWxkZXIubWFwLCBpc1N0cmluZyhlbGVtZW50KSA/IGVsZW1lbnQgOiAkKGVsZW1lbnQpLmRhdGEoJ2xtLWlkJykgfHwgJycpO1xuICAgIH0sXG5cbiAgICBnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKGVsZW1lbnQsIHByb3ApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxvY2soZWxlbWVudCkuZ2V0QXR0cmlidXRlKHByb3ApO1xuICAgIH0sXG5cbiAgICBnZXRTaXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZSgkKGVsZW1lbnQpLCAnc2l6ZScpO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQsIHNpYmxpbmdzLCBvZmZzZXQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgd2luZG93Lkc1LnRpcHMuaGlkZShlbGVtZW50WzBdKTtcbiAgICAgICAgaWYgKGV2ZW50LndoaWNoICYmIGV2ZW50LndoaWNoICE9PSAxKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgLy8gU3RvcHMgdGV4dCBzZWxlY3Rpb25cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB0aGlzLnNpYmxpbmdzID0ge1xuICAgICAgICAgICAgb2NjdXBpZWQ6IDAsXG4gICAgICAgICAgICBlbGVtZW50czogc2libGluZ3MsXG4gICAgICAgICAgICBuZXh0OiB0aGlzLmVsZW1lbnQubmV4dFNpYmxpbmcoKSxcbiAgICAgICAgICAgIHByZXZzOiB0aGlzLmVsZW1lbnQucHJldmlvdXNTaWJsaW5ncygpLFxuICAgICAgICAgICAgc2l6ZUJlZm9yZTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgLT0gdGhpcy5nZXRTaXplKHRoaXMuc2libGluZ3MubmV4dCk7XG4gICAgICAgICAgICB0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oc2libGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zaWJsaW5ncy5wcmV2cykge1xuICAgICAgICAgICAgdGhpcy5zaWJsaW5ncy5wcmV2cy5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpYmxpbmdzLnNpemVCZWZvcmUgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9yaWdpbiA9IHtcbiAgICAgICAgICAgIHNpemU6IHRoaXMuZ2V0U2l6ZSh0aGlzLmVsZW1lbnQpLFxuICAgICAgICAgICAgbWF4U2l6ZTogdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkgKyB0aGlzLmdldFNpemUodGhpcy5zaWJsaW5ncy5uZXh0KSxcbiAgICAgICAgICAgIHg6IGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5wYWdlWCArIDYsXG4gICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVlcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2xpZW50UmVjdCA9IHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIHBhcmVudFJlY3QgPSB0aGlzLmVsZW1lbnQucGFyZW50KClbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0ID0ge1xuICAgICAgICAgICAgY2xpZW50UmVjdDogY2xpZW50UmVjdCxcbiAgICAgICAgICAgIHBhcmVudFJlY3Q6IHtsZWZ0OiBwYXJlbnRSZWN0LmxlZnQsIHJpZ2h0OiBwYXJlbnRSZWN0LnJpZ2h0fSxcbiAgICAgICAgICAgIHg6IHRoaXMub3JpZ2luLnggLSBjbGllbnRSZWN0LnJpZ2h0LFxuICAgICAgICAgICAgeTogY2xpZW50UmVjdC50b3AgLSB0aGlzLm9yaWdpbi55LFxuICAgICAgICAgICAgZG93bjogb2Zmc2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3QubGVmdCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5maW5kKCc+IFtkYXRhLWxtLWlkXTpmaXJzdC1jaGlsZCcpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICAgIHRoaXMub3JpZ2luLm9mZnNldC5wYXJlbnRSZWN0LnJpZ2h0ID0gdGhpcy5lbGVtZW50LnBhcmVudCgpLmZpbmQoJz4gW2RhdGEtbG0taWRdOmxhc3QtY2hpbGQnKVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodDtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5NT1ZFLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oZXZlbnQsIHRoaXMuYm91bmQoJ3N0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgbW92ZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGNsaWVudFggPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCB8fCAwLFxuICAgICAgICAgICAgY2xpZW50WSA9IGV2ZW50LmNsaWVudFkgfHwgZXZlbnQudG91Y2hlc1swXS5jbGllbnRZIHx8IDAsXG4gICAgICAgICAgICBwYXJlbnRSZWN0ID0gdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3Q7XG5cbiAgICAgICAgdmFyIGRlbHRhWCA9ICh0aGlzLmxhc3RYIHx8IGNsaWVudFgpIC0gY2xpZW50WCxcbiAgICAgICAgICAgIGRlbHRhWSA9ICh0aGlzLmxhc3RZIHx8IGNsaWVudFkpIC0gY2xpZW50WTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9XG4gICAgICAgICAgICBNYXRoLmFicyhkZWx0YVgpID4gTWF0aC5hYnMoZGVsdGFZKSAmJiBkZWx0YVggPiAwICYmICdsZWZ0JyB8fFxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYIDwgMCAmJiAncmlnaHQnIHx8XG4gICAgICAgICAgICBNYXRoLmFicyhkZWx0YVkpID4gTWF0aC5hYnMoZGVsdGFYKSAmJiBkZWx0YVkgPiAwICYmICd1cCcgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rvd24nO1xuICAgICAgICB2YXIgc2l6ZSxcbiAgICAgICAgICAgIGRpZmYgPSAxMDAgLSB0aGlzLnNpYmxpbmdzLm9jY3VwaWVkLFxuICAgICAgICAgICAgdmFsdWUgPSBjbGllbnRYICsgKCF0aGlzLnNpYmxpbmdzLnByZXZzID8gdGhpcy5vcmlnaW4ub2Zmc2V0LnggLSB0aGlzLm9yaWdpbi5vZmZzZXQuZG93biA6IHRoaXMuc2libGluZ3MucHJldnMubGVuZ3RoKSxcbiAgICAgICAgICAgIG5vcm1hbGl6ZWQgPSBjbGFtcCh2YWx1ZSwgcGFyZW50UmVjdC5sZWZ0LCBwYXJlbnRSZWN0LnJpZ2h0KTtcblxuICAgICAgICBzaXplID0gbk1hcChub3JtYWxpemVkLCBwYXJlbnRSZWN0LmxlZnQsIHBhcmVudFJlY3QucmlnaHQsIDAsIDEwMCk7XG4gICAgICAgIHNpemUgPSBzaXplIC0gdGhpcy5zaWJsaW5ncy5zaXplQmVmb3JlO1xuICAgICAgICBzaXplID0gcHJlY2lzaW9uKGNsYW1wKHNpemUsIHRoaXMub3B0aW9ucy5taW5TaXplLCB0aGlzLm9yaWdpbi5tYXhTaXplIC0gdGhpcy5vcHRpb25zLm1pblNpemUpLCAwKTtcblxuICAgICAgICAvL2dyaWRzP1xuICAgICAgICAvL2NvbnNvbGUubG9nKChzaXplIC8gMTIpICogKDEwMCAvIDEyKSk7XG5cbiAgICAgICAgZGlmZiA9IHByZWNpc2lvbihkaWZmIC0gc2l6ZSwgMCk7XG5cbiAgICAgICAgdGhpcy5nZXRCbG9jayh0aGlzLmVsZW1lbnQpLnNldFNpemUoc2l6ZSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZ2V0QmxvY2sodGhpcy5zaWJsaW5ncy5uZXh0KS5zZXRTaXplKGRpZmYsIHRydWUpO1xuXG4gICAgICAgIC8vIEhhY2sgdG8gaGFuZGxlIGNhc2VzIHdoZXJlIHNpemUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgdmFyIHNpYmxpbmdzID0gdGhpcy5lbGVtZW50LnNpYmxpbmdzKCksXG4gICAgICAgICAgICBhbW91bnQgPSBzaWJsaW5ncyA/IHNpYmxpbmdzLmxlbmd0aCArIDEgOiAxO1xuICAgICAgICBpZiAoYW1vdW50ID09IDMgfHwgYW1vdW50ID09IDYgfHwgYW1vdW50ID09IDcgfHwgYW1vdW50ID09IDggfHwgYW1vdW50ID09IDkgfHwgYW1vdW50ID09IDExIHx8IGFtb3VudCA9PSAxMikge1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwgYmxvY2tzO1xuXG4gICAgICAgICAgICBibG9ja3MgPSAkKFtzaWJsaW5ncywgdGhpcy5lbGVtZW50XSk7XG4gICAgICAgICAgICBibG9ja3MuZm9yRWFjaChmdW5jdGlvbihibG9jaywgaW5kZXgpe1xuICAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5nZXRCbG9jayhibG9jayk7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IGJsb2NrLmdldFNpemUoKTtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAlIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IHByZWNpc2lvbigxMDAgLyBhbW91bnQsIDApO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKHNpemUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRvdGFsICs9IHNpemU7XG5cbiAgICAgICAgICAgICAgICBpZiAoYmxvY2tzLmxlbmd0aCA9PSBpbmRleCArIDEgJiYgdG90YWwgIT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSAxMDAgLSB0b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0U2l6ZShzaXplICsgZGlmZiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGFzdFggPSBjbGllbnRYO1xuICAgICAgICB0aGlzLmxhc3RZID0gY2xpZW50WTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihldmVudCwgdGhpcy5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ3N0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Lm1hdGNoZXMoJ1tkYXRhLWxtLWJhY2tdLCBbZGF0YS1sbS1mb3J3YXJkXScpKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAodGhpcy5vcmlnaW4uc2l6ZSAhPT0gdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkpIHsgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5idWlsZGVyLnNlcmlhbGl6ZSgpLCB0aGlzLmhpc3RvcnkuZ2V0KCkucHJlc2V0KTsgfVxuICAgIH0sXG5cbiAgICBldmVuUmVzaXplOiBmdW5jdGlvbihlbGVtZW50cywgYW5pbWF0ZWQpIHtcbiAgICAgICAgdmFyIHRvdGFsID0gZWxlbWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgc2l6ZSA9IHByZWNpc2lvbigxMDAgLyB0b3RhbCwgNCksXG4gICAgICAgICAgICBibG9jaztcblxuICAgICAgICBpZiAodHlwZW9mIGFuaW1hdGVkID09PSAndW5kZWZpbmVkJykgeyBhbmltYXRlZCA9IHRydWU7IH1cblxuICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgYmxvY2sgPSB0aGlzLmdldEJsb2NrKGVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGJsb2NrICYmIGJsb2NrLmhhc0F0dHJpYnV0ZSgnc2l6ZScpICYmIHR5cGVvZiBibG9jay5nZXRTaXplID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tbYW5pbWF0ZWQgPyAnc2V0QW5pbWF0ZWRTaXplJyA6ICdzZXRTaXplJ10oc2l6ZSwgc2l6ZSAhPT0gYmxvY2suZ2V0U2l6ZSgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsgZWxlbWVudFthbmltYXRlZCA/ICdhbmltYXRlJyA6ICdzdHlsZSddKHsgZmxleDogJzAgMSAnICsgc2l6ZSArICclJyB9KTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXNpemVyO1xuIiwidmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgc2xpY2UgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvc2xpY2UnKSxcbiAgICBtZXJnZSAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvbWVyZ2UnKSxcbiAgICBkZWVwRXF1YWxzID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKSxcbiAgICBkZWVwRGlmZiAgID0gcmVxdWlyZSgnZGVlcC1kaWZmJykuZGlmZjtcblxudmFyIEhpc3RvcnkgPSBuZXcgcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oc2Vzc2lvbiwgcHJlc2V0KSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICBzZXNzaW9uID0gbWVyZ2Uoe30sIHNlc3Npb24pO1xuICAgICAgICBwcmVzZXQgPSBtZXJnZSh7fSwgcHJlc2V0KTtcbiAgICAgICAgdGhpcy5zZXRTZXNzaW9uKHNlc3Npb24sIHByZXNldCk7XG4gICAgfSxcblxuICAgIHVuZG86IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuaW5kZXgpIHJldHVybjtcbiAgICAgICAgdGhpcy5pbmRleC0tO1xuXG4gICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5nZXQoKTtcbiAgICAgICAgdGhpcy5lbWl0KCd1bmRvJywgc2Vzc2lvbiwgdGhpcy5pbmRleCk7XG4gICAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH0sXG5cbiAgICByZWRvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5kZXggPT0gdGhpcy5zZXNzaW9uLmxlbmd0aCAtIDEpIHJldHVybjtcbiAgICAgICAgdGhpcy5pbmRleCsrO1xuXG4gICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5nZXQoKTtcbiAgICAgICAgdGhpcy5lbWl0KCdyZWRvJywgc2Vzc2lvbiwgdGhpcy5pbmRleCk7XG4gICAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH0sXG5cbiAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuXG4gICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5nZXQoKTtcbiAgICAgICAgdGhpcy5lbWl0KCdyZXNldCcsIHNlc3Npb24sIHRoaXMuaW5kZXgpO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9LFxuXG4gICAgcHVzaDogZnVuY3Rpb24oc2Vzc2lvbiwgcHJlc2V0KSB7XG4gICAgICAgIHNlc3Npb24gPSBtZXJnZSh7fSwgc2Vzc2lvbik7XG4gICAgICAgIHByZXNldCA9IG1lcmdlKHt9LCBwcmVzZXQpO1xuICAgICAgICB2YXIgc2xpY2VkID0gdGhpcy5pbmRleCA8IHRoaXMuc2Vzc2lvbi5sZW5ndGggLSAxO1xuICAgICAgICBpZiAodGhpcy5pbmRleCA8IHRoaXMuc2Vzc2lvbi5sZW5ndGggLSAxKSB0aGlzLnNlc3Npb24gPSBzbGljZSh0aGlzLnNlc3Npb24sIDAsIC0odGhpcy5zZXNzaW9uLmxlbmd0aCAtIDEgLSB0aGlzLmluZGV4KSk7XG4gICAgICAgIHNlc3Npb24gPSB7XG4gICAgICAgICAgICB0aW1lOiArKG5ldyBEYXRlKCkpLFxuICAgICAgICAgICAgZGF0YTogc2Vzc2lvbixcbiAgICAgICAgICAgIHByZXNldDogcHJlc2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMuZXF1YWxzKHNlc3Npb24uZGF0YSkpIHsgcmV0dXJuIHNlc3Npb247IH1cblxuICAgICAgICB0aGlzLnNlc3Npb24ucHVzaChzZXNzaW9uKTtcbiAgICAgICAgdGhpcy5pbmRleCA9IHRoaXMuc2Vzc2lvbi5sZW5ndGggLSAxO1xuXG4gICAgICAgIHRoaXMuZW1pdCgncHVzaCcsIHNlc3Npb24sIHRoaXMuaW5kZXgsIHNsaWNlZCk7XG4gICAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH0sXG5cbiAgICBnZXQ6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb25bdHlwZW9mIGluZGV4ICE9PSAndW5kZWZpbmVkJyA/IGluZGV4IDogdGhpcy5pbmRleF0gfHwgZmFsc2U7XG4gICAgfSxcblxuICAgIGVxdWFsczogZnVuY3Rpb24oc2Vzc2lvbiwgY29tcGFyZSkge1xuICAgICAgICBpZiAoIWNvbXBhcmUpIHsgY29tcGFyZSA9IHRoaXMuZ2V0KCkuZGF0YTsgfVxuXG4gICAgICAgIHJldHVybiBkZWVwRXF1YWxzKHNlc3Npb24sIGNvbXBhcmUpO1xuICAgIH0sXG5cbiAgICBkaWZmOiBmdW5jdGlvbihvYmoxLCBvYmoyKSB7XG4gICAgICAgIGlmICghb2JqMSAmJiAhb2JqMiAmJiB0aGlzLnNlc3Npb24ubGVuZ3RoIDw9IDEpIHsgcmV0dXJuICdOb3QgZW5vdWdoIHNlc3Npb25zIHRvIGRpZmYnOyB9XG4gICAgICAgIGlmICghb2JqMikgeyBvYmoyID0gdGhpcy5nZXQoKTsgfVxuICAgICAgICBpZiAoIW9iajEpIHsgb2JqMSA9IHRoaXMuZ2V0KHRoaXMuaW5kZXggLSAxKTsgfVxuXG4gICAgICAgIHJldHVybiBkZWVwRGlmZihvYmoxLCBvYmoyKTtcbiAgICB9LFxuXG4gICAgc2V0U2Vzc2lvbjogZnVuY3Rpb24oc2Vzc2lvbiwgcHJlc2V0KSB7XG4gICAgICAgIHNlc3Npb24gPSAhc2Vzc2lvbiA/IFtdXG4gICAgICAgICAgICA6IFt7XG4gICAgICAgICAgICB0aW1lOiArKG5ldyBEYXRlKCkpLFxuICAgICAgICAgICAgZGF0YTogbWVyZ2Uoe30sIHNlc3Npb24pLFxuICAgICAgICAgICAgcHJlc2V0OiBwcmVzZXRcbiAgICAgICAgfV07XG5cbiAgICAgICAgdGhpcy5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb247XG4gICAgfSxcblxuICAgIGltcG9ydDogZnVuY3Rpb24oKSB7fSxcbiAgICBleHBvcnQ6IGZ1bmN0aW9uKCkge31cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEhpc3Rvcnk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBrZXlzICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2tleXMnKSxcbiAgICBjb250YWlucyA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICByYW5kICAgICA9IHJlcXVpcmUoJ21vdXQvcmFuZG9tL3JhbmRJbnQnKTtcblxudmFyIElEID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBtYXAgICAgID0gb3B0aW9ucy5idWlsZGVyID8ga2V5cyhvcHRpb25zLmJ1aWxkZXIubWFwKSA6IHt9LFxuICAgICAgICB0eXBlICAgID0gb3B0aW9ucy50eXBlLFxuICAgICAgICBzdWJ0eXBlID0gb3B0aW9ucy5zdWJ0eXBlLFxuXG4gICAgICAgIHJlc3VsdCAgPSBbXSwga2V5LCBpZDtcblxuICAgIGlmICh0eXBlICE9ICdwYXJ0aWNsZScpIHJlc3VsdC5wdXNoKHR5cGUpO1xuICAgIGlmIChzdWJ0eXBlKSAgcmVzdWx0LnB1c2goc3VidHlwZSk7XG5cbiAgICBrZXkgPSByZXN1bHQuam9pbignLScpO1xuXG4gICAgd2hpbGUgKGlkID0gcmFuZCgxMDAwLCA5OTk5KSkge1xuICAgICAgICBpZiAoIWNvbnRhaW5zKG1hcCwga2V5ICsgJy0nICsgaWQpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBrZXkgKyAnLScgKyBpZDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSUQ7IiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcmVhZHkgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgICQgICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvYXR0cmlidXRlcycpLFxuICAgIFN1Ym1pdCAgICAgICAgID0gcmVxdWlyZSgnLi4vZmllbGRzL3N1Ym1pdCcpLFxuICAgIG1vZGFsICAgICAgICAgID0gcmVxdWlyZSgnLi4vdWknKS5tb2RhbCxcbiAgICB0b2FzdHIgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIHNpZGViYXIgICAgICAgID0gcmVxdWlyZSgnLi9wYXJ0aWNsZXMtc2lkZWJhcicpLFxuICAgIHJlcXVlc3QgICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICB6ZW4gICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIGNvbnRhaW5zICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpLFxuICAgIHNpemUgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL3NpemUnKSxcbiAgICB0cmltICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBzdHJSZXBsYWNlICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3JlcGxhY2UnKSxcbiAgICBwcm9wZXJDYXNlICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3Byb3BlckNhc2UnKSxcbiAgICBwcmVjaXNpb24gICAgICA9IHJlcXVpcmUoJ21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24nKSxcblxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBwYXJzZUFqYXhVUkkgID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFVSTCAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmdsb2JhbCxcblxuICAgIGZsYWdzICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9mbGFncy1zdGF0ZScpLFxuICAgIEJ1aWxkZXIgICAgICAgID0gcmVxdWlyZSgnLi9idWlsZGVyJyksXG4gICAgSGlzdG9yeSAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9oaXN0b3J5JyksXG4gICAgdmFsaWRhdGVGaWVsZCAgPSByZXF1aXJlKCcuLi91dGlscy9maWVsZC12YWxpZGF0aW9uJyksXG4gICAgTE1IaXN0b3J5ICAgICAgPSByZXF1aXJlKCcuL2hpc3RvcnknKSxcbiAgICBMYXlvdXRNYW5hZ2VyICA9IHJlcXVpcmUoJy4vbGF5b3V0bWFuYWdlcicpLFxuICAgIFNhdmVTdGF0ZSAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvc2F2ZS1zdGF0ZScpLFxuICAgIHRyYW5zbGF0ZSAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnJlcXVpcmUoJy4uL3VpL3BvcG92ZXInKTtcbnJlcXVpcmUoJy4vaW5oZXJpdGFuY2UnKTtcblxudmFyIGJ1aWxkZXIsIGxheW91dG1hbmFnZXIsIGxtaGlzdG9yeSwgc2F2ZXN0YXRlLCBUaXBzO1xuXG5idWlsZGVyID0gbmV3IEJ1aWxkZXIoKTtcbmxtaGlzdG9yeSA9IG5ldyBMTUhpc3RvcnkoKTtcbnNhdmVzdGF0ZSA9IG5ldyBTYXZlU3RhdGUoKTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1sbS1iYWNrXScsIGZ1bmN0aW9uKGUsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIGlmICgkKGVsZW1lbnQpLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGxtaGlzdG9yeS51bmRvKCk7XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1sbS1mb3J3YXJkXScsIGZ1bmN0aW9uKGUsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIGlmICgkKGVsZW1lbnQpLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGxtaGlzdG9yeS5yZWRvKCk7XG4gICAgfSk7XG5cbiAgICAvKiBsbWhpc3RvcnkgZXZlbnRzICovXG4gICAgbG1oaXN0b3J5Lm9uKCdwdXNoJywgZnVuY3Rpb24oc2Vzc2lvbiwgaW5kZXgsIHJlc2V0KSB7XG4gICAgICAgIHZhciBITSA9IHtcbiAgICAgICAgICAgIGJhY2s6ICQoJ1tkYXRhLWxtLWJhY2tdJyksXG4gICAgICAgICAgICBmb3J3YXJkOiAkKCdbZGF0YS1sbS1mb3J3YXJkXScpXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGluZGV4ICYmIEhNLmJhY2sgJiYgSE0uYmFjay5oYXNDbGFzcygnZGlzYWJsZWQnKSkgSE0uYmFjay5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgaWYgKHJlc2V0ICYmIEhNLmZvcndhcmQgJiYgIUhNLmZvcndhcmQuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIEhNLmZvcndhcmQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIGxheW91dG1hbmFnZXIudXBkYXRlUGVuZGluZ0NoYW5nZXMoKTtcbiAgICB9KTtcblxuICAgIGxtaGlzdG9yeS5vbigndW5kbycsIGZ1bmN0aW9uKHNlc3Npb24sIGluZGV4KSB7XG4gICAgICAgIHZhciBub3RpY2UgPSAkKCcjbG0tbm8tbGF5b3V0JyksXG4gICAgICAgICAgICB0aXRsZSA9ICQoJy5sYXlvdXQtdGl0bGUgLnRpdGxlIHNtYWxsJyksXG4gICAgICAgICAgICBwcmVzZXRfbmFtZSA9IHNlc3Npb24ucHJlc2V0Lm5hbWUgfHwgJ0RlZmF1bHQnLFxuICAgICAgICAgICAgSE0gPSB7XG4gICAgICAgICAgICAgICAgYmFjazogJCgnW2RhdGEtbG0tYmFja10nKSxcbiAgICAgICAgICAgICAgICBmb3J3YXJkOiAkKCdbZGF0YS1sbS1mb3J3YXJkXScpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmIChub3RpY2UpIHsgbm90aWNlLnN0eWxlKHsgZGlzcGxheTogIXNpemUoc2Vzc2lvbi5kYXRhKSA/ICdibG9jaycgOiAnbm9uZScgfSk7IH1cbiAgICAgICAgaWYgKHRpdGxlKSB7IHRpdGxlLnRleHQoJygnICsgcHJvcGVyQ2FzZSh0cmltKHN0clJlcGxhY2UocHJlc2V0X25hbWUsIFsvXy9nLCAvXFwvL2ddLCBbJyAnLCAnIC8gJ10pKSkgKyAnKScpOyB9XG5cbiAgICAgICAgYnVpbGRlci5yZXNldChzZXNzaW9uLmRhdGEpO1xuICAgICAgICBITS5mb3J3YXJkLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBpZiAoIWluZGV4KSBITS5iYWNrLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBsYXlvdXRtYW5hZ2VyLnNpbmdsZXMoJ2Rpc2FibGUnKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci51cGRhdGVQZW5kaW5nQ2hhbmdlcygpO1xuICAgIH0pO1xuICAgIGxtaGlzdG9yeS5vbigncmVkbycsIGZ1bmN0aW9uKHNlc3Npb24sIGluZGV4KSB7XG4gICAgICAgIHZhciBub3RpY2UgPSAkKCcjbG0tbm8tbGF5b3V0JyksXG4gICAgICAgICAgICB0aXRsZSA9ICQoJy5sYXlvdXQtdGl0bGUgLnRpdGxlIHNtYWxsJyksXG4gICAgICAgICAgICBwcmVzZXRfbmFtZSA9IHNlc3Npb24ucHJlc2V0Lm5hbWUgfHwgJ0RlZmF1bHQnLFxuICAgICAgICAgICAgSE0gPSB7XG4gICAgICAgICAgICAgICAgYmFjazogJCgnW2RhdGEtbG0tYmFja10nKSxcbiAgICAgICAgICAgICAgICBmb3J3YXJkOiAkKCdbZGF0YS1sbS1mb3J3YXJkXScpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmIChub3RpY2UpIHsgbm90aWNlLnN0eWxlKHsgZGlzcGxheTogIXNpemUoc2Vzc2lvbi5kYXRhKSA/ICdibG9jaycgOiAnbm9uZScgfSk7IH1cbiAgICAgICAgaWYgKHRpdGxlKSB7IHRpdGxlLnRleHQoJygnICsgcHJvcGVyQ2FzZSh0cmltKHN0clJlcGxhY2UocHJlc2V0X25hbWUsIFsvXy9nLCAvXFwvL2ddLCBbJyAnLCAnIC8gJ10pKSkgKyAnKScpOyB9XG5cbiAgICAgICAgYnVpbGRlci5yZXNldChzZXNzaW9uLmRhdGEpO1xuICAgICAgICBITS5iYWNrLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBpZiAoaW5kZXggPT0gdGhpcy5zZXNzaW9uLmxlbmd0aCAtIDEpIEhNLmZvcndhcmQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIGxheW91dG1hbmFnZXIuc2luZ2xlcygnZGlzYWJsZScpO1xuICAgICAgICBsYXlvdXRtYW5hZ2VyLnVwZGF0ZVBlbmRpbmdDaGFuZ2VzKCk7XG4gICAgfSk7XG5cbn0pO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKSwgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyksIGRhdGE7XG5cbiAgICAvLyBMYXlvdXQgTWFuYWdlclxuICAgIGxheW91dG1hbmFnZXIgPSBuZXcgTGF5b3V0TWFuYWdlcignW2RhdGEtbG0tY29udGFpbmVyXScsIHtcbiAgICAgICAgZGVsZWdhdGU6ICdbZGF0YS1sbS1yb290XSAuZy1ncmlkID4gLmctYmxvY2sgPiBbZGF0YS1sbS1ibG9ja3R5cGVdOm5vdChbZGF0YS1sbS1ub2RyYWddKSAhPiAuZy1ibG9jaywgLmc1LWxtLXBhcnRpY2xlcy1waWNrZXIgW2RhdGEtbG0tYmxvY2t0eXBlXSwgW2RhdGEtbG0tcm9vdF0gW2RhdGEtbG0tYmxvY2t0eXBlPVwic2VjdGlvblwiXSA+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImdyaWRcIl06bm90KDplbXB0eSk6bm90KC5uby1tb3ZlKTpub3QoW2RhdGEtbG0tbm9kcmFnXSksIFtkYXRhLWxtLXJvb3RdIFtkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0gPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0gPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdOm5vdCg6ZW1wdHkpOm5vdCgubm8tbW92ZSk6bm90KFtkYXRhLWxtLW5vZHJhZ10pLCBbZGF0YS1sbS1yb290XSBbZGF0YS1sbS1ibG9ja3R5cGU9XCJvZmZjYW52YXNcIl0gPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdOm5vdCg6ZW1wdHkpOm5vdCgubm8tbW92ZSk6bm90KFtkYXRhLWxtLW5vZHJhZ10pLCBbZGF0YS1sbS1yb290XSBbZGF0YS1sbS1ibG9ja3R5cGU9XCJvZmZjYW52YXNcIl0gPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0gPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdOm5vdCg6ZW1wdHkpOm5vdCgubm8tbW92ZSk6bm90KFtkYXRhLWxtLW5vZHJhZ10pJyxcbiAgICAgICAgZHJvcHBhYmxlczogJ1tkYXRhLWxtLWRyb3B6b25lXScsXG4gICAgICAgIGV4Y2x1ZGU6ICcuc2VjdGlvbi1oZWFkZXIgLmJ1dHRvbiwgLnNlY3Rpb24taGVhZGVyIC5mYSwgLmxtLW5ld2Jsb2NrcyAuZmxvYXQtcmlnaHQgLmJ1dHRvbiwgW2RhdGEtbG0tbm9kcmFnXSwgW2RhdGEtbG0tZGlzYWJsZWRdJyxcbiAgICAgICAgcmVzaXplX2hhbmRsZXM6ICdbZGF0YS1sbS1yb290XSAuZy1ncmlkID4gLmctYmxvY2s6bm90KDpsYXN0LWNoaWxkKScsXG4gICAgICAgIGJ1aWxkZXI6IGJ1aWxkZXIsXG4gICAgICAgIGhpc3Rvcnk6IGxtaGlzdG9yeSxcbiAgICAgICAgc2F2ZXN0YXRlOiBzYXZlc3RhdGVcbiAgICB9KTtcblxuICAgIG1vZHVsZS5leHBvcnRzLmxheW91dG1hbmFnZXIgPSBsYXlvdXRtYW5hZ2VyO1xuXG4gICAgLy8gbG9hZCBidWlsZGVyIGRhdGFcbiAgICBpZiAocm9vdCkge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyb290LmRhdGEoJ2xtLXJvb3QnKSk7XG4gICAgICAgIGlmIChkYXRhLm5hbWUpIHsgZGF0YSA9IGRhdGEubGF5b3V0OyB9XG4gICAgICAgIGJ1aWxkZXIuc2V0U3RydWN0dXJlKGRhdGEpO1xuICAgICAgICBidWlsZGVyLmxvYWQoKTtcblxuICAgICAgICBsYXlvdXRtYW5hZ2VyLmhpc3Rvcnkuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZSgpLCBKU09OLnBhcnNlKHJvb3QuZGF0YSgnbG0tcHJlc2V0JykpKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci5zYXZlc3RhdGUuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZShudWxsLCB0cnVlKSk7XG4gICAgfVxuXG4gICAgLy8gYXR0YWNoIGV2ZW50c1xuICAgIC8vIE1vZGFsIFRhYnNcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcuZy10YWJzIGEnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgYm9keS5kZWxlZ2F0ZSgna2V5ZG93bicsICcuZy10YWJzIGEnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIga2V5ID0gKGV2ZW50LndoaWNoID8gZXZlbnQud2hpY2ggOiBldmVudC5rZXlDb2RlKTtcbiAgICAgICAgaWYgKGtleSA9PSAzMiB8fCBrZXkgPT0gMTMpIHsgLy8gQVJJQSBzdXBwb3J0OiBTcGFjZSAvIEVudGVyIHRvZ2dsZVxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnbW91c2V1cCcsIGV2ZW50KTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNldXAnLCAnLmctdGFicyBhJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIGluZGV4ID0gMCxcbiAgICAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCcuZy10YWJzJyksXG4gICAgICAgICAgICBwYW5lcyA9IHBhcmVudC5zaWJsaW5ncygnLmctcGFuZXMnKSxcbiAgICAgICAgICAgIGxpbmtzID0gcGFyZW50LnNlYXJjaCgnYScpO1xuXG4gICAgICAgIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaywgaSkge1xuICAgICAgICAgICAgaWYgKGxpbmsgPT0gZWxlbWVudFswXSkgeyBpbmRleCA9IGkgKyAxOyB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHBhbmVzLmZpbmQoJz4gLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgcGFyZW50LmZpbmQoJz4gdWwgPiAuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBwYW5lcy5maW5kKCc+IC5nLXBhbmU6bnRoLWNoaWxkKCcgKyBpbmRleCArICcpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBwYXJlbnQuZmluZCgnPiB1bCA+IGxpOm50aC1jaGlsZCgnICsgaW5kZXggKyAnKScpLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAvLyBBUklBXG4gICAgICAgIGlmIChwYW5lcy5zZWFyY2goJz4gW2FyaWEtZXhwYW5kZWRdJykpIHsgcGFuZXMuc2VhcmNoKCc+IFthcmlhLWV4cGFuZGVkXScpLmF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpOyB9XG4gICAgICAgIGlmIChwYXJlbnQuc2VhcmNoKCc+IFthcmlhLWV4cGFuZGVkXScpKSB7IHBhcmVudC5zZWFyY2goJz4gW2FyaWEtZXhwYW5kZWRdJykuYXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7IH1cblxuICAgICAgICBwYW5lcy5maW5kKCc+IC5nLXBhbmU6bnRoLWNoaWxkKCcgKyBpbmRleCArICcpJykuYXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTtcbiAgICAgICAgaWYgKHBhcmVudC5maW5kKCc+IHVsID5saTpudGgtY2hpbGQoJyArIGluZGV4ICsgJykgW2FyaWEtZXhwYW5kZWRdJykpIHsgcGFyZW50LmZpbmQoJz4gdWwgPiBsaTpudGgtY2hpbGQoJyArIGluZGV4ICsgJykgPiBbYXJpYS1leHBhbmRlZF0nKS5hdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOyB9XG4gICAgfSk7XG5cbiAgICAvLyBQaWNrZXJcbiAgICBib2R5LmRlbGVnYXRlKCdzdGF0ZWNoYW5nZUJlZm9yZScsICdbZGF0YS1nNS1sbS1waWNrZXJdJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICAvLyBTdWItbmF2aWdhdGlvbiBsaW5rc1xuICAgIGJvZHkub24oJ3N0YXRlY2hhbmdlQWZ0ZXInLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICByb290ID0gJCgnW2RhdGEtbG0tcm9vdF0nKTtcbiAgICAgICAgaWYgKCFyb290KSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKHJvb3QuZGF0YSgnbG0tcm9vdCcpKTtcbiAgICAgICAgYnVpbGRlci5zZXRTdHJ1Y3R1cmUoZGF0YSk7XG4gICAgICAgIGJ1aWxkZXIubG9hZCgpO1xuXG4gICAgICAgIGxheW91dG1hbmFnZXIucmVmcmVzaCgpO1xuICAgICAgICBsYXlvdXRtYW5hZ2VyLmhpc3Rvcnkuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZSgpLCBKU09OLnBhcnNlKHJvb3QuZGF0YSgnbG0tcHJlc2V0JykpKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci5zYXZlc3RhdGUuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZShudWxsLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gcmVmcmVzaCBMTSBlcmFzZXJcbiAgICAgICAgbGF5b3V0bWFuYWdlci5lcmFzZXIuZWxlbWVudCA9ICQoJ1tkYXRhLWxtLWVyYXNlYmxvY2tdJyk7XG4gICAgICAgIGxheW91dG1hbmFnZXIuZXJhc2VyLmhpZGUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICAvLyBQYXJ0aWNsZXMgZmlsdGVyaW5nXG4gICAgYm9keS5kZWxlZ2F0ZSgnaW5wdXQnLCAnLnNpZGViYXItYmxvY2sgLnNlYXJjaCBpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9ICQoZWxlbWVudCkudmFsdWUoKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbGlzdCA9ICQoJy5zaWRlYmFyLWJsb2NrIFtkYXRhLWxtLWJsb2NrdHlwZV0nKSxcbiAgICAgICAgICAgIHRleHQsIHR5cGU7XG4gICAgICAgIGlmICghbGlzdCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICBsaXN0LnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pLmZvckVhY2goZnVuY3Rpb24oYmxvY2t0eXBlKSB7XG4gICAgICAgICAgICBibG9ja3R5cGUgPSAkKGJsb2NrdHlwZSk7XG4gICAgICAgICAgICB0eXBlID0gYmxvY2t0eXBlLmRhdGEoJ2xtLWJsb2NrdHlwZScpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB0ZXh0ID0gdHJpbShibG9ja3R5cGUudGV4dCgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKHR5cGUuc3Vic3RyKDAsIHZhbHVlLmxlbmd0aCkgPT0gdmFsdWUgfHwgdGV4dC5tYXRjaCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBibG9ja3R5cGUuc3R5bGUoeyBkaXNwbGF5OiAnYmxvY2snIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9KTtcblxuICAgIC8vIEdyaWQgc2FtZSB3aWR0aHMgYnV0dG9uIChldmVuaXplLCBlcXVhbGl6ZSlcbiAgICBbJ2NsaWNrJywgJ3RvdWNoZW5kJ10uZm9yRWFjaChmdW5jdGlvbihldnQpe1xuICAgICAgICBib2R5LmRlbGVnYXRlKGV2dCwgJ1tkYXRhLWxtLXNhbWV3aWR0aF06bm90KDplbXB0eSknLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgd2luZG93Lkc1LnRpcHMuaGlkZShlbGVtZW50WzBdKTtcbiAgICAgICAgICAgIHZhciBjbGllbnRSZWN0ID0gZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIGlmICgoZXZlbnQuY2xpZW50WCB8fCBldmVudC5wYWdlWCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCB8fCAwKSA8IGNsaWVudFJlY3Qud2lkdGggKyBjbGllbnRSZWN0LmxlZnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIHZhciBibG9ja3MgPSBlbGVtZW50LnNlYXJjaCgnPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJibG9ja1wiXScpLCBpZDtcbiAgICAgICAgICAgIGlmICghYmxvY2tzIHx8IGJsb2Nrcy5sZW5ndGggPT0gMSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgICAgICAgICBpZCA9ICQoYmxvY2spLmRhdGEoJ2xtLWlkJyk7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5nZXQoaWQpLnNldFNpemUoMTAwIC8gYmxvY2tzLmxlbmd0aCwgdHJ1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbG1oaXN0b3J5LnB1c2goYnVpbGRlci5zZXJpYWxpemUoKSwgbG1oaXN0b3J5LmdldCgpLnByZXNldCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2VvdmVyJywgJ1tkYXRhLWxtLXNhbWV3aWR0aF06bm90KDplbXB0eSknLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgY2xpZW50UmVjdCA9IGVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICBjbGllbnRYID0gZXZlbnQuY2xpZW50WCB8fCAoZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzWzBdLmNsaWVudFgpIHx8IDAsXG4gICAgICAgICAgICB0b29sdGlwcyA9IHtcbiAgICAgICAgICAgICAgICBlcXVhbGl6ZTogY2xpZW50WCArIDUgPiBjbGllbnRSZWN0LndpZHRoICsgY2xpZW50UmVjdC5sZWZ0LFxuICAgICAgICAgICAgICAgIG1vdmU6IGNsaWVudFggLSA1IDwgY2xpZW50UmVjdC5sZWZ0XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmICghdG9vbHRpcHMuZXF1YWxpemUgJiYgIXRvb2x0aXBzLm1vdmUpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIG1zZyA9IHRvb2x0aXBzLmVxdWFsaXplID8gdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xNX0dSSURfRVFVQUxJWkUnKSA6IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19MTV9HUklEX1NPUlRfTU9WRScpO1xuXG4gICAgICAgIGVsZW1lbnQuZGF0YSgndGlwJywgbXNnKS5kYXRhKCd0aXAtb2Zmc2V0JywgLTMwKTtcblxuICAgICAgICB3aW5kb3cuRzUudGlwc1xuICAgICAgICAgICAgLmdldChlbGVtZW50WzBdKVxuICAgICAgICAgICAgLmNvbnRlbnQobXNnKVxuICAgICAgICAgICAgLnBsYWNlKHRvb2x0aXBzLmVxdWFsaXplID8gJ3RvcC1sZWZ0JyA6ICd0b3AtcmlnaHQnKVxuICAgICAgICAgICAgLnNob3coKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3V0JywgJ1tkYXRhLWxtLXNhbWV3aWR0aF06bm90KDplbXB0eSknLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB3aW5kb3cuRzUudGlwcy5oaWRlKGVsZW1lbnRbMF0pO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xlYXIgTGF5b3V0XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtbG0tY2xlYXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICB2YXIgbW9kZSA9IGVsZW1lbnQuZGF0YSgnbG0tY2xlYXInKSxcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcblxuICAgICAgICBzd2l0Y2ggKG1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2tlZXAtaW5oZXJpdGFuY2UnOlxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7IHNhdmU6IHRydWUsIGRyb3BMYXN0R3JpZDogZmFsc2UsIGVtcHR5SW5oZXJpdHM6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmdWxsJzpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHsgc2F2ZTogdHJ1ZSwgZHJvcExhc3RHcmlkOiBmYWxzZSwgZW1wdHlJbmhlcml0czogdHJ1ZSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgbGF5b3V0bWFuYWdlci5jbGVhcihudWxsLCBvcHRpb25zKTtcbiAgICB9KTtcblxuICAgIC8vIFN3aXRjaGVyXG4gICAgdmFyIFNXSVRDSEVSX0hJVCA9IGZhbHNlO1xuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICdbZGF0YS1sbS1zd2l0Y2hlcl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIFNXSVRDSEVSX0hJVCA9IGVsZW1lbnQ7XG4gICAgICAgIGlmICghZWxlbWVudC5Qb3BvdmVyRGVmaW5lZCkge1xuICAgICAgICAgICAgZWxlbWVudC5nZXRQb3BvdmVyKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnYXN5bmMnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnNTAwJyxcbiAgICAgICAgICAgICAgICB1cmw6IHBhcnNlQWpheFVSSShlbGVtZW50LmRhdGEoJ2xtLXN3aXRjaGVyJykgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgICAgIGFsbG93RWxlbWVudHNDbGljazogJy5nLXRhYnMgYSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBTd2l0Y2ggTGF5b3V0XG4gICAgYm9keS5kZWxlZ2F0ZSgna2V5ZG93bicsICdbZGF0YS1zd2l0Y2hdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpe1xuICAgICAgICB2YXIga2V5ID0gKGV2ZW50LndoaWNoID8gZXZlbnQud2hpY2ggOiBldmVudC5rZXlDb2RlKTtcbiAgICAgICAgaWYgKGtleSA9PSAzMiB8fCBrZXkgPT0gMTMpIHsgLy8gQVJJQSBzdXBwb3J0OiBTcGFjZSB0b2dnbGVcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ21vdXNlZG93bicsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRGlzYWJsZSBrZWVwaW5nIHBhcnRpY2xlcyBpZiBpbmhlcml0IG9wdGlvbiBpcyBzZWxlY3RlZFxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbZGF0YS1nLWluaGVyaXQ9XCJvdXRsaW5lXCJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGtlZXBlciA9IGVsZW1lbnQucGFyZW50KCcuZy1wYW5lJykuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdW2RhdGEtZy1wcmVzZXJ2ZT1cIm91dGxpbmVcIl0nKTtcbiAgICAgICAgaWYgKGtlZXBlcikgeyBrZWVwZXIuY2hlY2tlZChmYWxzZSk7IH1cbiAgICB9KTtcblxuICAgIC8vIERpc2FibGUgaW5oZXJpdGluZyBzZWN0aW9uL3BhcnRpY2xlcyBpZiBrZWVwIG9wdGlvbiBpcyBzZWxlY3RlZFxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbZGF0YS1nLXByZXNlcnZlPVwib3V0bGluZVwiXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBpbmhlcml0ID0gZWxlbWVudC5wYXJlbnQoJy5nLXBhbmUnKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl1bZGF0YS1nLWluaGVyaXQ9XCJvdXRsaW5lXCJdJyk7XG4gICAgICAgIGlmIChpbmhlcml0KSB7IGluaGVyaXQuY2hlY2tlZChmYWxzZSk7IH1cbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlZG93bicsICdbZGF0YS1zd2l0Y2hdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICAvLyBpdCdzIGFscmVhZHkgbG9hZGluZyBzb21ldGhpbmcuXG4gICAgICAgIGlmIChlbGVtZW50LnBhcmVudCgnLmc1LXBvcG92ZXItY29udGVudCcpLmZpbmQoJ1tkYXRhLXN3aXRjaF0gaScpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICB2YXIgcHJlc2V0ID0gJCgnW2RhdGEtbG0tcHJlc2V0XScpLFxuICAgICAgICAgICAgcHJlc2VydmUgPSBlbGVtZW50LnBhcmVudCgnLmctcGFuZScpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXVtkYXRhLWctcHJlc2VydmVdJyksXG4gICAgICAgICAgICBpbmhlcml0ID0gZWxlbWVudC5wYXJlbnQoJy5nLXBhbmUnKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl1bZGF0YS1nLWluaGVyaXRdJyksXG4gICAgICAgICAgICBtZXRob2QgPSAhcHJlc2VydmUgPyAnZ2V0JyA6ICdwb3N0JyxcbiAgICAgICAgICAgIGRhdGEgPSB7fTtcblxuICAgICAgICBwcmVzZXJ2ZSA9IHByZXNlcnZlICYmIHByZXNlcnZlLmNoZWNrZWQoKTtcbiAgICAgICAgaW5oZXJpdCA9IGluaGVyaXQgJiYgaW5oZXJpdC5jaGVja2VkKCk7XG5cbiAgICAgICAgaWYgKHByZXNlcnZlKSB7XG4gICAgICAgICAgICB2YXIgbG0gPSBsYXlvdXRtYW5hZ2VyO1xuICAgICAgICAgICAgbG0uc2luZ2xlcygnY2xlYW51cCcsIGxtLmJ1aWxkZXIsIHRydWUpO1xuICAgICAgICAgICAgbG0uc2F2ZXN0YXRlLnNldFNlc3Npb24obG0uYnVpbGRlci5zZXJpYWxpemUobnVsbCwgdHJ1ZSkpO1xuXG4gICAgICAgICAgICBkYXRhLnByZXNldCA9IHByZXNldCAmJiBwcmVzZXQuZGF0YSgnbG0tcHJlc2V0JykgPyBwcmVzZXQuZGF0YSgnbG0tcHJlc2V0JykgOiAnZGVmYXVsdCc7XG4gICAgICAgICAgICBkYXRhLmxheW91dCA9IEpTT04uc3RyaW5naWZ5KGxtLmJ1aWxkZXIuc2VyaWFsaXplKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluaGVyaXQpIHtcbiAgICAgICAgICAgIGRhdGEuaW5oZXJpdCA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdXJpID0gcGFyc2VBamF4VVJJKGVsZW1lbnQuZGF0YSgnc3dpdGNoJykgKyBnZXRBamF4U3VmZml4KCkpO1xuICAgICAgICByZXF1ZXN0KG1ldGhvZCwgdXJpLCBkYXRhLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuYm9keS5tZXNzYWdlICYmICFmbGFncy5nZXQoJ2xtOnN3aXRjaGVyOicgKyB3aW5kb3cuYnRvYSh1cmkpLCBmYWxzZSkpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25maXJtIGJlZm9yZSBwcm9jZWVkaW5nXG4gICAgICAgICAgICAgICAgZmxhZ3Mud2FybmluZyh7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmJvZHkubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybSA9IGNvbnRlbnQuZmluZCgnW2RhdGEtZy1kZWxldGUtY29uZmlybV0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgID0gY29udGVudC5maW5kKCdbZGF0YS1nLWRlbGV0ZS1jYW5jZWxdJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlybSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZSgnZGlzYWJsZWQnKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLmdldCgnbG06c3dpdGNoZXI6JyArIHdpbmRvdy5idG9hKHVyaSksIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoW2NvbmZpcm0sIGNhbmNlbF0pLmF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ21vdXNlZG93bicsIHsgdGFyZ2V0OiBlbGVtZW50IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFtjb25maXJtLCBjYW5jZWxdKS5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MuZ2V0KCdsbTpzd2l0Y2hlcjonICsgd2luZG93LmJ0b2EodXJpKSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU1dJVENIRVJfSElUKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNXSVRDSEVSX0hJVC5nZXRQb3BvdmVyKCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcHJlc2V0ID0gcmVzcG9uc2UuYm9keS5wcmVzZXQgfHwgeyBuYW1lOiAnZGVmYXVsdCcgfSxcbiAgICAgICAgICAgICAgICBwcmVzZXRfbmFtZSA9IHJlc3BvbnNlLmJvZHkudGl0bGUgfHwgJ0RlZmF1bHQnLFxuICAgICAgICAgICAgICAgIHN0cnVjdHVyZSA9IHJlc3BvbnNlLmJvZHkuZGF0YSxcbiAgICAgICAgICAgICAgICBub3RpY2UgPSAkKCcjbG0tbm8tbGF5b3V0JyksXG4gICAgICAgICAgICAgICAgdGl0bGUgPSAkKCcubGF5b3V0LXRpdGxlIC50aXRsZSBzbWFsbCcpO1xuXG4gICAgICAgICAgICByb290LmRhdGEoJ2xtLXJvb3QnLCBKU09OLnN0cmluZ2lmeShzdHJ1Y3R1cmUpKS5lbXB0eSgpO1xuICAgICAgICAgICAgcm9vdC5kYXRhKCdsbS1wcmVzZXQnLCBwcmVzZXQpO1xuICAgICAgICAgICAgaWYgKG5vdGljZSkgeyBub3RpY2Uuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7IH1cbiAgICAgICAgICAgIGlmICh0aXRsZSkgeyB0aXRsZS50ZXh0KCcoJyArIHByZXNldF9uYW1lICsgJyknKTsgfVxuICAgICAgICAgICAgYnVpbGRlci5zZXRTdHJ1Y3R1cmUoc3RydWN0dXJlKTtcbiAgICAgICAgICAgIGJ1aWxkZXIubG9hZCgpO1xuXG4gICAgICAgICAgICBsbWhpc3RvcnkucHVzaChidWlsZGVyLnNlcmlhbGl6ZSgpLCBKU09OLnBhcnNlKHByZXNldCkpO1xuXG4gICAgICAgICAgICAkKCdbZGF0YS1sbS1zd2l0Y2hlcl0nKS5nZXRQb3BvdmVyKCkuaGlkZUFsbCgpLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBQYXJ0aWNsZXMgc2V0dGluZ3NcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1sbS1zZXR0aW5nc10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICB2YXIgYmxvY2t0eXBlID0gZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSxcbiAgICAgICAgICAgIHNldHRpbmdzVVJMID0gZWxlbWVudC5kYXRhKCdsbS1zZXR0aW5ncycpLFxuICAgICAgICAgICAgZGF0YSA9IG51bGwsIHBhcmVudCwgc2VjdGlvbjtcblxuICAgICAgICAvLyBncmlkIGlzIGEgc3BlY2lhbCBjYXNlLCBzaW5jZSByZWxpZXMgb24gcHNldWRvIGVsZW1lbnRzIGZvciBzb3J0aW5nIGFuZCBzYW1lIHdpZHRoIChldmVuaXplKVxuICAgICAgICAvLyB3ZSBuZWVkIHRvIGNoZWNrIHdoZXJlIHRoZSB1c2VyIGNsaWNrZWQuXG4gICAgICAgIGlmIChibG9ja3R5cGUgPT09ICdncmlkJykge1xuICAgICAgICAgICAgdmFyIGNsaWVudFggPSBldmVudC5jbGllbnRYIHx8IChldmVudC50b3VjaGVzICYmIGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCkgfHwgMCxcbiAgICAgICAgICAgICAgICBib3VuZGluZ3MgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgICAgICBpZiAoY2xpZW50WCArIDQgLSBib3VuZGluZ3MubGVmdCA8IGJvdW5kaW5ncy53aWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtbG0tYmxvY2t0eXBlXScpO1xuICAgICAgICBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtbG0tYmxvY2t0eXBlXScpO1xuICAgICAgICBzZWN0aW9uID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0nKTtcbiAgICAgICAgYmxvY2t0eXBlID0gZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKTtcblxuICAgICAgICB2YXIgSUQgPSBlbGVtZW50LmRhdGEoJ2xtLWlkJyksXG4gICAgICAgICAgICBwYXJlbnRJRCA9IHBhcmVudCA/IHBhcmVudC5kYXRhKCdsbS1pZCcpIDogZmFsc2UsXG4gICAgICAgICAgICBwYXJlbnRUeXBlID0gcGFyZW50ID8gcGFyZW50LmRhdGEoJ2xtLWJsb2NrdHlwZScpIDogZmFsc2U7XG5cbiAgICAgICAgaWYgKCFjb250YWlucyhbJ2Jsb2NrJywgJ2dyaWQnXSwgYmxvY2t0eXBlKSkge1xuICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICAgICAgZGF0YS5pZCA9IGJ1aWxkZXIuZ2V0KGVsZW1lbnQuZGF0YSgnbG0taWQnKSkuZ2V0SWQoKSB8fCBudWxsO1xuICAgICAgICAgICAgZGF0YS50eXBlID0gYnVpbGRlci5nZXQoZWxlbWVudC5kYXRhKCdsbS1pZCcpKS5nZXRUeXBlKCkgfHwgZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSB8fCBmYWxzZTtcbiAgICAgICAgICAgIGRhdGEuc3VidHlwZSA9IGJ1aWxkZXIuZ2V0KGVsZW1lbnQuZGF0YSgnbG0taWQnKSkuZ2V0U3ViVHlwZSgpIHx8IGVsZW1lbnQuZGF0YSgnbG0tYmxvY2tzdWJ0eXBlJykgfHwgZmFsc2U7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gKGVsZW1lbnQuZmluZCgnaDQnKSB8fCBlbGVtZW50LmZpbmQoJy50aXRsZScpKS50ZXh0KCkgfHwgZGF0YS50eXBlIHx8ICdVbnRpdGxlZCc7XG4gICAgICAgICAgICBkYXRhLm9wdGlvbnMgPSBidWlsZGVyLmdldChlbGVtZW50LmRhdGEoJ2xtLWlkJykpLmdldEF0dHJpYnV0ZXMoKSB8fCB7fTtcbiAgICAgICAgICAgIGRhdGEuaW5oZXJpdCA9IGJ1aWxkZXIuZ2V0KGVsZW1lbnQuZGF0YSgnbG0taWQnKSkuZ2V0SW5oZXJpdGFuY2UoKSB8fCB7fTtcbiAgICAgICAgICAgIGRhdGEuYmxvY2sgPSBwYXJlbnQgJiYgcGFyZW50VHlwZSAhPT0gJ3dyYXBwZXInID8gYnVpbGRlci5nZXQocGFyZW50LmRhdGEoJ2xtLWlkJykpLmdldEF0dHJpYnV0ZXMoKSB8fCB7fSA6IHt9O1xuICAgICAgICAgICAgZGF0YS5zaXplX2xpbWl0cyA9IGJ1aWxkZXIuZ2V0KGVsZW1lbnQuZGF0YSgnbG0taWQnKSkuZ2V0TGltaXRzKCFwYXJlbnQgPyBmYWxzZSA6IGJ1aWxkZXIuZ2V0KHBhcmVudC5kYXRhKCdsbS1pZCcpKSk7XG4gICAgICAgICAgICBkYXRhLnBhcmVudCA9IHNlY3Rpb24gPyBzZWN0aW9uLmRhdGEoJ2xtLWlkJykgOiBudWxsO1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEudHlwZSkgeyBkZWxldGUgZGF0YS50eXBlOyB9XG4gICAgICAgICAgICBpZiAoIWRhdGEuc3VidHlwZSkgeyBkZWxldGUgZGF0YS5zdWJ0eXBlOyB9XG4gICAgICAgICAgICBpZiAoIXNpemUoZGF0YS5vcHRpb25zKSkgeyBkZWxldGUgZGF0YS5vcHRpb25zOyB9XG4gICAgICAgICAgICBpZiAoIXNpemUoZGF0YS5pbmhlcml0KSkgeyBkZWxldGUgZGF0YS5pbmhlcml0OyB9XG4gICAgICAgICAgICBpZiAoIXNpemUoZGF0YS5ibG9jaykpIHsgZGVsZXRlIGRhdGEuYmxvY2s7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgb3ZlcmxheUNsaWNrVG9DbG9zZTogZmFsc2UsXG4gICAgICAgICAgICByZW1vdGU6IHBhcnNlQWpheFVSSShzZXR0aW5nc1VSTCArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwuZW5hYmxlQ2xvc2VCeU92ZXJsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBmb3JtID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgZmFrZURPTSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpLmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0ID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnaW5wdXRbdHlwZT1cInN1Ym1pdFwiXSwgYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0sIFtkYXRhLWFwcGx5LWFuZC1zYXZlXScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCghZm9ybSAmJiAhZmFrZURPTSkgfHwgIXN1Ym1pdCkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHVybFRlbXBsYXRlID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJy5nLXVybHRlbXBsYXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHVybFRlbXBsYXRlKSB7IGJvZHkuZW1pdCgnaW5wdXQnLCB7IHRhcmdldDogdXJsVGVtcGxhdGUgfSk7IH1cblxuICAgICAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnW25hbWU9XCJibG9ja1tzaXplXVwiXScpO1xuXG4gICAgICAgICAgICAgICAgLy8gbG9naWMgZm9yIGxpbWl0c1xuICAgICAgICAgICAgICAgIGlmIChibG9ja1NpemUgJiYgZGF0YS5zaXplX2xpbWl0cykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm90ZSA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCcuYmxvY2tzaXplLW5vdGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHByZWNpc2lvbihkYXRhLnNpemVfbGltaXRzWzBdLCAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heCA9IHByZWNpc2lvbihkYXRhLnNpemVfbGltaXRzWzFdLCAxKTtcblxuICAgICAgICAgICAgICAgICAgICBibG9ja1NpemUuYXR0cmlidXRlKCdtaW4nLCBtaW4pO1xuICAgICAgICAgICAgICAgICAgICBibG9ja1NpemUuYXR0cmlidXRlKCdtYXgnLCBtYXgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChub3RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm90ZUhUTUwgPSBub3RlLmh0bWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVIVE1MID0gbm90ZUhUTUwucmVwbGFjZSgvI21pbiMvZywgbWluKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVIVE1MID0gbm90ZUhUTUwucmVwbGFjZSgvI21heCMvZywgbWF4KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbm90ZS5odG1sKG5vdGVIVE1MKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGUuZmluZCgnLmJsb2Nrc2l6ZS0nICsgKG1pbiA9PSBtYXggPyAncmFuZ2UnIDogJ2ZpeGVkJykpLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1ZhbGlkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChibG9ja1NpemUudmFsdWUoKSkgPj0gbWluICYmIHBhcnNlRmxvYXQoYmxvY2tTaXplLnZhbHVlKCkpIDw9IG1heCA/ICcnIDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xNX1NJWkVfTElNSVRTX1JBTkdFJyk7XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgYmxvY2tTaXplLm9uKCdpbnB1dCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja1NpemVbMF0uc2V0Q3VzdG9tVmFsaWRpdHkoaXNWYWxpZCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUGFydGljbGUgU2V0dGluZ3MgYXBwbHlcbiAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRpc2FibGVkKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgZm9ybSB0byBjb2xsZWN0IGZyZXNoIGFuZCBkeW5hbWljIGZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybUVsZW1lbnRzID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKVswXS5lbGVtZW50cztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc3QgPSBTdWJtaXQoZm9ybUVsZW1lbnRzLCBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3N0LmludmFsaWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zaG93SW5kaWNhdG9yKCdmYSBmYS1mdyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19SRVZJRVdfRklFTERTJyksIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19JTlZBTElEX0ZJRUxEUycpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QoZmFrZURPTS5hdHRyaWJ1dGUoJ21ldGhvZCcpLCBwYXJzZUFqYXhVUkkoZmFrZURPTS5hdHRyaWJ1dGUoJ2FjdGlvbicpICsgZ2V0QWpheFN1ZmZpeCgpKSwgcG9zdC52YWxpZC5qb2luKCcmJykgfHwge30sIGZ1bmN0aW9uKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFydGljbGUgPSBidWlsZGVyLmdldChJRCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcnRpY2xlIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRBdHRyaWJ1dGVzKHJlc3BvbnNlLmJvZHkuZGF0YS5vcHRpb25zKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5oYXNBdHRyaWJ1dGUoJ2VuYWJsZWQnKSkgeyBwYXJ0aWNsZVtwYXJ0aWNsZS5nZXRBdHRyaWJ1dGUoJ2VuYWJsZWQnKSA/ICdlbmFibGUnIDogJ2Rpc2FibGUnXSgpOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuZ2V0VHlwZSgpICE9ICdzZWN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRUaXRsZShyZXNwb25zZS5ib2R5LmRhdGEudGl0bGUgfHwgJ1VudGl0bGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnVwZGF0ZVRpdGxlKHBhcnRpY2xlLmdldFRpdGxlKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5nZXRUeXBlKCkgPT0gJ3Bvc2l0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS51cGRhdGVLZXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXJlbnQgYmxvY2sgYXR0cmlidXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5ib2R5LmRhdGEuYmxvY2sgJiYgc2l6ZShyZXNwb25zZS5ib2R5LmRhdGEuYmxvY2spKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrID0gYnVpbGRlci5nZXQocGFyZW50SUQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaWJsaW5nID0gYmxvY2suYmxvY2submV4dFNpYmxpbmcoKSB8fCBibG9jay5ibG9jay5wcmV2aW91c1NpYmxpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTaXplID0gYmxvY2suZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZlNpemU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0QXR0cmlidXRlcyhyZXNwb25zZS5ib2R5LmRhdGEuYmxvY2spO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZTaXplID0gY3VycmVudFNpemUgLSBibG9jay5nZXRTaXplKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0QW5pbWF0ZWRTaXplKGJsb2NrLmdldFNpemUoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSBidWlsZGVyLmdldChzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2libGluZy5zZXRBbmltYXRlZFNpemUocGFyc2VGbG9hdChzaWJsaW5nLmdldFNpemUoKSkgKyBkaWZmU2l6ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXJ0aWNsZSBpbmhlcml0YW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5ib2R5LmRhdGEuaW5oZXJpdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuYm9keS5kYXRhLmluaGVyaXQuc2VjdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuc2V0SW5oZXJpdGFuY2UocmVzcG9uc2UuYm9keS5kYXRhLmluaGVyaXQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLmVuYWJsZUluaGVyaXRhbmNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJlZnJlc2hJbmhlcml0YW5jZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5ib2R5LmRhdGEuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0bWFuYWdlci5jbGVhcihwYXJ0aWNsZS5ibG9jaywgeyBzYXZlOiBmYWxzZSwgZHJvcExhc3RHcmlkOiAhIXJlc3BvbnNlLmJvZHkuZGF0YS5jaGlsZHJlbi5sZW5ndGgsIGVtcHR5SW5oZXJpdHM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIucmVjdXJzaXZlTG9hZChyZXNwb25zZS5ib2R5LmRhdGEuY2hpbGRyZW4sIGJ1aWxkZXIuaW5zZXJ0LCAwLCBwYXJ0aWNsZS5nZXRJZCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuaGFzSW5oZXJpdGFuY2UoKSAmJiAhcmVzcG9uc2UuYm9keS5kYXRhLmluaGVyaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuc2V0SW5oZXJpdGFuY2Uoe30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5kaXNhYmxlSW5oZXJpdGFuY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbWhpc3RvcnkucHVzaChidWlsZGVyLnNlcmlhbGl6ZSgpLCBsbWhpc3RvcnkuZ2V0KCkucHJlc2V0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYXBwbHkgYW5kIHNhdmUgd2UgYWxzbyBzYXZlIHRoZSBwYW5lbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuZGF0YSgnYXBwbHktYW5kLXNhdmUnKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZSA9ICQoJ2JvZHknKS5maW5kKCcuYnV0dG9uLXNhdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNhdmUpIHsgYm9keS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiBzYXZlIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19QQVJUSUNMRV9TRVRUSU5HU19BUFBMSUVEJywgcGFydGljbGUuZ2V0VGl0bGUoKSksIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19TRVRUSU5HU19BUFBMSUVEJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9KTtcblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgICQ6ICQsXG4gICAgYnVpbGRlcjogYnVpbGRlcixcbiAgICBsYXlvdXRtYW5hZ2VyOiBsYXlvdXRtYW5hZ2VyLFxuICAgIGhpc3Rvcnk6IGxtaGlzdG9yeSxcbiAgICBzYXZlc3RhdGU6IHNhdmVzdGF0ZVxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCAgICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICByZWFkeSAgICAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHJlcXVlc3QgICAgICAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgbW9kYWwgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS5tb2RhbCxcblxuICAgIGlzQXJyYXkgICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0FycmF5JyksXG4gICAgZm9yRWFjaCAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZvckVhY2gnKSxcbiAgICBmaWx0ZXIgICAgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9maWx0ZXInKSxcbiAgICBrZXlzICAgICAgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9rZXlzJyksXG4gICAgY29udGFpbnMgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2NvbnRhaW5zJyksXG5cbiAgICBnZXRBamF4U3VmZml4ICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBwYXJzZUFqYXhVUkkgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5nbG9iYWwsXG4gICAgZ2V0T3V0bGluZU5hbWVCeUlkID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LW91dGxpbmUnKS5nZXRPdXRsaW5lTmFtZUJ5SWQsXG4gICAgZ2V0Q3VycmVudE91dGxpbmUgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LW91dGxpbmUnKS5nZXRDdXJyZW50T3V0bGluZTtcblxuXG52YXIgSURzTWFwID0ge1xuICAgIGF0dHJpYnV0ZXM6IFsnZy1zZXR0aW5ncy1wYXJ0aWNsZScsICdnLXNldHRpbmdzLWF0b20nXSxcbiAgICBibG9jazogeyBwYW5lbDogJ2ctc2V0dGluZ3MtYmxvY2stYXR0cmlidXRlcycsIHRhYjogJ2ctc2V0dGluZ3MtYmxvY2snIH0sXG4gICAgcGFydGljbGVzOiAnZy1pbmhlcml0LXBhcnRpY2xlJyxcbiAgICBhdG9tczogJ2ctaW5oZXJpdC1hdG9tJ1xufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgICAgICAgICAgICAgPSAkKCdib2R5JyksXG4gICAgICAgIGN1cnJlbnRTZWxlY3Rpb24gPSB7fSxcbiAgICAgICAgY3VycmVudE1vZGUgICAgICA9IHt9O1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2hhbmdlJywgJ1tuYW1lPVwiaW5oZXJpdFtvdXRsaW5lXVwiXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBsYWJlbCAgICAgICAgICA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCcuc2V0dGluZ3MtcGFyYW0tdGl0bGUnKSxcbiAgICAgICAgICAgIHRleHQgICAgICAgICAgID0gZWxlbWVudC5zaWJsaW5ncygpLmZpbmQoJy5nLWl0ZW0nKSxcbiAgICAgICAgICAgIHZhbHVlICAgICAgICAgID0gZWxlbWVudC52YWx1ZSgpLFxuICAgICAgICAgICAgbmFtZSAgICAgICAgICAgPSAkKCdbbmFtZT1cImluaGVyaXRbc2VjdGlvbl1cIl0nKSA/ICQoJ1tuYW1lPVwiaW5oZXJpdFtzZWN0aW9uXVwiXScpLnZhbHVlKCkgOiAnJyxcbiAgICAgICAgICAgIGZvcm0gICAgICAgICAgID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWctaW5oZXJpdGFuY2Utc2V0dGluZ3NdJyksXG4gICAgICAgICAgICBpbmNsdWRlc0ZpZWxkcyA9ICQoJ1tkYXRhLW11bHRpY2hlY2tib3gtZmllbGQ9XCJpbmhlcml0W2luY2x1ZGVdXCJdOmNoZWNrZWQnKSB8fCBbXSxcbiAgICAgICAgICAgIHBhcnRpY2xlICAgICAgID0ge1xuICAgICAgICAgICAgICAgIGxpc3Q6ICQoJyNnLWluaGVyaXQtcGFydGljbGUsICNnLWluaGVyaXQtYXRvbScpLFxuICAgICAgICAgICAgICAgIG1vZGU6ICQoJ1tuYW1lPVwiaW5oZXJpdFttb2RlXVwiXTpjaGVja2VkJyksXG4gICAgICAgICAgICAgICAgcmFkaW9zOiAkKCdbbmFtZT1cImluaGVyaXRbcGFydGljbGVdXCJdLCBbbmFtZT1cImluaGVyaXRbYXRvbV1cIl0nKSxcbiAgICAgICAgICAgICAgICBjaGVja2VkOiAkKCdbbmFtZT1cImluaGVyaXRbcGFydGljbGVdXCJdOmNoZWNrZWQsIFtuYW1lPVwiaW5oZXJpdFthdG9tXVwiXTpjaGVja2VkJylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgaWYgKCF0ZXh0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdmFyIGhhc0NoYW5nZWQgPSBjdXJyZW50U2VsZWN0aW9uW25hbWVdICE9PSB2YWx1ZSB8fCBjdXJyZW50TW9kZVtuYW1lXSAhPT0gcGFydGljbGUubW9kZS52YWx1ZSgpO1xuXG4gICAgICAgIGlmIChoYXNDaGFuZ2VkICYmICF2YWx1ZSkge1xuICAgICAgICAgICAgaW5jbHVkZXNGaWVsZHMuZm9yRWFjaChmdW5jdGlvbihpbmNsdWRlKSB7XG4gICAgICAgICAgICAgICAgJChpbmNsdWRlKS5jaGVja2VkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBpbmNsdWRlIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZm9ybURhdGEgPSBKU09OLnBhcnNlKGZvcm0uZGF0YSgnZy1pbmhlcml0YW5jZS1zZXR0aW5ncycpKSxcbiAgICAgICAgICAgIGRhdGEgICAgID0ge1xuICAgICAgICAgICAgICAgIG91dGxpbmU6IHZhbHVlIHx8IGdldEN1cnJlbnRPdXRsaW5lKCksXG4gICAgICAgICAgICAgICAgdHlwZTogZm9ybURhdGEudHlwZSB8fCAnJyxcbiAgICAgICAgICAgICAgICBzdWJ0eXBlOiBmb3JtRGF0YS5zdWJ0eXBlIHx8ICcnLFxuICAgICAgICAgICAgICAgIG1vZGU6IHBhcnRpY2xlLm1vZGUudmFsdWUoKSxcbiAgICAgICAgICAgICAgICBpbmhlcml0OiAhIXZhbHVlICYmIHBhcnRpY2xlLm1vZGUudmFsdWUoKSA9PT0gJ2luaGVyaXQnID8gJzEnIDogJzAnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGRhdGEuaWQgPSBmb3JtRGF0YS5pZDtcblxuICAgICAgICBsYWJlbC5zaG93SW5kaWNhdG9yKCk7XG4gICAgICAgIGVsZW1lbnQuc2VsZWN0aXplSW5zdGFuY2UuYmx1cigpO1xuXG4gICAgICAgIGlmIChwYXJ0aWNsZS5yYWRpb3MgJiYgcGFydGljbGUuY2hlY2tlZCkge1xuICAgICAgICAgICAgaWYgKCFoYXNDaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5zZWxlY3RlZCA9IHBhcnRpY2xlLmNoZWNrZWQudmFsdWUoKTtcbiAgICAgICAgICAgICAgICBkYXRhLmlkID0gcGFydGljbGUuY2hlY2tlZC52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLmxpc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBVUklfbW9kZSA9IGRhdGEudHlwZSA9PT0gJ2F0b20nID8gJ2F0b21zJyA6ICdsYXlvdXRzJyxcbiAgICAgICAgICAgIFVSSSAgICAgID0gcGFydGljbGUubGlzdCA/IFVSSV9tb2RlICsgJy9saXN0JyA6IFVSSV9tb2RlO1xuXG4gICAgICAgIHJlcXVlc3QoJ1BPU1QnLCBwYXJzZUFqYXhVUkkoZ2V0QWpheFVSTChVUkkpICsgZ2V0QWpheFN1ZmZpeCgpKSwgZGF0YSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBsYWJlbC5oaWRlSW5kaWNhdG9yKCk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGRhdGEgICAgICA9IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgICAgICAgaW5jbHVkZXMgID0gZm9ybS5maW5kKCdbbmFtZT1cImluaGVyaXRbaW5jbHVkZV1cIl0nKS52YWx1ZSgpLnNwbGl0KCcsJyksXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlID0gZm9ybS5zZWFyY2goJ1tkYXRhLW11bHRpY2hlY2tib3gtZmllbGQ9XCJpbmhlcml0W2luY2x1ZGVdXCJdJykubWFwKGZ1bmN0aW9uKGl0ZW0pIHsgcmV0dXJuICQoaXRlbSkudmFsdWUoKTsgfSksXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gbW9kYWwuZ2V0QnlJRChtb2RhbC5nZXRMYXN0KCkpLFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ7XG5cbiAgICAgICAgICAgIC8vIHJlZnJlc2ggZmllbGQgdmFsdWVzIGJhc2VkIG9uIHNldHRpbmdzIGFuZCBhamF4IHJlc3BvbnNlXG4gICAgICAgICAgICBmb3JFYWNoKElEc01hcCwgZnVuY3Rpb24oaWQsIG9wdGlvbikge1xuICAgICAgICAgICAgICAgIGlkID0gaWQucGFuZWwgfHwgaWQ7XG4gICAgICAgICAgICAgICAgaWQgPSAhaXNBcnJheShpZCkgPyBbaWRdIDogaWQ7XG5cbiAgICAgICAgICAgICAgICBpZC5mb3JFYWNoKGZ1bmN0aW9uKGN1cnJlbnRJRCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdWxkUmVmcmVzaCA9IGNvbnRhaW5zKGluY2x1ZGVzLCBvcHRpb24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBdmFpbGFibGUgICA9IGNvbnRhaW5zKGF2YWlsYWJsZSwgb3B0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKHNob3VsZFJlZnJlc2ggfHwgIWlzQXZhaWxhYmxlKSAmJiBkYXRhLmh0bWxbY3VycmVudElEXSAmJiAoZWxlbWVudCA9IGNvbnRhaW5lci5maW5kKCcjJyArIGN1cnJlbnRJRCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoZGF0YS5odG1sW2N1cnJlbnRJRF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdHMgPSBlbGVtZW50LnNlYXJjaCgnW2RhdGEtc2VsZWN0aXplXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdHMpIHsgc2VsZWN0cy5zZWxlY3RpemUoKTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGhhc0NoYW5nZWQgJiYgaW5jbHVkZXNGaWVsZHMgJiYgY3VycmVudFNlbGVjdGlvbltuYW1lXSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlc0ZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uKGluY2x1ZGUpIHsgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogaW5jbHVkZSB9KTsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnRTZWxlY3Rpb25bbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlW25hbWVdID0gcGFydGljbGUubW9kZS52YWx1ZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICcjZy1zZXR0aW5ncy1pbmhlcml0YW5jZSBbZGF0YS1tdWx0aWNoZWNrYm94LWZpZWxkXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBvdXRsaW5lID0gJCgnW25hbWU9XCJpbmhlcml0W291dGxpbmVdXCJdJyk7XG4gICAgICAgIGlmICghb3V0bGluZSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIG91dGxpbmUgICA9IG91dGxpbmUudmFsdWUoKTtcblxuICAgICAgICB2YXIgdmFsdWUgICAgID0gZWxlbWVudC52YWx1ZSgpLFxuICAgICAgICAgICAgaXNDaGVja2VkID0gZWxlbWVudC5jaGVja2VkKCksXG4gICAgICAgICAgICBub1JlZnJlc2ggPSBldmVudC5ub1JlZnJlc2gsXG4gICAgICAgICAgICBwYXJ0aWNsZSAgPSB7XG4gICAgICAgICAgICAgICAgbW9kZTogJCgnW25hbWU9XCJpbmhlcml0W21vZGVdXCJdOmNoZWNrZWQnKSxcbiAgICAgICAgICAgICAgICByYWRpb3M6ICQoJ1tuYW1lPVwiaW5oZXJpdFtwYXJ0aWNsZV1cIl0sIFtuYW1lPVwiaW5oZXJpdFthdG9tXVwiXScpLFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6ICQoJ1tuYW1lPVwiaW5oZXJpdFtwYXJ0aWNsZV1cIl06Y2hlY2tlZCwgW25hbWU9XCJpbmhlcml0W2F0b21dXCJdOmNoZWNrZWQnKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICB2YXIgSURzID0ge1xuICAgICAgICAgICAgcGFuZWw6IChJRHNNYXBbdmFsdWVdICYmIElEc01hcFt2YWx1ZV0ucGFuZWwgfHwgSURzTWFwW3ZhbHVlXSksXG4gICAgICAgICAgICB0YWI6IChJRHNNYXBbdmFsdWVdICYmIElEc01hcFt2YWx1ZV0udGFiIHx8IElEc01hcFt2YWx1ZV0pXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCFpc0FycmF5KElEcy5wYW5lbCkpIHtcbiAgICAgICAgICAgIElEcy5wYW5lbCA9IFtJRHMucGFuZWxdO1xuICAgICAgICAgICAgSURzLnRhYiA9IFtJRHMudGFiXTtcbiAgICAgICAgfVxuXG4gICAgICAgIElEcy5wYW5lbC5mb3JFYWNoKGZ1bmN0aW9uKGN1cnJlbnRQYW5lbCwgaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBwYW5lbCA9ICQoJyMnICsgY3VycmVudFBhbmVsKSxcbiAgICAgICAgICAgICAgICB0YWIgICA9ICQoJyMnICsgSURzLnRhYltpbmRleF0gKyAnLXRhYicpO1xuXG4gICAgICAgICAgICBpZiAoIXBhbmVsIHx8ICF0YWIpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICAgICAgdmFyIGluaGVyaXQgPSBwYW5lbC5maW5kKCcuZy1pbmhlcml0JyksXG4gICAgICAgICAgICAgICAgaXNDbG9uZSA9IHBhcnRpY2xlLm1vZGUudmFsdWUoKSA9PT0gJ2Nsb25lJyxcbiAgICAgICAgICAgICAgICByZWZyZXNoID0gZnVuY3Rpb24obm9SZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbm9SZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLWJsb2NrJykuZmluZCgnW25hbWU9XCJpbmhlcml0W291dGxpbmVdXCJdJykgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoIWlzQ2hlY2tlZCB8fCAhb3V0bGluZSB8fCBpc0Nsb25lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxvY2sgPSB0YWIuZmluZCgnLmZhLWxvY2snKTtcblxuICAgICAgICAgICAgICAgIGlmIChsb2NrKSB7IGxvY2sucmVtb3ZlQ2xhc3MoJ2ZhLWxvY2snKS5hZGRDbGFzcygnZmEtdW5sb2NrJyk7IH1cbiAgICAgICAgICAgICAgICBpZiAoaW5oZXJpdCkgeyBpbmhlcml0LmhpZGUoKTsgfVxuICAgICAgICAgICAgICAgIGlmIChpc0Nsb25lKSB7IHJlZnJlc2gobm9SZWZyZXNoKTsgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgdW5sb2NrID0gdGFiLmZpbmQoJy5mYS11bmxvY2snKTtcblxuICAgICAgICAgICAgICAgIGlmICh1bmxvY2spIHsgdW5sb2NrLnJlbW92ZUNsYXNzKCdmYS11bmxvY2snKS5hZGRDbGFzcygnZmEtbG9jaycpOyB9XG4gICAgICAgICAgICAgICAgaWYgKGluaGVyaXQpIHsgaW5oZXJpdC5zaG93KCk7IH1cblxuICAgICAgICAgICAgICAgIHJlZnJlc2gobm9SZWZyZXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbbmFtZT1cImluaGVyaXRbbW9kZV1cIl0sIFtuYW1lPVwiaW5oZXJpdFtwYXJ0aWNsZV1cIl0sIFtuYW1lPVwiaW5oZXJpdFthdG9tXVwiXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBjb250YWluZXIgID0gbW9kYWwuZ2V0QnlJRChtb2RhbC5nZXRMYXN0KCkpLFxuICAgICAgICAgICAgb3V0bGluZSAgICA9IGNvbnRhaW5lci5maW5kKCdbbmFtZT1cImluaGVyaXRbb3V0bGluZV1cIl0nKSxcbiAgICAgICAgICAgIGNoZWNrYm94ZXMgPSBjb250YWluZXIuc2VhcmNoKCdbZGF0YS1tdWx0aWNoZWNrYm94LWZpZWxkXScpIHx8IFtdLFxuICAgICAgICAgICAgbm9SZWZyZXNoICA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChlbGVtZW50LmF0dHJpYnV0ZSgnbmFtZScpID09PSAnaW5oZXJpdFttb2RlXScpIHtcbiAgICAgICAgICAgIG5vUmVmcmVzaCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBvdXRsaW5lLCBub1JlZnJlc2g6IG5vUmVmcmVzaCB9KTtcbiAgICAgICAgY2hlY2tib3hlcy5mb3JFYWNoKGZ1bmN0aW9uKGNoZWNrYm94KSB7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBjaGVja2JveCwgbm9SZWZyZXNoOiBub1JlZnJlc2ggfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnI2ctaW5oZXJpdC1wYXJ0aWNsZSAuZmEtaW5mby1jaXJjbGUsICNnLWluaGVyaXQtYXRvbSAuZmEtaW5mby1jaXJjbGUnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciBjb250YWluZXIgPSBtb2RhbC5nZXRCeUlEKG1vZGFsLmdldExhc3QoKSksXG4gICAgICAgICAgICBvdXRsaW5lICAgPSBjb250YWluZXIuZmluZCgnW25hbWU9XCJpbmhlcml0W291dGxpbmVdXCJdJyksXG4gICAgICAgICAgICBpZCAgICAgICAgPSBlbGVtZW50LnNpYmxpbmdzKCdpbnB1dFtuYW1lPVwiaW5oZXJpdFtwYXJ0aWNsZV1cIl0sIGlucHV0W25hbWU9XCJpbmhlcml0W2F0b21dXCJdJyk7XG5cbiAgICAgICAgaWYgKCFpZCB8fCAhb3V0bGluZSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgVVJJID0gaWQubmFtZSgpID09PSAnaW5oZXJpdFthdG9tXScgPyAnYXRvbXMvaW5zdGFuY2UnIDogJ2xheW91dHMvcGFydGljbGUnO1xuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdMb2FkaW5nJyxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YTogeyBpZDogaWQudmFsdWUoKSwgb3V0bGluZTogb3V0bGluZS52YWx1ZSgpIHx8IGdldEN1cnJlbnRPdXRsaW5lKCkgfSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGdldEFqYXhVUkwoVVJJKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwuZW5hYmxlQ2xvc2VCeU92ZXJsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2V1cCcsICcuZy10YWJzIC5mYS1sb2NrLCAuZy10YWJzIC5mYS11bmxvY2snLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoIWVsZW1lbnQucGFyZW50KCdsaScpLmhhc0NsYXNzKCdhY3RpdmUnKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgY29udGFpbmVyID0gbW9kYWwuZ2V0QnlJRChtb2RhbC5nZXRMYXN0KCkpLFxuICAgICAgICAgICAgaXNMb2NrZWQgID0gZWxlbWVudC5oYXNDbGFzcygnZmEtbG9jaycpLFxuICAgICAgICAgICAgaWQgICAgICAgID0gZWxlbWVudC5wYXJlbnQoJ2EnKS5pZCgpLnJlcGxhY2UoL1xcLXRhYiQvLCAnJyksXG4gICAgICAgICAgICBwcm9wICAgICAgPSBrZXlzKGZpbHRlcihJRHNNYXAsIGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZSA9PT0gaWQgfHwgdmFsdWUudGFiID09PSBpZCB8fCBjb250YWlucyh2YWx1ZSwgaWQpOyB9KSB8fCBbXSkuc2hpZnQoKSxcbiAgICAgICAgICAgIGlucHV0ICAgICA9IGNvbnRhaW5lci5maW5kKCdbZGF0YS1tdWx0aWNoZWNrYm94LWZpZWxkXVt2YWx1ZT1cIicgKyBwcm9wICsgJ1wiXScpLFxuICAgICAgICAgICAgcGFydGljbGUgID0ge1xuICAgICAgICAgICAgICAgIG1vZGU6ICQoJ1tuYW1lPVwiaW5oZXJpdFttb2RlXVwiXTpjaGVja2VkJyksXG4gICAgICAgICAgICAgICAgcmFkaW9zOiAkKCdbbmFtZT1cImluaGVyaXRbcGFydGljbGVdXCJdLCBbbmFtZT1cImluaGVyaXRbYXRvbV1cIl0nKSxcbiAgICAgICAgICAgICAgICBjaGVja2VkOiAkKCdbbmFtZT1cImluaGVyaXRbcGFydGljbGVdXCJdOmNoZWNrZWQsIFtuYW1lPVwiaW5oZXJpdFthdG9tXVwiXTpjaGVja2VkJylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAvLyBkbyBub3QgdHJ5IHRvIHJlZnJlc2ggYXR0cmlidXRlcy9ibG9jayBpbmhlcml0YW5jZSB3aGVuIHRoZXJlJ3Mgbm8gcGFydGljbGUgc2VsZWN0ZWRcbiAgICAgICAgICAgIC8vIG9yIGlmIHdlIGFyZSBpbiBjbG9uZSBtb2RlXG4gICAgICAgICAgICBpZiAocGFydGljbGUubW9kZS52YWx1ZSgpID09PSAnY2xvbmUnIHx8IChwYXJ0aWNsZS5yYWRpb3MgJiYgIXBhcnRpY2xlLmNoZWNrZWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbnB1dC5jaGVja2VkKCFpc0xvY2tlZCk7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBpbnB1dCB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICBiaW5kICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgemVuICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG4gICAgQmxvY2tzICAgICA9IHJlcXVpcmUoJy4vYmxvY2tzJyksXG4gICAgRHJhZ0Ryb3AgICA9IHJlcXVpcmUoJy4uL3VpL2RyYWcuZHJvcCcpLFxuICAgIEVyYXNlciAgICAgPSByZXF1aXJlKCcuLi91aS9lcmFzZXInKSxcbiAgICBmbGFncyAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZmxhZ3Mtc3RhdGUnKSxcbiAgICBSZXNpemVyICAgID0gcmVxdWlyZSgnLi9kcmFnLnJlc2l6ZXInKSxcbiAgICBnZXQgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZ2V0JyksXG4gICAga2V5cyAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2tleXMnKSxcblxuICAgIGV2ZXJ5ICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2V2ZXJ5JyksXG4gICAgcHJlY2lzaW9uICA9IHJlcXVpcmUoJ21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24nKSxcbiAgICBpc0FycmF5ICAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzQXJyYXknKSxcbiAgICBkZWVwRXF1YWxzID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKSxcbiAgICBmaW5kICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZpbmQnKSxcbiAgICBpc09iamVjdCAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzT2JqZWN0JyksXG5cbiAgICBjb250YWlucyAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vZm9yRWFjaCcpO1xuXG52YXIgc2luZ2xlcyA9IHtcbiAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGdyaWRzID0gJCgnW2RhdGEtbG0tcm9vdF0gW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXScpO1xuICAgICAgICBpZiAoZ3JpZHMpIHsgZ3JpZHMucmVtb3ZlQ2xhc3MoJ25vLWhvdmVyJyk7IH1cbiAgICB9LFxuICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBncmlkcyA9ICQoJ1tkYXRhLWxtLXJvb3RdIFtkYXRhLWxtLWJsb2NrdHlwZT1cImdyaWRcIl0nKTtcbiAgICAgICAgaWYgKGdyaWRzKSB7IGdyaWRzLmFkZENsYXNzKCduby1ob3ZlcicpOyB9XG4gICAgfSxcbiAgICBjbGVhbnVwOiBmdW5jdGlvbihidWlsZGVyLCBkcm9wTGFzdCwgc3RhcnQpIHtcbiAgICAgICAgdmFyIGVtcHR5R3JpZHMgPSBzdGFydCA/IHN0YXJ0LnNlYXJjaCgnPiAuZy1ncmlkOmVtcHR5JykgOiAkKCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJzZWN0aW9uXCJdID4gLmctZ3JpZDplbXB0eSwgW2RhdGEtbG0tYmxvY2t0eXBlPVwiY29udGFpbmVyXCJdID4gLmctZ3JpZDplbXB0eSwgW2RhdGEtbG0tYmxvY2t0eXBlPVwib2ZmY2FudmFzXCJdID4gLmctZ3JpZDplbXB0eScpO1xuXG4gICAgICAgIGlmIChlbXB0eUdyaWRzKSB7XG4gICAgICAgICAgICBlbXB0eUdyaWRzLmZvckVhY2goZnVuY3Rpb24oZ3JpZCkge1xuICAgICAgICAgICAgICAgIGdyaWQgPSAkKGdyaWQpO1xuICAgICAgICAgICAgICAgIC8vIGVtcHR5IGdyaWRzIHNob3VsZCBnbyBhd2F5IHVubGVzcyB0aGV5IGFyZSBsYXN0IGFuZC9vciBkcm9wTGFzdCBpcyB0cnVlXG4gICAgICAgICAgICAgICAgaWYgKGdyaWQubmV4dFNpYmxpbmcoJ1tkYXRhLWxtLWlkXScpIHx8IGRyb3BMYXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIucmVtb3ZlKGdyaWQuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWQucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn07XG5cbnZhciBMYXlvdXRNYW5hZ2VyID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgb3B0aW9uczoge30sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIHRoaXMucmVmRWxlbWVudCA9IGVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKCFlbGVtZW50IHx8ICEkKGVsZW1lbnQpKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHRoaXMuaW5pdChlbGVtZW50KTtcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AgPSBuZXcgRHJhZ0Ryb3AodGhpcy5yZWZFbGVtZW50LCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLnJlc2l6ZXIgPSBuZXcgUmVzaXplcih0aGlzLnJlZkVsZW1lbnQsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZXJhc2VyID0gbmV3IEVyYXNlcignW2RhdGEtbG0tZXJhc2VibG9ja10nLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLmRyYWdkcm9wXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOnN0YXJ0JywgdGhpcy5ib3VuZCgnc3RhcnQnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6bG9jYXRpb24nLCB0aGlzLmJvdW5kKCdsb2NhdGlvbicpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpub2xvY2F0aW9uJywgdGhpcy5ib3VuZCgnbm9sb2NhdGlvbicpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpyZXNpemUnLCB0aGlzLmJvdW5kKCdyZXNpemUnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcDplcmFzZScsIHRoaXMuYm91bmQoJ3JlbW92ZUVsZW1lbnQnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcCcsIHRoaXMuYm91bmQoJ3N0b3AnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcDphbmltYXRpb24nLCB0aGlzLmJvdW5kKCdzdG9wQW5pbWF0aW9uJykpO1xuXG4gICAgICAgIHRoaXMuYnVpbGRlciA9IHRoaXMub3B0aW9ucy5idWlsZGVyO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLm9wdGlvbnMuaGlzdG9yeTtcbiAgICAgICAgdGhpcy5zYXZlc3RhdGUgPSB0aGlzLm9wdGlvbnMuc2F2ZXN0YXRlIHx8IG51bGw7XG5cbiAgICAgICAgc2luZ2xlcy5kaXNhYmxlKCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMucmVmRWxlbWVudCB8fCAhJCh0aGlzLnJlZkVsZW1lbnQpKSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9LFxuXG4gICAgc2luZ2xlczogZnVuY3Rpb24obW9kZSwgYnVpbGRlciwgZHJvcExhc3QsIHN0YXJ0KSB7XG4gICAgICAgIHNpbmdsZXNbbW9kZV0oYnVpbGRlciwgZHJvcExhc3QsIHN0YXJ0KTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKHBhcmVudCwgb3B0aW9ucykge1xuICAgICAgICB2YXIgdHlwZSwgY2hpbGQsXG4gICAgICAgICAgICBmaWx0ZXIgPSAhcGFyZW50ID8gW10gOiAocGFyZW50LnNlYXJjaCgnW2RhdGEtbG0taWRdJykgfHwgW10pLm1hcChmdW5jdGlvbihlbGVtZW50KSB7IHJldHVybiAkKGVsZW1lbnQpLmRhdGEoJ2xtLWlkJyk7IH0pO1xuXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHsgc2F2ZTogdHJ1ZSwgZHJvcExhc3RHcmlkOiBmYWxzZSwgZW1wdHlJbmhlcml0czogZmFsc2UgfTtcblxuICAgICAgICBmb3JFYWNoKHRoaXMuYnVpbGRlci5tYXAsIGZ1bmN0aW9uKG9iaiwgaWQpIHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXIubGVuZ3RoICYmICFjb250YWlucyhmaWx0ZXIsIGlkKSkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIGlmICghb3B0aW9ucy5lbXB0eUluaGVyaXRzICYmIG9iai5ibG9jay5wYXJlbnQoJy5nLWluaGVyaXRpbmcnKSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdHlwZSA9IG9iai5nZXRUeXBlKCk7XG4gICAgICAgICAgICBjaGlsZCA9IG9iai5ibG9jay5maW5kKCc+IFtkYXRhLWxtLWlkXScpO1xuICAgICAgICAgICAgaWYgKGNoaWxkKSB7IGNoaWxkID0gY2hpbGQuZGF0YSgnbG0tYmxvY2t0eXBlJyk7IH1cbiAgICAgICAgICAgIGlmIChjb250YWlucyhbJ3BhcnRpY2xlJywgJ3NwYWNlcicsICdwb3NpdGlvbicsICd3aWRnZXQnLCAnc3lzdGVtJywgJ2Jsb2NrJ10sIHR5cGUpICYmICh0eXBlID09ICdibG9jaycgJiYgKGNoaWxkICYmIChjaGlsZCAhPT0gJ3NlY3Rpb24nICYmIGNoaWxkICE9PSAnY29udGFpbmVyJykpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRlci5yZW1vdmUoaWQpO1xuICAgICAgICAgICAgICAgIG9iai5ibG9jay5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lbXB0eUluaGVyaXRzICYmICh0eXBlID09ICdzZWN0aW9uJyB8fCB0eXBlID09ICdvZmZjYW52YXMnIHx8IHR5cGUgPT0gJ2NvbnRhaW5lcicpKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5oYXNJbmhlcml0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBvYmouaW5oZXJpdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBvYmouZGlzYWJsZUluaGVyaXRhbmNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICB0aGlzLnNpbmdsZXMoJ2NsZWFudXAnLCB0aGlzLmJ1aWxkZXIsIG9wdGlvbnMuZHJvcExhc3RHcmlkLCBwYXJlbnQpO1xuICAgICAgICBpZiAob3B0aW9ucy5zYXZlKSB7IHRoaXMuaGlzdG9yeS5wdXNoKHRoaXMuYnVpbGRlci5zZXJpYWxpemUoKSwgdGhpcy5oaXN0b3J5LmdldCgpLnByZXNldCk7IH1cbiAgICB9LFxuXG4gICAgdXBkYXRlUGVuZGluZ0NoYW5nZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2F2ZURhdGEgICA9IHRoaXMuc2F2ZXN0YXRlLmdldERhdGEoKSxcbiAgICAgICAgICAgIHNlcmlhbERhdGEgPSB0aGlzLmJ1aWxkZXIuc2VyaWFsaXplKG51bGwsIHRydWUpLFxuICAgICAgICAgICAgZGlmZmVyZW50ICA9IGZhbHNlLFxuXG4gICAgICAgICAgICBlcXVhbHMgICAgID0gZGVlcEVxdWFscyhzYXZlRGF0YSwgc2VyaWFsRGF0YSksXG4gICAgICAgICAgICBzYXZlICAgICAgID0gJCgnW2RhdGEtc2F2ZT1cIkxheW91dFwiXScpLFxuICAgICAgICAgICAgaWNvbiAgICAgICA9IHNhdmUuZmluZCgnaScpLFxuICAgICAgICAgICAgaW5kaWNhdG9yICA9IHNhdmUuZmluZCgnLmNoYW5nZXMtaW5kaWNhdG9yJyk7XG5cbiAgICAgICAgaWYgKGVxdWFscyAmJiBpbmRpY2F0b3IpIHsgc2F2ZS5oaWRlSW5kaWNhdG9yKCk7IH1cbiAgICAgICAgaWYgKCFlcXVhbHMgJiYgIWluZGljYXRvcikgeyBzYXZlLnNob3dJbmRpY2F0b3IoJ2NoYW5nZXMtaW5kaWNhdG9yIGZhIGZhLWZ3IGZhLWNpcmNsZS1vJykgfVxuICAgICAgICBmbGFncy5zZXQoJ3BlbmRpbmcnLCAhZXF1YWxzKTtcblxuICAgICAgICAvLyBFbWl0cyB0aGUgY2hhbmdlZCBldmVudCBmb3IgYWxsIHBhcnRpY2xlc1xuICAgICAgICAvLyBVc2VkIGZvciBVSSB0byBzaG93IHBhcnRpY2xlcyB3aGVyZSB0aGVyZSBoYXZlIGJlZW4gZGlmZmVyZW5jZXMgYXBwbGllZFxuICAgICAgICAvLyBBZnRlciBhIHNhdmVkIHN0YXRlXG4gICAgICAgIHZhciBzYXZlZCwgY3VycmVudCwgaWQ7XG4gICAgICAgIHNlcmlhbERhdGEuZm9yRWFjaChmdW5jdGlvbihibG9jaykge1xuICAgICAgICAgICAgaWQgPSBrZXlzKGJsb2NrKVswXTtcbiAgICAgICAgICAgIHNhdmVkID0gZmluZChzYXZlRGF0YSwgZnVuY3Rpb24oZGF0YSkgeyByZXR1cm4gZGF0YVtpZF07IH0pO1xuICAgICAgICAgICAgY3VycmVudCA9IGZpbmQoc2VyaWFsRGF0YSwgZnVuY3Rpb24oZGF0YSkgeyByZXR1cm4gZGF0YVtpZF07IH0pO1xuICAgICAgICAgICAgZGlmZmVyZW50ID0gIWRlZXBFcXVhbHMoc2F2ZWQsIGN1cnJlbnQpO1xuXG4gICAgICAgICAgICBpZCA9IHRoaXMuYnVpbGRlci5nZXQoaWQpO1xuICAgICAgICAgICAgaWYgKGlkKSB7IGlkLmVtaXQoJ2NoYW5nZWQnLCBkaWZmZXJlbnQpOyB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHJvb3QgPSAkKCdbZGF0YS1sbS1yb290XScpLFxuICAgICAgICAgICAgc2l6ZSA9ICQoZWxlbWVudCkucG9zaXRpb24oKSxcbiAgICAgICAgICAgIGNvb3JkcyA9ICQoZWxlbWVudClbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgdGhpcy5ibG9jayA9IG51bGw7XG4gICAgICAgIHRoaXMubW9kZSA9IHJvb3QuZGF0YSgnbG0tcm9vdCcpIHx8ICdwYWdlJztcblxuICAgICAgICByb290LmFkZENsYXNzKCdtb3ZpbmcnKTtcblxuICAgICAgICB2YXIgdHlwZSAgPSAkKGVsZW1lbnQpLmRhdGEoJ2xtLWJsb2NrdHlwZScpLFxuICAgICAgICAgICAgY2xvbmUgPSBlbGVtZW50WzBdLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICBpZiAoIXRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlciA9IHplbignZGl2LmJsb2NrLnBsYWNlaG9sZGVyW2RhdGEtbG0tcGxhY2Vob2xkZXJdJyk7IH1cbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5zdHlsZSh7IGRpc3BsYXk6ICdub25lJyB9KTtcblxuICAgICAgICBjbG9uZSA9ICQoY2xvbmUpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsID0gY2xvbmUuYWZ0ZXIoZWxlbWVudCkuc3R5bGUoe1xuICAgICAgICAgICAgZGlzcGxheTogY2xvbmUuaGFzQ2xhc3MoJ2ctZ3JpZCcpID8gJ2ZsZXgnIDogJ2Jsb2NrJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDAuNVxuICAgICAgICB9KS5hZGRDbGFzcygnb3JpZ2luYWwtcGxhY2Vob2xkZXInKS5kYXRhKCdsbS1kcm9wem9uZScsIG51bGwpO1xuXG4gICAgICAgIGlmICh0eXBlID09PSAnZ3JpZCcpIHsgdGhpcy5vcmlnaW5hbC5zdHlsZSh7IGRpc3BsYXk6ICdmbGV4JyB9KTsgfVxuXG4gICAgICAgIHRoaXMub3JpZ2luYWxUeXBlID0gdHlwZTtcblxuICAgICAgICB0aGlzLmJsb2NrID0gZ2V0KHRoaXMuYnVpbGRlci5tYXAsIGVsZW1lbnQuZGF0YSgnbG0taWQnKSB8fCAnJykgfHwgbmV3IEJsb2Nrc1t0eXBlXSh7XG4gICAgICAgICAgICAgICAgYnVpbGRlcjogdGhpcy5idWlsZGVyLFxuICAgICAgICAgICAgICAgIHN1YnR5cGU6IGVsZW1lbnQuZGF0YSgnbG0tc3VidHlwZScpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBlbGVtZW50LnRleHQoKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmlzTmV3KCkpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgIHpJbmRleDogMjUwMCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwoc2l6ZS53aWR0aCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwoc2l6ZS5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGNvb3Jkcy5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogY29vcmRzLnRvcFxuICAgICAgICAgICAgfSkuZmluZCgnW2RhdGEtbG0tYmxvY2t0eXBlXScpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5ibG9jay5nZXRUeXBlKCkgPT09ICdncmlkJykge1xuICAgICAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IHRoaXMuYmxvY2suYmxvY2suc2libGluZ3MoJzpub3QoLm9yaWdpbmFsLXBsYWNlaG9sZGVyKTpub3QoLnNlY3Rpb24taGVhZGVyKTpub3QoLmctaW5oZXJpdCk6bm90KDplbXB0eSknKTtcbiAgICAgICAgICAgICAgICBpZiAoc2libGluZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgc2libGluZ3Muc2VhcmNoKCdbZGF0YS1sbS1pZF0nKS5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5lcmFzZXIuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5wb3NpdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMC41XG4gICAgICAgICAgICB9KS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgbGVmdDogY29vcmRzLmxlZnQsXG4gICAgICAgICAgICAgICAgdG9wOiBjb29yZHMudG9wLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBwb3NpdGlvbi53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHBvc2l0aW9uLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmRyYWdkcm9wLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLmVsZW1lbnQgPSB0aGlzLm9yaWdpbmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJsb2NrcztcbiAgICAgICAgaWYgKHR5cGUgPT09ICdncmlkJyAmJiAoYmxvY2tzID0gcm9vdC5zZWFyY2goJ1tkYXRhLWxtLWRyb3B6b25lXTpub3QoW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXSknKSkpIHtcbiAgICAgICAgICAgIGJsb2Nrcy5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNpbmdsZXMuZW5hYmxlKCk7XG4gICAgfSxcblxuICAgIGxvY2F0aW9uOiBmdW5jdGlvbihldmVudCwgbG9jYXRpb24sIHRhcmdldC8qLCBlbGVtZW50Ki8pIHtcbiAgICAgICAgdGFyZ2V0ID0gJCh0YXJnZXQpO1xuICAgICAgICAoIXRoaXMuYmxvY2suaXNOZXcoKSA/IHRoaXMub3JpZ2luYWwgOiB0aGlzLmVsZW1lbnQpLnN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlKDAsIDApJyB9KTtcbiAgICAgICAgaWYgKCF0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIgPSB6ZW4oJ2Rpdi5ibG9jay5wbGFjZWhvbGRlcltkYXRhLWxtLXBsYWNlaG9sZGVyXScpLnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pOyB9XG5cbiAgICAgICAgdmFyIHBvc2l0aW9uLFxuICAgICAgICAgICAgZGF0YVR5cGUgICAgID0gdGFyZ2V0LmRhdGEoJ2xtLWJsb2NrdHlwZScpLFxuICAgICAgICAgICAgb3JpZ2luYWxUeXBlID0gdGhpcy5ibG9jay5nZXRUeXBlKCk7XG5cbiAgICAgICAgaWYgKCFkYXRhVHlwZSAmJiB0YXJnZXQuZGF0YSgnbG0tcm9vdCcpKSB7IGRhdGFUeXBlID0gJ3Jvb3QnOyB9XG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwYWdlJyAmJiBkYXRhVHlwZSA9PT0gJ3NlY3Rpb24nKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoZGF0YVR5cGUgPT09ICdncmlkJyAmJiAodGFyZ2V0LnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSB8fCAodGFyZ2V0LnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09PSAnY29udGFpbmVyJyAmJiB0YXJnZXQucGFyZW50KCkucGFyZW50KCkuZGF0YSgnbG0tcm9vdCcpKSkpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGFkamFjZW50cyBhbmQgYXZvaWQgaW5zZXJ0aW5nIGFueSBwbGFjZWhvbGRlciBzaW5jZSBpdCB3b3VsZCBiZSB0aGUgc2FtZSBwb3NpdGlvblxuICAgICAgICB2YXIgZXhjbHVkZSAgID0gJzpub3QoLnBsYWNlaG9sZGVyKTpub3QoW2RhdGEtbG0taWQ9XCInICsgdGhpcy5vcmlnaW5hbC5kYXRhKCdsbS1pZCcpICsgJ1wiXSknLFxuICAgICAgICAgICAgYWRqYWNlbnRzID0ge1xuICAgICAgICAgICAgICAgIGJlZm9yZTogdGhpcy5vcmlnaW5hbC5wcmV2aW91c1NpYmxpbmdzKGV4Y2x1ZGUpLFxuICAgICAgICAgICAgICAgIGFmdGVyOiB0aGlzLm9yaWdpbmFsLm5leHRTaWJsaW5ncyhleGNsdWRlKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICBpZiAoYWRqYWNlbnRzLmJlZm9yZSkgeyBhZGphY2VudHMuYmVmb3JlID0gJChhZGphY2VudHMuYmVmb3JlWzBdKTsgfVxuICAgICAgICBpZiAoYWRqYWNlbnRzLmFmdGVyKSB7IGFkamFjZW50cy5hZnRlciA9ICQoYWRqYWNlbnRzLmFmdGVyWzBdKTsgfVxuXG4gICAgICAgIGlmIChkYXRhVHlwZSA9PT0gJ2Jsb2NrJyAmJiAoKGFkamFjZW50cy5iZWZvcmUgPT09IHRhcmdldCAmJiBsb2NhdGlvbi54ID09PSAnYWZ0ZXInKSB8fCAoYWRqYWNlbnRzLmFmdGVyID09PSB0YXJnZXQgJiYgbG9jYXRpb24ueCA9PT0gJ2JlZm9yZScpKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhVHlwZSA9PT0gJ2dyaWQnICYmICgoYWRqYWNlbnRzLmJlZm9yZSA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnkgPT09ICdiZWxvdycpIHx8IChhZGphY2VudHMuYWZ0ZXIgPT09IHRhcmdldCAmJiBsb2NhdGlvbi55ID09PSAnYWJvdmUnKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBub25WaXNpYmxlID0gdGFyZ2V0LnBhcmVudCgnW2RhdGEtbG0tYmxvY2t0eXBlPVwiYXRvbXNcIl0nKSxcbiAgICAgICAgICAgIGNoaWxkICAgICAgPSB0aGlzLmJsb2NrLmJsb2NrLmZpbmQoJ1tkYXRhLWxtLWlkXScpO1xuXG4gICAgICAgIGlmICgoY2hpbGQgPyBjaGlsZC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA6IG9yaWdpbmFsVHlwZSkgPT0gJ2F0b20nKSB7XG4gICAgICAgICAgICBpZiAoIW5vblZpc2libGUpIHsgcmV0dXJuOyB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAobm9uVmlzaWJsZSkgeyByZXR1cm47IH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhhbmRsZXMgdGhlIHR5cGVzIGNhc2VzIGFuZCBub3JtYWxpemVzIHRoZSBsb2NhdGlvbnMgKHggYW5kIHkpXG4gICAgICAgIHZhciBncmlkLCBibG9jaywgbWV0aG9kO1xuXG4gICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3Jvb3QnOlxuICAgICAgICAgICAgY2FzZSAnc2VjdGlvbic6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdncmlkJzpcbiAgICAgICAgICAgICAgICB2YXIgZW1wdHkgPSAhdGFyZ2V0LmNoaWxkcmVuKCc6bm90KC5wbGFjZWhvbGRlciknKTtcbiAgICAgICAgICAgICAgICAvLyBuZXcgcGFydGljbGVzIGNhbm5vdCBiZSBkcm9wcGVkIGluIGV4aXN0aW5nIGdyaWRzLCBvbmx5IGVtcHR5IG9uZXNcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxUeXBlICE9PSAnZ3JpZCcgJiYgIWVtcHR5KSB7IHJldHVybjsgfVxuXG5cbiAgICAgICAgICAgICAgICBpZiAoZW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgYXJlIGRyb3BwaW5nIGEgbmV3IHBhcnRpY2xlIGludG8gYW4gZW1wdHkgZ3JpZCwgcGxhY2Vob2xkZXIgZ29lcyBpbnNpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYm90dG9tKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgc29ydGluZyBncmlkcyBvcmRlcmluZywgcGxhY2Vob2xkZXIgZ29lcyBhYm92ZS9iZWxvd1xuICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSAobG9jYXRpb24ueSA9PT0gJ2Fib3ZlJyA/ICdiZWZvcmUnIDogJ2FmdGVyJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbbWV0aG9kXSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYmxvY2snOlxuICAgICAgICAgICAgICAgIG1ldGhvZCA9IChsb2NhdGlvbi55ID09PSAnYWJvdmUnID8gJ3RvcCcgOiAnYm90dG9tJyk7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSAobG9jYXRpb24ueCA9PT0gJ290aGVyJykgPyBtZXRob2QgOiBsb2NhdGlvbi54O1xuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbcG9zaXRpb25dKHRhcmdldCk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGl0J3Mgbm90IGEgYmxvY2sgd2UgZG9uJ3Qgd2FudCBhIHNtYWxsIHZlcnNpb24gb2YgdGhlIHBsYWNlaG9sZGVyXG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlQ2xhc3MoJ2luLWJldHdlZW4nKS5yZW1vdmVDbGFzcygnaW4tYmV0d2Vlbi1ncmlkcycpLnJlbW92ZUNsYXNzKCdpbi1iZXR3ZWVuLWdyaWRzLWZpcnN0JykucmVtb3ZlQ2xhc3MoJ2luLWJldHdlZW4tZ3JpZHMtbGFzdCcpO1xuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ2Jsb2NrJyB9KVtkYXRhVHlwZSAhPT0gJ2Jsb2NrJyA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnaW4tYmV0d2VlbicpO1xuXG4gICAgICAgIGlmIChvcmlnaW5hbFR5cGUgPT09ICdncmlkJyAmJiBkYXRhVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICB2YXIgbmV4dCAgICAgPSB0aGlzLnBsYWNlaG9sZGVyLm5leHRTaWJsaW5nKCksXG4gICAgICAgICAgICAgICAgcHJldmlvdXMgPSB0aGlzLnBsYWNlaG9sZGVyLnByZXZpb3VzU2libGluZygpO1xuXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLmFkZENsYXNzKCdpbi1iZXR3ZWVuLWdyaWRzJyk7XG4gICAgICAgICAgICBpZiAocHJldmlvdXMgJiYgIXByZXZpb3VzLmRhdGEoJ2xtLWJsb2NrdHlwZScpKSB7IHRoaXMucGxhY2Vob2xkZXIuYWRkQ2xhc3MoJ2luLWJldHdlZW4tZ3JpZHMtZmlyc3QnKTsgfVxuICAgICAgICAgICAgaWYgKCFuZXh0IHx8ICFuZXh0LmRhdGEoJ2xtLWJsb2NrdHlwZScpKSB7IHRoaXMucGxhY2Vob2xkZXIuYWRkQ2xhc3MoJ2luLWJldHdlZW4tZ3JpZHMtbGFzdCcpOyB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbm9sb2NhdGlvbjogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgKCF0aGlzLmJsb2NrLmlzTmV3KCkgPyB0aGlzLm9yaWdpbmFsIDogdGhpcy5lbGVtZW50KS5zdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAwKScgfSk7XG4gICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlKCk7IH1cbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkgPyBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGV2ZW50LnRvdWNoZXMuaXRlbSgwKS5jbGllbnRYLCBldmVudC50b3VjaGVzLml0ZW0oMCkuY2xpZW50WSkgOiBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmlzTmV3KCkpIHtcbiAgICAgICAgICAgIHRhcmdldCA9ICQodGFyZ2V0KTtcbiAgICAgICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcyh0aGlzLmVyYXNlci5lbGVtZW50KSB8fCB0aGlzLmVyYXNlci5lbGVtZW50LmZpbmQodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2Ryb3AucmVtb3ZlRWxlbWVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5lcmFzZXIub3ZlcigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdkcm9wLnJlbW92ZUVsZW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmVyYXNlci5vdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50LCBzaWJsaW5ncywgb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMucmVzaXplci5zdGFydChldmVudCwgZWxlbWVudCwgc2libGluZ3MsIG9mZnNldCk7XG4gICAgfSxcblxuICAgIHJlbW92ZUVsZW1lbnQ6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AucmVtb3ZlRWxlbWVudCA9IGZhbHNlO1xuXG4gICAgICAgIHZhciB0cmFuc2l0aW9uID0ge1xuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGVsZW1lbnQuYW5pbWF0ZSh0cmFuc2l0aW9uLCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogJzE1MG1zJ1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyksIGJsb2NrcztcbiAgICAgICAgaWYgKHRoaXMuYmxvY2suZ2V0VHlwZSgpID09PSAnZ3JpZCcgJiYgKGJsb2NrcyA9IHJvb3Quc2VhcmNoKCdbZGF0YS1sbS1kcm9wem9uZV06bm90KFtkYXRhLWxtLWJsb2NrdHlwZT1cImdyaWRcIl0pJykpKSB7XG4gICAgICAgICAgICBibG9ja3Muc3R5bGUoeyAncG9pbnRlci1ldmVudHMnOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2libGluZ3MgPSB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCc6bm90KC5vcmlnaW5hbC1wbGFjZWhvbGRlciknKTtcblxuICAgICAgICBpZiAoc2libGluZ3MgJiYgdGhpcy5ibG9jay5nZXRUeXBlKCkgPT0gJ2Jsb2NrJykge1xuICAgICAgICAgICAgdmFyIHNpemUgICAgICAgICAgICAgICAgICA9IHRoaXMuYmxvY2suZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIGRpZmYgICAgICAgICAgICAgICAgICA9IHNpemUgLyBzaWJsaW5ncy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgbmV3U2l6ZSwgYmxvY2ssIHRvdGFsID0gMCwgbGFzdDtcbiAgICAgICAgICAgIHNpYmxpbmdzLmZvckVhY2goZnVuY3Rpb24oc2libGluZywgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBzaWJsaW5nID0gJChzaWJsaW5nKTtcbiAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCArIDEgPT0gc2libGluZ3MubGVuZ3RoKSB7IGxhc3QgPSBibG9jazsgfVxuICAgICAgICAgICAgICAgIG5ld1NpemUgPSBwcmVjaXNpb24oYmxvY2suZ2V0U2l6ZSgpICsgZGlmZiwgMCk7XG4gICAgICAgICAgICAgICAgdG90YWwgKz0gbmV3U2l6ZTtcbiAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKG5ld1NpemUsIHRydWUpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIC8vIGVuc3VyaW5nIGl0J3MgYWx3YXlzIDEwMCVcbiAgICAgICAgICAgIGlmICh0b3RhbCAhPSAxMDAgJiYgbGFzdCkge1xuICAgICAgICAgICAgICAgIHNpemUgPSBsYXN0LmdldFNpemUoKTtcbiAgICAgICAgICAgICAgICBkaWZmID0gMTAwIC0gdG90YWw7XG4gICAgICAgICAgICAgICAgbGFzdC5zZXRTaXplKHNpemUgKyBkaWZmLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXJhc2VyLmhpZGUoKTtcblxuICAgICAgICB0aGlzLmRyYWdkcm9wLkRSQUdfRVZFTlRTLkVWRU5UUy5NT1ZFLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJCgnYm9keScpLm9mZihldmVudCwgdGhpcy5kcmFnZHJvcC5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub2ZmKGV2ZW50LCB0aGlzLmRyYWdkcm9wLmJvdW5kKCdkZWZlclN0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLmJ1aWxkZXIucmVtb3ZlKHRoaXMuYmxvY2suZ2V0SWQoKSk7XG5cbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5ibG9jay5ibG9jay5zZWFyY2goJ1tkYXRhLWxtLWlkXScpO1xuICAgICAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZGVyLnJlbW92ZSgkKGNoaWxkKS5kYXRhKCdsbS1pZCcpKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ibG9jay5ibG9jay5yZW1vdmUoKTtcblxuICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgeyB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZSgpOyB9XG4gICAgICAgIGlmICh0aGlzLm9yaWdpbmFsKSB7IHRoaXMub3JpZ2luYWwucmVtb3ZlKCk7IH1cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5ibG9jayA9IG51bGw7XG5cbiAgICAgICAgc2luZ2xlcy5kaXNhYmxlKCk7XG4gICAgICAgIHNpbmdsZXMuY2xlYW51cCh0aGlzLmJ1aWxkZXIpO1xuXG4gICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHRoaXMuYnVpbGRlci5zZXJpYWxpemUoKSwgdGhpcy5oaXN0b3J5LmdldCgpLnByZXNldCk7XG4gICAgICAgIHJvb3QucmVtb3ZlQ2xhc3MoJ21vdmluZycpO1xuXG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKGV2ZW50LCB0YXJnZXQvKiwgZWxlbWVudCovKSB7XG4gICAgICAgIC8vIHdlIGFyZSByZW1vdmluZyB0aGUgYmxvY2tcbiAgICAgICAgdmFyIGxhc3RPdmVyZWQgPSAkKHRoaXMuZHJhZ2Ryb3AubGFzdE92ZXJlZCk7XG4gICAgICAgIGlmIChsYXN0T3ZlcmVkICYmIGxhc3RPdmVyZWQubWF0Y2hlcyh0aGlzLmVyYXNlci5lbGVtZW50LmZpbmQoJy50cmFzaC16b25lJykpKSB7XG4gICAgICAgICAgICB0aGlzLmVyYXNlci5oaWRlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5ibG9jay5nZXRUeXBlKCkgPT09ICdncmlkJykge1xuICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gdGhpcy5ibG9jay5ibG9jay5zaWJsaW5ncygnOm5vdCgub3JpZ2luYWwtcGxhY2Vob2xkZXIpOm5vdCguc2VjdGlvbi1oZWFkZXIpOm5vdCguZy1pbmhlcml0KTpub3QoOmVtcHR5KScpO1xuICAgICAgICAgICAgaWYgKHNpYmxpbmdzKSB7XG4gICAgICAgICAgICAgICAgc2libGluZ3Muc2VhcmNoKCdbZGF0YS1sbS1pZF0nKS5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdpbmhlcml0JyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5ibG9jay5pc05ldygpKSB7IHRoaXMuZXJhc2VyLmhpZGUoKTsgfVxuICAgICAgICBpZiAoIXRoaXMuZHJhZ2Ryb3AubWF0Y2hlZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlci5yZW1vdmUoKTsgfVxuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXQgPSAkKHRhcmdldCk7XG5cbiAgICAgICAgdmFyIHdyYXBwZXIsIGluc2lkZXIsXG4gICAgICAgICAgICBtdWx0aUxvY2F0aW9uUmVzaXplID0gZmFsc2UsXG4gICAgICAgICAgICBibG9ja1dhc05ldyAgICAgICAgID0gdGhpcy5ibG9jay5pc05ldygpLFxuICAgICAgICAgICAgdHlwZSAgICAgICAgICAgICAgICA9IHRoaXMuYmxvY2suZ2V0VHlwZSgpLFxuICAgICAgICAgICAgdGFyZ2V0SWQgICAgICAgICAgICA9IHRhcmdldC5kYXRhKCdsbS1pZCcpLFxuICAgICAgICAgICAgdGFyZ2V0VHlwZSAgICAgICAgICA9ICF0YXJnZXRJZCA/IGZhbHNlIDogZ2V0KHRoaXMuYnVpbGRlci5tYXAsIHRhcmdldElkKSA/IGdldCh0aGlzLmJ1aWxkZXIubWFwLCB0YXJnZXRJZCkuZ2V0VHlwZSgpIDogdGFyZ2V0LmRhdGEoJ2xtLWJsb2NrdHlwZScpLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXJQYXJlbnQgICA9IHRoaXMucGxhY2Vob2xkZXIucGFyZW50KCk7XG5cbiAgICAgICAgaWYgKCFwbGFjZWhvbGRlclBhcmVudCkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgcGFyZW50SWQgICA9IHBsYWNlaG9sZGVyUGFyZW50LmRhdGEoJ2xtLWlkJyksXG4gICAgICAgICAgICBwYXJlbnRUeXBlID0gZ2V0KHRoaXMuYnVpbGRlci5tYXAsIHBhcmVudElkIHx8ICcnKSA/IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBwYXJlbnRJZCkuZ2V0VHlwZSgpIDogZmFsc2UsXG4gICAgICAgICAgICByZXNpemVDYXNlID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vcmlnaW5hbC5yZW1vdmUoKTtcblxuICAgICAgICAvLyBjYXNlIDE6IGl0J3MgYSBuZXcgcGFydGljbGUgZHJvcHBlZCBpbiB0aGUgTE0sIHdlIG5lZWQgdG8gd3JhcCBpdCBpbnNpZGUgYSBibG9ja1xuICAgICAgICBpZiAodHlwZSAhPT0gJ2Jsb2NrJyAmJiB0eXBlICE9PSAnZ3JpZCcgJiYgKCh0YXJnZXRUeXBlID09PSAnc2VjdGlvbicgfHwgdGFyZ2V0VHlwZSA9PT0gJ2dyaWQnKSB8fCAodGFyZ2V0VHlwZSA9PT0gJ2Jsb2NrJyAmJiBwYXJlbnRUeXBlICE9PSAnYmxvY2snKSkpIHtcbiAgICAgICAgICAgIHdyYXBwZXIgPSBuZXcgQmxvY2tzLmJsb2NrKHtcbiAgICAgICAgICAgICAgICBidWlsZGVyOiB0aGlzLmJ1aWxkZXJcbiAgICAgICAgICAgIH0pLmFkb3B0KHRoaXMuYmxvY2suYmxvY2spO1xuXG4gICAgICAgICAgICBpbnNpZGVyID0gbmV3IEJsb2Nrc1t0eXBlXSh7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuYmxvY2suYmxvY2suZGF0YSgnbG0taWQnKSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgIHN1YnR5cGU6IHRoaXMuZWxlbWVudC5kYXRhKCdsbS1ibG9ja3N1YnR5cGUnKSxcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5lbGVtZW50LnRleHQoKSxcbiAgICAgICAgICAgICAgICBidWlsZGVyOiB0aGlzLmJ1aWxkZXJcbiAgICAgICAgICAgIH0pLnNldExheW91dCh0aGlzLmJsb2NrLmJsb2NrKTtcblxuICAgICAgICAgICAgd3JhcHBlci5zZXRTaXplKCk7XG5cbiAgICAgICAgICAgIHRoaXMuYmxvY2sgPSB3cmFwcGVyO1xuICAgICAgICAgICAgdGhpcy5idWlsZGVyLmFkZCh3cmFwcGVyKTtcbiAgICAgICAgICAgIHRoaXMuYnVpbGRlci5hZGQoaW5zaWRlcik7XG5cbiAgICAgICAgICAgIGluc2lkZXIuZW1pdCgncmVuZGVyZWQnLCBpbnNpZGVyLCB3cmFwcGVyKTtcbiAgICAgICAgICAgIHdyYXBwZXIuZW1pdCgncmVuZGVyZWQnLCB3cmFwcGVyLCBudWxsKTtcblxuICAgICAgICAgICAgcmVzaXplQ2FzZSA9IHsgY2FzZTogMSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2FzZSAyOiBtb3ZpbmcgYSBibG9jayBhcm91bmQsIG5lZWQgdG8gZml4IHNpemVzIGlmIGl0J3MgYSBtdWx0aSBsb2NhdGlvbiByZXNpemVcbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWxUeXBlID09PSAnYmxvY2snICYmIHRoaXMuYmxvY2suZ2V0VHlwZSgpID09PSAnYmxvY2snKSB7XG4gICAgICAgICAgICByZXNpemVDYXNlID0geyBjYXNlOiAzIH07XG4gICAgICAgICAgICB2YXIgcHJldmlvdXMgICAgICAgICAgICA9IHRoaXMuYmxvY2suYmxvY2sucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdJyksXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJQcmV2aW91cyA9IHRoaXMucGxhY2Vob2xkZXIucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdJyk7XG4gICAgICAgICAgICAvL2lmIChwcmV2aW91cy5maW5kKCchPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0nKSkgeyBwcmV2aW91cyA9IHByZXZpb3VzLnBhcmVudCgpOyB9XG4gICAgICAgICAgICAvL2lmIChwbGFjZWhvbGRlclByZXZpb3VzLmZpbmQoJyE+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpKSB7IHBsYWNlaG9sZGVyUHJldmlvdXMgPSBwbGFjZWhvbGRlclByZXZpb3VzLnBhcmVudCgpOyB9XG4gICAgICAgICAgICBpZiAocGxhY2Vob2xkZXJQcmV2aW91cyAhPT0gcHJldmlvdXMpIHtcbiAgICAgICAgICAgICAgICBtdWx0aUxvY2F0aW9uUmVzaXplID0ge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCc6bm90KC5wbGFjZWhvbGRlciknKSxcbiAgICAgICAgICAgICAgICAgICAgdG86IHRoaXMucGxhY2Vob2xkZXIuc2libGluZ3MoJzpub3QoLnBsYWNlaG9sZGVyKScpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByZXZpb3VzLmZpbmQoJyE+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpKSB7IHByZXZpb3VzID0gcHJldmlvdXMucGFyZW50KCk7IH1cbiAgICAgICAgICAgIHByZXZpb3VzID0gcHJldmlvdXMuc2libGluZ3MoJzpub3QoLm9yaWdpbmFsLXBsYWNlaG9sZGVyKScpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmlzTmV3KCkgJiYgcHJldmlvdXMubGVuZ3RoKSB7IHRoaXMucmVzaXplci5ldmVuUmVzaXplKHByZXZpb3VzKTsgfVxuXG4gICAgICAgICAgICB0aGlzLmJsb2NrLmJsb2NrLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suc2V0U2l6ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdncmlkJyAmJiAhc2libGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBwbHVzID0gdGhpcy5ibG9jay5ibG9jay5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0nKS5maW5kKCcuZmEtcGx1cycpO1xuICAgICAgICAgICAgaWYgKHBsdXMpIHsgcGx1cy5lbWl0KCdjbGljaycpOyB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5ibG9jay5oYXNBdHRyaWJ1dGUoJ3NpemUnKSAmJiB0eXBlb2YgdGhpcy5ibG9jay5nZXRTaXplID09PSAnZnVuY3Rpb24nKSB7IHRoaXMuYmxvY2suc2V0U2l6ZSh0aGlzLnBsYWNlaG9sZGVyLmNvbXB1dGUoJ2ZsZXgnKSk7IH1cblxuICAgICAgICB0aGlzLmJsb2NrLmluc2VydCh0aGlzLnBsYWNlaG9sZGVyKTtcbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5yZW1vdmUoKTtcblxuICAgICAgICBpZiAoYmxvY2tXYXNOZXcpIHtcbiAgICAgICAgICAgIGlmIChyZXNpemVDYXNlKSB7IHRoaXMucmVzaXplci5ldmVuUmVzaXplKCQoW3RoaXMuYmxvY2suYmxvY2ssIHRoaXMuYmxvY2suYmxvY2suc2libGluZ3MoKV0pKTsgfVxuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAobXVsdGlMb2NhdGlvblJlc2l6ZS5mcm9tIHx8IChtdWx0aUxvY2F0aW9uUmVzaXplLnRvICYmIG11bHRpTG9jYXRpb25SZXNpemUudG8gIT0gdGhpcy5ibG9jay5ibG9jaykpIHtcbiAgICAgICAgICAgIC8vIGlmICFmcm9tIC8gIXRvIG1lYW5zIGl0J3MgZW1wdHkgZ3JpZCwgc2hvdWxkIHdlIHJlbW92ZSBpdD9cbiAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5ibG9jay5nZXRTaXplKCksIGRpZmYsIGJsb2NrO1xuXG4gICAgICAgICAgICAvLyB3ZSBhcmUgbW92aW5nIHRoZSBwYXJ0aWNsZSB0byBhbiBlbXB0eSBncmlkLCByZXNldHRpbmcgdGhlIHNpemUgdG8gMTAwJVxuICAgICAgICAgICAgaWYgKCFtdWx0aUxvY2F0aW9uUmVzaXplLnRvKSB7IHRoaXMuYmxvY2suc2V0U2l6ZSgxMDAsIHRydWUpOyB9XG5cbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gY29tcGVuc2F0ZSB0aGUgcmVtYWluaW5nIGJsb2NrcyBvbiB0aGUgRlJPTSB3aXRoIHRoZSBsZWF2aW5nIHBhcnRpY2xlIHNpemVcbiAgICAgICAgICAgIGlmIChtdWx0aUxvY2F0aW9uUmVzaXplLmZyb20pIHtcbiAgICAgICAgICAgICAgICBkaWZmID0gc2l6ZSAvIG11bHRpTG9jYXRpb25SZXNpemUuZnJvbS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwgY3VyU2l6ZTtcbiAgICAgICAgICAgICAgICBtdWx0aUxvY2F0aW9uUmVzaXplLmZyb20uZm9yRWFjaChmdW5jdGlvbihzaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSAkKHNpYmxpbmcpO1xuICAgICAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICBjdXJTaXplID0gYmxvY2suZ2V0U2l6ZSgpICsgZGlmZjtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0U2l6ZShjdXJTaXplLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gY3VyU2l6ZTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmICh0b3RhbCAhPT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSAoMTAwIC0gdG90YWwpIC8gbXVsdGlMb2NhdGlvblJlc2l6ZS5mcm9tLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlMb2NhdGlvblJlc2l6ZS5mcm9tLmZvckVhY2goZnVuY3Rpb24oc2libGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2libGluZyA9ICQoc2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VyU2l6ZSA9IGJsb2NrLmdldFNpemUoKSArIGRpZmY7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKGN1clNpemUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHRoZSBUTyBpcyByZWNlaXZpbmcgYSBuZXcgYmxvY2sgc28gd2UgYXJlIGdvaW5nIHRvIGV2ZW5pemVcbiAgICAgICAgICAgIGlmIChtdWx0aUxvY2F0aW9uUmVzaXplLnRvKSB7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IDEwMCAvIChtdWx0aUxvY2F0aW9uUmVzaXplLnRvLmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgIG11bHRpTG9jYXRpb25SZXNpemUudG8uZm9yRWFjaChmdW5jdGlvbihzaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSAkKHNpYmxpbmcpO1xuICAgICAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKHNpemUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2suc2V0U2l6ZShzaXplLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNpbmdsZXMuZGlzYWJsZSgpO1xuICAgICAgICBzaW5nbGVzLmNsZWFudXAodGhpcy5idWlsZGVyKTtcblxuICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCh0aGlzLmJ1aWxkZXIuc2VyaWFsaXplKCksIHRoaXMuaGlzdG9yeS5nZXQoKS5wcmVzZXQpO1xuICAgIH0sXG5cbiAgICBzdG9wQW5pbWF0aW9uOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciByb290ID0gJCgnW2RhdGEtbG0tcm9vdF0nKTtcbiAgICAgICAgcm9vdC5yZW1vdmVDbGFzcygnbW92aW5nJyk7XG5cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHsgdGhpcy5vcmlnaW5hbC5yZW1vdmUoKTsgfVxuICAgICAgICBzaW5nbGVzLmRpc2FibGUoKTtcblxuICAgICAgICBpZiAoIXRoaXMuYmxvY2spIHsgdGhpcy5ibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBlbGVtZW50LmRhdGEoJ2xtLWlkJykpOyB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrICYmIHRoaXMuYmxvY2suZ2V0VHlwZSgpID09PSAnYmxvY2snKSB7IHRoaXMuYmxvY2suc2V0U2l6ZSgpOyB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrICYmIHRoaXMuYmxvY2suaXNOZXcoKSAmJiB0aGlzLmVsZW1lbnQpIHsgdGhpcy5lbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTsgfVxuXG4gICAgICAgIGlmICh0aGlzLm9yaWdpbmFsVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICB2YXIgYmxvY2tzLCBibG9jaztcbiAgICAgICAgICAgIGlmIChibG9ja3MgPSByb290LnNlYXJjaCgnW2RhdGEtbG0tZHJvcHpvbmVdOm5vdChbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdKScpKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2sgPSBnZXQodGhpcy5idWlsZGVyLm1hcCwgZWxlbWVudC5kYXRhKCdsbS1pZCcpKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLnNldFNpemUoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IExheW91dE1hbmFnZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHJlYWR5ICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkICAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgZGVjb3VwbGUgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9kZWNvdXBsZScpLFxuICAgIHNjcm9sbGJhcldpZHRoID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LXNjcm9sbGJhci13aWR0aCcpO1xuXG52YXIgY29udGFpbmVyLCBzaWRlYmFyLCBzZWFyY2gsIHBhcnRpY2xlcywgaGVpZ2h0LCBoZWlnaHRUb3AsIGhlaWdodEJvdHRvbSwgZXhjbHVkZVRvcCwgZXhjbHVkZUJvdHRvbSxcbiAgICBpbml0aWFsU2lkZWJhckNvb3JkcywgcmVhbFNpZGViYXJUb3A7XG5cbnZhciBpbml0U2l6ZXMgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBmaXhlZCBhbmQgY29udGFpbmVkIHBhcnRpY2xlcyBzaWRlYmFyXG4gICAgY29udGFpbmVyID0gJCgnLnNpZGViYXItYmxvY2snKTtcbiAgICBpZiAoIWNvbnRhaW5lcikgeyByZXR1cm47IH1cblxuICAgIHNpZGViYXIgPSBjb250YWluZXIuZmluZCgnLmc1LWxtLXBhcnRpY2xlcy1waWNrZXInKTtcbiAgICBpZiAoIXNpZGViYXIpIHsgcmV0dXJuOyB9XG5cbiAgICBzZWFyY2ggPSBzaWRlYmFyLmZpbmQoJz4gLnNlYXJjaCcpO1xuICAgIHBhcnRpY2xlcyA9IHNpZGViYXIuZmluZCgnPiAucGFydGljbGVzLWNvbnRhaW5lcicpO1xuICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBoZWlnaHRUb3AgPSAwO1xuICAgIGhlaWdodEJvdHRvbSA9IDA7XG4gICAgaW5pdGlhbFNpZGViYXJDb29yZHMgPSBzaWRlYmFyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJlYWxTaWRlYmFyVG9wID0gc2lkZWJhci5wb3NpdGlvbigpLnRvcDtcbiAgICBleGNsdWRlVG9wID0gJCgnYm9keS5hZG1pbi5jb21fZ2FudHJ5NSBuYXYubmF2YmFyLWZpeGVkLXRvcCwgI3dwYWRtaW5iYXIsICNhZG1pbi1tYWluICN0aXRsZWJhciwgI2FkbWluLW1haW4gLmdyYXYtdXBkYXRlLmdyYXYnKTtcbiAgICBleGNsdWRlQm90dG9tID0gJCgnYm9keS5hZG1pbi5jb21fZ2FudHJ5NSAjc3RhdHVzJyk7XG5cbiAgICBpZiAoZXhjbHVkZVRvcCkge1xuICAgICAgICAkKGV4Y2x1ZGVUb3ApLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgaGVpZ2h0VG9wICs9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZXhjbHVkZUJvdHRvbSkge1xuICAgICAgICAkKGV4Y2x1ZGVCb3R0b20pLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgaGVpZ2h0Qm90dG9tICs9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwYXJ0aWNsZXMuc3R5bGUoe1xuICAgICAgICAnbWF4LWhlaWdodCc6IChoZWlnaHQgLSBoZWlnaHRUb3AgLSBoZWlnaHRCb3R0b20gLSBzZWFyY2hbMF0ub2Zmc2V0SGVpZ2h0IC0gMzApLFxuICAgICAgICBvdmVyZmxvdzogJ2F1dG8nXG4gICAgfSk7XG5cbiAgICBpZiAocGFydGljbGVzWzBdLnNjcm9sbEhlaWdodCAhPSBwYXJ0aWNsZXNbMF0ub2Zmc2V0SGVpZ2h0KSB7XG4gICAgICAgIHBhcnRpY2xlcy5hZGRDbGFzcygnaGFzLXNjcm9sbGJhcicpLnN0eWxlKHsgJ21hcmdpbi1yaWdodCc6IC1zY3JvbGxiYXJXaWR0aCgpIH0pO1xuICAgIH1cbn07XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIGluaXRTaXplcygpO1xuXG4gICAgdmFyIHNjcm9sbEVsZW1lbnQgPSAkKEdBTlRSWV9QTEFURk9STSA9PSAnZ3JhdicgPyAnI2FkbWluLW1haW4gLmNvbnRlbnQtcGFkZGluZycgOiB3aW5kb3cpIHx8IFt3aW5kb3ddLFxuICAgICAgICBzY3JvbGwgICAgICAgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5lciB8fCAhc2lkZWJhcikgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCAgICAgICA9IHRoaXMuc2Nyb2xsWSB8fCB0aGlzLnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICBjb250YWluZXJCb3VuZHMgPSBjb250YWluZXJbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICAgICAgbGltaXQgICAgICAgICAgID0gY29udGFpbmVyQm91bmRzLnRvcCArIGNvbnRhaW5lckJvdW5kcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgc2lkZWJhckNvb3JkcyAgID0gc2lkZWJhclswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgICAgICBzaG91bGRCZUZpeGVkICAgPSAoc2Nyb2xsVG9wID4gKGluaXRpYWxTaWRlYmFyQ29vcmRzLnRvcCAtIGhlaWdodFRvcCAtIDEwKSkgJiYgc2Nyb2xsVG9wID49IHJlYWxTaWRlYmFyVG9wIC0gMTAsXG4gICAgICAgICAgICAgICAgcmVhY2hlZFRoZUxpbWl0ID0gc2lkZWJhckNvb3Jkcy5oZWlnaHQgKyAxMCArIGhlaWdodFRvcCArIHBhcnNlSW50KGNvbnRhaW5lci5jb21wdXRlKCdwYWRkaW5nLWJvdHRvbScpLCAxMCkgPj0gbGltaXQsXG4gICAgICAgICAgICAgICAgc2lkZWJhclRhbGxlclRoYW5Db250YWluZXIgPSBjb250YWluZXJCb3VuZHMuaGVpZ2h0IDw9IHNpZGViYXJDb29yZHMuaGVpZ2h0O1xuXG4gICAgICAgICAgICBzaWRlYmFyLnN0eWxlKCd3aWR0aCcsIHNpZGViYXJDb29yZHMud2lkdGgpO1xuICAgICAgICAgICAgaWYgKHNob3VsZEJlRml4ZWQgJiYgIXJlYWNoZWRUaGVMaW1pdCkge1xuICAgICAgICAgICAgICAgIHNpZGViYXIucmVtb3ZlQ2xhc3MoJ3BhcnRpY2xlcy1hYnNvbHV0ZScpLmFkZENsYXNzKCdwYXJ0aWNsZXMtZml4ZWQnKTtcbiAgICAgICAgICAgICAgICBzaWRlYmFyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBoZWlnaHRUb3AgKyAxMCxcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tOiAnaW5oZXJpdCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvdWxkQmVGaXhlZCAmJiByZWFjaGVkVGhlTGltaXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2lkZWJhclRhbGxlclRoYW5Db250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgc2lkZWJhci5yZW1vdmVDbGFzcygncGFydGljbGVzLWZpeGVkJykuYWRkQ2xhc3MoJ3BhcnRpY2xlcy1hYnNvbHV0ZScpO1xuICAgICAgICAgICAgICAgICAgICBzaWRlYmFyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogJ2luaGVyaXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBwYXJzZUludChjb250YWluZXIuY29tcHV0ZSgncGFkZGluZy1ib3R0b20nKSwgMTApXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2lkZWJhci5yZW1vdmVDbGFzcygncGFydGljbGVzLWZpeGVkJykucmVtb3ZlQ2xhc3MoJ3BhcnRpY2xlcy1hYnNvbHV0ZScpO1xuICAgICAgICAgICAgICAgIHNpZGViYXIuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICB0b3A6ICdpbmhlcml0JyxcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tOiAnaW5oZXJpdCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIGRlY291cGxlKHNjcm9sbEVsZW1lbnRbMF0sICdzY3JvbGwnLCBzY3JvbGwuYmluZChzY3JvbGxFbGVtZW50WzBdKSk7XG5cbiAgICBkZWNvdXBsZSh3aW5kb3csICdyZXNpemUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFwYXJ0aWNsZXMpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgLy8gaW5pdFNpemVzKCk7XG4gICAgICAgIHNjcm9sbC5jYWxsKHNjcm9sbEVsZW1lbnRbMF0pO1xuXG4gICAgICAgIHBhcnRpY2xlcy5zdHlsZSh7XG4gICAgICAgICAgICAnbWF4LWhlaWdodCc6ICh3aW5kb3cuaW5uZXJIZWlnaHQgLSBoZWlnaHRUb3AgLSBoZWlnaHRCb3R0b20gLSBzZWFyY2hbMF0ub2Zmc2V0SGVpZ2h0IC0gMzApXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJCgnYm9keScpLm9uKCdzdGF0ZWNoYW5nZUVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpbml0U2l6ZXMoKTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGluaXRTaXplcztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyICQgICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICByZXF1ZXN0ICAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgdWkgICAgICAgICAgICAgPSByZXF1aXJlKCcuL3VpJyksXG4gICAgaW50ZXJwb2xhdGUgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9pbnRlcnBvbGF0ZScpLFxuICAgIHRyaW0gICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgIHNldFBhcmFtICAgICAgID0gcmVxdWlyZSgnbW91dC9xdWVyeVN0cmluZy9zZXRQYXJhbScpLFxuICAgIG1vZGFsICAgICAgICAgID0gdWkubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICAgPSB1aS50b2FzdHIsXG5cbiAgICBwYXJzZUFqYXhVUkkgICA9IHJlcXVpcmUoJy4vdXRpbHMvZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFVSTCAgICAgPSByZXF1aXJlKCcuL3V0aWxzL2dldC1hamF4LXVybCcpLmdsb2JhbCxcbiAgICBnZXRBamF4U3VmZml4ICA9IHJlcXVpcmUoJy4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4JyksXG5cbiAgICBmbGFncyAgICAgICAgICA9IHJlcXVpcmUoJy4vdXRpbHMvZmxhZ3Mtc3RhdGUnKSxcbiAgICB2YWxpZGF0ZUZpZWxkICA9IHJlcXVpcmUoJy4vdXRpbHMvZmllbGQtdmFsaWRhdGlvbicpLFxuICAgIGxtICAgICAgICAgICAgID0gcmVxdWlyZSgnLi9sbScpLFxuICAgIG1tICAgICAgICAgICAgID0gcmVxdWlyZSgnLi9tZW51JyksXG4gICAgcG0gICAgICAgICAgICAgPSByZXF1aXJlKCcuL3Bvc2l0aW9ucy9jYXJkcycpLFxuICAgIGNvbmZpZ3VyYXRpb25zID0gcmVxdWlyZSgnLi9jb25maWd1cmF0aW9ucycpLFxuICAgIHBvc2l0aW9ucyAgICAgID0gcmVxdWlyZSgnLi9wb3NpdGlvbnMnKSxcbiAgICBjaGFuZ2Vsb2cgICAgICA9IHJlcXVpcmUoJy4vY2hhbmdlbG9nJyksXG4gICAgdHJhbnNsYXRlICAgICAgPSByZXF1aXJlKCcuL3V0aWxzL3RyYW5zbGF0ZScpO1xuXG5yZXF1aXJlKCdlbGVtZW50cy9hdHRyaWJ1dGVzJyk7XG5yZXF1aXJlKCdlbGVtZW50cy9ldmVudHMnKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL2RlbGVnYXRpb24nKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL2luc2VydGlvbicpO1xucmVxdWlyZSgnZWxlbWVudHMvdHJhdmVyc2FsJyk7XG5yZXF1aXJlKCcuL2ZpZWxkcycpO1xucmVxdWlyZSgnLi91aS9wb3BvdmVyJyk7XG5yZXF1aXJlKCcuL3V0aWxzL2FqYXhpZnktbGlua3MnKTtcbnJlcXVpcmUoJy4vdXRpbHMvckFGLXBvbHlmaWxsJyk7XG5cbnZhciBjcmVhdGVIYW5kbGVyID0gZnVuY3Rpb24oZGl2aXNvciwgbm91biwgcmVzdE9mU3RyaW5nKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGRpZmYpIHtcbiAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKGRpZmYgLyBkaXZpc29yKTtcbiAgICAgICAgdmFyIHBsdXJhbGl6ZWROb3VuID0gbm91biArICggbiA+IDEgPyAncycgOiAnJyApO1xuICAgICAgICByZXR1cm4gXCJcIiArIG4gKyBcIiBcIiArIHBsdXJhbGl6ZWROb3VuICsgXCIgXCIgKyByZXN0T2ZTdHJpbmc7XG4gICAgfVxufTtcblxudmFyIGZvcm1hdHRlcnMgPSBbXG4gICAgeyB0aHJlc2hvbGQ6IC0zMTUzNTk5OSwgaGFuZGxlcjogY3JlYXRlSGFuZGxlcigtMzE1MzYwMDAsXHRcInllYXJcIiwgICAgIFwiZnJvbSBub3dcIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IC0yNTkxOTk5LCBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTI1OTIwMDAsICBcdFwibW9udGhcIiwgICAgXCJmcm9tIG5vd1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogLTYwNDc5OSwgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigtNjA0ODAwLCAgIFx0XCJ3ZWVrXCIsICAgICBcImZyb20gbm93XCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAtMTcyNzk5LCAgIGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTg2NDAwLCAgICBcdFwiZGF5XCIsICAgICAgXCJmcm9tIG5vd1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogLTg2Mzk5LCAgIFx0aGFuZGxlcjogZnVuY3Rpb24oKXsgcmV0dXJuICAgICAgXHRcInRvbW9ycm93XCIgfSB9LFxuICAgIHsgdGhyZXNob2xkOiAtMzU5OSwgICAgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKC0zNjAwLCAgICAgXHRcImhvdXJcIiwgICAgIFwiZnJvbSBub3dcIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IC01OSwgICAgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigtNjAsICAgICAgIFx0XCJtaW51dGVcIiwgICBcImZyb20gbm93XCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAtMC45OTk5LCAgIGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTEsXHRcdFx0XCJzZWNvbmRcIiwgICBcImZyb20gbm93XCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAxLCAgICAgICAgXHRoYW5kbGVyOiBmdW5jdGlvbigpeyByZXR1cm4gICAgICBcdFwianVzdCBub3dcIiB9IH0sXG4gICAgeyB0aHJlc2hvbGQ6IDYwLCAgICAgICBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoMSwgICAgICAgIFx0XCJzZWNvbmRcIixcdFwiYWdvXCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAzNjAwLCAgICAgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKDYwLCAgICAgICBcdFwibWludXRlXCIsXHRcImFnb1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogODY0MDAsICAgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigzNjAwLCAgICAgXHRcImhvdXJcIiwgICAgIFwiYWdvXCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAxNzI4MDAsICAgXHRoYW5kbGVyOiBmdW5jdGlvbigpeyByZXR1cm4gICAgICBcdFwieWVzdGVyZGF5XCIgfSB9LFxuICAgIHsgdGhyZXNob2xkOiA2MDQ4MDAsICAgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKDg2NDAwLCAgICBcdFwiZGF5XCIsICAgICAgXCJhZ29cIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IDI1OTIwMDAsICBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoNjA0ODAwLCAgIFx0XCJ3ZWVrXCIsICAgICBcImFnb1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogMzE1MzYwMDAsIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigyNTkyMDAwLCAgXHRcIm1vbnRoXCIsICAgIFwiYWdvXCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiBJbmZpbml0eSwgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKDMxNTM2MDAwLCBcdFwieWVhclwiLCAgICAgXCJhZ29cIiApIH1cbl07XG5cbnZhciBwcmV0dHlEYXRlID0ge1xuICAgIGZvcm1hdDogZnVuY3Rpb24oZGF0ZSkge1xuICAgICAgICB2YXIgZGlmZiA9ICgoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZSgpKSAvIDEwMDApO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1hdHRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChkaWZmIDwgZm9ybWF0dGVyc1tpXS50aHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyc1tpXS5oYW5kbGVyKGRpZmYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImV4aGF1c3RlZCBhbGwgZm9ybWF0dGVyIG9wdGlvbnMsIG5vbmUgZm91bmRcIik7IC8vc2hvdWxkIG5ldmVyIGJlIHJlYWNoZWRcbiAgICB9XG59O1xuXG53aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoZmxhZ3MuZ2V0KCdwZW5kaW5nJykpIHtcbiAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19OT19TQVZFX0RFVEVDVEVEJyk7XG4gICAgfVxufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgICAgID0gJCgnYm9keScpLFxuICAgICAgICBzZW50ZW5jZSA9IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19TQVZFX1NVQ0NFU1MnKTtcblxuICAgIC8vIENsb3NlIG5vdGlmaWNhdGlvblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWctY2xvc2VdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQuZGF0YSgnZy1jbG9zZScpO1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQgPyBlbGVtZW50LnBhcmVudChwYXJlbnQpIDogZWxlbWVudDtcblxuICAgICAgICBwYXJlbnQuc2xpZGVVcChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHBhcmVudC5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBHZW5lcmljIFBvcG92ZXJzXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZy1wb3BvdmVyXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgaWYgKCFlbGVtZW50LlBvcG92ZXJEZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IGVsZW1lbnQuZmluZCgnW2RhdGEtcG9wb3Zlci1jb250ZW50XScpIHx8IGVsZW1lbnQuc2libGluZ3MoJ1tkYXRhLXBvcG92ZXItY29udGVudF0nKSxcbiAgICAgICAgICAgICAgICBwb3BvdmVyID0gZWxlbWVudC5nZXRQb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IGVsZW1lbnQuZGF0YSgnZy1wb3BvdmVyLXN0eWxlJykgfHwgJ2dlbmVyaWMnLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogZWxlbWVudC5kYXRhKCdnLXBvcG92ZXItd2lkdGgnKSB8fCAyMjAsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHplbigndWwnKS5odG1sKGNvbnRlbnQuaHRtbCgpKVswXS5vdXRlckhUTUwsXG4gICAgICAgICAgICAgICAgICAgIGFsbG93RWxlbWVudHNDbGljazogZWxlbWVudC5kYXRhKCdnLXBvcG92ZXItZWxlbWVudHNjbGljaycpIHx8ICcudG9nZ2xlJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWxlbWVudC5vbignc2hvd24ucG9wb3ZlcicsIGZ1bmN0aW9uKHBvcG92ZXIpe1xuICAgICAgICAgICAgICAgIHZhciBlbmFibGVyID0gZWxlbWVudC5maW5kKCcuZW5hYmxlcicpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSkuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIGlmIChlbmFibGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZXJbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbignaGlkZS5wb3BvdmVyJywgZnVuY3Rpb24ocG9wb3Zlcil7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSkuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZ2V0UG9wb3ZlcigpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUGxhdGZvcm0gU2V0dGluZ3MgcmVkaXJlY3RcbiAgICBib2R5LmRlbGVnYXRlKCdtb3VzZWRvd24nLCAnW2RhdGEtc2V0dGluZ3Mta2V5XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBrZXkgPSBlbGVtZW50LmRhdGEoJ3NldHRpbmdzLWtleScpO1xuICAgICAgICBpZiAoIWtleSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIHZhciByZWRpcmVjdCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gsXG4gICAgICAgICAgICBzZXR0aW5ncyA9IGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICB1cmkgICAgICA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/Jyk7XG4gICAgICAgIGlmICh1cmkubGVuZ3RoID4gMSAmJiB1cmlbMF0ubWF0Y2goL2luZGV4LnBocCQvKSkgeyByZWRpcmVjdCA9ICdpbmRleC5waHAnICsgcmVkaXJlY3Q7IH1cblxuICAgICAgICByZWRpcmVjdCA9IHNldFBhcmFtKHNldHRpbmdzLCBrZXksIGJ0b2EocmVkaXJlY3QpKTtcbiAgICAgICAgZWxlbWVudC5ocmVmKHJlZGlyZWN0KTtcbiAgICB9KTtcblxuICAgIC8vIFNhdmUgVG9vbHRpcFxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICcuYnV0dG9uLXNhdmUnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoIWVsZW1lbnQubGFzdFNhdmVkKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIHZhciBmZWVkYmFjayA9IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9MQVNUX1NBVkVEJykgKyAnOiAnICsgcHJldHR5RGF0ZS5mb3JtYXQoZWxlbWVudC5sYXN0U2F2ZWQpO1xuICAgICAgICBlbGVtZW50XG4gICAgICAgICAgICAuZGF0YSgndGlwJywgZmVlZGJhY2spXG4gICAgICAgICAgICAuZGF0YSgndGl0bGUnLCBmZWVkYmFjayk7XG4gICAgfSk7XG5cbiAgICAvLyBTYXZlXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnLmJ1dHRvbi1zYXZlJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgdmFyIHNhdmVzID0gJCgnLmJ1dHRvbi1zYXZlJyk7XG5cbiAgICAgICAgaWYgKHNhdmVzLmRpc2FibGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNhdmVzLmRpc2FibGVkKHRydWUpO1xuICAgICAgICBzYXZlcy5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgIHNhdmVzLnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICB2YXIgZGF0YSAgICA9IHt9LFxuICAgICAgICAgICAgaW52YWxpZCA9IFtdLFxuICAgICAgICAgICAgdHlwZSAgICA9IGVsZW1lbnQuZGF0YSgnc2F2ZScpLFxuICAgICAgICAgICAgZXh0cmFzICA9ICcnLFxuICAgICAgICAgICAgcGFnZSAgICA9ICQoJ1tkYXRhLWxtLXJvb3RdJykgPyAnbGF5b3V0JyA6ICgkKCdbZGF0YS1tbS1pZF0nKSA/ICdtZW51JyA6ICgkKCdbZGF0YS1wb3NpdGlvbl0nKSA/ICdwb3NpdGlvbnMnIDogJ290aGVyJykpLFxuICAgICAgICAgICAgc2F2ZVVSTCA9IHBhcnNlQWpheFVSSSh0cmltKHdpbmRvdy5sb2NhdGlvbi5ocmVmLCAnIycpICsgZ2V0QWpheFN1ZmZpeCgpKTtcblxuICAgICAgICBzd2l0Y2ggKHBhZ2UpIHtcbiAgICAgICAgICAgIGNhc2UgJ2xheW91dCc6XG4gICAgICAgICAgICAgICAgdmFyIHByZXNldCA9ICQoJ1tkYXRhLWxtLXByZXNldF0nKTtcbiAgICAgICAgICAgICAgICBsbS5sYXlvdXRtYW5hZ2VyLnNpbmdsZXMoJ2NsZWFudXAnLCBsbS5idWlsZGVyLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgbG0uc2F2ZXN0YXRlLnNldFNlc3Npb24obG0uYnVpbGRlci5zZXJpYWxpemUobnVsbCwgdHJ1ZSkpO1xuXG4gICAgICAgICAgICAgICAgZGF0YS5wcmVzZXQgPSBwcmVzZXQgJiYgcHJlc2V0LmRhdGEoJ2xtLXByZXNldCcpID8gcHJlc2V0LmRhdGEoJ2xtLXByZXNldCcpIDogJ2RlZmF1bHQnO1xuXG4gICAgICAgICAgICAgICAgdmFyIGxheW91dCA9IEpTT04uc3RyaW5naWZ5KGxtLmJ1aWxkZXIuc2VyaWFsaXplKCkpO1xuXG4gICAgICAgICAgICAgICAgLy8gYmFzZTY0IGVuY29kaW5nIGRvZXNuJ3QgcXVpdGUgd29yayB3aXRoIG1vZF9zZWN1cml0eVxuICAgICAgICAgICAgICAgIC8vIGRhdGEubGF5b3V0ID0gYnRvYSA/IGJ0b2EoZW5jb2RlVVJJQ29tcG9uZW50KGxheW91dCkpIDogbGF5b3V0O1xuXG4gICAgICAgICAgICAgICAgZGF0YS5sYXlvdXQgPSBsYXlvdXQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ21lbnUnOlxuICAgICAgICAgICAgICAgIGRhdGEubWVudXR5cGUgPSAkKCdzZWxlY3QubWVudS1zZWxlY3Qtd3JhcCcpLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgZGF0YS5zZXR0aW5ncyA9IEpTT04uc3RyaW5naWZ5KG1tLm1lbnVtYW5hZ2VyLnNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICBkYXRhLm9yZGVyaW5nID0gSlNPTi5zdHJpbmdpZnkobW0ubWVudW1hbmFnZXIub3JkZXJpbmcpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gSlNPTi5zdHJpbmdpZnkobW0ubWVudW1hbmFnZXIuaXRlbXMpO1xuXG4gICAgICAgICAgICAgICAgLy8gYmFzZTY0IGVuY29kaW5nIGRvZXNuJ3QgcXVpdGUgd29yayB3aXRoIG1vZF9zZWN1cml0eVxuICAgICAgICAgICAgICAgIC8vIGRhdGEuaXRlbXMgPSBidG9hID8gYnRvYShlbmNvZGVVUklDb21wb25lbnQoaXRlbXMpKSA6IGl0ZW1zO1xuXG4gICAgICAgICAgICAgICAgZGF0YS5pdGVtcyA9IGl0ZW1zO1xuXG4gICAgICAgICAgICAgICAgc2F2ZVVSTCA9IHBhcnNlQWpheFVSSShlbGVtZW50LnBhcmVudCgnZm9ybScpLmF0dHJpYnV0ZSgnYWN0aW9uJykgKyBnZXRBamF4U3VmZml4KCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdwb3NpdGlvbnMnOlxuICAgICAgICAgICAgICAgIGRhdGEucG9zaXRpb25zID0gcG0uc2VyaWFsaXplKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ290aGVyJzpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdmFyIGZvcm0gPSBlbGVtZW50LnBhcmVudCgnZm9ybScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZvcm0gJiYgZWxlbWVudC5hdHRyaWJ1dGUoJ3R5cGUnKSA9PSAnc3VibWl0Jykge1xuICAgICAgICAgICAgICAgICAgICAkKGZvcm1bMF0uZWxlbWVudHMpLmZvckVhY2goZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSAgICAgPSBpbnB1dC5hdHRyaWJ1dGUoJ25hbWUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlICAgICA9IGlucHV0LmF0dHJpYnV0ZSgndHlwZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICAgID0gaW5wdXQudmFsdWUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgICA9IGlucHV0LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtLCAuY2FyZC1vdmVycmlkZWFibGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZSA9IHBhcmVudCA/IHBhcmVudC5maW5kKCc+IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXScpIDogbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUgPSBvdmVycmlkZSB8fCAkKGlucHV0LmRhdGEoJ292ZXJyaWRlLXRhcmdldCcpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lIHx8IGlucHV0LmRpc2FibGVkKCkgfHwgKG92ZXJyaWRlICYmICFvdmVycmlkZS5jaGVja2VkKCkpIHx8ICh0eXBlID09ICdyYWRpbycgJiYgIWlucHV0LmNoZWNrZWQoKSkpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRlRmllbGQoaW5wdXQpKSB7IGludmFsaWQucHVzaChpbnB1dCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGludmFsaWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBzYXZlcy5kaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICBzYXZlcy5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICBzYXZlcy5zaG93SW5kaWNhdG9yKCdmYSBmYS1mdyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZScpO1xuICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19SRVZJRVdfRklFTERTJyksIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19JTlZBTElEX0ZJRUxEUycpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWdlID09ICdvdGhlcicpIHsgJCgnLnNldHRpbmdzLXBhcmFtLXRpdGxlLCAuY2FyZC5zZXR0aW5ncy1ibG9jayA+IGg0JykuaGlkZUluZGljYXRvcigpOyB9XG4gICAgICAgIGJvZHkuZW1pdCgndXBkYXRlT3JpZ2luYWxGaWVsZHMnKTtcblxuICAgICAgICByZXF1ZXN0KCdwb3N0Jywgc2F2ZVVSTCwgZGF0YSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnI3N0eWxlcycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4dHJhcyA9ICc8YnIgLz4nICsgKHJlc3BvbnNlLmJvZHkud2FybmluZyA/ICc8aHIgLz4nICsgcmVzcG9uc2UuYm9keS50aXRsZSArICc8YnIgLz4nICsgcmVzcG9uc2UuYm9keS5odG1sIDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0NTU19DT01QSUxFRCcpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0b2FzdHJbcmVzcG9uc2UuYm9keS53YXJuaW5nID8gJ3dhcm5pbmcnIDogJ3N1Y2Nlc3MnXShpbnRlcnBvbGF0ZShzZW50ZW5jZSwge1xuICAgICAgICAgICAgICAgICAgICB2ZXJiOiB0eXBlLnNsaWNlKC0xKSA9PSAncycgPyAnaGF2ZScgOiAnaGFzJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFzOiBleHRyYXNcbiAgICAgICAgICAgICAgICB9KSwgdHlwZSArICcgJyArIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9TQVZFRCcpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2F2ZXMuZGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgc2F2ZXMuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgc2F2ZXMuZm9yRWFjaChmdW5jdGlvbihzYXZlKSB7XG4gICAgICAgICAgICAgICAgJChzYXZlKS5sYXN0U2F2ZWQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChwYWdlID09ICdsYXlvdXQnKSB7IGxtLmxheW91dG1hbmFnZXIudXBkYXRlUGVuZGluZ0NoYW5nZXMoKTsgfVxuXG4gICAgICAgICAgICAvLyBhbGwgZ29vZCwgZGlzYWJsZSAncGVuZGluZycgZmxhZ1xuICAgICAgICAgICAgZmxhZ3Muc2V0KCdwZW5kaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgZmxhZ3MuZW1pdCgndXBkYXRlOnBlbmRpbmcnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBFZGl0YWJsZSB0aXRsZXNcbiAgICBib2R5LmRlbGVnYXRlKCdrZXlkb3duJywgJ1tkYXRhLXRpdGxlLWVkaXRdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGtleSA9IChldmVudC53aGljaCA/IGV2ZW50LndoaWNoIDogZXZlbnQua2V5Q29kZSk7XG4gICAgICAgIGlmIChrZXkgPT0gMzIgfHwga2V5ID09IDEzKSB7IC8vIEFSSUEgc3VwcG9ydDogU3BhY2UgLyBFbnRlciB0b2dnbGVcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2NsaWNrJywgZXZlbnQpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS10aXRsZS1lZGl0XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcygnZGlzYWJsZWQnKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgJHRpdGxlID0gZWxlbWVudC5zaWJsaW5ncygnW2RhdGEtdGl0bGUtZWRpdGFibGVdJykgfHwgZWxlbWVudC5wcmV2aW91c1NpYmxpbmdzKCkuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJykgfHwgZWxlbWVudC5uZXh0U2libGluZ3MoKS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSwgdGl0bGU7XG4gICAgICAgIGlmICghJHRpdGxlKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdGl0bGUgPSAkdGl0bGVbMF07XG4gICAgICAgICR0aXRsZS50ZXh0KHRyaW0oJHRpdGxlLnRleHQoKSkpO1xuXG4gICAgICAgICR0aXRsZS5hdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpO1xuICAgICAgICB0aXRsZS5mb2N1cygpO1xuXG4gICAgICAgIHZhciByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCksIHNlbGVjdGlvbjtcbiAgICAgICAgcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKHRpdGxlKTtcbiAgICAgICAgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XG5cbiAgICAgICAgJHRpdGxlLnN0b3JlZFRpdGxlID0gdHJpbSgkdGl0bGUudGV4dCgpKTtcbiAgICAgICAgJHRpdGxlLnRpdGxlRWRpdENhbmNlbGVkID0gZmFsc2U7XG4gICAgICAgICR0aXRsZS5lbWl0KCd0aXRsZS1lZGl0LXN0YXJ0JywgJHRpdGxlLnN0b3JlZFRpdGxlKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2tleWRvd24nLCAnW2RhdGEtdGl0bGUtZWRpdGFibGVdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSAxMzogLy8gcmV0dXJuXG4gICAgICAgICAgICBjYXNlIDI3OiAvLyBlc2NcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5zdG9yZWRUaXRsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dChlbGVtZW50LnN0b3JlZFRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGl0bGVFZGl0Q2FuY2VsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIG51bGwpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uYmx1cigpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5lbWl0KCd0aXRsZS1lZGl0LWV4aXQnLCBlbGVtZW50LmRhdGEoJ3RpdGxlLWVkaXRhYmxlJyksIGV2ZW50LmtleUNvZGUgPT0gMTMgPyAnZW50ZXInIDogJ2VzYycpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2JsdXInLCAnW2RhdGEtdGl0bGUtZWRpdGFibGVdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnRbMF0uc2Nyb2xsTGVmdCA9IDA7XG4gICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCBudWxsKTtcbiAgICAgICAgZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZScsIHRyaW0oZWxlbWVudC50ZXh0KCkpKTtcbiAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICBlbGVtZW50LmVtaXQoJ3RpdGxlLWVkaXQtZW5kJywgZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZScpLCBlbGVtZW50LnN0b3JlZFRpdGxlLCBlbGVtZW50LnRpdGxlRWRpdENhbmNlbGVkKTtcbiAgICB9LCB0cnVlKTtcblxuICAgIC8vIFF1aWNrIEFqYXggQ2FsbHMgW2RhdGEtYWpheC1hY3Rpb25dXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtYWpheC1hY3Rpb25dJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICB2YXIgaHJlZiAgICAgID0gZWxlbWVudC5hdHRyaWJ1dGUoJ2hyZWYnKSB8fCBlbGVtZW50LmRhdGEoJ2FqYXgtYWN0aW9uJyksXG4gICAgICAgICAgICBtZXRob2QgICAgPSBlbGVtZW50LmRhdGEoJ2FqYXgtYWN0aW9uLW1ldGhvZCcpIHx8ICdwb3N0JyxcbiAgICAgICAgICAgIGluZGljYXRvciA9ICQoZWxlbWVudC5kYXRhKCdhamF4LWFjdGlvbi1pbmRpY2F0b3InKSkgfHwgZWxlbWVudDtcblxuICAgICAgICBpZiAoIWhyZWYpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgaW5kaWNhdG9yLnNob3dJbmRpY2F0b3IoKTtcbiAgICAgICAgcmVxdWVzdChtZXRob2QsIHBhcnNlQWpheFVSSShocmVmICsgZ2V0QWpheFN1ZmZpeCgpKSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpbmRpY2F0b3IuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyW3Jlc3BvbnNlLmJvZHkud2FybmluZyA/ICd3YXJuaW5nJyA6ICdzdWNjZXNzJ10ocmVzcG9uc2UuYm9keS5odG1sIHx8ICdBY3Rpb24gc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZC4nLCByZXNwb25zZS5ib2R5LnRpdGxlIHx8ICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5kaWNhdG9yLmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbn0pO1xuXG52YXIgbW9kdWxlcyA9IHtcbiAgICAvKm1vdXQgICAgOiByZXF1aXJlKCdtb3V0JyksXG4gICAgIHByaW1lICAgOiByZXF1aXJlKCdwcmltZScpLFxuICAgICBcIiRcIiAgICAgOiBlbGVtZW50cyxcbiAgICAgemVuICAgICA6IHplbixcbiAgICAgZG9tcmVhZHk6IGRvbXJlYWR5LFxuICAgICBhZ2VudCAgIDogcmVxdWlyZSgnYWdlbnQnKSwqL1xuICAgIGxtOiBsbSxcbiAgICBtbTogbW0sXG4gICAgYXNzaW5nbWVudHM6IHJlcXVpcmUoJy4vYXNzaWdubWVudHMnKSxcbiAgICB1aTogcmVxdWlyZSgnLi91aScpLFxuICAgIHN0eWxlczogcmVxdWlyZSgnLi9zdHlsZXMnKSxcbiAgICBcIiRcIjogJCxcbiAgICBkb21yZWFkeTogcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICBwYXJ0aWNsZXM6IHJlcXVpcmUoJy4vcGFydGljbGVzJyksXG4gICAgemVuOiByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBtb29meDogcmVxdWlyZSgnbW9vZngnKSxcbiAgICBhdG9tczogcmVxdWlyZSgnLi9wYWdlc2V0dGluZ3MnKSxcbiAgICB0aXBzOiByZXF1aXJlKCcuL3VpL3Rvb2x0aXBzJylcbn07XG5cbndpbmRvdy5HNSA9IG1vZHVsZXM7XG5tb2R1bGUuZXhwb3J0cyA9IG1vZHVsZXM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBEcmFnRXZlbnRzID0gcmVxdWlyZSgnLi4vdWkvZHJhZy5ldmVudHMnKSxcbiAgICBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBFbWl0dGVyICAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIGJpbmQgICAgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBpc1N0cmluZyAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzU3RyaW5nJyksXG4gICAgbk1hcCAgICAgICA9IHJlcXVpcmUoJ21vdXQvbWF0aC9tYXAnKSxcbiAgICBjbGFtcCAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL2NsYW1wJyksXG4gICAgcHJlY2lzaW9uICA9IHJlcXVpcmUoJ21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24nKSxcbiAgICBnZXQgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZ2V0JyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2V2ZW50cycpO1xucmVxdWlyZSgnZWxlbWVudHMvZGVsZWdhdGlvbicpO1xuXG52YXIgUmVzaXplciA9IG5ldyBwcmltZSh7XG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG4gICAgRFJBR19FVkVOVFM6IERyYWdFdmVudHMsXG4gICAgb3B0aW9uczoge1xuICAgICAgICBtaW5TaXplOiA1XG4gICAgfSxcbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zLCBtZW51bWFuYWdlcikge1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IHRoaXMub3B0aW9ucy5oaXN0b3J5IHx8IHt9O1xuICAgICAgICB0aGlzLmJ1aWxkZXIgPSB0aGlzLm9wdGlvbnMuYnVpbGRlciB8fCB7fTtcbiAgICAgICAgdGhpcy5tYXAgPSB0aGlzLmJ1aWxkZXIubWFwO1xuICAgICAgICB0aGlzLm1lbnVtYW5hZ2VyID0gbWVudW1hbmFnZXI7XG4gICAgICAgIHRoaXMub3JpZ2luID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IG51bGwsXG4gICAgICAgICAgICBvZmZzZXQ6IHtcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0QmxvY2s6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldCh0aGlzLm1hcCwgaXNTdHJpbmcoZWxlbWVudCkgPyBlbGVtZW50IDogJChlbGVtZW50KS5kYXRhKCdsbS1pZCcpIHx8ICcnKTtcbiAgICB9LFxuXG4gICAgZ2V0QXR0cmlidXRlOiBmdW5jdGlvbihlbGVtZW50LCBwcm9wKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEJsb2NrKGVsZW1lbnQpLmdldEF0dHJpYnV0ZShwcm9wKTtcbiAgICB9LFxuXG4gICAgZ2V0U2l6ZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQubWF0Y2hlcygnW2RhdGEtbW0taWRdJykgPyBlbGVtZW50IDogZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpLFxuICAgICAgICAgICAgc2l6ZSA9IHBhcmVudC5maW5kKCcucGVyY2VudGFnZSBpbnB1dCcpO1xuXG4gICAgICAgIHJldHVybiBOdW1iZXIoc2l6ZS52YWx1ZSgpKTtcbiAgICB9LFxuXG4gICAgc2V0U2l6ZTogZnVuY3Rpb24oZWxlbWVudCwgc2l6ZSwgYW5pbWF0ZWQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGFuaW1hdGVkID0gdHlwZW9mIGFuaW1hdGVkID09PSAndW5kZWZpbmVkJyA/IGZhbHNlIDogYW5pbWF0ZWQ7XG5cbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQubWF0Y2hlcygnW2RhdGEtbW0taWRdJykgPyBlbGVtZW50IDogZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpLFxuICAgICAgICAgICAgcGMgPSBwYXJlbnQuZmluZCgnLnBlcmNlbnRhZ2UgaW5wdXQnKTtcblxuICAgICAgICBwYXJlbnRbYW5pbWF0ZWQgPyAnYW5pbWF0ZScgOiAnc3R5bGUnXSh7J2ZsZXgnOiAnMCAxICcrc2l6ZSsnJSd9KTtcbiAgICAgICAgcGMudmFsdWUocHJlY2lzaW9uKHNpemUsIDEpKTtcbiAgICB9LFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50LCBzaWJsaW5ncywgb2Zmc2V0KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBpZiAoZXZlbnQud2hpY2ggJiYgZXZlbnQud2hpY2ggIT09IDEpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICAvLyBTdG9wcyB0ZXh0IHNlbGVjdGlvblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoJy5zdWJtZW51LXNlbGVjdG9yJyk7XG4gICAgICAgIGlmICghcGFyZW50KSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHBhcmVudC5hZGRDbGFzcygnbW92aW5nJyk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnNpYmxpbmdzID0ge1xuICAgICAgICAgICAgb2NjdXBpZWQ6IDAsXG4gICAgICAgICAgICBlbGVtZW50czogc2libGluZ3MsXG4gICAgICAgICAgICBuZXh0OiB0aGlzLmVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKS5uZXh0U2libGluZygpLmZpbmQoJz4gLnN1Ym1lbnUtY29sdW1uJyksXG4gICAgICAgICAgICBwcmV2czogdGhpcy5lbGVtZW50LnBhcmVudCgnW2RhdGEtbW0taWRdJykucHJldmlvdXNTaWJsaW5ncygpLFxuICAgICAgICAgICAgc2l6ZUJlZm9yZTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgLT0gdGhpcy5nZXRTaXplKHRoaXMuc2libGluZ3MubmV4dCk7XG4gICAgICAgICAgICB0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oc2libGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zaWJsaW5ncy5wcmV2cykge1xuICAgICAgICAgICAgdGhpcy5zaWJsaW5ncy5wcmV2cy5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpYmxpbmdzLnNpemVCZWZvcmUgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9yaWdpbiA9IHtcbiAgICAgICAgICAgIHNpemU6IHRoaXMuZ2V0U2l6ZSh0aGlzLmVsZW1lbnQpLFxuICAgICAgICAgICAgbWF4U2l6ZTogdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkgKyB0aGlzLmdldFNpemUodGhpcy5zaWJsaW5ncy5uZXh0KSxcbiAgICAgICAgICAgIHg6IGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5wYWdlWCArIDYsXG4gICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVlcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2xpZW50UmVjdCA9IHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIHBhcmVudFJlY3QgPSB0aGlzLmVsZW1lbnQucGFyZW50KClbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0ID0ge1xuICAgICAgICAgICAgY2xpZW50UmVjdDogY2xpZW50UmVjdCxcbiAgICAgICAgICAgIHBhcmVudFJlY3Q6IHtsZWZ0OiBwYXJlbnRSZWN0LmxlZnQsIHJpZ2h0OiBwYXJlbnRSZWN0LnJpZ2h0fSxcbiAgICAgICAgICAgIHg6IHRoaXMub3JpZ2luLnggLSBjbGllbnRSZWN0LnJpZ2h0LFxuICAgICAgICAgICAgeTogY2xpZW50UmVjdC50b3AgLSB0aGlzLm9yaWdpbi55LFxuICAgICAgICAgICAgZG93bjogb2Zmc2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3QubGVmdCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoJy5zdWJtZW51LXNlbGVjdG9yJykuZmluZCgnPiBbZGF0YS1tbS1pZF06Zmlyc3QtY2hpbGQnKVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgICAgICB0aGlzLm9yaWdpbi5vZmZzZXQucGFyZW50UmVjdC5yaWdodCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoJy5zdWJtZW51LXNlbGVjdG9yJykuZmluZCgnPiBbZGF0YS1tbS1pZF06bGFzdC1jaGlsZCcpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0O1xuXG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKGV2ZW50LCB0aGlzLmJvdW5kKCdtb3ZlJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuU1RPUC5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIG1vdmU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIHZhciBjbGllbnRYID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC50b3VjaGVzWzBdLmNsaWVudFggfHwgMCxcbiAgICAgICAgICAgIGNsaWVudFkgPSBldmVudC5jbGllbnRZIHx8IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WSB8fCAwLFxuICAgICAgICAgICAgcGFyZW50UmVjdCA9IHRoaXMub3JpZ2luLm9mZnNldC5wYXJlbnRSZWN0O1xuXG4gICAgICAgIHZhciBkZWx0YVggPSAodGhpcy5sYXN0WCB8fCBjbGllbnRYKSAtIGNsaWVudFgsXG4gICAgICAgICAgICBkZWx0YVkgPSAodGhpcy5sYXN0WSB8fCBjbGllbnRZKSAtIGNsaWVudFk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPVxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYID4gMCAmJiAnbGVmdCcgfHxcbiAgICAgICAgICAgIE1hdGguYWJzKGRlbHRhWCkgPiBNYXRoLmFicyhkZWx0YVkpICYmIGRlbHRhWCA8IDAgJiYgJ3JpZ2h0JyB8fFxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFZKSA+IE1hdGguYWJzKGRlbHRhWCkgJiYgZGVsdGFZID4gMCAmJiAndXAnIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkb3duJztcbiAgICAgICAgdmFyIHNpemUsXG4gICAgICAgICAgICBkaWZmID0gMTAwIC0gdGhpcy5zaWJsaW5ncy5vY2N1cGllZCxcbiAgICAgICAgICAgIHZhbHVlID0gY2xpZW50WCArICghdGhpcy5zaWJsaW5ncy5wcmV2cyA/IHRoaXMub3JpZ2luLm9mZnNldC54IC0gdGhpcy5vcmlnaW4ub2Zmc2V0LmRvd24gOiB0aGlzLnNpYmxpbmdzLnByZXZzLmxlbmd0aCksXG4gICAgICAgICAgICBub3JtYWxpemVkID0gY2xhbXAodmFsdWUsIHBhcmVudFJlY3QubGVmdCwgcGFyZW50UmVjdC5yaWdodCk7XG5cbiAgICAgICAgc2l6ZSA9IG5NYXAobm9ybWFsaXplZCwgcGFyZW50UmVjdC5sZWZ0LCBwYXJlbnRSZWN0LnJpZ2h0LCAwLCAxMDApO1xuICAgICAgICBzaXplID0gc2l6ZSAtIHRoaXMuc2libGluZ3Muc2l6ZUJlZm9yZTtcbiAgICAgICAgc2l6ZSA9IHByZWNpc2lvbihjbGFtcChzaXplLCB0aGlzLm9wdGlvbnMubWluU2l6ZSwgdGhpcy5vcmlnaW4ubWF4U2l6ZSAtIHRoaXMub3B0aW9ucy5taW5TaXplKSwgMCk7XG5cbiAgICAgICAgZGlmZiA9IHByZWNpc2lvbihkaWZmIC0gc2l6ZSwgMCk7XG5cbiAgICAgICAgdGhpcy5zZXRTaXplKHRoaXMuZWxlbWVudCwgc2l6ZSk7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh0aGlzLnNpYmxpbmdzLm5leHQsIGRpZmYpO1xuXG4gICAgICAgIC8vIEhhY2sgdG8gaGFuZGxlIGNhc2VzIHdoZXJlIHNpemUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgdmFyIHNpYmxpbmdzID0gdGhpcy5zaWJsaW5ncy5lbGVtZW50cyxcbiAgICAgICAgICAgIGFtb3VudCA9IHNpYmxpbmdzID8gc2libGluZ3MubGVuZ3RoICsgMSA6IDE7XG4gICAgICAgIGlmIChhbW91bnQgPT0gMyB8fCBhbW91bnQgPT0gNiB8fCBhbW91bnQgPT0gNyB8fCBhbW91bnQgPT0gOCB8fCBhbW91bnQgPT0gOSB8fCBhbW91bnQgPT0gMTEgfHwgYW1vdW50ID09IDEyKSB7XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwLCBibG9ja3M7XG5cbiAgICAgICAgICAgIGJsb2NrcyA9ICQoW3NpYmxpbmdzLCB0aGlzLmVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKV0pO1xuICAgICAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2ssIGluZGV4KXtcbiAgICAgICAgICAgICAgICBibG9jayA9ICQoYmxvY2spO1xuICAgICAgICAgICAgICAgIHNpemUgPSB0aGlzLmdldFNpemUoYmxvY2spO1xuICAgICAgICAgICAgICAgIGlmIChzaXplICUgMSkge1xuICAgICAgICAgICAgICAgICAgICBzaXplID0gcHJlY2lzaW9uKDEwMCAvIGFtb3VudCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2l6ZShibG9jaywgc2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdG90YWwgKz0gc2l6ZTtcblxuICAgICAgICAgICAgICAgIGlmIChibG9ja3MubGVuZ3RoID09IGluZGV4ICsgMSAmJiB0b3RhbCAhPSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IDEwMCAtIHRvdGFsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFNpemUoYmxvY2ssIChzaXplICsgZGlmZikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxhc3RYID0gY2xpZW50WDtcbiAgICAgICAgdGhpcy5sYXN0WSA9IGNsaWVudFk7XG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKS5yZW1vdmVDbGFzcygnbW92aW5nJyk7XG5cbiAgICAgICAgdGhpcy5tZW51bWFuYWdlci5lbWl0KCdkcmFnRW5kJywgdGhpcy5tZW51bWFuYWdlci5tYXAsICdyZXNpemUnKTtcbiAgICAgICAgLy9pZiAodGhpcy5vcmlnaW4uc2l6ZSAhPT0gdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkpIHsgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5idWlsZGVyLnNlcmlhbGl6ZSgpKTsgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVJdGVtU2l6ZXM6IGZ1bmN0aW9uKGVsZW1lbnRzKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmVsZW1lbnQgPyB0aGlzLmVsZW1lbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpIDogbnVsbDtcbiAgICAgICAgaWYgKCFwYXJlbnQgJiYgIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBibG9ja3MgPSBlbGVtZW50cyB8fCBwYXJlbnQuc2VhcmNoKCc+IFtkYXRhLW1tLWlkXScpLFxuICAgICAgICAgICAgc2l6ZXMgPSBbXSxcbiAgICAgICAgICAgIGFjdGl2ZSA9ICQoJy5tZW51LXNlbGVjdG9yIC5hY3RpdmUnKSxcbiAgICAgICAgICAgIHBhdGggPSBhY3RpdmUgPyBhY3RpdmUuZGF0YSgnbW0taWQnKSA6IG51bGw7XG5cbiAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2spe1xuICAgICAgICAgICAgc2l6ZXMucHVzaCh0aGlzLmdldFNpemUoYmxvY2spKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgLy8gdXBkYXRlIGFjdGl2ZSBwYXRoIHdpdGggbmV3IGNvbHVtbnMgc2l6ZXNcbiAgICAgICAgdGhpcy5tZW51bWFuYWdlci5pdGVtc1twYXRoXS5jb2x1bW5zID0gc2l6ZXM7XG5cbiAgICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZXMoZWxlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiBzaXplcztcbiAgICB9LFxuXG4gICAgdXBkYXRlTWF4VmFsdWVzOiBmdW5jdGlvbihlbGVtZW50cykge1xuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5lbGVtZW50ID8gdGhpcy5lbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKSA6IG51bGw7XG4gICAgICAgIGlmICghcGFyZW50ICYmICFlbGVtZW50cykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgYmxvY2tzID0gZWxlbWVudHMgfHwgcGFyZW50LnNlYXJjaCgnPiBbZGF0YS1tbS1pZF0nKSwgc2l6ZXMsIGlucHV0cztcblxuICAgICAgICBibG9ja3MuZm9yRWFjaChmdW5jdGlvbihibG9jayl7XG4gICAgICAgICAgICBibG9jayA9ICQoYmxvY2spO1xuICAgICAgICAgICAgdmFyIHNpYmxpbmcgPSBibG9jay5uZXh0U2libGluZygpIHx8IGJsb2NrLnByZXZpb3VzU2libGluZygpO1xuICAgICAgICAgICAgaWYgKCFzaWJsaW5nKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBpbnB1dHMgPSB7XG4gICAgICAgICAgICAgICAgYmxvY2s6IGJsb2NrLmZpbmQoJ2lucHV0LmNvbHVtbi1wYycpLFxuICAgICAgICAgICAgICAgIHNpYmxpbmc6IHNpYmxpbmcuZmluZCgnaW5wdXQuY29sdW1uLXBjJylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNpemVzID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuZ2V0U2l6ZShibG9jayksXG4gICAgICAgICAgICAgICAgc2libGluZzogdGhpcy5nZXRTaXplKHNpYmxpbmcpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzaXplcy50b3RhbCA9IHNpemVzLmN1cnJlbnQgKyBzaXplcy5zaWJsaW5nO1xuICAgICAgICAgICAgaW5wdXRzLmJsb2NrLmF0dHJpYnV0ZSgnbWF4Jywgc2l6ZXMudG90YWwgLSBOdW1iZXIoaW5wdXRzLmJsb2NrLmF0dHJpYnV0ZSgnbWluJykpKTtcbiAgICAgICAgICAgIGlucHV0cy5zaWJsaW5nLmF0dHJpYnV0ZSgnbWF4Jywgc2l6ZXMudG90YWwgLSBOdW1iZXIoaW5wdXRzLnNpYmxpbmcuYXR0cmlidXRlKCdtaW4nKSkpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgZXZlblJlc2l6ZTogZnVuY3Rpb24oZWxlbWVudHMsIGFuaW1hdGVkKSB7XG4gICAgICAgIHZhciB0b3RhbCA9IGVsZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgIHNpemUgPSBwcmVjaXNpb24oMTAwIC8gdG90YWwsIDQpO1xuXG4gICAgICAgIGVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLnNldFNpemUoZWxlbWVudCwgc2l6ZSwgKHR5cGVvZiBhbmltYXRlZCA9PSAndW5kZWZpbmVkJyA/IGZhbHNlIDogYW5pbWF0ZWQpKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVJdGVtU2l6ZXMoZWxlbWVudHMpO1xuICAgICAgICB0aGlzLm1lbnVtYW5hZ2VyLmVtaXQoJ2RyYWdFbmQnLCB0aGlzLm1lbnVtYW5hZ2VyLm1hcCwgJ2V2ZW5SZXNpemUnKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXNpemVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIFN1Ym1pdCAgICAgICAgPSByZXF1aXJlKCcuLi9maWVsZHMvc3VibWl0JyksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuICAgIGluZGV4T2YgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2luZGV4T2YnKSxcbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgIHBhcnNlQWpheFVSSSAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBmbGFncyAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZmxhZ3Mtc3RhdGUnKSxcbiAgICBkZWVwRXF1YWxzICAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvdHJhbnNsYXRlJyksXG5cbiAgICBDYXJkcyAgICAgICAgID0gcmVxdWlyZSgnLi4vcG9zaXRpb25zL2NhcmRzJyk7IC8vIHJlcXVpcmVkIGZvciBQb3NpdGlvbnNcblxudmFyIFdvcmRwcmVzc1dpZGdldHNDdXN0b21pemVyID0gcmVxdWlyZSgnLi4vdXRpbHMvd3Atd2lkZ2V0cy1jdXN0b21pemVyJyk7XG5cbnZhciBtZW51bWFuYWdlciA9IG51bGw7XG5cbnZhciByYW5kb21JRCA9IGZ1bmN0aW9uIHJhbmRvbVN0cmluZyhsZW4sIGFuKSB7XG4gICAgYW4gPSBhbiAmJiBhbi50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBzdHIgPSBcIlwiLCBpID0gMCwgbWluID0gYW4gPT0gJ2EnID8gMTAgOiAwLCBtYXggPSBhbiA9PSAnbicgPyAxMCA6IDYyO1xuXG4gICAgZm9yICg7IGkrKyA8IGxlbjspIHtcbiAgICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4gPDwgMDtcbiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUociArPSByID4gOSA/IHIgPCAzNiA/IDU1IDogNjEgOiA0OCk7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59O1xuXG52YXIgU3RlcE9uZSA9IGZ1bmN0aW9uKG1hcCwgbW9kZSkgeyAvLyBtb2RlIFtyZW9yZGVyLCByZXNpemUsIGV2ZW5SZXNpemVdXG4gICAgaWYgKHRoaXMuaXNOZXdQYXJ0aWNsZSAmJiBtb2RlICE9PSAncmVvcmRlcicpIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5yZXNpemVyLnVwZGF0ZUl0ZW1TaXplcygpO1xuXG4gICAgbWVudW1hbmFnZXIgPSB0aGlzO1xuXG4gICAgdmFyIHNhdmUgPSAkKCdbZGF0YS1zYXZlXScpLFxuICAgICAgICBjdXJyZW50ID0ge1xuICAgICAgICAgICAgc2V0dGluZ3M6IHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgICBvcmRlcmluZzogdGhpcy5vcmRlcmluZyxcbiAgICAgICAgICAgIGl0ZW1zOiB0aGlzLml0ZW1zXG4gICAgICAgIH07XG5cbiAgICBpZiAoIXRoaXMuaXNOZXdQYXJ0aWNsZSkge1xuICAgICAgICBpZiAoIWRlZXBFcXVhbHMobWFwLCBjdXJyZW50KSkge1xuICAgICAgICAgICAgc2F2ZS5zaG93SW5kaWNhdG9yKCdmYSBmYS1mdyBjaGFuZ2VzLWluZGljYXRvciBmYS1jaXJjbGUtbycpO1xuICAgICAgICAgICAgZmxhZ3Muc2V0KCdwZW5kaW5nJywgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzYXZlLmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgIGZsYWdzLnNldCgncGVuZGluZycsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmlzUGFydGljbGUgJiYgdGhpcy5pc05ld1BhcnRpY2xlKSB7XG4gICAgICAgIHZhciBibG9ja3R5cGUgPSB0aGlzLmJsb2NrLmRhdGEoJ21tLWJsb2NrdHlwZScpO1xuICAgICAgICB0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnZGF0YS1tbS1ibG9ja3R5cGUnLCBudWxsKS5hZGRDbGFzcygnZy1tZW51LWl0ZW0tJyArIGJsb2NrdHlwZSkuZGF0YSgnbW0tb3JpZ2luYWwtdHlwZScsIGJsb2NrdHlwZSk7XG4gICAgICAgIHplbignc3Bhbi5tZW51LWl0ZW0tdHlwZS5iYWRnZScpLnRleHQoYmxvY2t0eXBlKS5hZnRlcih0aGlzLmJsb2NrLmZpbmQoJy5tZW51LWl0ZW0gLnRpdGxlJykpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xPQURJTkcnKSxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgLy9kYXRhOiBkYXRhLFxuICAgICAgICAgICAgcmVtb3RlOiBwYXJzZUFqYXhVUkkoJCh0aGlzLmJsb2NrKS5maW5kKCcuY29uZmlnLWNvZycpLmF0dHJpYnV0ZSgnaHJlZicpICsgZ2V0QWpheFN1ZmZpeCgpKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogZnVuY3Rpb24ocmVzcG9uc2UsIG1vZGFsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaCA9IG1vZGFsLmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnLnNlYXJjaCBpbnB1dCcpLFxuICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBtb2RhbC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnW2RhdGEtbW0tdHlwZV0nKSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVycyA9IG1vZGFsLmVsZW1lbnRzLmNvbnRlbnQuc2VhcmNoKCdbZGF0YS1tbS1maWx0ZXJdJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNlYXJjaCB8fCAhZmlsdGVycyB8fCAhYmxvY2tzKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAgICAgc2VhcmNoLm9uKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmFsdWUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJsb2Nrcy5hZGRDbGFzcygnaGlkZGVuJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gW10sIHZhbHVlID0gdGhpcy52YWx1ZSgpLnRvTG93ZXJDYXNlKCksIHRleHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5mb3JFYWNoKGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gJChmaWx0ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRyaW0oZmlsdGVyLmRhdGEoJ21tLWZpbHRlcicpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQubWF0Y2gobmV3IFJlZ0V4cChcIl5cIiArIHZhbHVlICsgJ3xcXFxccycgKyB2YWx1ZSwgJ2dpJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQucHVzaChmaWx0ZXIubWF0Y2hlcygnW2RhdGEtbW0tdHlwZV0nKSA/IGZpbHRlciA6IGZpbHRlci5wYXJlbnQoJ1tkYXRhLW1tLXR5cGVdJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoKSB7ICQoZm91bmQpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2hbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9LCA1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy50eXBlID0gdW5kZWZpbmVkO1xufTtcblxudmFyIFN0ZXBUd28gPSBmdW5jdGlvbihkYXRhLCBjb250ZW50LCBidXR0b24pIHtcbiAgICB2YXIgdXJpID0gY29udGVudC5maW5kKCdbZGF0YS1tbS1wYXJ0aWNsZS1zdGVwb25lXScpLmRhdGEoJ21tLXBhcnRpY2xlLXN0ZXBvbmUnKSxcbiAgICAgICAgcGlja2VyID0gZGF0YS5pbnN0YW5jZXBpY2tlcixcbiAgICAgICAgbW9kdWxlVHlwZSA9IHtcbiAgICAgICAgICAgIHdvcmRwcmVzczogJ3dpZGdldCcsXG4gICAgICAgICAgICBqb29tbGE6ICdwYXJ0aWNsZSdcbiAgICAgICAgfTtcblxuICAgIGlmIChwaWNrZXIpIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBKU09OLnBhcnNlKGRhdGEuaXRlbSk7XG4gICAgICAgIHBpY2tlciA9IEpTT04ucGFyc2UocGlja2VyKTtcbiAgICAgICAgZGVsZXRlKGRhdGEuaW5zdGFuY2VwaWNrZXIpO1xuICAgICAgICAvL3VyaSA9IGdldEFqYXhVUkwoaXRlbS50eXBlICsgJy8nICsgaXRlbVttb2R1bGVUeXBlW0dBTlRSWV9QTEFURk9STV1dKTtcbiAgICAgICAgdXJpID0gZ2V0QWpheFVSTChpdGVtLnR5cGUgKyAnLycgKyBpdGVtW2l0ZW0udHlwZV0pO1xuICAgIH1cblxuICAgIHJlcXVlc3QoJ3Bvc3QnLCBwYXJzZUFqYXhVUkkodXJpICsgZ2V0QWpheFN1ZmZpeCgpKSwgZGF0YSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYnV0dG9uLmhpZGVJbmRpY2F0b3IoKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGVudC5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCk7XG5cbiAgICAgICAgdmFyIHNlbGVjdHMgPSAkKCdbZGF0YS1zZWxlY3RpemVdJyk7XG4gICAgICAgIGlmIChzZWxlY3RzKSB7IHNlbGVjdHMuc2VsZWN0aXplKCk7IH1cblxuICAgICAgICB2YXIgdXJsVGVtcGxhdGUgPSBjb250ZW50LmZpbmQoJy5nLXVybHRlbXBsYXRlJyk7XG4gICAgICAgIGlmICh1cmxUZW1wbGF0ZSkgeyAkKCdib2R5JykuZW1pdCgnaW5wdXQnLCB7IHRhcmdldDogdXJsVGVtcGxhdGUgfSk7IH1cblxuICAgICAgICB2YXIgZm9ybSA9IGNvbnRlbnQuZmluZCgnZm9ybScpLFxuICAgICAgICAgICAgc3VibWl0ID0gY29udGVudC5maW5kKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdLCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLFxuICAgICAgICAgICAgZmFrZURPTSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpLmZpbmQoJ2Zvcm0nKTtcblxuICAgICAgICBpZiAoKCFmb3JtICYmICFmYWtlRE9NKSB8fCAhc3VibWl0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdmFyIGFwcGx5QW5kU2F2ZSA9IGNvbnRlbnQuc2VhcmNoKCdbZGF0YS1hcHBseS1hbmQtc2F2ZV0nKTtcbiAgICAgICAgaWYgKGFwcGx5QW5kU2F2ZSkgeyBhcHBseUFuZFNhdmUucmVtb3ZlKCk7IH1cblxuICAgICAgICAvLyBNb2R1bGUgLyBQYXJ0aWNsZSBTZXR0aW5ncyBhcHBseVxuICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBzdWJtaXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICB2YXIgcG9zdCA9IFN1Ym1pdChmYWtlRE9NWzBdLmVsZW1lbnRzLCBjb250ZW50LCB7IHN1Ym1pdFVuY2hlY2tlZDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgcmVxdWVzdChmYWtlRE9NLmF0dHJpYnV0ZSgnbWV0aG9kJyksIHBhcnNlQWpheFVSSShmYWtlRE9NLmF0dHJpYnV0ZSgnYWN0aW9uJykgKyBnZXRBamF4U3VmZml4KCkpLCBwb3N0LnZhbGlkLmpvaW4oJyYnKSB8fCB7fSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGl0J3MgbWVudVxuICAgICAgICAgICAgICAgICAgICAvLyBGSVhNRTogdGhpcyBpcyBub3cgaGFuZGxpbmcgYm90aCB0aGUgTWVudSBhbmQgdGhlIFBvc2l0aW9ucyB3aGVuIGluc2VydGluZyBhIG5ldyBQYXJ0aWNsZS4gTmVlZHMgdG8gYmUgc2VwYXJhdGVkXG4gICAgICAgICAgICAgICAgICAgIGlmICghcGlja2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVudW1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYXNlIGZvciBNZW51IE1hbmFnZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IG1lbnVtYW5hZ2VyLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggICAgPSBlbGVtZW50LmRhdGEoJ21tLWlkJykgKyAnLScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgPSByYW5kb21JRCg1KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZSAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1iYXNlXScpLmRhdGEoJ21tLWJhc2UnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sICAgICA9IChlbGVtZW50LnBhcmVudCgnW2RhdGEtbW0taWRdJykuZGF0YSgnbW0taWQnKS5tYXRjaCgvXFxkKyQvKSB8fCBbMF0pWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCAgID0gaW5kZXhPZihlbGVtZW50LnBhcmVudCgpLmNoaWxkcmVuKCdbZGF0YS1tbS1pZF0nKSwgZWxlbWVudFswXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobWVudW1hbmFnZXIuaXRlbXNbcGF0aCArIGlkXSkgeyBpZCA9IHJhbmRvbUlEKDUpOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5pdGVtc1twYXRoICsgaWRdID0gcmVzcG9uc2UuYm9keS5pdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbWVudW1hbmFnZXIub3JkZXJpbmdbYmFzZV0pIG1lbnVtYW5hZ2VyLm9yZGVyaW5nW2Jhc2VdID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtZW51bWFuYWdlci5vcmRlcmluZ1tiYXNlXVtjb2xdKSBtZW51bWFuYWdlci5vcmRlcmluZ1tiYXNlXVtjb2xdID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVudW1hbmFnZXIub3JkZXJpbmdbYmFzZV1bY29sXS5zcGxpY2UoaW5kZXgsIDEsIHBhdGggKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdtbS1pZCcsIHBhdGggKyBpZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuYm9keS5odG1sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVtYW5hZ2VyLmlzTmV3UGFydGljbGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5lbWl0KCdkcmFnRW5kJywgbWVudW1hbmFnZXIubWFwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTUVOVV9TRVRUSU5HU19BUFBMSUVEJyksIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19TRVRUSU5HU19BUFBMSUVEJykpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhc2UgZm9yIFBvc2l0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9ICQoJ1tkYXRhLXBvc2l0aW9uLW5hbWU9XCInICsgcmVzcG9uc2UuYm9keS5wb3NpdGlvbiArICdcIl0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVtbXkgPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5odG1sKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmZpbmQoJz4gdWwnKS5hcHBlbmRDaGlsZChkdW1teS5jaGlsZHJlbigpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhcmRzLnNlcmlhbGl6ZShwb3NpdGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfUE9TSVRJT05TX1NFVFRJTkdTX0FQUExJRUQnKSwgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1NFVFRJTkdTX0FQUExJRUQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGl0J3MgZmllbGQgcGlja2VyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSAkKCdbbmFtZT1cIicgKyBwaWNrZXIuZmllbGQgKyAnXCJdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnRuUGlja2VyID0gZmllbGQuc2libGluZ3MoJ1tkYXRhLWctaW5zdGFuY2VwaWNrZXJdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSBmaWVsZC5zaWJsaW5ncygnLmctaW5zdGFuY2VwaWNrZXItdGl0bGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuYm9keS5pdGVtKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBmaWVsZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYWJlbCkgeyBsYWJlbC50ZXh0KHJlc3BvbnNlLmJvZHkuaXRlbS50aXRsZSk7IH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PSAncGFydGljbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnRuUGlja2VyLnRleHQoYnRuUGlja2VyLmRhdGEoJ2ctaW5zdGFuY2VwaWNrZXItYWx0dGV4dCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgc3VibWl0LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICBXb3JkcHJlc3NXaWRnZXRzQ3VzdG9taXplcihmaWVsZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuXG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnLm1lbnUtZWRpdG9yLWV4dHJhcyBbZGF0YS1sbS1ibG9ja3R5cGVdLCAubWVudS1lZGl0b3ItZXh0cmFzIFtkYXRhLW1tLW1vZHVsZV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5wYXJlbnQoJy5tZW51LWVkaXRvci1leHRyYXMnKSxcbiAgICAgICAgICAgIGVsZW1lbnRzID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtbG0tYmxvY2t0eXBlXSwgW2RhdGEtbW0tbW9kdWxlXScpLFxuICAgICAgICAgICAgc2VsZWN0QnV0dG9uID0gY29udGFpbmVyLmZpbmQoJ1tkYXRhLW1tLXNlbGVjdF0nKTtcblxuICAgICAgICBlbGVtZW50cy5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICBzZWxlY3RCdXR0b24uYXR0cmlidXRlKCdkaXNhYmxlZCcsIG51bGwpO1xuICAgIH0pO1xuXG4gICAgLy8gc2Vjb25kIHN0ZXBcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcubWVudS1lZGl0b3ItZXh0cmFzIFtkYXRhLW1tLXNlbGVjdF0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdkaXNhYmxlZCcpIHx8IGVsZW1lbnQuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LnBhcmVudCgnLm1lbnUtZWRpdG9yLWV4dHJhcycpLFxuICAgICAgICAgICAgc2VsZWN0ZWQgPSBjb250YWluZXIuZmluZCgnW2RhdGEtbG0tYmxvY2t0eXBlXS5zZWxlY3RlZCwgW2RhdGEtbW0tbW9kdWxlXS5zZWxlY3RlZCcpLFxuICAgICAgICAgICAgdHlwZSA9IHNlbGVjdGVkLmRhdGEoJ21tLXR5cGUnKTtcblxuICAgICAgICBkYXRhID0geyB0eXBlOiB0eXBlIH07XG5cbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdwYXJ0aWNsZSc6XG4gICAgICAgICAgICAgICAgZGF0YVsncGFydGljbGUnXSA9IHNlbGVjdGVkLmRhdGEoJ2xtLXN1YnR5cGUnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnd2lkZ2V0JzpcbiAgICAgICAgICAgICAgICBkYXRhWyd3aWRnZXQnXSA9IHNlbGVjdGVkLmRhdGEoJ2xtLXN1YnR5cGUnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnbW9kdWxlJzpcbiAgICAgICAgICAgICAgICBkYXRhWydwYXJ0aWNsZSddID0gdHlwZTtcbiAgICAgICAgICAgICAgICBkYXRhWyd0aXRsZSddID0gc2VsZWN0ZWQuZmluZCgnW2RhdGEtbW0tdGl0bGVdJykuZGF0YSgnbW0tdGl0bGUnKTtcbiAgICAgICAgICAgICAgICBkYXRhWydvcHRpb25zJ10gPSB7IHBhcnRpY2xlOiB7IG1vZHVsZV9pZDogc2VsZWN0ZWQuZGF0YSgnbW0tbW9kdWxlJykgfSB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5zaG93SW5kaWNhdG9yKCk7XG5cblxuICAgICAgICB2YXIgZGF0YSwgaW5zdGFuY2VwaWNrZXIgPSBlbGVtZW50LmRhdGEoJ2ctaW5zdGFuY2VwaWNrZXInKTtcblxuICAgICAgICBpZiAoaW5zdGFuY2VwaWNrZXIgJiYgdHlwZSA9PSAnbW9kdWxlJykge1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoaW5zdGFuY2VwaWNrZXIpO1xuICAgICAgICAgICAgdmFyIGZpZWxkID0gJCgnW25hbWU9XCInICsgZGF0YS5maWVsZCArICdcIl0nKTtcbiAgICAgICAgICAgIGlmIChmaWVsZCkge1xuICAgICAgICAgICAgICAgIGZpZWxkLnZhbHVlKHNlbGVjdGVkLmRhdGEoJ21tLW1vZHVsZScpKTtcbiAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2lucHV0JywgeyB0YXJnZXQ6IGZpZWxkIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpcCA9IGluc3RhbmNlcGlja2VyO1xuICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdnLWluc3RhbmNlcGlja2VyJywgbnVsbCk7XG4gICAgICAgICAgICBTdGVwVHdvKHtcbiAgICAgICAgICAgICAgICBpdGVtOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgICBpbnN0YW5jZXBpY2tlcjogaXAgPyBpcCA6IG51bGxcbiAgICAgICAgICAgIH0sIGVsZW1lbnQucGFyZW50KCcuZzUtY29udGVudCcpLCBlbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gU3RlcE9uZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIE1lbnVNYW5hZ2VyICAgPSByZXF1aXJlKCcuL21lbnVtYW5hZ2VyJyksXG4gICAgU3VibWl0ICAgICAgICA9IHJlcXVpcmUoJy4uL2ZpZWxkcy9zdWJtaXQnKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIGV4dHJhSXRlbXMgICAgPSByZXF1aXJlKCcuL2V4dHJhLWl0ZW1zJyksXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBjbGFtcCAgICAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL2NsYW1wJyksXG4gICAgY29udGFpbnMgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICBpbmRleE9mICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9pbmRleE9mJyksXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnZhciBtZW51bWFuYWdlcjtcblxudmFyIGlzRmlyZWZveCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdmaXJlZm94JykgPiAtMTtcblxudmFyIEZPQ1VTSU4gID0gaXNGaXJlZm94ID8gJ2ZvY3VzJyA6ICdmb2N1c2luJyxcbiAgICBGT0NVU09VVCA9IGlzRmlyZWZveCA/ICdibHVyJyA6ICdmb2N1c291dCc7XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuXG4gICAgbWVudW1hbmFnZXIgPSBuZXcgTWVudU1hbmFnZXIoJ1tkYXRhLW1tLWNvbnRhaW5lcl0nLCB7XG4gICAgICAgIGRlbGVnYXRlOiAnLmc1LW1tLXBhcnRpY2xlcy1waWNrZXIgdWwgbGksICNtZW51LWVkaXRvciA+IHNlY3Rpb24gdWwgbGksIC5zdWJtZW51LWNvbHVtbiwgLnN1Ym1lbnUtY29sdW1uIGxpW2RhdGEtbW0taWRdLCAuY29sdW1uLWNvbnRhaW5lciAuZy1ibG9jaycsXG4gICAgICAgIGRyb3BwYWJsZXM6ICcjbWVudS1lZGl0b3IgW2RhdGEtbW0taWRdJyxcbiAgICAgICAgZXhjbHVkZTogJ1tkYXRhLWxtLW5vZHJhZ10sIC5tZW51LWl0ZW0tYmFjaywgLmZhLWNvZywgLmNvbmZpZy1jb2cnLFxuICAgICAgICByZXNpemVfaGFuZGxlczogJy5zdWJtZW51LWNvbHVtbjpub3QoOmxhc3QtY2hpbGQpJyxcbiAgICAgICAgY2F0Y2hDbGljazogdHJ1ZVxuICAgIH0pO1xuXG5cbiAgICAvLyBIYW5kbGVzIE1vZHVsZXMgLyBQYXJ0aWNsZXMgaXRlbXMgaW4gdGhlIE1lbnVcbiAgICBtZW51bWFuYWdlci5vbignZHJhZ0VuZCcsIGV4dHJhSXRlbXMpO1xuXG4gICAgbW9kdWxlLmV4cG9ydHMubWVudW1hbmFnZXIgPSBtZW51bWFuYWdlcjtcblxuICAgIC8vIE1lbnUgTWFuYWdlclxuICAgIG1lbnVtYW5hZ2VyLnNldFJvb3QoKTtcblxuICAgIC8vIFJlZnJlc2ggb3JkZXJpbmcvaXRlbXMgb24gbWVudSB0eXBlIGNoYW5nZSBvciBNZW51IG5hdmlnYXRpb24gbGlua1xuICAgIGJvZHkuZGVsZWdhdGUoJ3N0YXRlY2hhbmdlQWZ0ZXInLCAnI21haW4taGVhZGVyIFtkYXRhLWc1LWFqYXhpZnldLCBzZWxlY3QubWVudS1zZWxlY3Qtd3JhcCcsIGZ1bmN0aW9uKC8qZXZlbnQsIGVsZW1lbnQqLykge1xuICAgICAgICBtZW51bWFuYWdlci5zZXRSb290KCk7XG4gICAgICAgIG1lbnVtYW5hZ2VyLnJlZnJlc2goKTtcblxuICAgICAgICAvLyByZWZyZXNoIE1NIGVyYXNlclxuICAgICAgICBpZiAobWVudW1hbmFnZXIuZXJhc2VyKSB7XG4gICAgICAgICAgICBtZW51bWFuYWdlci5lcmFzZXIuZWxlbWVudCA9ICQoJ1tkYXRhLW1tLWVyYXNlcGFydGljbGVdJyk7XG4gICAgICAgICAgICBtZW51bWFuYWdlci5lcmFzZXIuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKEZPQ1VTSU4sICcucGVyY2VudGFnZSBpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBlbGVtZW50LmN1cnJlbnRTaXplID0gTnVtYmVyKGVsZW1lbnQudmFsdWUoKSk7XG5cbiAgICAgICAgZWxlbWVudFswXS5mb2N1cygpO1xuICAgICAgICBlbGVtZW50WzBdLnNlbGVjdCgpO1xuICAgIH0sIHRydWUpO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgna2V5ZG93bicsICcucGVyY2VudGFnZSBpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50LyosIGVsZW1lbnQqLykge1xuICAgICAgICBpZiAoY29udGFpbnMoWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXSwgZXZlbnQua2V5Q29kZSkgfHxcbiAgICAgICAgICAgICAgICAvLyBBbGxvdzogW0N0cmx8Q21kXStBIHwgW0N0cmx8Q21kXStSXG4gICAgICAgICAgICAoZXZlbnQua2V5Q29kZSA9PSA2NSAmJiAoZXZlbnQuY3RybEtleSA9PT0gdHJ1ZSB8fCBldmVudC5jdHJsS2V5ID09PSB0cnVlKSkgfHxcbiAgICAgICAgICAgIChldmVudC5rZXlDb2RlID09IDgyICYmIChldmVudC5jdHJsS2V5ID09PSB0cnVlIHx8IGV2ZW50Lm1ldGFLZXkgPT09IHRydWUpKSB8fFxuICAgICAgICAgICAgICAgIC8vIEFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0LCBkb3duLCB1cFxuICAgICAgICAgICAgKGV2ZW50LmtleUNvZGUgPj0gMzUgJiYgZXZlbnQua2V5Q29kZSA8PSA0MCkpIHtcbiAgICAgICAgICAgIC8vIGxldCBpdCBoYXBwZW4sIGRvbid0IGRvIGFueXRoaW5nXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgaXQgaXMgYSBudW1iZXIgYW5kIHN0b3AgdGhlIGtleXByZXNzXG4gICAgICAgIGlmICgoZXZlbnQuc2hpZnRLZXkgfHwgKGV2ZW50LmtleUNvZGUgPCA0OCB8fCBldmVudC5rZXlDb2RlID4gNTcpKSAmJiAoZXZlbnQua2V5Q29kZSA8IDk2IHx8IGV2ZW50LmtleUNvZGUgPiAxMDUpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdrZXlkb3duJywgJy5wZXJjZW50YWdlIGlucHV0JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB2YWx1ZSAgPSBOdW1iZXIoZWxlbWVudC52YWx1ZSgpKSxcbiAgICAgICAgICAgIG1pbiAgICA9IE51bWJlcihlbGVtZW50LmF0dHJpYnV0ZSgnbWluJykpLFxuICAgICAgICAgICAgbWF4ICAgID0gTnVtYmVyKGVsZW1lbnQuYXR0cmlidXRlKCdtYXgnKSksXG4gICAgICAgICAgICB1cERvd24gPSBldmVudC5rZXlDb2RlID09IDM4IHx8IGV2ZW50LmtleUNvZGUgPT0gNDA7XG5cbiAgICAgICAgaWYgKHVwRG93bikge1xuICAgICAgICAgICAgdmFsdWUgKz0gZXZlbnQua2V5Q29kZSA9PSAzOCA/ICsxIDogLTE7XG4gICAgICAgICAgICB2YWx1ZSA9IGNsYW1wKHZhbHVlLCBtaW4sIG1heCk7XG4gICAgICAgICAgICBlbGVtZW50LnZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgna2V5dXAnLCB7IHRhcmdldDogZWxlbWVudCB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgna2V5dXAnLCAnLnBlcmNlbnRhZ2UgaW5wdXQnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHZhbHVlID0gTnVtYmVyKGVsZW1lbnQudmFsdWUoKSksXG4gICAgICAgICAgICBtaW4gICA9IE51bWJlcihlbGVtZW50LmF0dHJpYnV0ZSgnbWluJykpLFxuICAgICAgICAgICAgbWF4ICAgPSBOdW1iZXIoZWxlbWVudC5hdHRyaWJ1dGUoJ21heCcpKTtcblxuICAgICAgICB2YXIgcmVzaXplciA9IG1lbnVtYW5hZ2VyLnJlc2l6ZXIsXG4gICAgICAgICAgICBwYXJlbnQgID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpLFxuICAgICAgICAgICAgc2libGluZyA9IHBhcmVudC5uZXh0U2libGluZygnW2RhdGEtbW0taWRdJykgfHwgcGFyZW50LnByZXZpb3VzU2libGluZygnW2RhdGEtbW0taWRdJyk7XG5cbiAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA8IG1pbiB8fCB2YWx1ZSA+IG1heCkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgc2l6ZXMgPSB7XG4gICAgICAgICAgICBjdXJyZW50OiBOdW1iZXIoZWxlbWVudC5jdXJyZW50U2l6ZSksXG4gICAgICAgICAgICBzaWJsaW5nOiBOdW1iZXIocmVzaXplci5nZXRTaXplKHNpYmxpbmcpKVxuICAgICAgICB9O1xuXG4gICAgICAgIGVsZW1lbnQuY3VycmVudFNpemUgPSB2YWx1ZTtcblxuICAgICAgICBzaXplcy50b3RhbCA9IHNpemVzLmN1cnJlbnQgKyBzaXplcy5zaWJsaW5nO1xuICAgICAgICBzaXplcy5kaWZmID0gc2l6ZXMudG90YWwgLSB2YWx1ZTtcblxuICAgICAgICByZXNpemVyLnNldFNpemUocGFyZW50LCB2YWx1ZSk7XG4gICAgICAgIHJlc2l6ZXIuc2V0U2l6ZShzaWJsaW5nLCBzaXplcy5kaWZmKTtcblxuICAgICAgICBtZW51bWFuYWdlci5yZXNpemVyLnVwZGF0ZUl0ZW1TaXplcyhwYXJlbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpLnNlYXJjaCgnPiBbZGF0YS1tbS1pZF0nKSk7XG4gICAgICAgIG1lbnVtYW5hZ2VyLmVtaXQoJ2RyYWdFbmQnLCBtZW51bWFuYWdlci5tYXAsICdpbnB1dENoYW5nZScpO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZShGT0NVU09VVCwgJy5wZXJjZW50YWdlIGlucHV0JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihlbGVtZW50LnZhbHVlKCkpO1xuICAgICAgICBpZiAodmFsdWUgPCBOdW1iZXIoZWxlbWVudC5hdHRyaWJ1dGUoJ21pbicpKSB8fCB2YWx1ZSA+IE51bWJlcihlbGVtZW50LmF0dHJpYnV0ZSgnbWF4JykpKSB7XG4gICAgICAgICAgICBlbGVtZW50LnZhbHVlKGVsZW1lbnQuY3VycmVudFNpemUpO1xuICAgICAgICB9XG4gICAgfSwgdHJ1ZSk7XG5cbiAgICAvLyBBZGQgbmV3IGNvbHVtbnNcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcuYWRkLWNvbHVtbicsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtZzUtbWVudS1jb2x1bW5zXScpLmZpbmQoJy5zdWJtZW51LXNlbGVjdG9yJyksXG4gICAgICAgICAgICBjaGlsZHJlbiAgPSBjb250YWluZXIuY2hpbGRyZW4oKSxcbiAgICAgICAgICAgIGxhc3QgICAgICA9IGNvbnRhaW5lci5maW5kKCc+IDpsYXN0LWNoaWxkJyksXG4gICAgICAgICAgICBjb3VudCAgICAgPSBjaGlsZHJlbiA/IGNoaWxkcmVuLmxlbmd0aCA6IDAsXG4gICAgICAgICAgICBhY3RpdmUgICAgPSAkKCcubWVudS1zZWxlY3RvciAuYWN0aXZlJyksXG4gICAgICAgICAgICBwYXRoICAgICAgPSBhY3RpdmUgPyBhY3RpdmUuZGF0YSgnbW0taWQnKSA6IG51bGw7XG5cbiAgICAgICAgLy8gZG8gbm90IGFsbG93IHRvIGNyZWF0ZSBhIG5ldyBjb2x1bW4gaWYgdGhlcmUncyBhbHJlYWR5IG9uZSBhbmQgaXQncyBlbXB0eVxuICAgICAgICBpZiAoY291bnQgPT0gMSAmJiAhY2hpbGRyZW4uc2VhcmNoKCcuc3VibWVudS1pdGVtcyA+IFtkYXRhLW1tLWlkXScpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBibG9jayA9ICQobGFzdFswXS5jbG9uZU5vZGUodHJ1ZSkpO1xuICAgICAgICBibG9jay5kYXRhKCdtbS1pZCcsICdsaXN0LScgKyBjb3VudCk7XG4gICAgICAgIGJsb2NrLmZpbmQoJy5zdWJtZW51LWl0ZW1zJykuZW1wdHkoKTtcbiAgICAgICAgYmxvY2suZmluZCgnW2RhdGEtbW0tYmFzZS1sZXZlbF0nKS5kYXRhKCdtbS1iYXNlLWxldmVsJywgMSk7XG4gICAgICAgIGJsb2NrLmZpbmQoJy5zdWJtZW51LWxldmVsJykudGV4dCgnTGV2ZWwgMScpO1xuICAgICAgICBibG9jay5hZnRlcihsYXN0KTtcblxuICAgICAgICBpZiAoIW1lbnVtYW5hZ2VyLm9yZGVyaW5nW3BhdGhdKSB7XG4gICAgICAgICAgICBtZW51bWFuYWdlci5vcmRlcmluZ1twYXRoXSA9IFtbXV07XG4gICAgICAgIH1cblxuICAgICAgICBtZW51bWFuYWdlci5vcmRlcmluZ1twYXRoXS5wdXNoKFtdKTtcbiAgICAgICAgbWVudW1hbmFnZXIucmVzaXplci5ldmVuUmVzaXplKCQoJy5zdWJtZW51LXNlbGVjdG9yID4gW2RhdGEtbW0taWRdJykpO1xuICAgIH0pO1xuXG4gICAgLy8gQXR0YWNoIGV2ZW50cyB0byBwc2V1ZG8gKHgpIGZvciBkZWxldGluZyBhIGNvbHVtblxuICAgIFsnY2xpY2snLCAndG91Y2hlbmQnXS5mb3JFYWNoKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBib2R5LmRlbGVnYXRlKGV2dCwgJ1tkYXRhLWc1LW1lbnUtY29sdW1uc10gLnN1Ym1lbnUtaXRlbXM6ZW1wdHknLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGJvdW5kaW5nID0gZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgICAgICB4ICAgICAgICA9IGV2ZW50LnBhZ2VYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYIHx8IDAsIHkgPSBldmVudC5wYWdlWSB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSB8fCAwLFxuICAgICAgICAgICAgICAgIHNpYmxpbmdzID0gJCgnLnN1Ym1lbnUtc2VsZWN0b3IgPiBbZGF0YS1tbS1pZF0nKSxcbiAgICAgICAgICAgICAgICBkZWxldGVyICA9IHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDM2LFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDM2XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHNpYmxpbmdzLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoeCA+PSBib3VuZGluZy5sZWZ0ICsgYm91bmRpbmcud2lkdGggLSBkZWxldGVyLndpZHRoICYmIHggPD0gYm91bmRpbmcubGVmdCArIGJvdW5kaW5nLndpZHRoICYmXG4gICAgICAgICAgICAgICAgTWF0aC5hYnMod2luZG93LnNjcm9sbFkgLSB5KSAtIGJvdW5kaW5nLnRvcCA8IGRlbGV0ZXIuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKSxcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyID0gcGFyZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKS5jaGlsZHJlbignW2RhdGEtbW0taWRdJyksXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICAgICA9IGluZGV4T2YoY29udGFpbmVyLCBwYXJlbnQpLFxuICAgICAgICAgICAgICAgICAgICBhY3RpdmUgICAgPSAkKCcubWVudS1zZWxlY3RvciAuYWN0aXZlJyksXG4gICAgICAgICAgICAgICAgICAgIHBhdGggICAgICA9IGFjdGl2ZSA/IGFjdGl2ZS5kYXRhKCdtbS1pZCcpIDogbnVsbDtcblxuICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBzaWJsaW5ncyA9ICQoJy5zdWJtZW51LXNlbGVjdG9yID4gW2RhdGEtbW0taWRdJyk7XG4gICAgICAgICAgICAgICAgbWVudW1hbmFnZXIub3JkZXJpbmdbcGF0aF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5yZXNpemVyLmV2ZW5SZXNpemUoc2libGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIE1lbnUgSXRlbXMgc2V0dGluZ3NcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcjbWVudS1lZGl0b3IgLmNvbmZpZy1jb2csICNtZW51LWVkaXRvciAuZ2xvYmFsLW1lbnUtc2V0dGluZ3MnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciBkYXRhID0ge30sIGlzUm9vdCA9IGVsZW1lbnQuaGFzQ2xhc3MoJ2dsb2JhbC1tZW51LXNldHRpbmdzJyk7XG5cbiAgICAgICAgaWYgKGlzUm9vdCkge1xuICAgICAgICAgICAgZGF0YS5zZXR0aW5ncyA9IEpTT04uc3RyaW5naWZ5KG1lbnVtYW5hZ2VyLnNldHRpbmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEuaXRlbSA9IEpTT04uc3RyaW5naWZ5KG1lbnVtYW5hZ2VyLml0ZW1zW2VsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKS5kYXRhKCdtbS1pZCcpXSk7XG4gICAgICAgIH1cblxuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19MT0FESU5HJyksXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICBvdmVybGF5Q2xpY2tUb0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKCQoZWxlbWVudCkuYXR0cmlidXRlKCdocmVmJykgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLmVuYWJsZUNsb3NlQnlPdmVybGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGZvcm0gICAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnZm9ybScpLFxuICAgICAgICAgICAgICAgICAgICBmYWtlRE9NICAgID0gemVuKCdkaXYnKS5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCkuZmluZCgnZm9ybScpLFxuICAgICAgICAgICAgICAgICAgICBzdWJtaXQgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnaW5wdXRbdHlwZT1cInN1Ym1pdFwiXSwgYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0sIFtkYXRhLWFwcGx5LWFuZC1zYXZlXScpLFxuICAgICAgICAgICAgICAgICAgICBwYXRoO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaCAgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJy5zZWFyY2ggaW5wdXQnKSxcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzICAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuc2VhcmNoKCdbZGF0YS1tbS10eXBlXScpLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5zZWFyY2goJ1tkYXRhLW1tLWZpbHRlcl0nKSxcbiAgICAgICAgICAgICAgICAgICAgdXJsVGVtcGxhdGUgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnLmctdXJsdGVtcGxhdGUnKTtcblxuICAgICAgICAgICAgICAgIGlmICh1cmxUZW1wbGF0ZSkgeyBib2R5LmVtaXQoJ2lucHV0JywgeyB0YXJnZXQ6IHVybFRlbXBsYXRlIH0pOyB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZWRpdGFibGUgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJyk7XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlLm9uKCd0aXRsZS1lZGl0LWVuZCcsIGZ1bmN0aW9uKHRpdGxlLCBvcmlnaW5hbC8qLCBjYW5jZWxlZCovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IHRyaW0odGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdHJpbShvcmlnaW5hbCkgfHwgJ1RpdGxlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQodGl0bGUpLmRhdGEoJ3RpdGxlLWVkaXRhYmxlJywgdGl0bGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZWFyY2ggJiYgZmlsdGVycyAmJiBibG9ja3MpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoLm9uKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZhbHVlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzLmFkZENsYXNzKCdoaWRkZW4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gW10sIHZhbHVlID0gdGhpcy52YWx1ZSgpLnRvTG93ZXJDYXNlKCksIHRleHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnMuZm9yRWFjaChmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSAkKGZpbHRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRyaW0oZmlsdGVyLmRhdGEoJ21tLWZpbHRlcicpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0Lm1hdGNoKG5ldyBSZWdFeHAoXCJeXCIgKyB2YWx1ZSArICd8XFxcXHMnICsgdmFsdWUsICdnaScpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZC5wdXNoKGZpbHRlci5tYXRjaGVzKCdbZGF0YS1tbS10eXBlXScpID8gZmlsdGVyIDogZmlsdGVyLnBhcmVudCgnW2RhdGEtbW0tdHlwZV0nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGgpIHsgJChmb3VuZCkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOyB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZWFyY2gpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFswXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9LCA1KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoKCFmb3JtICYmICFmYWtlRE9NKSB8fCAhc3VibWl0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgICAgICAgICAvLyBNZW51aXRlbXMgU2V0dGluZ3MgYXBwbHlcbiAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRpc2FibGVkKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gU3VibWl0KGZha2VET01bMF0uZWxlbWVudHMsIGNvbnRlbnQuZWxlbWVudHMuY29udGVudCwge2lzUm9vdDogaXNSb290fSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3QuaW52YWxpZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5kaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNob3dJbmRpY2F0b3IoJ2ZhIGZhLWZ3IGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1JFVklFV19GSUVMRFMnKSwgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0lOVkFMSURfRklFTERTJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdChmYWtlRE9NLmF0dHJpYnV0ZSgnbWV0aG9kJyksIHBhcnNlQWpheFVSSShmYWtlRE9NLmF0dHJpYnV0ZSgnYWN0aW9uJykgKyBnZXRBamF4U3VmZml4KCkpLCBwb3N0LnZhbGlkLmpvaW4oJyYnKSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5ib2R5LnBhdGggfHwgKHJlc3BvbnNlLmJvZHkuaXRlbSAmJiByZXNwb25zZS5ib2R5Lml0ZW0udHlwZSA9PSAncGFydGljbGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcmVzcG9uc2UuYm9keS5wYXRoIHx8IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKS5kYXRhKCdtbS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5pdGVtc1twYXRoXSA9IHJlc3BvbnNlLmJvZHkuaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmJvZHkuaXRlbSAmJiByZXNwb25zZS5ib2R5Lml0ZW0udHlwZSA9PSAncGFydGljbGUnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5zZXR0aW5ncyA9IHJlc3BvbnNlLmJvZHkuc2V0dGluZ3M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkuaHRtbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gcmVzcG9uc2UuYm9keS5pdGVtLmVuYWJsZWQgfHwgcmVzcG9uc2UuYm9keS5pdGVtLm9wdGlvbnMucGFydGljbGUuZW5hYmxlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRbc3RhdHVzID09ICcwJyA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnZy1tZW51LWl0ZW0tZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVtYW5hZ2VyLmVtaXQoJ2RyYWdFbmQnLCBtZW51bWFuYWdlci5tYXApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaXQncyBhcHBseSBhbmQgc2F2ZSB3ZSBhbHNvIHNhdmUgdGhlIHBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5kYXRhKCdhcHBseS1hbmQtc2F2ZScpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlID0gJCgnYm9keScpLmZpbmQoJy5idXR0b24tc2F2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZSkgeyBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6IHNhdmUgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19NRU5VX1NFVFRJTkdTX0FQUExJRUQnKSwgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1NFVFRJTkdTX0FQUExJRUQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBtZW51bWFuYWdlcjogbWVudW1hbmFnZXJcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIHplbiAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIEVtaXR0ZXIgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG4gICAgRHJhZ0Ryb3AgID0gcmVxdWlyZSgnLi4vdWkvZHJhZy5kcm9wJyksXG4gICAgRXJhc2VyICAgICA9IHJlcXVpcmUoJy4uL3VpL2VyYXNlcicpLFxuICAgIFJlc2l6ZXIgICA9IHJlcXVpcmUoJy4vZHJhZy5yZXNpemVyJyksXG4gICAgZ2V0ICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZ2V0JyksXG5cbiAgICBsdHJpbSAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9sdHJpbScpLFxuICAgIGV2ZXJ5ICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvZXZlcnknKSxcbiAgICBsYXN0ICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2xhc3QnKSxcbiAgICBpbmRleE9mICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2luZGV4T2YnKSxcbiAgICBpc0FycmF5ICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNBcnJheScpLFxuICAgIGlzT2JqZWN0ICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc09iamVjdCcpLFxuICAgIGRlZXBDbG9uZSA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwQ2xvbmUnKSxcbiAgICBlcXVhbHMgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9lcXVhbHMnKTtcblxuXG52YXIgTWVudU1hbmFnZXIgPSBuZXcgcHJpbWUoe1xuXG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIG9wdGlvbnM6IHt9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnJlZkVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLm1hcCA9IHt9O1xuXG4gICAgICAgIGlmICghZWxlbWVudCB8fCAhJChlbGVtZW50KSkgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmluaXQoZWxlbWVudCk7XG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldFJvb3QoKTtcblxuICAgICAgICB0aGlzLmRyYWdkcm9wID0gbmV3IERyYWdEcm9wKHRoaXMucmVmRWxlbWVudCwgdGhpcy5vcHRpb25zLCB0aGlzKTtcbiAgICAgICAgdGhpcy5yZXNpemVyID0gbmV3IFJlc2l6ZXIodGhpcy5yZWZFbGVtZW50LCB0aGlzLm9wdGlvbnMsIHRoaXMpO1xuICAgICAgICB0aGlzLmVyYXNlciA9IG5ldyBFcmFzZXIoJ1tkYXRhLW1tLWVyYXNlcGFydGljbGVdJywgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgdGhpcy5kcmFnZHJvcFxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpjbGljaycsIHRoaXMuYm91bmQoJ2NsaWNrJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOnN0YXJ0JywgdGhpcy5ib3VuZCgnc3RhcnQnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6bW92ZTpvbmNlJywgdGhpcy5ib3VuZCgnbW92ZU9uY2UnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6bG9jYXRpb24nLCB0aGlzLmJvdW5kKCdsb2NhdGlvbicpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpub2xvY2F0aW9uJywgdGhpcy5ib3VuZCgnbm9sb2NhdGlvbicpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpyZXNpemUnLCB0aGlzLmJvdW5kKCdyZXNpemUnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcDplcmFzZScsIHRoaXMuYm91bmQoJ3JlbW92ZUVsZW1lbnQnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcCcsIHRoaXMuYm91bmQoJ3N0b3AnKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RvcDphbmltYXRpb24nLCB0aGlzLmJvdW5kKCdzdG9wQW5pbWF0aW9uJykpO1xuICAgIH0sXG5cbiAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJlZkVsZW1lbnQgfHwgISQodGhpcy5yZWZFbGVtZW50KSkgeyByZXR1cm47IH1cbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfSxcblxuICAgIHNldFJvb3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnJvb3QgPSAkKCcjbWVudS1lZGl0b3InKTtcblxuICAgICAgICBpZiAodGhpcy5yb290KSB7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzID0gSlNPTi5wYXJzZSh0aGlzLnJvb3QuZGF0YSgnbWVudS1zZXR0aW5ncycpKTtcbiAgICAgICAgICAgIHRoaXMub3JkZXJpbmcgPSBKU09OLnBhcnNlKHRoaXMucm9vdC5kYXRhKCdtZW51LW9yZGVyaW5nJykpO1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IEpTT04ucGFyc2UodGhpcy5yb290LmRhdGEoJ21lbnUtaXRlbXMnKSk7XG5cbiAgICAgICAgICAgIHRoaXMubWFwID0ge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzOiBkZWVwQ2xvbmUodGhpcy5zZXR0aW5ncyksXG4gICAgICAgICAgICAgICAgb3JkZXJpbmc6IGRlZXBDbG9uZSh0aGlzLm9yZGVyaW5nKSxcbiAgICAgICAgICAgICAgICBpdGVtczogZGVlcENsb25lKHRoaXMuaXRlbXMpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc3VibWVudXMgPSAkKCdbZGF0YS1nNS1tZW51LWNvbHVtbnNdIC5zdWJtZW51LXNlbGVjdG9yJyksIGNvbHVtbnM7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXNpemVyICYmIHN1Ym1lbnVzICYmIChjb2x1bW5zID0gc3VibWVudXMuc2VhcmNoKCc+IFtkYXRhLW1tLWlkXScpKSkgeyB0aGlzLnJlc2l6ZXIudXBkYXRlTWF4VmFsdWVzKGNvbHVtbnMpOyB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2xpY2s6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcygnLmctbWVudS1hZGRibG9jaycpIHx8IHRhcmdldC5wYXJlbnQoJy5nLW1lbnUtYWRkYmxvY2snKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsZW1lbnQuaGFzQ2xhc3MoJ2ctYmxvY2snKSkge1xuICAgICAgICAgICAgdGhpcy5zdG9wQW5pbWF0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbGVtZW50LmZpbmQoJ1tkYXRhLWc1LWFqYXhpZnldJykpIHtcbiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGVsZW1lbnQuc2libGluZ3MoKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgaWYgKHNpYmxpbmdzKSB7IHNpYmxpbmdzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5lbWl0KCdjbGljaycpO1xuXG4gICAgICAgIHZhciBsaW5rID0gZWxlbWVudC5maW5kKCdhJyk7XG4gICAgICAgIGlmIChsaW5rKSB7IGxpbmtbMF0uY2xpY2soKTsgfVxuICAgIH0sXG5cbiAgICByZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50LCBzaWJsaW5ncywgb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMucmVzaXplci5zdGFydChldmVudCwgZWxlbWVudCwgc2libGluZ3MsIG9mZnNldCk7XG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcm9vdCA9IGVsZW1lbnQucGFyZW50KCcubWVudS1zZWxlY3RvcicpIHx8IGVsZW1lbnQucGFyZW50KCcuc3VibWVudS1jb2x1bW4nKSB8fCBlbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKSB8fCBlbGVtZW50LnBhcmVudCgnLmc1LW1tLXBhcnRpY2xlcy1waWNrZXInKSxcbiAgICAgICAgICAgIHNpemUgPSAkKGVsZW1lbnQpLnBvc2l0aW9uKCksXG4gICAgICAgICAgICBjb29yZHMgPSAkKGVsZW1lbnQpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIHRoaXMuYmxvY2sgPSBudWxsO1xuICAgICAgICB0aGlzLnRhcmdldExldmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFkZE5ld0l0ZW0gPSBmYWxzZTtcbiAgICAgICAgdGhpcy50eXBlID0gIGVsZW1lbnQucGFyZW50KCcuZy10b3BsZXZlbCcpIHx8IGVsZW1lbnQubWF0Y2hlcygnLmctdG9wbGV2ZWwnKSA/ICdtYWluJyA6IChlbGVtZW50Lm1hdGNoZXMoJy5nLWJsb2NrJykgPyAnY29sdW1uJyA6ICdjb2x1bW5zX2l0ZW1zJyk7XG4gICAgICAgIHRoaXMuaXNQYXJ0aWNsZSA9IGVsZW1lbnQubWF0Y2hlcygnW2RhdGEtbW0tYmxvY2t0eXBlXScpIHx8IGVsZW1lbnQubWF0Y2hlcygnW2RhdGEtbW0tb3JpZ2luYWwtdHlwZV0nKTtcbiAgICAgICAgdGhpcy53YXNBY3RpdmUgPSBlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgdGhpcy5pc05ld1BhcnRpY2xlID0gZWxlbWVudC5wYXJlbnQoJy5nNS1tbS1wYXJ0aWNsZXMtcGlja2VyJyk7XG4gICAgICAgIHRoaXMuUGFydGljbGVJbmRleCA9IC0xO1xuICAgICAgICB0aGlzLnJvb3QgPSByb290O1xuXG4gICAgICAgIHRoaXMuaXRlbUlEID0gZWxlbWVudC5kYXRhKCdtbS1pZCcpO1xuICAgICAgICB0aGlzLml0ZW1MZXZlbCA9IGVsZW1lbnQuZGF0YSgnbW0tbGV2ZWwnKTtcbiAgICAgICAgdGhpcy5pdGVtRnJvbSA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKTtcbiAgICAgICAgdGhpcy5pdGVtVG8gPSBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLmlzUGFydGljbGUgJiYgIXRoaXMuaXNOZXdQYXJ0aWNsZSkge1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gZWxlbWVudC5wYXJlbnQoKS5jaGlsZHJlbignW2RhdGEtbW0taWRdJyk7XG4gICAgICAgICAgICB0aGlzLlBhcnRpY2xlSW5kZXggPSBpbmRleE9mKGNoaWxkcmVuLCBlbGVtZW50WzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJvb3QuYWRkQ2xhc3MoJ21vdmluZycpO1xuXG4gICAgICAgIHZhciB0eXBlID0gJChlbGVtZW50KS5kYXRhKCdtbS1pZCcpLFxuICAgICAgICAgICAgY2xvbmUgPSBlbGVtZW50WzBdLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICBpZiAoIXRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlciA9IHplbigodGhpcy50eXBlID09ICdjb2x1bW4nID8gJ2RpdicgOiAnbGknKSArICcuYmxvY2sucGxhY2Vob2xkZXJbZGF0YS1tbS1wbGFjZWhvbGRlcl0nKTsgfVxuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pO1xuICAgICAgICB0aGlzLm9yaWdpbmFsID0gJChjbG9uZSkuYWZ0ZXIoZWxlbWVudCkuc3R5bGUoe1xuICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsXG4gICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgIH0pLmFkZENsYXNzKCdvcmlnaW5hbC1wbGFjZWhvbGRlcicpLmRhdGEoJ2xtLWRyb3B6b25lJywgbnVsbCk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxUeXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5ibG9jayA9IGVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzTmV3UGFydGljbGUpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgIHpJbmRleDogMTUwMCxcbiAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsKHNpemUud2lkdGgpLFxuICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5jZWlsKHNpemUuaGVpZ2h0KSxcbiAgICAgICAgICAgICAgICBsZWZ0OiBjb29yZHMubGVmdCxcbiAgICAgICAgICAgICAgICB0b3A6IGNvb3Jkcy50b3BcbiAgICAgICAgICAgIH0pLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5iZWZvcmUoZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBlbGVtZW50LnBvc2l0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsLnN0eWxlKHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjVcbiAgICAgICAgICAgIH0pLnN0eWxlKHtcbiAgICAgICAgICAgICAgICBsZWZ0OiBjb29yZHMubGVmdCxcbiAgICAgICAgICAgICAgICB0b3A6IGNvb3Jkcy50b3AsXG4gICAgICAgICAgICAgICAgd2lkdGg6IHBvc2l0aW9uLndpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogcG9zaXRpb24uaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IHRoaXMuZHJhZ2Ryb3AuZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuYmxvY2sgPSB0aGlzLmRyYWdkcm9wLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLmVsZW1lbnQgPSB0aGlzLm9yaWdpbmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSAnY29sdW1uJykge1xuICAgICAgICAgICAgcm9vdC5zZWFyY2goJy5nLWJsb2NrID4gKicpLnN0eWxlKHsgJ3BvaW50ZXItZXZlbnRzJzogJ25vbmUnIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG1vdmVPbmNlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciB0eXBlID0gJChlbGVtZW50KS5kYXRhKCdtbS1pZCcpO1xuICAgICAgICBpZiAodGhpcy5vcmlnaW5hbCkgeyB0aGlzLm9yaWdpbmFsLnN0eWxlKHsgb3BhY2l0eTogMC41IH0pOyB9XG5cbiAgICAgICAgLy8gaXQncyBhIG1vZHVsZSBvciBhIHBhcnRpY2xlIGFuZCB3ZSBhbGxvdyBmb3IgdGhlbSB0byBiZSBkZWxldGVkXG4gICAgICAgIGlmICghdGhpcy5pc05ld1BhcnRpY2xlICYmICh0eXBlICYmIHR5cGUubWF0Y2goL19fKG1vZHVsZXxwYXJ0aWNsZXx3aWRnZXQpKC1bYS16MC05XXs1LH0pPyQvaSkpKSB7XG4gICAgICAgICAgICB0aGlzLmVyYXNlci5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbG9jYXRpb246IGZ1bmN0aW9uKGV2ZW50LCBsb2NhdGlvbiwgdGFyZ2V0LyosIGVsZW1lbnQqLykge1xuICAgICAgICB0YXJnZXQgPSAkKHRhcmdldCk7XG4gICAgICAgICghdGhpcy5pc05ld1BhcnRpY2xlID8gdGhpcy5vcmlnaW5hbCA6IHRoaXMuYmxvY2spLnN0eWxlKHt0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCwgMCknfSk7XG4gICAgICAgIGlmICghdGhpcy5wbGFjZWhvbGRlcikgeyB0aGlzLnBsYWNlaG9sZGVyID0gemVuKCh0aGlzLnR5cGUgPT0gJ2NvbHVtbicgPyAnZGl2JyA6ICdsaScpICsgJy5ibG9jay5wbGFjZWhvbGRlcltkYXRhLW1tLXBsYWNlaG9sZGVyXScpLnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pOyB9XG5cbiAgICAgICAgdmFyIHRhcmdldFR5cGUgPSB0YXJnZXQucGFyZW50KCcuZy10b3BsZXZlbCcpIHx8IHRhcmdldC5tYXRjaGVzKCcuZy10b3BsZXZlbCcpID8gJ21haW4nIDogKHRhcmdldC5tYXRjaGVzKCcuZy1ibG9jaycpID8gJ2NvbHVtbicgOiAnY29sdW1uc19pdGVtcycpLFxuICAgICAgICAgICAgZGF0YUxldmVsID0gdGFyZ2V0LmRhdGEoJ21tLWxldmVsJyksXG4gICAgICAgICAgICBvcmlnaW5hbExldmVsID0gdGhpcy5ibG9jay5kYXRhKCdtbS1sZXZlbCcpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzUGFydGljbGUgJiYgKHRhcmdldFR5cGUgPT09ICdtYWluJyAmJiAhZGF0YUxldmVsKSkge1xuICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdXBwb3J0IGZvciBuZXN0ZWQgbmV3IHBhcnRpY2xlcy9tb2R1bGVzL3dpZGdldHNcbiAgICAgICAgaWYgKGRhdGFMZXZlbCA9PT0gbnVsbCAmJiB0aGlzLnR5cGUgPT09ICdjb2x1bW5zX2l0ZW1zJyAmJiB0aGlzLmlzUGFydGljbGUgJiYgdGhpcy5pc05ld1BhcnRpY2xlKSB7XG4gICAgICAgICAgICB2YXIgc3VibWVudV9pdGVtcyA9IHRhcmdldC5maW5kKCcuc3VibWVudS1pdGVtcycpO1xuICAgICAgICAgICAgaWYgKCFzdWJtZW51X2l0ZW1zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ2Jsb2NrJyB9KS5ib3R0b20oc3VibWVudV9pdGVtcyk7XG4gICAgICAgICAgICB0aGlzLmFkZE5ld0l0ZW0gPSBzdWJtZW51X2l0ZW1zO1xuICAgICAgICAgICAgdGhpcy50YXJnZXRMZXZlbCA9IDI7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdvcmthcm91bmQgZm9yIGxheW91dCBhbmQgc3R5bGUgb2YgY29sdW1uc1xuICAgICAgICBpZiAoZGF0YUxldmVsID09PSBudWxsICYmICh0aGlzLnR5cGUgPT09ICdjb2x1bW5zX2l0ZW1zJyB8fCB0aGlzLmlzUGFydGljbGUpKSB7XG4gICAgICAgICAgICB2YXIgc3VibWVudV9pdGVtcyA9IHRhcmdldC5maW5kKCcuc3VibWVudS1pdGVtcycpLFxuICAgICAgICAgICAgICAgIHN1Ym1lbnVfaXRlbXNfbGV2ZWwgPSBzdWJtZW51X2l0ZW1zLmRhdGEoJ21tLWJhc2UtbGV2ZWwnKTtcblxuICAgICAgICAgICAgLy8gZXh0ZW5kIGRyb3AgYXJlYXMgYW5kIGVuc3VyZSBpdGVtcyBjYW5ub3QgYmUgZHJhZ2dlZCBiZXR3ZWVuIGRpZmZlcmVudCBsZXZlbHNcbiAgICAgICAgICAgIGlmICgoIXRhcmdldC5oYXNDbGFzcygnZy1ibG9jaycpIHx8IHRhcmdldC5maW5kKHRoaXMuYmxvY2spKSB8fCAoIXRoaXMuaXNQYXJ0aWNsZSAmJiBvcmlnaW5hbExldmVsICE9IHN1Ym1lbnVfaXRlbXNfbGV2ZWwpICYmICghc3VibWVudV9pdGVtcyB8fCBzdWJtZW51X2l0ZW1zLmNoaWxkcmVuKCkgfHwgb3JpZ2luYWxMZXZlbCA+IDIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ2Jsb2NrJyB9KS5ib3R0b20oc3VibWVudV9pdGVtcyk7XG4gICAgICAgICAgICB0aGlzLmFkZE5ld0l0ZW0gPSBzdWJtZW51X2l0ZW1zO1xuICAgICAgICAgICAgdGhpcy50YXJnZXRMZXZlbCA9IDI7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKCF0aGlzLmlzUGFydGljbGUpIHtcblxuICAgICAgICAgICAgLy8gV2Ugb25seSBhbGxvdyBzb3J0aW5nIGJldHdlZW4gc2FtZSBsZXZlbCBpdGVtc1xuICAgICAgICAgICAgaWYgKHRoaXMudHlwZSAhPT0gJ2NvbHVtbicgJiYgb3JpZ2luYWxMZXZlbCAhPT0gZGF0YUxldmVsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBFbnN1cmluZyBjb2x1bW5zIGNhbiBvbmx5IGJlIGRyYWdnZWQgYmVmb3JlL2FmdGVyIG90aGVyIGNvbHVtbnNcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT0gJ2NvbHVtbicgJiYgZGF0YUxldmVsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGb3IgbGV2ZWxzID4gMiB3ZSBvbmx5IGFsbG93IHNvcnRpbmcgd2l0aGluIHRoZSBzYW1lIGNvbHVtblxuICAgICAgICAgICAgaWYgKGRhdGFMZXZlbCA+IDIgJiYgdGFyZ2V0LnBhcmVudCgndWwnKSAhPSB0aGlzLmJsb2NrLnBhcmVudCgndWwnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2Ryb3AubWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGZvciBhZGphY2VudHMgYW5kIGF2b2lkIGluc2VydGluZyBhbnkgcGxhY2Vob2xkZXIgc2luY2UgaXQgd291bGQgYmUgdGhlIHNhbWUgcG9zaXRpb25cbiAgICAgICAgdmFyIGV4Y2x1ZGUgPSAnOm5vdCgucGxhY2Vob2xkZXIpOm5vdChbZGF0YS1tbS1pZD1cIicgKyB0aGlzLm9yaWdpbmFsLmRhdGEoJ21tLWlkJykgKyAnXCJdKScsXG4gICAgICAgICAgICBhZGphY2VudHMgPSB7XG4gICAgICAgICAgICAgICAgYmVmb3JlOiB0aGlzLm9yaWdpbmFsLnByZXZpb3VzU2libGluZ3MoZXhjbHVkZSksXG4gICAgICAgICAgICAgICAgYWZ0ZXI6IHRoaXMub3JpZ2luYWwubmV4dFNpYmxpbmdzKGV4Y2x1ZGUpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmIChhZGphY2VudHMuYmVmb3JlKSB7IGFkamFjZW50cy5iZWZvcmUgPSAkKGFkamFjZW50cy5iZWZvcmVbMF0pOyB9XG4gICAgICAgIGlmIChhZGphY2VudHMuYWZ0ZXIpIHsgYWRqYWNlbnRzLmFmdGVyID0gJChhZGphY2VudHMuYWZ0ZXJbMF0pOyB9XG5cblxuICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PT0gJ21haW4nICYmICgoYWRqYWNlbnRzLmJlZm9yZSA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnggPT09ICdhZnRlcicpIHx8IChhZGphY2VudHMuYWZ0ZXIgPT09IHRhcmdldCAmJiBsb2NhdGlvbi54ID09PSAnYmVmb3JlJykpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT09ICdjb2x1bW4nICYmICgoYWRqYWNlbnRzLmJlZm9yZSA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnggPT09ICdhZnRlcicpIHx8IChhZGphY2VudHMuYWZ0ZXIgPT09IHRhcmdldCAmJiBsb2NhdGlvbi54ID09PSAnYmVmb3JlJykpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT09ICdjb2x1bW5zX2l0ZW1zJyAmJiAoKGFkamFjZW50cy5iZWZvcmUgPT09IHRhcmdldCAmJiBsb2NhdGlvbi55ID09PSAnYmVsb3cnKSB8fCAoYWRqYWNlbnRzLmFmdGVyID09PSB0YXJnZXQgJiYgbG9jYXRpb24ueSA9PT0gJ2Fib3ZlJykpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGVzIHRoZSB0eXBlcyBjYXNlcyBhbmQgbm9ybWFsaXplcyB0aGUgbG9jYXRpb25zICh4IGFuZCB5KVxuICAgICAgICBzd2l0Y2ggKHRhcmdldFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ21haW4nOlxuICAgICAgICAgICAgY2FzZSAnY29sdW1uJzpcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyW2xvY2F0aW9uLnhdKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb2x1bW5zX2l0ZW1zJzpcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyW2xvY2F0aW9uLnkgPT09ICdhYm92ZScgPyAnYmVmb3JlJyA6ICdhZnRlciddKHRhcmdldCk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFyZ2V0TGV2ZWwgPSBkYXRhTGV2ZWw7XG5cbiAgICAgICAgLy8gSWYgaXQncyBub3QgYSBibG9jayB3ZSBkb24ndCB3YW50IGEgc21hbGwgdmVyc2lvbiBvZiB0aGUgcGxhY2Vob2xkZXJcbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5zdHlsZSh7IGRpc3BsYXk6ICdibG9jaycgfSlbdGFyZ2V0VHlwZSAhPT0gJ21haW4nID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcyddKCdpbi1iZXR3ZWVuJyk7XG5cbiAgICB9LFxuXG4gICAgbm9sb2NhdGlvbjogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgKCF0aGlzLmlzTmV3UGFydGljbGUgPyB0aGlzLm9yaWdpbmFsIDogdGhpcy5ibG9jaykuc3R5bGUoe3RyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAwKSd9KTtcbiAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlci5yZW1vdmUoKTsgfVxuICAgICAgICB0aGlzLnRhcmdldExldmVsID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkgPyBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGV2ZW50LnRvdWNoZXMuaXRlbSgwKS5jbGllbnRYLCBldmVudC50b3VjaGVzLml0ZW0oMCkuY2xpZW50WSkgOiBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzTmV3UGFydGljbGUgJiYgdGhpcy5pdGVtSUQubWF0Y2goL19fKG1vZHVsZXxwYXJ0aWNsZXx3aWRnZXQpKC1bYS16MC05XXs1fSk/JC9pKSkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gJCh0YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHRhcmdldC5tYXRjaGVzKHRoaXMuZXJhc2VyLmVsZW1lbnQpIHx8IHRoaXMuZXJhc2VyLmVsZW1lbnQuZmluZCh0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5yZW1vdmVFbGVtZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmVyYXNlci5vdmVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2Ryb3AucmVtb3ZlRWxlbWVudCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZXJhc2VyLm91dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZUVsZW1lbnQ6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AucmVtb3ZlRWxlbWVudCA9IGZhbHNlO1xuXG4gICAgICAgIHZhciB0cmFuc2l0aW9uID0ge1xuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGVsZW1lbnQuYW5pbWF0ZSh0cmFuc2l0aW9uLCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogJzE1MG1zJ1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy50eXBlID09ICdjb2x1bW4nKSB7XG4gICAgICAgICAgICB0aGlzLnJvb3Quc2VhcmNoKCcuZy1ibG9jayA+IConKS5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXJhc2VyLmhpZGUoKTtcblxuICAgICAgICB0aGlzLmRyYWdkcm9wLkRSQUdfRVZFTlRTLkVWRU5UUy5NT1ZFLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJCgnYm9keScpLm9mZihldmVudCwgdGhpcy5kcmFnZHJvcC5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub2ZmKGV2ZW50LCB0aGlzLmRyYWdkcm9wLmJvdW5kKCdkZWZlclN0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB2YXIgcGFydGljbGUgPSB0aGlzLmJsb2NrLFxuICAgICAgICAgICAgYmFzZSA9IHBhcnRpY2xlLnBhcmVudCgnW2RhdGEtbW0tYmFzZV0nKS5kYXRhKCdtbS1iYXNlJyksXG4gICAgICAgICAgICBjb2wgPSAocGFydGljbGUucGFyZW50KCdbZGF0YS1tbS1pZF0nKS5kYXRhKCdtbS1pZCcpLm1hdGNoKC9cXGQrJC8pIHx8IFswXSlbMF0sXG4gICAgICAgICAgICBpbmRleCA9IGluZGV4T2YocGFydGljbGUucGFyZW50KCkuY2hpbGRyZW4oJ1tkYXRhLW1tLWlkXTpub3QoLm9yaWdpbmFsLXBsYWNlaG9sZGVyKScpLCBwYXJ0aWNsZVswXSk7XG5cbiAgICAgICAgZGVsZXRlIHRoaXMuaXRlbXNbdGhpcy5pdGVtSURdO1xuICAgICAgICB0aGlzLm9yZGVyaW5nW2Jhc2VdW2NvbF0uc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICB0aGlzLmJsb2NrLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnJvb3QucmVtb3ZlQ2xhc3MoJ21vdmluZycpO1xuXG4gICAgICAgIGlmICh0aGlzLnJvb3QuZmluZCgnLnN1Ym1lbnUtaXRlbXMnKSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJvb3QuZmluZCgnLnN1Ym1lbnUtaXRlbXMnKS5jaGlsZHJlbigpKSB7IHRoaXMucm9vdC5maW5kKCcuc3VibWVudS1pdGVtcycpLnRleHQoJycpOyB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVtaXQoJ2RyYWdFbmQnLCB0aGlzLm1hcCwgJ3Jlb3JkZXInKTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oZXZlbnQsIHRhcmdldCwgZWxlbWVudCkge1xuICAgICAgICB0YXJnZXQgPSAkKHRhcmdldCk7XG5cbiAgICAgICAgLy8gd2UgYXJlIHJlbW92aW5nIHRoZSBibG9ja1xuICAgICAgICB2YXIgbGFzdE92ZXJlZCA9ICQodGhpcy5kcmFnZHJvcC5sYXN0T3ZlcmVkKTtcbiAgICAgICAgaWYgKGxhc3RPdmVyZWQgJiYgbGFzdE92ZXJlZC5tYXRjaGVzKHRoaXMuZXJhc2VyLmVsZW1lbnQuZmluZCgnLnRyYXNoLXpvbmUnKSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJhc2VyLmhpZGUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YXJnZXQpIHsgZWxlbWVudC5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSAnY29sdW1uJykge1xuICAgICAgICAgICAgdGhpcy5yb290LnNlYXJjaCgnLmctYmxvY2sgPiAqJykuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmRyYWdkcm9wLm1hdGNoZWQgJiYgIXRoaXMuYWRkTmV3SXRlbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlci5yZW1vdmUoKTsgfVxuXG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExldmVsID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmlzUGFydGljbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmVyYXNlci5oaWRlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGxhY2Vob2xkZXJQYXJlbnQgPSB0aGlzLnBsYWNlaG9sZGVyLnBhcmVudCgpO1xuICAgICAgICBpZiAoIXBsYWNlaG9sZGVyUGFyZW50KSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExldmVsID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmlzUGFydGljbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hZGROZXdJdGVtKSB7IHRoaXMuYmxvY2suYXR0cmlidXRlKCdzdHlsZScsIG51bGwpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsgfVxuXG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmJsb2NrLnBhcmVudCgpO1xuICAgICAgICB0aGlzLmVyYXNlci5oaWRlKCk7XG5cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc05ld1BhcnRpY2xlKSB7IHRoaXMub3JpZ2luYWwucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGVsc2UgeyB0aGlzLm9yaWdpbmFsLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKS5yZW1vdmVDbGFzcygnb3JpZ2luYWwtcGxhY2Vob2xkZXInKTsgfVxuICAgICAgICB9XG5cblxuICAgICAgICB0aGlzLmJsb2NrLmFmdGVyKHRoaXMucGxhY2Vob2xkZXIpO1xuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLml0ZW1UbyA9IHRoaXMuYmxvY2sucGFyZW50KCdbZGF0YS1tbS1pZF0nKTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWwgPSB0aGlzLml0ZW1MZXZlbDtcbiAgICAgICAgaWYgKHRoaXMud2FzQWN0aXZlKSB7IGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSkge1xuICAgICAgICAgICAgdmFyIGlkID0gbGFzdCh0aGlzLml0ZW1JRC5zcGxpdCgnLycpKSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJdGVtID0gKHRhcmdldCB8fCB0aGlzLml0ZW1UbyksXG4gICAgICAgICAgICAgICAgYmFzZSA9IHRhcmdldEl0ZW1bdGFyZ2V0ICYmICF0YXJnZXQuaGFzQ2xhc3MoJ2ctYmxvY2snKSA/ICdwYXJlbnQnIDogJ2ZpbmQnXSgnW2RhdGEtbW0tYmFzZV0nKS5kYXRhKCdtbS1iYXNlJyk7XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbUlEID0gYmFzZSA/IGJhc2UgKyAnLycgKyBpZCA6IGlkO1xuICAgICAgICAgICAgdGhpcy5pdGVtTGV2ZWwgPSB0aGlzLnRhcmdldExldmVsO1xuICAgICAgICAgICAgdGhpcy5ibG9jay5kYXRhKCdtbS1pZCcsIHRoaXMuaXRlbUlEKS5kYXRhKCdtbS1sZXZlbCcsIHRoaXMudGFyZ2V0TGV2ZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHBhdGggPSB0aGlzLml0ZW1JRC5zcGxpdCgnLycpLFxuICAgICAgICAgICAgaXRlbXMsIGNvbHVtbjtcblxuICAgICAgICBwYXRoLnNwbGljZSh0aGlzLml0ZW1MZXZlbCAtIDEpO1xuICAgICAgICBwYXRoID0gcGF0aC5qb2luKCcvJyk7XG5cbiAgICAgICAgLy8gSXRlbXMgcmVvcmRlciBmb3Igcm9vdCBvciBzdWJsZXZlbHMgd2l0aCBsb2dpYyB0byByZW9yZGVyIEZST00gYW5kIFRPIHN1YmxldmVsIGNvbHVtbiBpZiBuZWVkZWRcbiAgICAgICAgaWYgKHRoaXMuaXRlbUZyb20gfHwgdGhpcy5pdGVtVG8pIHtcbiAgICAgICAgICAgIHZhciBzb3VyY2VzID0gdGhpcy5pdGVtRnJvbSA9PSB0aGlzLml0ZW1UbyA/IFt0aGlzLml0ZW1Gcm9tXSA6IFt0aGlzLml0ZW1Gcm9tLCB0aGlzLml0ZW1Ub107XG4gICAgICAgICAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzb3VyY2UpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICBpdGVtcyA9IHNvdXJjZS5zZWFyY2goJ1tkYXRhLW1tLWlkXScpO1xuICAgICAgICAgICAgICAgIGNvbHVtbiA9IE51bWJlcih0aGlzLmJsb2NrLmRhdGEoJ21tLWxldmVsJykgPiAyID8gMCA6IChzb3VyY2UuZGF0YSgnbW0taWQnKS5tYXRjaCgvXFxkKyQvKSB8fCBbMF0pWzBdKTtcblxuICAgICAgICAgICAgICAgIGlmICghaXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmRlcmluZ1twYXRoXVtjb2x1bW5dID0gW107XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpdGVtcyA9IGl0ZW1zLm1hcChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkKGVsZW1lbnQpLmRhdGEoJ21tLWlkJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3JkZXJpbmdbcGF0aF0pIHsgdGhpcy5vcmRlcmluZ1twYXRoXSA9IFtdOyB9XG4gICAgICAgICAgICAgICAgdGhpcy5vcmRlcmluZ1twYXRoXVtjb2x1bW5dID0gaXRlbXM7XG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgb3JpZ2luIGlmIGl0J3MgYSBwYXJ0aWNsZVxuICAgICAgICAgICAgYmFzZSA9IHRoaXMuaXRlbUZyb20gPyAodGhpcy5pdGVtRnJvbS5hdHRyaWJ1dGUoJ2RhdGEtbW0tYmFzZScpICE9PSBudWxsID8gdGhpcy5pdGVtRnJvbSA6IHRoaXMuaXRlbUZyb20uZmluZCgnW2RhdGEtbW0tYmFzZV0nKSkgOiBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSAmJiBiYXNlICYmIHRoaXMudGFyZ2V0TGV2ZWwgIT0gdGhpcy5jdXJyZW50TGV2ZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGlzdCA9ICh0aGlzLml0ZW1Gcm9tLmRhdGEoJ21tLWlkJykubWF0Y2goL1xcZCskLykgfHwgWzBdKVswXSxcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBiYXNlLmRhdGEoJ21tLWJhc2UnKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExvY2F0aW9uID0gbHRyaW0oW2xvY2F0aW9uLCBpZF0uam9pbignLycpLCBbJy8nXSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyaW5nW2xvY2F0aW9uXVtsaXN0XS5zcGxpY2UodGhpcy5QYXJ0aWNsZUluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zW3RoaXMuaXRlbUlEXSA9IHRoaXMuaXRlbXNbY3VycmVudExvY2F0aW9uXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5pdGVtc1tjdXJyZW50TG9jYXRpb25dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29sdW1uIHJlb3JkZXJpbmcsIHdlIGp1c3QgbmVlZCB0byBzd2FwIHRoZSBhcnJheSBpbmRleGVzXG4gICAgICAgIGlmICghdGhpcy5pdGVtRnJvbSAmJiAhdGhpcy5pdGVtVG8gJiYgIXRoaXMuaXNQYXJ0aWNsZSkge1xuICAgICAgICAgICAgdmFyIGNvbHNPcmRlciA9IFtdLFxuICAgICAgICAgICAgICAgIGFjdGl2ZSA9ICQoJy5nLXRvcGxldmVsIFtkYXRhLW1tLWlkXS5hY3RpdmUnKS5kYXRhKCdtbS1pZCcpO1xuICAgICAgICAgICAgaXRlbXMgPSBwYXJlbnQuc2VhcmNoKCc+IFtkYXRhLW1tLWlkXScpO1xuXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBlbGVtZW50LmRhdGEoJ21tLWlkJyksXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA9IE51bWJlcigoaWQubWF0Y2goL1xcZCskLykgfHwgWzBdKVswXSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoJ21tLWlkJywgaWQucmVwbGFjZSgvXFxkKyQvLCBpbmRleCkpO1xuICAgICAgICAgICAgICAgIGNvbHNPcmRlci5wdXNoKHRoaXMub3JkZXJpbmdbYWN0aXZlXVtjb2x1bW5dKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICB0aGlzLm9yZGVyaW5nW2FjdGl2ZV0gPSBjb2xzT3JkZXI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBhcmVudC5jaGlsZHJlbigpKSB7IHBhcmVudC5lbXB0eSgpOyB9XG5cbiAgICAgICAgLyppZiAoY29uc29sZSAmJiBjb25zb2xlLmdyb3VwICYmIGNvbnNvbGUuaW5mbyAmJiBjb25zb2xlLnRhYmxlICYmIGNvbnNvbGUuZ3JvdXBFbmQpIHtcbiAgICAgICAgIGNvbnNvbGUuZ3JvdXAoKTtcbiAgICAgICAgIGNvbnNvbGUuaW5mbygnTmV3IE9yZGVyaW5nJyk7XG4gICAgICAgICBjb25zb2xlLnRhYmxlKHRoaXMub3JkZXJpbmcpO1xuICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgfSovXG5cbiAgICAgICAgdmFyIHNlbGVjdG9yID0gdGhpcy5ibG9jay5wYXJlbnQoJy5zdWJtZW51LXNlbGVjdG9yJyk7XG4gICAgICAgIGlmIChzZWxlY3RvcikgeyB0aGlzLnJlc2l6ZXIudXBkYXRlSXRlbVNpemVzKHNlbGVjdG9yLnNlYXJjaCgnPiBbZGF0YS1tbS1pZF0nKSk7IH1cblxuICAgICAgICB0aGlzLmVtaXQoJ2RyYWdFbmQnLCB0aGlzLm1hcCwgJ3Jlb3JkZXInKTtcbiAgICB9LFxuXG4gICAgc3RvcEFuaW1hdGlvbjogZnVuY3Rpb24oLyplbGVtZW50Ki8pIHtcbiAgICAgICAgdmFyIGZsZXggPSBudWxsO1xuICAgICAgICBpZiAodGhpcy50eXBlID09ICdjb2x1bW4nKSB7IGZsZXggPSB0aGlzLnJlc2l6ZXIuZ2V0U2l6ZSh0aGlzLmJsb2NrKTsgfVxuICAgICAgICBpZiAodGhpcy5yb290KSB7IHRoaXMucm9vdC5yZW1vdmVDbGFzcygnbW92aW5nJyk7IH1cbiAgICAgICAgaWYgKHRoaXMuYmxvY2spIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICAgICAgaWYgKGZsZXgpIHsgdGhpcy5ibG9jay5zdHlsZSgnZmxleCcsICcwIDEgJyArIGZsZXggKyAnICUnKTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc05ld1BhcnRpY2xlIHx8ICghdGhpcy5kcmFnZHJvcC5tYXRjaGVkICYmICF0aGlzLnRhcmdldExldmVsKSkgeyB0aGlzLm9yaWdpbmFsLnJlbW92ZSgpOyB9XG4gICAgICAgICAgICBlbHNlIHsgdGhpcy5vcmlnaW5hbC5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCkucmVtb3ZlQ2xhc3MoJ29yaWdpbmFsLXBsYWNlaG9sZGVyJyk7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy53YXNBY3RpdmUgJiYgdGhpcy5ibG9jaykgeyB0aGlzLmJsb2NrLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsgfVxuICAgIH1cbn0pO1xuXG5cbm1vZHVsZS5leHBvcnRzID0gTWVudU1hbmFnZXI7XG4iLCIndXNlIHN0cmljdCc7XG52YXIgJCAgICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICByZWFkeSAgICAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHplbiAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIFN1Ym1pdCAgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL2ZpZWxkcy9zdWJtaXQnKSxcbiAgICBtb2RhbCAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLm1vZGFsLFxuICAgIHRvYXN0ciAgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIEVyYXNlciAgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpL2VyYXNlcicpLFxuICAgIHJlcXVlc3QgICAgICAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgaW5kZXhPZiAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9pbmRleE9mJyksXG4gICAgc2ltcGxlU29ydCAgICAgICAgID0gcmVxdWlyZSgnc29ydGFibGVqcycpLFxuXG4gICAgdHJpbSAgICAgICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgIHNpemUgICAgICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L3NpemUnKSxcblxuICAgIHBhcnNlQWpheFVSSSAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhTdWZmaXggICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpLFxuICAgIGdldE91dGxpbmVOYW1lQnlJZCA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1vdXRsaW5lJykuZ2V0T3V0bGluZU5hbWVCeUlkLFxuICAgIHRyYW5zbGF0ZSAgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL3RyYW5zbGF0ZScpO1xuXG52YXIgQXRvbXNGaWVsZCAgID0gJ1tuYW1lPVwicGFnZVtoZWFkXVthdG9tc11bX2pzb25dXCJdJyxcbiAgICBncm91cE9wdGlvbnMgPSBbXG4gICAgICAgIHsgbmFtZTogJ2F0b21zJywgcHVsbDogJ2Nsb25lJywgcHV0OiBmYWxzZSB9LFxuICAgICAgICB7IG5hbWU6ICdhdG9tcycsIHB1bGw6IHRydWUsIHB1dDogdHJ1ZSB9LFxuICAgICAgICB7IG5hbWU6ICdhdG9tcycsIHB1bGw6IGZhbHNlLCBwdXQ6IGZhbHNlIH1cbiAgICBdO1xuXG52YXIgQXRvbXMgPSB7XG4gICAgZXJhc2VyOiBudWxsLFxuICAgIGxpc3RzOiB7XG4gICAgICAgIHBpY2tlcjogbnVsbCxcbiAgICAgICAgaXRlbXM6IG51bGxcbiAgICB9LFxuXG4gICAgc2VyaWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG91dHB1dCA9IFtdLFxuICAgICAgICAgICAgbGlzdCAgID0gJCgnLmF0b21zLWxpc3QnKSxcbiAgICAgICAgICAgIGF0b21zICA9IGxpc3Quc2VhcmNoKCdbZGF0YS1hdG9tLXBpY2tlZF0nKTtcblxuICAgICAgICBpZiAoIWF0b21zKSB7XG4gICAgICAgICAgICBsaXN0LmVtcHR5KCk7XG4gICAgICAgICAgICByZXR1cm4gJ1tdJztcbiAgICAgICAgfVxuXG4gICAgICAgIGF0b21zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgaXRlbSA9ICQoaXRlbSk7XG4gICAgICAgICAgICBvdXRwdXQucHVzaChKU09OLnBhcnNlKGl0ZW0uZGF0YSgnYXRvbS1waWNrZWQnKSkpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob3V0cHV0KS5yZXBsYWNlKC9cXC8vZywgJ1xcXFwvJyk7XG4gICAgfSxcblxuICAgIGF0dGFjaEVyYXNlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChBdG9tcy5lcmFzZXIpIHtcbiAgICAgICAgICAgIEF0b21zLmVyYXNlci5lbGVtZW50ID0gJCgnW2RhdGEtYXRvbXMtZXJhc2VdJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBBdG9tcy5lcmFzZXIgPSBuZXcgRXJhc2VyKCdbZGF0YS1hdG9tcy1lcmFzZV0nKTtcbiAgICB9LFxuXG4gICAgY3JlYXRlU29ydGFibGVzOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBsaXN0LCBzb3J0O1xuXG4gICAgICAgIEF0b21zLmF0dGFjaEVyYXNlcigpO1xuXG4gICAgICAgIGdyb3VwT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwT3B0aW9uLCBpKSB7XG4gICAgICAgICAgICBsaXN0ID0gIWkgPyAnLmF0b21zLXBpY2tlcicgOiAoaSA9PSAxID8gJy5hdG9tcy1saXN0JyA6ICcjdHJhc2gnKTtcbiAgICAgICAgICAgIGxpc3QgPSAkKGxpc3QpO1xuICAgICAgICAgICAgc29ydCA9IHNpbXBsZVNvcnQuY3JlYXRlKGxpc3RbMF0sIHtcbiAgICAgICAgICAgICAgICBzb3J0OiBpID09IDEsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEtYXRvbS1pZ25vcmVdJyxcbiAgICAgICAgICAgICAgICBncm91cDogZ3JvdXBPcHRpb24sXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBmb3JjZUZhbGxiYWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMTAwLFxuXG4gICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgQXRvbXMuYXR0YWNoRXJhc2VyKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKGV2ZW50Lml0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCdhdG9tLWRyYWdnaW5nJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZXZlbnQuZnJvbSkuaGFzQ2xhc3MoJ2F0b21zLWxpc3QnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgQXRvbXMuZXJhc2VyLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvbkVuZDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gICAgICAgPSAkKGV2ZW50Lml0ZW0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhc2ggICAgICA9ICQoJyN0cmFzaCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ICAgICA9ICQodGhpcy5vcmlnaW5hbEV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3VjaFRyYXNoID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd29ya2Fyb3VuZCBmb3IgdG91Y2ggZGV2aWNlc1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcmlnaW5hbEV2ZW50LnR5cGUgPT09ICd0b3VjaGVuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmFzaFNpemUgPSB0cmFzaFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvRSAgICAgICAgPSB0aGlzLm9yaWdpbmFsRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gID0gKG9FLnBhZ2VZIHx8IG9FLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZKSAtIHdpbmRvdy5zY3JvbGxZO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3VjaFRyYXNoID0gcG9zaXRpb24gPD0gdHJhc2hTaXplLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcygnI3RyYXNoJykgfHwgdGFyZ2V0LnBhcmVudCgnI3RyYXNoJykgfHwgdG91Y2hUcmFzaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEF0b21zLmVyYXNlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMub25Tb3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZUNsYXNzKCdhdG9tLWRyYWdnaW5nJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZXZlbnQuZnJvbSkuaGFzQ2xhc3MoJ2F0b21zLWxpc3QnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgQXRvbXMuZXJhc2VyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblNvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VyaWFsID0gQXRvbXMuc2VyaWFsaXplKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCAgPSAkKEF0b21zRmllbGQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZmllbGQpIHsgdGhyb3cgbmV3IEVycm9yKCdGaWVsZCBcIicgKyBBdG9tc0ZpZWxkICsgJ1wiIG5vdCBmb3VuZCBpbiB0aGUgRE9NLicpOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgZmllbGQudmFsdWUoc2VyaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBmaWVsZCB9KTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25PdmVyOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkKGV2dC5mcm9tKS5tYXRjaGVzKCcuYXRvbXMtbGlzdCcpKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBvdmVyID0gJChldnQubmV3SW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3Zlci5tYXRjaGVzKCcjdHJhc2gnKSB8fCBvdmVyLnBhcmVudCgnI3RyYXNoJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEF0b21zLmVyYXNlci5vdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBdG9tcy5lcmFzZXIub3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgQXRvbXMubGlzdHNbIWkgPyAncGlja2VyJyA6ICdpdGVtcyddID0gc29ydDtcbiAgICAgICAgICAgIGlmIChpID09IDEpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LlNpbXBsZVNvcnQgPSBzb3J0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG52YXIgQXR0YWNoU2V0dGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJy5hdG9tcy1saXN0IFtkYXRhLWF0b20tcGlja2VkXSAuY29uZmlnLWNvZycsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGxpc3QgICAgICA9IGVsZW1lbnQucGFyZW50KCd1bCcpLFxuICAgICAgICAgICAgZGF0YUZpZWxkID0gJChBdG9tc0ZpZWxkKSxcbiAgICAgICAgICAgIGRhdGEgICAgICA9IGRhdGFGaWVsZC52YWx1ZSgpLFxuICAgICAgICAgICAgaXRlbXMgICAgID0gbGlzdC5zZWFyY2goJz4gW2RhdGEtYXRvbS1waWNrZWRdJyksXG4gICAgICAgICAgICBpdGVtICAgICAgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtYXRvbS1waWNrZWRdJyksXG4gICAgICAgICAgICBpdGVtRGF0YSAgPSBpdGVtLmRhdGEoJ2F0b20tcGlja2VkJyk7XG5cbiAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICBjb250ZW50OiB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE9BRElORycpLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBkYXRhOiB7IGRhdGE6IGl0ZW1EYXRhIH0sXG4gICAgICAgICAgICBvdmVybGF5Q2xpY2tUb0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJykgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtICAgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgZmFrZURPTSAgICA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpLmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0ICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5zZWFyY2goJ2lucHV0W3R5cGU9XCJzdWJtaXRcIl0sIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdLCBbZGF0YS1hcHBseS1hbmQtc2F2ZV0nKSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlICA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobW9kYWwuZ2V0QWxsKCkubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXBwbHlBbmRTYXZlID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnW2RhdGEtYXBwbHktYW5kLXNhdmVdJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcHBseUFuZFNhdmUpIHsgYXBwbHlBbmRTYXZlLnJlbW92ZSgpOyB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCghZm9ybSAmJiAhZmFrZURPTSkgfHwgIXN1Ym1pdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBdG9tIFNldHRpbmdzIGFwcGx5XG4gICAgICAgICAgICAgICAgc3VibWl0Lm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBSZWZyZXNoIHRoZSBmb3JtIHRvIGNvbGxlY3QgZnJlc2ggYW5kIGR5bmFtaWMgZmllbGRzXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JtRWxlbWVudHMgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnZm9ybScpWzBdLmVsZW1lbnRzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zdCA9IFN1Ym1pdChmb3JtRWxlbWVudHMsIGNvbnRlbnQuZWxlbWVudHMuY29udGVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3QuaW52YWxpZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcignZmEgZmEtZncgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfUkVWSUVXX0ZJRUxEUycpLCB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfSU5WQUxJRF9GSUVMRFMnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KGZha2VET00uYXR0cmlidXRlKCdtZXRob2QnKSwgcGFyc2VBamF4VVJJKGZha2VET00uYXR0cmlidXRlKCdhY3Rpb24nKSArIGdldEFqYXhTdWZmaXgoKSksIHBvc3QudmFsaWQuam9pbignJicpIHx8IHt9LCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZihpdGVtcywgaXRlbVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlW2luZGV4XSA9IHJlc3BvbnNlLmJvZHkuaXRlbTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFGaWVsZC52YWx1ZShKU09OLnN0cmluZ2lmeShkYXRhVmFsdWUpLnJlcGxhY2UoL1xcLy9nLCAnXFxcXC8nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5maW5kKCcuYXRvbS10aXRsZScpLnRleHQoZGF0YVZhbHVlW2luZGV4XS50aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhKCdhdG9tLXBpY2tlZCcsIEpTT04uc3RyaW5naWZ5KGRhdGFWYWx1ZVtpbmRleF0pLnJlcGxhY2UoL1xcLy9nLCAnXFxcXC8nKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2dnbGUgZW5hYmxlZC9kaXNhYmxlZCBzdGF0dXMgYXMgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuYWJsZWQgICAgPSBOdW1iZXIoZGF0YVZhbHVlW2luZGV4XS5hdHRyaWJ1dGVzLmVuYWJsZWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmhlcml0aW5nID0gcmVzcG9uc2UuYm9keS5pdGVtLmluaGVyaXQgJiYgc2l6ZShyZXNwb25zZS5ib2R5Lml0ZW0uaW5oZXJpdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtlbmFibGVkID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcyddKCdhdG9tLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVshaW5oZXJpdGluZyA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1pbmhlcml0aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5hdHRyaWJ1dGUoJ3RpdGxlJywgZW5hYmxlZCA/ICcnIDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xNX0RJU0FCTEVEX1BBUlRJQ0xFJywgJ2F0b20nKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEoJ3RpcCcsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmhlcml0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmhlcml0ID0gcmVzcG9uc2UuYm9keS5pdGVtLmluaGVyaXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lID0gZ2V0T3V0bGluZU5hbWVCeUlkKGluaGVyaXQgPyBpbmhlcml0Lm91dGxpbmUgOiBudWxsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0b20gPSBpbmhlcml0LmF0b20gfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlID0gKGluaGVyaXQuaW5jbHVkZSB8fCBbXSkuam9pbignLCAnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEoJ3RpcCcsIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9JTkhFUklUSU5HX0ZST01fWCcsICc8c3Ryb25nPicgKyBvdXRsaW5lICsgJzwvc3Ryb25nPicpICsgJzxiciAvPklEOiAnICsgYXRvbSArICc8YnIgLz5SZXBsYWNlOiAnICsgaW5jbHVkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5HNS50aXBzLnJlbG9hZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaXQncyBhcHBseSBhbmQgc2F2ZSB3ZSBhbHNvIHNhdmUgdGhlIHBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5kYXRhKCdhcHBseS1hbmQtc2F2ZScpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlID0gJCgnYm9keScpLmZpbmQoJy5idXR0b24tc2F2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZSkgeyBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6IHNhdmUgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19HRU5FUklDX1NFVFRJTkdTX0FQUExJRUQnLCAnQXRvbScpLCB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfU0VUVElOR1NfQVBQTElFRCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxudmFyIEF0dGFjaFNvcnRhYmxlQXRvbXMgPSBmdW5jdGlvbihhdG9tcykge1xuICAgIGlmICghYXRvbXMpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCFhdG9tcy5TaW1wbGVTb3J0KSB7IEF0b21zLmNyZWF0ZVNvcnRhYmxlcyhhdG9tcyk7IH1cbn07XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBhdG9tcyA9ICQoJyNhdG9tcycpO1xuXG4gICAgJCgnYm9keScpLmRlbGVnYXRlKCdtb3VzZW92ZXInLCAnI2F0b21zJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgQXR0YWNoU29ydGFibGVBdG9tcyhlbGVtZW50KTtcbiAgICB9KTtcblxuICAgIEF0dGFjaFNvcnRhYmxlQXRvbXMoYXRvbXMpO1xuICAgIEF0dGFjaFNldHRpbmdzKCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBBdG9tczsiLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgICQgICAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHplbiAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBTdWJtaXQgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vZmllbGRzL3N1Ym1pdCcpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLm1vZGFsLFxuICAgIHRvYXN0ciAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLnRvYXN0cixcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICBsYXN0SXRlbSAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9sYXN0JyksXG4gICAgaW5kZXhPZiAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIHNpbXBsZVNvcnQgICAgPSByZXF1aXJlKCdzb3J0YWJsZWpzJyksXG5cbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2luc2VydGlvbicpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIHZhciBhZGROZXdCeUVudGVyID0gZnVuY3Rpb24odGl0bGUsIGtleSkge1xuICAgICAgICBpZiAoa2V5ID09ICdlbnRlcicgJiYgdGhpcy5Db2xsZWN0aW9uTmV3KSB7XG4gICAgICAgICAgICB0aGlzLkNvbGxlY3Rpb25OZXcgPSBmYWxzZTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogdGhpcy5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpLmZpbmQoJ1tkYXRhLWNvbGxlY3Rpb24tYWRkbmV3XScpIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleSA9PSAnZXNjJyAmJiB0aGlzLkNvbGxlY3Rpb25OZXcpIHtcbiAgICAgICAgICAgIHRoaXMuQ29sbGVjdGlvbk5ldyA9IGZhbHNlO1xuICAgICAgICAgICAgYm9keS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiB0aGlzLnBhcmVudCgnW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpLmZpbmQoJ1tkYXRhLWNvbGxlY3Rpb24tcmVtb3ZlXScpIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGVTb3J0YWJsZXMgPSBmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgIHZhciBsaXN0cyA9IGxpc3QgfHwgJCgnLmNvbGxlY3Rpb24tbGlzdCB1bCcpO1xuICAgICAgICBpZiAoIWxpc3RzKSB7IHJldHVybjsgfVxuICAgICAgICBsaXN0cy5mb3JFYWNoKGZ1bmN0aW9uKGxpc3QpIHtcbiAgICAgICAgICAgIGxpc3QgPSAkKGxpc3QpO1xuICAgICAgICAgICAgbGlzdC5TaW1wbGVTb3J0ID0gc2ltcGxlU29ydC5jcmVhdGUobGlzdFswXSwge1xuICAgICAgICAgICAgICAgIGhhbmRsZTogJy5mYS1yZW9yZGVyJyxcbiAgICAgICAgICAgICAgICBmaWx0ZXI6ICdbZGF0YS1jb2xsZWN0aW9uLW5vc29ydF0nLFxuICAgICAgICAgICAgICAgIHNjcm9sbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAxNTAsXG4gICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcy5lbCkuYWRkQ2xhc3MoJ2NvbGxlY3Rpb24tc29ydGluZycpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FbmQ6IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQodGhpcy5lbCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2NvbGxlY3Rpb24tc29ydGluZycpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChldnQub2xkSW5kZXggPT09IGV2dC5uZXdJbmRleCkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YUZpZWxkID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpLmZpbmQoJ1tkYXRhLWNvbGxlY3Rpb24tZGF0YV0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhRmllbGQudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNwbGljZShldnQubmV3SW5kZXgsIDAsIGRhdGEuc3BsaWNlKGV2dC5vbGRJbmRleCwgMSlbMF0pO1xuICAgICAgICAgICAgICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjcmVhdGVTb3J0YWJsZXMoKTtcblxuICAgIC8vIGRlbGVnYXRlIHNvcnRhYmxlcyBjb2xsZWN0aW9ucyBmb3IgYWpheCBzdXBwb3J0XG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2VvdmVyJywgJy5jb2xsZWN0aW9uLWxpc3QgdWwnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoIWVsZW1lbnQuU2ltcGxlU29ydCkgeyBjcmVhdGVTb3J0YWJsZXMoZWxlbWVudCk7IH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBuZXcgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNvbGxlY3Rpb24tYWRkbmV3XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBwYXJhbSA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgIGxpc3QgPSBwYXJhbS5maW5kKCd1bCcpLFxuICAgICAgICAgICAgZWRpdGFsbCA9IGxpc3QucGFyZW50KCdbZGF0YS1maWVsZC1uYW1lXScpLmZpbmQoJ1tkYXRhLWNvbGxlY3Rpb24tZWRpdGFsbF0nKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IHBhcmFtLmZpbmQoJ1tkYXRhLWNvbGxlY3Rpb24tZGF0YV0nKSxcbiAgICAgICAgICAgIHRtcGwgPSBwYXJhbS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLXRlbXBsYXRlXScpLFxuICAgICAgICAgICAgaXRlbXMgPSBsaXN0LnNlYXJjaCgnPiBbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJykgfHwgW10sXG4gICAgICAgICAgICBsYXN0ID0gJChsYXN0SXRlbShpdGVtcykpO1xuXG4gICAgICAgIHZhciBjbG9uZSA9ICQodG1wbFswXS5jbG9uZU5vZGUodHJ1ZSkpLCB0aXRsZSwgZWRpdGFibGU7XG5cbiAgICAgICAgaWYgKGxhc3QpIHsgY2xvbmUuYWZ0ZXIobGFzdCk7IH1cbiAgICAgICAgZWxzZSB7IGNsb25lLnRvcChsaXN0KTsgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCAmJiBlZGl0YWxsKSB7IGVkaXRhbGwuc3R5bGUoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7IH1cblxuICAgICAgICB0aXRsZSA9IGNsb25lLmZpbmQoJ2EnKTtcbiAgICAgICAgZWRpdGFibGUgPSB0aXRsZS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKTtcblxuICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCclaWQlJywgJ2cnKTtcbiAgICAgICAgdGl0bGUuaHJlZih0aXRsZS5ocmVmKCkucmVwbGFjZShyZSwgaXRlbXMubGVuZ3RoKSk7XG5cbiAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpLmRhdGEoJ2NvbGxlY3Rpb24taXRlbScsIGNsb25lLmRhdGEoJ2NvbGxlY3Rpb24tdGVtcGxhdGUnKSk7XG4gICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnZGF0YS1jb2xsZWN0aW9uLXRlbXBsYXRlJywgbnVsbCk7XG4gICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnZGF0YS1jb2xsZWN0aW9uLW5vc29ydCcsIG51bGwpO1xuICAgICAgICBlZGl0YWJsZS5Db2xsZWN0aW9uTmV3ID0gdHJ1ZTtcbiAgICAgICAgYm9keS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiB0aXRsZS5zaWJsaW5ncygnW2RhdGEtdGl0bGUtZWRpdF0nKSB9KTtcblxuICAgICAgICBlZGl0YWJsZS5vbigndGl0bGUtZWRpdC1leGl0JywgYWRkTmV3QnlFbnRlcik7XG4gICAgICAgIGJvZHkuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGRhdGFGaWVsZCB9KTtcbiAgICB9KTtcblxuICAgIC8vIEVkaXQgVGl0bGVcbiAgICBib2R5LmRlbGVnYXRlKCdibHVyJywgJ1tkYXRhLWNvbGxlY3Rpb24taXRlbV0gW2RhdGEtdGl0bGUtZWRpdGFibGVdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHRleHQgPSB0cmltKGVsZW1lbnQudGV4dCgpKSxcbiAgICAgICAgICAgIGl0ZW0gPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpLFxuICAgICAgICAgICAga2V5ID0gaXRlbS5kYXRhKCdjb2xsZWN0aW9uLWl0ZW0nKSxcbiAgICAgICAgICAgIGl0ZW1zID0gZWxlbWVudC5wYXJlbnQoJ3VsJykuc2VhcmNoKCc+IFtkYXRhLWNvbGxlY3Rpb24taXRlbV0nKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhID0gZGF0YUZpZWxkLnZhbHVlKCksXG4gICAgICAgICAgICBpbmRleCA9IGluZGV4T2YoaXRlbXMsIGl0ZW1bMF0pO1xuXG4gICAgICAgIGlmIChpbmRleCA9PSAtMSkgeyByZXR1cm47IH1cblxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgaWYgKCFkYXRhW2luZGV4XSkgeyBkYXRhLnNwbGljZShpbmRleCwgMCwge30pOyB9XG4gICAgICAgIGRhdGFbaW5kZXhdW2tleV0gPSB0ZXh0O1xuICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSwgdHJ1ZSk7XG5cbiAgICAvLyBSZW1vdmUgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNvbGxlY3Rpb24tcmVtb3ZlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIHZhciBpdGVtID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWNvbGxlY3Rpb24taXRlbV0nKSxcbiAgICAgICAgICAgIGxpc3QgPSBlbGVtZW50LnBhcmVudCgndWwnKSxcbiAgICAgICAgICAgIGVkaXRhbGwgPSBsaXN0LnBhcmVudCgnW2RhdGEtZmllbGQtbmFtZV0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWVkaXRhbGxdJyksXG4gICAgICAgICAgICBpdGVtcyA9IGxpc3Quc2VhcmNoKCc+IFtkYXRhLWNvbGxlY3Rpb24taXRlbV0nKSxcbiAgICAgICAgICAgIGluZGV4ID0gaW5kZXhPZihpdGVtcywgaXRlbVswXSksXG4gICAgICAgICAgICBkYXRhRmllbGQgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJykuZmluZCgnW2RhdGEtY29sbGVjdGlvbi1kYXRhXScpLFxuICAgICAgICAgICAgZGF0YSA9IGRhdGFGaWVsZC52YWx1ZSgpO1xuXG4gICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgICBkYXRhLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIGRhdGFGaWVsZC52YWx1ZShKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPD0gMiAmJiBlZGl0YWxsKSB7IGVkaXRhbGwuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpOyB9XG4gICAgICAgIGJvZHkuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGRhdGFGaWVsZCB9KTtcbiAgICB9KTtcblxuICAgIC8vIER1cGxpY2F0ZSBpdGVtXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtY29sbGVjdGlvbi1kdXBsaWNhdGVdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgdmFyIHBhcmFtID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpLFxuICAgICAgICAgICAgaXRlbSA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBsaXN0ID0gZWxlbWVudC5wYXJlbnQoJ3VsJyksXG4gICAgICAgICAgICBlZGl0YWxsID0gbGlzdC5wYXJlbnQoJ1tkYXRhLWZpZWxkLW5hbWVdJykuZmluZCgnW2RhdGEtY29sbGVjdGlvbi1lZGl0YWxsXScpLFxuICAgICAgICAgICAgdXJsID0gcGFyYW0uZmluZCgnW2RhdGEtY29sbGVjdGlvbi10ZW1wbGF0ZV0nKS5maW5kKCdhJykuaHJlZigpLFxuICAgICAgICAgICAgaXRlbXMgPSBsaXN0LnNlYXJjaCgnPiBbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBpbmRleCA9IGluZGV4T2YoaXRlbXMsIGl0ZW1bMF0pLFxuICAgICAgICAgICAgY2xvbmUgPSAkKGl0ZW1bMF0uY2xvbmVOb2RlKHRydWUpKS5hZnRlcihpdGVtKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhID0gZGF0YUZpZWxkLnZhbHVlKCk7XG5cbiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgnJWlkJScsICdnJyk7XG4gICAgICAgIGNsb25lLmZpbmQoJ2EnKS5ocmVmKHVybC5yZXBsYWNlKHJlLCBpdGVtcy5sZW5ndGggKyAxKSk7XG5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgIGRhdGEuc3BsaWNlKGluZGV4LCAwLCBkYXRhW2luZGV4XSk7XG4gICAgICAgIGRhdGFGaWVsZC52YWx1ZShKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA+PSAxKSB7IGVkaXRhbGwuc3R5bGUoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7IH1cbiAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gUHJldmVudGluZyBjbGljayBvZiBsaW5rcyB3aGVuIHRpdGxlIGlzIGJlaW5nIGVkaXRlZFxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNvbGxlY3Rpb24taXRlbV0gYScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50LmZpbmQoJ1tjb250ZW50ZWRpdGFibGVdJykpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTG9hZCBpdGVtIHNldHRpbmdzXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtY29sbGVjdGlvbi1pdGVtXSAuY29uZmlnLWNvZywgW2RhdGEtY29sbGVjdGlvbi1lZGl0YWxsXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGVkaXRhYmxlID0gZWxlbWVudC5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKTtcbiAgICAgICAgaWYgKGVkaXRhYmxlICYmIGVkaXRhYmxlLmF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykpIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlzRWRpdEFsbCA9IGVsZW1lbnQuZGF0YSgnY29sbGVjdGlvbi1lZGl0YWxsJykgIT09IG51bGwsXG4gICAgICAgICAgICBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJyksXG4gICAgICAgICAgICBkYXRhRmllbGQgPSBwYXJlbnQuZmluZCgnW2RhdGEtY29sbGVjdGlvbi1kYXRhXScpLFxuICAgICAgICAgICAgZGF0YSA9IGRhdGFGaWVsZC52YWx1ZSgpLFxuICAgICAgICAgICAgaXRlbSA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBpdGVtcyA9IHBhcmVudC5zZWFyY2goJ3VsID4gW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpO1xuXG4gICAgICAgIHZhciBkYXRhUG9zdCA9IHsgZGF0YTogaXNFZGl0QWxsID8gZGF0YSA6IEpTT04uc3RyaW5naWZ5KEpTT04ucGFyc2UoZGF0YSlbaW5kZXhPZihpdGVtcywgaXRlbVswXSldKSB9O1xuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19MT0FESU5HJyksXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2c1LWRpYWxvZy10aGVtZS1kZWZhdWx0IGc1LW1vZGFsLWNvbGxlY3Rpb24gZzUtbW9kYWwtY29sbGVjdGlvbi0nICsgKGlzRWRpdEFsbCA/ICdlZGl0YWxsJyA6ICdzaW5nbGUnKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFQb3N0LFxuICAgICAgICAgICAgb3ZlcmxheUNsaWNrVG9DbG9zZTogZmFsc2UsXG4gICAgICAgICAgICByZW1vdGU6IHBhcnNlQWpheFVSSShlbGVtZW50LmF0dHJpYnV0ZSgnaHJlZicpICsgZ2V0QWpheFN1ZmZpeCgpKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5lbmFibGVDbG9zZUJ5T3ZlcmxheSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBmb3JtID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgZmFrZURPTSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpLmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0ID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnaW5wdXRbdHlwZT1cInN1Ym1pdFwiXSwgYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0sIFtkYXRhLWFwcGx5LWFuZC1zYXZlXScpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWUgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1vZGFsLmdldEFsbCgpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGx5QW5kU2F2ZSA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5zZWFyY2goJ1tkYXRhLWFwcGx5LWFuZC1zYXZlXScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXBwbHlBbmRTYXZlKSB7IGFwcGx5QW5kU2F2ZS5yZW1vdmUoKTsgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChkYXRhVmFsdWUubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogbmVlZCB0byBkZXRlcm1pbmUgYmV0dGVyIGhvdyB0byBoYW5kbGUgc2luZ2xlIGNvbGxlY3Rpb25zIGNhcmRzXG4gICAgICAgICAgICAgICAgICAgIC8vY29udGVudC5lbGVtZW50cy5jb250ZW50LnN0eWxlKHsgd2lkdGg6IDQ1MCB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoKCFmb3JtICYmICFmYWtlRE9NKSB8fCAhc3VibWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENvbGxlY3Rpb24gU2V0dGluZ3MgYXBwbHlcbiAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcblxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gU3VibWl0KGZha2VET01bMF0uZWxlbWVudHMsIGNvbnRlbnQuZWxlbWVudHMuY29udGVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3QuaW52YWxpZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcignZmEgZmEtZncgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfUkVWSUVXX0ZJRUxEUycpLCB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfSU5WQUxJRF9GSUVMRFMnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KGZha2VET00uYXR0cmlidXRlKCdtZXRob2QnKSwgcGFyc2VBamF4VVJJKGZha2VET00uYXR0cmlidXRlKCdhY3Rpb24nKSArIGdldEFqYXhTdWZmaXgoKSksIHBvc3QudmFsaWQuam9pbignJicpIHx8IHt9LCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsgLy8gc2luZ2xlIGVkaXRpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlW2luZGV4T2YoaXRlbXMsIGl0ZW1bMF0pXSA9IHJlc3BvbnNlLmJvZHkuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBtdWx0aSBlZGl0aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZSA9IHJlc3BvbnNlLmJvZHkuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YVZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbS1maWVsZCcpLnNlYXJjaCgndWwgPiBbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJykuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gaXRlbS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBkYXRhVmFsdWVbaW5kZXhdW2l0ZW0uZGF0YSgnY29sbGVjdGlvbi1pdGVtJyldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmRhdGEoJ3RpdGxlLWVkaXRhYmxlJywgdGV4dCkudGV4dCh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYXBwbHkgYW5kIHNhdmUgd2UgYWxzbyBzYXZlIHRoZSBwYW5lbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuZGF0YSgnYXBwbHktYW5kLXNhdmUnKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZSA9ICQoJ2JvZHknKS5maW5kKCcuYnV0dG9uLXNhdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNhdmUpIHsgYm9keS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiBzYXZlIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfR0VORVJJQ19TRVRUSU5HU19BUFBMSUVEJywgJ0NvbGxlY3Rpb24nKSwgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1NFVFRJTkdTX0FQUExJRUQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHt9O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBFbWl0dGVyICAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHJlYWR5ICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHplbiAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcblxuICAgIERyYWdFdmVudHMgPSByZXF1aXJlKCcuLi8uLi91aS9kcmFnLmV2ZW50cycpLFxuXG4gICAgZm9yRWFjaCAgICA9IHJlcXVpcmUoJ21vdXQvY29sbGVjdGlvbi9mb3JFYWNoJyksXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGNsYW1wICAgICAgPSByZXF1aXJlKCdtb3V0L21hdGgvY2xhbXAnKTtcblxudmFyIGlzRmlyZWZveCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdmaXJlZm94JykgPiAtMTtcblxudmFyIE1PVVNFRE9XTiA9IERyYWdFdmVudHMuRVZFTlRTLlNUQVJULFxuICAgIE1PVVNFTU9WRSA9IERyYWdFdmVudHMuRVZFTlRTLk1PVkUsXG4gICAgTU9VU0VVUCAgID0gRHJhZ0V2ZW50cy5FVkVOVFMuU1RPUCxcbiAgICBGT0NVU0lOICAgPSBpc0ZpcmVmb3ggPyAnZm9jdXMnIDogJ2ZvY3VzaW4nO1xuXG52YXIgQ29sb3JQaWNrZXIgPSBuZXcgcHJpbWUoe1xuICAgIG1peGluOiBbT3B0aW9ucywgQm91bmRdLFxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuICAgIG9wdGlvbnM6IHt9LFxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgdGhpcy5idWlsdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmF0dGFjaCgpO1xuICAgIH0sXG5cbiAgICBhdHRhY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgICAgICBNT1VTRURPV04uZm9yRWFjaChiaW5kKGZ1bmN0aW9uKG1vdXNlZG93bikge1xuICAgICAgICAgICAgYm9keS5kZWxlZ2F0ZShtb3VzZWRvd24sICcjZzUtY29udGFpbmVyIC5nLWNvbG9ycGlja2VyIGknLCB0aGlzLmJvdW5kKCdpY29uQ2xpY2snKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBib2R5LmRlbGVnYXRlKEZPQ1VTSU4sICcjZzUtY29udGFpbmVyIC5nLWNvbG9ycGlja2VyIGlucHV0JywgdGhpcy5ib3VuZCgnc2hvdycpLCB0cnVlKTtcblxuXG4gICAgICAgIGJvZHkuZGVsZWdhdGUoJ2tleWRvd24nLCAnI2c1LWNvbnRhaW5lciAuZy1jb2xvcnBpY2tlciBpbnB1dCcsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgOTogLy8gdGFiXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgICAgICAgIGNhc2UgMjc6IC8vIGVzY1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAvLyBVcGRhdGUgb24ga2V5dXBcbiAgICAgICAgYm9keS5kZWxlZ2F0ZSgna2V5dXAnLCAnI2c1LWNvbnRhaW5lciAuZy1jb2xvcnBpY2tlciBpbnB1dCcsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbUlucHV0KHRydWUsIGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgICAgYm9keS5kZWxlZ2F0ZSgncGFzdGUnLCAnI2c1LWNvbnRhaW5lciAuZy1jb2xvcnBpY2tlciBpbnB1dCcsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZyb21JbnB1dCh0cnVlLCBlbGVtZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpLCAxKTtcbiAgICAgICAgfSwgdGhpcykpO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgICAgICBpZiAoIXRoaXMuYnVpbHQpIHtcbiAgICAgICAgICAgIHRoaXMuYnVpbGQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgICAgICB0aGlzLndyYXBwZXIuYWRkQ2xhc3MoJ2NwLXZpc2libGUnKTtcbiAgICAgICAgdGhpcy51cGRhdGVGcm9tSW5wdXQoKTtcblxuICAgICAgICBNT1VTRU1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKG1vdXNlbW92ZSkge1xuICAgICAgICAgICAgYm9keS5vbihtb3VzZW1vdmUsIHRoaXMuYm91bmQoJ2JvZHlNb3ZlJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgTU9VU0VET1dOLmZvckVhY2goYmluZChmdW5jdGlvbihtb3VzZWRvd24pIHtcbiAgICAgICAgICAgIHRoaXMud3JhcHBlci5kZWxlZ2F0ZShtb3VzZWRvd24sICcuY3AtZ3JpZCwgLmNwLXNsaWRlciwgLmNwLW9wYWNpdHktc2xpZGVyJywgdGhpcy5ib3VuZCgnYm9keURvd24nKSk7XG4gICAgICAgICAgICBib2R5Lm9uKG1vdXNlZG93biwgdGhpcy5ib3VuZCgnYm9keUNsaWNrJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgTU9VU0VVUC5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2V1cCkge1xuICAgICAgICAgICAgYm9keS5vbihtb3VzZXVwLCB0aGlzLmJvdW5kKCd0YXJnZXRSZXNldCcpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuICAgIH0sXG5cbiAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmJ1aWx0KSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLndyYXBwZXIucmVtb3ZlQ2xhc3MoJ2NwLXZpc2libGUnKTtcblxuICAgICAgICBNT1VTRU1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKG1vdXNlbW92ZSkge1xuICAgICAgICAgICAgYm9keS5vZmYobW91c2Vtb3ZlLCB0aGlzLmJvdW5kKCdib2R5TW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIE1PVVNFRE9XTi5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2Vkb3duKSB7XG4gICAgICAgICAgICB0aGlzLndyYXBwZXIudW5kZWxlZ2F0ZShtb3VzZWRvd24sICcuY3AtZ3JpZCwgLmNwLXNsaWRlciwgLmNwLW9wYWNpdHktc2xpZGVyJywgdGhpcy5ib3VuZCgnYm9keURvd24nKSk7XG4gICAgICAgICAgICBib2R5Lm9mZihtb3VzZWRvd24sIHRoaXMuYm91bmQoJ2JvZHlDbGljaycpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIE1PVVNFVVAuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKG1vdXNldXApIHtcbiAgICAgICAgICAgIGJvZHkub2ZmKG1vdXNldXAsIHRoaXMuYm91bmQoJ3RhcmdldFJlc2V0JykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGljb25DbGljazogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgaW5wdXQgPSAkKGVsZW1lbnQpLnNpYmxpbmcoJ2lucHV0Jyk7XG4gICAgICAgIGlucHV0WzBdLmZvY3VzKCk7XG5cbiAgICAgICAgdGhpcy5zaG93KGV2ZW50LCBpbnB1dCk7XG4gICAgfSxcblxuICAgIGJvZHlNb3ZlOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmICh0aGlzLnRhcmdldCkgeyB0aGlzLm1vdmUodGhpcy50YXJnZXQsIGV2ZW50KTsgfVxuICAgIH0sXG5cbiAgICBib2R5Q2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmICghdGFyZ2V0LnBhcmVudCgnLmNwLXdyYXBwZXInKSAmJiAhdGFyZ2V0LnBhcmVudCgnLmctY29sb3JwaWNrZXInKSkge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYm9keURvd246IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLm1vdmUodGhpcy50YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICB9LFxuXG4gICAgdGFyZ2V0UmVzZXQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIH0sXG5cbiAgICBtb3ZlOiBmdW5jdGlvbih0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9IHRoaXMuZWxlbWVudCxcbiAgICAgICAgICAgIHBpY2tlciA9IHRhcmdldC5maW5kKCcuY3AtcGlja2VyJyksXG4gICAgICAgICAgICBjbGllbnRSZWN0ID0gdGFyZ2V0WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgb2Zmc2V0WCA9IGNsaWVudFJlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYLFxuICAgICAgICAgICAgb2Zmc2V0WSA9IGNsaWVudFJlY3QudG9wICsgd2luZG93LnNjcm9sbFksXG4gICAgICAgICAgICB4ID0gTWF0aC5yb3VuZCgoZXZlbnQgPyBldmVudC5wYWdlWCA6IDApIC0gb2Zmc2V0WCksXG4gICAgICAgICAgICB5ID0gTWF0aC5yb3VuZCgoZXZlbnQgPyBldmVudC5wYWdlWSA6IDApIC0gb2Zmc2V0WSksXG4gICAgICAgICAgICB3eCwgd3ksIHIsIHBoaTtcblxuICAgICAgICAvLyBUb3VjaCBzdXBwb3J0XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5jaGFuZ2VkVG91Y2hlcykge1xuICAgICAgICAgICAgeCA9IChldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYIDogMCkgLSBvZmZzZXRYO1xuICAgICAgICAgICAgeSA9IChldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogMCkgLSBvZmZzZXRZO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50Lm1hbnVhbE9wYWNpdHkpIHtcbiAgICAgICAgICAgIHkgPSBjbGllbnRSZWN0LmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbnN0cmFpbiBwaWNrZXIgdG8gaXRzIGNvbnRhaW5lclxuICAgICAgICBpZiAoeCA8IDApIHggPSAwO1xuICAgICAgICBpZiAoeSA8IDApIHkgPSAwO1xuICAgICAgICBpZiAoeCA+IGNsaWVudFJlY3Qud2lkdGgpIHggPSBjbGllbnRSZWN0LndpZHRoO1xuICAgICAgICBpZiAoeSA+IGNsaWVudFJlY3QuaGVpZ2h0KSB5ID0gY2xpZW50UmVjdC5oZWlnaHQ7XG5cbiAgICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgICAgaWYgKHRhcmdldC5wYXJlbnQoJy5jcC1tb2RlLXdoZWVsJykgJiYgcGlja2VyLnBhcmVudCgnLmNwLWdyaWQnKSkge1xuICAgICAgICAgICAgd3ggPSA3NSAtIHg7XG4gICAgICAgICAgICB3eSA9IDc1IC0geTtcbiAgICAgICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICAgICAgcGhpID0gTWF0aC5hdGFuMih3eSwgd3gpO1xuXG4gICAgICAgICAgICBpZiAocGhpIDwgMCkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICAgICAgaWYgKHIgPiA3NSkge1xuICAgICAgICAgICAgICAgIHggPSA3NSAtICg3NSAqIE1hdGguY29zKHBoaSkpO1xuICAgICAgICAgICAgICAgIHkgPSA3NSAtICg3NSAqIE1hdGguc2luKHBoaSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgICAgIHkgPSBNYXRoLnJvdW5kKHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW92ZSB0aGUgcGlja2VyXG4gICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoJ2NwLWdyaWQnKSkge1xuICAgICAgICAgICAgcGlja2VyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbVBpY2tlcihpbnB1dCwgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBpY2tlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgdG9wOiB5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbVBpY2tlcihpbnB1dCwgdGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBidWlsZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMud3JhcHBlciA9IHplbignZGl2LmNwLXdyYXBwZXIuY3Atd2l0aC1vcGFjaXR5LmNwLW1vZGUtaHVlJyk7XG4gICAgICAgIHRoaXMuc2xpZGVyID0gemVuKCdkaXYuY3Atc2xpZGVyLmNwLXNwcml0ZScpLmJvdHRvbSh0aGlzLndyYXBwZXIpLmFwcGVuZENoaWxkKHplbignZGl2LmNwLXBpY2tlcicpKTtcbiAgICAgICAgdGhpcy5vcGFjaXR5U2xpZGVyID0gemVuKCdkaXYuY3Atb3BhY2l0eS1zbGlkZXIuY3Atc3ByaXRlJykuYm90dG9tKHRoaXMud3JhcHBlcikuYXBwZW5kQ2hpbGQoemVuKCdkaXYuY3AtcGlja2VyJykpO1xuICAgICAgICB0aGlzLmdyaWQgPSB6ZW4oJ2Rpdi5jcC1ncmlkLmNwLXNwcml0ZScpLmJvdHRvbSh0aGlzLndyYXBwZXIpLmFwcGVuZENoaWxkKHplbignZGl2LmNwLWdyaWQtaW5uZXInKSkuYXBwZW5kQ2hpbGQoemVuKCdkaXYuY3AtcGlja2VyJykpO1xuXG4gICAgICAgIHplbignZGl2JykuYm90dG9tKHRoaXMuZ3JpZC5maW5kKCcuY3AtcGlja2VyJykpO1xuXG4gICAgICAgIHZhciB0YWJzID0gemVuKCdkaXYuY3AtdGFicycpLmJvdHRvbSh0aGlzLndyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMudGFicyA9IHtcbiAgICAgICAgICAgIGh1ZTogemVuKCdkaXYuY3AtdGFiLWh1ZS5hY3RpdmUnKS50ZXh0KCdIVUUnKS5ib3R0b20odGFicyksXG4gICAgICAgICAgICBicmlnaHRuZXNzOiB6ZW4oJ2Rpdi5jcC10YWItYnJpZ2h0bmVzcycpLnRleHQoJ0JSSScpLmJvdHRvbSh0YWJzKSxcbiAgICAgICAgICAgIHNhdHVyYXRpb246IHplbignZGl2LmNwLXRhYi1zYXR1cmF0aW9uJykudGV4dCgnU0FUJykuYm90dG9tKHRhYnMpLFxuICAgICAgICAgICAgd2hlZWw6IHplbignZGl2LmNwLXRhYi13aGVlbCcpLnRleHQoJ1dIRUVMJykuYm90dG9tKHRhYnMpLFxuICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHplbignZGl2LmNwLXRhYi10cmFuc3AnKS50ZXh0KCdUUkFOU1BBUkVOVCcpLmJvdHRvbSh0YWJzKVxuICAgICAgICB9O1xuXG4gICAgICAgIE1PVVNFRE9XTi5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2Vkb3duKSB7XG4gICAgICAgICAgICB0YWJzLmRlbGVnYXRlKG1vdXNlZG93biwgJz4gZGl2JywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50ID09IHRoaXMudGFicy50cmFuc3BhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wYWNpdHkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2xpZGVySGVpZ2h0ID0gdGhpcy5vcGFjaXR5U2xpZGVyLnBvc2l0aW9uKCkuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wYWNpdHlTbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHsgJ3RvcCc6IGNsYW1wKHNsaWRlckhlaWdodCAtIChzbGlkZXJIZWlnaHQgKiB0aGlzLm9wYWNpdHkpLCAwLCBzbGlkZXJIZWlnaHQpIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmUodGhpcy5vcGFjaXR5U2xpZGVyLCB7IG1hbnVhbE9wYWNpdHk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlID0gdGFicy5maW5kKCcuYWN0aXZlJyksXG4gICAgICAgICAgICAgICAgICAgIG1vZGUgPSBhY3RpdmUuYXR0cmlidXRlKCdjbGFzcycpLnJlcGxhY2UoL1xcc3xhY3RpdmV8Y3AtdGFiLS9nLCAnJyksXG4gICAgICAgICAgICAgICAgICAgIG5ld01vZGUgPSBlbGVtZW50LmF0dHJpYnV0ZSgnY2xhc3MnKS5yZXBsYWNlKC9cXHN8YWN0aXZlfGNwLXRhYi0vZywgJycpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy53cmFwcGVyLnJlbW92ZUNsYXNzKCdjcC1tb2RlLScgKyBtb2RlKS5hZGRDbGFzcygnY3AtbW9kZS0nICsgbmV3TW9kZSk7XG4gICAgICAgICAgICAgICAgYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9IG5ld01vZGU7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGcm9tSW5wdXQoKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMud3JhcHBlci5ib3R0b20oJyNnNS1jb250YWluZXInKTtcblxuICAgICAgICB0aGlzLmJ1aWx0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tb2RlID0gJ2h1ZSc7XG4gICAgfSxcblxuICAgIHVwZGF0ZUZyb21JbnB1dDogZnVuY3Rpb24oZG9udEZpcmVFdmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KSB8fCB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQudmFsdWUoKSxcbiAgICAgICAgICAgIG9wYWNpdHkgPSB2YWx1ZS5yZXBsYWNlKC9cXHMvZywgJycpLm1hdGNoKC9ecmdiYT9cXChbMC05XXsxLDN9LFswLTldezEsM30sWzAtOV17MSwzfSwoLispXFwpLyksXG4gICAgICAgICAgICBoZXgsIGhzYjtcblxuICAgICAgICB2YWx1ZSA9IHJnYnN0cjJoZXgodmFsdWUpIHx8IHZhbHVlO1xuICAgICAgICBvcGFjaXR5ID0gb3BhY2l0eSA/IGNsYW1wKG9wYWNpdHlbMV0sIDAsIDEpIDogMTtcblxuICAgICAgICBpZiAoIShoZXggPSBwYXJzZUhleCh2YWx1ZSkpKSB7IGhleCA9ICcjZmZmZmZmJzsgfVxuICAgICAgICBoc2IgPSBoZXgyaHNiKGhleCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYnVpbHQpIHtcbiAgICAgICAgICAgIC8vIG9wYWNpdHlcbiAgICAgICAgICAgIHRoaXMub3BhY2l0eSA9IE1hdGgubWF4KG9wYWNpdHksIDApO1xuICAgICAgICAgICAgdmFyIHNsaWRlckhlaWdodCA9IHRoaXMub3BhY2l0eVNsaWRlci5wb3NpdGlvbigpLmhlaWdodDtcbiAgICAgICAgICAgIHRoaXMub3BhY2l0eVNsaWRlci5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoeyAndG9wJzogY2xhbXAoc2xpZGVySGVpZ2h0IC0gKHNsaWRlckhlaWdodCAqIHRoaXMub3BhY2l0eSksIDAsIHNsaWRlckhlaWdodCkgfSk7XG5cbiAgICAgICAgICAgIC8vIGJnIGNvbG9yXG4gICAgICAgICAgICB2YXIgZ3JpZEhlaWdodCA9IHRoaXMuZ3JpZC5wb3NpdGlvbigpLmhlaWdodCxcbiAgICAgICAgICAgICAgICBncmlkV2lkdGggPSB0aGlzLmdyaWQucG9zaXRpb24oKS53aWR0aCxcbiAgICAgICAgICAgICAgICByLCBwaGksIHgsIHk7XG5cbiAgICAgICAgICAgIHNsaWRlckhlaWdodCA9IHRoaXMuc2xpZGVyLnBvc2l0aW9uKCkuaGVpZ2h0O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMubW9kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3doZWVsJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgciA9IGNsYW1wKE1hdGguY2VpbChoc2IucyAqIDAuNzUpLCAwLCBncmlkSGVpZ2h0IC8gMik7XG4gICAgICAgICAgICAgICAgICAgIHBoaSA9IGhzYi5oICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICAgICAgICAgICAgeCA9IGNsYW1wKDc1IC0gTWF0aC5jb3MocGhpKSAqIHIsIDAsIGdyaWRXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcCg3NSAtIE1hdGguc2luKHBoaSkgKiByLCAwLCBncmlkSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLnN0eWxlKHsgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnIH0pLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeSA9IDE1MCAtIChoc2IuYiAvICgxMDAgLyBncmlkSGVpZ2h0KSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoZXggPT09ICcnKSB5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHsgdG9wOiB5IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBwYW5lbCBjb2xvclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGhzYi5oLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IGhzYi5zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnc2F0dXJhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIHggPSBjbGFtcCgoNSAqIGhzYi5oKSAvIDEyLCAwLCAxNTApO1xuICAgICAgICAgICAgICAgICAgICB5ID0gY2xhbXAoZ3JpZEhlaWdodCAtIE1hdGguY2VpbChoc2IuYiAvICgxMDAgLyBncmlkSGVpZ2h0KSksIDAsIGdyaWRIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICB5ID0gY2xhbXAoc2xpZGVySGVpZ2h0IC0gKGhzYi5zICogKHNsaWRlckhlaWdodCAvIDEwMCkpLCAwLCBzbGlkZXJIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlci5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoeyB0b3A6IHkgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogaHNiLmgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IGhzYi5iXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLmZpbmQoJy5jcC1ncmlkLWlubmVyJykuc3R5bGUoeyBvcGFjaXR5OiBoc2IucyAvIDEwMCB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeCA9IGNsYW1wKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChncmlkSGVpZ2h0IC0gTWF0aC5jZWlsKGhzYi5zIC8gKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgZ3JpZEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgc2xpZGVyIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChzbGlkZXJIZWlnaHQgLSAoaHNiLmIgKiAoc2xpZGVySGVpZ2h0IC8gMTAwKSksIDAsIHNsaWRlckhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7IHRvcDogeSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXIuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBoc2IuaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBoc2IucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOiAxMDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuZmluZCgnLmNwLWdyaWQtaW5uZXInKS5zdHlsZSh7IG9wYWNpdHk6IDEgLSAoaHNiLmIgLyAxMDApIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdodWUnOlxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIHggPSBjbGFtcChNYXRoLmNlaWwoaHNiLnMgLyAoMTAwIC8gZ3JpZFdpZHRoKSksIDAsIGdyaWRXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChncmlkSGVpZ2h0IC0gTWF0aC5jZWlsKGhzYi5iIC8gKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgZ3JpZEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgc2xpZGVyIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChzbGlkZXJIZWlnaHQgLSAoaHNiLmggLyAoMzYwIC8gc2xpZGVySGVpZ2h0KSksIDAsIHNsaWRlckhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7IHRvcDogeSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcGFuZWwgY29sb3JcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogaHNiLmgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFkb250RmlyZUV2ZW50KSB7IGVsZW1lbnQudmFsdWUodGhpcy5nZXRWYWx1ZShoZXgpKTsgfVxuXG4gICAgICAgIHRoaXMuZW1pdCgnY2hhbmdlJywgZWxlbWVudCwgaGV4LCBvcGFjaXR5KTtcblxuICAgIH0sXG5cbiAgICB1cGRhdGVGcm9tUGlja2VyOiBmdW5jdGlvbihpbnB1dCwgdGFyZ2V0KSB7XG4gICAgICAgIHZhciBnZXRDb29yZHMgPSBmdW5jdGlvbihwaWNrZXIsIGNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICB2YXIgbGVmdCwgdG9wO1xuICAgICAgICAgICAgaWYgKCFwaWNrZXIubGVuZ3RoIHx8ICFjb250YWluZXIpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgbGVmdCA9IHBpY2tlclswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgICAgICAgICAgdG9wID0gcGlja2VyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiBsZWZ0IC0gY29udGFpbmVyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyAocGlja2VyWzBdLm9mZnNldFdpZHRoIC8gMiksXG4gICAgICAgICAgICAgICAgeTogdG9wIC0gY29udGFpbmVyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIChwaWNrZXJbMF0ub2Zmc2V0SGVpZ2h0IC8gMilcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaGV4LCBodWUsIHNhdHVyYXRpb24sIGJyaWdodG5lc3MsIHgsIHksIHIsIHBoaSxcblxuICAgICAgICAgICAgLy8gUGFuZWwgb2JqZWN0c1xuICAgICAgICAgICAgZ3JpZCA9IHRoaXMud3JhcHBlci5maW5kKCcuY3AtZ3JpZCcpLFxuICAgICAgICAgICAgc2xpZGVyID0gdGhpcy53cmFwcGVyLmZpbmQoJy5jcC1zbGlkZXInKSxcbiAgICAgICAgICAgIG9wYWNpdHlTbGlkZXIgPSB0aGlzLndyYXBwZXIuZmluZCgnLmNwLW9wYWNpdHktc2xpZGVyJyksXG5cbiAgICAgICAgICAgIC8vIFBpY2tlciBvYmplY3RzXG4gICAgICAgICAgICBncmlkUGlja2VyID0gZ3JpZC5maW5kKCcuY3AtcGlja2VyJyksXG4gICAgICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLFxuICAgICAgICAgICAgb3BhY2l0eVBpY2tlciA9IG9wYWNpdHlTbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLFxuXG4gICAgICAgICAgICAvLyBQaWNrZXIgcG9zaXRpb25zXG4gICAgICAgICAgICBncmlkUG9zID0gZ2V0Q29vcmRzKGdyaWRQaWNrZXIsIGdyaWQpLFxuICAgICAgICAgICAgc2xpZGVyUG9zID0gZ2V0Q29vcmRzKHNsaWRlclBpY2tlciwgc2xpZGVyKSxcbiAgICAgICAgICAgIG9wYWNpdHlQb3MgPSBnZXRDb29yZHMob3BhY2l0eVBpY2tlciwgb3BhY2l0eVNsaWRlciksXG5cbiAgICAgICAgICAgIC8vIFNpemVzXG4gICAgICAgICAgICBncmlkV2lkdGggPSBncmlkWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLFxuICAgICAgICAgICAgZ3JpZEhlaWdodCA9IGdyaWRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0LFxuICAgICAgICAgICAgc2xpZGVySGVpZ2h0ID0gc2xpZGVyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCxcbiAgICAgICAgICAgIG9wYWNpdHlTbGlkZXJIZWlnaHQgPSBvcGFjaXR5U2xpZGVyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcblxuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmVsZW1lbnQudmFsdWUoKTtcbiAgICAgICAgdmFsdWUgPSByZ2JzdHIyaGV4KHZhbHVlKSB8fCB2YWx1ZTtcbiAgICAgICAgaWYgKCEoaGV4ID0gcGFyc2VIZXgodmFsdWUpKSkgeyBoZXggPSAnI2ZmZmZmZic7IH1cblxuICAgICAgICAvLyBIYW5kbGUgY29sb3JzXG4gICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoJ2NwLWdyaWQnKSB8fCB0YXJnZXQuaGFzQ2xhc3MoJ2NwLXNsaWRlcicpKSB7XG5cbiAgICAgICAgICAgIC8vIERldGVybWluZSBIU0IgdmFsdWVzXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMubW9kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3doZWVsJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgeCA9IChncmlkV2lkdGggLyAyKSAtIGdyaWRQb3MueDtcbiAgICAgICAgICAgICAgICAgICAgeSA9IChncmlkSGVpZ2h0IC8gMikgLSBncmlkUG9zLnk7XG4gICAgICAgICAgICAgICAgICAgIHIgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7XG4gICAgICAgICAgICAgICAgICAgIHBoaSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwaGkgPCAwKSBwaGkgKz0gTWF0aC5QSSAqIDI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyID4gNzUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRQb3MueCA9IDY5IC0gKDc1ICogTWF0aC5jb3MocGhpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkUG9zLnkgPSA2OSAtICg3NSAqIE1hdGguc2luKHBoaSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNhdHVyYXRpb24gPSBjbGFtcChyIC8gMC43NSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgaHVlID0gY2xhbXAocGhpICogMTgwIC8gTWF0aC5QSSwgMCwgMzYwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGNsYW1wKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVySGVpZ2h0KSksIDAsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnc2F0dXJhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBodWUsIHNhdHVyYXRpb24sIGFuZCBicmlnaHRuZXNzXG4gICAgICAgICAgICAgICAgICAgIGh1ZSA9IGNsYW1wKHBhcnNlSW50KGdyaWRQb3MueCAqICgzNjAgLyBncmlkV2lkdGgpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICAgICAgICAgIHNhdHVyYXRpb24gPSBjbGFtcCgxMDAgLSBNYXRoLmZsb29yKHNsaWRlclBvcy55ICogKDEwMCAvIHNsaWRlckhlaWdodCkpLCAwLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICBicmlnaHRuZXNzID0gY2xhbXAoMTAwIC0gTWF0aC5mbG9vcihncmlkUG9zLnkgKiAoMTAwIC8gZ3JpZEhlaWdodCkpLCAwLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSVxuICAgICAgICAgICAgICAgICAgICBzbGlkZXIuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBncmlkLmZpbmQoJy5jcC1ncmlkLWlubmVyJykuc3R5bGUoeyBvcGFjaXR5OiBzYXR1cmF0aW9uIC8gMTAwIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICBodWUgPSBjbGFtcChwYXJzZUludChncmlkUG9zLnggKiAoMzYwIC8gZ3JpZFdpZHRoKSwgMTApLCAwLCAzNjApO1xuICAgICAgICAgICAgICAgICAgICBzYXR1cmF0aW9uID0gY2xhbXAoMTAwIC0gTWF0aC5mbG9vcihncmlkUG9zLnkgKiAoMTAwIC8gZ3JpZEhlaWdodCkpLCAwLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICBicmlnaHRuZXNzID0gY2xhbXAoMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXJIZWlnaHQpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgaGV4ID0gaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgYjogYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5maW5kKCcuY3AtZ3JpZC1pbm5lcicpLnN0eWxlKHsgb3BhY2l0eTogMSAtIChicmlnaHRuZXNzIC8gMTAwKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICBodWUgPSBjbGFtcCgzNjAgLSBwYXJzZUludChzbGlkZXJQb3MueSAqICgzNjAgLyBzbGlkZXJIZWlnaHQpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICAgICAgICAgIHNhdHVyYXRpb24gPSBjbGFtcChNYXRoLmZsb29yKGdyaWRQb3MueCAqICgxMDAgLyBncmlkV2lkdGgpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGNsYW1wKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgaGV4ID0gaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgYjogYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBvcGFjaXR5XG4gICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoJ2NwLW9wYWNpdHktc2xpZGVyJykpIHtcbiAgICAgICAgICAgIHRoaXMub3BhY2l0eSA9IE1hdGgubWF4KHBhcnNlRmxvYXQoMSAtIChvcGFjaXR5UG9zLnkgLyBvcGFjaXR5U2xpZGVySGVpZ2h0KSkudG9GaXhlZCgyKSwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGp1c3QgY2FzZVxuICAgICAgICBpbnB1dC52YWx1ZSh0aGlzLmdldFZhbHVlKGhleCkpO1xuXG4gICAgICAgIC8vIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgdGhpcy5lbWl0KCdjaGFuZ2UnLCB0aGlzLmVsZW1lbnQsIGhleCwgdGhpcy5vcGFjaXR5KTtcblxuICAgIH0sXG5cbiAgICByZXBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIGN0ID0gJCgnI2c1LWNvbnRhaW5lcicpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB0aGlzLndyYXBwZXIuc3R5bGUoe1xuICAgICAgICAgICAgdG9wOiBvZmZzZXQudG9wICsgb2Zmc2V0LmhlaWdodCAtIGN0LnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0IC0gY3QubGVmdFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKGhleCkge1xuICAgICAgICBpZiAodGhpcy5vcGFjaXR5ID09IDEpIHsgcmV0dXJuIGhleDsgfVxuICAgICAgICB2YXIgcmdiID0gaGV4MnJnYihoZXgpO1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHRoaXMub3BhY2l0eSArICcpJztcbiAgICB9XG59KTtcblxuLy8gUGFyc2VzIGEgc3RyaW5nIGFuZCByZXR1cm5zIGEgdmFsaWQgaGV4IHN0cmluZyB3aGVuIHBvc3NpYmxlXG52YXIgcGFyc2VIZXggPSBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvW15BLUYwLTldL2lnLCAnJyk7XG4gICAgaWYgKHN0cmluZy5sZW5ndGggIT09IDMgJiYgc3RyaW5nLmxlbmd0aCAhPT0gNikgcmV0dXJuICcnO1xuICAgIGlmIChzdHJpbmcubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHN0cmluZyA9IHN0cmluZ1swXSArIHN0cmluZ1swXSArIHN0cmluZ1sxXSArIHN0cmluZ1sxXSArIHN0cmluZ1syXSArIHN0cmluZ1syXTtcbiAgICB9XG5cbiAgICByZXR1cm4gJyMnICsgc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG59O1xuXG4vLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGFuIFJHQiBvYmplY3RcbnZhciBoc2IycmdiID0gZnVuY3Rpb24oaHNiKSB7XG4gICAgdmFyIHJnYiA9IHt9O1xuICAgIHZhciBoID0gTWF0aC5yb3VuZChoc2IuaCk7XG4gICAgdmFyIHMgPSBNYXRoLnJvdW5kKGhzYi5zICogMjU1IC8gMTAwKTtcbiAgICB2YXIgdiA9IE1hdGgucm91bmQoaHNiLmIgKiAyNTUgLyAxMDApO1xuICAgIGlmIChzID09PSAwKSB7XG4gICAgICAgIHJnYi5yID0gcmdiLmcgPSByZ2IuYiA9IHY7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHQxID0gdjtcbiAgICAgICAgdmFyIHQyID0gKDI1NSAtIHMpICogdiAvIDI1NTtcbiAgICAgICAgdmFyIHQzID0gKHQxIC0gdDIpICogKGggJSA2MCkgLyA2MDtcbiAgICAgICAgaWYgKGggPT09IDM2MCkgaCA9IDA7XG4gICAgICAgIGlmIChoIDwgNjApIHtcbiAgICAgICAgICAgIHJnYi5yID0gdDE7XG4gICAgICAgICAgICByZ2IuYiA9IHQyO1xuICAgICAgICAgICAgcmdiLmcgPSB0MiArIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAxMjApIHtcbiAgICAgICAgICAgIHJnYi5nID0gdDE7XG4gICAgICAgICAgICByZ2IuYiA9IHQyO1xuICAgICAgICAgICAgcmdiLnIgPSB0MSAtIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAxODApIHtcbiAgICAgICAgICAgIHJnYi5nID0gdDE7XG4gICAgICAgICAgICByZ2IuciA9IHQyO1xuICAgICAgICAgICAgcmdiLmIgPSB0MiArIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAyNDApIHtcbiAgICAgICAgICAgIHJnYi5iID0gdDE7XG4gICAgICAgICAgICByZ2IuciA9IHQyO1xuICAgICAgICAgICAgcmdiLmcgPSB0MSAtIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAzMDApIHtcbiAgICAgICAgICAgIHJnYi5iID0gdDE7XG4gICAgICAgICAgICByZ2IuZyA9IHQyO1xuICAgICAgICAgICAgcmdiLnIgPSB0MiArIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAzNjApIHtcbiAgICAgICAgICAgIHJnYi5yID0gdDE7XG4gICAgICAgICAgICByZ2IuZyA9IHQyO1xuICAgICAgICAgICAgcmdiLmIgPSB0MSAtIHQzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmdiLnIgPSAwO1xuICAgICAgICAgICAgcmdiLmcgPSAwO1xuICAgICAgICAgICAgcmdiLmIgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQocmdiLnIpLFxuICAgICAgICBnOiBNYXRoLnJvdW5kKHJnYi5nKSxcbiAgICAgICAgYjogTWF0aC5yb3VuZChyZ2IuYilcbiAgICB9O1xufTtcblxuLy8gQ29udmVydHMgYW4gUkdCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbnZhciByZ2IyaGV4ID0gZnVuY3Rpb24ocmdiKSB7XG4gICAgdmFyIGhleCA9IFtcbiAgICAgICAgcmdiLnIudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuZy50b1N0cmluZygxNiksXG4gICAgICAgIHJnYi5iLnRvU3RyaW5nKDE2KVxuICAgIF07XG5cbiAgICBmb3JFYWNoKGhleCwgZnVuY3Rpb24odmFsLCBucikge1xuICAgICAgICBpZiAodmFsLmxlbmd0aCA9PT0gMSkgaGV4W25yXSA9ICcwJyArIHZhbDtcbiAgICB9KTtcblxuICAgIHJldHVybiAnIycgKyBoZXguam9pbignJyk7XG59O1xuXG52YXIgcmdic3RyMmhleCA9IGZ1bmN0aW9uKHJnYikge1xuICAgIHJnYiA9IHJnYi5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/L2kpO1xuICAgIHJldHVybiAocmdiICYmIHJnYi5sZW5ndGggPT09IDQpID8gXCIjXCIgK1xuICAgIChcIjBcIiArIHBhcnNlSW50KHJnYlsxXSwgMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAoXCIwXCIgKyBwYXJzZUludChyZ2JbMl0sIDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSArXG4gICAgKFwiMFwiICsgcGFyc2VJbnQocmdiWzNdLCAxMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMikgOiAnJztcbn07XG5cbi8vIENvbnZlcnRzIGFuIEhTQiBvYmplY3QgdG8gYSBoZXggc3RyaW5nXG52YXIgaHNiMmhleCA9IGZ1bmN0aW9uKGhzYikge1xuICAgIHJldHVybiByZ2IyaGV4KGhzYjJyZ2IoaHNiKSk7XG59O1xuXG4vLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gSFNCIG9iamVjdFxudmFyIGhleDJoc2IgPSBmdW5jdGlvbihoZXgpIHtcbiAgICB2YXIgaHNiID0gcmdiMmhzYihoZXgycmdiKGhleCkpO1xuICAgIGlmIChoc2IucyA9PT0gMCkgaHNiLmggPSAzNjA7XG4gICAgcmV0dXJuIGhzYjtcbn07XG5cbi8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYW4gSFNCIG9iamVjdFxudmFyIHJnYjJoc2IgPSBmdW5jdGlvbihyZ2IpIHtcbiAgICB2YXIgaHNiID0ge1xuICAgICAgICBoOiAwLFxuICAgICAgICBzOiAwLFxuICAgICAgICBiOiAwXG4gICAgfTtcbiAgICB2YXIgbWluID0gTWF0aC5taW4ocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHJnYi5yLCByZ2IuZywgcmdiLmIpO1xuICAgIHZhciBkZWx0YSA9IG1heCAtIG1pbjtcbiAgICBoc2IuYiA9IG1heDtcbiAgICBoc2IucyA9IG1heCAhPT0gMCA/IDI1NSAqIGRlbHRhIC8gbWF4IDogMDtcbiAgICBpZiAoaHNiLnMgIT09IDApIHtcbiAgICAgICAgaWYgKHJnYi5yID09PSBtYXgpIHtcbiAgICAgICAgICAgIGhzYi5oID0gKHJnYi5nIC0gcmdiLmIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSBpZiAocmdiLmcgPT09IG1heCkge1xuICAgICAgICAgICAgaHNiLmggPSAyICsgKHJnYi5iIC0gcmdiLnIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoc2IuaCA9IDQgKyAocmdiLnIgLSByZ2IuZykgLyBkZWx0YTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGhzYi5oID0gLTE7XG4gICAgfVxuICAgIGhzYi5oICo9IDYwO1xuICAgIGlmIChoc2IuaCA8IDApIHtcbiAgICAgICAgaHNiLmggKz0gMzYwO1xuICAgIH1cbiAgICBoc2IucyAqPSAxMDAgLyAyNTU7XG4gICAgaHNiLmIgKj0gMTAwIC8gMjU1O1xuICAgIHJldHVybiBoc2I7XG59O1xuXG4vLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gUkdCIG9iamVjdFxudmFyIGhleDJyZ2IgPSBmdW5jdGlvbihoZXgpIHtcbiAgICBoZXggPSBwYXJzZUludCgoKGhleC5pbmRleE9mKCcjJykgPiAtMSkgPyBoZXguc3Vic3RyaW5nKDEpIDogaGV4KSwgMTYpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbiAgICAgICAgcjogaGV4ID4+IDE2LFxuICAgICAgICBnOiAoaGV4ICYgMHgwMEZGMDApID4+IDgsXG4gICAgICAgIGI6IChoZXggJiAweDAwMDBGRilcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiAgICB9O1xufTtcblxuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgeCA9IG5ldyBDb2xvclBpY2tlcigpLCBib2R5ID0gJCgnYm9keScpO1xuICAgIHgub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGVsZW1lbnQsIGhleCwgb3BhY2l0eSkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XG4gICAgICAgIHZhciByZ2IgPSBoZXgycmdiKGhleCksXG4gICAgICAgICAgICB5aXEgPSAoKChyZ2IuciAqIDI5OSkgKyAocmdiLmcgKiA1ODcpICsgKHJnYi5iICogMTE0KSkgLyAxMDAwKSA+PSAxMjggPyAnZGFyaycgOiAnbGlnaHQnLFxuICAgICAgICAgICAgY2hlY2sgPSB5aXEgPT0gJ2RhcmsnIHx8ICghb3BhY2l0eSB8fCBvcGFjaXR5IDwgMC4zNSk7XG5cbiAgICAgICAgaWYgKG9wYWNpdHkgPCAxKSB7XG4gICAgICAgICAgICB2YXIgc3RyID0gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIG9wYWNpdHkgKyAnKSc7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlKHsgYmFja2dyb3VuZENvbG9yOiBzdHIgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlKHsgYmFja2dyb3VuZENvbG9yOiBoZXggfSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnBhcmVudCgnLmctY29sb3JwaWNrZXInKVshY2hlY2sgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2xpZ2h0LXRleHQnKTtcblxuICAgICAgICB0aGlzLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuZW1pdCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnaW5wdXQnLCB7IHRhcmdldDogZWxlbWVudCB9KTtcbiAgICAgICAgfSwgMTUwKTtcblxuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQ29sb3JQaWNrZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyICQgICAgICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIHByaW1lICAgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuICAgIHplbiAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBkb21yZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICBiaW5kICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgcnRyaW0gICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3J0cmltJyksXG4gICAgZGVlcENsb25lICAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwQ2xvbmUnKSxcbiAgICBkZWVwRmlsbEluICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZGVlcEZpbGxJbicpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLm1vZGFsLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBwYXJzZUFqYXhVUkkgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFVSTCAgICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmdsb2JhbCxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyksXG4gICAgZHJvcHpvbmUgICAgICA9IHJlcXVpcmUoJ2Ryb3B6b25lJyk7XG5cbnZhciBGaWxlUGlja2VyID0gbmV3IHByaW1lKHtcbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YSgnZzUtZmlsZXBpY2tlcicpLCB2YWx1ZTtcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YSA/IEpTT04ucGFyc2UoZGF0YSkgOiBmYWxzZTtcblxuICAgICAgICBpZiAodGhpcy5kYXRhICYmICF0aGlzLmRhdGEudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS52YWx1ZSA9ICQodGhpcy5kYXRhLmZpZWxkKS52YWx1ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb2xvcnMgPSB7XG4gICAgICAgICAgICBlcnJvcjogJyNEODQ3NDcnLFxuICAgICAgICAgICAgc3VjY2VzczogJyM5QURGODcnLFxuICAgICAgICAgICAgc21hbGw6ICcjYWFhYWFhJyxcbiAgICAgICAgICAgIGdyYWRpZW50OiBbJyM5ZTM4ZWInLCAnIzRlNjhmYyddXG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmRhdGEpO1xuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5kYXRhLnZhbHVlID0gJCh0aGlzLmRhdGEuZmllbGQpLnZhbHVlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLFxuICAgICAgICAgICAgY29udGVudDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xPQURJTkcnKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2c1LWRpYWxvZy10aGVtZS1kZWZhdWx0IGc1LW1vZGFsLWZpbGVwaWNrZXInLFxuICAgICAgICAgICAgcmVtb3RlOiBwYXJzZUFqYXhVUkkoZ2V0QWpheFVSTCgnZmlsZXBpY2tlcicpICsgZ2V0QWpheFN1ZmZpeCgpKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogYmluZCh0aGlzLmxvYWRlZCwgdGhpcyksXG4gICAgICAgICAgICBhZnRlckNsb3NlOiBiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRyb3B6b25lKSB7IHRoaXMuZHJvcHpvbmUuZGVzdHJveSgpOyB9XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0UGF0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhY3RpdmVzID0gdGhpcy5jb250ZW50LnNlYXJjaCgnLmctZm9sZGVycyAuYWN0aXZlJyksIGFjdGl2ZSwgcGF0aDtcbiAgICAgICAgaWYgKCFhY3RpdmVzKSB7IHJldHVybiBudWxsOyB9XG5cbiAgICAgICAgYWN0aXZlID0gJChhY3RpdmVzW2FjdGl2ZXMubGVuZ3RoIC0gMV0pO1xuICAgICAgICBwYXRoID0gSlNPTi5wYXJzZShhY3RpdmUuZGF0YSgnZm9sZGVyJykpLnBhdGhuYW1lO1xuICAgICAgICByZXR1cm4gcGF0aC5yZXBsYWNlKC9cXC8kLywgJycpICsgJy8nO1xuICAgIH0sXG5cbiAgICBnZXRQcmV2aWV3VGVtcGxhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGkgICAgPSB6ZW4oJ2xpW2RhdGEtZmlsZV0nKSxcbiAgICAgICAgICAgIGRlbCAgID0gemVuKCdzcGFuLmctZmlsZS1kZWxldGVbZGF0YS1nLWZpbGUtZGVsZXRlXVtkYXRhLWR6LXJlbW92ZV0nKS5odG1sKCc8aSBjbGFzcz1cImZhIGZhLWZ3IGZhLXRyYXNoLW9cIj48L2k+JykuYm90dG9tKGxpKSxcbiAgICAgICAgICAgIHRodW1iID0gemVuKCdkaXYuZy10aHVtYltkYXRhLWR6LXRodW1ibmFpbF0nKS5ib3R0b20obGkpLFxuICAgICAgICAgICAgbmFtZSAgPSB6ZW4oJ3NwYW4uZy1maWxlLW5hbWVbZGF0YS1kei1uYW1lXScpLmJvdHRvbShsaSksXG4gICAgICAgICAgICBzaXplICA9IHplbignc3Bhbi5nLWZpbGUtc2l6ZVtkYXRhLWR6LXNpemVdJykuYm90dG9tKGxpKSxcbiAgICAgICAgICAgIG10aW1lID0gemVuKCdzcGFuLmctZmlsZS1tdGltZVtkYXRhLWR6LW10aW1lXScpLmJvdHRvbShsaSk7XG5cbiAgICAgICAgemVuKCdzcGFuLmctZmlsZS1wcm9ncmVzc1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJykuaHRtbCgnPHNwYW4gY2xhc3M9XCJnLWZpbGUtcHJvZ3Jlc3MtdGV4dFwiPjwvc3Bhbj4nKS5ib3R0b20obGkpO1xuICAgICAgICB6ZW4oJ2RpdicpLmJvdHRvbSh0aHVtYik7XG5cbiAgICAgICAgbGkuYm90dG9tKCdib2R5Jyk7XG4gICAgICAgIHZhciBodG1sID0gbGlbMF0ub3V0ZXJIVE1MO1xuICAgICAgICBsaS5yZW1vdmUoKTtcblxuICAgICAgICByZXR1cm4gaHRtbDtcbiAgICB9LFxuXG4gICAgbG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgbW9kYWxJbnN0YW5jZSkge1xuICAgICAgICB2YXIgY29udGVudCAgID0gbW9kYWxJbnN0YW5jZS5lbGVtZW50cy5jb250ZW50LFxuICAgICAgICAgICAgYm9va21hcmtzID0gY29udGVudC5zZWFyY2goJy5nLWJvb2ttYXJrJyksXG4gICAgICAgICAgICBmaWxlcyAgICAgPSBjb250ZW50LmZpbmQoJy5nLWZpbGVzJyksXG4gICAgICAgICAgICBmaWVsZERhdGEgPSBkZWVwQ2xvbmUodGhpcy5kYXRhKSxcbiAgICAgICAgICAgIGNvbG9ycyAgICA9IHRoaXMuY29sb3JzLFxuICAgICAgICAgICAgc2VsZiAgICAgID0gdGhpcztcblxuICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xuXG4gICAgICAgIGlmIChmaWxlcykge1xuICAgICAgICAgICAgdGhpcy5kcm9wem9uZSA9IG5ldyBkcm9wem9uZSgnYm9keScsIHtcbiAgICAgICAgICAgICAgICBwcmV2aWV3VGVtcGxhdGU6IHRoaXMuZ2V0UHJldmlld1RlbXBsYXRlKCksXG4gICAgICAgICAgICAgICAgcHJldmlld3NDb250YWluZXI6IGZpbGVzLmZpbmQoJ3VsOm5vdCguZy1saXN0LWxhYmVscyknKVswXSxcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxXaWR0aDogMTAwLFxuICAgICAgICAgICAgICAgIHRodW1ibmFpbEhlaWdodDogMTAwLFxuICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogJ1tkYXRhLXVwbG9hZF0nLFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkRmlsZXM6IHRoaXMuYWNjZXB0ZWRGaWxlcyh0aGlzLmRhdGEuZmlsdGVyKSB8fCAnJyxcbiAgICAgICAgICAgICAgICBhY2NlcHQ6IGJpbmQoZnVuY3Rpb24oZmlsZSwgZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5maWx0ZXIpIHsgZG9uZSgpOyB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUubmFtZS5tYXRjaCh0aGlzLmRhdGEuZmlsdGVyKSkgeyBkb25lKCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBkb25lKCc8Y29kZT4nICsgZmlsZS5uYW1lICsgJzwvY29kZT4gJyArIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19GSUxURVJfTUlTTUFUQ0gnKSArICc6IDxiciAvPiAgPGNvZGU+JyArIHRoaXMuZGF0YS5maWx0ZXIgKyAnPC9jb2RlPicpOyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB0aGlzKSxcbiAgICAgICAgICAgICAgICB1cmw6IGJpbmQoZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VBamF4VVJJKGdldEFqYXhVUkwoJ2ZpbGVwaWNrZXIvdXBsb2FkLycgKyBnbG9iYWwuYnRvYShlbmNvZGVVUklDb21wb25lbnQodGhpcy5nZXRQYXRoKCkgKyBmaWxlWzBdLm5hbWUpKSkgKyBnZXRBamF4U3VmZml4KCkpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZHJvcHpvbmUgZXZlbnRzXG4gICAgICAgICAgICB0aGlzLmRyb3B6b25lLm9uKCd0aHVtYm5haWwnLCBmdW5jdGlvbihmaWxlLCBkYXRhVXJsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dCA9IGZpbGUubmFtZS5zcGxpdCgnLicpO1xuICAgICAgICAgICAgICAgIGV4dCA9ICghZXh0Lmxlbmd0aCB8fCBleHQubGVuZ3RoID09IDEpID8gJy0nIDogZXh0LnJldmVyc2UoKVswXTtcbiAgICAgICAgICAgICAgICAkKGZpbGUucHJldmlld0VsZW1lbnQpLmFkZENsYXNzKCdnLWltYWdlIGctaW1hZ2UtJyArIGV4dC50b0xvd2VyQ2FzZSgpKS5maW5kKCdbZGF0YS1kei10aHVtYm5haWxdID4gZGl2JykuYXR0cmlidXRlKCdzdHlsZScsICdiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyArIGVuY29kZVVSSShkYXRhVXJsKSArICcpOycpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuZHJvcHpvbmUub24oJ2FkZGVkZmlsZScsIGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCAgICAgID0gJChmaWxlLnByZXZpZXdFbGVtZW50KSxcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIgICAgID0gZWxlbWVudC5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLFxuICAgICAgICAgICAgICAgICAgICBpc0xpc3QgICAgICAgPSBmaWxlcy5oYXNDbGFzcygnZy1maWxlbW9kZS1saXN0JyksXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQ29uZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydExvY2F0aW9uOiAnYm90dG9tJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGV4dCA9IGZpbGUubmFtZS5zcGxpdCgnLicpO1xuICAgICAgICAgICAgICAgIGV4dCA9ICghZXh0Lmxlbmd0aCB8fCBleHQubGVuZ3RoID09IDEpID8gJy0nIDogZXh0LnJldmVyc2UoKVswXTtcblxuICAgICAgICAgICAgICAgIGlmICghZmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZy10aHVtYicpLnRleHQoZXh0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5nLXRodW1iJykuYWRkQ2xhc3MoJ2ctaW1hZ2UgZy1pbWFnZS0nICsgZXh0LnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByb2dyZXNzQ29uZiA9IGRlZXBGaWxsSW4oKGlzTGlzdCA/IHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogMjAsXG4gICAgICAgICAgICAgICAgICAgIHRoaWNrbmVzczogMTAsXG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuc21hbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDUwLFxuICAgICAgICAgICAgICAgICAgICB0aGlja25lc3M6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQ6IGNvbG9ycy5ncmFkaWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSksIHByb2dyZXNzQ29uZik7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdnLWZpbGUtdXBsb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXIucHJvZ3Jlc3Nlcihwcm9ncmVzc0NvbmYpO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyLmF0dHJpYnV0ZSgndGl0bGUnLCB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfUFJPQ0VTU0lORycpKS5maW5kKCcuZy1maWxlLXByb2dyZXNzLXRleHQnKS5odG1sKCcmYnVsbDsmYnVsbDsmYnVsbDsnKS5hdHRyaWJ1dGUoJ3RpdGxlJywgdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1BST0NFU1NJTkcnKSk7XG5cbiAgICAgICAgICAgIH0pLm9uKCdwcm9jZXNzaW5nJywgZnVuY3Rpb24oZmlsZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGZpbGUucHJldmlld0VsZW1lbnQpLmZpbmQoJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZy1maWxlLXByb2dyZXNzLXRleHQnKS50ZXh0KCcwJScpLmF0dHJpYnV0ZSgndGl0bGUnLCAnMCUnKTtcblxuICAgICAgICAgICAgfSkub24oJ3NlbmRpbmcnLCBmdW5jdGlvbihmaWxlLCB4aHIsIGZvcm1EYXRhKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoZmlsZS5wcmV2aWV3RWxlbWVudCkuZmluZCgnW2RhdGEtZmlsZS11cGxvYWRwcm9ncmVzc10nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgndGl0bGUnLCAnMCUnKS5maW5kKCcuZy1maWxlLXByb2dyZXNzLXRleHQnKS50ZXh0KCcwJScpLmF0dHJpYnV0ZSgndGl0bGUnLCAnMCUnKTtcblxuICAgICAgICAgICAgfSkub24oJ3VwbG9hZHByb2dyZXNzJywgZnVuY3Rpb24oZmlsZSwgcHJvZ3Jlc3MsIGJ5dGVzU2VudCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGZpbGUucHJldmlld0VsZW1lbnQpLmZpbmQoJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wcm9ncmVzc2VyKHsgdmFsdWU6IHByb2dyZXNzIC8gMTAwIH0pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCd0aXRsZScsIE1hdGgucm91bmQocHJvZ3Jlc3MpICsgJyUnKS5maW5kKCcuZy1maWxlLXByb2dyZXNzLXRleHQnKS50ZXh0KE1hdGgucm91bmQocHJvZ3Jlc3MpICsgJyUnKS5hdHRyaWJ1dGUoJ3RpdGxlJywgTWF0aC5yb3VuZChwcm9ncmVzcykgKyAnJScpO1xuXG4gICAgICAgICAgICB9KS5vbignY29tcGxldGUnLCBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZWZyZXNoRmlsZXMoY29udGVudCk7XG4gICAgICAgICAgICB9KS5vbignZXJyb3InLCBmdW5jdGlvbihmaWxlLCBlcnJvcikge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ICA9ICQoZmlsZS5wcmV2aWV3RWxlbWVudCksXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyID0gZWxlbWVudC5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICAgICA9IGVsZW1lbnQuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JyksXG4gICAgICAgICAgICAgICAgICAgIGlzTGlzdCAgID0gZmlsZXMuaGFzQ2xhc3MoJ2ctZmlsZW1vZGUtbGlzdCcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZy1maWxlLWVycm9yJyk7XG5cbiAgICAgICAgICAgICAgICB1cGxvYWRlci50aXRsZSgnRXJyb3InKS5wcm9ncmVzc2VyKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiBpc0xpc3QgPyAxMCA6IDI1XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0ZXh0LnRpdGxlKCdFcnJvcicpLmh0bWwoJzxpIGNsYXNzPVwiZmEgZmEtZXhjbGFtYXRpb25cIj48L2k+JykucGFyZW50KCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBlcnJvci5odG1sID8gZXJyb3IuaHRtbCA6IChlcnJvci5lcnJvciAmJiBlcnJvci5lcnJvci5tZXNzYWdlID8gZXJyb3IuZXJyb3IubWVzc2FnZSA6IGVycm9yKSxcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnZmlsZXBpY2tlciwgYWJvdmUtbW9kYWwnLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFdmVudHM6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pLm9uKCdzdWNjZXNzJywgZnVuY3Rpb24oZmlsZSwgcmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ICA9ICQoZmlsZS5wcmV2aWV3RWxlbWVudCksXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyID0gZWxlbWVudC5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLFxuICAgICAgICAgICAgICAgICAgICBtdGltZSAgICA9IGVsZW1lbnQuZmluZCgnLmctZmlsZS1tdGltZScpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICAgICA9IGVsZW1lbnQuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JyksXG4gICAgICAgICAgICAgICAgICAgIHRodW1iICAgID0gZWxlbWVudC5maW5kKCcuZy10aHVtYicpLFxuICAgICAgICAgICAgICAgICAgICBpc0xpc3QgICA9IGZpbGVzLmhhc0NsYXNzKCdnLWZpbGVtb2RlLWxpc3QnKTtcblxuICAgICAgICAgICAgICAgIHVwbG9hZGVyLnByb2dyZXNzZXIoe1xuICAgICAgICAgICAgICAgICAgICBmaWxsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLnN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRoaWNrbmVzczogaXNMaXN0ID8gMTAgOiAyNVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGV4dC5odG1sKCc8aSBjbGFzcz1cImZhIGZhLWNoZWNrXCI+PC9pPicpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCB7IGR1cmF0aW9uOiA1MDAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRodW1iLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdmaWxlJywgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZmluZm8pKS5kYXRhKCdmaWxlLXVybCcsIHJlc3BvbnNlLnVybCkucmVtb3ZlQ2xhc3MoJ2ctZmlsZS11cGxvYWRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRyb3B6b25lID0gZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdGltZS50ZXh0KHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KVVNUX05PVycpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIDUwMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGc1IGV2ZW50c1xuICAgICAgICBjb250ZW50LmRlbGVnYXRlKCdjbGljaycsICcuZy1ib29rbWFyay10aXRsZScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgdmFyIHNpYmxpbmcgPSBlbGVtZW50Lm5leHRTaWJsaW5nKCcuZy1mb2xkZXJzJyksXG4gICAgICAgICAgICAgICAgcGFyZW50ICA9IGVsZW1lbnQucGFyZW50KCcuZy1ib29rbWFyaycpO1xuXG4gICAgICAgICAgICBpZiAoIXNpYmxpbmcpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBzaWJsaW5nLnNsaWRlVG9nZ2xlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBhcmVudC50b2dnbGVDbGFzcygnY29sbGFwc2VkJywgc2libGluZy5nU2xpZGVDb2xsYXBzZWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWZvbGRlcl0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgdmFyIGRhdGEgICAgID0gSlNPTi5wYXJzZShlbGVtZW50LmRhdGEoJ2ZvbGRlcicpKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9ICQoJ1tkYXRhLWZpbGVdLnNlbGVjdGVkJyk7XG5cbiAgICAgICAgICAgIGZpZWxkRGF0YS5yb290ID0gZGF0YS5wYXRobmFtZTtcbiAgICAgICAgICAgIGZpZWxkRGF0YS52YWx1ZSA9IHNlbGVjdGVkID8gc2VsZWN0ZWQuZGF0YSgnZmlsZS11cmwnKSA6IGZhbHNlO1xuICAgICAgICAgICAgZmllbGREYXRhLnN1YmZvbGRlciA9IHRydWU7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuc2hvd0luZGljYXRvcignZmEgZmEtbGkgZmEtZncgZmEtc3Bpbi1mYXN0IGZhLXNwaW5uZXInKTtcbiAgICAgICAgICAgIHJlcXVlc3QocGFyc2VBamF4VVJJKGdldEFqYXhVUkwoJ2ZpbGVwaWNrZXInKSArIGdldEFqYXhTdWZmaXgoKSksIGZpZWxkRGF0YSkuc2VuZChiaW5kKGZ1bmN0aW9uKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkQWN0aXZlU3RhdGUoZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR1bW15LCBuZXh0O1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuYm9keS5zdWJmb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1bW15ID0gemVuKCdkaXYnKS5odG1sKHJlc3BvbnNlLmJvZHkuc3ViZm9sZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgPSBlbGVtZW50Lm5leHRTaWJsaW5nKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmICFuZXh0LmF0dHJpYnV0ZSgnZGF0YS1mb2xkZXInKSkgeyBuZXh0LnJlbW92ZSgpOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkdW1teS5jaGlsZHJlbigpLmFmdGVyKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkuZmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdW1teSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5LmZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1bW15LmNoaWxkcmVuKCkuYm90dG9tKGZpbGVzKS5zdHlsZSh7IG9wYWNpdHk6IDAgfSkuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgeyBkdXJhdGlvbjogJzI1MG1zJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLmZpbmQoJz4gdWw6bm90KC5nLWxpc3QtbGFiZWxzKScpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3B6b25lLnByZXZpZXdzQ29udGFpbmVyID0gZmlsZXMuZmluZCgndWw6bm90KC5nLWxpc3QtbGFiZWxzKScpWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWctZmlsZS1wcmV2aWV3XScsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgICAgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtZmlsZV0nKSxcbiAgICAgICAgICAgICAgICBkYXRhICAgICAgPSBKU09OLnBhcnNlKHBhcmVudC5kYXRhKCdmaWxlJykpO1xuXG4gICAgICAgICAgICBpZiAoZGF0YS5pc0ltYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRodW1iID0gcGFyZW50LmZpbmQoJy5nLXRodW1iID4gZGl2Jyk7XG4gICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2c1LWRpYWxvZy10aGVtZS1kZWZhdWx0IGc1LW1vZGFsLWZpbGVwcmV2aWV3IGNlbnRlcicsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICc8aW1nIHNyYz1cIicgKyB0aHVtYlswXS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2Uuc2xpY2UoNCwgLTEpLnJlcGxhY2UoL1wiL2csICcnKSArICdcIiAvPidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWctZmlsZS1kZWxldGVdJywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgICAgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtZmlsZV0nKSxcbiAgICAgICAgICAgICAgICBkYXRhICAgICAgPSBKU09OLnBhcnNlKHBhcmVudC5kYXRhKCdmaWxlJykpLFxuICAgICAgICAgICAgICAgIGRlbGV0ZVVSSSA9IHBhcnNlQWpheFVSSShnZXRBamF4VVJMKCdmaWxlcGlja2VyLycgKyBnbG9iYWwuYnRvYShlbmNvZGVVUklDb21wb25lbnQoZGF0YS5wYXRobmFtZSkpICsgZ2V0QWpheFN1ZmZpeCgpKSk7XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5pc0luQ3VzdG9tKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICByZXF1ZXN0KCdkZWxldGUnLCBkZWxldGVVUkksIGZ1bmN0aW9uKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQuYWRkQ2xhc3MoJ2ctZmlsZS1kZWxldGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVmcmVzaEZpbGVzKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9LCAyMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgY29udGVudC5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZmlsZV0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgICByZW1vdmUgPSB0YXJnZXQuZGF0YSgnZy1maWxlLWRlbGV0ZScpICE9PSBudWxsIHx8IHRhcmdldC5wYXJlbnQoJ1tkYXRhLWctZmlsZS1kZWxldGVdJyksXG4gICAgICAgICAgICAgICAgcHJldmlldyA9IHRhcmdldC5kYXRhKCdnLWZpbGUtcHJldmlldycpICE9PSBudWxsIHx8IHRhcmdldC5wYXJlbnQoJ1tkYXRhLWctZmlsZS1wcmV2aWV3XScpO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcygnZy1maWxlLWVycm9yJykgfHwgZWxlbWVudC5oYXNDbGFzcygnZy1maWxlLXVwbG9hZGluZycpIHx8IHJlbW92ZSB8fCBwcmV2aWV3KSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZmlsZScpKTtcblxuICAgICAgICAgICAgZmlsZXMuc2VhcmNoKCdbZGF0YS1maWxlXScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLXNlbGVjdF0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gZmlsZXMuZmluZCgnW2RhdGEtZmlsZV0uc2VsZWN0ZWQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZSAgICA9IHNlbGVjdGVkID8gc2VsZWN0ZWQuZGF0YSgnZmlsZS11cmwnKSA6ICcnO1xuXG4gICAgICAgICAgICAkKHRoaXMuZGF0YS5maWVsZCkudmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWZpbGVzLW1vZGVdJywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdmFyIG1vZGVzID0gJCgnW2RhdGEtZmlsZXMtbW9kZV0nKTtcbiAgICAgICAgICAgIG1vZGVzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBmaWxlcy5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCB7XG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMCxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RlICAgICAgICAgICA9IGVsZW1lbnQuZGF0YSgnZmlsZXMtbW9kZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkUHJvZ3Jlc3MgPSBmaWxlcy5zZWFyY2goJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0NvbmYgICA9IChtb2RlID09ICdsaXN0JykgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuc21hbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogNTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudDogY29sb3JzLmdyYWRpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICAgICAgICAgZmlsZXMuYXR0cmlidXRlKCdjbGFzcycsICdnLWZpbGVzIGctYmxvY2sgZy1maWxlbW9kZS0nICsgbW9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWRQcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkUHJvZ3Jlc3MuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGRlZXBDbG9uZShwcm9ncmVzc0NvbmYpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50KCcuZy1maWxlLWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmZpbGwgPSB7IGNvbG9yOiBjb2xvcnMuZXJyb3IgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLnZhbHVlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLnRoaWNrbmVzcyA9IG1vZGUgPT0gJ2xpc3QnID8gMTAgOiAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnByb2dyZXNzZXIoY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIHsgZHVyYXRpb246IDIwMCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGFkZEFjdGl2ZVN0YXRlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBvcGVuZWQgPSB0aGlzLmNvbnRlbnQuc2VhcmNoKCdbZGF0YS1mb2xkZXJdLmFjdGl2ZSwgLmctZm9sZGVycyA+IC5hY3RpdmUnKSwgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgaWYgKG9wZW5lZCkgeyBvcGVuZWQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgd2hpbGUgKHBhcmVudC50YWcoKSA9PSAndWwnICYmICFwYXJlbnQuaGFzQ2xhc3MoJ2ctZm9sZGVycycpKSB7XG4gICAgICAgICAgICBwYXJlbnQucHJldmlvdXNTaWJsaW5nKCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFjY2VwdGVkRmlsZXM6IGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICB2YXIgYXR0ciA9ICcnO1xuICAgICAgICBzd2l0Y2ggKGZpbHRlcikge1xuICAgICAgICAgICAgY2FzZSAnLihqcGU/Z3xnaWZ8cG5nfHN2ZykkJzpcbiAgICAgICAgICAgICAgICBhdHRyID0gJy5qcGcsLmpwZWcsLmdpZiwucG5nLC5zdmcnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnLihtcDR8d2VibXxvZ3Z8bW92KSQnOlxuICAgICAgICAgICAgICAgIGF0dHIgPSAnLm1wNCwud2VibSwub2d2LC5tb3YnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGF0dHI7XG4gICAgfSxcblxuICAgIHJlZnJlc2hGaWxlczogZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICB2YXIgYWN0aXZlID0gJCgnW2RhdGEtZm9sZGVyXS5hY3RpdmUnKSxcbiAgICAgICAgICAgIGZvbGRlciA9IGFjdGl2ZVthY3RpdmUubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChmb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnRlbnQuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogJChmb2xkZXIpIH0pO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbmRvbXJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWc1LWZpbGVwaWNrZXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGlmICghZWxlbWVudC5HYW50cnlGaWxlUGlja2VyKSB7XG4gICAgICAgICAgICBlbGVtZW50LkdhbnRyeUZpbGVQaWNrZXIgPSBuZXcgRmlsZVBpY2tlcihlbGVtZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnQuR2FudHJ5RmlsZVBpY2tlci5vcGVuKCk7XG4gICAgfSk7XG59KTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IEZpbGVQaWNrZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIGZvbnRzIGxpc3Q6IGh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3dlYmZvbnRzL3YxL3dlYmZvbnRzP2tleT1BSXphU3lCMnlKTThEQnd0NjZ1Mk1WUmdiNk00dDlDcWtXN19JUllcbnZhciBwcmltZSAgICAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgc3RvcmFnZSAgICAgICA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpKCksXG4gICAgRW1pdHRlciAgICAgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIE9wdGlvbnMgICAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICBkb21yZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcblxuICAgIGRlY291cGxlICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9kZWNvdXBsZScpLFxuXG4gICAgYmluZCAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIG1hcCAgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L21hcCcpLFxuICAgIGZvckVhY2ggICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2ZvckVhY2gnKSxcbiAgICBjb250YWlucyAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpLFxuICAgIGxhc3QgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2xhc3QnKSxcbiAgICBzcGxpdCAgICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9zcGxpdCcpLFxuICAgIHJlbW92ZUFsbCAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L3JlbW92ZUFsbCcpLFxuICAgIGluc2VydCAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2luc2VydCcpLFxuICAgIGFwcGVuZCAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2FwcGVuZCcpLFxuICAgIGZpbmQgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2ZpbmQnKSxcbiAgICBjb21iaW5lICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb21iaW5lJyksXG4gICAgaW50ZXJzZWN0aW9uICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW50ZXJzZWN0aW9uJyksXG4gICAgbWVyZ2UgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L21lcmdlJyksXG5cbiAgICB1bmh5cGhlbmF0ZSAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdW5oeXBoZW5hdGUnKSxcbiAgICBwcm9wZXJDYXNlICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvcHJvcGVyQ2FzZScpLFxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpLFxuICAgIHBhcnNlQWpheFVSSSAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uLy4uL3VpJykubW9kYWwsXG4gICAgYXN5bmNGb3JFYWNoICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2FzeW5jLWZvcmVhY2gnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyksXG5cbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcblxuICAgIHdmICAgICAgICAgICAgPSByZXF1aXJlKCd3ZWJmb250bG9hZGVyJyk7XG5cbnJlcXVpcmUoJy4uLy4uL3V0aWxzL2VsZW1lbnRzLnZpZXdwb3J0Jyk7XG5cbnZhciBpc0lFID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgcmV0dXJuIHVhLmluZGV4T2YoJ01TSUUgJykgPiAwIHx8IHVhLmluZGV4T2YoJ1RyaWRlbnQvJykgPiAwIHx8IHVhLmluZGV4T2YoJ0VkZ2UvJykgPiAwIHx8IGZhbHNlO1xufTtcblxudmFyIEZvbnRzID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBCb3VuZCxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgcHJldmlld1NlbnRlbmNlOiB7XG4gICAgICAgICdsYXRpbic6ICdXaXphcmQgYm95IEphY2sgbG92ZXMgdGhlIGdydW1weSBRdWVlblxcJ3MgZm94LicsXG4gICAgICAgICdsYXRpbi1leHQnOiAnV2l6YXJkIGJveSBKYWNrIGxvdmVzIHRoZSBncnVtcHkgUXVlZW5cXCdzIGZveC4nLFxuICAgICAgICAnYXJhYmljJzogJ9mG2LUg2K3Zg9mK2YUg2YTZhyDYs9ixINmC2KfYt9i5INmI2LDZiCDYtNij2YYg2LnYuNmK2YUg2YXZg9iq2YjYqCDYudmE2Ykg2KvZiNioINij2K7YttixINmI2YXYutmE2YEg2KjYrNmE2K8g2KPYstix2YInLFxuICAgICAgICAnY3lyaWxsaWMnOiAn0JIg0YfQsNGJ0LDRhSDRjtCz0LAg0LbQuNC7INCx0Ysg0YbQuNGC0YDRg9GBPyDQlNCwLCDQvdC+INGE0LDQu9GM0YjQuNCy0YvQuSDRjdC60LfQtdC80L/Qu9GP0YAhJyxcbiAgICAgICAgJ2N5cmlsbGljLWV4dCc6ICfQkiDRh9Cw0YnQsNGFINGO0LPQsCDQttC40Lsg0LHRiyDRhtC40YLRgNGD0YE/INCU0LAsINC90L4g0YTQsNC70YzRiNC40LLRi9C5INGN0LrQt9C10LzQv9C70Y/RgCEnLFxuICAgICAgICAnZGV2YW5hZ2FyaSc6ICfgpI/gpJUg4KSq4KSyIOCkleCkviDgpJXgpY3gpLDgpYvgpKcg4KSG4KSq4KSV4KS+IOCkreCkteCkv+Ckt+CljeCkryDgpKzgpL/gpJfgpL7gpKEg4KS44KSV4KSk4KS+IOCkueCliCcsXG4gICAgICAgICdncmVlayc6ICfOpM6sz4fOuc+Dz4TOtyDOsc67z47PgM63zr4gzrLOsc+Gzq7PgiDPiM63zrzOrc69zrcgzrPOtywgzrTPgc6xz4POus61zrvOr862zrXOuSDPhc+Azq3PgSDOvc+JzrjPgc6/z40gzrrPhc69z4zPgicsXG4gICAgICAgICdncmVlay1leHQnOiAnzqTOrM+HzrnPg8+EzrcgzrHOu8+Oz4DOt86+IM6yzrHPhs6uz4Igz4jOt868zq3Ovc63IM6zzrcsIM60z4HOsc+DzrrOtc67zq/Ots61zrkgz4XPgM6tz4Egzr3Pic64z4HOv8+NIM66z4XOvc+Mz4InLFxuICAgICAgICAnaGVicmV3JzogJ9eT15Ig16HXp9eo158g16nXmCDXkdeZ150g157XkNeV15vXlteRINeV15zXpNeq16Ig157XpteQINeX15HXqNeUJyxcbiAgICAgICAgJ2tobWVyJzogJ+GegeGfkuGeieGeu+GfhuGeouGetuGeheGeieGfieGetuGfhuGegOGeieGfkuGeheGegOGfi+GelOGetuGekyDhnorhn4ThnpnhnoLhn5LhnpjhnrbhnpPhnpThnonhn5LhnqDhnrYnLFxuICAgICAgICAndGVsdWd1JzogJ+CwpuCxh+CwtiDgsK3gsL7gsLfgsLLgsILgsKbgsYEg4LCk4LGG4LCy4LGB4LCX4LGBIOCwsuCxhuCwuOCxjeCwuCcsXG4gICAgICAgICd2aWV0bmFtZXNlJzogJ1TDtGkgY8OzIHRo4buDIMSDbiB0aOG7p3kgdGluaCBtw6Aga2jDtG5nIGjhuqFpIGfDrC4nXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy53ZiA9IHdmO1xuICAgICAgICB0aGlzLmZpZWxkID0gbnVsbDtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy50aHJvdHRsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgdGhpcy5sb2FkZWRGb250cyA9IFtdO1xuICAgICAgICB0aGlzLmZpbHRlcnMgPSB7XG4gICAgICAgICAgICBzZWFyY2g6ICcnLFxuICAgICAgICAgICAgc2NyaXB0OiAnbGF0aW4nLFxuICAgICAgICAgICAgY2F0ZWdvcmllczogW11cbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBlbGVtZW50LmRhdGEoJ2c1LWZvbnRwaWNrZXInKTtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGZvbnRwaWNrZXIgZGF0YSBmb3VuZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgIHRoaXMuZmllbGQgPSAkKGRhdGEuZmllbGQpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xPQURJTkcnKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2c1LWRpYWxvZy10aGVtZS1kZWZhdWx0IGc1LW1vZGFsLWZvbnRzJyxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGdldEFqYXhVUkwoJ2ZvbnRwaWNrZXInKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGJpbmQoZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gY29udGVudC5lbGVtZW50cy5jb250ZW50O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hFdmVudHMoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhdGVnb3JpZXMoY29udGFpbmVyKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbChjb250YWluZXIuZmluZCgndWwuZy1mb250cy1saXN0JykpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVG90YWwoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEZyb21WYWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wYXJ0aWNsZS1zZWFyY2gtd3JhcHBlciBpbnB1dCcpWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2Nyb2xsOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGhyb3R0bGUpO1xuICAgICAgICB0aGlzLnRocm90dGxlID0gc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aHJvdHRsZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyA1NTAgPSBjb250YWluZXIgaGVpZ2h0LCA1ID0gcGFnZXNcbiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IChjb250YWluZXIuZmluZCgndWwuZy1mb250cy1saXN0JykgfHwgY29udGFpbmVyKS5pbnZpZXdwb3J0KCcgPiBsaTpub3QoLmctZm9udC1oaWRlKScsICg1NTAgKiAoaXNJRSgpID8gMiA6IDcpKSksXG4gICAgICAgICAgICAgICAgbGlzdCAgICAgPSBbXTtcblxuICAgICAgICAgICAgaWYgKCFlbGVtZW50cykgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgJChlbGVtZW50cykuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFGb250ID0gZWxlbWVudC5kYXRhKCdmb250JyksXG4gICAgICAgICAgICAgICAgICAgIHZhcmlhbnQgID0gZWxlbWVudC5kYXRhKCd2YXJpYW50Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMubG9hZGVkRm9udHMsIGRhdGFGb250KSAmJiB2YXJpYW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChkYXRhRm9udCArICh2YXJpYW50ICE9ICdyZWd1bGFyJyA/ICc6JyArIHZhcmlhbnQgOiAnJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnW2RhdGEtdmFyaWFudD1cIicgKyB2YXJpYW50ICsgJ1wiXSAucHJldmlldycpLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBkYXRhRm9udCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiB2YXJpYW50ID09ICdyZWd1bGFyJyA/ICdub3JtYWwnIDogdmFyaWFudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgaWYgKCFsaXN0IHx8ICFsaXN0Lmxlbmd0aCkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdGhpcy53Zi5sb2FkKHtcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBnb29nbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZmFtaWxpZXM6IGxpc3RcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZvbnRhY3RpdmU6IGJpbmQoZnVuY3Rpb24oZmFtaWx5LCBmdmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJ2xpW2RhdGEtZm9udD1cIicgKyBmYW1pbHkgKyAnXCJdOm5vdCguZy12YXJpYW50LWhpZGUpID4gLnByZXZpZXcnKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBmYW1pbHksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiBmdmRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkRm9udHMucHVzaChmYW1pbHkpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgdGhpcyksIDEwMCk7XG4gICAgfSxcblxuICAgIHVuc2VsZWN0OiBmdW5jdGlvbihzZWxlY3RlZCkge1xuICAgICAgICBzZWxlY3RlZCA9IHNlbGVjdGVkIHx8IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgIGlmICghc2VsZWN0ZWQpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdmFyIGJhc2VWYXJpYW50ID0gc2VsZWN0ZWQuZWxlbWVudC5kYXRhKCd2YXJpYW50Jyk7XG4gICAgICAgIHNlbGVjdGVkLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgIHNlbGVjdGVkLmVsZW1lbnQuc2VhcmNoKCdpbnB1dFt0eXBlPWNoZWNrYm94XScpLmNoZWNrZWQoZmFsc2UpO1xuICAgICAgICBzZWxlY3RlZC5lbGVtZW50LnNlYXJjaCgnW2RhdGEtZm9udF0nKS5hZGRDbGFzcygnZy12YXJpYW50LWhpZGUnKTtcbiAgICAgICAgc2VsZWN0ZWQuZWxlbWVudC5maW5kKCdbZGF0YS12YXJpYW50PVwiJyArIGJhc2VWYXJpYW50ICsgJ1wiXScpLnJlbW92ZUNsYXNzKCdnLXZhcmlhbnQtaGlkZScpO1xuICAgICAgICBzZWxlY3RlZC52YXJpYW50cyA9IFtzZWxlY3RlZC5iYXNlVmFyaWFudF07XG4gICAgICAgIHNlbGVjdGVkLnNlbGVjdGVkID0gW107XG4gICAgfSxcblxuICAgIHNlbGVjdEZyb21WYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZmllbGQudmFsdWUoKSwgbmFtZSwgdmFyaWFudHMsIHN1YnNldCwgaXNMb2NhbCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghdmFsdWUubWF0Y2goJ2ZhbWlseT0nKSkge1xuICAgICAgICAgICAgdmFyIGxvY2FscyA9ICQoJ1tkYXRhLWNhdGVnb3J5PVwibG9jYWwtZm9udHNcIl1bZGF0YS1mb250XScpIHx8IFtdLCBpbnRlcnNlY3Q7XG4gICAgICAgICAgICBsb2NhbHMgPSBsb2NhbHMubWFwKGZ1bmN0aW9uKGwpIHsgcmV0dXJuICQobCkuZGF0YSgnZm9udCcpOyB9KTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvKFxcc3sxLH0pPywoXFxzezEsfSk/L2dpLCAnLCcpLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICBpbnRlcnNlY3QgPSBpbnRlcnNlY3Rpb24obG9jYWxzLCB2YWx1ZSk7XG4gICAgICAgICAgICBpZiAoIWludGVyc2VjdC5sZW5ndGgpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgIGlzTG9jYWwgPSB0cnVlO1xuICAgICAgICAgICAgbmFtZSA9IGludGVyc2VjdC5zaGlmdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHNwbGl0ICA9IHZhbHVlLnNwbGl0KCcmJyksXG4gICAgICAgICAgICAgICAgZmFtaWx5ID0gc3BsaXRbMF0sXG4gICAgICAgICAgICAgICAgc3BsaXQyID0gZmFtaWx5LnNwbGl0KCc6Jyk7XG5cbiAgICAgICAgICAgIG5hbWUgPSBzcGxpdDJbMF0ucmVwbGFjZSgnZmFtaWx5PScsICcnKS5yZXBsYWNlKC9cXCsvZywgJyAnKTtcbiAgICAgICAgICAgIHZhcmlhbnRzID0gc3BsaXQyWzFdID8gc3BsaXQyWzFdLnNwbGl0KCcsJykgOiBbJ3JlZ3VsYXInXTtcbiAgICAgICAgICAgIHN1YnNldCA9IHNwbGl0WzFdID8gc3BsaXRbMV0ucmVwbGFjZSgnc3Vic2V0PScsICcnKS5zcGxpdCgnLCcpIDogWydsYXRpbiddO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vQ29uZmxpY3QgPSBpc0xvY2FsID8gJ1tkYXRhLWNhdGVnb3J5PVwibG9jYWwtZm9udHNcIl0nIDogJzpub3QoW2RhdGEtY2F0ZWdvcnk9XCJsb2NhbC1mb250c1wiXSknLFxuICAgICAgICAgICAgZWxlbWVudCA9ICQoJ3VsLmctZm9udHMtbGlzdCA+IFtkYXRhLWZvbnQ9XCInICsgbmFtZSArICdcIl0nICsgbm9Db25mbGljdCk7XG4gICAgICAgIHZhcmlhbnRzID0gdmFyaWFudHMgfHwgZWxlbWVudC5kYXRhKCd2YXJpYW50cycpLnNwbGl0KCcsJykgfHwgWydyZWd1bGFyJ107XG5cbiAgICAgICAgaWYgKGNvbnRhaW5zKHZhcmlhbnRzLCAnNDAwJykpIHtcbiAgICAgICAgICAgIHJlbW92ZUFsbCh2YXJpYW50cywgJzQwMCcpO1xuICAgICAgICAgICAgaW5zZXJ0KHZhcmlhbnRzLCAncmVndWxhcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRhaW5zKHZhcmlhbnRzLCAnNDAwaXRhbGljJykpIHtcbiAgICAgICAgICAgIHJlbW92ZUFsbCh2YXJpYW50cywgJzQwMGl0YWxpYycpO1xuICAgICAgICAgICAgaW5zZXJ0KHZhcmlhbnRzLCAnaXRhbGljJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNlbGVjdGVkID0ge1xuICAgICAgICAgICAgZm9udDogbmFtZSxcbiAgICAgICAgICAgIGJhc2VWYXJpYW50OiBlbGVtZW50LmRhdGEoJ3ZhcmlhbnQnKSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICB2YXJpYW50czogdmFyaWFudHMsXG4gICAgICAgICAgICBzZWxlY3RlZDogW10sXG4gICAgICAgICAgICBsb2NhbDogaXNMb2NhbCxcbiAgICAgICAgICAgIGNoYXJzZXRzOiBzdWJzZXQsXG4gICAgICAgICAgICBhdmFpbGFibGVWYXJpYW50czogZWxlbWVudC5kYXRhKCd2YXJpYW50cycpLnNwbGl0KCcsJyksXG4gICAgICAgICAgICBleHBhbmRlZDogaXNMb2NhbCxcbiAgICAgICAgICAgIGxvYWRlZDogaXNMb2NhbFxuICAgICAgICB9O1xuXG4gICAgICAgIChpc0xvY2FsID8gW25hbWVdIDogdmFyaWFudHMpLmZvckVhY2goZnVuY3Rpb24odmFyaWFudCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QoZWxlbWVudCwgdmFyaWFudCk7XG4gICAgICAgICAgICB2YXJpYW50ID0gZWxlbWVudC5maW5kKCc+IHVsID4gW2RhdGEtdmFyaWFudD1cIicgKyB2YXJpYW50ICsgJ1wiXScpO1xuICAgICAgICAgICAgaWYgKHZhcmlhbnQpIHsgdmFyaWFudC5yZW1vdmVDbGFzcygnZy12YXJpYW50LWhpZGUnKTsgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICB2YXIgY2hhcnNldFNlbGVjdGVkID0gZWxlbWVudC5maW5kKCcuZm9udC1jaGFyc2V0cy1zZWxlY3RlZCcpO1xuICAgICAgICBpZiAoY2hhcnNldFNlbGVjdGVkKSB7XG4gICAgICAgICAgICB2YXIgc3Vic2V0c0xlbmd0aCA9IGVsZW1lbnQuZGF0YSgnc3Vic2V0cycpLnNwbGl0KCcsJykubGVuZ3RoO1xuICAgICAgICAgICAgY2hhcnNldFNlbGVjdGVkLmh0bWwoJyg8aSBjbGFzcz1cImZhIGZhLWZ3IGZhLWNoZWNrLXNxdWFyZS1vXCI+PC9pPiAgPHNwYW4gY2xhc3M9XCJmb250LWNoYXJzZXRzLWRldGFpbHNcIj4nICsgc3Vic2V0Lmxlbmd0aCArICcgb2YgJyArIHN1YnNldHNMZW5ndGggKyAnPC9zcGFuPiBzZWxlY3RlZCknKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNMb2NhbCkgeyAkKCd1bC5nLWZvbnRzLWxpc3QnKVswXS5zY3JvbGxUb3AgPSBlbGVtZW50WzBdLm9mZnNldFRvcDsgfVxuXG4gICAgICAgIHRoaXMudG9nZ2xlRXhwYW5zaW9uKCk7XG4gICAgICAgIHNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHsgdGhpcy50b2dnbGVFeHBhbnNpb24oKTsgfSwgdGhpcyksIDUwKTtcbiAgICAgICAgaWYgKCFpc0xvY2FsKSB7IHNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHsgJCgndWwuZy1mb250cy1saXN0JylbMF0uc2Nyb2xsVG9wID0gZWxlbWVudFswXS5vZmZzZXRUb3A7IH0sIHRoaXMsIDI1MCkpOyB9XG4gICAgfSxcblxuICAgIHNlbGVjdDogZnVuY3Rpb24oZWxlbWVudCwgdmFyaWFudC8qLCB0YXJnZXQqLykge1xuICAgICAgICB2YXIgYmFzZVZhcmlhbnQgPSBlbGVtZW50LmRhdGEoJ3ZhcmlhbnQnKSxcbiAgICAgICAgICAgIGlzTG9jYWwgICAgID0gIWJhc2VWYXJpYW50O1xuXG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZCB8fCB0aGlzLnNlbGVjdGVkLmVsZW1lbnQgIT0gZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKHZhcmlhbnQgJiYgdGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHZhciBjaGFyc2V0U2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkLmVsZW1lbnQuZmluZCgnLmZvbnQtY2hhcnNldHMtc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcnNldFNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWJzZXRzTGVuZ3RoID0gZWxlbWVudC5kYXRhKCdzdWJzZXRzJykuc3BsaXQoJywnKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGNoYXJzZXRTZWxlY3RlZC5odG1sKCcoPGkgY2xhc3M9XCJmYSBmYS1mdyBmYS1jaGVjay1zcXVhcmUtb1wiPjwvaT4gIDxzcGFuIGNsYXNzPVwiZm9udC1jaGFyc2V0cy1kZXRhaWxzXCI+MSBvZiAnICsgc3Vic2V0c0xlbmd0aCArICc8L3NwYW4+IHNlbGVjdGVkKScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB7XG4gICAgICAgICAgICAgICAgZm9udDogZWxlbWVudC5kYXRhKCdmb250JyksXG4gICAgICAgICAgICAgICAgYmFzZVZhcmlhbnQ6IGJhc2VWYXJpYW50LFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdmFyaWFudHM6IFtiYXNlVmFyaWFudF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IFtdLFxuICAgICAgICAgICAgICAgIGxvY2FsOiBpc0xvY2FsLFxuICAgICAgICAgICAgICAgIGNoYXJzZXRzOiBbJ2xhdGluJ10sXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlVmFyaWFudHM6IGVsZW1lbnQuZGF0YSgndmFyaWFudHMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBpc0xvY2FsLFxuICAgICAgICAgICAgICAgIGxvYWRlZDogaXNMb2NhbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdmFyaWFudCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVFeHBhbnNpb24oKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKHZhcmlhbnQgfHwgaXNMb2NhbCkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gKCQoJ3VsLmctZm9udHMtbGlzdCA+IFtkYXRhLWZvbnRdOm5vdChbZGF0YS1mb250PVwiJyArIHRoaXMuc2VsZWN0ZWQuZm9udCArICdcIl0pIGlucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJykpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2hlY2tlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQucGFyZW50KCdbZGF0YS12YXJpYW50c10nKS5yZW1vdmVDbGFzcygnZm9udC1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNoZWNrYm94ID0gdGhpcy5zZWxlY3RlZC5lbGVtZW50LmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXVt2YWx1ZT1cIicgKyAoaXNMb2NhbCA/IHRoaXMuc2VsZWN0ZWQuZm9udCA6IHZhcmlhbnQpICsgJ1wiXScpLFxuICAgICAgICAgICAgICAgIGNoZWNrZWQgID0gY2hlY2tib3guY2hlY2tlZCgpO1xuICAgICAgICAgICAgaWYgKGNoZWNrYm94KSB7XG4gICAgICAgICAgICAgICAgY2hlY2tib3guY2hlY2tlZCghY2hlY2tlZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIGluc2VydCh0aGlzLnNlbGVjdGVkLnZhcmlhbnRzLCB2YXJpYW50KTtcbiAgICAgICAgICAgICAgICBpbnNlcnQodGhpcy5zZWxlY3RlZC5zZWxlY3RlZCwgdmFyaWFudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh2YXJpYW50ICE9IHRoaXMuc2VsZWN0ZWQuYmFzZVZhcmlhbnQpIHsgcmVtb3ZlQWxsKHRoaXMuc2VsZWN0ZWQudmFyaWFudHMsIHZhcmlhbnQpOyB9XG4gICAgICAgICAgICAgICAgcmVtb3ZlQWxsKHRoaXMuc2VsZWN0ZWQuc2VsZWN0ZWQsIHZhcmlhbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRvZ2dsZUV4cGFuc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkLmF2YWlsYWJsZVZhcmlhbnRzLmxlbmd0aCA8PSAxKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZC5sb2NhbCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5leHBhbmRlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQuZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIHZhciB2YXJpYW50cyA9IHRoaXMuc2VsZWN0ZWQuZWxlbWVudC5kYXRhKCd2YXJpYW50cycpLCB2YXJpYW50O1xuICAgICAgICAgICAgaWYgKHZhcmlhbnRzLnNwbGl0KCcsJykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFuaXB1bGF0ZUxpbmsodGhpcy5zZWxlY3RlZC5mb250KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVsZW1lbnQuc2VhcmNoKCdbZGF0YS1mb250XScpLnJlbW92ZUNsYXNzKCdnLXZhcmlhbnQtaGlkZScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkLmxvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndmLmxvYWQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NlczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW1pbGllczogW3RoaXMuc2VsZWN0ZWQuZm9udC5yZXBsYWNlKC9cXHMvZywgJysnKSArICc6JyArIHZhcmlhbnRzXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRhY3RpdmU6IGJpbmQoZnVuY3Rpb24oZmFtaWx5LCBmdmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3R5bGUgID0gdGhpcy5mdmRUb1N0eWxlKGZhbWlseSwgZnZkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoID0gc3R5bGUuZm9udFdlaWdodDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWFyY2ggPT0gJzQwMCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoID0gc3R5bGUuZm9udFN0eWxlID09ICdub3JtYWwnID8gJ3JlZ3VsYXInIDogJ2l0YWxpYyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHlsZS5mb250U3R5bGUgPT0gJ2l0YWxpYycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoICs9ICdpdGFsaWMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZWxlbWVudC5maW5kKCdsaVtkYXRhLXZhcmlhbnQ9XCInICsgc2VhcmNoICsgJ1wiXSAucHJldmlldycpLnN0eWxlKHN0eWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZXhjbHVkZSA9ICc6bm90KFtkYXRhLXZhcmlhbnQ9XCInICsgdGhpcy5zZWxlY3RlZC52YXJpYW50cy5qb2luKCdcIl0pOm5vdChbZGF0YS12YXJpYW50PVwiJykgKyAnXCJdKSc7XG4gICAgICAgICAgICBleGNsdWRlID0gdGhpcy5zZWxlY3RlZC5lbGVtZW50LnNlYXJjaCgnW2RhdGEtZm9udF0nICsgZXhjbHVkZSk7XG4gICAgICAgICAgICBpZiAoZXhjbHVkZSkgeyBleGNsdWRlLmFkZENsYXNzKCdnLXZhcmlhbnQtaGlkZScpOyB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNlbGVjdGVkLmV4cGFuZGVkID0gIXRoaXMuc2VsZWN0ZWQuZXhwYW5kZWQ7XG4gICAgfSxcblxuICAgIG1hbmlwdWxhdGVMaW5rOiBmdW5jdGlvbihmYW1pbHkpIHtcbiAgICAgICAgZmFtaWx5ID0gZmFtaWx5LnJlcGxhY2UoL1xccy9nLCAnKycpO1xuICAgICAgICB2YXIgbGluayA9ICQoJ2hlYWQgbGlua1tocmVmKj1cIicgKyBmYW1pbHkgKyAnXCJdJyk7XG4gICAgICAgIGlmICghbGluaykgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgcGFydHMgPSBkZWNvZGVVUklDb21wb25lbnQobGluay5ocmVmKCkpLnNwbGl0KCd8Jyk7XG4gICAgICAgIGlmICghcGFydHMgfHwgcGFydHMubGVuZ3RoIDw9IDEpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgcmVtb3ZlQWxsKHBhcnRzLCBmYW1pbHkpO1xuXG4gICAgICAgIGxpbmsuYXR0cmlidXRlKCdocmVmJywgZW5jb2RlVVJJKHBhcnRzLmpvaW4oJ3wnKSkpO1xuICAgIH0sXG5cbiAgICB0b2dnbGU6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpO1xuXG4gICAgICAgIGlmICh0YXJnZXQuYXR0cmlidXRlKCd0eXBlJykgPT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgdGFyZ2V0LmNoZWNrZWQoIXRhcmdldC5jaGVja2VkKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZWxlY3QoZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWZvbnRdJykgfHwgZWxlbWVudCwgZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWZvbnRdJykgPyBlbGVtZW50LmRhdGEoJ3ZhcmlhbnQnKSA6IGZhbHNlLCBlbGVtZW50KTtcblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHVwZGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwcmV2aWV3ID0gJCgnLmctcGFydGljbGVzLWZvb3RlciAuZm9udC1zZWxlY3RlZCcpLCBzZWxlY3RlZCwgdmFyaWFudHM7XG4gICAgICAgIGlmICghcHJldmlldykgeyByZXR1cm47IH1cblxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQuc2VsZWN0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBwcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZvbnQtc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZC5zZWxlY3RlZC5zb3J0KCk7XG4gICAgICAgIHZhcmlhbnRzID0gdGhpcy5zZWxlY3RlZC5sb2NhbCA/ICcoPHNtYWxsPmxvY2FsPC9zbWFsbD4pJyA6ICcoPHNtYWxsPicgKyBzZWxlY3RlZC5qb2luKCcsICcpLnJlcGxhY2UoJ3JlZ3VsYXInLCAnbm9ybWFsJykgKyAnPC9zbWFsbD4pJztcbiAgICAgICAgdGhpcy5zZWxlY3RlZC5lbGVtZW50LmFkZENsYXNzKCdmb250LXNlbGVjdGVkJyk7XG4gICAgICAgIHByZXZpZXcuaHRtbCgnPHN0cm9uZz4nICsgdGhpcy5zZWxlY3RlZC5mb250ICsgJzwvc3Ryb25nPiAnICsgdmFyaWFudHMpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVUb3RhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b3RhbHMgPSAkKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIC5wYXJ0aWNsZS1zZWFyY2gtdG90YWwnKSxcbiAgICAgICAgICAgIGNvdW50ICA9ICQoJy5nLWZvbnRzLWxpc3QgPiBbZGF0YS1mb250XTpub3QoLmctZm9udC1oaWRlKScpO1xuXG4gICAgICAgIHRvdGFscy50ZXh0KGNvdW50ID8gY291bnQubGVuZ3RoIDogMCk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUNhdGVnb3JpZXM6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICB2YXIgY2F0ZWdvcmllcyA9IGNvbnRhaW5lci5maW5kKCdbZGF0YS1mb250LWNhdGVnb3JpZXNdJyk7XG4gICAgICAgIGlmICghY2F0ZWdvcmllcykgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmZpbHRlcnMuY2F0ZWdvcmllcyA9IGNhdGVnb3JpZXMuZGF0YSgnZm9udC1jYXRlZ29yaWVzJykuc3BsaXQoJywnKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoRXZlbnRzOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgdmFyIGhlYWRlciAgPSBjb250YWluZXIuZmluZCgnLmctcGFydGljbGVzLWhlYWRlcicpLFxuICAgICAgICAgICAgbGlzdCAgICA9IGNvbnRhaW5lci5maW5kKCcuZy1mb250cy1saXN0JyksXG4gICAgICAgICAgICBzZWFyY2ggID0gaGVhZGVyLmZpbmQoJ2lucHV0LmZvbnQtc2VhcmNoJyksXG4gICAgICAgICAgICBwcmV2aWV3ID0gaGVhZGVyLmZpbmQoJ2lucHV0LmZvbnQtcHJldmlldycpO1xuXG4gICAgICAgIGRlY291cGxlKGxpc3QsICdzY3JvbGwnLCBiaW5kKHRoaXMuc2Nyb2xsLCB0aGlzLCBsaXN0KSk7XG4gICAgICAgIGNvbnRhaW5lci5kZWxlZ2F0ZSgnY2xpY2snLCAnLmctZm9udHMtbGlzdCBsaVtkYXRhLWZvbnRdJywgYmluZCh0aGlzLnRvZ2dsZSwgdGhpcykpO1xuXG4gICAgICAgIGlmIChzZWFyY2gpIHsgc2VhcmNoLm9uKCdrZXl1cCcsIGJpbmQodGhpcy5zZWFyY2gsIHRoaXMsIHNlYXJjaCkpOyB9XG4gICAgICAgIGlmIChwcmV2aWV3KSB7IHByZXZpZXcub24oJ2tleXVwJywgYmluZCh0aGlzLnVwZGF0ZVByZXZpZXcsIHRoaXMsIHByZXZpZXcpKTsgfVxuXG4gICAgICAgIHRoaXMuYXR0YWNoQ2hhcnNldHMoY29udGFpbmVyKTtcbiAgICAgICAgdGhpcy5hdHRhY2hMb2NhbFZhcmlhbnRzKGNvbnRhaW5lcik7XG4gICAgICAgIHRoaXMuYXR0YWNoRm9vdGVyKGNvbnRhaW5lcik7XG4gICAgfSxcblxuICAgIGF0dGFjaENoYXJzZXRzOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgY29udGFpbmVyLmRlbGVnYXRlKCdtb3VzZW92ZXInLCAnLmZvbnQtY2hhcnNldHMtc2VsZWN0ZWQnLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQuUG9wb3ZlckRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9wb3ZlciA9IGVsZW1lbnQuZ2V0UG9wb3Zlcih7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzIwMCcsXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnZm9udC1jYXRlZ29yaWVzLCBhYm92ZS1tb2RhbCdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2JlZm9yZXNob3cucG9wb3ZlcicsIGJpbmQoZnVuY3Rpb24ocG9wb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3Vic2V0cyA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1zdWJzZXRzXScpLmRhdGEoJ3N1YnNldHMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHBvcG92ZXIuJHRhcmdldC5maW5kKCcuZzUtcG9wb3Zlci1jb250ZW50JyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGl2LCBjdXJyZW50O1xuICAgICAgICAgICAgICAgICAgICBzdWJzZXRzLmZvckVhY2goZnVuY3Rpb24oY3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjb250YWlucyh0aGlzLnNlbGVjdGVkLmNoYXJzZXRzLCBjcykgPyAoY3MgPT0gJ2xhdGluJyA/ICdjaGVja2VkIGRpc2FibGVkJyA6ICdjaGVja2VkJykgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHplbignZGl2JykuaHRtbCgnPGxhYmVsPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiAnICsgY3VycmVudCArICcgdmFsdWU9XCInICsgY3MgKyAnXCIvPiAnICsgcHJvcGVyQ2FzZSh1bmh5cGhlbmF0ZShjcy5yZXBsYWNlKCdleHQnLCAnZXh0ZW5kZWQnKSkpICsgJzwvbGFiZWw+JykuYm90dG9tKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmRlbGVnYXRlKCdjbGljaycsICdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQgPSBjb250ZW50LnNlYXJjaCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuY2hhcnNldHMgPSBjaGVja2VkID8gY2hlY2tlZC5tYXAoJ3ZhbHVlJykgOiBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKCcoPGkgY2xhc3M9XCJmYSBmYS1mdyBmYS1jaGVjay1zcXVhcmUtb1wiPjwvaT4gIDxzcGFuIGNsYXNzPVwiZm9udC1jaGFyc2V0cy1kZXRhaWxzXCI+JyArIHRoaXMuc2VsZWN0ZWQuY2hhcnNldHMubGVuZ3RoICsgJyBvZiAnICsgc3Vic2V0cy5sZW5ndGggKyAnPC9zcGFuPiBzZWxlY3RlZCknKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHBvcG92ZXIuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmdldFBvcG92ZXIoKS5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoTG9jYWxWYXJpYW50czogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgIGNvbnRhaW5lci5kZWxlZ2F0ZSgnbW91c2VvdmVyJywgJy5nLWZvbnQtdmFyaWFudHMtbGlzdCcsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmICghZWxlbWVudC5Qb3BvdmVyRGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBwb3BvdmVyID0gZWxlbWVudC5nZXRQb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMjAwJyxcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21vdXNlJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICdmb250LWNhdGVnb3JpZXMsIGFib3ZlLW1vZGFsJ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbignYmVmb3Jlc2hvdy5wb3BvdmVyJywgYmluZChmdW5jdGlvbihwb3BvdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ICA9IHBvcG92ZXIuJHRhcmdldC5maW5kKCcuZzUtcG9wb3Zlci1jb250ZW50JyksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50cyA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS12YXJpYW50c10nKS5kYXRhKCd2YXJpYW50cycpLnNwbGl0KCcsJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGVudC5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jRm9yRWFjaCh2YXJpYW50cywgYmluZChmdW5jdGlvbih2YXJpYW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50ID0gdmFyaWFudCA9PSAnNDAwJyA/ICdyZWd1bGFyJyA6ICh2YXJpYW50ID09ICc0MDBpdGFsaWMnID8gJ2l0YWxpYycgOiB2YXJpYW50ICsgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgemVuKCdkaXYnKS50ZXh0KHRoaXMubWFwVmFyaWFudCh2YXJpYW50KSkuYm90dG9tKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcG9wb3Zlci5kaXNwbGF5Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcykpO1xuICAgIH0sXG5cbiAgICBhdHRhY2hGb290ZXI6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICB2YXIgZm9vdGVyICAgICA9IGNvbnRhaW5lci5maW5kKCcuZy1wYXJ0aWNsZXMtZm9vdGVyJyksXG4gICAgICAgICAgICBzZWxlY3QgICAgID0gZm9vdGVyLmZpbmQoJ2J1dHRvbi5idXR0b24tcHJpbWFyeScpLFxuICAgICAgICAgICAgY2F0ZWdvcmllcyA9IGZvb3Rlci5maW5kKCcuZm9udC1jYXRlZ29yeScpLFxuICAgICAgICAgICAgc3Vic2V0cyAgICA9IGZvb3Rlci5maW5kKCcuZm9udC1zdWJzZXRzJyksXG4gICAgICAgICAgICBjdXJyZW50O1xuXG4gICAgICAgIHNlbGVjdC5vbignY2xpY2snLCBiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkKCd1bC5nLWZvbnRzLWxpc3QgPiBbZGF0YS1mb250XSBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZC52YWx1ZSgnJyk7XG4gICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBuYW1lICAgICAgPSB0aGlzLnNlbGVjdGVkLmZvbnQucmVwbGFjZSgvXFxzL2csICcrJyksXG4gICAgICAgICAgICAgICAgdmFyaWF0aW9uID0gdGhpcy5zZWxlY3RlZC5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICBjaGFyc2V0ICAgPSB0aGlzLnNlbGVjdGVkLmNoYXJzZXRzO1xuXG4gICAgICAgICAgICBpZiAodmFyaWF0aW9uICYmIHZhcmlhdGlvbi5sZW5ndGggPT0gMSAmJiB2YXJpYXRpb25bMF0gPT0gJ3JlZ3VsYXInKSB7IHZhcmlhdGlvbiA9IFtdOyB9XG4gICAgICAgICAgICBpZiAoY2hhcnNldCAmJiBjaGFyc2V0Lmxlbmd0aCA9PSAxICYmIGNoYXJzZXRbMF0gPT0gJ2xhdGluJykgeyBjaGFyc2V0ID0gW107IH1cblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5zKHZhcmlhdGlvbiwgJ3JlZ3VsYXInKSkge1xuICAgICAgICAgICAgICAgIHJlbW92ZUFsbCh2YXJpYXRpb24sICdyZWd1bGFyJyk7XG4gICAgICAgICAgICAgICAgaW5zZXJ0KHZhcmlhdGlvbiwgJzQwMCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbnRhaW5zKHZhcmlhdGlvbiwgJ2l0YWxpYycpKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlQWxsKHZhcmlhdGlvbiwgJ2l0YWxpYycpO1xuICAgICAgICAgICAgICAgIGluc2VydCh2YXJpYXRpb24sICc0MDBpdGFsaWMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkLmxvY2FsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZC52YWx1ZSgnZmFtaWx5PScgKyBuYW1lICsgKHZhcmlhdGlvbi5sZW5ndGggPyAnOicgKyB2YXJpYXRpb24uam9pbignLCcpIDogJycpICsgKGNoYXJzZXQubGVuZ3RoID8gJyZzdWJzZXQ9JyArIGNoYXJzZXQuam9pbignLCcpIDogJycpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZC52YWx1ZShuYW1lKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5maWVsZC5lbWl0KCdpbnB1dCcpO1xuICAgICAgICAgICAgJCgnYm9keScpLmVtaXQoJ2lucHV0JywgeyB0YXJnZXQ6IHRoaXMuZmllbGQgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBjYXRlZ29yaWVzLnBvcG92ZXIoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiAndG9wJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjAwJyxcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICBzdHlsZTogJ2ZvbnQtY2F0ZWdvcmllcywgYWJvdmUtbW9kYWwnXG4gICAgICAgIH0pLm9uKCdiZWZvcmVzaG93LnBvcG92ZXInLCBiaW5kKGZ1bmN0aW9uKHBvcG92ZXIpIHtcbiAgICAgICAgICAgIHZhciBjYXRzICAgID0gY2F0ZWdvcmllcy5kYXRhKCdmb250LWNhdGVnb3JpZXMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBwb3BvdmVyLiR0YXJnZXQuZmluZCgnLmc1LXBvcG92ZXItY29udGVudCcpLFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuZW1wdHkoKTtcblxuICAgICAgICAgICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09ICdsb2NhbC1mb250cycpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgY3VycmVudCA9IGNvbnRhaW5zKHRoaXMuZmlsdGVycy5jYXRlZ29yaWVzLCBjYXRlZ29yeSkgPyAnY2hlY2tlZCcgOiAnJztcbiAgICAgICAgICAgICAgICB6ZW4oJ2RpdicpLmh0bWwoJzxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgJyArIGN1cnJlbnQgKyAnIHZhbHVlPVwiJyArIGNhdGVnb3J5ICsgJ1wiLz4gJyArIHByb3BlckNhc2UodW5oeXBoZW5hdGUoY2F0ZWdvcnkpKSArICc8L2xhYmVsPicpLmJvdHRvbShjb250ZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICBjb250ZW50LmRlbGVnYXRlKCdjbGljaycsICdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICAgICAgY2hlY2tlZCA9IGNvbnRlbnQuc2VhcmNoKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycy5jYXRlZ29yaWVzID0gY2hlY2tlZCA/IGNoZWNrZWQubWFwKCd2YWx1ZScpIDogW107XG4gICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5maW5kKCdzbWFsbCcpLnRleHQodGhpcy5maWx0ZXJzLmNhdGVnb3JpZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaCgpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICBwb3BvdmVyLmRpc3BsYXlDb250ZW50KCk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBzdWJzZXRzLnBvcG92ZXIoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiAndG9wJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjAwJyxcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICBzdHlsZTogJ2ZvbnQtc3Vic2V0cywgYWJvdmUtbW9kYWwnXG4gICAgICAgIH0pLm9uKCdiZWZvcmVzaG93LnBvcG92ZXInLCBiaW5kKGZ1bmN0aW9uKHBvcG92ZXIpIHtcbiAgICAgICAgICAgIHZhciBzdWJzICAgID0gc3Vic2V0cy5kYXRhKCdmb250LXN1YnNldHMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBwb3BvdmVyLiR0YXJnZXQuZmluZCgnLmc1LXBvcG92ZXItY29udGVudCcpO1xuXG4gICAgICAgICAgICBjb250ZW50LmVtcHR5KCk7XG5cbiAgICAgICAgICAgIHZhciBkaXY7XG4gICAgICAgICAgICBzdWJzLmZvckVhY2goZnVuY3Rpb24oc3ViKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudCA9IHN1YiA9PSB0aGlzLmZpbHRlcnMuc2NyaXB0ID8gJ2NoZWNrZWQnIDogJyc7XG4gICAgICAgICAgICAgICAgemVuKCdkaXYnKS5odG1sKCc8bGFiZWw+PGlucHV0IG5hbWU9XCJmb250LXN1YnNldFtdXCIgdHlwZT1cInJhZGlvXCIgJyArIGN1cnJlbnQgKyAnIHZhbHVlPVwiJyArIHN1YiArICdcIi8+ICcgKyBwcm9wZXJDYXNlKHVuaHlwaGVuYXRlKHN1Yi5yZXBsYWNlKCdleHQnLCAnZXh0ZW5kZWQnKSkpICsgJzwvbGFiZWw+JykuYm90dG9tKGNvbnRlbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NoYW5nZScsICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzLnNjcmlwdCA9IGlucHV0LnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgJCgnLmctcGFydGljbGVzLWhlYWRlciBpbnB1dC5mb250LXByZXZpZXcnKS52YWx1ZSh0aGlzLnByZXZpZXdTZW50ZW5jZVt0aGlzLmZpbHRlcnMuc2NyaXB0XSk7XG4gICAgICAgICAgICAgICAgc3Vic2V0cy5maW5kKCdzbWFsbCcpLnRleHQocHJvcGVyQ2FzZSh1bmh5cGhlbmF0ZShpbnB1dC52YWx1ZSgpLnJlcGxhY2UoJ2V4dCcsICdleHRlbmRlZCcpKSkpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3KCk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIHBvcG92ZXIuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfSxcblxuICAgIHNlYXJjaDogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgaW5wdXQgPSBpbnB1dCB8fCAkKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIGlucHV0LmZvbnQtc2VhcmNoJyk7XG4gICAgICAgIHZhciBsaXN0ICA9ICQoJy5nLWZvbnRzLWxpc3QnKSxcbiAgICAgICAgICAgIHZhbHVlID0gaW5wdXQudmFsdWUoKSxcbiAgICAgICAgICAgIG5hbWUsIHN1YnNldHMsIGNhdGVnb3J5LCBkYXRhO1xuXG4gICAgICAgIGxpc3Quc2VhcmNoKCc+IFtkYXRhLWZvbnRdJykuZm9yRWFjaChmdW5jdGlvbihmb250KSB7XG4gICAgICAgICAgICBmb250ID0gJChmb250KTtcbiAgICAgICAgICAgIG5hbWUgPSBmb250LmRhdGEoJ2ZvbnQnKTtcbiAgICAgICAgICAgIHN1YnNldHMgPSBmb250LmRhdGEoJ3N1YnNldHMnKS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgY2F0ZWdvcnkgPSBmb250LmRhdGEoJ2NhdGVnb3J5Jyk7XG4gICAgICAgICAgICBmb250LnJlbW92ZUNsYXNzKCdnLWZvbnQtaGlkZScpO1xuXG4gICAgICAgICAgICAvLyBXZSBkb250IHdhbnQgdG8gaGlkZSBzZWxlY3RlZCBmb250c1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQgJiYgdGhpcy5zZWxlY3RlZC5mb250ID09IG5hbWUgJiYgdGhpcy5zZWxlY3RlZC5zZWxlY3RlZC5sZW5ndGgpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIC8vIEZpbHRlciBieSBTdWJzZXRcbiAgICAgICAgICAgIGlmICghY29udGFpbnMoc3Vic2V0cywgdGhpcy5maWx0ZXJzLnNjcmlwdCkpIHtcbiAgICAgICAgICAgICAgICBmb250LmFkZENsYXNzKCdnLWZvbnQtaGlkZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlsdGVyIGJ5IENhdGVnb3J5XG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuZmlsdGVycy5jYXRlZ29yaWVzLCBjYXRlZ29yeSkpIHtcbiAgICAgICAgICAgICAgICBmb250LmFkZENsYXNzKCdnLWZvbnQtaGlkZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlsdGVyIGJ5IE5hbWVcbiAgICAgICAgICAgIGlmICghbmFtZS5tYXRjaChuZXcgUmVnRXhwKFwiXlwiICsgdmFsdWUgKyAnfFxcXFxzJyArIHZhbHVlLCAnZ2knKSkpIHtcbiAgICAgICAgICAgICAgICBmb250LmFkZENsYXNzKCdnLWZvbnQtaGlkZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb250LnJlbW92ZUNsYXNzKCdnLWZvbnQtaGlkZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsKCk7XG5cbiAgICAgICAgY2xlYXJUaW1lb3V0KGlucHV0LnJlZnJlc2hUaW1lcik7XG5cbiAgICAgICAgaW5wdXQucmVmcmVzaFRpbWVyID0gc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGwoJCgndWwuZy1mb250cy1saXN0JykpO1xuICAgICAgICB9LCB0aGlzKSwgNDAwKTtcblxuICAgICAgICBpbnB1dC5wcmV2aW91c1ZhbHVlID0gdmFsdWU7XG4gICAgfSxcblxuICAgIHVwZGF0ZVByZXZpZXc6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlucHV0ID0gaW5wdXQgfHwgJCgnLmctcGFydGljbGVzLWhlYWRlciBpbnB1dC5mb250LXByZXZpZXcnKTtcblxuICAgICAgICBjbGVhclRpbWVvdXQoaW5wdXQucmVmcmVzaFRpbWVyKTtcblxuICAgICAgICB2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZSgpLFxuICAgICAgICAgICAgbGlzdCAgPSAkKCcuZy1mb250cy1saXN0Jyk7XG5cbiAgICAgICAgdmFsdWUgPSB0cmltKHZhbHVlKSA/IHRyaW0odmFsdWUpIDogdGhpcy5wcmV2aWV3U2VudGVuY2VbdGhpcy5maWx0ZXJzLnNjcmlwdF07XG5cbiAgICAgICAgaWYgKGlucHV0LnByZXZpb3VzVmFsdWUgPT0gdmFsdWUpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICBsaXN0LnNlYXJjaCgnW2RhdGEtZm9udF0gLnByZXZpZXcnKS50ZXh0KHZhbHVlKTtcblxuICAgICAgICBpbnB1dC5wcmV2aW91c1ZhbHVlID0gdmFsdWU7XG4gICAgfSxcblxuICAgIGZ2ZFRvU3R5bGU6IGZ1bmN0aW9uKGZhbWlseSwgZnZkKSB7XG4gICAgICAgIHZhciBtYXRjaCA9IGZ2ZC5tYXRjaCgvKFthLXpdKShbMC05XSkvKTtcbiAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuICcnO1xuXG4gICAgICAgIHZhciBzdHlsZU1hcCA9IHtcbiAgICAgICAgICAgIG46ICdub3JtYWwnLFxuICAgICAgICAgICAgaTogJ2l0YWxpYycsXG4gICAgICAgICAgICBvOiAnb2JsaXF1ZSdcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IGZhbWlseSxcbiAgICAgICAgICAgIGZvbnRTdHlsZTogc3R5bGVNYXBbbWF0Y2hbMV1dLFxuICAgICAgICAgICAgZm9udFdlaWdodDogKG1hdGNoWzJdICogMTAwKS50b1N0cmluZygpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbWFwVmFyaWFudDogZnVuY3Rpb24odmFyaWFudCkge1xuICAgICAgICBzd2l0Y2ggKHZhcmlhbnQpIHtcbiAgICAgICAgICAgIGNhc2UgJzEwMCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdUaGluIDEwMCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICcxMDBpdGFsaWMnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnVGhpbiAxMDAgSXRhbGljJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzIwMCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdFeHRyYS1MaWdodCAyMDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnMjAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0V4dHJhLUxpZ2h0IDIwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnMzAwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0xpZ2h0IDMwMCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICczMDBpdGFsaWMnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnTGlnaHQgMzAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc0MDAnOlxuICAgICAgICAgICAgY2FzZSAncmVndWxhcic6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdOb3JtYWwgNDAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzQwMGl0YWxpYyc6XG4gICAgICAgICAgICBjYXNlICdpdGFsaWMnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnTm9ybWFsIDQwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnNTAwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ01lZGl1bSA1MDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnNTAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ01lZGl1bSA1MDAgSXRhbGljJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzYwMCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdTZW1pLUJvbGQgNjAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzYwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdTZW1pLUJvbGQgNjAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc3MDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnQm9sZCA3MDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnNzAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0JvbGQgNzAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc4MDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnRXh0cmEtQm9sZCA4MDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnODAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0V4dHJhLUJvbGQgODAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc5MDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnVWx0cmEtQm9sZCA5MDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnOTAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1VsdHJhLUJvbGQgOTAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAnVW5rbm93biBWYXJpYW50JztcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nNS1mb250cGlja2VyXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIHZhciBGb250UGlja2VyID0gc3RvcmFnZS5nZXQoZWxlbWVudCk7XG4gICAgICAgIGlmICghRm9udFBpY2tlcikge1xuICAgICAgICAgICAgRm9udFBpY2tlciA9IG5ldyBGb250cygpO1xuICAgICAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudCwgRm9udFBpY2tlcik7XG4gICAgICAgIH1cblxuICAgICAgICBGb250UGlja2VyLm9wZW4oZXZlbnQsIGVsZW1lbnQpO1xuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRm9udHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICBkb21yZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS5tb2RhbCxcbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4JyksXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhVUkwgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5nbG9iYWwsXG4gICAgdHJhbnNsYXRlICAgICA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3RyYW5zbGF0ZScpLFxuXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBjb250YWlucyAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcbiAgICBib2R5LmRlbGVnYXRlKCdrZXl1cCcsICcuZy1pY29ucyBpbnB1dFt0eXBlPVwidGV4dFwiXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciBwcmV2aWV3ID0gZWxlbWVudC5zaWJsaW5nKCdbZGF0YS1nNS1pY29ucGlja2VyXScpIHx8IGVsZW1lbnQuc2libGluZ3MoKS5maW5kKCdbZGF0YS1nNS1pY29ucGlja2VyXScpLFxuICAgICAgICAgICAgdmFsdWUgPSBlbGVtZW50LnZhbHVlKCksXG4gICAgICAgICAgICBzaXplO1xuXG4gICAgICAgIHByZXZpZXcuZmluZCgnaScpLmF0dHJpYnV0ZSgnY2xhc3MnLCB2YWx1ZSB8fCAnZmEgZmEtaGFuZC1vLXVwIHBpY2tlcicpO1xuXG4gICAgICAgIHNpemUgPSBwcmV2aWV3WzBdLm9mZnNldFdpZHRoO1xuXG4gICAgICAgIGlmICghc2l6ZSkgeyBwcmV2aWV3LmZpbmQoJ2knKS5hdHRyaWJ1dGUoJ2NsYXNzJywgJ2ZhIGZhLWhhbmQtby11cCBwaWNrZXInKTsgfVxuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtaWNvbnBpY2tlcl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIGZpZWxkID0gJChlbGVtZW50LmRhdGEoJ2c1LWljb25waWNrZXInKSksXG4gICAgICAgICAgICByZWFsUHJldmlldyA9IGVsZW1lbnQsXG4gICAgICAgICAgICB2YWx1ZSA9IHRyaW0oZmllbGQudmFsdWUoKSkucmVwbGFjZSgvXFxzezIsfS9nLCAnICcpLnNwbGl0KCcgJyk7XG5cbiAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICBjb250ZW50OiB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE9BRElORycpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZzUtZGlhbG9nLXRoZW1lLWRlZmF1bHQgZzUtbW9kYWwtaWNvbnMnLFxuICAgICAgICAgICAgcmVtb3RlOiBwYXJzZUFqYXhVUkkoZ2V0QWpheFVSTCgnaWNvbnMnKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICBhZnRlckNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9wb3ZlcnMgPSAkKCcuZzUtcG9wb3ZlcicpO1xuICAgICAgICAgICAgICAgIGlmIChwb3BvdmVycykgeyBwb3BvdmVycy5yZW1vdmUoKTsgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCwgbGFyZ2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgaWNvbnMgPSBjb250YWluZXIuc2VhcmNoKCdbZGF0YS1nLWljb25dJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWljb25zIHx8ICFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmh0bWwocmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZVByZXZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGNvbnRhaW5lci5maW5kKCdbZGF0YS1nLWljb25dLmFjdGl2ZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IGNvbnRhaW5lci5zZWFyY2goJy5nLXBhcnRpY2xlcy1oZWFkZXIgLmZsb2F0LXJpZ2h0IGlucHV0OmNoZWNrZWQsIC5nLXBhcnRpY2xlcy1oZWFkZXIgLmZsb2F0LXJpZ2h0IHNlbGVjdCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUpIHsgZGF0YS5wdXNoKGFjdGl2ZS5kYXRhKCdnLWljb24nKSk7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9ICQob3B0aW9uKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ICYmIHYgIT09ICdmYS0nKSB7IGRhdGEucHVzaCh2KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmctaWNvbi1wcmV2aWV3JykuaHRtbCgnPGkgY2xhc3M9XCJmYSAnICsgZGF0YS5qb2luKCcgJykgKyAnXCI+PC9pPiA8c3Bhbj4nICsgZGF0YVswXSArICc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCdbZGF0YS1nLXNlbGVjdF0nKS5kaXNhYmxlZChjb250YWluZXIuZmluZCgnW2RhdGEtZy1pY29uXS5hY3RpdmUnKSA/IG51bGwgOiB0cnVlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZVRvdGFsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IGNvbnRhaW5lci5zZWFyY2goJ1tkYXRhLWctaWNvbl06bm90KC5oaWRlLWljb24pJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcucGFydGljbGUtc2VhcmNoLXRvdGFsJykudGV4dCh0b3RhbCA/IHRvdGFsLmxlbmd0aCA6IDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnW2RhdGEtZy1zZWxlY3RdJykuZGlzYWJsZWQoY29udGFpbmVyLmZpbmQoJ1tkYXRhLWctaWNvbl0uYWN0aXZlJykgPyBudWxsIDogdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBjb250YWluZXIuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWctaWNvbl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlID0gY29udGFpbmVyLmZpbmQoJ1tkYXRhLWctaWNvbl0uYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUpIHsgYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsgfVxuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnW2RhdGEtZy1zZWxlY3RdJykuZGlzYWJsZWQobnVsbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXNlbGVjdF0nLCBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250YWluZXIuZmluZCgnW2RhdGEtZy1pY29uXS5hY3RpdmUnKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0cHV0ID0gY29udGFpbmVyLmZpbmQoJy5nLWljb24tcHJldmlldyBpJyk7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnZhbHVlKG91dHB1dC5hdHRyaWJ1dGUoJ2NsYXNzJykpO1xuICAgICAgICAgICAgICAgICAgICByZWFsUHJldmlldy5maW5kKCdpJykuYXR0cmlidXRlKCdjbGFzcycsIG91dHB1dC5hdHRyaWJ1dGUoJ2NsYXNzJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLmVtaXQoJ2lucHV0Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmVtaXQoJ2lucHV0Jywge3RhcmdldDogZmllbGR9KTtcblxuICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmRlbGVnYXRlKCdjaGFuZ2UnLCAnLmctcGFydGljbGVzLWhlYWRlciAuZmxvYXQtcmlnaHQgaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdLCAuZy1wYXJ0aWNsZXMtaGVhZGVyIC5mbG9hdC1yaWdodCBzZWxlY3QnLCBmdW5jdGlvbigvKmUsIGlucHV0Ki8pIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmRlbGVnYXRlKCdrZXl1cCcsICcucGFydGljbGUtc2VhcmNoLXdyYXBwZXIgaW5wdXRbdHlwZT1cInRleHRcIl0nLCBmdW5jdGlvbihlLCBpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dCA9ICQoaW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtZy1pY29uXS5oaWRlLWljb24nKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuLnJlbW92ZUNsYXNzKCdoaWRlLWljb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBjb250YWluZXIuc2VhcmNoKCdbZGF0YS1nLWljb24qPVwiJyArIHZhbHVlICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuc2VhcmNoKCdbZGF0YS1nLWljb25dJykuYWRkQ2xhc3MoJ2hpZGUtaWNvbicpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kLnJlbW92ZUNsYXNzKCdoaWRlLWljb24nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsKCk7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGljb25zLmZvckVhY2goZnVuY3Rpb24oaWNvbikge1xuICAgICAgICAgICAgICAgICAgICBpY29uID0gJChpY29uKTtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSA1LCBsID0gMDsgaSA+IGw7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFyZ2UgPSAoIWkpID8gJ2xnJyA6IGkgKyAneCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8aSBjbGFzcz1cImZhICcgKyBpY29uLmRhdGEoJ2ctaWNvbicpICsgJyBmYS0nICsgbGFyZ2UgKyAnXCI+PC9pPiAnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPGgzPicgKyBpY29uLmRhdGEoJ2ctaWNvbicpICsgJzwvaDM+JztcblxuICAgICAgICAgICAgICAgICAgICBpY29uLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21vdXNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnYWJvdmUtbW9kYWwsIGljb25zLXByZXZpZXcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50czogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogMVxuICAgICAgICAgICAgICAgICAgICB9KS5vbignaGlkZGVuLnBvcG92ZXInLCBmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLiR0YXJnZXQpIHsgaW5zdGFuY2UuJHRhcmdldC5yZW1vdmUoKTsgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbnModmFsdWUsIGljb24uZGF0YSgnZy1pY29uJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYWN0aXZlIGljb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2dnbGUgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gY29udGFpbmVyLmZpbmQoJ1tuYW1lPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkKSB7IGZpZWxkLmNoZWNrZWQodHJ1ZSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBjb250YWluZXIuZmluZCgnb3B0aW9uW3ZhbHVlPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCkgeyBmaWVsZC5wYXJlbnQoKS52YWx1ZShuYW1lKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGwgaW50byBwbGFjZSBvZiBhY3RpdmUgaWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdyYXAgPSBpY29uLnBhcmVudCgnLmljb25zLXdyYXBwZXInKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cmFwSGVpZ2h0ID0gd3JhcFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwWzBdLnNjcm9sbFRvcCA9IGljb25bMF0ub2Zmc2V0VG9wIC0gKHdyYXBIZWlnaHQgLyAyKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByZXZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wYXJ0aWNsZS1zZWFyY2gtd3JhcHBlciBpbnB1dCcpWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307XG4iLCJcInVzZSBzdHJpY3RcIjtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgY29sb3JwaWNrZXI6IHJlcXVpcmUoJy4vY29sb3JwaWNrZXInKSxcbiAgICBmb250czogcmVxdWlyZSgnLi9mb250cycpLFxuICAgIG1lbnU6IHJlcXVpcmUoJy4vbWVudScpLFxuICAgIGljb25zOiByZXF1aXJlKCcuL2ljb25zJyksXG4gICAgZmlsZXBpY2tlcjogcmVxdWlyZSgnLi9maWxlcGlja2VyJyksXG4gICAgY29sbGVjdGlvbnM6IHJlcXVpcmUoJy4vY29sbGVjdGlvbnMnKSxcbiAgICBrZXl2YWx1ZTogcmVxdWlyZSgnLi9rZXl2YWx1ZScpLFxuICAgIGluc3RhbmNlcGlja2VyOiByZXF1aXJlKCcuL2luc3RhbmNlcGlja2VyJylcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgcmVhZHkgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgU3VibWl0ICAgICAgICA9IHJlcXVpcmUoJy4uLy4uL2ZpZWxkcy9zdWJtaXQnKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS5tb2RhbCxcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuICAgIHBhcnNlQWpheFVSSSAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnZhciBXb3JkcHJlc3NXaWRnZXRzQ3VzdG9taXplciA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3dwLXdpZGdldHMtY3VzdG9taXplcicpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKSxcbiAgICAgICAgcGFydGljbGVGaWVsZCA9ICQoJ1tkYXRhLWctaW5zdGFuY2VwaWNrZXJdIH4gaW5wdXRbdHlwZT1cImhpZGRlblwiXScpLFxuICAgICAgICBtb2R1bGVUeXBlID0ge1xuICAgICAgICAgICAgd29yZHByZXNzOiAnd2lkZ2V0JyxcbiAgICAgICAgICAgIGpvb21sYTogJ21vZHVsZSdcbiAgICAgICAgfTtcblxuICAgIC8vaWYgKHBhcnRpY2xlRmllbGQpIHtcbiAgICAgICAgLy9wYXJ0aWNsZUZpZWxkLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICBib2R5LmRlbGVnYXRlKCdpbnB1dCcsICdbZGF0YS1nLWluc3RhbmNlcGlja2VyXSB+IGlucHV0W3R5cGU9XCJoaWRkZW5cIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCl7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQudmFsdWUoKSkge1xuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9IGVsZW1lbnQuc2libGluZ3MoJy5nLWluc3RhbmNlcGlja2VyLXRpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gZWxlbWVudC5zaWJsaW5ncygnW2RhdGEtZy1pbnN0YW5jZXBpY2tlcl0nKSxcbiAgICAgICAgICAgICAgICAgICAgcmVzZXQgPSBlbGVtZW50LnNpYmxpbmcoJy5nLXJlc2V0LWZpZWxkJyk7XG5cbiAgICAgICAgICAgICAgICB0aXRsZS50ZXh0KCcnKTtcbiAgICAgICAgICAgICAgICBsYWJlbC50ZXh0KGxhYmVsLmRhdGEoJ2ctaW5zdGFuY2VwaWNrZXItdGV4dCcpKTtcbiAgICAgICAgICAgICAgICByZXNldC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIC8vfVxuXG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLWluc3RhbmNlcGlja2VyXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZy1pbnN0YW5jZXBpY2tlcicpKSxcbiAgICAgICAgICAgIGZpZWxkID0gJCgnW25hbWU9XCInICsgZGF0YS5maWVsZCArICdcIl0nKSxcbiAgICAgICAgICAgIHZhbHVlLCB1cmk7IC8vID0gJ3BhcnRpY2xlJyArICgoZGF0YS50eXBlID09IG1vZHVsZVR5cGVbR0FOVFJZX1BMQVRGT1JNXSkgPyAnLycgKyBtb2R1bGVUeXBlW0dBTlRSWV9QTEFURk9STV0gOiAnJyksXG5cbiAgICAgICAgaWYgKGRhdGEudHlwZSA9PSBtb2R1bGVUeXBlW0dBTlRSWV9QTEFURk9STV0pIHtcbiAgICAgICAgICAgIHVyaSA9IChkYXRhLnR5cGUgIT0gJ3dpZGdldCcgPyAncGFydGljbGUvJyA6ICcnKSArIG1vZHVsZVR5cGVbR0FOVFJZX1BMQVRGT1JNXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVyaSA9ICdwYXJ0aWNsZSc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWZpZWxkKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhbHVlID0gZmllbGQudmFsdWUoKTtcblxuICAgICAgICBpZiAoKGRhdGEudHlwZSA9PSAncGFydGljbGUnIHx8IGRhdGEudHlwZSA9PSAnd2lkZ2V0JykgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gSlNPTi5wYXJzZSh2YWx1ZSB8fCB7fSk7XG4gICAgICAgICAgICB1cmkgPSB2YWx1ZS50eXBlICsgJy8nICsgdmFsdWVbZGF0YS50eXBlXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLm1vZGFsX2Nsb3NlKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICBjb250ZW50OiB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfTE9BRElORycpLFxuICAgICAgICAgICAgbWV0aG9kOiAhdmFsdWUgfHwgZGF0YS50eXBlID09ICdtb2R1bGUnID8gJ2dldCcgOiAncG9zdCcsIC8vIGRhdGEudHlwZSA9PSBtb2R1bGVUeXBlW0dBTlRSWV9QTEFURk9STV1cbiAgICAgICAgICAgIGRhdGE6ICF2YWx1ZSB8fCBkYXRhLnR5cGUgPT0gJ21vZHVsZScgPyB7fSA6IHZhbHVlLCAvLyBkYXRhLnR5cGUgPT0gbW9kdWxlVHlwZVtHQU5UUllfUExBVEZPUk1dXG4gICAgICAgICAgICBvdmVybGF5Q2xpY2tUb0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGdldEFqYXhVUkwodXJpKSArIGdldEFqYXhTdWZmaXgoKSksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBtb2RhbEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwuZW5hYmxlQ2xvc2VCeU92ZXJsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbW9kYWxJbnN0YW5jZS5lbGVtZW50cy5jb250ZW50LFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSBjb250ZW50LmZpbmQoJ1tkYXRhLW1tLXNlbGVjdF0nKTtcblxuICAgICAgICAgICAgICAgIHZhciBzZWFyY2ggPSBjb250ZW50LmZpbmQoJy5zZWFyY2ggaW5wdXQnKSxcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzID0gY29udGVudC5zZWFyY2goJ1tkYXRhLW1tLXR5cGVdJyksXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMgPSBjb250ZW50LnNlYXJjaCgnW2RhdGEtbW0tZmlsdGVyXScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlYXJjaCAmJiBmaWx0ZXJzICYmIGJsb2Nrcykge1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2gub24oJ2lucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmFsdWUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBbXSwgdmFsdWUgPSB0aGlzLnZhbHVlKCkudG9Mb3dlckNhc2UoKSwgdGV4dDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5mb3JFYWNoKGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9ICQoZmlsdGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdHJpbShmaWx0ZXIuZGF0YSgnbW0tZmlsdGVyJykpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQubWF0Y2gobmV3IFJlZ0V4cChcIl5cIiArIHZhbHVlICsgJ3xcXFxccycgKyB2YWx1ZSwgJ2dpJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kLnB1c2goZmlsdGVyLm1hdGNoZXMoJ1tkYXRhLW1tLXR5cGVdJykgPyBmaWx0ZXIgOiBmaWx0ZXIucGFyZW50KCdbZGF0YS1tbS10eXBlXScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCkgeyAkKGZvdW5kKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7IH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFswXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9LCA1KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudERhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZy1pbnN0YW5jZXBpY2tlcicpKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudERhdGEudHlwZSA9PSBtb2R1bGVUeXBlW0dBTlRSWV9QTEFURk9STV0pIHsgZWxlbWVudERhdGEubW9kYWxfY2xvc2UgPSB0cnVlOyB9XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdCkgeyBzZWxlY3QuZGF0YSgnZy1pbnN0YW5jZXBpY2tlcicsIEpTT04uc3RyaW5naWZ5KGVsZW1lbnREYXRhKSk7IH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm0gPSBjb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZha2VET00gPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHkpLmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdCA9IGNvbnRlbnQuZmluZCgnaW5wdXRbdHlwZT1cInN1Ym1pdFwiXSwgYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKCFmb3JtICYmICFmYWtlRE9NKSB8fCAhc3VibWl0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGx5QW5kU2F2ZSA9IGNvbnRlbnQuc2VhcmNoKCdbZGF0YS1hcHBseS1hbmQtc2F2ZV0nKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcGx5QW5kU2F2ZSkgeyBhcHBseUFuZFNhdmUucmVtb3ZlKCk7IH1cblxuICAgICAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zdCA9IFN1Ym1pdChmYWtlRE9NWzBdLmVsZW1lbnRzLCBjb250ZW50KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdChmYWtlRE9NLmF0dHJpYnV0ZSgnbWV0aG9kJyksIHBhcnNlQWpheFVSSShmYWtlRE9NLmF0dHJpYnV0ZSgnYWN0aW9uJykgKyBnZXRBamF4U3VmZml4KCkpLCBwb3N0LnZhbGlkLmpvaW4oJyYnKSB8fCB7fSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gZmllbGQuc2libGluZ3MoJy5nLWluc3RhbmNlcGlja2VyLXRpdGxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC52YWx1ZShKU09OLnN0cmluZ2lmeShyZXNwb25zZS5ib2R5Lml0ZW0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZmllbGQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFiZWwpIHsgbGFiZWwudGV4dChyZXNwb25zZS5ib2R5Lml0ZW0udGl0bGUpOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQuaGlkZUluZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgV29yZHByZXNzV2lkZ2V0c0N1c3RvbWl6ZXIoZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHt9O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgaGFzICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2hhcycpLFxuICAgIHNvbWUgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L3NvbWUnKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS5tb2RhbCxcbiAgICB0b2FzdHIgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS50b2FzdHIsXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgaW5kZXhPZiAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIGNvbnRhaW5zICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbnRhaW5zJyksXG4gICAgbGFzdEl0ZW0gICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvbGFzdCcpLFxuICAgIGtleXMgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9rZXlzJyksXG4gICAgc2ltcGxlU29ydCAgICA9IHJlcXVpcmUoJ3NvcnRhYmxlanMnKSxcbiAgICBlc2NhcGVVbmljb2RlID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvZXNjYXBlVW5pY29kZScpLFxuXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcblxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvdHJhbnNsYXRlJyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2luc2VydGlvbicpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIHZhciBjcmVhdGVTb3J0YWJsZXMgPSBmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgIHZhciBsaXN0cyA9IGxpc3QgfHwgJCgnLmcta2V5dmFsdWUtZmllbGQgdWwnKTtcbiAgICAgICAgaWYgKCFsaXN0cykgeyByZXR1cm47IH1cbiAgICAgICAgbGlzdHMuZm9yRWFjaChmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgICAgICBsaXN0ID0gJChsaXN0KTtcbiAgICAgICAgICAgIGxpc3QuU2ltcGxlU29ydCA9IHNpbXBsZVNvcnQuY3JlYXRlKGxpc3RbMF0sIHtcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICcuZmEtcmVvcmRlcicsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEta2V5dmFsdWUtbm9zb3J0XScsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IDE1MCxcbiAgICAgICAgICAgICAgICBvblN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzLmVsKS5hZGRDbGFzcygna2V5dmFsdWUtc29ydGluZycpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FbmQ6IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQodGhpcy5lbCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2tleXZhbHVlLXNvcnRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZ0Lm9sZEluZGV4ID09PSBldnQubmV3SW5kZXgpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1rZXl2YWx1ZS1kYXRhXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgID0gZGF0YUZpZWxkLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zcGxpY2UoZXZ0Lm5ld0luZGV4LCAwLCBkYXRhLnNwbGljZShldnQub2xkSW5kZXgsIDEpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUZpZWxkLnZhbHVlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgY3JlYXRlU29ydGFibGVzKCk7XG5cbiAgICAvLyBkZWxlZ2F0ZSBzb3J0YWJsZXMgY29sbGVjdGlvbnMgZm9yIGFqYXggc3VwcG9ydFxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICcuZy1rZXl2YWx1ZS1maWVsZCB1bCcsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmICghZWxlbWVudC5TaW1wbGVTb3J0KSB7IGNyZWF0ZVNvcnRhYmxlcyhlbGVtZW50KTsgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIG5ldyBpdGVtXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEta2V5dmFsdWUtYWRkbmV3XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBwYXJhbSA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgIGxpc3QgID0gcGFyYW0uZmluZCgndWwnKSxcbiAgICAgICAgICAgIHRtcGwgID0gcGFyYW0uZmluZCgnW2RhdGEta2V5dmFsdWUtdGVtcGxhdGVdJyksXG4gICAgICAgICAgICBpdGVtcyA9IGxpc3Quc2VhcmNoKCc+IFtkYXRhLWtleXZhbHVlLWl0ZW1dJykgfHwgW10sXG4gICAgICAgICAgICBsYXN0ICA9ICQobGFzdEl0ZW0oaXRlbXMpKTtcblxuICAgICAgICB2YXIgY2xvbmUgPSAkKHRtcGxbMF0uY2xvbmVOb2RlKHRydWUpKTtcblxuICAgICAgICBpZiAobGFzdCkgeyBjbG9uZS5hZnRlcihsYXN0KTsgfVxuICAgICAgICBlbHNlIHsgY2xvbmUudG9wKGxpc3QpOyB9XG5cbiAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpLmRhdGEoJ2tleXZhbHVlLWl0ZW0nLCBjbG9uZS5kYXRhKCdrZXl2YWx1ZS10ZW1wbGF0ZScpKTtcbiAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdkYXRhLWtleXZhbHVlLXRlbXBsYXRlJywgbnVsbCk7XG4gICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnZGF0YS1rZXl2YWx1ZS1ub3NvcnQnLCBudWxsKTtcbiAgICAgICAgY2xvbmUuZmluZCgnW2RhdGEta2V5dmFsdWUta2V5XScpWzBdLmZvY3VzKCk7XG5cbiAgICAgICAgLy9ib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmUgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWtleXZhbHVlLXJlbW92ZV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICB2YXIgaXRlbSAgICAgID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWtleXZhbHVlLWl0ZW1dJyksXG4gICAgICAgICAgICBrZXkgICAgICAgPSBpdGVtLmZpbmQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykuZGF0YSgna2V5dmFsdWUta2V5JyksXG4gICAgICAgICAgICBkYXRhRmllbGQgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJykuZmluZCgnW2RhdGEta2V5dmFsdWUtZGF0YV0nKSxcbiAgICAgICAgICAgIGl0ZW1zICAgICA9IGVsZW1lbnQucGFyZW50KCd1bCcpLnNlYXJjaCgnPiBbZGF0YS1rZXl2YWx1ZS1pdGVtXScpLFxuICAgICAgICAgICAgaW5kZXggICAgID0gaW5kZXhPZihpdGVtcywgaXRlbVswXSksXG4gICAgICAgICAgICBkYXRhICAgICAgPSBKU09OLnBhcnNlKGRhdGFGaWVsZC52YWx1ZSgpKTtcblxuICAgICAgICBkYXRhLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIGRhdGFGaWVsZC52YWx1ZShlc2NhcGVVbmljb2RlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSk7XG4gICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG5cbiAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gQ2hhbmdlIHZhbHVlc1xuICAgIGJvZHkuZGVsZWdhdGUoJ2JsdXInLCAnW2RhdGEta2V5dmFsdWUtaXRlbV0gaW5wdXRbdHlwZT1cInRleHRcIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyZW50ICAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1rZXl2YWx1ZS1pdGVtXScpLFxuICAgICAgICAgICAgd3JhcHBlciAgICA9IHBhcmVudC5maW5kKCcuZy1rZXl2YWx1ZS13cmFwcGVyJyksXG4gICAgICAgICAgICBrZXlFbGVtZW50ID0gcGFyZW50LmZpbmQoJ1tkYXRhLWtleXZhbHVlLWtleV0nKSxcbiAgICAgICAgICAgIHZhbEVsZW1lbnQgPSBwYXJlbnQuZmluZCgnW2RhdGEta2V5dmFsdWUtdmFsdWVdJyksXG4gICAgICAgICAgICBrZXkgICAgICAgID0ga2V5RWxlbWVudC5kYXRhKCdrZXl2YWx1ZS1rZXknKSxcbiAgICAgICAgICAgIGtleVZhbHVlICAgPSB0cmltKGtleUVsZW1lbnQudmFsdWUoKSksXG4gICAgICAgICAgICB2YWxWYWx1ZSAgID0gdHJpbSh2YWxFbGVtZW50LnZhbHVlKCkpLFxuICAgICAgICAgICAgaXRlbXMgICAgICA9IGVsZW1lbnQucGFyZW50KCd1bCcpLnNlYXJjaCgnPiBbZGF0YS1rZXl2YWx1ZS1pdGVtXTpub3QoLmcta2V5dmFsdWUtd2FybmluZyk6bm90KC5nLWtleXZhbHVlLWV4Y2x1ZGVkKScpLFxuICAgICAgICAgICAgaW5kZXggICAgICA9IGluZGV4T2YoaXRlbXMsIHBhcmVudFswXSksXG5cbiAgICAgICAgICAgIGRhdGFGaWVsZCAgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJykuZmluZCgnW2RhdGEta2V5dmFsdWUtZGF0YV0nKSxcbiAgICAgICAgICAgIGRhdGEgICAgICAgPSBKU09OLnBhcnNlKGRhdGFGaWVsZC52YWx1ZSgpKSxcbiAgICAgICAgICAgIGV4Y2x1ZGUgICAgPSBKU09OLnBhcnNlKGRhdGFGaWVsZC5kYXRhKCdrZXl2YWx1ZS1leGNsdWRlJykpLFxuICAgICAgICAgICAgZXhjbHVkZWQgICA9IGNvbnRhaW5zKGV4Y2x1ZGUsIGtleVZhbHVlKSxcbiAgICAgICAgICAgIGR1cGxpY2F0ZSAgPSBzb21lKGRhdGEsIGZ1bmN0aW9uKG9iaikgeyByZXR1cm4gaGFzKG9iaiwga2V5VmFsdWUpOyB9KSAmJiBrZXkgIT09IGtleVZhbHVlO1xuXG4gICAgICAgIGlmIChrZXlFbGVtZW50ID09IGVsZW1lbnQpIHtcbiAgICAgICAgICAgIC8vIHJlbmFtZWQgb3IgY2xlYXJlZCBrZXksIG5lZWQgdG8gY2xlYW51cCBKU09OXG4gICAgICAgICAgICBpZiAoa2V5ICE9PSBrZXlWYWx1ZSAmJiAhZHVwbGljYXRlKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIGtleUVsZW1lbnQuZGF0YSgna2V5dmFsdWUta2V5Jywga2V5VmFsdWUgfHwgJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYXJlbnRbZHVwbGljYXRlID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKCdnLWtleXZhbHVlLXdhcm5pbmcnKTtcbiAgICAgICAgICAgIHBhcmVudFtleGNsdWRlZCA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnZy1rZXl2YWx1ZS1leGNsdWRlZCcpO1xuXG4gICAgICAgICAgICB3cmFwcGVyXG4gICAgICAgICAgICAgICAgLmRhdGEoJ3RpcCcsIGR1cGxpY2F0ZSA/IHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19LRVlWQUxVRV9EVVBMSUNBVEUnLCBrZXlWYWx1ZSkgOiAoZXhjbHVkZWQgPyB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfS0VZVkFMVUVfRVhDTFVERUQnLCBrZXlWYWx1ZSkgOiBudWxsKSlcbiAgICAgICAgICAgICAgICAuZGF0YSgndGlwLXBsYWNlJywgJ3RvcC1yaWdodCcpXG4gICAgICAgICAgICAgICAgLmRhdGEoJ3RpcC1zcGFjaW5nJywgMilcbiAgICAgICAgICAgICAgICAuZGF0YSgndGlwLW9mZnNldCcsIDgpO1xuXG4gICAgICAgICAgICBpZiAoZXhjbHVkZWQgfHwgZHVwbGljYXRlKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lkc1LnRpcHMuZ2V0KHdyYXBwZXJbMF0pLnNob3coKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lkc1LnRpcHMucmVtb3ZlKHdyYXBwZXJbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleVZhbHVlICYmICFleGNsdWRlZCAmJiAhZHVwbGljYXRlKSB7XG4gICAgICAgICAgICBpZiAoIWRhdGFbaW5kZXhdKSB7IGRhdGEuc3BsaWNlKGluZGV4LCAwLCB7fSk7IH1cbiAgICAgICAgICAgIGRhdGFbaW5kZXhdW2tleVZhbHVlXSA9IHZhbFZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0YUZpZWxkLnZhbHVlKGVzY2FwZVVuaWNvZGUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpKTtcbiAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuXG4gICAgfSwgdHJ1ZSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCd1cGRhdGUnLCAnW2RhdGEta2V5dmFsdWUtZGF0YV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoKSxcbiAgICAgICAgICAgIGl0ZW1zICA9IHBhcmVudC5zZWFyY2goJ1tkYXRhLWtleXZhbHVlLWl0ZW1dJyksXG4gICAgICAgICAgICBsaXN0ICAgPSBwYXJlbnQuZmluZCgndWwnKSxcbiAgICAgICAgICAgIGRhdGEgICA9IEpTT04ucGFyc2UoZWxlbWVudC52YWx1ZSgpKSxcbiAgICAgICAgICAgIHRtcGwgICA9IHBhcmVudC5maW5kKCdbZGF0YS1rZXl2YWx1ZS10ZW1wbGF0ZV0nKTtcblxuICAgICAgICBpZiAoaXRlbXMpIHsgaXRlbXMucmVtb3ZlKCk7IH1cblxuICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ob2JqLCBpbmRleCkge1xuICAgICAgICAgICAgdmFyIGNsb25lID0gJCh0bXBsWzBdLmNsb25lTm9kZSh0cnVlKSksXG4gICAgICAgICAgICAgICAga2V5ICAgPSBrZXlzKG9iaikuc2hpZnQoKSxcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IG9ialtrZXldO1xuXG4gICAgICAgICAgICBsaXN0LmFwcGVuZENoaWxkKGNsb25lKTtcblxuICAgICAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpLmRhdGEoJ2tleXZhbHVlLWl0ZW0nLCBjbG9uZS5kYXRhKCdrZXl2YWx1ZS10ZW1wbGF0ZScpKTtcbiAgICAgICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnZGF0YS1rZXl2YWx1ZS10ZW1wbGF0ZScsIG51bGwpO1xuICAgICAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdkYXRhLWtleXZhbHVlLW5vc29ydCcsIG51bGwpO1xuICAgICAgICAgICAgY2xvbmUuZmluZCgnW2RhdGEta2V5dmFsdWUta2V5XScpLnZhbHVlKGtleSk7XG4gICAgICAgICAgICBjbG9uZS5maW5kKCdbZGF0YS1rZXl2YWx1ZS12YWx1ZV0nKS52YWx1ZSh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyICQgICAgICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIGRvbXJlYWR5ICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nNS1jb250ZW50XSAuZy1tYWluLW5hdiAuZy10b3BsZXZlbCBbZGF0YS1nNS1hamF4aWZ5XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIHZhciBpdGVtcyA9ICQoJ1tkYXRhLWc1LWNvbnRlbnRdIC5nLW1haW4tbmF2IC5nLXRvcGxldmVsIFtkYXRhLWc1LWFqYXhpZnldICE+IGxpJyk7XG4gICAgICAgIGlmIChpdGVtcykgeyBpdGVtcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cbiAgICAgICAgZWxlbWVudC5wYXJlbnQoJ2xpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgcmVhZHkgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBrZXlzICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3Qva2V5cycpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLm1vZGFsLFxuICAgIHRvYXN0ciAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLnRvYXN0cixcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4JyksXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhVUkwgICAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5nbG9iYWwsXG5cbiAgICBFcmFzZXIgICAgICAgID0gcmVxdWlyZSgnLi4vdWkvZXJhc2VyJyksXG4gICAgc2ltcGxlU29ydCAgICA9IHJlcXVpcmUoJ3NvcnRhYmxlanMnKSxcblxuICAgIGZsYWdzICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9mbGFncy1zdGF0ZScpO1xuXG5cbnZhciBQb3NpdGlvbnNGaWVsZCA9ICdbbmFtZT1cInBhZ2VbaGVhZF1bYXRvbXNdW19qc29uXVwiXScsXG4gICAgZ3JvdXBPcHRpb25zICAgPSBbXG4gICAgICAgIHsgbmFtZTogJ3Bvc2l0aW9ucycsIHB1bGw6IHRydWUsIHB1dDogdHJ1ZSB9LFxuICAgICAgICB7IG5hbWU6ICdwb3NpdGlvbnMnLCBwdWxsOiBmYWxzZSwgcHV0OiBmYWxzZSB9XG4gICAgXTtcblxudmFyIFBvc2l0aW9ucyA9IHtcbiAgICBlcmFzZXI6IG51bGwsXG4gICAgbGlzdHM6IFtdLFxuXG4gICAgc2VyaWFsaXplOiBmdW5jdGlvbihwb3NpdGlvbikge1xuICAgICAgICB2YXIgZGF0YSxcbiAgICAgICAgICAgIG91dHB1dCA9IFtdLFxuICAgICAgICAgICAgcG9zaXRpb25zICA9ICQocG9zaXRpb24pIHx8ICQoJ1tkYXRhLXBvc2l0aW9uXScpO1xuXG4gICAgICAgIGlmICghcG9zaXRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1tdJztcbiAgICAgICAgfVxuXG4gICAgICAgIHBvc2l0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9ICQocG9zaXRpb24pO1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocG9zaXRpb24uZGF0YSgncG9zaXRpb24nKSk7XG4gICAgICAgICAgICBkYXRhLm1vZHVsZXMgPSBbXTtcblxuICAgICAgICAgICAgLy8gY29sbGVjdCBwb3NpdGlvbnMgaXRlbXNcbiAgICAgICAgICAgIChwb3NpdGlvbi5zZWFyY2goJ1tkYXRhLXBtLWRhdGFdJykgfHwgW10pLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSAkKGl0ZW0pO1xuICAgICAgICAgICAgICAgIGRhdGEubW9kdWxlcy5wdXNoKEpTT04ucGFyc2UoaXRlbS5kYXRhKCdwbS1kYXRhJykgfHwgJ3t9JykpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG91dHB1dC5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgcG9zaXRpb24uZGF0YSgncG9zaXRpb24nLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvdXRwdXQpLnJlcGxhY2UoL1xcLy9nLCAnXFxcXC8nKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoRXJhc2VyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKFBvc2l0aW9ucy5lcmFzZXIpIHtcbiAgICAgICAgICAgIFBvc2l0aW9ucy5lcmFzZXIuZWxlbWVudCA9ICQoJ1tkYXRhLXBvc2l0aW9ucy1lcmFzZV0nKTtcbiAgICAgICAgICAgIFBvc2l0aW9ucy5lcmFzZXIuaGlkZSgnZmFzdCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgUG9zaXRpb25zLmVyYXNlciA9IG5ldyBFcmFzZXIoJ1tkYXRhLXBvc2l0aW9ucy1lcmFzZV0nKTtcbiAgICB9LFxuXG4gICAgY3JlYXRlU29ydGFibGVzOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBsaXN0LCBzb3J0O1xuXG4gICAgICAgIFBvc2l0aW9ucy5hdHRhY2hFcmFzZXIoKTtcblxuICAgICAgICBncm91cE9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihncm91cE9wdGlvbiwgaSkge1xuICAgICAgICAgICAgbGlzdCA9ICFpID8gJ1tkYXRhLXBvc2l0aW9uXSB1bCcgOiAnI3RyYXNoJztcbiAgICAgICAgICAgIGxpc3QgPSAkKGxpc3QpO1xuXG4gICAgICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCwgbGlzdEluZGV4KXtcbiAgICAgICAgICAgICAgICBzb3J0ID0gc2ltcGxlU29ydC5jcmVhdGUoZWxlbWVudCwge1xuICAgICAgICAgICAgICAgICAgICBzb3J0OiAhaSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEtcG9zaXRpb24taWdub3JlXScsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwOiBncm91cE9wdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmb3JjZUZhbGxiYWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IDEwMCxcblxuICAgICAgICAgICAgICAgICAgICBvblN0YXJ0OiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb25zLmF0dGFjaEVyYXNlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQoZXZlbnQuaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCdwb3NpdGlvbi1kcmFnZ2luZycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbnMuZXJhc2VyLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBvbkVuZDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtICAgICAgID0gJChldmVudC5pdGVtKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFzaCAgICAgID0gJCgnI3RyYXNoJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ICAgICA9ICQodGhpcy5vcmlnaW5hbEV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hUcmFzaCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciB0b3VjaCBkZXZpY2VzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcmlnaW5hbEV2ZW50LnR5cGUgPT09ICd0b3VjaGVuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhc2hTaXplID0gdHJhc2hbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9FICAgICAgICA9IHRoaXMub3JpZ2luYWxFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gID0gKG9FLnBhZ2VZIHx8IG9FLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZKSAtIHdpbmRvdy5zY3JvbGxZO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hUcmFzaCA9IHBvc2l0aW9uIDw9IHRyYXNoU2l6ZS5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcygnI3RyYXNoJykgfHwgdGFyZ2V0LnBhcmVudCgnI3RyYXNoJykgfHwgdG91Y2hUcmFzaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb25zLmVyYXNlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9uU29ydChldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZUNsYXNzKCdwb3NpdGlvbi1kcmFnZ2luZycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbnMuZXJhc2VyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBvblNvcnQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnJvbSA9ICQoZXZlbnQuZnJvbSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gPSAkKGV2ZW50LnRvKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0cyA9IFtmcm9tLnBhcmVudCgnW2RhdGEtcG9zaXRpb25dJyksIHRvLnBhcmVudCgnW2RhdGEtcG9zaXRpb25dJyldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZnJvbVswXSA9PT0gZXZlbnQudG9bMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0cy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbnMuc2VyaWFsaXplKGxpc3RzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBvbk92ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISQoZXZlbnQuZnJvbSkubWF0Y2hlcygndWwnKSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG92ZXIgPSAkKGV2ZW50Lm5ld0luZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdmVyLm1hdGNoZXMoJyN0cmFzaCcpIHx8IG92ZXIucGFyZW50KCcjdHJhc2gnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9ucy5lcmFzZXIub3ZlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbnMuZXJhc2VyLm91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFQb3NpdGlvbnMubGlzdHNbbGlzdEluZGV4XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb25zLmxpc3RzW2xpc3RJbmRleF0gPSBzb3J0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghaSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuU2ltcGxlU29ydCA9IHNvcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cblxudmFyIEF0dGFjaFNvcnRhYmxlUG9zaXRpb25zID0gZnVuY3Rpb24ocG9zaXRpb25zKSB7XG4gICAgaWYgKCFwb3NpdGlvbnMpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCFwb3NpdGlvbnMuU2ltcGxlU29ydCkgeyBQb3NpdGlvbnMuY3JlYXRlU29ydGFibGVzKHBvc2l0aW9ucyk7IH1cbn07XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBwb3NpdGlvbnMgPSAkKCcjcG9zaXRpb25zJyk7XG5cbiAgICAkKCdib2R5JykuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICcjcG9zaXRpb25zJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgQXR0YWNoU29ydGFibGVQb3NpdGlvbnMoZWxlbWVudCk7XG4gICAgfSk7XG5cbiAgICBBdHRhY2hTb3J0YWJsZVBvc2l0aW9ucyhwb3NpdGlvbnMpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUG9zaXRpb25zOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAga2V5cyAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2tleXMnKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vdWknKS5tb2RhbCxcbiAgICB0b2FzdHIgICAgICAgID0gcmVxdWlyZSgnLi4vdWknKS50b2FzdHIsXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpLFxuICAgIHBhcnNlQWpheFVSSSAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5wYXJzZSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuICAgIFN1Ym1pdCAgICAgICAgPSByZXF1aXJlKCcuLi9maWVsZHMvc3VibWl0JyksXG5cbiAgICBmbGFncyAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZmxhZ3Mtc3RhdGUnKSxcbiAgICB0cmFuc2xhdGUgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvdHJhbnNsYXRlJyksXG4gICAgQ2FyZHMgICAgICAgICA9IHJlcXVpcmUoJy4vY2FyZHMnKTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5JyksXG4gICAgICAgIHdhcm5pbmdVUkwgPSBwYXJzZUFqYXhVUkkoZ2V0QWpheFVSTCgnY29uZmlybWRlbGV0aW9uJykgKyBnZXRBamF4U3VmZml4KCkpO1xuXG4gICAgLy8gSGFuZGxlcyBQb3NpdGlvbnMgRHVwbGljYXRlIC8gUmVtb3ZlXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnI3Bvc2l0aW9ucyBbZGF0YS1nLWNvbmZpZ10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgbW9kZSA9IGVsZW1lbnQuZGF0YSgnZy1jb25maWcnKSxcbiAgICAgICAgICAgIGhyZWYgPSBlbGVtZW50LmRhdGEoJ2ctY29uZmlnLWhyZWYnKSxcbiAgICAgICAgICAgIGVuY29kZSA9IHdpbmRvdy5idG9hKGhyZWYpLC8vLnN1YnN0cigtMjAsIDIwKSwgLy8gaW4gY2FzZSB0aGUgc3RyaW5ncyBnZXRzIHRvbyBsb25nXG4gICAgICAgICAgICBtZXRob2QgPSAoZWxlbWVudC5kYXRhKCdnLWNvbmZpZy1tZXRob2QnKSB8fCAncG9zdCcpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBpZiAobW9kZSA9PSAnZGVsZXRlJyAmJiAhZmxhZ3MuZ2V0KCdmcmVlOnRvOmRlbGV0ZTonICsgZW5jb2RlLCBmYWxzZSkpIHtcbiAgICAgICAgICAgIC8vIGNvbmZpcm0gYmVmb3JlIHByb2NlZWRpbmdcbiAgICAgICAgICAgIGZsYWdzLndhcm5pbmcoe1xuICAgICAgICAgICAgICAgIHVybDogd2FybmluZ1VSTCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7cGFnZV90eXBlOiAnUE9TSVRJT04nfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpcm0gPSBjb250ZW50LmZpbmQoJ1tkYXRhLWctZGVsZXRlLWNvbmZpcm1dJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgID0gY29udGVudC5maW5kKCdbZGF0YS1nLWRlbGV0ZS1jYW5jZWxdJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm0ub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmbGFncy5nZXQoJ2ZyZWU6dG86ZGVsZXRlOicgKyBlbmNvZGUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChbY29uZmlybSwgY2FuY2VsXSkuYXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiBlbGVtZW50IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBjYW5jZWwub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFtjb25maXJtLCBjYW5jZWxdKS5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbGFncy5nZXQoJ2ZyZWU6dG86ZGVsZXRlOicgKyBlbmNvZGUsIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICByZXF1ZXN0KG1ldGhvZCwgcGFyc2VBamF4VVJJKGhyZWYgKyBnZXRBamF4U3VmZml4KCkpLCB7fSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbkRlbGV0ZWQgPSByZXNwb25zZS5ib2R5LnBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICByZWxvYWQgPSAkKCdbaHJlZj1cIicgKyBnZXRBamF4VVJMKCdwb3NpdGlvbnMnKSArICdcIl0nKTtcblxuICAgICAgICAgICAgICAgIGlmICghcmVsb2FkKSB7IHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjsgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NsaWNrJywge3RhcmdldDogcmVsb2FkfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuYm9keS5odG1sIHx8ICdBY3Rpb24gc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZC4nLCByZXNwb25zZS5ib2R5LnRpdGxlIHx8ICcnKTtcbiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb25EZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkucG9zaXRpb25EZWxldGVkID0gcG9zaXRpb25EZWxldGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbiAgICAvLyBQb3NpdGlvbnMgQWRkXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnI3Bvc2l0aW9ucyAucG9zaXRpb24tYWRkJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xPQURJTkcnKSxcbiAgICAgICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgICAgICBvdmVybGF5Q2xpY2tUb0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbW90ZTogcGFyc2VBamF4VVJJKGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJykgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLmVuYWJsZUNsb3NlQnlPdmVybGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9ybSAgICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCdmb3JtJyksXG4gICAgICAgICAgICAgICAgICAgIGZha2VET00gICAgPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5odG1sKS5maW5kKCdmb3JtJyksXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pdCAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuc2VhcmNoKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdLCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXSwgW2RhdGEtYXBwbHktYW5kLXNhdmVdJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoICAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnLnNlYXJjaCBpbnB1dCcpLFxuICAgICAgICAgICAgICAgICAgICBibG9ja3MgICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5zZWFyY2goJ1tkYXRhLW1tLXR5cGVdJyksXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LnNlYXJjaCgnW2RhdGEtbW0tZmlsdGVyXScpLFxuICAgICAgICAgICAgICAgICAgICB1cmxUZW1wbGF0ZSA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCcuZy11cmx0ZW1wbGF0ZScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVybFRlbXBsYXRlKSB7IGJvZHkuZW1pdCgnaW5wdXQnLCB7IHRhcmdldDogdXJsVGVtcGxhdGUgfSk7IH1cblxuICAgICAgICAgICAgICAgIHZhciBlZGl0YWJsZSA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKTtcbiAgICAgICAgICAgICAgICBpZiAoZWRpdGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGUub24oJ3RpdGxlLWVkaXQtZW5kJywgZnVuY3Rpb24odGl0bGUsIG9yaWdpbmFsLyosIGNhbmNlbGVkKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdHJpbSh0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB0cmltKG9yaWdpbmFsKSB8fCAnVGl0bGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCh0aXRsZSkuZGF0YSgndGl0bGUtZWRpdGFibGUnLCB0aXRsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNlYXJjaCAmJiBmaWx0ZXJzICYmIGJsb2Nrcykge1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2gub24oJ2lucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmFsdWUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBbXSwgdmFsdWUgPSB0aGlzLnZhbHVlKCkudG9Mb3dlckNhc2UoKSwgdGV4dDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5mb3JFYWNoKGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9ICQoZmlsdGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdHJpbShmaWx0ZXIuZGF0YSgnbW0tZmlsdGVyJykpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQubWF0Y2gobmV3IFJlZ0V4cChcIl5cIiArIHZhbHVlICsgJ3xcXFxccycgKyB2YWx1ZSwgJ2dpJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kLnB1c2goZmlsdGVyLm1hdGNoZXMoJ1tkYXRhLW1tLXR5cGVdJykgPyBmaWx0ZXIgOiBmaWx0ZXIucGFyZW50KCdbZGF0YS1tbS10eXBlXScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCkgeyAkKGZvdW5kKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7IH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgoIWZvcm0gJiYgIWZha2VET00pIHx8ICFzdWJtaXQpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBQb3NpdGlvbnMgSXRlbXMgc2V0dGluZ3NcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcjcG9zaXRpb25zIC5pdGVtLXNldHRpbmdzJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgZGF0YSA9IHt9LFxuICAgICAgICAgICAgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLXBtLWRhdGFdJyksXG4gICAgICAgICAgICBwb3NpdGlvbiA9IEpTT04ucGFyc2UoZWxlbWVudC5wYXJlbnQoJ1tkYXRhLXBvc2l0aW9uXScpLmRhdGEoJ3Bvc2l0aW9uJykpO1xuXG4gICAgICAgIGRhdGEucG9zaXRpb24gPSBwb3NpdGlvbi5uYW1lO1xuICAgICAgICBkYXRhLml0ZW0gPSBwYXJlbnQuZGF0YSgncG0tZGF0YScpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogdHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX0xPQURJTkcnKSxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIG92ZXJsYXlDbGlja1RvQ2xvc2U6IGZhbHNlLFxuICAgICAgICAgICAgcmVtb3RlOiBwYXJzZUFqYXhVUkkoZ2V0QWpheFVSTCgncG9zaXRpb25zL2VkaXQvJyArIHBhcmVudC5kYXRhKCdwbS1ibG9ja3R5cGUnKSkgKyBnZXRBamF4U3VmZml4KCkpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLmVuYWJsZUNsb3NlQnlPdmVybGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9ybSAgICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCdmb3JtJyksXG4gICAgICAgICAgICAgICAgICAgIGZha2VET00gICAgPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5odG1sKS5maW5kKCdmb3JtJyksXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pdCAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuc2VhcmNoKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdLCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXSwgW2RhdGEtYXBwbHktYW5kLXNhdmVdJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZWRpdGFibGUgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJyk7XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlLm9uKCd0aXRsZS1lZGl0LWVuZCcsIGZ1bmN0aW9uKHRpdGxlLCBvcmlnaW5hbC8qLCBjYW5jZWxlZCovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IHRyaW0odGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdHJpbShvcmlnaW5hbCkgfHwgJ1RpdGxlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQodGl0bGUpLmRhdGEoJ3RpdGxlLWVkaXRhYmxlJywgdGl0bGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgoIWZvcm0gJiYgIWZha2VET00pIHx8ICFzdWJtaXQpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uIFNldHRpbmdzIGFwcGx5XG4gICAgICAgICAgICAgICAgc3VibWl0Lm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBmYWtlRE9NID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc3QgPSBTdWJtaXQoZmFrZURPTVswXS5lbGVtZW50cywgY29udGVudC5lbGVtZW50cy5jb250ZW50KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocG9zdC5pbnZhbGlkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcignZmEgZmEtZncgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfUkVWSUVXX0ZJRUxEUycpLCB0cmFuc2xhdGUoJ0dBTlRSWTVfUExBVEZPUk1fSlNfSU5WQUxJRF9GSUVMRFMnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KGZha2VET00uYXR0cmlidXRlKCdtZXRob2QnKSwgcGFyc2VBamF4VVJJKGZha2VET00uYXR0cmlidXRlKCdhY3Rpb24nKSArIGdldEFqYXhTdWZmaXgoKSksIHBvc3QudmFsaWQuam9pbignJicpLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1wbS1kYXRhXScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZGF0YSgncG0tZGF0YScsIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmJvZHkuaXRlbSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSByZXNwb25zZS5ib2R5Lml0ZW0uZW5hYmxlZCB8fCByZXNwb25zZS5ib2R5Lml0ZW0ub3B0aW9ucy5hdHRyaWJ1dGVzLmVuYWJsZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkdW1teSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaHRtbChkdW1teS5maXJzdENoaWxkKCkuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50W3N0YXR1cyA9PSAnMCcgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2ctbWVudS1pdGVtLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaXQncyBhcHBseSBhbmQgc2F2ZSB3ZSBhbHNvIHNhdmUgdGhlIHBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5kYXRhKCdhcHBseS1hbmQtc2F2ZScpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlID0gJCgnYm9keScpLmZpbmQoJy5idXR0b24tc2F2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZSkgeyBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6IHNhdmUgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXJkcy5zZXJpYWxpemUoZWxlbWVudC5wYXJlbnQoJ1tkYXRhLXBvc2l0aW9uXScpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3ModHJhbnNsYXRlKCdHQU5UUlk1X1BMQVRGT1JNX0pTX1BPU0lUSU9OU19TRVRUSU5HU19BUFBMSUVEJyksIHRyYW5zbGF0ZSgnR0FOVFJZNV9QTEFURk9STV9KU19TRVRUSU5HU19BUFBMSUVEJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGVzIFBvc2l0aW9ucyBUaXRsZXMgUmVuYW1lXG4gICAgdmFyIHVwZGF0ZVRpdGxlID0gZnVuY3Rpb24odGl0bGUsIG9yaWdpbmFsLCB3YXNDYW5jZWxlZCkge1xuICAgICAgICAgICAgdGhpcy5zdHlsZSgndGV4dC1vdmVyZmxvdycsICdlbGxpcHNpcycpO1xuICAgICAgICAgICAgaWYgKHdhc0NhbmNlbGVkIHx8IHRpdGxlID09IG9yaWdpbmFsKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGhyZWYgPSBlbGVtZW50LmRhdGEoJ2ctY29uZmlnLWhyZWYnKSxcbiAgICAgICAgICAgICAgICB0eXBlID0gZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZS10eXBlJyksXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gKGVsZW1lbnQuZGF0YSgnZy1jb25maWctbWV0aG9kJykgfHwgJ3Bvc3QnKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCdbaWRdJyksXG4gICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xuXG4gICAgICAgICAgICBwYXJlbnQuc2hvd0luZGljYXRvcigpO1xuICAgICAgICAgICAgcGFyZW50LmZpbmQoJ1tkYXRhLXRpdGxlLWVkaXRdJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cbiAgICAgICAgICAgIGRhdGEgPSB0eXBlID09PSAndGl0bGUnID8geyB0aXRsZTogdHJpbSh0aXRsZSkgfSA6IHsga2V5OiB0cmltKHRpdGxlKSB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0KG1ldGhvZCwgcGFyc2VBamF4VVJJKGhyZWYgKyBnZXRBamF4U3VmZml4KCkpLCBkYXRhLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZScsIG9yaWdpbmFsKS50ZXh0KG9yaWdpbmFsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoJ3RpdGxlJywgdGl0bGUpLmRhdGEoJ3RpcCcsIHRpdGxlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWZyZXNoIElEIGxhYmVsIGFuZCBhY3Rpb25zIGJ1dHRvbnNcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR1bW15ID0gemVuKCdkaXYnKS5odG1sKHJlc3BvbnNlLmJvZHkucG9zaXRpb24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9ucyA9IGR1bW15LmZpbmQoJy5wb3NpdGlvbi1hY3Rpb25zJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXJkID0gZWxlbWVudC5wYXJlbnQoJy5jYXJkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FyZC5maW5kKCdoNCAucG9zaXRpb24ta2V5JykuaHRtbChyZXNwb25zZS5ib2R5LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgY2FyZC5maW5kKCcucG9zaXRpb24tYWN0aW9ucycpLmh0bWwoYWN0aW9ucy5odG1sKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IGNhcmQuZmluZCgnW2RhdGEtcG9zaXRpb25dJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShwb3NpdGlvbi5kYXRhKCdwb3NpdGlvbicpKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmRhdGEoJ3Bvc2l0aW9uJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBhcmVudC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgcGFyZW50LmZpbmQoJ1tkYXRhLXRpdGxlLWVkaXRdJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBhdHRhY2hFZGl0YWJsZXMgPSBmdW5jdGlvbihlZGl0YWJsZXMpIHtcbiAgICAgICAgICAgIGlmICghZWRpdGFibGVzIHx8ICFlZGl0YWJsZXMubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgZWRpdGFibGVzLmZvckVhY2goZnVuY3Rpb24oZWRpdGFibGUpIHtcbiAgICAgICAgICAgICAgICBlZGl0YWJsZSA9ICQoZWRpdGFibGUpO1xuICAgICAgICAgICAgICAgIGVkaXRhYmxlLmNvbmZXYXNBdHRhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZWRpdGFibGUub24oJ3RpdGxlLWVkaXQtc3RhcnQnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZS5zdHlsZSgndGV4dC1vdmVyZmxvdycsICdpbmhlcml0Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWRpdGFibGUub24oJ3RpdGxlLWVkaXQtZW5kJywgdXBkYXRlVGl0bGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAvLyBUb2dnbGUgYWxsIGFzc2lnbm1lbnRzIG9uL29mZlxuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbZGF0YS1wb3NpdGlvbnMtYXNzaWdubWVudHNdIGlucHV0W3R5cGU9XCJoaWRkZW5cIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgY2FyZCA9IGVsZW1lbnQucGFyZW50KCcuY2FyZCcpLFxuICAgICAgICAgICAgd3JhcHBlciA9IGNhcmQuZmluZCgnLnNldHRpbmdzLXBhcmFtLXdyYXBwZXInKTtcblxuICAgICAgICB3cmFwcGVyW2VsZW1lbnQudmFsdWUoKSA9PSAxID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKCdoaWRlJyk7XG4gICAgICAgIHdyYXBwZXIuc2VhcmNoKCdpbnB1dFt0eXBlPVwiaGlkZGVuXCJdJykuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQudmFsdWUoMCkuZGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gR2xvYmFsIHN0YXRlIGNoYW5nZVxuICAgIGJvZHkub24oJ3N0YXRlY2hhbmdlQWZ0ZXInLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgZWRpdGFibGVzID0gJCgnI3Bvc2l0aW9ucyBbZGF0YS10aXRsZS1lZGl0YWJsZV0nKTtcbiAgICAgICAgaWYgKCFlZGl0YWJsZXMpIHsgcmV0dXJuIHRydWU7IH1cblxuICAgICAgICBlZGl0YWJsZXMgPSBlZGl0YWJsZXMuZmlsdGVyKGZ1bmN0aW9uKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiAkKGVkaXRhYmxlKS5jb25mV2FzQXR0YWNoZWQpID09PSAndW5kZWZpbmVkJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXR0YWNoRWRpdGFibGVzKGVkaXRhYmxlcyk7XG4gICAgfSk7XG5cbiAgICBhdHRhY2hFZGl0YWJsZXMoJCgnI3Bvc2l0aW9ucyBbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHJlYWR5ID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkID0gcmVxdWlyZSgnZWxlbWVudHMvYXR0cmlidXRlcycpLFxuICAgIG1vZGFsID0gcmVxdWlyZSgnLi4vdWknKS5tb2RhbCxcbiAgICBjb250YWlucyA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICBmb3JFYWNoID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZvckVhY2gnKTtcblxucmVxdWlyZSgnLi4vdWkvcG9wb3ZlcicpO1xuXG52YXIgaXNGaXJlZm94ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xLFxuICAgIEZPQ1VTSU4gICA9IGlzRmlyZWZveCA/ICdmb2N1cycgOiAnZm9jdXNpbic7XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXN0eWxlc10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKCdzd2F0Y2gtcHJldmlldycpIHx8IHRhcmdldC5wYXJlbnQoJy5zd2F0Y2gtcHJldmlldycpKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZy1zdHlsZXMnKSksIGlucHV0LCB2YWx1ZSwgdHlwZSwgZXZ0O1xuICAgICAgICBmb3JFYWNoKGRhdGEsIGZ1bmN0aW9uKHByZXNldCwgbmFtZSkge1xuICAgICAgICAgICAgaW5wdXQgPSAkKCdbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuICAgICAgICAgICAgdmFsdWUgPSBpbnB1dCA/IGlucHV0LnZhbHVlKCkgOiBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKCFpbnB1dCB8fCB2YWx1ZSA9PT0gcHJlc2V0KSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBldnQgPSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBpbnB1dCxcbiAgICAgICAgICAgICAgICBmb3JjZU92ZXJyaWRlOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0eXBlID0gKGlucHV0LnRhZygpID09ICdzZWxlY3QnIHx8IGNvbnRhaW5zKFsnaGlkZGVuJywgJ2NoZWNrYm94J10sIGlucHV0LnR5cGUoKSkpID8gJ2NoYW5nZScgOiAnaW5wdXQnO1xuXG4gICAgICAgICAgICBpbnB1dC52YWx1ZShwcmVzZXQpO1xuICAgICAgICAgICAgYm9keS5lbWl0KHR5cGUsIGV2dCk7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2tleXVwJywgZXZ0KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXN0eWxlc10gLnN3YXRjaC1wcmV2aWV3JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGltYWdlID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWctc3R5bGVzXScpLmZpbmQoJ2ltZycpO1xuICAgICAgICBpZiAoIWltYWdlKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogaW1hZ2VbMF0ub3V0ZXJIVE1MLFxuICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFkZGluZyA9IHBhcnNlSW50KGNvbnRhaW5lci5jb21wdXRlKCdwYWRkaW5nLWxlZnQnKSwgMTApICsgcGFyc2VJbnQoY29udGFpbmVyLmNvbXB1dGUoJ3BhZGRpbmctcmlnaHQnKSwgMTApO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiAnODAlJyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhZGRpbmcgKyAoaW1hZ2VbMF0ubmF0dXJhbFdpZHRoIHx8IGltYWdlWzBdLndpZHRoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciByZWFkeSAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHRyaW0gICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBmb3JPd24gPSByZXF1aXJlKCdtb3V0L29iamVjdC9mb3JPd24nKSxcbiAgICAkICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpO1xuXG52YXIgQ29va2llID0ge1xuICAgIHdyaXRlOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIDM2MDAgKiAxMDAwICogMjQgKiAzNjUgKiAxMCk7IC8vIDEwIHllYXJzXG5cbiAgICAgICAgdmFyIGhvc3QgICA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0LnRvU3RyaW5nKCksXG4gICAgICAgICAgICBkb21haW4gPSBob3N0LnN1YnN0cmluZyhob3N0Lmxhc3RJbmRleE9mKFwiLlwiLCBob3N0Lmxhc3RJbmRleE9mKFwiLlwiKSAtIDEpICsgMSk7XG5cbiAgICAgICAgaWYgKGhvc3QubWF0Y2goL14oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVxcLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcXC4oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KSQvKSkgeyBkb21haW4gPSBob3N0OyB9XG4gICAgICAgIHZhciBjb29raWUgPSBbbmFtZSwgJz0nLCBKU09OLnN0cmluZ2lmeSh2YWx1ZSksICc7IGV4cGlyZXM9JywgZGF0ZS50b0dNVFN0cmluZygpLCAnOyBkb21haW49LicsIGRvbWFpbiwgJzsgcGF0aD0vOyddO1xuXG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZS5qb2luKCcnKTtcbiAgICB9LFxuXG4gICAgcmVhZDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC8oWy0uKis/XiR7fSgpfFtcXF1cXC9cXFxcXSkvZywgJ1xcXFwkMScpO1xuICAgICAgICB2YXIgdmFsdWUgPSBkb2N1bWVudC5jb29raWUubWF0Y2goJyg/Ol58OylcXFxccyonICsgbmFtZSArICc9KFteO10qKScpO1xuICAgICAgICByZXR1cm4gKHZhbHVlKSA/IEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlWzFdKSkgOiBudWxsO1xuICAgIH1cbn07XG5cbnZhciBsb2FkRnJvbVN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RvcmFnZSAgICA9IENvb2tpZS5yZWFkKCdnNS1jb2xsYXBzZWQnKSB8fCB7fSxcbiAgICAgICAgY29sbGFwc2VycyA9ICQoJ1tkYXRhLWctY29sbGFwc2VdJyk7XG4gICAgaWYgKCFjb2xsYXBzZXJzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgdmFyIGl0ZW0sIGRhdGEsIGhhbmRsZSwgcGFuZWwsIGNhcmQ7XG4gICAgZm9yT3duKHN0b3JhZ2UsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgaXRlbSA9ICQoJ1tkYXRhLWctY29sbGFwc2UtaWQ9XCInICsga2V5ICsgJ1wiXScpO1xuICAgICAgICBpZiAoIWl0ZW0pIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoaXRlbS5kYXRhKCdnLWNvbGxhcHNlJykpO1xuICAgICAgICBoYW5kbGUgPSBkYXRhLmhhbmRsZSA/IGl0ZW0uZmluZChkYXRhLmhhbmRsZSkgOiBpdGVtLmZpbmQoJy5nLWNvbGxhcHNlJyk7XG4gICAgICAgIHBhbmVsID0gZGF0YS50YXJnZXQgPyBpdGVtLmZpbmQoZGF0YS50YXJnZXQpIDogaXRlbTtcbiAgICAgICAgY2FyZCA9IGl0ZW0ucGFyZW50KCcuY2FyZCcpIHx8IHBhbmVsO1xuICAgICAgICBoYW5kbGVcbiAgICAgICAgICAgIC5kYXRhKCd0aXRsZScsIHZhbHVlID8gZGF0YS5leHBhbmQgOiBkYXRhLmNvbGxhcHNlKVxuICAgICAgICAgICAgLmRhdGEoJ3RpcCcsIHZhbHVlID8gZGF0YS5leHBhbmQgOiBkYXRhLmNvbGxhcHNlKTtcblxuICAgICAgICBwYW5lbC5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgIGNhcmRbIXZhbHVlID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcyddKCdnLWNvbGxhcHNlZCcpO1xuICAgICAgICBpdGVtWyF2YWx1ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1jb2xsYXBzZWQtbWFpbicpO1xuICAgIH0pO1xufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5JyksIGRhdGEsIHRhcmdldCwgc3RvcmFnZTtcblxuICAgIC8vIHNpbmdsZSBjb2xsYXBzZXJcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLWNvbGxhcHNlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSBldmVudC5lbGVtZW50IHx8IGVsZW1lbnQ7XG5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZWxlbWVudC5kYXRhKCdnLWNvbGxhcHNlJykpO1xuICAgICAgICB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIHN0b3JhZ2UgPSAoKGRhdGEuc3RvcmUgIT09IGZhbHNlKSA/IENvb2tpZS5yZWFkKCdnNS1jb2xsYXBzZWQnKSA6IHN0b3JhZ2UpIHx8IHt9O1xuICAgICAgICBpZiAoIWRhdGEuaGFuZGxlKSB7IGRhdGEuaGFuZGxlID0gZWxlbWVudC5maW5kKCcuZy1jb2xsYXBzZScpOyB9XG5cbiAgICAgICAgaWYgKCF0YXJnZXQubWF0Y2hlcyhkYXRhLmhhbmRsZSkgJiYgIXRhcmdldC5wYXJlbnQoZGF0YS5oYW5kbGUpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIGlmIChzdG9yYWdlW2RhdGEuaWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHN0b3JhZ2VbZGF0YS5pZF0gPSBkYXRhLmNvbGxhcHNlZDtcblxuICAgICAgICAgICAgaWYgKGRhdGEuc3RvcmUgIT09IGZhbHNlKSB7IENvb2tpZS53cml0ZSgnZzUtY29sbGFwc2VkJywgc3RvcmFnZSk7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjb2xsYXBzZWQgPSBzdG9yYWdlW2RhdGEuaWRdLFxuICAgICAgICAgICAgcGFuZWwgICAgID0gZGF0YS50YXJnZXQgPyBlbGVtZW50LmZpbmQoZGF0YS50YXJnZXQpIDogZWxlbWVudCxcbiAgICAgICAgICAgIGNhcmQgICAgICA9IHBhbmVsLnBhcmVudCgnLmNhcmQnKSB8fCBwYW5lbDtcblxuICAgICAgICBpZiAoY2FyZCAmJiBjYXJkLmhhc0NsYXNzKCdnLWNvbGxhcHNlZCcpKSB7XG4gICAgICAgICAgICBjYXJkLnJlbW92ZUNsYXNzKCdnLWNvbGxhcHNlZCcpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZy1jb2xsYXBzZWQtbWFpbicpO1xuICAgICAgICAgICAgLyogZm9yIGFuaW1hdGlvbnNcbiAgICAgICAgICAgICBwYW5lbC5zdHlsZSh7XG4gICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgIH0pOyovXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2xpZGUgPSBmdW5jdGlvbihvdmVycmlkZSkge1xuICAgICAgICAgICAgY29sbGFwc2VkID0gdHlwZW9mIG92ZXJyaWRlICE9ICdudW1iZXInID8gb3ZlcnJpZGUgOiBjb2xsYXBzZWQ7XG4gICAgICAgICAgICBpZiAoIWNvbGxhcHNlZCkge1xuICAgICAgICAgICAgICAgIGNhcmQuYWRkQ2xhc3MoJ2ctY29sbGFwc2VkJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZy1jb2xsYXBzZWQtbWFpbicpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRhLmhhbmRsZVxuICAgICAgICAgICAgICAgIC5kYXRhKCd0aXRsZScsICFjb2xsYXBzZWQgPyBkYXRhLmV4cGFuZCA6IGRhdGEuY29sbGFwc2UpXG4gICAgICAgICAgICAgICAgLmRhdGEoJ3RpcCcsICFjb2xsYXBzZWQgPyBkYXRhLmV4cGFuZCA6IGRhdGEuY29sbGFwc2UpO1xuICAgICAgICAgICAgc3RvcmFnZVtkYXRhLmlkXSA9ICFjb2xsYXBzZWQ7XG4gICAgICAgICAgICBkYXRhLmNvbGxhcHNlZCA9ICFjb2xsYXBzZWQ7XG5cbiAgICAgICAgICAgIHZhciByZWZyZXNoRGF0YSA9IEpTT04ucGFyc2UoZWxlbWVudC5kYXRhKCdnLWNvbGxhcHNlJykpO1xuICAgICAgICAgICAgcmVmcmVzaERhdGEuY29sbGFwc2VkID0gIWNvbGxhcHNlZDtcbiAgICAgICAgICAgIGVsZW1lbnQuZGF0YSgnZy1jb2xsYXBzZScsIEpTT04uc3RyaW5naWZ5KHJlZnJlc2hEYXRhKSk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnN0b3JlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIENvb2tpZS53cml0ZSgnZzUtY29sbGFwc2VkJywgc3RvcmFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGVsZW1lbnQuZ0Zhc3RDb2xsYXBzZSkge1xuICAgICAgICAgICAgcGFuZWxbY29sbGFwc2VkID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcyddKCdnLWNvbGxhcHNlZCcpO1xuICAgICAgICAgICAgZWxlbWVudFtjb2xsYXBzZWQgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10oJ2ctY29sbGFwc2VkLW1haW4nKTtcbiAgICAgICAgICAgIHNsaWRlKGNvbGxhcHNlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdnLWNvbGxhcHNlZC1tYWluJyk7XG4gICAgICAgICAgICAvLyBmb3IgYW5pbWF0aW9uc1xuICAgICAgICAgICAgLy8gcGFuZWwucmVtb3ZlQ2xhc3MoJ2ctY29sbGFwc2VkJylbY29sbGFwc2VkID8gJ3NsaWRlRG93bicgOiAnc2xpZGVVcCddKHNsaWRlKTtcbiAgICAgICAgICAgIHBhbmVsLnJlbW92ZUNsYXNzKCdnLWNvbGxhcHNlZCcpW2NvbGxhcHNlZCA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1jb2xsYXBzZWQnKTtcbiAgICAgICAgICAgIHNsaWRlKGNvbGxhcHNlZCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LmdGYXN0Q29sbGFwc2UgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8vIGdsb2JhbCBjb2xsYXBzZSB0b2dnbGVyc1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWctY29sbGFwc2UtYWxsXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBtb2RlICAgICAgICAgID0gZWxlbWVudC5kYXRhKCdnLWNvbGxhcHNlLWFsbCcpID09ICd0cnVlJyxcbiAgICAgICAgICAgIHBhcmVudCAgICAgICAgPSBlbGVtZW50LnBhcmVudCgnLmctZmlsdGVyLWFjdGlvbnMnKSxcbiAgICAgICAgICAgIGNvbnRhaW5lciAgICAgPSBwYXJlbnQubmV4dFNpYmxpbmcoKSxcbiAgICAgICAgICAgIGNvbGxhcHNlcnMgICAgPSBjb250YWluZXIuc2VhcmNoKCdbZGF0YS1nLWNvbGxhcHNlXScpLFxuICAgICAgICAgICAgQ29va2llU3RvcmFnZSA9IENvb2tpZS5yZWFkKCdnNS1jb2xsYXBzZWQnKSB8fCB7fSxcbiAgICAgICAgICAgIHBhbmVsLCBkYXRhLCBoYW5kbGUsIGNhcmQsIGlubmVyO1xuXG4gICAgICAgIGlmICghY29sbGFwc2VycykgeyByZXR1cm47IH1cblxuICAgICAgICBjb2xsYXBzZXJzLmZvckVhY2goZnVuY3Rpb24oY29sbGFwc2VyKSB7XG4gICAgICAgICAgICBjb2xsYXBzZXIgPSAkKGNvbGxhcHNlcik7XG4gICAgICAgICAgICBjYXJkID0gY29sbGFwc2VyLnBhcmVudCgnLmNhcmQnKTtcbiAgICAgICAgICAgIGlubmVyID0gY2FyZC5maW5kKCc+IC5nLWNvbGxhcHNlZCcpO1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoY29sbGFwc2VyLmRhdGEoJ2ctY29sbGFwc2UnKSk7XG4gICAgICAgICAgICBoYW5kbGUgPSBkYXRhLmhhbmRsZSA/IGNvbGxhcHNlci5maW5kKGRhdGEuaGFuZGxlKSA6IGNvbGxhcHNlci5maW5kKCcuZy1jb2xsYXBzZScpO1xuICAgICAgICAgICAgcGFuZWwgPSBkYXRhLnRhcmdldCA/IGNvbGxhcHNlci5maW5kKGRhdGEudGFyZ2V0KSA6IGNvbGxhcHNlcjtcblxuICAgICAgICAgICAgc3RvcmFnZSA9ICgoZGF0YS5zdG9yZSAhPT0gZmFsc2UpID8gQ29va2llU3RvcmFnZSA6IHN0b3JhZ2UpIHx8IHt9O1xuXG4gICAgICAgICAgICBzdG9yYWdlW2RhdGEuaWRdID0gbW9kZTtcbiAgICAgICAgICAgIGlmIChkYXRhLnN0b3JlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIENvb2tpZS53cml0ZSgnZzUtY29sbGFwc2VkJywgc3RvcmFnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhbmVsLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgIGNvbGxhcHNlclshbW9kZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1jb2xsYXBzZWQtbWFpbicpO1xuICAgICAgICAgICAgY2FyZFshbW9kZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnZy1jb2xsYXBzZWQnKTtcblxuICAgICAgICAgICAgaWYgKGlubmVyKSB7XG4gICAgICAgICAgICAgICAgaW5uZXJbIW1vZGUgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10oJ2ctY29sbGFwc2VkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gZmlsdGVyIGJ5IGNhcmQgdGl0bGVcbiAgICBib2R5LmRlbGVnYXRlKCdpbnB1dCcsICdbZGF0YS1nLWNvbGxhcHNlLWZpbHRlcl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgZmlsdGVyICAgID0gSlNPTi5wYXJzZShlbGVtZW50LmRhdGEoJ2ctY29sbGFwc2UtZmlsdGVyJykgfHwgJ3t9JyksXG4gICAgICAgICAgICBwYXJlbnQgICAgPSBlbGVtZW50LnBhcmVudCgnLmctZmlsdGVyLWFjdGlvbnMnKSxcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IHBhcmVudC5uZXh0U2libGluZygpLFxuICAgICAgICAgICAgY2FyZHMgICAgID0gY29udGFpbmVyLnNlYXJjaChmaWx0ZXIuZWxlbWVudCB8fCAnLmNhcmQnKSxcbiAgICAgICAgICAgIHZhbHVlICAgICA9IGVsZW1lbnQudmFsdWUoKTtcblxuICAgICAgICBpZiAoIWNhcmRzKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICghdmFsdWUpIHsgY2FyZHMuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpOyB9XG4gICAgICAgIGNhcmRzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIHRpdGxlICAgPSB0cmltKGVsZW1lbnQuZmluZChmaWx0ZXIudGl0bGUgfHwgJ2g0IC5nLXRpdGxlJykudGV4dCgpKSxcbiAgICAgICAgICAgICAgICBtYXRjaGVzID0gdGl0bGUubWF0Y2gobmV3IFJlZ0V4cChcIl5cIiArIHZhbHVlICsgJ3xcXFxccycgKyB2YWx1ZSwgJ2dpJykpO1xuXG4gICAgICAgICAgICBpZiAobWF0Y2hlcykgeyBlbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTsgfVxuICAgICAgICAgICAgZWxzZSB7IGVsZW1lbnQuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpOyB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gdGhpcyBpcyBub3cgaGFuZGxlZCBmcm9tIHRoZSB0d2lnIGZpbGVzXG4gICAgLy8gbm8gbmVlZCB0byBydW4gb24gZG9tcmVhZHlcbiAgICAvL2xvYWRGcm9tU3RvcmFnZSgpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gbG9hZEZyb21TdG9yYWdlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBFbWl0dGVyICAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIGJpbmQgICAgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBjb250YWlucyAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpLFxuICAgIERyYWdFdmVudHMgPSByZXF1aXJlKCcuL2RyYWcuZXZlbnRzJyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyk7XG5cbi8vICQgdXRpbHNcbnJlcXVpcmUoJ2VsZW1lbnRzL2V2ZW50cycpO1xucmVxdWlyZSgnZWxlbWVudHMvZGVsZWdhdGlvbicpO1xuXG52YXIgaXNJRSA9IChuYXZpZ2F0b3IuYXBwTmFtZSA9PT0gXCJNaWNyb3NvZnQgSW50ZXJuZXQgRXhwbG9yZXJcIik7XG5cbnZhciBEcmFnRHJvcCA9IG5ldyBwcmltZSh7XG5cbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgZGVsZWdhdGU6IG51bGwsXG4gICAgICAgIGRyb3BwYWJsZXM6IGZhbHNlLFxuICAgICAgICBjYXRjaENsaWNrOiBmYWxzZVxuICAgIH0sXG5cbiAgICBEUkFHX0VWRU5UUzogRHJhZ0V2ZW50cyxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSAkKGNvbnRhaW5lcik7XG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLm9yaWdpbiA9IHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiBudWxsLFxuICAgICAgICAgICAgb2Zmc2V0OiB7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGFzdE1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sYXN0T3ZlcmVkID0gbnVsbDtcblxuICAgICAgICB0aGlzLmF0dGFjaCgpO1xuICAgIH0sXG5cbiAgICBhdHRhY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVEFSVC5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmRlbGVnYXRlKGV2ZW50LCB0aGlzLm9wdGlvbnMuZGVsZWdhdGUsIHRoaXMuYm91bmQoJ3N0YXJ0JykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGRldGFjaDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUQVJULmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIudW5kZWxlZ2F0ZShldmVudCwgdGhpcy5vcHRpb25zLmRlbGVnYXRlLCB0aGlzLmJvdW5kKCdzdGFydCcpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgLy9pZiAoZXZlbnQgJiYgZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoL2kpKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxJbnRlcnZhbCk7XG4gICAgICAgIGlmIChlbGVtZW50LkxNVG9vbHRpcCkgeyBlbGVtZW50LkxNVG9vbHRpcC5yZW1vdmUoKTsgfVxuICAgICAgICAkKCdodG1sJykuYXR0cmlidXRlKCdzdHlsZScsICdoZWlnaHQ6IDEwMCUgIWltcG9ydGFudCcpO1xuICAgICAgICB0aGlzLnNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuXG4gICAgICAgIC8vIFByZXZlbnRzIGRyYWdnaW5nIGEgY29sdW1uIGZyb20gaXRzZWxmIGFuZCBsaW1pdGluZyB0byBpdHMgaGFuZGxlXG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmICghZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWxtLXJvb3RdJykgJiYgZWxlbWVudC5oYXNDbGFzcygnZy1ibG9jaycpICYmICghdGFyZ2V0Lm1hdGNoZXMoJy5zdWJtZW51LXJlb3JkZXInKSAmJiAhdGFyZ2V0LnBhcmVudCgnLnN1Ym1lbnUtcmVvcmRlcicpKSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIGlmIChldmVudC53aGljaCAmJiBldmVudC53aGljaCAhPT0gMSB8fCAkKGV2ZW50LnRhcmdldCkubWF0Y2hlcyh0aGlzLm9wdGlvbnMuZXhjbHVkZSkpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgdGhpcy5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2F0Y2hDbGljaykgeyB0aGlzLm1vdmVkID0gZmFsc2U7IH1cblxuICAgICAgICAvLyB3ZSBmb3JjZSB0aGUgbWVudSBjb2x1bW4gcmVvcmRlciBoYW5kbGUgdG8gdGhlIGctYmxvY2sgcGFyZW50XG4gICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcygnLnN1Ym1lbnUtcmVvcmRlcicpIHx8IHRhcmdldC5wYXJlbnQoJy5zdWJtZW51LXJlb3JkZXInKSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gdGFyZ2V0LnBhcmVudCgnW2RhdGEtbW0taWRdJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOmJlZm9yZXN0YXJ0JywgZXZlbnQsIHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgLy8gU3RvcHMgZGVmYXVsdCBNUyB0b3VjaCBhY3Rpb25zIHNpbmNlIHByZXZlbnREZWZhdWx0IGRvZXNuJ3Qgd29ya1xuICAgICAgICBpZiAoaXNJRSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHtcbiAgICAgICAgICAgICAgICAnLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJyxcbiAgICAgICAgICAgICAgICAndG91Y2gtYWN0aW9uJzogJ25vbmUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0b3BzIHRleHQgc2VsZWN0aW9uXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW4gPSB7XG4gICAgICAgICAgICB4OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYIDogZXZlbnQucGFnZVgsXG4gICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVksXG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMuZWxlbWVudC5jb21wdXRlKCd0cmFuc2Zvcm0nKVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjbGllbnRSZWN0ID0gdGhpcy5lbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB0aGlzLm9yaWdpbi5vZmZzZXQgPSB7XG4gICAgICAgICAgICBjbGllbnRSZWN0OiBjbGllbnRSZWN0LFxuICAgICAgICAgICAgc2Nyb2xsOiB7XG4gICAgICAgICAgICAgICAgeDogd2luZG93LnNjcm9sbFgsXG4gICAgICAgICAgICAgICAgeTogd2luZG93LnNjcm9sbFlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4OiB0aGlzLm9yaWdpbi54IC0gY2xpZW50UmVjdC5yaWdodCxcbiAgICAgICAgICAgIHk6IGNsaWVudFJlY3QudG9wIC0gdGhpcy5vcmlnaW4ueVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIE9ubHkgYWxsb3cgdG8gc29ydCBncmlkcyB3aGVuIHRhcmdldGluZyB0aGUgbGVmdCBoYW5kbGVcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA9PT0gJ2dyaWQnICYmIE1hdGguYWJzKHRoaXMub3JpZ2luLm9mZnNldC54KSA8IGNsaWVudFJlY3Qud2lkdGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvZmZzZXQgID0gTWF0aC5hYnModGhpcy5vcmlnaW4ub2Zmc2V0LngpLFxuICAgICAgICAgICAgY29sdW1ucyA9ICh0aGlzLmVsZW1lbnQucGFyZW50KCkuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT09ICdncmlkJyAmJiB0aGlzLmVsZW1lbnQucGFyZW50KCkucGFyZW50KCkuZGF0YSgnbG0tcm9vdCcpKSB8fFxuICAgICAgICAgICAgICAgICh0aGlzLmVsZW1lbnQucGFyZW50KCkucGFyZW50KCkuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT0gJ2NvbnRhaW5lcicgJiYgKHRoaXMuZWxlbWVudC5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5kYXRhKCdsbS1yb290JykgfHwgdGhpcy5lbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09ICd3cmFwcGVyJykpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA9PSAnZ3JpZCcgJiZcbiAgICAgICAgICAgICh0aGlzLmVsZW1lbnQucGFyZW50KCkuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT09ICdjb250YWluZXInICYmIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5kYXRhKCdsbS1yb290JykpIHx8XG4gICAgICAgICAgICAodGhpcy5lbGVtZW50LnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09PSAnc2VjdGlvbicgJiYgdGhpcy5lbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSlcbiAgICAgICAgKSB7IGNvbHVtbnMgPSBmYWxzZTsgfVxuXG4gICAgICAgIC8vIFJlc2l6aW5nIGFuZCBvbmx5IGlmIGl0J3Mgbm90IGEgbm9uLXZpc2libGUgKGF0b21zKSBzZWN0aW9uXG4gICAgICAgIGlmICgob2Zmc2V0IDwgNiAmJiB0aGlzLmVsZW1lbnQucGFyZW50KCkuZmluZCgnOmxhc3QtY2hpbGQnKSAhPT0gdGhpcy5lbGVtZW50KSB8fCAoY29sdW1ucyAmJiBvZmZzZXQgPiAzICYmIG9mZnNldCA8IDEwKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cImF0b21zXCJdJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6cmVzaXplJywgZXZlbnQsIHRoaXMuZWxlbWVudCwgKHRoaXMuZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpIHx8IHRoaXMuZWxlbWVudCkuc2libGluZ3MoJzpub3QoLnBsYWNlaG9sZGVyKScpLCB0aGlzLm9yaWdpbi5vZmZzZXQueCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29sdW1ucyB8fCAoZWxlbWVudC5oYXNDbGFzcygnc3VibWVudS1jb2x1bW4nKSAmJiAoIXRhcmdldC5tYXRjaGVzKCcuc3VibWVudS1yZW9yZGVyJykgJiYgIXRhcmdldC5wYXJlbnQoJy5zdWJtZW51LXJlb3JkZXInKSkpKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHtcbiAgICAgICAgICAgICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyxcbiAgICAgICAgICAgIHpJbmRleDogMTAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub24oZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgLy8gVHJhY2twYWRzIGB0YXBgIChtb3VzZWRvd24gKyBtb3VzZXVwKSBoYXBwZW5zIHRvbyBmYXN0IGFuZCB0aGUgc3RvcCBldmVudFxuICAgICAgICAgICAgLy8gd29uJ3QgZ2V0IGF0dGFjaGVkLiBXZSBuZWVkIHRvIGRlZmVyIGl0IHRvIGF2b2lkIGlzc3Vlc1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oZXZlbnQsIHRoaXMuYm91bmQoJ2RlZmVyU3RvcCcpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RhcnQnLCBldmVudCwgdGhpcy5lbGVtZW50KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgIH0sXG5cbiAgICBkZWZlclN0b3A6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuc3RvcChldmVudCk7XG4gICAgICAgIH0sIDApO1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAvL2lmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNjcm9sbEludGVydmFsKTtcbiAgICAgICAgJCgnaHRtbCcpLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgaWYgKCF0aGlzLm1vdmVkICYmIHRoaXMub3B0aW9ucy5jYXRjaENsaWNrKSB7XG4gICAgICAgICAgICAvLyB0aGlzIGlzIGp1c3QgYSBjbGlja1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHsgdHJhbnNmb3JtOiB0aGlzLm9yaWdpbi50cmFuc2Zvcm0gfHwgJ3RyYW5zbGF0ZSgwLCAwKScgfSk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOnN0b3AnLCBldmVudCwgdGhpcy5tYXRjaGVkLCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU3R5bGVBdHRyaWJ1dGUodGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RvcDphbmltYXRpb24nLCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkcmFnZHJvcDpjbGljaycsIGV2ZW50LCB0aGlzLmVsZW1lbnQpO1xuXG4gICAgICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5NT1ZFLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLm9mZihldmVudCwgdGhpcy5ib3VuZCgnZGVmZXJTdG9wJykpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2V0dGluZ3MgPSB7IGR1cmF0aW9uOiAnMjUwbXMnIH07XG5cbiAgICAgICAgaWYgKHRoaXMucmVtb3ZlRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5Jykub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdtb3ZlJykpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ2RlZmVyU3RvcCcpKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RvcDplcmFzZScsIGV2ZW50LCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudCkge1xuXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOnN0b3AnLCBldmVudCwgdGhpcy5tYXRjaGVkLCB0aGlzLmVsZW1lbnQpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKDAsIDApJ1xuICAgICAgICAgICAgICAgIH0pLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoZWQpIHtcblxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrID0gYmluZChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVN0eWxlQXR0cmlidXRlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOnN0b3A6YW5pbWF0aW9uJywgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLCAxKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzLCB0aGlzLmVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMub3JpZ2luLnRyYW5zZm9ybSB8fCAndHJhbnNsYXRlKDAsIDApJyxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMub3JpZ2luLnRyYW5zZm9ybSB8fCAndHJhbnNsYXRlKDAsIDApJyxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU3R5bGVBdHRyaWJ1dGUodGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOnN0b3A6YW5pbWF0aW9uJywgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdtb3ZlJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuU1RPUC5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ2RlZmVyU3RvcCcpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgfSxcblxuICAgIG1vdmU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIC8vaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jYXRjaENsaWNrKSB7XG4gICAgICAgICAgICB2YXIgZGlkSXRNb3ZlID0ge1xuICAgICAgICAgICAgICAgIHg6IGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5wYWdlWCxcbiAgICAgICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWRJdE1vdmUueCAtIHRoaXMub3JpZ2luLngpIDw9IDMgJiYgTWF0aC5hYnMoZGlkSXRNb3ZlLnkgLSB0aGlzLm9yaWdpbi55KSA8PSAzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMubW92ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUoeyBvcGFjaXR5OiAwLjUgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkcmFnZHJvcDptb3ZlOm9uY2UnLCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm1vdmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjbGllbnRYID0gZXZlbnQuY2xpZW50WCB8fCAoZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzWzBdLmNsaWVudFgpIHx8IDAsXG4gICAgICAgICAgICBjbGllbnRZID0gZXZlbnQuY2xpZW50WSB8fCAoZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzWzBdLmNsaWVudFkpIHx8IDAsXG4gICAgICAgICAgICBvdmVyaW5nID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChjbGllbnRYLCBjbGllbnRZKSxcbiAgICAgICAgICAgIGlzR3JpZCAgPSB0aGlzLmVsZW1lbnQuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT09ICdncmlkJztcblxuXG4gICAgICAgIC8vIExvZ2ljIHRvIGF1dG8tc2Nyb2xsIG9uIGRyYWdcbiAgICAgICAgdmFyIHNjcm9sbEhlaWdodCA9IHRoaXMuc2Nyb2xsSGVpZ2h0LFxuICAgICAgICAgICAgSGVpZ2h0ICAgICAgID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQsXG4gICAgICAgICAgICBTY3JvbGwgICAgICAgPSB3aW5kb3cucGFnZVlPZmZzZXQ7XG5cbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2Nyb2xsSW50ZXJ2YWwpO1xuICAgICAgICBpZiAoIW92ZXJpbmcpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgaWYgKCEkKG92ZXJpbmcpLm1hdGNoZXMoJyN0cmFzaCcpICYmICEkKG92ZXJpbmcpLnBhcmVudCgnI3RyYXNoJykpIHtcbiAgICAgICAgICAgIHZhciBzdCwgc2wsIHRyYXNoID0gJCgnI2c1LWNvbnRhaW5lciAjdHJhc2gnKTtcbiAgICAgICAgICAgIGlmIChjbGllbnRZICsgNTAgPj0gSGVpZ2h0ICYmIFNjcm9sbCArIEhlaWdodCA8IHNjcm9sbEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2wgPSAod2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0KSAtIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdCB8fCAwKTtcbiAgICAgICAgICAgICAgICAgICAgc3QgPSAod2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApIC0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AgfHwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyhzbCwgTWF0aC5taW4oc2Nyb2xsSGVpZ2h0LCBzdCArIDQpKTtcbiAgICAgICAgICAgICAgICB9LCA4KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xpZW50WSAtIDUwIDw9ICh0cmFzaCA/IHRyYXNoWzBdLm9mZnNldEhlaWdodCA6IDApICYmIHNjcm9sbEhlaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsID0gKHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCkgLSAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudExlZnQgfHwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHN0ID0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSAtIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50VG9wIHx8IDApO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oc2wsIE1hdGgubWF4KDAsIHN0IC0gNCkpO1xuICAgICAgICAgICAgICAgIH0sIDgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2UgdHdlYWsgdGhlIG92ZXJpbmcgdG8gdGFrZSBpbnRvIGFjY291bnQgdGhlIG5lZ2F0aXZlIG9mZnNldCBmb3IgdGhlIGhhbmRsZVxuICAgICAgICBpZiAoaXNHcmlkKSB7XG4gICAgICAgICAgICAvLyBNb3JlIGFjY3VyYXRlIGlzOiBjbGllbnRYICsgKHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0IC0gY2xpZW50WClcbiAgICAgICAgICAgIG92ZXJpbmcgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGNsaWVudFggKyAzMCwgY2xpZW50WSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW92ZXJpbmcpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdGhpcy5tYXRjaGVkID0gJChvdmVyaW5nKS5tYXRjaGVzKHRoaXMub3B0aW9ucy5kcm9wcGFibGVzKSA/IG92ZXJpbmcgOiAoJChvdmVyaW5nKS5wYXJlbnQodGhpcy5vcHRpb25zLmRyb3BwYWJsZXMpIHx8IFtmYWxzZV0pWzBdO1xuICAgICAgICB0aGlzLmlzUGxhY2VIb2xkZXIgPSAkKG92ZXJpbmcpLm1hdGNoZXMoJ1tkYXRhLWxtLXBsYWNlaG9sZGVyXScpID8gdHJ1ZSA6ICgkKG92ZXJpbmcpLnBhcmVudCgnW2RhdGEtbG0tcGxhY2Vob2xkZXJdJykgPyB0cnVlIDogZmFsc2UpO1xuXG4gICAgICAgIHZhciBkZWx0YVggICAgPSB0aGlzLmxhc3RYIC0gY2xpZW50WCxcbiAgICAgICAgICAgIGRlbHRhWSAgICA9IHRoaXMubGFzdFkgLSBjbGllbnRZLFxuICAgICAgICAgICAgZGlyZWN0aW9uID0gTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYID4gMCAmJiAnbGVmdCcgfHxcbiAgICAgICAgICAgICAgICBNYXRoLmFicyhkZWx0YVgpID4gTWF0aC5hYnMoZGVsdGFZKSAmJiBkZWx0YVggPCAwICYmICdyaWdodCcgfHxcbiAgICAgICAgICAgICAgICBNYXRoLmFicyhkZWx0YVkpID4gTWF0aC5hYnMoZGVsdGFYKSAmJiBkZWx0YVkgPiAwICYmICd1cCcgfHxcbiAgICAgICAgICAgICAgICAnZG93bic7XG5cblxuICAgICAgICBkZWx0YVggPSAoZXZlbnQuY2hhbmdlZFRvdWNoZXMgPyBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCA6IGV2ZW50LnBhZ2VYKSAtIHRoaXMub3JpZ2luLng7XG4gICAgICAgIGRlbHRhWSA9IChldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVkpIC0gdGhpcy5vcmlnaW4ueTtcblxuICAgICAgICB2YXIgaXNOZXcgPSB0aGlzLmVsZW1lbnQucGFyZW50KCcucGFydGljbGVzLWNvbnRhaW5lcicpO1xuICAgICAgICBpZiAoaXNOZXcpIHtcbiAgICAgICAgICAgIGRlbHRhWSArPSB0aGlzLm9yaWdpbi5vZmZzZXQuc2Nyb2xsLnkgLSB3aW5kb3cuc2Nyb2xsWTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUoeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoJyArIGRlbHRhWCArICdweCwgJyArIGRlbHRhWSArICdweCknIH0pO1xuXG4gICAgICAgIGlmICghdGhpcy5pc1BsYWNlSG9sZGVyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXN0TWF0Y2hlZCAmJiB0aGlzLm1hdGNoZWQgIT09IHRoaXMubGFzdE1hdGNoZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOmxlYXZlJywgZXZlbnQsIHRoaXMubGFzdE1hdGNoZWQsIHRoaXMuZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0TWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVkICYmIHRoaXMubWF0Y2hlZCAhPT0gdGhpcy5sYXN0TWF0Y2hlZCAmJiBvdmVyaW5nICE9PSB0aGlzLmxhc3RPdmVyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOmVudGVyJywgZXZlbnQsIHRoaXMubWF0Y2hlZCwgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RNYXRjaGVkID0gdGhpcy5tYXRjaGVkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVkICYmIHRoaXMubGFzdE1hdGNoZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IHRoaXMubWF0Y2hlZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiB5b3UgY2FuIGRpdmlkZSB4IGF4aXMgYnkgMyByYXRoZXIgdGhhbiAyIGZvciA0IGRpcmVjdGlvbnNcbiAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHg6IE1hdGguYWJzKChjbGllbnRYIC0gcmVjdC5sZWZ0KSkgPCAocmVjdC53aWR0aCAvIDIpICYmICdiZWZvcmUnIHx8XG4gICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKChjbGllbnRYIC0gcmVjdC5sZWZ0KSkgPj0gKHJlY3Qud2lkdGggLSAocmVjdC53aWR0aCAvIDIpKSAmJiAnYWZ0ZXInIHx8XG4gICAgICAgICAgICAgICAgICAgICdvdGhlcicsXG4gICAgICAgICAgICAgICAgICAgIHk6IE1hdGguYWJzKChjbGllbnRZIC0gcmVjdC50b3ApKSA8IChyZWN0LmhlaWdodCAvIDIpICYmICdhYm92ZScgfHxcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoKGNsaWVudFkgLSByZWN0LnRvcCkpID49IChyZWN0LmhlaWdodCAvIDIpICYmICdiZWxvdycgfHxcbiAgICAgICAgICAgICAgICAgICAgJ290aGVyJ1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOmxvY2F0aW9uJywgZXZlbnQsIGxvY2F0aW9uLCB0aGlzLm1hdGNoZWQsIHRoaXMuZWxlbWVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6bm9sb2NhdGlvbicsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGFzdE92ZXJlZCA9IG92ZXJpbmc7XG4gICAgICAgIHRoaXMubGFzdFggPSBjbGllbnRYO1xuICAgICAgICB0aGlzLmxhc3RZID0gY2xpZW50WTtcblxuICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOm1vdmUnLCBldmVudCwgdGhpcy5lbGVtZW50KTtcbiAgICB9LFxuXG4gICAgX3JlbW92ZVN0eWxlQXR0cmlidXRlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQgfHwgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgaWYgKGVsZW1lbnQuZGF0YSgnbW0taWQnKSkgeyByZXR1cm47IH1cblxuICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTsvLy5zdHlsZSh7ZmxleDogZmxleH0pO1xuICAgIH1cblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRHJhZ0Ryb3A7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBnZXRTdXBwb3J0ZWRFdmVudCA9IGZ1bmN0aW9uKGV2ZW50cykge1xuICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdCgnICcpO1xuXG4gICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwgZXZlbnQ7XG4gICAgdmFyIGlzU3VwcG9ydGVkID0gZmFsc2U7XG5cbiAgICBmb3IgKHZhciBpID0gZXZlbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGV2ZW50ID0gJ29uJyArIGV2ZW50c1tpXTtcbiAgICAgICAgaXNTdXBwb3J0ZWQgPSAoZXZlbnQgaW4gZWxlbWVudCk7XG5cbiAgICAgICAgaWYgKCFpc1N1cHBvcnRlZCkge1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoZXZlbnQsICdyZXR1cm47Jyk7XG4gICAgICAgICAgICBpc1N1cHBvcnRlZCA9IHR5cGVvZiBlbGVtZW50W2V2ZW50XSA9PT0gJ2Z1bmN0aW9uJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc1N1cHBvcnRlZCkge1xuICAgICAgICAgICAgaXNTdXBwb3J0ZWQgPSBldmVudHNbaV07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGVsZW1lbnQgPSBudWxsO1xuICAgIHJldHVybiBpc1N1cHBvcnRlZDtcbn07XG5cbnZhciBnZXRTdXBwb3J0ZWRFdmVudHMgPSBmdW5jdGlvbihldmVudHMpIHtcbiAgICBldmVudHMgPSBldmVudHMuc3BsaXQoJyAnKTtcblxuICAgIHZhciBpc1N1cHBvcnRlZCA9IGZhbHNlLCBzdXBwb3J0ZWQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gZXZlbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGlzU3VwcG9ydGVkID0gZ2V0U3VwcG9ydGVkRXZlbnQoZXZlbnRzW2ldKTtcbiAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7IHN1cHBvcnRlZC5wdXNoKGlzU3VwcG9ydGVkKTsgfVxuICAgIH1cblxuICAgIHJldHVybiBzdXBwb3J0ZWQ7XG59O1xuXG52YXIgRVZFTlQgPSB7XG4gICAgICAgIFNUQVJUOiBnZXRTdXBwb3J0ZWRFdmVudCgnbW91c2Vkb3duIHRvdWNoc3RhcnQgTVNQb2ludGVyRG93biBwb2ludGVyZG93bicpLFxuICAgICAgICBNT1ZFOiBnZXRTdXBwb3J0ZWRFdmVudCgnbW91c2Vtb3ZlIHRvdWNobW92ZSBNU1BvaW50ZXJNb3ZlIHBvaW50ZXJtb3ZlJyksXG4gICAgICAgIFNUT1A6IGdldFN1cHBvcnRlZEV2ZW50KCdtb3VzZXVwIHRvdWNoZW5kIE1TUG9pbnRlclVwIHBvaW50ZXJ1cCcpXG4gICAgfSxcbiAgICBFVkVOVFMgPSB7XG4gICAgICAgIFNUQVJUOiBnZXRTdXBwb3J0ZWRFdmVudHMoJ21vdXNlZG93biB0b3VjaHN0YXJ0IE1TUG9pbnRlckRvd24gcG9pbnRlcmRvd24nKSxcbiAgICAgICAgTU9WRTogZ2V0U3VwcG9ydGVkRXZlbnRzKCdtb3VzZW1vdmUgdG91Y2htb3ZlIE1TUG9pbnRlck1vdmUgcG9pbnRlcm1vdmUnKSxcbiAgICAgICAgU1RPUDogZ2V0U3VwcG9ydGVkRXZlbnRzKCdtb3VzZXVwIHRvdWNoZW5kIE1TUG9pbnRlclVwIHBvaW50ZXJ1cCcpXG4gICAgfTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBFVkVOVDogRVZFTlQsXG4gICAgRVZFTlRTOiBFVkVOVFNcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgRW1pdHRlciAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKTtcblxuXG52YXIgRXJhc2VyID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW09wdGlvbnMsIEJvdW5kXSxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpe1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudCkgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmhpZGUodHJ1ZSk7XG4gICAgfSxcblxuICAgIHNldFRvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy50b3AgIT09ICd1bmRlZmluZWQnKSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLnRvcCA9IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jb21wdXRlKCd0b3AnKSwgMTApO1xuICAgICAgICB0aGlzLmxlZnQgPSAkKCcjZzUtY29udGFpbmVyJylbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICAgICAgaWYgKEdBTlRSWV9QTEFURk9STSA9PSAnZ3JhdicpIHtcbiAgICAgICAgICAgIHRoaXMubGVmdCA9IDA7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24oZmFzdCl7XG4gICAgICAgIGlmICghdGhpcy5lbGVtZW50KSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLnNldFRvcCgpO1xuICAgICAgICB0aGlzLm91dCgpO1xuICAgICAgICB0aGlzLmVsZW1lbnRbZmFzdCA/ICdzdHlsZScgOiAnYW5pbWF0ZSddKHt0b3A6IHRoaXMudG9wLCBsZWZ0OiB0aGlzLmxlZnR9LCB7ZHVyYXRpb246ICcxNTBtcyd9KTtcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24oZmFzdCl7XG4gICAgICAgIGlmICghdGhpcy5lbGVtZW50KSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLnNldFRvcCgpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgdmFyIHRvcCA9IHt0b3A6IC0odGhpcy5lbGVtZW50WzBdLm9mZnNldEhlaWdodCl9O1xuICAgICAgICB0aGlzLm91dCgpO1xuICAgICAgICB0aGlzLmVsZW1lbnRbZmFzdCA/ICdzdHlsZScgOiAnYW5pbWF0ZSddKHRvcCwge2R1cmF0aW9uOiAnMTUwbXMnfSk7XG4gICAgfSxcblxuICAgIG92ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuZWxlbWVudC5maW5kKCcudHJhc2gtem9uZScpLmFuaW1hdGUoe3RyYW5zZm9ybTogJ3NjYWxlKDEuMiknfSwge2R1cmF0aW9uOiAnMTUwbXMnLCBlcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjUsMCwwLjUsMSknfSk7XG4gICAgfSxcblxuICAgIG91dDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoJy50cmFzaC16b25lJykuYW5pbWF0ZSh7dHJhbnNmb3JtOiAnc2NhbGUoMSknfSwge2R1cmF0aW9uOiAnMTUwbXMnLCBlcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjUsMCwwLjUsMSknfSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRXJhc2VyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBTZWxlY3RpemUgPSByZXF1aXJlKCcuL3NlbGVjdGl6ZScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBtb2RhbDogcmVxdWlyZSgnLi9tb2RhbCcpLFxuICAgIHRvZ2dsZXJzOiByZXF1aXJlKCcuL3RvZ2dsZXJzJyksXG4gICAgY29sbGFwc2U6IHJlcXVpcmUoJy4vY29sbGFwc2UnKSxcbiAgICBzZWxlY3RpemU6IFNlbGVjdGl6ZSxcbiAgICB0b2FzdHI6IHJlcXVpcmUoJy4vdG9hc3RyJylcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIEJhc2VkIG9uIFZleCAoaHR0cHM6Ly9naXRodWIuY29tL2h1YnNwb3QvdmV4KVxuXG52YXIgcHJpbWUgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHN0b3JhZ2UgID0gcmVxdWlyZSgncHJpbWUvbWFwJykoKSxcbiAgICBFbWl0dGVyICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIGRvbXJlYWR5ID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcblxuICAgIGJpbmQgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgbWFwICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L21hcCcpLFxuICAgIGZvckVhY2ggID0gcmVxdWlyZSgnbW91dC9hcnJheS9mb3JFYWNoJyksXG4gICAgbGFzdCAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2xhc3QnKSxcbiAgICBtZXJnZSAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L21lcmdlJyksXG4gICAgdHJpbSAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG5cbiAgICByZXF1ZXN0ICA9IHJlcXVpcmUoJ2FnZW50Jyk7XG5cbnZhciBhbmltYXRpb25FbmRTdXBwb3J0ID0gZmFsc2U7XG5cbnZhciBNb2RhbCA9IG5ldyBwcmltZSh7XG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIGFuaW1hdGlvbkVuZEV2ZW50OiBbJ2FuaW1hdGlvbmVuZCcsICd3ZWJraXRBbmltYXRpb25FbmQnLCAnbW96QW5pbWF0aW9uRW5kJywgJ01TQW5pbWF0aW9uRW5kJywgJ29hbmltYXRpb25lbmQnXSxcblxuICAgIGdsb2JhbElEOiAxLFxuXG4gICAgb3B0aW9uczoge1xuICAgICAgICBiYXNlQ2xhc3NOYW1lczoge1xuICAgICAgICAgICAgY29udGFpbmVyOiAnZzUtZGlhbG9nJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdnNS1jb250ZW50JyxcbiAgICAgICAgICAgIG92ZXJsYXk6ICdnNS1vdmVybGF5JyxcbiAgICAgICAgICAgIGNsb3NlOiAnZzUtY2xvc2UnLFxuICAgICAgICAgICAgY2xvc2luZzogJ2c1LWNsb3NpbmcnLFxuICAgICAgICAgICAgb3BlbjogJ2c1LWRpYWxvZy1vcGVuJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICByZW1vdGU6ICcnLFxuICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsXG4gICAgICAgIGVzY2FwZVRvQ2xvc2U6IHRydWUsXG4gICAgICAgIG92ZXJsYXlDbGlja1RvQ2xvc2U6IHRydWUsXG4gICAgICAgIGFwcGVuZE5vZGU6ICcjZzUtY29udGFpbmVyJyxcbiAgICAgICAgY2xhc3NOYW1lOiAnZzUtZGlhbG9nLXRoZW1lLWRlZmF1bHQnLFxuICAgICAgICBjc3M6IHt9LFxuICAgICAgICBvdmVybGF5Q2xhc3NOYW1lOiAnJyxcbiAgICAgICAgb3ZlcmxheUNTUzogJycsXG4gICAgICAgIGNvbnRlbnRDbGFzc05hbWU6ICcnLFxuICAgICAgICBjb250ZW50Q1NTOiAnJyxcbiAgICAgICAgY2xvc2VDbGFzc05hbWU6ICdnNS1kaWFsb2ctY2xvc2UnLFxuICAgICAgICBjbG9zZUNTUzogJycsXG5cbiAgICAgICAgYWZ0ZXJPcGVuOiBudWxsLFxuICAgICAgICBhZnRlckNsb3NlOiBudWxsXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGRvbXJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMjcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY2xvc2VCeUVzY2FwZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxmLmFuaW1hdGlvbkVuZEV2ZW50ID0gYW5pbWF0aW9uRW5kU3VwcG9ydDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpc1xuICAgICAgICAgICAgLm9uKCdkaWFsb2dPcGVuJywgZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLm9wZW4pO1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5hZGRDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLm9wZW4pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignZGlhbG9nQWZ0ZXJDbG9zZScsIGJpbmQoZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciBhbGwgPSB0aGlzLmdldEFsbCgpO1xuICAgICAgICAgICAgICAgIGlmICghYWxsIHx8ICFhbGwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLm9wZW4pO1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sJykucmVtb3ZlQ2xhc3Mob3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5vcGVuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIHN0b3JhZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc3RvcmFnZTtcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gbWVyZ2UodGhpcy5vcHRpb25zLCBvcHRpb25zKTtcbiAgICAgICAgb3B0aW9ucy5pZCA9IHRoaXMuZ2xvYmFsSUQrKztcblxuICAgICAgICB2YXIgZWxlbWVudHMgPSB7fTtcblxuICAgICAgICAvLyBjb250YWluZXJcbiAgICAgICAgZWxlbWVudHMuY29udGFpbmVyID0gemVuKCdkaXYnKVxuICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY29udGFpbmVyKVxuICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuY2xhc3NOYW1lKVxuICAgICAgICAgICAgLnN0eWxlKG9wdGlvbnMuY3NzKVxuICAgICAgICAgICAgLmF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCdyb2xlJywgJ2RpYWxvZycpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJylcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScsICdnLW1vZGFsLWxhYmVsbGVkYnknKVxuICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScsICdnLW1vZGFsLWRlc2NyaWJlZGJ5Jyk7XG5cbiAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudHMuY29udGFpbmVyLCB7IGRpYWxvZzogb3B0aW9ucyB9KTtcblxuICAgICAgICAvLyBvdmVybGF5XG4gICAgICAgIGVsZW1lbnRzLm92ZXJsYXkgPSB6ZW4oJ2RpdicpXG4gICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5vdmVybGF5KVxuICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMub3ZlcmxheUNsYXNzTmFtZSlcbiAgICAgICAgICAgIC5zdHlsZShvcHRpb25zLm92ZXJsYXlDU1MpO1xuXG4gICAgICAgIHN0b3JhZ2Uuc2V0KGVsZW1lbnRzLm92ZXJsYXksIHsgZGlhbG9nOiBvcHRpb25zIH0pO1xuXG4gICAgICAgIGlmIChvcHRpb25zLm92ZXJsYXlDbGlja1RvQ2xvc2UpIHtcbiAgICAgICAgICAgIGVsZW1lbnRzLmNvbnRhaW5lci5vbignY2xpY2snLCBiaW5kKHRoaXMuX292ZXJsYXlDbGljaywgdGhpcywgZWxlbWVudHMuY29udGFpbmVyWzBdKSk7XG4gICAgICAgICAgICBlbGVtZW50cy5vdmVybGF5Lm9uKCdjbGljaycsIGJpbmQodGhpcy5fb3ZlcmxheUNsaWNrLCB0aGlzLCBlbGVtZW50cy5vdmVybGF5WzBdKSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50cy5jb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbWVudHMub3ZlcmxheSk7XG5cbiAgICAgICAgLy8gY29udGVudFxuICAgICAgICBlbGVtZW50cy5jb250ZW50ID0gemVuKCdkaXYnKVxuICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY29udGVudClcbiAgICAgICAgICAgIC5hZGRDbGFzcyhvcHRpb25zLmNvbnRlbnRDbGFzc05hbWUpXG4gICAgICAgICAgICAuc3R5bGUob3B0aW9ucy5jb250ZW50Q1NTKVxuICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1saXZlJywgJ2Fzc2VydGl2ZScpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCd0YWJpbmRleCcsICcwJylcbiAgICAgICAgICAgIC5odG1sKG9wdGlvbnMuY29udGVudCk7XG5cbiAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudHMuY29udGVudCwgeyBkaWFsb2c6IG9wdGlvbnMgfSk7XG4gICAgICAgIGVsZW1lbnRzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50cy5jb250ZW50KTtcblxuICAgICAgICBpZiAob3B0aW9ucy5vdmVybGF5Q2xpY2tUb0Nsb3NlKSB7XG4gICAgICAgICAgICBlbGVtZW50cy5jb250ZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uKC8qZSovKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmVtb3RlXG4gICAgICAgIGlmIChvcHRpb25zLnJlbW90ZSAmJiBvcHRpb25zLnJlbW90ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7XG5cbiAgICAgICAgICAgIG9wdGlvbnMubWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgJ2dldCc7XG4gICAgICAgICAgICB2YXIgYWdlbnQgPSByZXF1ZXN0KCk7XG4gICAgICAgICAgICBhZ2VudC5tZXRob2Qob3B0aW9ucy5tZXRob2QpO1xuICAgICAgICAgICAgYWdlbnQudXJsKG9wdGlvbnMucmVtb3RlKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGEpIHsgYWdlbnQuZGF0YShvcHRpb25zLmRhdGEpOyB9XG5cbiAgICAgICAgICAgIGFnZW50LnNlbmQoYmluZChmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHMuY29udGFpbmVyLmhhc0NsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY2xvc2luZykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlTG9hZGluZygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudHMuY29udGVudC5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5KTtcblxuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGVsZW1lbnRzLmNvbnRlbnQuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVMb2FkaW5nKCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVtb3RlTG9hZGVkICYmICFlbGVtZW50cy5jb250YWluZXIuaGFzQ2xhc3Mob3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5jbG9zaW5nKSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnJlbW90ZUxvYWRlZChyZXNwb25zZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudHMuY29udGFpbmVyLmF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGVsZW1lbnRzLmNvbnRlbnRbMF0uZm9jdXMoKTsgfSwgMCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0cyA9ICQoJ1tkYXRhLXNlbGVjdGl6ZV0nKTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0cykgeyBzZWxlY3RzLnNlbGVjdGl6ZSgpOyB9XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50cy5jb250YWluZXIuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpeyBlbGVtZW50cy5jb250ZW50WzBdLmZvY3VzKCk7IH0sIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xvc2UgYnV0dG9uXG4gICAgICAgIGlmIChvcHRpb25zLnNob3dDbG9zZUJ1dHRvbikge1xuICAgICAgICAgICAgZWxlbWVudHMuY2xvc2VCdXR0b24gPSB6ZW4oJ2RpdicpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY2xvc2UpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuY2xvc2VDbGFzc05hbWUpXG4gICAgICAgICAgICAgICAgLmF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKS5hdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQ2xvc2UnKVxuICAgICAgICAgICAgICAgIC5zdHlsZShvcHRpb25zLmNsb3NlQ1NTKTtcblxuICAgICAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudHMuY2xvc2VCdXR0b24sIHsgZGlhbG9nOiBvcHRpb25zIH0pO1xuICAgICAgICAgICAgZWxlbWVudHMuY29udGVudC5hcHBlbmRDaGlsZChlbGVtZW50cy5jbG9zZUJ1dHRvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZWxlZ2F0ZSBjb250YWluZXIgdG8gcGljayBnNS1jbG9zZSBjbGlja3NcbiAgICAgICAgZWxlbWVudHMuY29udGFpbmVyLmRlbGVnYXRlKCdjbGljaycsICcuZzUtZGlhbG9nLWNsb3NlJywgYmluZChmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5fY2xvc2VCdXR0b25DbGljayhlbGVtZW50cy5jb250YWluZXIpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgLy8gaW5qZWN0IHRoZSBkaWFsb2cgaW4gdGhlIERPTVxuICAgICAgICB2YXIgY29udGFpbmVyID0gJChvcHRpb25zLmFwcGVuZE5vZGUpO1xuXG4gICAgICAgIC8vIHdvcmRwcmVzcyB3b3JrYXJvdW5kIGZvciBvdXQtb2Ytc2NvcGUgY2FzZXNcbiAgICAgICAgaWYgKEdBTlRSWV9QTEFURk9STSA9PSAnd29yZHByZXNzJykge1xuICAgICAgICAgICAgY29udGFpbmVyID0gJCgnI2N1c3RvbWl6ZS1wcmV2aWV3JykgfHwgJCgnI3dpZGdldHMtcmlnaHQnKSB8fCAkKG9wdGlvbnMuYXBwZW5kTm9kZSk7XG4gICAgICAgICAgICBpZiAoJyMnICsgY29udGFpbmVyLmlkKCkgIT0gb3B0aW9ucy5hcHBlbmROb2RlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdwd3JhcCA9ICQoJyN3cHdyYXAnKSB8fCAkKCcud3AtY3VzdG9taXplcicpLCBzaWJsaW5nLCB3b3JrYXJvdW5kO1xuICAgICAgICAgICAgICAgIGlmICh3cHdyYXAuaWQoKSA9PSAnd3B3cmFwJykge1xuICAgICAgICAgICAgICAgICAgICBzaWJsaW5nID0gd3B3cmFwLm5leHRTaWJsaW5nKG9wdGlvbnMuYXBwZW5kTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHdvcmthcm91bmQgPSAgc2libGluZyA/IHNpYmxpbmcgOiB6ZW4oJ2Rpdi5nNXdwLW91dC1vZi1zY29wZScgKyBvcHRpb25zLmFwcGVuZE5vZGUpLmFmdGVyKHdwd3JhcCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2libGluZyA9IHdwd3JhcC5maW5kKCc+ICcgKyBvcHRpb25zLmFwcGVuZE5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB3b3JrYXJvdW5kID0gIHNpYmxpbmcgPyBzaWJsaW5nIDogemVuKCdkaXYuZzV3cC1vdXQtb2Ytc2NvcGUnICsgb3B0aW9ucy5hcHBlbmROb2RlKS50b3Aod3B3cmFwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gd29ya2Fyb3VuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50cy5jb250YWluZXIpO1xuXG4gICAgICAgIG9wdGlvbnMuZWxlbWVudHMgPSBlbGVtZW50cztcblxuICAgICAgICBpZiAob3B0aW9ucy5hZnRlck9wZW4pIHtcbiAgICAgICAgICAgIG9wdGlvbnMuYWZ0ZXJPcGVuKGVsZW1lbnRzLmNvbnRlbnQsIG9wdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdCgnZGlhbG9nT3BlbicsIG9wdGlvbnMpO1xuICAgICAgICB9LCB0aGlzKSwgMCk7XG5cbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzLmNvbnRlbnQ7XG4gICAgfSxcblxuICAgIGdldEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICByZXR1cm4gJChcIi5cIiArIG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY29udGFpbmVyICsgXCI6bm90KC5cIiArIG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY2xvc2luZyArIFwiKSAuXCIgKyBvcHRpb25zLmJhc2VDbGFzc05hbWVzLmNvbnRlbnQpO1xuICAgIH0sXG5cbiAgICBnZXRCeUlEOiBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgYWxsID0gdGhpcy5nZXRBbGwoKTtcbiAgICAgICAgaWYgKCFhbGwpIHsgcmV0dXJuIFtdOyB9XG5cbiAgICAgICAgcmV0dXJuICQoYWxsLmZpbHRlcihmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybiBzdG9yYWdlLmdldChlbGVtZW50KS5kaWFsb2cuaWQgPT09IGlkO1xuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIGdldExhc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaWRzLCBpZDtcblxuICAgICAgICBpZHMgPSBtYXAodGhpcy5nZXRBbGwoKSwgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgICAgICAgIHJldHVybiBzdG9yYWdlLmdldChlbGVtZW50KS5kaWFsb2cuaWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghaWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsIGlkcyk7XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQobGFzdCh0aGlzLmdldEFsbCgpKSk7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlkID0gc3RvcmFnZS5nZXQoZWxlbWVudCkuZGlhbG9nLmlkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VCeUlEKGlkKTtcbiAgICB9LFxuXG4gICAgY2xvc2VBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaWRzO1xuXG4gICAgICAgIGlkcyA9IG1hcCh0aGlzLmdldEFsbCgpLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICAgICAgcmV0dXJuIHN0b3JhZ2UuZ2V0KGVsZW1lbnQpLmRpYWxvZy5pZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFpZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmb3JFYWNoKGlkcy5yZXZlcnNlKCksIGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUJ5SUQoaWQpO1xuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY2xvc2VCeUlEOiBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuZ2V0QnlJRChpZCk7XG4gICAgICAgIGlmICghY29udGVudCB8fCAhY29udGVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjb250YWluZXIsIG9wdGlvbnM7XG5cbiAgICAgICAgY29udGFpbmVyID0gc3RvcmFnZS5nZXQoY29udGVudCkuZGlhbG9nLmVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgICAgICAgb3B0aW9ucyA9IG1lcmdlKHt9LCBzdG9yYWdlLmdldChjb250ZW50KS5kaWFsb2cpO1xuXG4gICAgICAgIHZhciBiZWZvcmVDbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmJlZm9yZUNsb3NlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmJlZm9yZUNsb3NlKGNvbnRlbnQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9zZSA9IGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVtb3RlTG9hZGVkKSB7IG9wdGlvbnMucmVtb3RlTG9hZGVkID0gZnVuY3Rpb24oKXt9OyB9XG4gICAgICAgICAgICAgICAgY29udGVudC5lbWl0KCdkaWFsb2dDbG9zZScsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RpYWxvZ0FmdGVyQ2xvc2UnLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hZnRlckNsb3NlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmFmdGVyQ2xvc2UoY29udGVudCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAoYW5pbWF0aW9uRW5kU3VwcG9ydCkge1xuICAgICAgICAgICAgYmVmb3JlQ2xvc2UoKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYodGhpcy5hbmltYXRpb25FbmRFdmVudCkub24odGhpcy5hbmltYXRpb25FbmRFdmVudCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb3NlKCk7XG4gICAgICAgICAgICB9KS5hZGRDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLmNsb3NpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmVmb3JlQ2xvc2UoKTtcbiAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY2xvc2VCeUVzY2FwZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpZCA9IHRoaXMuZ2V0TGFzdCgpO1xuXG4gICAgICAgIGlmIChpZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5nZXRCeUlEKGlkKTtcblxuICAgICAgICBpZiAoIXN0b3JhZ2UuZ2V0KGVsZW1lbnQpLmRpYWxvZy5lc2NhcGVUb0Nsb3NlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUJ5SUQoaWQpO1xuXG4gICAgfSxcblxuICAgIGVuYWJsZUNsb3NlQnlPdmVybGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5nZXRMYXN0KCk7XG5cbiAgICAgICAgaWYgKGlkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGVsZW1lbnRzID0gc3RvcmFnZS5nZXQodGhpcy5nZXRCeUlEKGlkKSkuZGlhbG9nLmVsZW1lbnRzO1xuXG4gICAgICAgIGVsZW1lbnRzLmNvbnRhaW5lci5vbignY2xpY2snLCBiaW5kKHRoaXMuX292ZXJsYXlDbGljaywgdGhpcywgZWxlbWVudHMuY29udGFpbmVyWzBdKSk7XG4gICAgICAgIGVsZW1lbnRzLm92ZXJsYXkub24oJ2NsaWNrJywgYmluZCh0aGlzLl9vdmVybGF5Q2xpY2ssIHRoaXMsIGVsZW1lbnRzLm92ZXJsYXlbMF0pKTtcblxuICAgICAgICBlbGVtZW50cy5jb250ZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uKC8qZSovKXtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2hvd0xvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmhpZGVMb2FkaW5nKCk7XG4gICAgICAgIHJldHVybiAkKCcjZzUtY29udGFpbmVyJykuYXBwZW5kQ2hpbGQoemVuKCdkaXYuZzUtZGlhbG9nLWxvYWRpbmctc3Bpbm5lci4nICsgdGhpcy5vcHRpb25zLmNsYXNzTmFtZSkpO1xuICAgIH0sXG5cbiAgICBoaWRlTG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcGlubmVyID0gJCgnLmc1LWRpYWxvZy1sb2FkaW5nLXNwaW5uZXInKTtcbiAgICAgICAgcmV0dXJuIHNwaW5uZXIgPyBzcGlubmVyLnJlbW92ZSgpIDogZmFsc2U7XG4gICAgfSxcblxuICAgIC8vIHByaXZhdGVcbiAgICBfb3ZlcmxheUNsaWNrOiBmdW5jdGlvbihlbGVtZW50LCBldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSBlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZShzdG9yYWdlLmdldCgkKGVsZW1lbnQpKS5kaWFsb2cuaWQpO1xuICAgIH0sXG5cbiAgICBfY2xvc2VCdXR0b25DbGljazogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZShzdG9yYWdlLmdldCgkKGVsZW1lbnQpKS5kaWFsb2cuaWQpO1xuICAgIH1cbn0pO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgc3R5bGUgPSAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLnN0eWxlO1xuXG4gICAgZm9yRWFjaChbJ2FuaW1hdGlvbicsICdXZWJraXRBbmltYXRpb24nLCAnTW96QW5pbWF0aW9uJywgJ01zQW5pbWF0aW9uJywgJ09BbmltYXRpb24nXSwgZnVuY3Rpb24oYW5pbWF0aW9uLCBpbmRleCkge1xuICAgICAgICBpZiAoYW5pbWF0aW9uRW5kU3VwcG9ydCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFuaW1hdGlvbkVuZFN1cHBvcnQgPSBzdHlsZVthbmltYXRpb25dICE9PSB1bmRlZmluZWQgPyBNb2RhbC5wcm90b3R5cGUuYW5pbWF0aW9uRW5kRXZlbnRbaW5kZXhdIDogZmFsc2U7XG4gICAgfSk7XG59KTtcblxudmFyIG1vZGFsID0gbmV3IE1vZGFsKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbW9kYWw7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHByaW1lICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgemVuICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBzdG9yYWdlICA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpKCksXG4gICAgRW1pdHRlciAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICBkb21yZWFkeSA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG5cbiAgICBiaW5kICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIG1hcCAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9tYXAnKSxcbiAgICBmb3JFYWNoICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvZm9yRWFjaCcpLFxuICAgIGxhc3QgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9sYXN0JyksXG4gICAgbWVyZ2UgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9tZXJnZScpLFxuICAgIGlzRnVuY3QgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzRnVuY3Rpb24nKSxcblxuICAgIHJlcXVlc3QgID0gcmVxdWlyZSgnYWdlbnQnKTtcblxudmFyIFBvcG92ZXIgPSBuZXcgcHJpbWUoe1xuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBvcHRpb25zOiB7XG4gICAgICAgIG1haW5DbGFzczogJ2c1LXBvcG92ZXInLFxuICAgICAgICBwbGFjZW1lbnQ6ICdhdXRvJyxcbiAgICAgICAgd2lkdGg6ICdhdXRvJyxcbiAgICAgICAgaGVpZ2h0OiAnYXV0bycsXG4gICAgICAgIHRyaWdnZXI6ICdjbGljaycsXG4gICAgICAgIHN0eWxlOiAnJyxcbiAgICAgICAgZGVsYXk6IDMwMCxcbiAgICAgICAgY2FjaGU6IHRydWUsXG4gICAgICAgIG11bHRpOiBmYWxzZSxcbiAgICAgICAgYXJyb3c6IHRydWUsXG4gICAgICAgIHRpdGxlOiAnJyxcbiAgICAgICAgY29udGVudDogJycsXG4gICAgICAgIGNsb3NlYWJsZTogZmFsc2UsXG4gICAgICAgIHBhZGRpbmc6IHRydWUsXG4gICAgICAgIHRhcmdldEV2ZW50czogdHJ1ZSxcbiAgICAgICAgYWxsb3dFbGVtZW50c0NsaWNrOiBmYWxzZSxcbiAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgdHlwZTogJ2h0bWwnLFxuICAgICAgICB3aGVyZTogJyNnNS1jb250YWluZXInLFxuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJnNS1wb3BvdmVyXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiZy1hcnJvd1wiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cImc1LXBvcG92ZXItaW5uZXJcIj4nICtcbiAgICAgICAgJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJjbG9zZVwiPng8L2E+JyArXG4gICAgICAgICc8aDMgY2xhc3M9XCJnNS1wb3BvdmVyLXRpdGxlXCI+PC9oMz4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJnNS1wb3BvdmVyLWNvbnRlbnRcIj48aSBjbGFzcz1cImljb24tcmVmcmVzaFwiPjwvaT4gPHA+Jm5ic3A7PC9wPjwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRyaWdnZXIgPT09ICdjbGljaycpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vZmYoJ2NsaWNrJywgdGhpcy5ib3VuZCgndG9nZ2xlJykpLm9uKCdjbGljaycsIHRoaXMuYm91bmQoJ3RvZ2dsZScpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vZmYoJ21vdXNlZW50ZXInLCB0aGlzLmJvdW5kKCdtb3VzZWVudGVySGFuZGxlcicpKS5vZmYoJ21vdXNlbGVhdmUnLCB0aGlzLmJvdW5kKCdtb3VzZWxlYXZlSGFuZGxlcicpKVxuICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsIHRoaXMuYm91bmQoJ21vdXNlZW50ZXJIYW5kbGVyJykpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZUhhbmRsZXInKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9wb3BlZCA9IGZhbHNlO1xuICAgICAgICAvL3RoaXMuX2luaXRlZCA9IHRydWU7XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgc3RvcmFnZS5zZXQodGhpcy5lbGVtZW50WzBdLCBudWxsKTtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9mZignY2xpY2snLCB0aGlzLmJvdW5kKCd0b2dnbGUnKSkub2ZmKCdtb3VzZWVudGVyJywgdGhpcy5ib3VuZCgnbW91c2VlbnRlckhhbmRsZXInKSkub2ZmKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZUhhbmRsZXInKSk7XG5cbiAgICAgICAgaWYgKHRoaXMuJHRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIC8vdmFyIGUgPSAkLkV2ZW50KCdoaWRlLicgKyBwbHVnaW5UeXBlKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ2hpZGUucG9wb3ZlcicsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kdGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQucmVtb3ZlQ2xhc3MoJ2luJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ2hpZGRlbi5wb3BvdmVyJywgdGhpcyk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoJ2ZvY3VzJywgdGhpcy5ib3VuZCgnZm9jdXMnKSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c0F0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVGb2N1cygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRvZ2dsZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW3RoaXMuZ2V0VGFyZ2V0KCkuaGFzQ2xhc3MoJ2luJykgPyAnaGlkZScgOiAnc2hvdyddKCk7XG4gICAgfSxcblxuICAgIGZvY3VzOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICghdGhpcy5nZXRUYXJnZXQoKS5oYXNDbGFzcygnaW4nKSkgeyByZXR1cm47IH1cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgdGFyZ2V0ID0gJChlLnRhcmdldCB8fCBlKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLiR0YXJnZXRbMF0gPT09IHRhcmdldFswXSB8fCB0YXJnZXQucGFyZW50KHRoaXMuJHRhcmdldCkgfHxcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFswXSA9PT0gdGFyZ2V0WzBdIHx8IHRhcmdldC5wYXJlbnQodGhpcy5lbGVtZW50KVxuICAgICAgICApIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c0F0dGFjaGVkKSB0aGlzLnJlc3RvcmVGb2N1cygpO1xuICAgIH0sXG5cbiAgICByZXN0b3JlRm9jdXM6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCB8fCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICB2YXIgdGFnID0gZWxlbWVudC50YWcoKTtcblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGFnICE9ICdhJyAmJiB0YWcgIT0gJ2lucHV0JyAmJiB0YWcgIT0gJ2J1dHRvbicpIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBlbGVtZW50LmZpbmQoJ2EsIGJ1dHRvbiwgaW5wdXQnKTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMpIGl0ZW1zWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG4gICAgfSxcblxuICAgIGhpZGVBbGw6IGZ1bmN0aW9uKGZvcmNlKSB7XG4gICAgICAgIHZhciBjc3MgPSAnJztcbiAgICAgICAgaWYgKGZvcmNlKSB7IGNzcyA9ICdkaXYuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3M7IH1cbiAgICAgICAgZWxzZSB7IGNzcyA9ICdkaXYuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnOm5vdCguJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnLWZpeGVkKSc7IH1cblxuICAgICAgICB2YXIgZWxlbWVudHMgPSAkKGNzcyk7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuIHRoaXM7IH1cbiAgICAgICAgZWxlbWVudHMucmVtb3ZlQ2xhc3MoJ2luJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSkuYXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgICAgICBpZiAoIWZvcmNlICYmIHRoaXMuX2ZvY3VzQXR0YWNoZWQpIHRoaXMucmVzdG9yZUZvY3VzKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoJ2ZvY3VzJywgdGhpcy5ib3VuZCgnZm9jdXMnKSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c0F0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKS5hdHRyaWJ1dGUoJ2NsYXNzJywgbnVsbCkuYWRkQ2xhc3ModGhpcy5vcHRpb25zLm1haW5DbGFzcykuYXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMubXVsdGkpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUFsbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXNlIGNhY2hlIGJ5IGRlZmF1bHQsIGlmIG5vdCBjYWNoZSBzZXR0ZWQgICwgcmVJbml0IHRoZSBjb250ZW50c1xuICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgnYmVmb3Jlc2hvdy5wb3BvdmVyJywgdGhpcyk7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmNhY2hlIHx8ICF0aGlzLl9wb3BlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRUaXRsZSh0aGlzLmdldFRpdGxlKCkpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5jbG9zZWFibGUpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuZmluZCgnLmNsb3NlJykub2ZmKCdjbGljaycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBc3luYygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50KHRoaXMuZ2V0Q29udGVudCgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50QVN5bmModGhpcy5vcHRpb25zLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRhcmdldC5zdHlsZSh7IGRpc3BsYXk6ICdibG9jaycgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRpc3BsYXlDb250ZW50KCk7XG4gICAgICAgIHRoaXMuYmluZEJvZHlFdmVudHMoKTtcblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0YXJnZXRbMF0uZm9jdXMoKTtcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLl9mb2N1c0F0dGFjaGVkKSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2ZvY3VzJywgdGhpcy5ib3VuZCgnZm9jdXMnKSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c0F0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBkaXNwbGF5Q29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBlbGVtZW50UG9zID0gdGhpcy5lbGVtZW50LnBvc2l0aW9uKCksXG4gICAgICAgICAgICB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpLmF0dHJpYnV0ZSgnY2xhc3MnLCBudWxsKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubWFpbkNsYXNzKSxcbiAgICAgICAgICAgIHRhcmdldENvbnRlbnQgPSB0aGlzLmdldENvbnRlbnRFbGVtZW50KCksXG4gICAgICAgICAgICB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0LCBwbGFjZW1lbnQ7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ3Nob3cucG9wb3ZlcicsIHRoaXMpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMud2lkdGggIT09ICdhdXRvJykge1xuICAgICAgICAgICAgdGFyZ2V0LnN0eWxlKHsgd2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlaWdodCAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICB0YXJnZXRDb250ZW50LnN0eWxlKHsgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0IH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5pdCB0aGUgcG9wb3ZlciBhbmQgaW5zZXJ0IGludG8gdGhlIGRvY3VtZW50IGJvZHlcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuYXJyb3cgJiYgdGFyZ2V0LmZpbmQoJy5nLWFycm93JykpIHtcbiAgICAgICAgICAgIHRhcmdldC5maW5kKCcuZy1hcnJvdycpLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQodGhpcy5vcHRpb25zLndoZXJlKTtcblxuICAgICAgICAvLyB3b3JkcHJlc3Mgd29ya2Fyb3VuZCBmb3Igb3V0LW9mLXNjb3BlIGNhc2VzXG4gICAgICAgIGlmIChHQU5UUllfUExBVEZPUk0gPT0gJ3dvcmRwcmVzcycpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lciA9ICQoJyNjdXN0b21pemUtcHJldmlldycpIHx8ICQoJyN3aWRnZXRzLXJpZ2h0JykgfHwgJCh0aGlzLm9wdGlvbnMud2hlcmUpO1xuICAgICAgICAgICAgaWYgKCcjJyArIGNvbnRhaW5lci5pZCgpICE9IHRoaXMub3B0aW9ucy53aGVyZSkge1xuICAgICAgICAgICAgICAgIHZhciB3cHdyYXAgPSAkKCcjd3B3cmFwJykgfHwgJCgnLndwLWN1c3RvbWl6ZXInKSwgc2libGluZywgd29ya2Fyb3VuZDtcbiAgICAgICAgICAgICAgICBpZiAod3B3cmFwLmlkKCkgPT0gJ3dwd3JhcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgc2libGluZyA9IHdwd3JhcC5uZXh0U2libGluZyh0aGlzLm9wdGlvbnMud2hlcmUpO1xuICAgICAgICAgICAgICAgICAgICB3b3JrYXJvdW5kID0gIHNpYmxpbmcgPyBzaWJsaW5nIDogemVuKCdkaXYuZzV3cC1vdXQtb2Ytc2NvcGUnICsgdGhpcy5vcHRpb25zLndoZXJlKS5hZnRlcih3cHdyYXApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSB3cHdyYXAuZmluZCgnPiAnICsgdGhpcy5vcHRpb25zLndoZXJlKTtcbiAgICAgICAgICAgICAgICAgICAgd29ya2Fyb3VuZCA9ICBzaWJsaW5nID8gc2libGluZyA6IHplbignZGl2Lmc1d3Atb3V0LW9mLXNjb3BlJyArIHRoaXMub3B0aW9ucy53aGVyZSkudG9wKHdwd3JhcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IHdvcmthcm91bmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXQucmVtb3ZlKCkuc3R5bGUoe1xuICAgICAgICAgICAgdG9wOiAtMTAwMCxcbiAgICAgICAgICAgIGxlZnQ6IC0xMDAwLFxuICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJ1xuICAgICAgICB9KS5ib3R0b20oY29udGFpbmVyKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0eWxlKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5zdHlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3R5bGUgPSB0aGlzLm9wdGlvbnMuc3R5bGUuc3BsaXQoJywnKS5tYXAoRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsIFN0cmluZy5wcm90b3R5cGUudHJpbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdHlsZS5mb3JFYWNoKGZ1bmN0aW9uKHN0eWxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmFkZENsYXNzKHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnLScgKyBzdHlsZSk7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnBhZGRpbmcpIHtcbiAgICAgICAgICAgIHRhcmdldENvbnRlbnQuY3NzKCdoZWlnaHQnLCB0YXJnZXRDb250ZW50LnBvc2l0aW9uKCkuaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuJHRhcmdldC5hZGRDbGFzcygnZzUtcG9wb3Zlci1uby1wYWRkaW5nJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXRXaWR0aCA9IHRhcmdldFswXS5vZmZzZXRXaWR0aDtcbiAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gdGFyZ2V0WzBdLm9mZnNldEhlaWdodDtcbiAgICAgICAgcGxhY2VtZW50ID0gdGhpcy5nZXRQbGFjZW1lbnQoZWxlbWVudFBvcywgdGFyZ2V0SGVpZ2h0KTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50YXJnZXRFdmVudHMpIHsgdGhpcy5pbml0VGFyZ2V0RXZlbnRzKCk7IH1cbiAgICAgICAgdmFyIHBvc2l0aW9uSW5mbyA9IHRoaXMuZ2V0VGFyZ2V0UG9zaXRpb24oZWxlbWVudFBvcywgcGxhY2VtZW50LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0KTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0LnN0eWxlKHBvc2l0aW9uSW5mby5wb3NpdGlvbikuYWRkQ2xhc3MocGxhY2VtZW50KS5hZGRDbGFzcygnaW4nKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnR5cGUgPT09ICdpZnJhbWUnKSB7XG4gICAgICAgICAgICB2YXIgaWZyYW1lID0gdGFyZ2V0LmZpbmQoJ2lmcmFtZScpO1xuICAgICAgICAgICAgaWZyYW1lLnN0eWxlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogdGFyZ2V0LnBvc2l0aW9uKCkud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBpZnJhbWUucGFyZW50KCkucG9zaXRpb24uaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmFycm93KSB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQuc3R5bGUoeyAnbWFyZ2luJzogMCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmFycm93KSB7XG4gICAgICAgICAgICB2YXIgYXJyb3cgPSB0aGlzLiR0YXJnZXQuZmluZCgnLmctYXJyb3cnKTtcbiAgICAgICAgICAgIGFycm93LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbkluZm8uYXJyb3dPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZShwb3NpdGlvbkluZm8uYXJyb3dPZmZzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fcG9wZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ3Nob3duLnBvcG92ZXInLCB0aGlzKTtcblxuICAgIH0sXG5cblxuICAgIC8qZ2V0dGVyIHNldHRlcnMgKi9cbiAgICBnZXRUYXJnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuJHRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0ID0gJCh6ZW4oJ2RpdicpLmh0bWwodGhpcy5vcHRpb25zLnRlbXBsYXRlKS5jaGlsZHJlbigpWzBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy4kdGFyZ2V0O1xuICAgIH0sXG5cbiAgICBnZXRUaXRsZUVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRUYXJnZXQoKS5maW5kKCcuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnLXRpdGxlJyk7XG4gICAgfSxcblxuICAgIGdldENvbnRlbnRFbGVtZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGFyZ2V0KCkuZmluZCgnLicgKyB0aGlzLm9wdGlvbnMubWFpbkNsYXNzICsgJy1jb250ZW50Jyk7XG4gICAgfSxcblxuICAgIGdldFRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy50aXRsZSB8fCB0aGlzLmVsZW1lbnQuZGF0YSgnZzUtcG9wb3Zlci10aXRsZScpIHx8IHRoaXMuZWxlbWVudC5hdHRyaWJ1dGUoJ3RpdGxlJyk7XG4gICAgfSxcblxuICAgIHNldFRpdGxlOiBmdW5jdGlvbih0aXRsZSkge1xuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZ2V0VGl0bGVFbGVtZW50KCk7XG4gICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgZWxlbWVudC5odG1sKHRpdGxlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaGFzQ29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldENvbnRlbnQoKTtcbiAgICB9LFxuXG4gICAgZ2V0Q29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudXJsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnR5cGUgPT09ICdpZnJhbWUnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gJCgnPGlmcmFtZSBmcmFtZWJvcmRlcj1cIjBcIj48L2lmcmFtZT4nKS5hdHRyaWJ1dGUoJ3NyYycsIHRoaXMub3B0aW9ucy51cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gJyc7XG4gICAgICAgICAgICBpZiAoaXNGdW5jdCh0aGlzLm9wdGlvbnMuY29udGVudCkpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5vcHRpb25zLmNvbnRlbnQuYXBwbHkodGhpcy5lbGVtZW50WzBdLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5vcHRpb25zLmNvbnRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmVsZW1lbnQuZGF0YSgnZzUtcG9wb3Zlci1jb250ZW50JykgfHwgY29udGVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50O1xuICAgIH0sXG5cbiAgICBzZXRDb250ZW50OiBmdW5jdGlvbihjb250ZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpO1xuICAgICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50KCkuaHRtbChjb250ZW50KTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0ID0gdGFyZ2V0O1xuICAgIH0sXG5cbiAgICBpc0FzeW5jOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy50eXBlID09PSAnYXN5bmMnO1xuICAgIH0sXG5cbiAgICBzZXRDb250ZW50QVN5bmM6IGZ1bmN0aW9uKGNvbnRlbnQpIHtcbiAgICAgICAgcmVxdWVzdCgnZ2V0JywgdGhpcy5vcHRpb25zLnVybCwgYmluZChmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChjb250ZW50ICYmIGlzRnVuY3QoY29udGVudCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50LmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW3Jlc3BvbnNlXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudCA9IHJlc3BvbnNlLmJvZHkuaHRtbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50KHRoaXMuY29udGVudCk7XG5cbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldENvbnRlbnRFbGVtZW50KCk7XG4gICAgICAgICAgICB0YXJnZXQuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0YXJnZXQucGFyZW50KCcuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MpWzBdLmZvY3VzKCk7XG4gICAgICAgICAgICB9LCB0aGlzKSwgMCk7XG5cbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgICAgIHRoaXMuYmluZEJvZHlFdmVudHMoKTtcblxuICAgICAgICAgICAgdmFyIHNlbGVjdHMgPSAkKCdbZGF0YS1zZWxlY3RpemVdJyk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0cykgeyBzZWxlY3RzLnNlbGVjdGl6ZSgpOyB9XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgYmluZEJvZHlFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcbiAgICAgICAgYm9keS5vZmYoJ2tleXVwJywgdGhpcy5ib3VuZCgnZXNjYXBlSGFuZGxlcicpKS5vbigna2V5dXAnLCB0aGlzLmJvdW5kKCdlc2NhcGVIYW5kbGVyJykpO1xuICAgICAgICBib2R5Lm9mZignY2xpY2snLCB0aGlzLmJvdW5kKCdib2R5Q2xpY2tIYW5kbGVyJykpLm9uKCdjbGljaycsIHRoaXMuYm91bmQoJ2JvZHlDbGlja0hhbmRsZXInKSk7XG4gICAgfSxcblxuXG4gICAgLyogZXZlbnQgaGFuZGxlcnMgKi9cbiAgICBtb3VzZWVudGVySGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLl90aW1lb3V0KSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEodGhpcy5nZXRUYXJnZXQoKVswXS5vZmZzZXRXaWR0aCA+IDAgfHwgdGhpcy5nZXRUYXJnZXQoKVswXS5vZmZzZXRIZWlnaHQgPiAwKSkge1xuICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNlbGVhdmVIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8ga2V5IHBvaW50LCBzZXQgdGhlIF90aW1lb3V0ICB0aGVuIHVzZSBjbGVhclRpbWVvdXQgd2hlbiBtb3VzZSBsZWF2ZVxuICAgICAgICB0aGlzLl90aW1lb3V0ID0gc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH0sIHRoaXMpLCB0aGlzLm9wdGlvbnMuZGVsYXkpO1xuICAgIH0sXG5cbiAgICBlc2NhcGVIYW5kbGVyOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICAgICAgICB0aGlzLmhpZGVBbGwoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBib2R5Q2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5oaWRlQWxsKCk7XG4gICAgfSxcblxuICAgIHRhcmdldENsaWNrSGFuZGxlcjogZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7XG4gICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcyh0aGlzLm9wdGlvbnMuYWxsb3dFbGVtZW50c0NsaWNrKSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgaWYgKCF0YXJnZXQucGFyZW50KCdbZGF0YS1nLXBvcG92ZXItZm9sbG93XScpICYmIHRhcmdldC5kYXRhKCdnLXBvcG92ZXItZm9sbG93JykgPT09IG51bGwpIHsgZS5zdG9wUHJvcGFnYXRpb24oKTsgfVxuICAgIH0sXG5cbiAgICBpbml0VGFyZ2V0RXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50cmlnZ2VyICE9PSAnY2xpY2snKSB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXRcbiAgICAgICAgICAgICAgICAub2ZmKCdtb3VzZWVudGVyJywgdGhpcy5ib3VuZCgnbW91c2VlbnRlcicpKVxuICAgICAgICAgICAgICAgIC5vZmYoJ21vdXNlbGVhdmUnLCB0aGlzLmJvdW5kKCdtb3VzZWxlYXZlJykpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJywgdGhpcy5ib3VuZCgnbW91c2VlbnRlckhhbmRsZXInKSlcbiAgICAgICAgICAgICAgICAub24oJ21vdXNlbGVhdmUnLCB0aGlzLmJvdW5kKCdtb3VzZWxlYXZlSGFuZGxlcicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjbG9zZSA9IHRoaXMuJHRhcmdldC5maW5kKCcuY2xvc2UnKTtcbiAgICAgICAgaWYgKGNsb3NlKSB7XG4gICAgICAgICAgICBjbG9zZS5vZmYoJ2NsaWNrJywgdGhpcy5ib3VuZCgnaGlkZScpKS5vbignY2xpY2snLCB0aGlzLmJvdW5kKCdoaWRlJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4kdGFyZ2V0Lm9mZignY2xpY2snLCB0aGlzLmJvdW5kKCd0YXJnZXRDbGlja0hhbmRsZXInKSkub24oJ2NsaWNrJywgdGhpcy5ib3VuZCgndGFyZ2V0Q2xpY2tIYW5kbGVyJykpO1xuICAgIH0sXG5cbiAgICAvKiB1dGlscyBtZXRob2RzICovXG4gICAgZ2V0UGxhY2VtZW50OiBmdW5jdGlvbihwb3MsIHRhcmdldEhlaWdodCkge1xuICAgICAgICB2YXJcbiAgICAgICAgICAgIHBsYWNlbWVudCxcbiAgICAgICAgICAgIGRlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LFxuICAgICAgICAgICAgZGIgPSBkb2N1bWVudC5ib2R5LFxuICAgICAgICAgICAgY2xpZW50V2lkdGggPSBkZS5jbGllbnRXaWR0aCxcbiAgICAgICAgICAgIGNsaWVudEhlaWdodCA9IGRlLmNsaWVudEhlaWdodCxcbiAgICAgICAgICAgIHNjcm9sbFRvcCA9IE1hdGgubWF4KGRiLnNjcm9sbFRvcCwgZGUuc2Nyb2xsVG9wKSxcbiAgICAgICAgICAgIHNjcm9sbExlZnQgPSBNYXRoLm1heChkYi5zY3JvbGxMZWZ0LCBkZS5zY3JvbGxMZWZ0KSxcbiAgICAgICAgICAgIHBhZ2VYID0gTWF0aC5tYXgoMCwgcG9zLmxlZnQgLSBzY3JvbGxMZWZ0KSxcbiAgICAgICAgICAgIHBhZ2VZID0gTWF0aC5tYXgoMCwgcG9zLnRvcCAtIHNjcm9sbFRvcCksXG4gICAgICAgICAgICBhcnJvd1NpemUgPSAyMDtcblxuICAgICAgICAvLyBpZiBwbGFjZW1lbnQgZXF1YWxzIGF1dG/vvIxjYWN1bGF0ZSB0aGUgcGxhY2VtZW50IGJ5IGVsZW1lbnQgaW5mb3JtYXRpb247XG4gICAgICAgIGlmICh0eXBlb2YodGhpcy5vcHRpb25zLnBsYWNlbWVudCkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHBsYWNlbWVudCA9IHRoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmdldFRhcmdldCgpWzBdLCB0aGlzLmVsZW1lbnRbMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGxhY2VtZW50ID0gdGhpcy5lbGVtZW50LmRhdGEoJ2c1LXBvcG92ZXItcGxhY2VtZW50JykgfHwgdGhpcy5vcHRpb25zLnBsYWNlbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwbGFjZW1lbnQgPT09ICdhdXRvJykge1xuICAgICAgICAgICAgaWYgKHBhZ2VYIDwgY2xpZW50V2lkdGggLyAzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VZIDwgY2xpZW50SGVpZ2h0IC8gMykge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAnYm90dG9tLXJpZ2h0JztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VZIDwgY2xpZW50SGVpZ2h0ICogMiAvIDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAndG9wLXJpZ2h0JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9wbGFjZW1lbnQ9IHBhZ2VZPnRhcmdldEhlaWdodCthcnJvd1NpemU/J3RvcC1yaWdodCc6J2JvdHRvbS1yaWdodCc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VYIDwgY2xpZW50V2lkdGggKiAyIC8gMykge1xuICAgICAgICAgICAgICAgIGlmIChwYWdlWSA8IGNsaWVudEhlaWdodCAvIDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2JvdHRvbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlWSA8IGNsaWVudEhlaWdodCAqIDIgLyAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdib3R0b20nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICd0b3AnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gcGFnZVkgPiB0YXJnZXRIZWlnaHQgKyBhcnJvd1NpemUgPyAndG9wLWxlZnQnIDogJ2JvdHRvbS1sZWZ0JztcbiAgICAgICAgICAgICAgICBpZiAocGFnZVkgPCBjbGllbnRIZWlnaHQgLyAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdib3R0b20tbGVmdCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlWSA8IGNsaWVudEhlaWdodCAqIDIgLyAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAndG9wLWxlZnQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGxhY2VtZW50O1xuICAgIH0sXG5cbiAgICBnZXRUYXJnZXRQb3NpdGlvbjogZnVuY3Rpb24oZWxlbWVudFBvcywgcGxhY2VtZW50LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0KSB7XG4gICAgICAgIHZhciBwb3MgPSBlbGVtZW50UG9zLFxuICAgICAgICAgICAgZWxlbWVudFcgPSB0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICBlbGVtZW50SCA9IHRoaXMuZWxlbWVudFswXS5vZmZzZXRIZWlnaHQsXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHt9LFxuICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSBudWxsLFxuICAgICAgICAgICAgYXJyb3dTaXplID0gdGhpcy5vcHRpb25zLmFycm93ID8gMjggOiAwLFxuICAgICAgICAgICAgZml4ZWRXID0gZWxlbWVudFcgPCBhcnJvd1NpemUgKyAxMCA/IGFycm93U2l6ZSA6IDAsXG4gICAgICAgICAgICBmaXhlZEggPSBlbGVtZW50SCA8IGFycm93U2l6ZSArIDEwID8gYXJyb3dTaXplIDogMDtcblxuICAgICAgICBzd2l0Y2ggKHBsYWNlbWVudCkge1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gdGFyZ2V0V2lkdGggLyAyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCAtIHRhcmdldEhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gdGFyZ2V0V2lkdGggLyAyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIHRhcmdldEhlaWdodCAvIDIsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gdGFyZ2V0V2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIHRhcmdldEhlaWdodCAvIDIsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCAtIHRhcmdldEhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSBmaXhlZFdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyBsZWZ0OiBlbGVtZW50VyAvIDIgKyBmaXhlZFcgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gdGFyZ2V0SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCAtIHRhcmdldFdpZHRoICsgcG9zLndpZHRoICsgZml4ZWRXXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhcnJvd09mZnNldCA9IHsgbGVmdDogdGFyZ2V0V2lkdGggLSBlbGVtZW50VyAvIDIgLSBmaXhlZFcgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gZml4ZWRXXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhcnJvd09mZnNldCA9IHsgbGVmdDogZWxlbWVudFcgLyAyICsgZml4ZWRXIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdib3R0b20tbGVmdCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gdGFyZ2V0V2lkdGggKyBwb3Mud2lkdGggKyBmaXhlZFdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyBsZWZ0OiB0YXJnZXRXaWR0aCAtIGVsZW1lbnRXIC8gMiAtIGZpeGVkVyB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncmlnaHQtdG9wJzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gdGFyZ2V0SGVpZ2h0ICsgcG9zLmhlaWdodCArIGZpeGVkSCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyB0b3A6IHRhcmdldEhlaWdodCAtIGVsZW1lbnRIIC8gMiAtIGZpeGVkSCB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gZml4ZWRILFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IHRvcDogZWxlbWVudEggLyAyICsgZml4ZWRIIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsZWZ0LXRvcCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCAtIHRhcmdldEhlaWdodCArIHBvcy5oZWlnaHQgKyBmaXhlZEgsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gdGFyZ2V0V2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyB0b3A6IHRhcmdldEhlaWdodCAtIGVsZW1lbnRIIC8gMiAtIGZpeGVkSCB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbGVmdC1ib3R0b20nOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gdGFyZ2V0V2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyB0b3A6IGVsZW1lbnRIIC8gMiB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgYXJyb3dPZmZzZXQ6IGFycm93T2Zmc2V0XG4gICAgICAgIH07XG4gICAgfVxuXG59KTtcblxuJC5pbXBsZW1lbnQoe1xuICAgIGdldFBvcG92ZXI6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHBvcG92ZXIgPSBzdG9yYWdlLmdldCh0aGlzKTtcblxuICAgICAgICBpZiAoIXBvcG92ZXIgJiYgb3B0aW9ucyAhPT0gJ2Rlc3Ryb3knKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIHBvcG92ZXIgPSBuZXcgUG9wb3Zlcih0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KHRoaXMsIHBvcG92ZXIpO1xuICAgICAgICAgICAgdGhpcy5Qb3BvdmVyRGVmaW5lZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcG9wb3ZlcjtcbiAgICB9LFxuXG4gICAgcG9wb3ZlcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBwb3BvdmVyID0gc3RvcmFnZS5nZXQoZWxlbWVudCk7XG5cbiAgICAgICAgICAgIGlmICghcG9wb3ZlciAmJiBvcHRpb25zICE9PSAnZGVzdHJveScpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICBwb3BvdmVyID0gbmV3IFBvcG92ZXIoZWxlbWVudCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudCwgcG9wb3Zlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBub2RlID0gdGhpc1swXSxcbiAgICAgICAgICAgIGN0ID0gJCgnI2c1LWNvbnRhaW5lcicpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgYm94ID0ge1xuICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogMFxuICAgICAgICAgICAgfTtcblxuICAgICAgICBpZiAodHlwZW9mIG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBib3ggPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHg6IGJveC5sZWZ0IC0gY3QubGVmdCxcbiAgICAgICAgICAgIGxlZnQ6IGJveC5sZWZ0IC0gY3QubGVmdCxcbiAgICAgICAgICAgIHk6IGJveC50b3AgLSBjdC50b3AsXG4gICAgICAgICAgICB0b3A6IGJveC50b3AgLSBjdC50b3AsXG4gICAgICAgICAgICByaWdodDogYm94LnJpZ2h0IC0gY3QucmlnaHQsXG4gICAgICAgICAgICBib3R0b206IGJveC5ib3R0b20gLSBjdC5ib3R0b20sXG4gICAgICAgICAgICB3aWR0aDogYm94LnJpZ2h0IC0gYm94LmxlZnQsXG4gICAgICAgICAgICBoZWlnaHQ6IGJveC5ib3R0b20gLSBib3gudG9wXG4gICAgICAgIH07XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gJDtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHByaW1lICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBFbWl0dGVyICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIHplbiAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgbW9vZnggICAgPSByZXF1aXJlKCdtb29meCcpLFxuXG4gICAgYmluZCAgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBpc0FycmF5ICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0FycmF5JyksXG4gICAgaXNOdW1iZXIgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNOdW1iZXInKTtcblxudmFyIFByb2dyZXNzZXIgPSBuZXcgcHJpbWUoe1xuXG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdmFsdWU6IDAuMCxcbiAgICAgICAgc2l6ZTogNTAuMCxcbiAgICAgICAgc3RhcnRBbmdsZTogLU1hdGguUEkgLyAyLFxuICAgICAgICB0aGlja25lc3M6ICdhdXRvJyxcbiAgICAgICAgZmlsbDogeyAvLyB7IGNvbG9yOiAnaGV4fHJnYmEnIH0gfHwgeyBncmFkaWVudDogW2Zyb20sIHRvXSwgZ3JhZGllbnRBbmdsZTogTWF0aC5QSSAvIDQsIGdyYWRpZW50RGlyZWN0aW9uOiBbeDAsIHkwLCB4MSwgeTFdIH1cbiAgICAgICAgICAgIGdyYWRpZW50OiBbJyM5ZTM4ZWInLCAnIzRlNjhmYyddLy9bJyMzYWVhYmInLCAnI2ZkZDI1MCddXG4gICAgICAgIH0sXG4gICAgICAgIGVtcHR5RmlsbDogJ3JnYmEoMCwgMCwgMCwgLjEpJyxcbiAgICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMTIwMCxcbiAgICAgICAgICAgIGVxdWF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuNjQ1LCAwLjA0NSwgMC4zNTUsIDEpJ1xuICAgICAgICB9LFxuICAgICAgICBhbmltYXRpb25TdGFydFZhbHVlOiAwLjAsXG4gICAgICAgIHJldmVyc2U6IGZhbHNlLFxuICAgICAgICBsaW5lQ2FwOiAnYnV0dCcsIC8vIGJ1dHQsIHJvdW5kLCBzcXVhcmVcbiAgICAgICAgaW5zZXJ0RWxlbWVudDogbnVsbCxcbiAgICAgICAgaW5zZXJ0TG9jYXRpb246ICdiZWZvcmUnXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmVsZW1lbnQgfHwgJChlbGVtZW50KTtcbiAgICAgICAgdGhpcy5jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB6ZW4oJ2NhbnZhcycpW3RoaXMub3B0aW9ucy5pbnNlcnRMb2NhdGlvbiB8fCAnYmVmb3JlJ10odGhpcy5vcHRpb25zLmluc2VydEVsZW1lbnQgfHwgdGhpcy5lbGVtZW50KVswXTtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSB0aGlzLm9wdGlvbnMuc2l6ZSAvIDI7XG4gICAgICAgIHRoaXMuYXJjRmlsbCA9IG51bGw7XG4gICAgICAgIHRoaXMubGFzdEZyYW1lVmFsdWUgPSAwLjA7XG5cbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLm9wdGlvbnMuc2l6ZTtcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5vcHRpb25zLnNpemU7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICB0aGlzLmluaXRGaWxsKCk7XG4gICAgICAgIHRoaXMuZHJhdygpO1xuICAgIH0sXG5cbiAgICBpbml0RmlsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBmaWxsID0gdGhpcy5vcHRpb25zLmZpbGwsXG4gICAgICAgICAgICBzaXplID0gdGhpcy5vcHRpb25zLnNpemUsXG4gICAgICAgICAgICBjdHggID0gdGhpcy5jdHg7XG5cbiAgICAgICAgaWYgKCFmaWxsKSB7IHRocm93IEVycm9yKCdUaGUgZmlsbCBpcyBub3Qgc3BlY2lmaWVkLicpOyB9XG5cbiAgICAgICAgaWYgKGZpbGwuY29sb3IpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjRmlsbCA9IGZpbGwuY29sb3I7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZmlsbC5ncmFkaWVudCkge1xuICAgICAgICAgICAgdmFyIGdyID0gZmlsbC5ncmFkaWVudDtcblxuICAgICAgICAgICAgaWYgKGdyLmxlbmd0aCA9PSAxKSB7IHRoaXMuYXJjRmlsbCA9IGdyWzBdOyB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZ2EgPSBmaWxsLmdyYWRpZW50QW5nbGUgfHwgMCwgIC8vIGdyYWRpZW50IGRpcmVjdGlvbiBhbmdsZTsgMCBieSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgIGdkID0gZmlsbC5ncmFkaWVudERpcmVjdGlvbiB8fCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSAvIDIgKiAoMSAtIE1hdGguY29zKGdhKSksIC8vIHgwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSAvIDIgKiAoMSArIE1hdGguc2luKGdhKSksIC8vIHkwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSAvIDIgKiAoMSArIE1hdGguY29zKGdhKSksIC8vIHgxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSAvIDIgKiAoMSAtIE1hdGguc2luKGdhKSkgIC8vIHkxXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICBsZyA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudC5hcHBseShjdHgsIGdkKTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3IubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gZ3JbaV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MgICA9IGkgLyAoZ3IubGVuZ3RoIC0gMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkoY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBjb2xvclsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZy5hZGRDb2xvclN0b3AocG9zLCBjb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5hcmNGaWxsID0gbGc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXNbdGhpcy5vcHRpb25zLmFuaW1hdGlvbiA/ICdkcmF3QW5pbWF0ZWQnIDogJ2RyYXdGcmFtZSddKHRoaXMub3B0aW9ucy52YWx1ZSk7XG4gICAgfSxcblxuICAgIGRyYXdGcmFtZTogZnVuY3Rpb24odikge1xuICAgICAgICB0aGlzLmxhc3RGcmFtZVZhbHVlID0gdjtcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMub3B0aW9ucy5zaXplLCB0aGlzLm9wdGlvbnMuc2l6ZSk7XG4gICAgICAgIHRoaXMuZHJhd0VtcHR5QXJjKHYpO1xuICAgICAgICB0aGlzLmRyYXdBcmModik7XG4gICAgfSxcblxuICAgIGRyYXdBcmM6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4LFxuICAgICAgICAgICAgciAgID0gdGhpcy5yYWRpdXMsXG4gICAgICAgICAgICB0ICAgPSB0aGlzLmdldFRoaWNrbmVzcygpLFxuICAgICAgICAgICAgYSAgID0gdGhpcy5vcHRpb25zLnN0YXJ0QW5nbGU7XG5cbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnJldmVyc2UpIHtcbiAgICAgICAgICAgIGN0eC5hcmMociwgciwgciAtIHQgLyAyLCBhLCBhICsgTWF0aC5QSSAqIDIgKiB2KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN0eC5hcmMociwgciwgciAtIHQgLyAyLCBhIC0gTWF0aC5QSSAqIDIgKiB2LCBhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGN0eC5saW5lV2lkdGggPSB0O1xuICAgICAgICBjdHgubGluZUNhcCA9IHRoaXMub3B0aW9ucy5saW5lQ2FwO1xuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmFyY0ZpbGw7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9LFxuXG4gICAgZHJhd0VtcHR5QXJjOiBmdW5jdGlvbih2KSB7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLmN0eCxcbiAgICAgICAgICAgIHIgICA9IHRoaXMucmFkaXVzLFxuICAgICAgICAgICAgdCAgID0gdGhpcy5nZXRUaGlja25lc3MoKSxcbiAgICAgICAgICAgIGEgICA9IHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlO1xuXG4gICAgICAgIGlmICh2IDwgMSkge1xuICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgICAgICAgaWYgKHYgPD0gMCkge1xuICAgICAgICAgICAgICAgIGN0eC5hcmMociwgciwgciAtIHQgLyAyLCAwLCBNYXRoLlBJICogMik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZXZlcnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5hcmMociwgciwgciAtIHQgLyAyLCBhICsgTWF0aC5QSSAqIDIgKiB2LCBhKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgYSwgYSAtIE1hdGguUEkgKiAyICogdik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gdDtcbiAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMub3B0aW9ucy5lbXB0eUZpbGw7XG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRyYXdBbmltYXRlZDogZnVuY3Rpb24odikge1xuICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgncHJvZ3Jlc3MtYW5pbWF0aW9uLXN0YXJ0Jyk7XG5cbiAgICAgICAgbW9vZngoYmluZChmdW5jdGlvbihub3cpIHtcbiAgICAgICAgICAgIHZhciBzdGVwVmFsdWUgPSB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uU3RhcnRWYWx1ZSAqICgxIC0gbm93KSArIHYgKiBub3c7XG4gICAgICAgICAgICB0aGlzLmRyYXdGcmFtZShzdGVwVmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ3Byb2dyZXNzLWFuaW1hdGlvbi1jaGFuZ2UnLCBub3csIHN0ZXBWYWx1ZSk7XG4gICAgICAgIH0sIHRoaXMpLCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5kdXJhdGlvbiB8fCAnMTIwMCcsXG4gICAgICAgICAgICBlcXVhdGlvbjogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5lcXVhdGlvbiB8fCAnbGluZWFyJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLmNhbGxiYWNrKSB7IHRoaXMub3B0aW9ucy5hbmltYXRpb24uY2FsbGJhY2soKTsgfVxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5lbWl0KCdwcm9ncmVzcy1hbmltYXRpb24tZW5kJyk7XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICB9KS5zdGFydCgwLCAxKTtcbiAgICB9LFxuXG4gICAgZ2V0VGhpY2tuZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGlzTnVtYmVyKHRoaXMub3B0aW9ucy50aGlja25lc3MpID8gdGhpcy5vcHRpb25zLnRoaWNrbmVzcyA6IHRoaXMub3B0aW9ucy5zaXplIC8gMTQ7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuLy8gc2VsZWN0aXplICh2MC4xMi4xKSAoY29tbWl0OiA0ZGFlNzYxKVxuXG52YXIgcHJpbWUgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgcmVhZHkgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgemVuICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuXG4gICAgc2lmdGVyICAgICA9IHJlcXVpcmUoJ3NpZnRlcicpLFxuXG4gICAgRW1pdHRlciAgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIE9wdGlvbnMgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcblxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIG1vb2Z4ICAgICAgPSByZXF1aXJlKCdtb29meCcpLFxuXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vZm9yRWFjaCcpLFxuICAgIGluZGV4T2YgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2luZGV4T2YnKSxcbiAgICBsYXN0ICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9sYXN0JyksXG4gICAgZGVib3VuY2UgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vZGVib3VuY2UnKSxcbiAgICBpc0FycmF5ICAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzQXJyYXknKSxcbiAgICBpc0Jvb2xlYW4gID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzQm9vbGVhbicpLFxuICAgIG1lcmdlICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9tZXJnZScpLFxuICAgIHVuc2V0ICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC91bnNldCcpLFxuICAgIHNpemUgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9zaXplJyksXG4gICAgdmFsdWVzICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L3ZhbHVlcycpLFxuICAgIGVzY2FwZUhUTUwgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9lc2NhcGVIdG1sJyksXG4gICAgdHJpbSAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBzbHVnaWZ5ICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvc2x1Z2lmeScpO1xuXG5cbnZhciBJU19NQUMgICAgICAgICAgICAgICAgPSAvTWFjLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLFxuICAgIElTX0lFICAgICAgICAgICAgICAgICA9IC9NU0lFIDkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpIHx8IC9NU0lFIDEwL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSB8fCAvcnY6MTEuMC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksXG4gICAgQ09VTlQgICAgICAgICAgICAgICAgID0gMCxcblxuICAgIEtFWV9BICAgICAgICAgICAgICAgICA9IDY1LFxuICAgIEtFWV9DT01NQSAgICAgICAgICAgICA9IDE4OCxcbiAgICBLRVlfUkVUVVJOICAgICAgICAgICAgPSAxMyxcbiAgICBLRVlfRVNDICAgICAgICAgICAgICAgPSAyNyxcbiAgICBLRVlfTEVGVCAgICAgICAgICAgICAgPSAzNyxcbiAgICBLRVlfVVAgICAgICAgICAgICAgICAgPSAzOCxcbiAgICBLRVlfUCAgICAgICAgICAgICAgICAgPSA4MCxcbiAgICBLRVlfUklHSFQgICAgICAgICAgICAgPSAzOSxcbiAgICBLRVlfRE9XTiAgICAgICAgICAgICAgPSA0MCxcbiAgICBLRVlfTiAgICAgICAgICAgICAgICAgPSA3OCxcbiAgICBLRVlfQkFDS1NQQUNFICAgICAgICAgPSA4LFxuICAgIEtFWV9ERUxFVEUgICAgICAgICAgICA9IDQ2LFxuICAgIEtFWV9TSElGVCAgICAgICAgICAgICA9IDE2LFxuICAgIEtFWV9DTUQgICAgICAgICAgICAgICA9IElTX01BQyA/IDkxIDogMTcsXG4gICAgS0VZX0NUUkwgICAgICAgICAgICAgID0gSVNfTUFDID8gMTggOiAxNyxcbiAgICBLRVlfVEFCICAgICAgICAgICAgICAgPSA5LFxuXG4gICAgVEFHX1NFTEVDVCAgICAgICAgICAgID0gMSxcbiAgICBUQUdfSU5QVVQgICAgICAgICAgICAgPSAyLFxuXG4gICAgLy8gZm9yIG5vdywgYW5kcm9pZCBzdXBwb3J0IGluIGdlbmVyYWwgaXMgdG9vIHNwb3R0eSB0byBzdXBwb3J0IHZhbGlkaXR5XG4gICAgU1VQUE9SVFNfVkFMSURJVFlfQVBJID0gIS9hbmRyb2lkL2kudGVzdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgISFkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJykudmFsaWRpdHk7XG5cbnZhciBoYXNoX2tleSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykgcmV0dXJuIHZhbHVlID8gJzEnIDogJzAnO1xuICAgIHJldHVybiB2YWx1ZSArICcnO1xufTtcblxudmFyIGlzc2V0ID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmplY3QgIT09ICd1bmRlZmluZWQnO1xufTtcblxudmFyIGVzY2FwZV9yZXBsYWNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgcmV0dXJuIChzdHIgKyAnJykucmVwbGFjZSgvXFwkL2csICckJCQkJyk7XG59O1xuXG52YXIgb25jZSA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgdmFyIGNhbGxlZCA9IGZhbHNlO1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNhbGxlZCkgcmV0dXJuO1xuICAgICAgICBjYWxsZWQgPSB0cnVlO1xuICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG59O1xuXG52YXIgZGVib3VuY2VfZXZlbnRzID0gZnVuY3Rpb24oc2VsZiwgdHlwZXMsIGZuKSB7XG4gICAgdmFyIHR5cGU7XG4gICAgdmFyIHRyaWdnZXIgPSBzZWxmLmVtaXQ7XG4gICAgdmFyIGV2ZW50X2FyZ3MgPSB7fTtcblxuICAgIC8vIG92ZXJyaWRlIHRyaWdnZXIgbWV0aG9kXG4gICAgc2VsZi5lbWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzWzBdO1xuICAgICAgICBpZiAodHlwZXMuaW5kZXhPZih0eXBlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGV2ZW50X2FyZ3NbdHlwZV0gPSBhcmd1bWVudHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpZ2dlci5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIGludm9rZSBwcm92aWRlZCBmdW5jdGlvblxuICAgIGZuLmFwcGx5KHNlbGYsIFtdKTtcbiAgICBzZWxmLmVtaXQgPSB0cmlnZ2VyO1xuXG4gICAgLy8gdHJpZ2dlciBxdWV1ZWQgZXZlbnRzXG4gICAgZm9yICh0eXBlIGluIGV2ZW50X2FyZ3MpIHtcbiAgICAgICAgaWYgKGV2ZW50X2FyZ3MuaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgICAgICAgIHRyaWdnZXIuYXBwbHkoc2VsZiwgZXZlbnRfYXJnc1t0eXBlXSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG52YXIgYnVpbGRfaGFzaF90YWJsZSA9IGZ1bmN0aW9uKGtleSwgb2JqZWN0cykge1xuICAgIGlmICghaXNBcnJheShvYmplY3RzKSkgcmV0dXJuIG9iamVjdHM7XG4gICAgdmFyIGksIG4sIHRhYmxlID0ge307XG4gICAgZm9yIChpID0gMCwgbiA9IG9iamVjdHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIGlmIChvYmplY3RzW2ldLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIHRhYmxlW29iamVjdHNbaV1ba2V5XV0gPSBvYmplY3RzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YWJsZTtcbn07XG5cbnZhciBkb21Ub1N0cmluZyA9IGZ1bmN0aW9uKGQpIHtcbiAgICB2YXIgdG1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdG1wLmFwcGVuZENoaWxkKGQuY2xvbmVOb2RlKHRydWUpKTtcbiAgICByZXR1cm4gdG1wLmlubmVySFRNTDtcbn07XG5cbnZhciBnZXRTZWxlY3Rpb24gPSBmdW5jdGlvbihpbnB1dCkge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAoJ3NlbGVjdGlvblN0YXJ0JyBpbiBpbnB1dCkge1xuICAgICAgICByZXN1bHQuc3RhcnQgPSBpbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgcmVzdWx0Lmxlbmd0aCA9IGlucHV0LnNlbGVjdGlvbkVuZCAtIHJlc3VsdC5zdGFydDtcbiAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB2YXIgc2VsID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIHZhciBzZWxMZW4gPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgc2VsLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgLWlucHV0LnZhbHVlLmxlbmd0aCk7XG4gICAgICAgIHJlc3VsdC5zdGFydCA9IHNlbC50ZXh0Lmxlbmd0aCAtIHNlbExlbjtcbiAgICAgICAgcmVzdWx0Lmxlbmd0aCA9IHNlbExlbjtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbnZhciB0cmFuc2ZlclN0eWxlcyA9IGZ1bmN0aW9uKCRmcm9tLCAkdG8sIHByb3BlcnRpZXMpIHtcbiAgICB2YXIgaSwgbiwgc3R5bGVzID0ge307XG4gICAgaWYgKHByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChpID0gMCwgbiA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBzdHlsZXNbcHJvcGVydGllc1tpXV0gPSAkZnJvbS5jb21wdXRlKHByb3BlcnRpZXNbaV0pO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGVzID0gJGZyb20uY29tcHV0ZSgpO1xuICAgIH1cbiAgICAkdG8uc3R5bGUoc3R5bGVzKTtcbn07XG5cbnZhciBtZWFzdXJlZCA9IG51bGw7XG52YXIgbWVhc3VyZVN0cmluZyA9IGZ1bmN0aW9uKHN0ciwgJHBhcmVudCkge1xuICAgIGlmICghc3RyKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIHZhciAkdGVzdDtcbiAgICBpZiAoIW1lYXN1cmVkKSB7XG4gICAgICAgICR0ZXN0ID0gemVuKCd0ZXN0Jykuc3R5bGUoe1xuICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICB0b3A6IC05OTk5OSxcbiAgICAgICAgICAgIGxlZnQ6IC05OTk5OSxcbiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgd2hpdGVTcGFjZTogJ3ByZSdcbiAgICAgICAgfSkudGV4dChzdHIpLmJvdHRvbSgnYm9keScpO1xuXG4gICAgICAgIHRyYW5zZmVyU3R5bGVzKCRwYXJlbnQsICR0ZXN0LCBbXG4gICAgICAgICAgICAnbGV0dGVyU3BhY2luZycsXG4gICAgICAgICAgICAnZm9udFNpemUnLFxuICAgICAgICAgICAgJ2ZvbnRGYW1pbHknLFxuICAgICAgICAgICAgJ2ZvbnRXZWlnaHQnLFxuICAgICAgICAgICAgJ3RleHRUcmFuc2Zvcm0nXG4gICAgICAgIF0pO1xuXG4gICAgICAgIG1lYXN1cmVkID0gJHRlc3Q7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJHRlc3QgPSBtZWFzdXJlZDtcbiAgICAgICAgJHRlc3QudGV4dChzdHIpO1xuICAgIH1cblxuICAgIC8vdmFyIHdpZHRoID0gJHRlc3RbMF0ub2Zmc2V0V2lkdGg7XG4gICAgLy8kdGVzdC5yZW1vdmUoKTtcblxuICAgIHJldHVybiAkdGVzdFswXS5vZmZzZXRXaWR0aDtcbn07XG5cbnZhciBoaWdobGlnaHQgPSBmdW5jdGlvbigkZWxlbWVudCwgcGF0dGVybikge1xuICAgIGlmICh0eXBlb2YgcGF0dGVybiA9PT0gJ3N0cmluZycgJiYgIXBhdHRlcm4ubGVuZ3RoKSByZXR1cm47XG4gICAgdmFyIHJlZ2V4ID0gKHR5cGVvZiBwYXR0ZXJuID09PSAnc3RyaW5nJykgPyBuZXcgUmVnRXhwKHBhdHRlcm4sICdpJykgOiBwYXR0ZXJuO1xuXG4gICAgdmFyIGhpZ2hsaWdodCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdmFyIHNraXAgPSAwO1xuICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgdmFyIHBvcyA9IG5vZGUuZGF0YS5zZWFyY2gocmVnZXgpO1xuICAgICAgICAgICAgaWYgKHBvcyA+PSAwICYmIG5vZGUuZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gbm9kZS5kYXRhLm1hdGNoKHJlZ2V4KTtcbiAgICAgICAgICAgICAgICB2YXIgc3Bhbm5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICAgICAgc3Bhbm5vZGUuY2xhc3NOYW1lID0gJ2ctaGlnaGxpZ2h0JztcbiAgICAgICAgICAgICAgICB2YXIgbWlkZGxlYml0ID0gbm9kZS5zcGxpdFRleHQocG9zKTtcbiAgICAgICAgICAgICAgICB2YXIgZW5kYml0ID0gbWlkZGxlYml0LnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHZhciBtaWRkbGVjbG9uZSA9IG1pZGRsZWJpdC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgc3Bhbm5vZGUuYXBwZW5kQ2hpbGQobWlkZGxlY2xvbmUpO1xuICAgICAgICAgICAgICAgIG1pZGRsZWJpdC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChzcGFubm9kZSwgbWlkZGxlYml0KTtcbiAgICAgICAgICAgICAgICBza2lwID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIG5vZGUuY2hpbGROb2RlcyAmJiAhLyhzY3JpcHR8c3R5bGUpL2kudGVzdChub2RlLnRhZ05hbWUpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGkgKz0gaGlnaGxpZ2h0KG5vZGUuY2hpbGROb2Rlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNraXA7XG4gICAgfTtcblxuICAgIHJldHVybiBmb3JFYWNoKCRlbGVtZW50LCBmdW5jdGlvbihlbCkge1xuICAgICAgICBoaWdobGlnaHQoZWwpO1xuICAgIH0pO1xufTtcblxudmFyIGF1dG9Hcm93ID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICBpbnB1dCA9ICQoaW5wdXQpO1xuICAgIHZhciBjdXJyZW50V2lkdGggPSBudWxsO1xuXG4gICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKG9wdGlvbnMsIGUpIHtcbiAgICAgICAgdmFyIHZhbHVlLCBrZXlDb2RlLCBwcmludGFibGUsIHBsYWNlaG9sZGVyLCB3aWR0aDtcbiAgICAgICAgdmFyIHNoaWZ0LCBjaGFyYWN0ZXIsIHNlbGVjdGlvbjtcbiAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50IHx8IHt9O1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICBpZiAoZS5tZXRhS2V5IHx8IGUuYWx0S2V5KSByZXR1cm47XG4gICAgICAgIGlmICghb3B0aW9ucy5mb3JjZSAmJiBpbnB1dC5zZWxlY3RpemVHcm93ID09PSBmYWxzZSkgcmV0dXJuO1xuXG4gICAgICAgIHZhbHVlID0gaW5wdXQudmFsdWUoKTtcbiAgICAgICAgaWYgKGUudHlwZSAmJiBlLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2tleWRvd24nKSB7XG4gICAgICAgICAgICBrZXlDb2RlID0gZS5rZXlDb2RlO1xuICAgICAgICAgICAgcHJpbnRhYmxlID0gKFxuICAgICAgICAgICAgICAgIChrZXlDb2RlID49IDk3ICYmIGtleUNvZGUgPD0gMTIyKSB8fCAvLyBhLXpcbiAgICAgICAgICAgICAgICAoa2V5Q29kZSA+PSA2NSAmJiBrZXlDb2RlIDw9IDkwKSB8fCAvLyBBLVpcbiAgICAgICAgICAgICAgICAoa2V5Q29kZSA+PSA0OCAmJiBrZXlDb2RlIDw9IDU3KSB8fCAvLyAwLTlcbiAgICAgICAgICAgICAgICBrZXlDb2RlID09PSAzMiAvLyBzcGFjZVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IEtFWV9ERUxFVEUgfHwga2V5Q29kZSA9PT0gS0VZX0JBQ0tTUEFDRSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbiA9IGdldFNlbGVjdGlvbihpbnB1dFswXSk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgc2VsZWN0aW9uLnN0YXJ0KSArIHZhbHVlLnN1YnN0cmluZyhzZWxlY3Rpb24uc3RhcnQgKyBzZWxlY3Rpb24ubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IEtFWV9CQUNLU1BBQ0UgJiYgc2VsZWN0aW9uLnN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDAsIHNlbGVjdGlvbi5zdGFydCAtIDEpICsgdmFsdWUuc3Vic3RyaW5nKHNlbGVjdGlvbi5zdGFydCArIDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gS0VZX0RFTEVURSAmJiB0eXBlb2Ygc2VsZWN0aW9uLnN0YXJ0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cmluZygwLCBzZWxlY3Rpb24uc3RhcnQpICsgdmFsdWUuc3Vic3RyaW5nKHNlbGVjdGlvbi5zdGFydCArIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpbnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgc2hpZnQgPSBlLnNoaWZ0S2V5O1xuICAgICAgICAgICAgICAgIGNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoc2hpZnQpIGNoYXJhY3RlciA9IGNoYXJhY3Rlci50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGVsc2UgY2hhcmFjdGVyID0gY2hhcmFjdGVyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFsdWUgKz0gY2hhcmFjdGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcGxhY2Vob2xkZXIgPSBpbnB1dC5hdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJyk7XG4gICAgICAgIGlmICghdmFsdWUgJiYgcGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgIHZhbHVlID0gcGxhY2Vob2xkZXI7XG4gICAgICAgIH1cblxuICAgICAgICB3aWR0aCA9IG1lYXN1cmVTdHJpbmcodmFsdWUsIGlucHV0KSArIDQ7XG4gICAgICAgIGlmICh3aWR0aCAhPT0gY3VycmVudFdpZHRoKSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIGlucHV0WzBdLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnO1xuICAgICAgICAgICAgaW5wdXQuZW1pdCgncmVzaXplJyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgaW5wdXQub24oJ2tleWRvd24nLCB1cGRhdGUpO1xuICAgIGlucHV0Lm9uKCdrZXl1cCcsIHVwZGF0ZSk7XG4gICAgaW5wdXQub24oJ3VwZGF0ZScsIHVwZGF0ZSk7XG4gICAgaW5wdXQub24oJ2JsdXInLCB1cGRhdGUpO1xuXG4gICAgdXBkYXRlKCk7XG59O1xuXG52YXIgU2VsZWN0aXplID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBvcHRpb25zOiB7XG4gICAgICAgIGRlbGltaXRlcjogJyAnLFxuICAgICAgICBzcGxpdE9uOiBudWxsLCAvLyByZWdleHAgb3Igc3RyaW5nIGZvciBzcGxpdHRpbmcgdXAgdmFsdWVzIGZyb20gYSBwYXN0ZSBjb21tYW5kXG4gICAgICAgIHBlcnNpc3Q6IHRydWUsXG4gICAgICAgIGRpYWNyaXRpY3M6IHRydWUsXG4gICAgICAgIGNyZWF0ZTogZmFsc2UsXG4gICAgICAgIGNyZWF0ZU9uQmx1cjogdHJ1ZSxcbiAgICAgICAgY3JlYXRlRmlsdGVyOiBudWxsLFxuICAgICAgICBoaWdobGlnaHQ6IHRydWUsXG4gICAgICAgIG9wZW5PbkZvY3VzOiB0cnVlLFxuICAgICAgICBtYXhPcHRpb25zOiAxMDAwLFxuICAgICAgICBtYXhJdGVtczogbnVsbCxcbiAgICAgICAgaGlkZVNlbGVjdGVkOiBudWxsLFxuICAgICAgICBhZGRQcmVjZWRlbmNlOiBmYWxzZSxcbiAgICAgICAgc2VsZWN0T25UYWI6IGZhbHNlLFxuICAgICAgICBwcmVsb2FkOiBmYWxzZSxcbiAgICAgICAgYWxsb3dFbXB0eU9wdGlvbjogZmFsc2UsXG4gICAgICAgIGNsb3NlQWZ0ZXJTZWxlY3Q6IGZhbHNlLFxuICAgICAgICBzZWFyY2hPbktleXByZXNzOiB0cnVlLFxuXG4gICAgICAgIHNjcm9sbER1cmF0aW9uOiA2MCxcbiAgICAgICAgbG9hZFRocm90dGxlOiAzMDAsXG4gICAgICAgIGxvYWRpbmdDbGFzczogJ2ctbG9hZGluZycsXG5cbiAgICAgICAgZGF0YUF0dHI6ICdkYXRhLWRhdGEnLFxuICAgICAgICBvcHRncm91cEZpZWxkOiAnb3B0Z3JvdXAnLFxuICAgICAgICB2YWx1ZUZpZWxkOiAndmFsdWUnLFxuICAgICAgICBsYWJlbEZpZWxkOiAndGV4dCcsXG4gICAgICAgIG9wdGdyb3VwTGFiZWxGaWVsZDogJ2xhYmVsJyxcbiAgICAgICAgb3B0Z3JvdXBWYWx1ZUZpZWxkOiAndmFsdWUnLFxuICAgICAgICBsb2NrT3B0Z3JvdXBPcmRlcjogZmFsc2UsXG5cbiAgICAgICAgc29ydEZpZWxkOiAnJG9yZGVyJyxcbiAgICAgICAgc2VhcmNoRmllbGQ6IFsndGV4dCddLFxuICAgICAgICBzZWFyY2hDb25qdW5jdGlvbjogJ2FuZCcsXG5cbiAgICAgICAgbW9kZTogbnVsbCxcbiAgICAgICAgd3JhcHBlckNsYXNzOiAnZy1zZWxlY3RpemUtY29udHJvbCcsXG4gICAgICAgIGlucHV0Q2xhc3M6ICdnLXNlbGVjdGl6ZS1pbnB1dCcsXG4gICAgICAgIGRyb3Bkb3duQ2xhc3M6ICdnLXNlbGVjdGl6ZS1kcm9wZG93bicsXG4gICAgICAgIGRyb3Bkb3duQ29udGVudENsYXNzOiAnZy1zZWxlY3RpemUtZHJvcGRvd24tY29udGVudCcsXG5cbiAgICAgICAgZHJvcGRvd25QYXJlbnQ6IG51bGwsXG5cbiAgICAgICAgY29weUNsYXNzZXNUb0Ryb3Bkb3duOiB0cnVlLFxuXG4gICAgICAgIC8qXG4gICAgICAgICBsb2FkICAgICAgICAgICAgOiBudWxsLCAvLyBmdW5jdGlvbihxdWVyeSwgY2FsbGJhY2spIHsgLi4uIH1cbiAgICAgICAgIHNjb3JlICAgICAgICAgICA6IG51bGwsIC8vIGZ1bmN0aW9uKHNlYXJjaCkgeyAuLi4gfVxuICAgICAgICAgb25Jbml0aWFsaXplICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7IC4uLiB9XG4gICAgICAgICBvbkNoYW5nZSAgICAgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSkgeyAuLi4gfVxuICAgICAgICAgb25JdGVtQWRkICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24odmFsdWUsICRpdGVtKSB7IC4uLiB9XG4gICAgICAgICBvbkl0ZW1SZW1vdmUgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSkgeyAuLi4gfVxuICAgICAgICAgb25DbGVhciAgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7IC4uLiB9XG4gICAgICAgICBvbk9wdGlvbkFkZCAgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSwgZGF0YSkgeyAuLi4gfVxuICAgICAgICAgb25PcHRpb25SZW1vdmUgIDogbnVsbCwgLy8gZnVuY3Rpb24odmFsdWUpIHsgLi4uIH1cbiAgICAgICAgIG9uT3B0aW9uQ2xlYXIgICA6IG51bGwsIC8vIGZ1bmN0aW9uKCkgeyAuLi4gfVxuICAgICAgICAgb25PcHRpb25Hcm91cEFkZCAgICAgOiBudWxsLCAvLyBmdW5jdGlvbihpZCwgZGF0YSkgeyAuLi4gfVxuICAgICAgICAgb25PcHRpb25Hcm91cFJlbW92ZSAgOiBudWxsLCAvLyBmdW5jdGlvbihpZCkgeyAuLi4gfVxuICAgICAgICAgb25PcHRpb25Hcm91cENsZWFyICAgOiBudWxsLCAvLyBmdW5jdGlvbigpIHsgLi4uIH1cbiAgICAgICAgIG9uRHJvcGRvd25PcGVuICA6IG51bGwsIC8vIGZ1bmN0aW9uKCRkcm9wZG93bikgeyAuLi4gfVxuICAgICAgICAgb25Ecm9wZG93bkNsb3NlIDogbnVsbCwgLy8gZnVuY3Rpb24oJGRyb3Bkb3duKSB7IC4uLiB9XG4gICAgICAgICBvblR5cGUgICAgICAgICAgOiBudWxsLCAvLyBmdW5jdGlvbihzdHIpIHsgLi4uIH1cbiAgICAgICAgIG9uRGVsZXRlICAgICAgICA6IG51bGwsIC8vIGZ1bmN0aW9uKHZhbHVlcykgeyAuLi4gfVxuICAgICAgICAgKi9cblxuICAgICAgICByZW5kZXI6IHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgaXRlbTogbnVsbCxcbiAgICAgICAgICAgICBvcHRncm91cDogbnVsbCxcbiAgICAgICAgICAgICBvcHRncm91cF9oZWFkZXI6IG51bGwsXG4gICAgICAgICAgICAgb3B0aW9uOiBudWxsLFxuICAgICAgICAgICAgIG9wdGlvbl9jcmVhdGU6IG51bGxcbiAgICAgICAgICAgICAqL1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihpbnB1dCwgb3B0aW9ucykge1xuICAgICAgICBpbnB1dCA9ICQoaW5wdXQpO1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgLy8gZGV0ZWN0IHJ0bCBlbnZpcm9ubWVudFxuICAgICAgICB2YXIgY29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGlucHV0WzBdLCBudWxsKTtcbiAgICAgICAgdmFyIGRpciA9IGNvbXB1dGVkU3R5bGUgPyBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ2RpcmVjdGlvbicpIDogaW5wdXRbMF0uY3VycmVudFN0eWxlICYmIGlucHV0WzBdLmN1cnJlbnRTdHlsZS5kaXJlY3Rpb247XG4gICAgICAgIGRpciA9IGRpciB8fCBpbnB1dC5wYXJlbnRzKCdbZGlyXTpmaXJzdCcpLmF0dHIoJ2RpcicpIHx8ICcnO1xuXG4gICAgICAgIHRoaXMucmFuZCA9ICdzZWxlY3RpemUtaWQtJyArIChNYXRoLnJhbmRvbSgpICsgMSkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg1KTtcbiAgICAgICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgICAgICB0aGlzLmlucHV0LnNlbGVjdGl6ZUluc3RhbmNlID0gdGhpcztcblxuICAgICAgICB0aGlzLm9yZGVyID0gMDtcbiAgICAgICAgdGhpcy50YWJJbmRleCA9IGlucHV0LmF0dHJpYnV0ZSgndGFiaW5kZXgnKSB8fCAnJztcbiAgICAgICAgdGhpcy50YWdUeXBlID0gaW5wdXQudGFnKCkgPT0gJ3NlbGVjdCcgPyBUQUdfU0VMRUNUIDogVEFHX0lOUFVUO1xuICAgICAgICB0aGlzLnJ0bCA9IC9ydGwvaS50ZXN0KGRpcik7XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRWYWx1ZSA9IG51bGw7XG4gICAgICAgIHRoaXMuaXNSZXF1aXJlZCA9IGlucHV0LmF0dHJpYnV0ZSgncmVxdWlyZWQnKTtcbiAgICAgICAgZm9yRWFjaChbJ2lzT3BlbicsICdpc0Rpc2FibGVkJywgICdpc0ludmFsaWQnLCAnaXNMb2NrZWQnLCAnaXNGb2N1c2VkJywgJ2lzSW5wdXRIaWRkZW4nLCAnaXNTZXR1cCcsICdpc1NoaWZ0RG93bicsICdpc0NtZERvd24nLCAnaXNDdHJsRG93bicsICdpZ25vcmVGb2N1cycsICdpZ25vcmVCbHVyJywgJ2lnbm9yZUhvdmVyJywgJ2hhc09wdGlvbnMnXSwgZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgICAgICAgICB0aGlzW29wdGlvbl0gPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHRoaXMuY3VycmVudFJlc3VsdHMgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9ICcnO1xuICAgICAgICB0aGlzLmNhcmV0UG9zID0gMDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gMDtcbiAgICAgICAgdGhpcy5sb2FkZWRTZWFyY2hlcyA9IHt9O1xuXG4gICAgICAgIHRoaXMuJGFjdGl2ZU9wdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zID0gW107XG5cbiAgICAgICAgdGhpcy5PcHRncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy5PcHRpb25zID0ge307XG4gICAgICAgIHRoaXMuVXNlck9wdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnJlbmRlckNhY2hlID0ge307XG4gICAgICAgIHRoaXMub25TZWFyY2hDaGFuZ2UgPSB0aGlzLm9wdGlvbnMubG9hZFRocm90dGxlID09PSBudWxsID8gdGhpcy5vblNlYXJjaENoYW5nZSA6IGRlYm91bmNlKHRoaXMub25TZWFyY2hDaGFuZ2UsIHRoaXMub3B0aW9ucy5sb2FkVGhyb3R0bGUpO1xuXG4gICAgICAgIC8vIHNlYXJjaCBzeXN0ZW1cbiAgICAgICAgdGhpcy5zaWZ0ZXIgPSBuZXcgc2lmdGVyKHRoaXMuT3B0aW9ucywgeyBkaWFjcml0aWNzOiB0aGlzLm9wdGlvbnMuZGlhY3JpdGljcyB9KTtcblxuICAgICAgICB2YXIgaSwgbjtcblxuICAgICAgICAvLyBidWlsZCBvcHRpb25zIHRhYmxlXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuT3B0aW9ucykge1xuICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IHRoaXMub3B0aW9ucy5PcHRpb25zLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJPcHRpb24odGhpcy5vcHRpb25zLk9wdGlvbnNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy5PcHRpb25zO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYnVpbGQgb3B0Z3JvdXAgdGFibGVcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5PcHRncm91cHMpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSB0aGlzLm9wdGlvbnMuT3B0Z3JvdXBzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJPcHRpb25Hcm91cCh0aGlzLm9wdGlvbnMuT3B0Z3JvdXBzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuT3B0Z3JvdXBzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gb3B0aW9uLWRlbWFuZCBkZWZhdWx0c1xuICAgICAgICB0aGlzLm9wdGlvbnMubW9kZSA9IHRoaXMub3B0aW9ucy5tb2RlIHx8ICh0aGlzLm9wdGlvbnMubWF4SXRlbXMgPT09IDEgPyAnc2luZ2xlJyA6ICdtdWx0aScpO1xuICAgICAgICBpZiAoIWlzQm9vbGVhbih0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkKSkgeyB0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkID0gKHRoaXMub3B0aW9ucy5tb2RlID09PSAnbXVsdGknKTsgfVxuXG4gICAgICAgIHRoaXMuc2V0dXBDYWxsYmFja3MoKTtcbiAgICAgICAgdGhpcy5zZXR1cFRlbXBsYXRlcygpO1xuICAgICAgICB0aGlzLnNldHVwKCk7XG5cbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJGlucHV0ID0gdGhpcy5pbnB1dCxcbiAgICAgICAgICAgICR3cmFwcGVyLFxuICAgICAgICAgICAgJGNvbnRyb2wsXG4gICAgICAgICAgICAkY29udHJvbF9pbnB1dCxcbiAgICAgICAgICAgICRkcm9wZG93bixcbiAgICAgICAgICAgICRkcm9wZG93bl9jb250ZW50LFxuICAgICAgICAgICAgJGRyb3Bkb3duX3BhcmVudCxcbiAgICAgICAgICAgIGlucHV0TW9kZSxcbiAgICAgICAgICAgIHRpbWVvdXRfYmx1cixcbiAgICAgICAgICAgIHRpbWVvdXRfZm9jdXMsXG4gICAgICAgICAgICBjbGFzc2VzO1xuXG4gICAgICAgIGlucHV0TW9kZSA9IHRoaXMub3B0aW9ucy5tb2RlO1xuICAgICAgICBjbGFzc2VzID0gJGlucHV0LmF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJztcblxuICAgICAgICAkd3JhcHBlciA9IHplbignZGl2JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLndyYXBwZXJDbGFzcykuYWRkQ2xhc3MoY2xhc3NlcykuYWRkQ2xhc3MoJ2ctJyArIGlucHV0TW9kZSkuYWZ0ZXIodGhpcy5pbnB1dCk7XG4gICAgICAgICRjb250cm9sID0gemVuKCdkaXYnKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuaW5wdXRDbGFzcykuYWRkQ2xhc3MoJ2ctaXRlbXMnKS5ib3R0b20oJHdyYXBwZXIpO1xuICAgICAgICAkY29udHJvbF9pbnB1dCA9IHplbignaW5wdXRbdHlwZT1cInRleHRcIl1bYXV0b2NvbXBsZXRlPVwib2ZmXCJdW3JvbGU9XCJ0ZXh0Ym94XCJdJykuYm90dG9tKCRjb250cm9sKS5hdHRyaWJ1dGUoJ3RhYmluZGV4JywgJGlucHV0LmRpc2FibGVkKCkgPyAnLTEnIDogdGhpcy50YWJJbmRleCk7XG4gICAgICAgICRkcm9wZG93bl9wYXJlbnQgPSAkKHRoaXMub3B0aW9ucy5kcm9wZG93blBhcmVudCB8fCAkd3JhcHBlcik7XG4gICAgICAgICRkcm9wZG93biA9IHplbignZGl2JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmRyb3Bkb3duQ2xhc3MpLmFkZENsYXNzKCdnLScgKyBpbnB1dE1vZGUpLmhpZGUoKS5ib3R0b20oJGRyb3Bkb3duX3BhcmVudCk7XG4gICAgICAgICRkcm9wZG93bl9jb250ZW50ID0gemVuKCdkaXZbaWQ9XCInICsgdGhpcy5yYW5kICsgJ1wiXScpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5kcm9wZG93bkNvbnRlbnRDbGFzcykuYm90dG9tKCRkcm9wZG93bik7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb3B5Q2xhc3Nlc1RvRHJvcGRvd24pIHtcbiAgICAgICAgICAgICRkcm9wZG93bi5hZGRDbGFzcyhjbGFzc2VzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbnB1dE1vZGUgPT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgICR3cmFwcGVyLnN0eWxlKCd3aWR0aCcsIHBhcnNlSW50KCRpbnB1dFswXS5vZmZzZXRXaWR0aCkgKyAxMiArIDI0KTsgLy8gcGFkZGluZyBjb21wZW5zYXRpb25cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5vcHRpb25zLm1heEl0ZW1zID09PSBudWxsIHx8IHRoaXMub3B0aW9ucy5tYXhJdGVtcyA+IDEpICYmIHRoaXMudGFnVHlwZSA9PT0gVEFHX1NFTEVDVCkge1xuICAgICAgICAgICAgJGlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnLCAnbXVsdGlwbGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgc3BsaXRPbiB3YXMgbm90IHBhc3NlZCBpbiwgY29uc3RydWN0IGl0IGZyb20gdGhlIGRlbGltaXRlciB0byBhbGxvdyBwYXN0aW5nIHVuaXZlcnNhbGx5XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnNwbGl0T24gJiYgdGhpcy5vcHRpb25zLmRlbGltaXRlcikge1xuICAgICAgICAgICAgdmFyIGRlbGltaXRlckVzY2FwZWQgPSB0aGlzLm9wdGlvbnMuZGVsaW1pdGVyLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZywgJ1xcXFwkJicpO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNwbGl0T24gPSBuZXcgUmVnRXhwKCdcXFxccyonICsgZGVsaW1pdGVyRXNjYXBlZCArICcrXFxcXHMqJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJGlucHV0LmF0dHJpYnV0ZSgnYXV0b2NvcnJlY3QnKSkge1xuICAgICAgICAgICAgJGNvbnRyb2xfaW5wdXQuYXR0cmlidXRlKCdhdXRvY29ycmVjdCcsICRpbnB1dC5hdHRyaWJ1dGUoJ2F1dG9jb3JyZWN0JykpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCRpbnB1dC5hdHRyaWJ1dGUoJ2F1dG9jYXBpdGFsaXplJykpIHtcbiAgICAgICAgICAgICRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgnYXV0b2NhcGl0YWxpemUnLCAkaW5wdXQuYXR0cmlidXRlKCdhdXRvY2FwaXRhbGl6ZScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJHdyYXBwZXIgPSAkd3JhcHBlcjtcbiAgICAgICAgdGhpcy4kY29udHJvbCA9ICRjb250cm9sO1xuICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0ID0gJGNvbnRyb2xfaW5wdXQ7XG4gICAgICAgIHRoaXMuJGRyb3Bkb3duID0gJGRyb3Bkb3duO1xuICAgICAgICB0aGlzLiRkcm9wZG93bl9jb250ZW50ID0gJGRyb3Bkb3duX2NvbnRlbnQ7XG5cbiAgICAgICAgJGRyb3Bkb3duLmRlbGVnYXRlKCdtb3VzZW92ZXInLCAnW2RhdGEtc2VsZWN0YWJsZV0nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbk9wdGlvbkhvdmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGRyb3Bkb3duLmRlbGVnYXRlKCdtb3VzZWRvd24nLCAnW2RhdGEtc2VsZWN0YWJsZV0nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbk9wdGlvblNlbGVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG4gICAgICAgICRkcm9wZG93bi5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtc2VsZWN0YWJsZV0nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbk9wdGlvblNlbGVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG5cbiAgICAgICAgYXV0b0dyb3coJGNvbnRyb2xfaW5wdXQpO1xuXG4gICAgICAgICRjb250cm9sLmRlbGVnYXRlKCdtb3VzZWRvd24nLCAnKjpub3QoaW5wdXQpJywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gJGNvbnRyb2wpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uSXRlbVNlbGVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgJGNvbnRyb2wub24oJ21vdXNlZG93bicsIGJpbmQoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm9uTW91c2VEb3duLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGNvbnRyb2wub24oJ2NsaWNrJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25DbGljay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sLmRlbGVnYXRlKCdjbGljaycsICcuZy1yZW1vdmUtc2luZ2xlLWl0ZW0nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbkl0ZW1SZW1vdmVWaWFYLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcblxuICAgICAgICAkY29udHJvbF9pbnB1dC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9KTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2tleWRvd24nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbktleURvd24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuICAgICAgICAkY29udHJvbF9pbnB1dC5vbigna2V5dXAnLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbktleVVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2tleXByZXNzJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25LZXlQcmVzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdyZXNpemUnLCBiaW5kKGZ1bmN0aW9uKCkgeyB0aGlzLnBvc2l0aW9uRHJvcGRvd24uYXBwbHkodGhpcywgW10pOyB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdibHVyJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25CbHVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2ZvY3VzJywgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaWdub3JlQmx1ciA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25Gb2N1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdwYXN0ZScsIGJpbmQoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm9uUGFzdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgYmluZChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmlzQ21kRG93biA9IGVbSVNfTUFDID8gJ21ldGFLZXknIDogJ2N0cmxLZXknXTtcbiAgICAgICAgICAgIHRoaXMuaXNDdHJsRG93biA9IGVbSVNfTUFDID8gJ2FsdEtleScgOiAnY3RybEtleSddO1xuICAgICAgICAgICAgdGhpcy5pc1NoaWZ0RG93biA9IGUuc2hpZnRLZXk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5dXAnLCBiaW5kKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWV9DVFJMKSB0aGlzLmlzQ3RybERvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWV9TSElGVCkgdGhpcy5pc1NoaWZ0RG93biA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS0VZX0NNRCkgdGhpcy5pc0NtZERvd24gPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZWRvd24nLCBiaW5kKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgZXZlbnRzIG9uIHRoZSBkcm9wZG93biBzY3JvbGxiYXIgZnJvbSBjYXVzaW5nIHRoZSBjb250cm9sIHRvIGJsdXJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuJGRyb3Bkb3duWzBdIHx8IGUudGFyZ2V0LnBhcmVudE5vZGUgPT09IHRoaXMuJGRyb3Bkb3duWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBibHVyIG9uIGNsaWNrIG91dHNpZGVcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGNvbnRyb2wuZmluZCgkKGUudGFyZ2V0KSkgJiYgZS50YXJnZXQgIT09IHRoaXMuJGNvbnRyb2xbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVyKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uRHJvcGRvd24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcykpO1xuICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uRHJvcGRvd24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcykpO1xuICAgICAgICAkKHdpbmRvdykub24oJ21vdXNlbW92ZScsIGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmlnbm9yZUhvdmVyID0gZmFsc2U7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAvLyBzdG9yZSBvcmlnaW5hbCBjaGlsZHJlbiBhbmQgdGFiIGluZGV4IHNvIHRoYXQgdGhleSBjYW4gYmVcbiAgICAgICAgLy8gcmVzdG9yZWQgd2hlbiB0aGUgZGVzdHJveSgpIG1ldGhvZCBpcyBjYWxsZWQuXG4gICAgICAgIHRoaXMucmV2ZXJ0U2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAkY2hpbGRyZW46IHRoaXMuaW5wdXQuY2hpbGRyZW4oKSwvLy5kZXRhY2goKSxcbiAgICAgICAgICAgIHRhYmluZGV4OiB0aGlzLmlucHV0LmF0dHJpYnV0ZSgndGFiaW5kZXgnKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuaW5wdXQuYXR0cmlidXRlKCd0YWJpbmRleCcsIC0xKS5hdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSkuaGlkZSgpLmFmdGVyKCR3cmFwcGVyKTtcblxuICAgICAgICBpZiAoaXNBcnJheSh0aGlzLm9wdGlvbnMuaXRlbXMpKSB7XG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHRoaXMub3B0aW9ucy5pdGVtcyk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLml0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmVhdHVyZSBkZXRlY3QgZm9yIHRoZSB2YWxpZGF0aW9uIEFQSVxuICAgICAgICBpZiAoU1VQUE9SVFNfVkFMSURJVFlfQVBJKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0Lm9uKCdpbnZhbGlkJywgYmluZChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNJbnZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51cGRhdGVPcmlnaW5hbElucHV0KCk7XG4gICAgICAgIHRoaXMucmVmcmVzaEl0ZW1zKCk7XG4gICAgICAgIHRoaXMucmVmcmVzaFN0YXRlKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUGxhY2Vob2xkZXIoKTtcbiAgICAgICAgdGhpcy5pc1NldHVwID0gdHJ1ZTtcblxuICAgICAgICBpZiAodGhpcy5pbnB1dC5kaXNhYmxlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ2NoYW5nZScsIHRoaXMub25DaGFuZ2UpO1xuXG4gICAgICAgIHRoaXMuaW5wdXQuc2VsZWN0aXplSW5zdGFuY2UgPSB0aGlzO1xuICAgICAgICB0aGlzLmlucHV0LmFkZENsYXNzKCdzZWxlY3RpemVkJyk7XG4gICAgICAgIHRoaXMuZW1pdCgnaW5pdGlhbGl6ZScpO1xuXG4gICAgICAgIC8vIHByZWxvYWQgb3B0aW9uc1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnByZWxvYWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMub25TZWFyY2hDaGFuZ2UoJycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFSSUFcbiAgICAgICAgJHdyYXBwZXJcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ3JvbGUnLCAnY29tYm9ib3gnKVxuICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1hdXRvY29tcGxldGUnLCAnbGlzdCcpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLWhhc3BvcHVwJywgdHJ1ZSlcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSlcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScsIHRoaXMucmFuZCArICctJyArIHNsdWdpZnkodGhpcy5nZXRWYWx1ZSgpKSk7XG5cbiAgICAgICAgJGRyb3Bkb3duX2NvbnRlbnRcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ3JvbGUnLCAndHJlZScpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpXG4gICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuXG5cbiAgICB9LFxuXG4gICAgc2V0dXBUZW1wbGF0ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZmllbGRfbGFiZWwgICAgPSB0aGlzLm9wdGlvbnMubGFiZWxGaWVsZCxcbiAgICAgICAgICAgIGZpZWxkX3ZhbHVlICAgID0gdGhpcy5vcHRpb25zLnZhbHVlRmllbGQsXG4gICAgICAgICAgICBmaWVsZF9vcHRncm91cCA9IHRoaXMub3B0aW9ucy5vcHRncm91cExhYmVsRmllbGQsXG4gICAgICAgICAgICBtb2RlICAgICAgICAgICA9IHRoaXMub3B0aW9ucy5tb2RlO1xuXG4gICAgICAgIHZhciB0ZW1wbGF0ZXMgPSB7XG4gICAgICAgICAgICAnb3B0Z3JvdXAnOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiZy1vcHRncm91cFwiPicgKyBkYXRhLmh0bWwgKyAnPC9kaXY+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnb3B0Z3JvdXBfaGVhZGVyJzogZnVuY3Rpb24oZGF0YSwgZXNjYXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiZy1vcHRncm91cC1oZWFkZXJcIj4nICsgZXNjYXBlKGRhdGFbZmllbGRfb3B0Z3JvdXBdKSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdvcHRpb24nOiBmdW5jdGlvbihkYXRhLCBlc2NhcGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSAnPGRpdiBjbGFzcz1cImctb3B0aW9uXCI+JyArIGVzY2FwZShkYXRhW2ZpZWxkX2xhYmVsXSkgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLlN1YnRpdGxlcykge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICc8ZGl2IGNsYXNzPVwiZy1vcHRpb25cIj48c3Bhbj4nICsgZXNjYXBlKGRhdGFbZmllbGRfbGFiZWxdKSArICc8L3NwYW4+IDxkaXYgY2xhc3M9XCJnLW9wdGlvbi1zdWJ0aXRsZVwiPjxzbWFsbD4nICsgZXNjYXBlKGRhdGFbZmllbGRfdmFsdWVdKSArICc8L3NtYWxsPjwvZGl2PjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBsYWJlbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnaXRlbSc6IGZ1bmN0aW9uKGRhdGEsIGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHZhciByZW1vdmVCdXR0b24gPSAnJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSBlc2NhcGUoZGF0YVtmaWVsZF92YWx1ZV0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1vZGUgIT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUJ1dHRvbiA9ICc8c3BhbiAgY2xhc3M9XCJnLXJlbW92ZS1zaW5nbGUtaXRlbVwiIHRhYmluZGV4PVwiLTFcIiB0aXRsZT1cIlJlbW92ZVwiPiZ0aW1lczs8L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLlN1YnRpdGxlcykge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICdjbGFzcyBuYW1lOiAnICsgdGl0bGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiZy1pdGVtXCIgdGl0bGU9XCInICsgdGl0bGUgKyAnXCI+JyArIGVzY2FwZShkYXRhW2ZpZWxkX2xhYmVsXSkgKyByZW1vdmVCdXR0b247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ29wdGlvbl9jcmVhdGUnOiBmdW5jdGlvbihkYXRhLCBlc2NhcGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJnLWNyZWF0ZVwiPkFkZCA8c3Ryb25nPicgKyBlc2NhcGUoZGF0YS5pbnB1dCkgKyAnPC9zdHJvbmc+JmhlbGxpcDs8L2Rpdj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXIgPSBtZXJnZSh7fSwgdGVtcGxhdGVzLCB0aGlzLm9wdGlvbnMucmVuZGVyKTtcbiAgICB9LFxuXG4gICAgc2V0dXBDYWxsYmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5LCBmbiwgY2FsbGJhY2tzID0ge1xuICAgICAgICAgICAgJ2luaXRpYWxpemUnOiAnb25Jbml0aWFsaXplJyxcbiAgICAgICAgICAgICdjaGFuZ2UnOiAnb25DaGFuZ2UnLFxuICAgICAgICAgICAgJ2l0ZW1fYWRkJzogJ29uSXRlbUFkZCcsXG4gICAgICAgICAgICAnaXRlbV9yZW1vdmUnOiAnb25JdGVtUmVtb3ZlJyxcbiAgICAgICAgICAgICdjbGVhcic6ICdvbkNsZWFyJyxcbiAgICAgICAgICAgICdvcHRpb25fYWRkJzogJ29uT3B0aW9uQWRkJyxcbiAgICAgICAgICAgICdvcHRpb25fcmVtb3ZlJzogJ29uT3B0aW9uUmVtb3ZlJyxcbiAgICAgICAgICAgICdvcHRpb25fY2xlYXInOiAnb25PcHRpb25DbGVhcicsXG4gICAgICAgICAgICAnb3B0Z3JvdXBfYWRkJzogJ29uT3B0aW9uR3JvdXBBZGQnLFxuICAgICAgICAgICAgJ29wdGdyb3VwX3JlbW92ZSc6ICdvbk9wdGlvbkdyb3VwUmVtb3ZlJyxcbiAgICAgICAgICAgICdvcHRncm91cF9jbGVhcic6ICdvbk9wdGlvbkdyb3VwQ2xlYXInLFxuICAgICAgICAgICAgJ2Ryb3Bkb3duX29wZW4nOiAnb25Ecm9wZG93bk9wZW4nLFxuICAgICAgICAgICAgJ2Ryb3Bkb3duX2Nsb3NlJzogJ29uRHJvcGRvd25DbG9zZScsXG4gICAgICAgICAgICAndHlwZSc6ICdvblR5cGUnLFxuICAgICAgICAgICAgJ2xvYWQnOiAnb25Mb2FkJyxcbiAgICAgICAgICAgICdmb2N1cyc6ICdvbkZvY3VzJyxcbiAgICAgICAgICAgICdibHVyJzogJ29uQmx1cidcbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKGtleSBpbiBjYWxsYmFja3MpIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFja3MuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGZuID0gdGhpcy5vcHRpb25zW2NhbGxiYWNrc1trZXldXTtcbiAgICAgICAgICAgICAgICBpZiAoZm4pIHsgdGhpcy5vbihrZXksIGZuKTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuXG5cbiAgICBvbkNsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIG5lY2Vzc2FyeSBmb3IgbW9iaWxlIHdlYmtpdCBkZXZpY2VzIChtYW51YWwgZm9jdXMgdHJpZ2dlcmluZ1xuICAgICAgICAvLyBpcyBpZ25vcmVkIHVubGVzcyBpbnZva2VkIHdpdGhpbiBhIGNsaWNrIGV2ZW50KVxuICAgICAgICBpZiAoIXRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGRlZmF1bHRQcmV2ZW50ZWQgPSBlLmRlZmF1bHRQcmV2ZW50ZWQgfHwgKHR5cGVvZiBlLmRlZmF1bHRQcmV2ZW50ZWQgPT09ICd1bmRlZmluZWQnKTtcbiAgICAgICAgdmFyICR0YXJnZXQgPSAkKGUudGFyZ2V0KTtcblxuICAgICAgICBpZiAodGhpcy5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIC8vIHJldGFpbiBmb2N1cyBieSBwcmV2ZW50aW5nIG5hdGl2ZSBoYW5kbGluZy4gaWYgdGhlXG4gICAgICAgICAgICAvLyBldmVudCB0YXJnZXQgaXMgdGhlIGlucHV0IGl0IHNob3VsZCBub3QgYmUgbW9kaWZpZWQuXG4gICAgICAgICAgICAvLyBvdGhlcndpc2UsIHRleHQgc2VsZWN0aW9uIHdpdGhpbiB0aGUgaW5wdXQgd29uJ3Qgd29yay5cbiAgICAgICAgICAgIGlmIChlLnRhcmdldCAhPT0gdGhpcy4kY29udHJvbF9pbnB1dFswXSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID8gdGhpcy5jbG9zZSgpIDogdGhpcy5vcGVuKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0obnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyplLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7Ki9cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBnaXZlIGNvbnRyb2wgZm9jdXNcbiAgICAgICAgICAgIGlmICghZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlucHV0LmVtaXQoJ2NoYW5nZScsIHRoaXMuaW5wdXQudmFsdWUoKSwgdGhpcyk7XG4gICAgICAgICQoJ2JvZHknKS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogdGhpcy5pbnB1dCB9KTtcbiAgICB9LFxuXG4gICAgb25QYXN0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Z1bGwoKSB8fCB0aGlzLmlzSW5wdXRIaWRkZW4gfHwgdGhpcy5pc0xvY2tlZCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgYSByZWdleCBvciBzdHJpbmcgaXMgaW5jbHVkZWQsIHRoaXMgd2lsbCBzcGxpdCB0aGUgcGFzdGVkXG4gICAgICAgICAgICAvLyBpbnB1dCBhbmQgY3JlYXRlIEl0ZW1zIGZvciBlYWNoIHNlcGFyYXRlIHZhbHVlXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNwbGl0T24pIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzcGxpdElucHV0ID0gdHJpbSh0aGlzLiRjb250cm9sX2lucHV0LnZhbHVlKCkgfHwgJycpLnNwbGl0KHRoaXMub3B0aW9ucy5zcGxpdE9uKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBzcGxpdElucHV0Lmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVJdGVtKHNwbGl0SW5wdXRbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQpIHJldHVybiBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIGNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlIHx8IGUud2hpY2gpO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiB0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ211bHRpJyAmJiBjaGFyYWN0ZXIgPT09IHRoaXMub3B0aW9ucy5kZWxpbWl0ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlSXRlbSgpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5RG93bjogZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgaXNJbnB1dCA9IGUudGFyZ2V0ID09PSB0aGlzLiRjb250cm9sX2lucHV0WzBdO1xuXG4gICAgICAgIGlmICh0aGlzLmlzTG9ja2VkKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlICE9PSBLRVlfVEFCKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS0VZX0E6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDbWREb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0QWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtFWV9FU0M6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuYmx1cigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtFWV9OOlxuICAgICAgICAgICAgICAgIGlmICghZS5jdHJsS2V5IHx8IGUuYWx0S2V5KSBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS0VZX0RPV046XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzT3BlbiAmJiB0aGlzLmhhc09wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLiRhY3RpdmVPcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVIb3ZlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkbmV4dCA9IHRoaXMuZ2V0QWRqYWNlbnRPcHRpb24odGhpcy4kYWN0aXZlT3B0aW9uLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRuZXh0KSB7IHRoaXMuc2V0QWN0aXZlT3B0aW9uKCRuZXh0LCB0cnVlLCB0cnVlKTsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSBLRVlfUDpcbiAgICAgICAgICAgICAgICBpZiAoIWUuY3RybEtleSB8fCBlLmFsdEtleSkgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtFWV9VUDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYWN0aXZlT3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWdub3JlSG92ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHByZXYgPSB0aGlzLmdldEFkamFjZW50T3B0aW9uKHRoaXMuJGFjdGl2ZU9wdGlvbiwgLTEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHByZXYpIHsgdGhpcy5zZXRBY3RpdmVPcHRpb24oJHByZXYsIHRydWUsIHRydWUpOyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtFWV9SRVRVUk46XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuICYmIHRoaXMuJGFjdGl2ZU9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uT3B0aW9uU2VsZWN0KHsgY3VycmVudFRhcmdldDogdGhpcy4kYWN0aXZlT3B0aW9uIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS0VZX0xFRlQ6XG4gICAgICAgICAgICAgICAgdGhpcy5hZHZhbmNlU2VsZWN0aW9uKC0xLCBlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtFWV9SSUdIVDpcbiAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VTZWxlY3Rpb24oMSwgZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSBLRVlfVEFCOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0T25UYWIgJiYgdGhpcy5pc09wZW4gJiYgdGhpcy4kYWN0aXZlT3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25PcHRpb25TZWxlY3QoeyBjdXJyZW50VGFyZ2V0OiB0aGlzLiRhY3RpdmVPcHRpb24gfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBiZWhhdmlvdXIgaXMgdG8ganVtcCB0byB0aGUgbmV4dCBmaWVsZCwgd2Ugb25seSB3YW50IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGN1cnJlbnQgZmllbGQgZG9lc24ndCBhY2NlcHQgYW55IG1vcmUgZW50cmllc1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuaXNGdWxsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiB0aGlzLmNyZWF0ZUl0ZW0oKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS0VZX0JBQ0tTUEFDRTpcbiAgICAgICAgICAgIGNhc2UgS0VZX0RFTEVURTpcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVNlbGVjdGlvbihlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuaXNGdWxsKCkgfHwgdGhpcy5pc0lucHV0SGlkZGVuKSAmJiAhKElTX01BQyA/IGUubWV0YUtleSA6IGUuY3RybEtleSkpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbktleVVwOiBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQpIHJldHVybiBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpIHx8ICcnO1xuICAgICAgICBpZiAodGhpcy5sYXN0VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5vblNlYXJjaENoYW5nZSh2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hPcHRpb25zKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3R5cGUnLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TZWFyY2hDaGFuZ2U6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHZhciBmbiA9IHRoaXMub3B0aW9ucy5sb2FkO1xuICAgICAgICBpZiAoIWZuKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLmxvYWRlZFNlYXJjaGVzLmhhc093blByb3BlcnR5KHZhbHVlKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLmxvYWRlZFNlYXJjaGVzW3ZhbHVlXSA9IHRydWU7XG4gICAgICAgIHRoaXMubG9hZChiaW5kKGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBmbi5hcHBseSh0aGlzLCBbdmFsdWUsIGNhbGxiYWNrXSk7XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgb25Gb2N1czogZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgd2FzRm9jdXNlZCA9IHRoaXMuaXNGb2N1c2VkO1xuXG4gICAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYmx1cigpO1xuICAgICAgICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pZ25vcmVGb2N1cykgcmV0dXJuO1xuICAgICAgICB0aGlzLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucHJlbG9hZCA9PT0gJ2ZvY3VzJykgdGhpcy5vblNlYXJjaENoYW5nZSgnJyk7XG5cbiAgICAgICAgaWYgKCF3YXNGb2N1c2VkKSB0aGlzLmVtaXQoJ2ZvY3VzJyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLiRhY3RpdmVJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0lucHV0KCk7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0obnVsbCk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hPcHRpb25zKCEhdGhpcy5vcHRpb25zLm9wZW5PbkZvY3VzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaFN0YXRlKCk7XG4gICAgfSxcblxuICAgIG9uQmx1cjogZnVuY3Rpb24oZSwgZGVzdCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNGb2N1c2VkKSByZXR1cm47XG4gICAgICAgIHRoaXMuaXNGb2N1c2VkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMuaWdub3JlRm9jdXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pZ25vcmVCbHVyICYmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdKSkge1xuICAgICAgICAgICAgLy8gXi0gZzUgY3VzdG9tIFtiZWZvcmU6IG5vIGUudGFyZ2V0ICYmIC4uXVxuICAgICAgICAgICAgLy8gbmVjZXNzYXJ5IHRvIHByZXZlbnQgSUUgY2xvc2luZyB0aGUgZHJvcGRvd24gd2hlbiB0aGUgc2Nyb2xsYmFyIGlzIGNsaWNrZWRcbiAgICAgICAgICAgIHRoaXMuaWdub3JlQmx1ciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm9uRm9jdXMoZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZGVhY3RpdmF0ZSA9IGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLnNldFRleHRib3hWYWx1ZSgnJyk7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0obnVsbCk7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbihudWxsKTtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FyZXQodGhpcy5pdGVtcy5sZW5ndGgpO1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcblxuICAgICAgICAgICAgZGVzdCAmJiBkZXN0LmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuaWdub3JlRm9jdXMgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnYmx1cicpO1xuXG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHRoaXMuaWdub3JlRm9jdXMgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiB0aGlzLm9wdGlvbnMuY3JlYXRlT25CbHVyKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUl0ZW0obnVsbCwgZmFsc2UsIGRlYWN0aXZhdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVhY3RpdmF0ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uT3B0aW9uSG92ZXI6IGZ1bmN0aW9uKGUsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGlmICh0aGlzLmlnbm9yZUhvdmVyKSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKGVsZW1lbnQgfHwgZS5jdXJyZW50VGFyZ2V0LCBmYWxzZSk7XG4gICAgfSxcblxuICAgIG9uT3B0aW9uU2VsZWN0OiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgIHZhciB2YWx1ZSwgJHRhcmdldCwgJG9wdGlvbiwgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICAkdGFyZ2V0ID0gJChlbGVtZW50IHx8IGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgIGlmICgkdGFyZ2V0Lmhhc0NsYXNzKCdnLWNyZWF0ZScpKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUl0ZW0obnVsbCwgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNsb3NlQWZ0ZXJTZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gJHRhcmdldC5hdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0UXVlcnkgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGV4dGJveFZhbHVlKCcnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEl0ZW0odmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2xvc2VBZnRlclNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5vcHRpb25zLmhpZGVTZWxlY3RlZCAmJiBlLnR5cGUgJiYgL21vdXNlLy50ZXN0KGUudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVPcHRpb24odGhpcy5nZXRPcHRpb24odmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25JdGVtU2VsZWN0OiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmlzTG9ja2VkKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ211bHRpJykge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKGVsZW1lbnQgfHwgZS5jdXJyZW50VGFyZ2V0LCBlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkl0ZW1SZW1vdmVWaWFYOiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQgfHwgdGhpcy5vcHRpb25zLm1vZGUgPT0gJ3NpbmdsZScpIHJldHVybjtcblxuICAgICAgICB2YXIgJGl0ZW0gPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oJGl0ZW0pO1xuICAgICAgICBpZiAodGhpcy5kZWxldGVTZWxlY3Rpb24oKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRDYXJldCh0aGlzLml0ZW1zLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgdmFyICR3cmFwcGVyID0gdGhpcy4kd3JhcHBlci5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubG9hZGluZ0NsYXNzKTtcblxuICAgICAgICB0aGlzLmxvYWRpbmcrKztcbiAgICAgICAgZm4uYXBwbHkodGhpcywgW2JpbmQoZnVuY3Rpb24ocmVzdWx0cykge1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gTWF0aC5tYXgodGhpcy5sb2FkaW5nIC0gMSwgMCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0cyAmJiByZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkT3B0aW9uKHJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModGhpcy5pc0ZvY3VzZWQgJiYgIXRoaXMuaXNJbnB1dEhpZGRlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMubG9hZGluZykge1xuICAgICAgICAgICAgICAgICR3cmFwcGVyLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5sb2FkaW5nQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdsb2FkJywgcmVzdWx0cyk7XG4gICAgICAgIH0sIHRoaXMpXSk7XG4gICAgfSxcblxuICAgIHNldFRleHRib3hWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdmFyICRpbnB1dCA9IHRoaXMuJGNvbnRyb2xfaW5wdXQ7XG4gICAgICAgIHZhciBjaGFuZ2VkID0gJGlucHV0LnZhbHVlKCkgIT09IHZhbHVlO1xuICAgICAgICBpZiAoY2hhbmdlZCkge1xuICAgICAgICAgICAgJGlucHV0LnZhbHVlKHZhbHVlKS5lbWl0KCd1cGRhdGUnKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFZhbHVlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIC8vIGc1IGN1c3RvbVxuICAgICAgICBpZiAodGhpcy50YWdUeXBlID09PSBUQUdfU0VMRUNUICYmIHRoaXMuaW5wdXQuYXR0cmlidXRlKCdtdWx0aXBsZScpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgfHwgdGhpcy5pdGVtcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAodmFsdWUgfHwgdGhpcy5pdGVtcykuam9pbih0aGlzLm9wdGlvbnMuZGVsaW1pdGVyKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24odmFsdWUsIHNpbGVudCkge1xuICAgICAgICB2YXIgZXZlbnRzID0gc2lsZW50ID8gW10gOiBbJ2NoYW5nZSddO1xuXG4gICAgICAgIGRlYm91bmNlX2V2ZW50cyh0aGlzLCBldmVudHMsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhcihzaWxlbnQpO1xuICAgICAgICAgICAgdGhpcy5wcmV2aW91c1ZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpIHx8IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5hZGRJdGVtcyh2YWx1ZSwgc2lsZW50KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNldEFjdGl2ZUl0ZW06IGZ1bmN0aW9uKGl0ZW0sIGUpIHtcbiAgICAgICAgdmFyIGV2ZW50TmFtZSwgaWR4LCBiZWdpbiwgZW5kLCAkaXRlbSwgc3dhcCwgJGxhc3Q7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJykgeyByZXR1cm47IH1cbiAgICAgICAgaXRlbSA9ICQoaXRlbSk7XG5cbiAgICAgICAgLy8gY2xlYXIgdGhlIGFjdGl2ZSBzZWxlY3Rpb25cbiAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kYWN0aXZlSXRlbXMubGVuZ3RoKSB7ICQodGhpcy4kYWN0aXZlSXRlbXMpLnJlbW92ZUNsYXNzKCdnLWFjdGl2ZScpOyB9XG4gICAgICAgICAgICB0aGlzLiRhY3RpdmVJdGVtcyA9IFtdO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93SW5wdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1vZGlmeSBzZWxlY3Rpb25cbiAgICAgICAgZXZlbnROYW1lID0gZSAmJiBlLnR5cGUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICBpZiAoZXZlbnROYW1lID09PSAnbW91c2Vkb3duJyAmJiB0aGlzLmlzU2hpZnREb3duICYmIHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgJGxhc3QgPSAkKGxhc3QodGhpcy4kY29udHJvbC5jaGlsZHJlbignLmctYWN0aXZlJykpKTtcbiAgICAgICAgICAgIGJlZ2luID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuYXBwbHkodGhpcy4kY29udHJvbFswXS5jaGlsZE5vZGVzLCBbJGxhc3RbMF1dKTtcbiAgICAgICAgICAgIGVuZCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmFwcGx5KHRoaXMuJGNvbnRyb2xbMF0uY2hpbGROb2RlcywgW2l0ZW1bMF1dKTtcbiAgICAgICAgICAgIGlmIChiZWdpbiA+IGVuZCkge1xuICAgICAgICAgICAgICAgIHN3YXAgPSBiZWdpbjtcbiAgICAgICAgICAgICAgICBiZWdpbiA9IGVuZDtcbiAgICAgICAgICAgICAgICBlbmQgPSBzd2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGJlZ2luOyBpIDw9IGVuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgJGl0ZW0gPSB0aGlzLiRjb250cm9sWzBdLmNoaWxkTm9kZXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZUl0ZW1zLmluZGV4T2YoJGl0ZW0pID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAkKCRpdGVtKS5hZGRDbGFzcygnZy1hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kd3JhcHBlci5hdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHNsdWdpZnkodGhpcy5yYW5kICsgJy0nICsgJCgkaXRlbSkuYXR0cmlidXRlKCdkYXRhLXZhbHVlJykpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYWN0aXZlSXRlbXMucHVzaCgkaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKChldmVudE5hbWUgPT09ICdtb3VzZWRvd24nICYmIHRoaXMuaXNDdHJsRG93bikgfHwgKGV2ZW50TmFtZSA9PT0gJ2tleWRvd24nICYmIHRoaXMuaXNTaGlmdERvd24pKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5oYXNDbGFzcygnZy1hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIGlkeCA9IHRoaXMuJGFjdGl2ZUl0ZW1zLmluZGV4T2YoaXRlbVswXSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kYWN0aXZlSXRlbXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgaXRlbS5yZW1vdmVDbGFzcygnZy1hY3RpdmUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kYWN0aXZlSXRlbXMucHVzaChpdGVtLmFkZENsYXNzKCdnLWFjdGl2ZScpWzBdKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR3cmFwcGVyLmF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jywgc2x1Z2lmeSh0aGlzLnJhbmQgKyAnLScgKyBpdGVtLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzLiRhY3RpdmVJdGVtcykpICQodGhpcy4kYWN0aXZlSXRlbXMpLnJlbW92ZUNsYXNzKCdnLWFjdGl2ZScpO1xuICAgICAgICAgICAgdGhpcy4kYWN0aXZlSXRlbXMgPSBbaXRlbS5hZGRDbGFzcygnZy1hY3RpdmUnKVswXV07XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLmF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jywgc2x1Z2lmeSh0aGlzLnJhbmQgKyAnLScgKyBpdGVtLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlbnN1cmUgY29udHJvbCBoYXMgZm9jdXNcbiAgICAgICAgdGhpcy5oaWRlSW5wdXQoKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldEFjdGl2ZU9wdGlvbjogZnVuY3Rpb24oJG9wdGlvbiwgc2Nyb2xsLCBhbmltYXRlKSB7XG4gICAgICAgIHZhciBoZWlnaHRfbWVudSwgaGVpZ2h0X2l0ZW0sIHk7XG4gICAgICAgIHZhciBzY3JvbGxfdG9wLCBzY3JvbGxfYm90dG9tO1xuXG4gICAgICAgIGlmICh0aGlzLiRhY3RpdmVPcHRpb24pIHRoaXMuJGFjdGl2ZU9wdGlvbi5yZW1vdmVDbGFzcygnZy1hY3RpdmUnKTtcbiAgICAgICAgdGhpcy4kYWN0aXZlT3B0aW9uID0gbnVsbDtcblxuICAgICAgICAkb3B0aW9uID0gJCgkb3B0aW9uKTtcbiAgICAgICAgaWYgKCEkb3B0aW9uKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy4kYWN0aXZlT3B0aW9uID0gJG9wdGlvbi5hZGRDbGFzcygnZy1hY3RpdmUnKTtcbiAgICAgICAgdGhpcy4kd3JhcHBlci5hdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHNsdWdpZnkodGhpcy5yYW5kICsgJy0nICsgJG9wdGlvbi5hdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSkpO1xuXG4gICAgICAgIGlmIChzY3JvbGwgfHwgIWlzc2V0KHNjcm9sbCkpIHtcblxuICAgICAgICAgICAgaGVpZ2h0X21lbnUgPSB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdLm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIGhlaWdodF9pdGVtID0gdGhpcy4kYWN0aXZlT3B0aW9uWzBdLm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIHNjcm9sbCA9IHRoaXMuJGRyb3Bkb3duX2NvbnRlbnRbMF0uc2Nyb2xsVG9wIHx8IDA7XG4gICAgICAgICAgICB5ID0gdGhpcy4kYWN0aXZlT3B0aW9uLnBvc2l0aW9uKCkudG9wIC0gdGhpcy4kZHJvcGRvd25fY29udGVudC5wb3NpdGlvbigpLnRvcCArIHNjcm9sbDtcbiAgICAgICAgICAgIHNjcm9sbF90b3AgPSB5O1xuICAgICAgICAgICAgc2Nyb2xsX2JvdHRvbSA9IHkgLSBoZWlnaHRfbWVudSArIGhlaWdodF9pdGVtO1xuXG4gICAgICAgICAgICBpZiAoeSArIGhlaWdodF9pdGVtID4gaGVpZ2h0X21lbnUgKyBzY3JvbGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdLnNjcm9sbFRvcCA9IHNjcm9sbF9ib3R0b207XG4gICAgICAgICAgICAgICAgLyptb29meChiaW5kKGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICAgdGhpcy4kZHJvcGRvd25fY29udGVudFswXS5zY3JvbGxUb3AgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgfSwgdGhpcyksIHtcbiAgICAgICAgICAgICAgICAgZHVyYXRpb246IGFuaW1hdGUgPyB0aGlzLm9wdGlvbnMuc2Nyb2xsRHVyYXRpb24gOiAwLFxuICAgICAgICAgICAgICAgICBlcXVhdGlvbjogJ2xpbmVhcidcbiAgICAgICAgICAgICAgICAgfSkuc3RhcnQoc2Nyb2xsLCBzY3JvbGxfYm90dG9tKTsqL1xuICAgICAgICAgICAgfSBlbHNlIGlmICh5IDwgc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZHJvcGRvd25fY29udGVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxfdG9wO1xuICAgICAgICAgICAgICAgIC8qbW9vZngoYmluZChmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICAgICAgIHRoaXMuJGRyb3Bkb3duX2NvbnRlbnRbMF0uc2Nyb2xsVG9wID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgIH0sIHRoaXMpLCB7XG4gICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBhbmltYXRlID8gdGhpcy5vcHRpb25zLnNjcm9sbER1cmF0aW9uIDogMCxcbiAgICAgICAgICAgICAgICAgZXF1YXRpb246ICdsaW5lYXInXG4gICAgICAgICAgICAgICAgIH0pLnN0YXJ0KHNjcm9sbCwgc2Nyb2xsX3RvcCk7Ki9cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNlbGVjdEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ3NpbmdsZScpIHJldHVybjtcblxuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLiRjb250cm9sLmNoaWxkcmVuKCc6bm90KGlucHV0KScpO1xuICAgICAgICBpZiAoaXRlbXMpIHtcbiAgICAgICAgICAgIGl0ZW1zLmFkZENsYXNzKCdnLWFjdGl2ZScpO1xuICAgICAgICAgICAgdGhpcy4kd3JhcHBlci5hdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHNsdWdpZnkodGhpcy5yYW5kICsgJy0nICsgaXRlbXMuYXR0cmlidXRlKCdkYXRhLXZhbHVlJykpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGl0ZW1zIHx8IFtdKTtcbiAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlSW5wdXQoKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgfSxcblxuICAgIGhpZGVJbnB1dDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5zZXRUZXh0Ym94VmFsdWUoJycpO1xuICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0LnN0eWxlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMucnRsID8gMTAwMDAgOiAtMTAwMDBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaXNJbnB1dEhpZGRlbiA9IHRydWU7XG4gICAgfSxcblxuICAgIHNob3dJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXQuc3R5bGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgICAgICAgICAgbGVmdDogMFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0lucHV0SGlkZGVuID0gZmFsc2U7XG4gICAgfSxcblxuICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEaXNhYmxlZCkgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmlnbm9yZUZvY3VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kY29udHJvbF9pbnB1dFswXS5mb2N1cygpO1xuICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmlnbm9yZUZvY3VzID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9uRm9jdXMoKTtcbiAgICAgICAgfSwgdGhpcyksIDApO1xuICAgIH0sXG5cbiAgICBibHVyOiBmdW5jdGlvbihkZXN0KSB7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXRbMF0uYmx1cigpO1xuICAgICAgICB0aGlzLm9uQmx1cihudWxsLCBkZXN0KTtcbiAgICAgICAgLy8gZzUgY3VzdG9tXG4gICAgICAgIC8vdGhpcy4kY29udHJvbF9pbnB1dFswXS5ibHVyKCk7XG4gICAgfSxcblxuICAgIGdldFNjb3JlRnVuY3Rpb246IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNpZnRlci5nZXRTY29yZUZ1bmN0aW9uKHF1ZXJ5LCB0aGlzLmdldFNlYXJjaE9wdGlvbnMoKSk7XG4gICAgfSxcblxuICAgIGdldFNlYXJjaE9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc29ydCA9IHRoaXMub3B0aW9ucy5zb3J0RmllbGQ7XG4gICAgICAgIGlmICh0eXBlb2Ygc29ydCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNvcnQgPSBbeyBmaWVsZDogc29ydCB9XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZHM6IHRoaXMub3B0aW9ucy5zZWFyY2hGaWVsZCxcbiAgICAgICAgICAgIGNvbmp1bmN0aW9uOiB0aGlzLm9wdGlvbnMuc2VhcmNoQ29uanVuY3Rpb24sXG4gICAgICAgICAgICBzb3J0OiBzb3J0XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHNlYXJjaDogZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgICAgdmFyIGksIHZhbHVlLCBzY29yZSwgcmVzdWx0LCBjYWxjdWxhdGVTY29yZTtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLmdldFNlYXJjaE9wdGlvbnMoKTtcblxuICAgICAgICAvLyB2YWxpZGF0ZSB1c2VyLXByb3ZpZGVkIHJlc3VsdCBzY29yaW5nIGZ1bmN0aW9uXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NvcmUpIHtcbiAgICAgICAgICAgIGNhbGN1bGF0ZVNjb3JlID0gdGhpcy5vcHRpb25zLnNjb3JlLmFwcGx5KHRoaXMsIFtxdWVyeV0pO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxjdWxhdGVTY29yZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VsZWN0aXplIFwic2NvcmVcIiBzZXR0aW5nIG11c3QgYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBmdW5jdGlvbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGVyZm9ybSBzZWFyY2hcbiAgICAgICAgaWYgKHF1ZXJ5ICE9PSB0aGlzLmxhc3RRdWVyeSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0UXVlcnkgPSBxdWVyeTtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuc2lmdGVyLnNlYXJjaChxdWVyeSwgbWVyZ2Uob3B0aW9ucywgeyBzY29yZTogY2FsY3VsYXRlU2NvcmUgfSkpO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IHJlc3VsdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG1lcmdlKHt9LCB0aGlzLmN1cnJlbnRSZXN1bHRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGZpbHRlciBvdXQgc2VsZWN0ZWQgaXRlbXNcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWRlU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IHJlc3VsdC5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmluZGV4T2YoaGFzaF9rZXkocmVzdWx0Lml0ZW1zW2ldLmlkKSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgcmVmcmVzaE9wdGlvbnM6IGZ1bmN0aW9uKHRyaWdnZXJEcm9wZG93bikge1xuICAgICAgICB2YXIgaSwgaiwgaywgbiwgZ3JvdXBzLCBncm91cHNfb3JkZXIsIG9wdGlvbiwgb3B0aW9uX2h0bWwsIG9wdGdyb3VwLCBvcHRncm91cHMsIGh0bWwsIGh0bWxfY2hpbGRyZW4sIGhhc19jcmVhdGVfb3B0aW9uO1xuICAgICAgICB2YXIgJGFjdGl2ZSwgJGFjdGl2ZV9iZWZvcmUsICRjcmVhdGU7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0cmlnZ2VyRHJvcGRvd24gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0cmlnZ2VyRHJvcGRvd24gPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHF1ZXJ5ID0gdHJpbSh0aGlzLiRjb250cm9sX2lucHV0LnZhbHVlKCkpO1xuICAgICAgICB2YXIgcmVzdWx0cyA9IHRoaXMuc2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgdmFyICRkcm9wZG93bl9jb250ZW50ID0gdGhpcy4kZHJvcGRvd25fY29udGVudDtcbiAgICAgICAgdmFyIGFjdGl2ZV9iZWZvcmUgPSB0aGlzLiRhY3RpdmVPcHRpb24gJiYgaGFzaF9rZXkodGhpcy4kYWN0aXZlT3B0aW9uLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKTtcblxuICAgICAgICAvLyBidWlsZCBtYXJrdXBcbiAgICAgICAgbiA9IHJlc3VsdHMuaXRlbXMubGVuZ3RoO1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5tYXhPcHRpb25zID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgbiA9IE1hdGgubWluKG4sIHRoaXMub3B0aW9ucy5tYXhPcHRpb25zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlbmRlciBhbmQgZ3JvdXAgYXZhaWxhYmxlIG9wdGlvbnMgaW5kaXZpZHVhbGx5XG4gICAgICAgIGdyb3VwcyA9IHt9O1xuICAgICAgICBncm91cHNfb3JkZXIgPSBbXTtcblxuICAgICAgICAvLyBnNSBjdXN0b21cbiAgICAgICAgLy9pZiAodGhpcy5vcHRpb25zLm9wdGdyb3VwT3JkZXIpIHtcbiAgICAgICAgLy8gICAgZ3JvdXBzX29yZGVyID0gdGhpcy5vcHRpb25zLm9wdGdyb3VwT3JkZXI7XG4gICAgICAgIC8vICAgIGZvciAoaSA9IDA7IGkgPCBncm91cHNfb3JkZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gICAgICAgIGdyb3Vwc1tncm91cHNfb3JkZXJbaV1dID0gW107XG4gICAgICAgIC8vICAgIH1cbiAgICAgICAgLy99IGVsc2Uge1xuICAgICAgICAvLyAgICBncm91cHNfb3JkZXIgPSBbXTtcbiAgICAgICAgLy99XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgb3B0aW9uID0gdGhpcy5PcHRpb25zW3Jlc3VsdHMuaXRlbXNbaV0uaWRdO1xuICAgICAgICAgICAgb3B0aW9uX2h0bWwgPSB0aGlzLnJlbmRlcignb3B0aW9uJywgb3B0aW9uKTtcbiAgICAgICAgICAgIG9wdGdyb3VwID0gb3B0aW9uW3RoaXMub3B0aW9ucy5vcHRncm91cEZpZWxkXSB8fCAnJztcbiAgICAgICAgICAgIG9wdGdyb3VwcyA9IGlzQXJyYXkob3B0Z3JvdXApID8gb3B0Z3JvdXAgOiBbb3B0Z3JvdXBdO1xuXG4gICAgICAgICAgICBmb3IgKGogPSAwLCBrID0gb3B0Z3JvdXBzICYmIG9wdGdyb3Vwcy5sZW5ndGg7IGogPCBrOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvcHRncm91cCA9IG9wdGdyb3Vwc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuT3B0Z3JvdXBzLmhhc093blByb3BlcnR5KG9wdGdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRncm91cCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShvcHRncm91cCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW29wdGdyb3VwXSA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzX29yZGVyLnB1c2gob3B0Z3JvdXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBncm91cHNbb3B0Z3JvdXBdLmFwcGVuZENoaWxkKG9wdGlvbl9odG1sKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvcnQgb3B0Z3JvdXBzXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9ja09wdGdyb3VwT3JkZXIpIHtcbiAgICAgICAgICAgIGdyb3Vwc19vcmRlci5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYV9vcmRlciA9IHRoaXMuT3B0Z3JvdXBzW2FdLiRvcmRlciB8fCAwO1xuICAgICAgICAgICAgICAgIHZhciBiX29yZGVyID0gdGhpcy5PcHRncm91cHNbYl0uJG9yZGVyIHx8IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFfb3JkZXIgLSBiX29yZGVyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZW5kZXIgb3B0Z3JvdXAgaGVhZGVycyAmIGpvaW4gZ3JvdXBzXG4gICAgICAgIGh0bWwgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGZvciAoaSA9IDAsIG4gPSBncm91cHNfb3JkZXIubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBvcHRncm91cCA9IGdyb3Vwc19vcmRlcltpXTtcbiAgICAgICAgICAgIGlmICh0aGlzLk9wdGdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShvcHRncm91cCkgJiYgZ3JvdXBzW29wdGdyb3VwXS5jaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIC8vIHJlbmRlciB0aGUgb3B0Z3JvdXAgaGVhZGVyIGFuZCBvcHRpb25zIHdpdGhpbiBpdCxcbiAgICAgICAgICAgICAgICAvLyB0aGVuIHBhc3MgaXQgdG8gdGhlIHdyYXBwZXIgdGVtcGxhdGVcbiAgICAgICAgICAgICAgICBodG1sX2NoaWxkcmVuID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAgICAgICAgIGh0bWxfY2hpbGRyZW4uYXBwZW5kQ2hpbGQodGhpcy5yZW5kZXIoJ29wdGdyb3VwX2hlYWRlcicsIHRoaXMuT3B0Z3JvdXBzW29wdGdyb3VwXSkpO1xuICAgICAgICAgICAgICAgIGh0bWxfY2hpbGRyZW4uYXBwZW5kQ2hpbGQoZ3JvdXBzW29wdGdyb3VwXSk7XG4gICAgICAgICAgICAgICAgaHRtbC5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlcignb3B0Z3JvdXAnLCBtZXJnZSh7fSwgdGhpcy5PcHRncm91cHNbb3B0Z3JvdXBdLCB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IGRvbVRvU3RyaW5nKGh0bWxfY2hpbGRyZW4pLFxuICAgICAgICAgICAgICAgICAgICBkb206IGh0bWxfY2hpbGRyZW5cbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBodG1sLmFwcGVuZENoaWxkKGdyb3Vwc1tvcHRncm91cF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJGRyb3Bkb3duX2NvbnRlbnQuaHRtbChkb21Ub1N0cmluZyhodG1sKSk7XG5cbiAgICAgICAgLy8gaGlnaGxpZ2h0IG1hdGNoaW5nIHRlcm1zIGlubGluZVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhpZ2hsaWdodCAmJiByZXN1bHRzLnF1ZXJ5Lmxlbmd0aCAmJiByZXN1bHRzLnRva2Vucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSByZXN1bHRzLnRva2Vucy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBoaWdobGlnaHQoJGRyb3Bkb3duX2NvbnRlbnQsIHJlc3VsdHMudG9rZW5zW2ldLnJlZ2V4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBcInNlbGVjdGVkXCIgY2xhc3MgdG8gc2VsZWN0ZWQgb3B0aW9uc1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oaWRlU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSB0aGlzLml0ZW1zLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3B0aW9uKHRoaXMuaXRlbXNbaV0pLmFkZENsYXNzKCdnLXNlbGVjdGVkJykuYXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhZGQgY3JlYXRlIG9wdGlvblxuICAgICAgICBoYXNfY3JlYXRlX29wdGlvbiA9IHRoaXMuY2FuQ3JlYXRlKHF1ZXJ5KTtcbiAgICAgICAgaWYgKGhhc19jcmVhdGVfb3B0aW9uKSB7XG4gICAgICAgICAgICAvLyRkcm9wZG93bl9jb250ZW50LnByZXBlbmQodGhpcy5yZW5kZXIoJ29wdGlvbl9jcmVhdGUnLCB7IGlucHV0OiBxdWVyeSB9KSk7XG4gICAgICAgICAgICAkKHRoaXMucmVuZGVyKCdvcHRpb25fY3JlYXRlJywgeyBpbnB1dDogcXVlcnkgfSkpLnRvcCgkZHJvcGRvd25fY29udGVudCk7XG4gICAgICAgICAgICAkY3JlYXRlID0gJCgkZHJvcGRvd25fY29udGVudFswXS5jaGlsZE5vZGVzWzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFjdGl2YXRlXG4gICAgICAgIHRoaXMuaGFzT3B0aW9ucyA9IHJlc3VsdHMuaXRlbXMubGVuZ3RoID4gMCB8fCBoYXNfY3JlYXRlX29wdGlvbjtcbiAgICAgICAgaWYgKHRoaXMuaGFzT3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRhY3RpdmVfYmVmb3JlID0gYWN0aXZlX2JlZm9yZSAmJiB0aGlzLmdldE9wdGlvbihhY3RpdmVfYmVmb3JlKTtcbiAgICAgICAgICAgICAgICBpZiAoJGFjdGl2ZV9iZWZvcmUgJiYgJGFjdGl2ZV9iZWZvcmUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICRhY3RpdmUgPSAkYWN0aXZlX2JlZm9yZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJyAmJiB0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkYWN0aXZlID0gdGhpcy5nZXRPcHRpb24odGhpcy5pdGVtc1swXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghJGFjdGl2ZSB8fCAhJGFjdGl2ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRjcmVhdGUgJiYgIXRoaXMub3B0aW9ucy5hZGRQcmVjZWRlbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlID0gdGhpcy5nZXRBZGphY2VudE9wdGlvbigkY3JlYXRlLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRhY3RpdmUgPSAkZHJvcGRvd25fY29udGVudC5maW5kKCdbZGF0YS1zZWxlY3RhYmxlXTpmaXJzdC1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkYWN0aXZlID0gJGNyZWF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKCRhY3RpdmUpO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJEcm9wZG93biAmJiAhdGhpcy5pc09wZW4pIHsgdGhpcy5vcGVuKCk7IH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKG51bGwpO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJEcm9wZG93biAmJiB0aGlzLmlzT3BlbikgeyB0aGlzLmNsb3NlKCk7IH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRPcHRpb246IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIHZhbHVlO1xuXG4gICAgICAgIGlmIChpc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGRhdGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRPcHRpb24oZGF0YVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmFsdWUgPSB0aGlzLnJlZ2lzdGVyT3B0aW9uKGRhdGEpKSB7XG4gICAgICAgICAgICB0aGlzLlVzZXJPcHRpb25zW3ZhbHVlXSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ29wdGlvbl9hZGQnLCB2YWx1ZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBnNSBjdXN0b21cbiAgICAgICAgLyp2YWx1ZSA9IGhhc2hfa2V5KGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnIHx8IHRoaXMuT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSkpIHJldHVybjtcblxuICAgICAgICAgdGhpcy5Vc2VyT3B0aW9uc1t2YWx1ZV0gPSB0cnVlO1xuICAgICAgICAgdGhpcy5PcHRpb25zW3ZhbHVlXSA9IGRhdGE7XG4gICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgICB0aGlzLmVtaXQoJ29wdGlvbl9hZGQnLCB2YWx1ZSwgZGF0YSk7Ki9cbiAgICB9LFxuXG4gICAgcmVnaXN0ZXJPcHRpb246IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIGtleSA9IGhhc2hfa2V5KGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgaWYgKCgha2V5ICYmICF0aGlzLm9wdGlvbnMuYWxsb3dFbXB0eU9wdGlvbikgfHwgdGhpcy5vcHRpb25zLmhhc093blByb3BlcnR5KGtleSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgZGF0YS4kb3JkZXIgPSBkYXRhLiRvcmRlciB8fCArK3RoaXMub3JkZXI7XG4gICAgICAgIHRoaXMuT3B0aW9uc1trZXldID0gZGF0YTtcblxuICAgICAgICByZXR1cm4ga2V5O1xuICAgIH0sXG5cbiAgICByZWdpc3Rlck9wdGlvbkdyb3VwOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBrZXkgPSBoYXNoX2tleShkYXRhW3RoaXMub3B0aW9ucy5vcHRncm91cFZhbHVlRmllbGRdKTtcbiAgICAgICAgaWYgKCFrZXkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBkYXRhLiRvcmRlciA9IGRhdGEuJG9yZGVyIHx8ICsrdGhpcy5vcmRlcjtcbiAgICAgICAgdGhpcy5PcHRncm91cHNba2V5XSA9IGRhdGE7XG5cbiAgICAgICAgcmV0dXJuIGtleTtcbiAgICB9LFxuXG5cbiAgICBhZGRPcHRpb25Hcm91cDogZnVuY3Rpb24oaWQsIGRhdGEpIHtcbiAgICAgICAgZGF0YVt0aGlzLm9wdGlvbnMub3B0Z3JvdXBWYWx1ZUZpZWxkXSA9IGlkO1xuICAgICAgICBpZiAoaWQgPSB0aGlzLnJlZ2lzdGVyT3B0aW9uR3JvdXAoZGF0YSkpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnb3B0Z3JvdXBfYWRkJywgaWQsIGRhdGEpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZU9wdGlvbkdyb3VwOiBmdW5jdGlvbihpZCkge1xuICAgICAgICBpZiAodGhpcy5PcHRncm91cHMuaGFzT3duUHJvcGVydHkoaWQpKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5PcHRncm91cHNbaWRdO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJDYWNoZSA9IHt9O1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdvcHRncm91cF9yZW1vdmUnLCBpZCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2xlYXJPcHRpb25Hcm91cHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLk9wdGdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnJlbmRlckNhY2hlID0ge307XG4gICAgICAgIHRoaXMuZW1pdCgnb3B0Z3JvdXBfY2xlYXInKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlT3B0aW9uOiBmdW5jdGlvbih2YWx1ZSwgZGF0YSkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciAkaXRlbSwgJGl0ZW1fbmV3LCBkdW1teTtcbiAgICAgICAgdmFyIHZhbHVlX25ldywgaW5kZXhfaXRlbSwgY2FjaGVfaXRlbXMsIGNhY2hlX29wdGlvbnMsIG9yZGVyX29sZDtcblxuICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KHZhbHVlKTtcbiAgICAgICAgdmFsdWVfbmV3ID0gaGFzaF9rZXkoZGF0YVt0aGlzLm9wdGlvbnMudmFsdWVGaWVsZF0pO1xuXG4gICAgICAgIC8vIHNhbml0eSBjaGVja3NcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm47XG4gICAgICAgIGlmICghdGhpcy5PcHRpb25zLmhhc093blByb3BlcnR5KHZhbHVlKSkgcmV0dXJuO1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlX25ldyAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignVmFsdWUgbXVzdCBiZSBzZXQgaW4gb3B0aW9uIGRhdGEnKTtcblxuICAgICAgICBvcmRlcl9vbGQgPSB0aGlzLk9wdGlvbnNbdmFsdWVdLiRvcmRlcjtcblxuICAgICAgICAvLyB1cGRhdGUgcmVmZXJlbmNlc1xuICAgICAgICBpZiAodmFsdWVfbmV3ICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuT3B0aW9uc1t2YWx1ZV07XG4gICAgICAgICAgICBpbmRleF9pdGVtID0gdGhpcy5pdGVtcy5pbmRleE9mKHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChpbmRleF9pdGVtICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4X2l0ZW0sIDEsIHZhbHVlX25ldyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGF0YS4kb3JkZXIgPSBkYXRhLiRvcmRlciB8fCBvcmRlcl9vbGQ7XG4gICAgICAgIHRoaXMuT3B0aW9uc1t2YWx1ZV9uZXddID0gZGF0YTtcblxuICAgICAgICAvLyBpbnZhbGlkYXRlIHJlbmRlciBjYWNoZVxuICAgICAgICBjYWNoZV9pdGVtcyA9IHRoaXMucmVuZGVyQ2FjaGVbJ2l0ZW0nXTtcbiAgICAgICAgY2FjaGVfb3B0aW9ucyA9IHRoaXMucmVuZGVyQ2FjaGVbJ29wdGlvbiddO1xuXG4gICAgICAgIGlmIChjYWNoZV9pdGVtcykge1xuICAgICAgICAgICAgZGVsZXRlIGNhY2hlX2l0ZW1zW3ZhbHVlXTtcbiAgICAgICAgICAgIGRlbGV0ZSBjYWNoZV9pdGVtc1t2YWx1ZV9uZXddO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjYWNoZV9vcHRpb25zKSB7XG4gICAgICAgICAgICBkZWxldGUgY2FjaGVfb3B0aW9uc1t2YWx1ZV07XG4gICAgICAgICAgICBkZWxldGUgY2FjaGVfb3B0aW9uc1t2YWx1ZV9uZXddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBpdGVtIGlmIGl0J3Mgc2VsZWN0ZWRcbiAgICAgICAgaWYgKHRoaXMuaXRlbXMuaW5kZXhPZih2YWx1ZV9uZXcpICE9PSAtMSkge1xuICAgICAgICAgICAgJGl0ZW0gPSB0aGlzLmdldEl0ZW0odmFsdWUpO1xuICAgICAgICAgICAgJGl0ZW1fbmV3ID0gJCh0aGlzLnJlbmRlcignaXRlbScsIGRhdGEpKTtcbiAgICAgICAgICAgIGlmICgkaXRlbS5oYXNDbGFzcygnZy1hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgICRpdGVtX25ldy5hZGRDbGFzcygnZy1hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR3cmFwcGVyLmF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jywgc2x1Z2lmeSh0aGlzLnJhbmQgKyAnLScgKyAkaXRlbV9uZXcuYXR0cmlidXRlKCdkYXRhLXZhbHVlJykpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJGl0ZW1fbmV3LmFmdGVyKCRpdGVtKTtcbiAgICAgICAgICAgICRpdGVtLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW52YWxpZGF0ZSBsYXN0IHF1ZXJ5IGJlY2F1c2Ugd2UgbWlnaHQgaGF2ZSB1cGRhdGVkIHRoZSBzb3J0RmllbGRcbiAgICAgICAgdGhpcy5sYXN0UXVlcnkgPSBudWxsO1xuXG4gICAgICAgIC8vIHVwZGF0ZSBkcm9wZG93biBjb250ZW50c1xuICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnMoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZU9wdGlvbjogZnVuY3Rpb24odmFsdWUsIHNpbGVudCkge1xuICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KHZhbHVlKTtcblxuICAgICAgICB2YXIgY2FjaGVfaXRlbXMgPSB0aGlzLnJlbmRlckNhY2hlWydpdGVtJ107XG4gICAgICAgIHZhciBjYWNoZV9vcHRpb25zID0gdGhpcy5yZW5kZXJDYWNoZVsnb3B0aW9uJ107XG4gICAgICAgIGlmIChjYWNoZV9pdGVtcykgZGVsZXRlIGNhY2hlX2l0ZW1zW3ZhbHVlXTtcbiAgICAgICAgaWYgKGNhY2hlX29wdGlvbnMpIGRlbGV0ZSBjYWNoZV9vcHRpb25zW3ZhbHVlXTtcblxuICAgICAgICBkZWxldGUgdGhpcy5Vc2VyT3B0aW9uc1t2YWx1ZV07XG4gICAgICAgIGRlbGV0ZSB0aGlzLk9wdGlvbnNbdmFsdWVdO1xuICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgIHRoaXMuZW1pdCgnb3B0aW9uX3JlbW92ZScsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtKHZhbHVlLCBzaWxlbnQpO1xuICAgIH0sXG5cbiAgICBjbGVhck9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmxvYWRlZFNlYXJjaGVzID0ge307XG4gICAgICAgIHRoaXMuVXNlck9wdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5yZW5kZXJDYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLk9wdGlvbnMgPSB0aGlzLnNpZnRlci5pdGVtcyA9IHt9O1xuICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgIHRoaXMuZW1pdCgnb3B0aW9uX2NsZWFyJyk7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9LFxuXG4gICAgZ2V0T3B0aW9uOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRFbGVtZW50V2l0aFZhbHVlKHZhbHVlLCB0aGlzLiRkcm9wZG93bl9jb250ZW50LnNlYXJjaCgnW2RhdGEtc2VsZWN0YWJsZV0nKSk7XG4gICAgfSxcblxuICAgIGdldEFkamFjZW50T3B0aW9uOiBmdW5jdGlvbigkb3B0aW9uLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgdmFyICRvcHRpb25zID0gdGhpcy4kZHJvcGRvd24uc2VhcmNoKCdbZGF0YS1zZWxlY3RhYmxlXScpO1xuICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKCRvcHRpb25zLCAoJG9wdGlvbiA/ICRvcHRpb25bMF0gOiBudWxsKSkgKyBkaXJlY3Rpb247XG5cbiAgICAgICAgcmV0dXJuIGluZGV4ID49IDAgJiYgaW5kZXggPCAoJG9wdGlvbnMgPyAkb3B0aW9ucy5sZW5ndGggOiAwKSA/ICQoJG9wdGlvbnNbaW5kZXhdKSA6ICQoKTtcbiAgICB9LFxuXG4gICAgZ2V0RWxlbWVudFdpdGhWYWx1ZTogZnVuY3Rpb24odmFsdWUsICRlbHMpIHtcbiAgICAgICAgdmFsdWUgPSBoYXNoX2tleSh2YWx1ZSk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gKCRlbHMgPyAkZWxzLmxlbmd0aCA6IDApOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRlbHNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJykgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkKCRlbHNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkKCk7XG4gICAgfSxcblxuICAgIGdldEl0ZW06IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEVsZW1lbnRXaXRoVmFsdWUodmFsdWUsIHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oKSk7XG4gICAgfSxcblxuICAgIGFkZEl0ZW1zOiBmdW5jdGlvbih2YWx1ZXMsIHNpbGVudCkge1xuICAgICAgICB2YXIgaXRlbXMgPSBpc0FycmF5KHZhbHVlcykgPyB2YWx1ZXMgOiBbdmFsdWVzXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBpdGVtcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuaXNQZW5kaW5nID0gKGkgPCBuIC0gMSk7XG4gICAgICAgICAgICB0aGlzLmFkZEl0ZW0oaXRlbXNbaV0sIHNpbGVudCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkSXRlbTogZnVuY3Rpb24odmFsdWUsIHNpbGVudCkge1xuICAgICAgICB2YXIgZXZlbnRzID0gc2lsZW50ID8gW10gOiBbJ2NoYW5nZSddO1xuXG4gICAgICAgIGRlYm91bmNlX2V2ZW50cyh0aGlzLCBldmVudHMsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRpdGVtLCAkb3B0aW9uLCAkb3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpbnB1dE1vZGUgPSB0aGlzLm9wdGlvbnMubW9kZTtcbiAgICAgICAgICAgIHZhciBpLCBhY3RpdmUsIHZhbHVlX25leHQsIHdhc0Z1bGw7XG4gICAgICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KHZhbHVlKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMuaW5kZXhPZih2YWx1ZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy8gZzUgY3VzdG9tIFtiZWZvcmU6ICYmIHRoaXMuaXNPcGVuXVxuICAgICAgICAgICAgICAgIGlmIChpbnB1dE1vZGUgPT09ICdzaW5nbGUnKSB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSkpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChpbnB1dE1vZGUgPT09ICdzaW5nbGUnKSB0aGlzLmNsZWFyKHNpbGVudCk7XG4gICAgICAgICAgICBpZiAoaW5wdXRNb2RlID09PSAnbXVsdGknICYmIHRoaXMuaXNGdWxsKCkpIHJldHVybjtcblxuICAgICAgICAgICAgJGl0ZW0gPSAkKHRoaXMucmVuZGVyKCdpdGVtJywgdGhpcy5PcHRpb25zW3ZhbHVlXSkpO1xuICAgICAgICAgICAgLy8gaWYgKGlucHV0TW9kZSAhPT0gJ211bHRpJykgJGl0ZW0uZmluZCgnLmctcmVtb3ZlLXNpbmdsZS1pdGVtJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIEFSSUFcbiAgICAgICAgICAgICRpdGVtLmF0dHJpYnV0ZSgnaWQnLCB0aGlzLnJhbmQgKyAnLScgKyBzbHVnaWZ5KCRpdGVtLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKSk7XG4gICAgICAgICAgICBpZiAoaW5wdXRNb2RlID09PSAnbXVsdGknKSAkaXRlbS5hdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgd2FzRnVsbCA9IHRoaXMuaXNGdWxsKCk7XG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh0aGlzLmNhcmV0UG9zLCAwLCB2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLmluc2VydEF0Q2FyZXQoJGl0ZW0pO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUGVuZGluZyB8fCAoIXdhc0Z1bGwgJiYgdGhpcy5pc0Z1bGwoKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc1NldHVwKSB7XG4gICAgICAgICAgICAgICAgJG9wdGlvbnMgPSB0aGlzLiRkcm9wZG93bl9jb250ZW50LnNlYXJjaCgnW2RhdGEtc2VsZWN0YWJsZV0nKTtcblxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBtZW51IC8gcmVtb3ZlIHRoZSBvcHRpb24gKGlmIHRoaXMgaXMgbm90IG9uZSBpdGVtIGJlaW5nIGFkZGVkIGFzIHBhcnQgb2Ygc2VyaWVzKVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1BlbmRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbiA9IHRoaXMuZ2V0T3B0aW9uKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkaiA9IHRoaXMuZ2V0QWRqYWNlbnRPcHRpb24oJG9wdGlvbiwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlX25leHQgPSAoYWRqKSA/IGFkai5hdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModGhpcy5pc0ZvY3VzZWQgJiYgaW5wdXRNb2RlICE9PSAnc2luZ2xlJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZV9uZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbih0aGlzLmdldE9wdGlvbih2YWx1ZV9uZXh0KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBoaWRlIHRoZSBtZW51IGlmIHRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyBoYXZlIGJlZW4gc2VsZWN0ZWQgb3Igbm8gb3B0aW9ucyBhcmUgbGVmdFxuICAgICAgICAgICAgICAgIGlmICghJG9wdGlvbnMgfHwgdGhpcy5pc0Z1bGwoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkRyb3Bkb3duKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQbGFjZWhvbGRlcigpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnaXRlbV9hZGQnLCB2YWx1ZSwgJGl0ZW0pO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3JpZ2luYWxJbnB1dCh7IHNpbGVudDogc2lsZW50IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlSXRlbTogZnVuY3Rpb24odmFsdWUsIHNpbGVudCkge1xuICAgICAgICB2YXIgJGl0ZW0sIGksIGlkeDtcblxuICAgICAgICAkaXRlbSA9ICh2YWx1ZSBpbnN0YW5jZW9mICQpID8gdmFsdWUgOiB0aGlzLmdldEl0ZW0odmFsdWUpO1xuICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KCRpdGVtLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKTtcbiAgICAgICAgaSA9IHRoaXMuaXRlbXMuaW5kZXhPZih2YWx1ZSk7XG5cbiAgICAgICAgaWYgKGkgIT09IC0xKSB7XG4gICAgICAgICAgICAkaXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGlmICgkaXRlbS5oYXNDbGFzcygnZy1hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIGlkeCA9IHRoaXMuJGFjdGl2ZUl0ZW1zLmluZGV4T2YoJGl0ZW1bMF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnBlcnNpc3QgJiYgdGhpcy5Vc2VyT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU9wdGlvbih2YWx1ZSwgc2lsZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGkgPCB0aGlzLmNhcmV0UG9zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDYXJldCh0aGlzLmNhcmV0UG9zIC0gMSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucmVmcmVzaFN0YXRlKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU9yaWdpbmFsSW5wdXQoeyBzaWxlbnQ6IHNpbGVudCB9KTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25Ecm9wZG93bigpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdpdGVtX3JlbW92ZScsIHZhbHVlLCAkaXRlbSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY3JlYXRlSXRlbTogZnVuY3Rpb24oaW5wdXQsIHRyaWdnZXJEcm9wZG93bikge1xuICAgICAgICB2YXIgY2FyZXQgPSB0aGlzLmNhcmV0UG9zO1xuICAgICAgICBpbnB1dCA9IGlucHV0IHx8IHRyaW0odGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpIHx8ICcnKTtcblxuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSBjYWxsYmFjayA9IGZ1bmN0aW9uKCkge307XG5cbiAgICAgICAgaWYgKCFpc0Jvb2xlYW4odHJpZ2dlckRyb3Bkb3duKSkge1xuICAgICAgICAgICAgdHJpZ2dlckRyb3Bkb3duID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5jYW5DcmVhdGUoaW5wdXQpKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sb2NrKCk7XG5cbiAgICAgICAgdmFyIHNldHVwID0gKHR5cGVvZiB0aGlzLm9wdGlvbnMuY3JlYXRlID09PSAnZnVuY3Rpb24nKSA/IHRoaXMub3B0aW9ucy5jcmVhdGUgOiBiaW5kKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICAgICAgZGF0YVt0aGlzLm9wdGlvbnMubGFiZWxGaWVsZF0gPSBpbnB1dDtcbiAgICAgICAgICAgIGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdID0gaW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdmFyIGNyZWF0ZSA9IG9uY2UoYmluZChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnVubG9jaygpO1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGhhc2hfa2V5KGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSByZXR1cm4gY2FsbGJhY2soKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRUZXh0Ym94VmFsdWUoJycpO1xuICAgICAgICAgICAgdGhpcy5hZGRPcHRpb24oZGF0YSk7XG4gICAgICAgICAgICB0aGlzLnNldENhcmV0KGNhcmV0KTtcbiAgICAgICAgICAgIHRoaXMuYWRkSXRlbSh2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hPcHRpb25zKHRyaWdnZXJEcm9wZG93biAmJiB0aGlzLm9wdGlvbnMubW9kZSAhPT0gJ3NpbmdsZScpO1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB2YXIgb3V0cHV0ID0gc2V0dXAuYXBwbHkodGhpcywgW2lucHV0LCBjcmVhdGVdKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvdXRwdXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjcmVhdGUob3V0cHV0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICByZWZyZXNoSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNTZXR1cCkge1xuICAgICAgICAgICAgdGhpcy5hZGRJdGVtKHRoaXMuaXRlbXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICAgICAgdGhpcy51cGRhdGVPcmlnaW5hbElucHV0KCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2hTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnZhbGlkO1xuICAgICAgICBpZiAodGhpcy5pc1JlcXVpcmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGgpIHRoaXMuaXNJbnZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncmVxdWlyZWQnLCB0aGlzLmlzSW52YWxpZCB8fCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZnJlc2hDbGFzc2VzKCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2hDbGFzc2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlzRnVsbCAgID0gdGhpcy5pc0Z1bGwoKSxcbiAgICAgICAgICAgIGlzTG9ja2VkID0gdGhpcy5pc0xvY2tlZDtcblxuICAgICAgICB0aGlzLiR3cmFwcGVyLnRvZ2dsZUNsYXNzKCdnLXJ0bCcsIHRoaXMucnRsKTtcblxuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdnLWZvY3VzJywgdGhpcy5pc0ZvY3VzZWQpO1xuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdnLWRpc2FibGVkJywgdGhpcy5pc0Rpc2FibGVkKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnZy1yZXF1aXJlZCcsIHRoaXMuaXNSZXF1aXJlZCk7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2ctaW52YWxpZCcsIHRoaXMuaXNJbnZhbGlkKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnZy1sb2NrZWQnLCBpc0xvY2tlZCk7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2ctZnVsbCcsIGlzRnVsbCk7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2ctbm90LWZ1bGwnLCAhaXNGdWxsKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnZy1pbnB1dC1hY3RpdmUnLCB0aGlzLmlzRm9jdXNlZCAmJiAhdGhpcy5pc0lucHV0SGlkZGVuKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnZy1kcm9wZG93bi1hY3RpdmUnLCB0aGlzLmlzT3Blbik7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2ctaGFzLW9wdGlvbnMnLCAhc2l6ZSh0aGlzLm9wdGlvbnMuT3B0aW9ucykpO1xuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdnLWhhcy1pdGVtcycsIHRoaXMuaXRlbXMubGVuZ3RoID4gMCk7XG5cbiAgICAgICAgLy8gQVJJQVxuICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuJHdyYXBwZXJcbiAgICAgICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLW93bnMnLCB0aGlzLnJhbmQpXG4gICAgICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jywgc2x1Z2lmeSh0aGlzLnJhbmQgKyAnLScgKyB0aGlzLmdldFZhbHVlKCkpKVxuICAgICAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgdGhpcy4kZHJvcGRvd25fY29udGVudFxuICAgICAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kd3JhcHBlclxuICAgICAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtb3ducycsIG51bGwpXG4gICAgICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50JywgbnVsbClcbiAgICAgICAgICAgICAgICAuYXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpO1xuXG4gICAgICAgICAgICB0aGlzLiRkcm9wZG93bl9jb250ZW50XG4gICAgICAgICAgICAgICAgLmF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKVxuICAgICAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0LnNlbGVjdGl6ZUdyb3cgPSAhaXNGdWxsICYmICFpc0xvY2tlZDtcbiAgICB9LFxuXG4gICAgaXNGdWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tYXhJdGVtcyAhPT0gbnVsbCAmJiB0aGlzLml0ZW1zLmxlbmd0aCA+PSB0aGlzLm9wdGlvbnMubWF4SXRlbXM7XG4gICAgfSxcblxuICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQ6IGZ1bmN0aW9uKG9wdHMpIHtcbiAgICAgICAgdmFyIG9wdGlvbnMsIGxhYmVsO1xuICAgICAgICBvcHRzID0gb3B0cyB8fCB7fTtcblxuICAgICAgICBpZiAodGhpcy50YWdUeXBlID09PSBUQUdfU0VMRUNUKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMuaXRlbXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSB0aGlzLk9wdGlvbnNbdGhpcy5pdGVtc1tpXV1bdGhpcy5vcHRpb25zLmxhYmVsRmllbGRdIHx8ICcnO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaCgnPG9wdGlvbiB2YWx1ZT1cIicgKyBlc2NhcGVIVE1MKHRoaXMuaXRlbXNbaV0pICsgJ1wiIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj4nICsgZXNjYXBlSFRNTChsYWJlbCkgKyAnPC9vcHRpb24+Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMubGVuZ3RoICYmICF0aGlzLmlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnKSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaCgnPG9wdGlvbiB2YWx1ZT1cIlwiIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj48L29wdGlvbj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW5wdXQuaHRtbChvcHRpb25zLmpvaW4oJycpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuYXR0cmlidXRlKCd2YWx1ZScsIHRoaXMuaW5wdXQudmFsdWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc1NldHVwICYmICFvcHRzLnNpbGVudCkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdjaGFuZ2UnLCB0aGlzLmlucHV0LnZhbHVlKCkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZVBsYWNlaG9sZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpIHJldHVybjtcbiAgICAgICAgdmFyIGNvbnRyb2xfaW5wdXQgPSB0aGlzLiRjb250cm9sX2lucHV0O1xuXG4gICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgY29udHJvbF9pbnB1dC5hdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRyb2xfaW5wdXQuZW1pdCgndXBkYXRlJywgeyBmb3JjZTogdHJ1ZSB9KTtcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzTG9ja2VkIHx8IHRoaXMuaXNPcGVuIHx8ICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ211bHRpJyAmJiB0aGlzLmlzRnVsbCgpKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICAgICAgdGhpcy4kZHJvcGRvd24uc3R5bGUoe1xuICAgICAgICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsXG4gICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uRHJvcGRvd24oKTtcbiAgICAgICAgdGhpcy4kZHJvcGRvd24uc3R5bGUoeyB2aXNpYmlsaXR5OiAndmlzaWJsZScgfSk7XG4gICAgICAgIHRoaXMuZW1pdCgnZHJvcGRvd25fb3BlbicsIHRoaXMuJGRyb3Bkb3duKTtcbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdHJpZ2dlciA9IHRoaXMuaXNPcGVuO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ3NpbmdsZScgJiYgdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUlucHV0KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRkcm9wZG93bi5oaWRlKCk7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKG51bGwpO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuXG4gICAgICAgIGlmICh0cmlnZ2VyKSB0aGlzLmVtaXQoJ2Ryb3Bkb3duX2Nsb3NlJywgdGhpcy4kZHJvcGRvd24pO1xuICAgIH0sXG5cbiAgICBwb3NpdGlvbkRyb3Bkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNvbnRyb2wgPSB0aGlzLiRjb250cm9sLFxuICAgICAgICAgICAgb2Zmc2V0ICA9IGNvbnRyb2wucG9zaXRpb24oKTsvL3RoaXMub3B0aW9ucy5kcm9wZG93blBhcmVudCA9PT0gJ2JvZHknID8gY29udHJvbC5vZmZzZXQoKSA6IGNvbnRyb2wucG9zaXRpb24oKTtcbiAgICAgICAgb2Zmc2V0LnRvcCArPSBjb250cm9sWzBdLm9mZnNldEhlaWdodDtcblxuICAgICAgICB0aGlzLiRkcm9wZG93bi5zdHlsZSh7XG4gICAgICAgICAgICB3aWR0aDogY29udHJvbFswXS5vZmZzZXRXaWR0aCxcbiAgICAgICAgICAgIHRvcDogY29udHJvbFswXS5vZmZzZXRUb3AgKyBjb250cm9sWzBdLm9mZnNldEhlaWdodCxcbiAgICAgICAgICAgIGxlZnQ6IGNvbnRyb2xbMF0ub2Zmc2V0TGVmdFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKHNpbGVudCkge1xuICAgICAgICBpZiAoIXRoaXMuaXRlbXMubGVuZ3RoKSByZXR1cm47XG5cbiAgICAgICAgdmFyIG5vbl9pbnB1dCA9IHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oJzpub3QoaW5wdXQpJyk7XG4gICAgICAgIGlmIChub25faW5wdXQpIG5vbl9pbnB1dC5yZW1vdmUoKTtcblxuICAgICAgICB0aGlzLml0ZW1zID0gW107XG4gICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5zZXRDYXJldCgwKTtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKG51bGwpO1xuICAgICAgICB0aGlzLnVwZGF0ZVBsYWNlaG9sZGVyKCk7XG4gICAgICAgIHRoaXMudXBkYXRlT3JpZ2luYWxJbnB1dCh7IHNpbGVudDogc2lsZW50IH0pO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICB0aGlzLnNob3dJbnB1dCgpO1xuICAgICAgICB0aGlzLmVtaXQoJ2NsZWFyJyk7XG4gICAgfSxcblxuICAgIGluc2VydEF0Q2FyZXQ6IGZ1bmN0aW9uKCRlbCkge1xuICAgICAgICB2YXIgY2FyZXQgPSBNYXRoLm1pbih0aGlzLmNhcmV0UG9zLCB0aGlzLml0ZW1zLmxlbmd0aCk7XG4gICAgICAgIGlmIChjYXJldCA9PT0gMCkge1xuICAgICAgICAgICAgJGVsLnRvcCh0aGlzLiRjb250cm9sKTsvLy5wcmVwZW5kKCRlbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyQodGhpcy4kY29udHJvbFswXS5jaGlsZE5vZGVzW2NhcmV0XSkuYmVmb3JlKCRlbCk7XG4gICAgICAgICAgICAkZWwuYWZ0ZXIodGhpcy4kY29udHJvbC5maW5kKCc6bnRoLWNoaWxkKCcgKyBjYXJldCArICcpJykpO1xuICAgICAgICAgICAgLy90aGlzLiRjb250cm9sLmZpbmQoJzpudGgtY2hpbGQoJyArIGNhcmV0ICsgJyknKS5iZWZvcmUoJGVsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldENhcmV0KGNhcmV0ICsgMSk7XG4gICAgfSxcblxuICAgIGRlbGV0ZVNlbGVjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgaSwgbiwgZGlyZWN0aW9uLCBzZWxlY3Rpb24sIHZhbHVlcywgY2FyZXQsIG9wdGlvbl9zZWxlY3QsICRvcHRpb25fc2VsZWN0LCAkdGFpbDtcblxuICAgICAgICBkaXJlY3Rpb24gPSAoZSAmJiBlLmtleUNvZGUgPT09IEtFWV9CQUNLU1BBQ0UpID8gLTEgOiAxO1xuICAgICAgICBzZWxlY3Rpb24gPSBnZXRTZWxlY3Rpb24odGhpcy4kY29udHJvbF9pbnB1dFswXSk7XG5cbiAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZU9wdGlvbiAmJiAhdGhpcy5vcHRpb25zLmhpZGVTZWxlY3RlZCkge1xuICAgICAgICAgICAgb3B0aW9uX3NlbGVjdCA9IHRoaXMuZ2V0QWRqYWNlbnRPcHRpb24odGhpcy4kYWN0aXZlT3B0aW9uLCAtMSk7XG4gICAgICAgICAgICBpZiAob3B0aW9uX3NlbGVjdCkgeyBvcHRpb25fc2VsZWN0ID0gb3B0aW9uX3NlbGVjdC5hdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGV0ZXJtaW5lIGl0ZW1zIHRoYXQgd2lsbCBiZSByZW1vdmVkXG4gICAgICAgIHZhbHVlcyA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLiRhY3RpdmVJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oJzpub3QoaW5wdXQpJyk7XG4gICAgICAgICAgICAkdGFpbCA9IHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oJy5nLWFjdGl2ZScpO1xuICAgICAgICAgICAgaWYgKCR0YWlsKSB7ICR0YWlsID0gJChkaXJlY3Rpb24gPiAwID8gbGFzdCgkdGFpbCkgOiAkdGFpbFswXSk7IH1cbiAgICAgICAgICAgIGNhcmV0ID0gKCFjaGlsZHJlbiA/IC0xIDogaW5kZXhPZihjaGlsZHJlbiwgJHRhaWxbMF0pKTtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPiAwKSB7IGNhcmV0Kys7IH1cblxuICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKCQodGhpcy4kYWN0aXZlSXRlbXNbaV0pLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoKHRoaXMuaXNGb2N1c2VkIHx8IHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJykgJiYgdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPCAwICYmIHNlbGVjdGlvbi5zdGFydCA9PT0gMCAmJiBzZWxlY3Rpb24ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5pdGVtc1t0aGlzLmNhcmV0UG9zIC0gMV0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPiAwICYmIHNlbGVjdGlvbi5zdGFydCA9PT0gdGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHRoaXMuaXRlbXNbdGhpcy5jYXJldFBvc10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxsb3cgdGhlIGNhbGxiYWNrIHRvIGFib3J0XG4gICAgICAgIGlmICghdmFsdWVzLmxlbmd0aCB8fCAodHlwZW9mIHRoaXMub3B0aW9ucy5vbkRlbGV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0aGlzLm9wdGlvbnMub25EZWxldGUuYXBwbHkodGhpcywgW3ZhbHVlc10pID09PSBmYWxzZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBlcmZvcm0gcmVtb3ZhbFxuICAgICAgICBpZiAodHlwZW9mIGNhcmV0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXRDYXJldChjYXJldCk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKHZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSXRlbSh2YWx1ZXMucG9wKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zaG93SW5wdXQoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbkRyb3Bkb3duKCk7XG4gICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModHJ1ZSk7XG5cbiAgICAgICAgLy8gc2VsZWN0IHByZXZpb3VzIG9wdGlvblxuICAgICAgICBpZiAob3B0aW9uX3NlbGVjdCkge1xuICAgICAgICAgICAgJG9wdGlvbl9zZWxlY3QgPSB0aGlzLmdldE9wdGlvbihvcHRpb25fc2VsZWN0KTtcbiAgICAgICAgICAgIGlmICgkb3B0aW9uX3NlbGVjdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbigkb3B0aW9uX3NlbGVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgYWR2YW5jZVNlbGVjdGlvbjogZnVuY3Rpb24oZGlyZWN0aW9uLCBlKSB7XG4gICAgICAgIHZhciB0YWlsLCBzZWxlY3Rpb24sIGlkeCwgdmFsdWVMZW5ndGgsIGN1cnNvckF0RWRnZSwgJHRhaWw7XG5cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gMCkgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5ydGwpIGRpcmVjdGlvbiAqPSAtMTtcblxuICAgICAgICB0YWlsID0gZGlyZWN0aW9uID4gMCA/ICdsYXN0LWNoaWxkJyA6ICdmaXJzdC1jaGlsZCc7XG4gICAgICAgIHNlbGVjdGlvbiA9IGdldFNlbGVjdGlvbih0aGlzLiRjb250cm9sX2lucHV0WzBdKTtcblxuICAgICAgICBpZiAodGhpcy5pc0ZvY3VzZWQgJiYgIXRoaXMuaXNJbnB1dEhpZGRlbikge1xuICAgICAgICAgICAgdmFsdWVMZW5ndGggPSB0aGlzLiRjb250cm9sX2lucHV0LnZhbHVlKCkubGVuZ3RoO1xuICAgICAgICAgICAgY3Vyc29yQXRFZGdlID0gZGlyZWN0aW9uIDwgMFxuICAgICAgICAgICAgICAgID8gc2VsZWN0aW9uLnN0YXJ0ID09PSAwICYmIHNlbGVjdGlvbi5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICA6IHNlbGVjdGlvbi5zdGFydCA9PT0gdmFsdWVMZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChjdXJzb3JBdEVkZ2UgJiYgIXZhbHVlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZHZhbmNlQ2FyZXQoZGlyZWN0aW9uLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR0YWlsID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignLmctYWN0aXZlOicgKyB0YWlsKTtcbiAgICAgICAgICAgIGlmICgkdGFpbCkge1xuICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4T2YodGhpcy4kY29udHJvbC5jaGlsZHJlbignOm5vdChpbnB1dCknKSwgJHRhaWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShudWxsKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldENhcmV0KGRpcmVjdGlvbiA+IDAgPyBpZHggKyAxIDogaWR4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZHZhbmNlQ2FyZXQ6IGZ1bmN0aW9uKGRpcmVjdGlvbiwgZSkge1xuICAgICAgICB2YXIgZm4sICRhZGo7XG5cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIGZuID0gZGlyZWN0aW9uID4gMCA/ICduZXh0U2libGluZycgOiAncHJldmlvdXNTaWJsaW5nJztcbiAgICAgICAgaWYgKHRoaXMuaXNTaGlmdERvd24pIHtcbiAgICAgICAgICAgICRhZGogPSB0aGlzLiRjb250cm9sX2lucHV0W2ZuXSgpO1xuICAgICAgICAgICAgaWYgKCRhZGopIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVJbnB1dCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbSgkYWRqKTtcbiAgICAgICAgICAgICAgICBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FyZXQodGhpcy5jYXJldFBvcyArIGRpcmVjdGlvbik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0Q2FyZXQ6IGZ1bmN0aW9uKGkpIHtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgICBpID0gdGhpcy5pdGVtcy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odGhpcy5pdGVtcy5sZW5ndGgsIGkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc1BlbmRpbmcpIHtcbiAgICAgICAgICAgIC8vIHRoZSBpbnB1dCBtdXN0IGJlIG1vdmVkIGJ5IGxlYXZpbmcgaXQgaW4gcGxhY2UgYW5kIG1vdmluZyB0aGVcbiAgICAgICAgICAgIC8vIHNpYmxpbmdzLCBkdWUgdG8gdGhlIGZhY3QgdGhhdCBmb2N1cyBjYW5ub3QgYmUgcmVzdG9yZWQgb25jZSBsb3N0XG4gICAgICAgICAgICAvLyBvbiBtb2JpbGUgd2Via2l0IGRldmljZXNcbiAgICAgICAgICAgIHZhciBqLCBuLCBmbiwgJGNoaWxkcmVuLCAkY2hpbGQ7XG4gICAgICAgICAgICAkY2hpbGRyZW4gPSB0aGlzLiRjb250cm9sLmNoaWxkcmVuKCc6bm90KGlucHV0KScpO1xuICAgICAgICAgICAgZm9yIChqID0gMCwgbiA9ICgkY2hpbGRyZW4gPyAkY2hpbGRyZW4ubGVuZ3RoIDogMCk7IGogPCBuOyBqKyspIHtcbiAgICAgICAgICAgICAgICAkY2hpbGQgPSAkKCRjaGlsZHJlbltqXSk7Ly8uZGV0YWNoKCk7XG4gICAgICAgICAgICAgICAgaWYgKGogPCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICRjaGlsZC5iZWZvcmUodGhpcy4kY29udHJvbF9pbnB1dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udHJvbC5hcHBlbmRDaGlsZCgkY2hpbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2FyZXRQb3MgPSBpO1xuICAgIH0sXG5cbiAgICBsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB0aGlzLmlzTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICB9LFxuXG4gICAgdW5sb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0xvY2tlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgIH0sXG5cbiAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pbnB1dC5kaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgdGhpcy4kY29udHJvbF9pbnB1dC5hdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSkuYXR0cmlidXRlKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2NrKCk7XG4gICAgfSxcblxuICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5wdXQuYXR0cmlidXRlKCdkaXNhYmxlZCcsIG51bGwpO1xuICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgnZGlzYWJsZWQnLCBudWxsKS5hdHRyaWJ1dGUoJ3RhYmluZGV4JywgdGhpcy50YWJJbmRleCk7XG4gICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnVubG9jaygpO1xuICAgIH0sXG5cbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJldmVydFNldHRpbmdzID0gdGhpcy5yZXZlcnRTZXR0aW5ncztcblxuICAgICAgICB0aGlzLmVtaXQoJ2Rlc3Ryb3knKTtcbiAgICAgICAgdGhpcy5vZmYoKTtcbiAgICAgICAgdGhpcy4kd3JhcHBlci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy4kZHJvcGRvd24ucmVtb3ZlKCk7XG5cbiAgICAgICAgdGhpcy5pbnB1dFxuICAgICAgICAgICAgLmh0bWwoJycpXG4gICAgICAgICAgICAuYXBwZW5kQ2hpbGQocmV2ZXJ0U2V0dGluZ3MuJGNoaWxkcmVuKVxuICAgICAgICAgICAgLmF0dHJpYnV0ZSgndGFiaW5kZXgnLCBudWxsKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdzZWxlY3RpemVkJylcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoeyB0YWJpbmRleDogcmV2ZXJ0U2V0dGluZ3MudGFiaW5kZXggfSlcbiAgICAgICAgICAgIC5zaG93KCk7XG5cbiAgICAgICAgLyokKHdpbmRvdykub2ZmKGV2ZW50TlMpO1xuICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50TlMpO1xuICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vZmYoZXZlbnROUyk7Ki9cblxuICAgICAgICBkZWxldGUgdGhpcy4kY29udHJvbF9pbnB1dC5zZWxlY3RpemVHcm93O1xuICAgICAgICBkZWxldGUgdGhpcy5pbnB1dC5zZWxlY3RpemVJbnN0YW5jZTtcbiAgICAgICAgZGVsZXRlIHRoaXMuaW5wdXRbMF0uc2VsZWN0aXplO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uKHRlbXBsYXRlTmFtZSwgZGF0YSkge1xuICAgICAgICB2YXIgdmFsdWUsIGlkLCBsYWJlbDtcbiAgICAgICAgdmFyIG5hbWUgPSAnJztcbiAgICAgICAgdmFyIGNhY2hlID0gZmFsc2U7XG4gICAgICAgIHZhciByZWdleF90YWcgPSAvXltcXHQgXFxyXFxuXSo8KFthLXpdW2EtejAtOVxcLV9dKig/OlxcOlthLXpdW2EtejAtOVxcLV9dKik/KS9pO1xuXG4gICAgICAgIGlmICh0ZW1wbGF0ZU5hbWUgPT09ICdvcHRpb24nIHx8IHRlbXBsYXRlTmFtZSA9PT0gJ2l0ZW0nKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgICAgIGNhY2hlID0gISF2YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHB1bGwgbWFya3VwIGZyb20gY2FjaGUgaWYgaXQgZXhpc3RzXG4gICAgICAgIGlmIChjYWNoZSkge1xuICAgICAgICAgICAgaWYgKCFpc3NldCh0aGlzLnJlbmRlckNhY2hlW3RlbXBsYXRlTmFtZV0pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJDYWNoZVt0ZW1wbGF0ZU5hbWVdID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJDYWNoZVt0ZW1wbGF0ZU5hbWVdLmhhc093blByb3BlcnR5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckNhY2hlW3RlbXBsYXRlTmFtZV1bdmFsdWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmVuZGVyIG1hcmt1cFxuICAgICAgICB2YXIgaHRtbCA9IHplbignZGl2JykuaHRtbCh0aGlzLm9wdGlvbnMucmVuZGVyW3RlbXBsYXRlTmFtZV0uYXBwbHkodGhpcywgW2RhdGEsIGVzY2FwZUhUTUxdKSk7XG4gICAgICAgIGh0bWwgPSBodG1sLmZpcnN0Q2hpbGQoKTtcblxuICAgICAgICAvLyBhZGQgbWFuZGF0b3J5IGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGlvbicgfHwgdGVtcGxhdGVOYW1lID09PSAnb3B0aW9uX2NyZWF0ZScpIHtcbiAgICAgICAgICAgIGh0bWwgPSBodG1sLmRhdGEoJ3NlbGVjdGFibGUnLCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGdyb3VwJykge1xuICAgICAgICAgICAgaWQgPSBkYXRhW3RoaXMub3B0aW9ucy5vcHRncm91cFZhbHVlRmllbGRdIHx8ICcnO1xuICAgICAgICAgICAgbmFtZSA9IGVzY2FwZV9yZXBsYWNlKGVzY2FwZUhUTUwoaWQpKTtcbiAgICAgICAgICAgIGh0bWwgPSBodG1sLmRhdGEoJ2dyb3VwJywgbmFtZSkuYXR0cmlidXRlKCdyb2xlJywgJ2dyb3VwJykuYXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGlvbicgfHwgdGVtcGxhdGVOYW1lID09PSAnaXRlbScpIHtcbiAgICAgICAgICAgIG5hbWUgPSBlc2NhcGVfcmVwbGFjZShlc2NhcGVIVE1MKHZhbHVlIHx8ICcnKSk7XG4gICAgICAgICAgICBodG1sID0gaHRtbC5kYXRhKCd2YWx1ZScsIG5hbWUpLmF0dHJpYnV0ZSgnaWQnLCBzbHVnaWZ5KHRoaXMucmFuZCArICctJyArIG5hbWUpKS5hdHRyaWJ1dGUoJ3JvbGUnLCAndHJlZWl0ZW0nKS5hdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCB0cmltKGRhdGEudGV4dCkpLmF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICdmYWxzZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIGNhY2hlXG4gICAgICAgIGlmIChjYWNoZSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJDYWNoZVt0ZW1wbGF0ZU5hbWVdW3ZhbHVlXSA9IGh0bWxbMF07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaHRtbFswXTtcbiAgICB9LFxuXG4gICAgY2xlYXJDYWNoZTogZnVuY3Rpb24odGVtcGxhdGVOYW1lKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGVtcGxhdGVOYW1lID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJDYWNoZSA9IHt9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucmVuZGVyQ2FjaGVbdGVtcGxhdGVOYW1lXTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjYW5DcmVhdGU6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmNyZWF0ZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICB2YXIgZmlsdGVyID0gdGhpcy5vcHRpb25zLmNyZWF0ZUZpbHRlcjtcbiAgICAgICAgcmV0dXJuIGlucHV0Lmxlbmd0aFxuICAgICAgICAgICAgJiYgKHR5cGVvZiBmaWx0ZXIgIT09ICdmdW5jdGlvbicgfHwgZmlsdGVyLmFwcGx5KHNlbGYsIFtpbnB1dF0pKVxuICAgICAgICAgICAgJiYgKHR5cGVvZiBmaWx0ZXIgIT09ICdzdHJpbmcnIHx8IG5ldyBSZWdFeHAoZmlsdGVyKS50ZXN0KGlucHV0KSlcbiAgICAgICAgICAgICYmICghKGZpbHRlciBpbnN0YW5jZW9mIFJlZ0V4cCkgfHwgZmlsdGVyLnRlc3QoaW5wdXQpKTtcbiAgICB9LFxuXG4gICAgZ2V0UHJldmlvdXNWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXZpb3VzVmFsdWU7XG4gICAgfVxufSk7XG5cbiQuaW1wbGVtZW50KHtcbiAgICBzZWxlY3RpemU6IGZ1bmN0aW9uKHNldHRpbmdzX3VzZXIpIHtcbiAgICAgICAgc2V0dGluZ3NfdXNlciA9IHNldHRpbmdzX3VzZXIgfHwge307XG4gICAgICAgIHZhciBkZWZhdWx0cyAgICAgICAgICAgICA9IFNlbGVjdGl6ZS5wcm90b3R5cGUub3B0aW9ucyxcbiAgICAgICAgICAgIHNldHRpbmdzICAgICAgICAgICAgID0gbWVyZ2Uoe30sIGRlZmF1bHRzLCBzZXR0aW5nc191c2VyKSxcbiAgICAgICAgICAgIGF0dHJfZGF0YSAgICAgICAgICAgID0gc2V0dGluZ3MuZGF0YUF0dHIsXG4gICAgICAgICAgICBmaWVsZF9sYWJlbCAgICAgICAgICA9IHNldHRpbmdzLmxhYmVsRmllbGQsXG4gICAgICAgICAgICBmaWVsZF92YWx1ZSAgICAgICAgICA9IHNldHRpbmdzLnZhbHVlRmllbGQsXG4gICAgICAgICAgICBmaWVsZF9vcHRncm91cCAgICAgICA9IHNldHRpbmdzLm9wdGdyb3VwRmllbGQsXG4gICAgICAgICAgICBmaWVsZF9vcHRncm91cF9sYWJlbCA9IHNldHRpbmdzLm9wdGdyb3VwTGFiZWxGaWVsZCxcbiAgICAgICAgICAgIGZpZWxkX29wdGdyb3VwX3ZhbHVlID0gc2V0dGluZ3Mub3B0Z3JvdXBWYWx1ZUZpZWxkO1xuXG4gICAgICAgIHZhciBpbml0X3RleHRib3ggPSBmdW5jdGlvbihpbnB1dCwgc2V0dGluZ3NfZWxlbWVudCkge1xuICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgIHZhciBpLCBuLCB2YWx1ZXMsIG9wdGlvbjtcblxuICAgICAgICAgICAgdmFyIGRhdGFfcmF3ID0gaW5wdXQuYXR0cmlidXRlKGF0dHJfZGF0YSk7XG5cbiAgICAgICAgICAgIGlmICghZGF0YV9yYXcpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB0cmltKGlucHV0LnZhbHVlKCkgfHwgJycpO1xuICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MuYWxsb3dFbXB0eU9wdGlvbiAmJiAhdmFsdWUubGVuZ3RoKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZS5zcGxpdChzZXR0aW5ncy5kZWxpbWl0ZXIpO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSB2YWx1ZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25bZmllbGRfbGFiZWxdID0gdmFsdWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25bZmllbGRfdmFsdWVdID0gdmFsdWVzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzX2VsZW1lbnQuT3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2V0dGluZ3NfZWxlbWVudC5pdGVtcyA9IHZhbHVlcztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3NfZWxlbWVudC5PcHRpb25zID0gSlNPTi5wYXJzZShkYXRhX3Jhdyk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IHNldHRpbmdzX2VsZW1lbnQuT3B0aW9ucy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfZWxlbWVudC5pdGVtcy5wdXNoKHNldHRpbmdzX2VsZW1lbnQuT3B0aW9uc1tpXVtmaWVsZF92YWx1ZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdF9zZWxlY3QgPSBmdW5jdGlvbihpbnB1dCwgc2V0dGluZ3NfZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGksIG4sIHRhZ05hbWUsIGNoaWxkcmVuLCBvcmRlciA9IDA7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHNldHRpbmdzX2VsZW1lbnQuT3B0aW9ucztcbiAgICAgICAgICAgIHZhciBvcHRpb25zTWFwID0ge307XG5cbiAgICAgICAgICAgIHZhciByZWFkRGF0YSA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBhdHRyX2RhdGEgJiYgZWwuYXR0cmlidXRlKGF0dHJfZGF0YSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyAmJiBkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgYWRkT3B0aW9uID0gZnVuY3Rpb24ob3B0aW9uLCBncm91cCkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSwgb3B0O1xuXG4gICAgICAgICAgICAgICAgb3B0aW9uID0gJChvcHRpb24pO1xuXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBoYXNoX2tleShvcHRpb24udmFsdWUoKSk7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZS5sZW5ndGggJiYgIXNldHRpbmdzLmFsbG93RW1wdHlPcHRpb24pIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBvcHRpb24gYWxyZWFkeSBleGlzdHMsIGl0J3MgcHJvYmFibHkgYmVlblxuICAgICAgICAgICAgICAgIC8vIGR1cGxpY2F0ZWQgaW4gYW5vdGhlciBvcHRncm91cC4gaW4gdGhpcyBjYXNlLCBwdXNoXG4gICAgICAgICAgICAgICAgLy8gdGhlIGN1cnJlbnQgZ3JvdXAgdG8gdGhlIFwib3B0Z3JvdXBcIiBwcm9wZXJ0eSBvbiB0aGVcbiAgICAgICAgICAgICAgICAvLyBleGlzdGluZyBvcHRpb24gc28gdGhhdCBpdCdzIHJlbmRlcmVkIGluIGJvdGggcGxhY2VzLlxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zTWFwLmhhc093blByb3BlcnR5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcnIgPSBvcHRpb25zTWFwW3ZhbHVlXVtmaWVsZF9vcHRncm91cF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNNYXBbdmFsdWVdW2ZpZWxkX29wdGdyb3VwXSA9IGdyb3VwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNBcnJheShhcnIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc01hcFt2YWx1ZV1bZmllbGRfb3B0Z3JvdXBdID0gW2FyciwgZ3JvdXBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChncm91cCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdCA9IHJlYWREYXRhKG9wdGlvbikgfHwge307XG4gICAgICAgICAgICAgICAgb3B0W2ZpZWxkX2xhYmVsXSA9IG9wdFtmaWVsZF9sYWJlbF0gfHwgb3B0aW9uLnRleHQoKTtcbiAgICAgICAgICAgICAgICBvcHRbZmllbGRfdmFsdWVdID0gb3B0W2ZpZWxkX3ZhbHVlXSB8fCB2YWx1ZTtcbiAgICAgICAgICAgICAgICBvcHRbZmllbGRfb3B0Z3JvdXBdID0gb3B0W2ZpZWxkX29wdGdyb3VwXSB8fCBncm91cDtcblxuICAgICAgICAgICAgICAgIG9wdGlvbnNNYXBbdmFsdWVdID0gb3B0O1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaChvcHQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbi5tYXRjaGVzKCc6c2VsZWN0ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc19lbGVtZW50Lml0ZW1zLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBhZGRHcm91cCA9IGZ1bmN0aW9uKG9wdGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGksIG4sIGlkLCBvcHRncnAsIG9wdGlvbnM7XG5cbiAgICAgICAgICAgICAgICBvcHRncm91cCA9ICQob3B0Z3JvdXApO1xuICAgICAgICAgICAgICAgIGlkID0gb3B0Z3JvdXAuYXR0cmlidXRlKCdsYWJlbCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGdycCA9IHJlYWREYXRhKG9wdGdyb3VwKSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgb3B0Z3JwW2ZpZWxkX29wdGdyb3VwX2xhYmVsXSA9IGlkO1xuICAgICAgICAgICAgICAgICAgICBvcHRncnBbZmllbGRfb3B0Z3JvdXBfdmFsdWVdID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzX2VsZW1lbnQuT3B0Z3JvdXBzLnB1c2gob3B0Z3JwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0Z3JvdXAuc2VhcmNoKCdvcHRpb24nKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBuID0gb3B0aW9ucy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkT3B0aW9uKG9wdGlvbnNbaV0sIGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzZXR0aW5nc19lbGVtZW50Lm1heEl0ZW1zID0gaW5wdXQuYXR0cmlidXRlKCdtdWx0aXBsZScpID8gbnVsbCA6IDE7XG5cbiAgICAgICAgICAgIGNoaWxkcmVuID0gaW5wdXQuY2hpbGRyZW4oKSB8fCAwO1xuICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHRhZ05hbWUgPSBjaGlsZHJlbltpXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhZ05hbWUgPT09ICdvcHRncm91cCcpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkR3JvdXAoY2hpbGRyZW5baV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnTmFtZSA9PT0gJ29wdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkT3B0aW9uKGNoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbigkaW5wdXQsIGkpIHtcbiAgICAgICAgICAgIHNldHRpbmdzID0gbWVyZ2Uoe30sIGRlZmF1bHRzLCBzZXR0aW5nc191c2VyKSxcbiAgICAgICAgICAgICRpbnB1dCA9ICQoJGlucHV0KTtcbiAgICAgICAgICAgIGlmICgkaW5wdXQuc2VsZWN0aXplSW5zdGFuY2UpIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIGluc3RhbmNlLFxuICAgICAgICAgICAgICAgIGRhdGFPcHRpb25zID0gJGlucHV0LmRhdGEoJ3NlbGVjdGl6ZScpLFxuICAgICAgICAgICAgICAgIHRhZ19uYW1lICAgID0gJGlucHV0LnRhZygpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSAkaW5wdXQuYXR0cmlidXRlKCdwbGFjZWhvbGRlcicpIHx8ICRpbnB1dC5hdHRyaWJ1dGUoJ2RhdGEtcGxhY2Vob2xkZXInKTtcblxuICAgICAgICAgICAgLy8gZzUgY3VzdG9tXG4gICAgICAgICAgICBpZiAoZGF0YU9wdGlvbnMpIHsgZGF0YU9wdGlvbnMgPSBKU09OLnBhcnNlKGRhdGFPcHRpb25zKTsgfVxuICAgICAgICAgICAgc2V0dGluZ3MgPSBtZXJnZSh7fSwgc2V0dGluZ3MsIGRhdGFPcHRpb25zKTtcbiAgICAgICAgICAgIC8vIGVuZCBnNSBjdXN0b21cblxuICAgICAgICAgICAgaWYgKCFwbGFjZWhvbGRlciAmJiAhc2V0dGluZ3MuYWxsb3dFbXB0eU9wdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciBjaGxkcyA9ICRpbnB1dC5jaGlsZHJlbignb3B0aW9uW3ZhbHVlPVwiXCJdJyk7XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSBjaGxkcyA/ICRpbnB1dC5jaGlsZHJlbignb3B0aW9uW3ZhbHVlPVwiXCJdJykudGV4dCgpIDogJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5nc19lbGVtZW50ID0ge1xuICAgICAgICAgICAgICAgICdwbGFjZWhvbGRlcic6IHBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgICAgICdPcHRpb25zJzogW10sXG4gICAgICAgICAgICAgICAgJ09wdGdyb3Vwcyc6IFtdLFxuICAgICAgICAgICAgICAgICdpdGVtcyc6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodGFnX25hbWUgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgICAgICAgICAgaW5pdF9zZWxlY3QoJGlucHV0LCBzZXR0aW5nc19lbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaW5pdF90ZXh0Ym94KCRpbnB1dCwgc2V0dGluZ3NfZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGluc3RhbmNlID0gbmV3IFNlbGVjdGl6ZSgkaW5wdXQsIG1lcmdlKHt9LCBkZWZhdWx0cywgc2V0dGluZ3NfZWxlbWVudCwgc2V0dGluZ3NfdXNlciwgZGF0YU9wdGlvbnMpKTtcbiAgICAgICAgICAgICRpbnB1dC5zZWxlY3RpemVJbnN0YW5jZSA9IGluc3RhbmNlO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdHMgPSAkKCdbZGF0YS1zZWxlY3RpemVdJyk7XG4gICAgaWYgKCFzZWxlY3RzKSB7IHJldHVybjsgfVxuXG4gICAgc2VsZWN0cy5zZWxlY3RpemUoKTtcbn0pO1xuXG5cbm1vZHVsZS5leHBvcnRzID0gU2VsZWN0aXplO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBwcmltZSAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBFbWl0dGVyID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIHplbiAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICAkICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMuanMnKSxcbiAgICBzdG9yYWdlID0gcmVxdWlyZSgncHJpbWUvbWFwJykoKSxcblxuICAgIGJpbmQgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBtZXJnZSAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvbWVyZ2UnKTtcblxudmFyIFRvYXN0ZXIgPSBuZXcgcHJpbWUoe1xuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHRhcFRvRGlzbWlzczogdHJ1ZSxcbiAgICAgICAgbm90aWNlQ2xhc3M6ICdnLW5vdGlmaWNhdGlvbnMnLFxuICAgICAgICBjb250YWluZXJJRDogJ2ctbm90aWZpY2F0aW9ucy1jb250YWluZXInLFxuXG4gICAgICAgIHR5cGVzOiB7XG4gICAgICAgICAgICBiYXNlOiAnJyxcbiAgICAgICAgICAgIGVycm9yOiAnZmEtbWludXMtY2lyY2xlJyxcbiAgICAgICAgICAgIGluZm86ICdmYS1pbmZvLWNpcmNsZScsXG4gICAgICAgICAgICBzdWNjZXNzOiAnZmEtY2hlY2stY2lyY2xlJyxcbiAgICAgICAgICAgIHdhcm5pbmc6ICdmYS1leGNsYW1hdGlvbi10cmlhbmdsZSdcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93RHVyYXRpb246IDMwMCxcbiAgICAgICAgc2hvd0VxdWF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuMDIsIDAuMDEsIDAuNDcsIDEpJyxcbiAgICAgICAgaGlkZUR1cmF0aW9uOiA1MDAsXG4gICAgICAgIGhpZGVFcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjAyLCAwLjAxLCAwLjQ3LCAxKScsXG5cbiAgICAgICAgdGltZU91dDogMjUwMCwgLy8gdGltZU91dCBhbmQgZXh0ZW5kZWRUaW1lb3V0IHRvIDAgPT0gc3RpY2t5XG4gICAgICAgIGV4dGVuZGVkVGltZW91dDogMjUwMCxcblxuICAgICAgICBsb2NhdGlvbjogJ2JvdHRvbS1yaWdodCcsXG5cbiAgICAgICAgdGl0bGVDbGFzczogJ2ctbm90aWZpY2F0aW9ucy10aXRsZScsXG4gICAgICAgIG1lc3NhZ2VDbGFzczogJ2ctbm90aWZpY2F0aW9ucy1tZXNzYWdlJyxcbiAgICAgICAgY2xvc2VCdXR0b246IHRydWUsXG5cbiAgICAgICAgdGFyZ2V0OiAnI2c1LWNvbnRhaW5lcicsXG4gICAgICAgIHRhcmdldExvY2F0aW9uOiAnYm90dG9tJyxcblxuICAgICAgICBuZXdlc3RPblRvcDogdHJ1ZSxcbiAgICAgICAgcHJldmVudER1cGxpY2F0ZXM6IGZhbHNlLFxuICAgICAgICBwcm9ncmVzc0JhcjogdHJ1ZVxuXG5cbiAgICAgICAgLypcbiAgICAgICAgb25TaG93OiBmdW5jdGlvbigpIHt9LFxuICAgICAgICBvbkhpZGRlbjogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgb25DbGljazogZnVuY3Rpb24oKSB7fVxuICAgICAgICAqL1xuICAgIH0sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5pZCA9IDA7XG4gICAgICAgIHRoaXMucHJldmlvdXNOb3RpY2UgPSBudWxsO1xuICAgICAgICB0aGlzLm1hcCA9IHN0b3JhZ2U7XG4gICAgfSxcblxuICAgIG1lcmdlT3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbWVyZ2UodGhpcy5vcHRpb25zLCBvcHRpb25zIHx8IHt9KTtcbiAgICB9LFxuXG4gICAgYmFzZTogZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmeShtZXJnZShvcHRpb25zLCB7XG4gICAgICAgICAgICB0aXRsZTogdGl0bGUgfHwgJycsXG4gICAgICAgICAgICB0eXBlOiBvcHRpb25zLnR5cGUgfHwgJ2Jhc2UnLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnkobWVyZ2Uob3B0aW9ucywge1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlIHx8ICdTdWNjZXNzIScsXG4gICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH0pKTtcbiAgICB9LFxuXG4gICAgaW5mbzogZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmeShtZXJnZShvcHRpb25zLCB7XG4gICAgICAgICAgICB0aXRsZTogdGl0bGUgfHwgJ0luZm8nLFxuICAgICAgICAgICAgdHlwZTogJ2luZm8nLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KSk7XG4gICAgfSxcbiAgICB3YXJuaW5nOiBmdW5jdGlvbihtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KG1lcmdlKG9wdGlvbnMsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCAnV2FybmluZyEnLFxuICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIGVycm9yOiBmdW5jdGlvbihtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KG1lcmdlKG9wdGlvbnMsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCAnRXJyb3IhJyxcbiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH0pKTtcbiAgICB9LFxuXG4gICAgbm90aWZ5OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICBpZiAob3B0aW9ucy5wcmV2ZW50RHVwbGljYXRlcyAmJiB0aGlzLnByZXZpb3VzTm90aWNlID09PSBvcHRpb25zLm1lc3NhZ2UpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5pZCsrO1xuICAgICAgICB0aGlzLnByZXZpb3VzTm90aWNlID0gb3B0aW9ucy5tZXNzYWdlO1xuXG4gICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcihvcHRpb25zLCB0cnVlKSxcbiAgICAgICAgICAgIGVsZW1lbnQgPSB6ZW4oJ2RpdicpLCB0aXRsZSA9IHplbignZGl2JyksIG1lc3NhZ2UgPSB6ZW4oJ2RpdicpLFxuICAgICAgICAgICAgaWNvbiA9IHplbignaS5mYScpLFxuICAgICAgICAgICAgcHJvZ3Jlc3MgPSB6ZW4oJ2Rpdi5nLW5vdGlmaWNhdGlvbnMtcHJvZ3Jlc3MnKSxcbiAgICAgICAgICAgIGNsb3NlID0gemVuKCdhLmZhLmZhLWNsb3NlW2hyZWY9XCIjXCJdJyk7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgaW50ZXJ2YWw6IG51bGwsXG4gICAgICAgICAgICBwcm9ncmVzc0Jhcjoge1xuICAgICAgICAgICAgICAgIGludGVydmFsOiBudWxsLFxuICAgICAgICAgICAgICAgIGhpZGVFVEE6IG51bGwsXG4gICAgICAgICAgICAgICAgbWF4SGlkZVRpbWU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHN0YXRlOiAndmlzaWJsZScsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudGl0bGUpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGUuaHRtbChvcHRpb25zLnRpdGxlKS5hZGRDbGFzcyhvcHRpb25zLnRpdGxlQ2xhc3MpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobWVzc2FnZS5odG1sKG9wdGlvbnMubWVzc2FnZSkuYWRkQ2xhc3Mob3B0aW9ucy5tZXNzYWdlQ2xhc3MpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmNsb3NlQnV0dG9uKSB7XG4gICAgICAgICAgICBjbG9zZS50b3AoZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5wcm9ncmVzc0Jhcikge1xuICAgICAgICAgICAgcHJvZ3Jlc3MudG9wKGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudHlwZSAmJiBvcHRpb25zLnRpdGxlKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50eXBlc1tvcHRpb25zLnR5cGVdKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZy1ub3RpZmljYXRpb25zLXRoZW1lLScgKyBvcHRpb25zLnR5cGUpO1xuICAgICAgICAgICAgICAgIGljb24udG9wKHRpdGxlKS5hZGRDbGFzcyhvcHRpb25zLnR5cGVzW29wdGlvbnMudHlwZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5zdHlsZSh7IG9wYWNpdHk6IDAgfSk7XG4gICAgICAgIGVsZW1lbnRbb3B0aW9ucy5uZXdlc3RPblRvcCA/ICd0b3AnIDogJ2JvdHRvbSddKGNvbnRhaW5lcik7XG4gICAgICAgIGVsZW1lbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwge1xuICAgICAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuc2hvd0R1cmF0aW9uLFxuICAgICAgICAgICAgZXF1YXRpb246IG9wdGlvbnMuc2hvd0VxdWF0aW9uLFxuICAgICAgICAgICAgY2FsbGJhY2s6IG9wdGlvbnMub25TaG93XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChvcHRpb25zLnRpbWVPdXQgPiAwKSB7XG4gICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXAuZ2V0KGVsZW1lbnQpO1xuICAgICAgICAgICAgbWFwLmludGVydmFsID0gc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZShlbGVtZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpLCBvcHRpb25zLnRpbWVPdXQpO1xuICAgICAgICAgICAgbWFwLnByb2dyZXNzQmFyLm1heEhpZGVUaW1lID0gcGFyc2VGbG9hdChvcHRpb25zLnRpbWVPdXQpO1xuICAgICAgICAgICAgbWFwLnByb2dyZXNzQmFyLmhpZGVFVEEgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIG1hcC5wcm9ncmVzc0Jhci5tYXhIaWRlVGltZTtcblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMucHJvZ3Jlc3NCYXIpIHtcbiAgICAgICAgICAgICAgICBtYXAucHJvZ3Jlc3NCYXIuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKGVsZW1lbnQsIHByb2dyZXNzKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgMTApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm1hcC5zZXQoZWxlbWVudCwgbWFwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzdGljayA9IGJpbmQoZnVuY3Rpb24oKSB7IHRoaXMuc3RpY2tBcm91bmQoZWxlbWVudCk7IH0sIHRoaXMpLFxuICAgICAgICAgICAgZGVsYXkgPSBiaW5kKGZ1bmN0aW9uKCkgeyB0aGlzLmRlbGF5ZWRIaWRlKGVsZW1lbnQpOyB9LCB0aGlzKTtcbiAgICAgICAgZWxlbWVudC5vbignbW91c2VvdmVyJywgc3RpY2spO1xuICAgICAgICBlbGVtZW50Lm9uKCdtb3VzZW91dCcsIGRlbGF5KTtcblxuICAgICAgICBpZiAoIW9wdGlvbnMub25DbGljayAmJiBvcHRpb25zLnRhcFRvRGlzbWlzcykge1xuICAgICAgICAgICAgZWxlbWVudC5vbignY2xpY2snLCBiaW5kKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoJ21vdXNlb3ZlcicsIHN0aWNrKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZignbW91c2VvdXQnLCBkZWxheSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoZWxlbWVudCk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5jbG9zZUJ1dHRvbiAmJiBjbG9zZSkge1xuICAgICAgICAgICAgY2xvc2Uub24oJ2NsaWNrJywgYmluZChmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKCdtb3VzZW92ZXInLCBzdGljayk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoJ21vdXNlb3V0JywgZGVsYXkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZShlbGVtZW50LCB0cnVlKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgfSxcblxuICAgIHN0aWNrQXJvdW5kOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcC5nZXQoZWxlbWVudCk7XG5cbiAgICAgICAgY2xlYXJUaW1lb3V0KG1hcC5pbnRlcnZhbCk7XG4gICAgICAgIG1hcC5wcm9ncmVzc0Jhci5oaWRlRVRBID0gMDtcbiAgICAgICAgZWxlbWVudC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogbWFwLm9wdGlvbnMuc2hvd0R1cmF0aW9uLFxuICAgICAgICAgICAgZXF1YXRpb246IG1hcC5vcHRpb25zLnNob3dFcXVhdGlvbixcbiAgICAgICAgICAgIGNhbGxiYWNrOiBtYXAub3B0aW9ucy5vblNob3dcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIG1hcCk7XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKGVsZW1lbnQsIG92ZXJyaWRlKSB7XG4gICAgICAgIGlmIChlbGVtZW50LmZpbmQoJzpmb2N1cycpICYmICFvdmVycmlkZSkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXAuZ2V0KGVsZW1lbnQpO1xuXG4gICAgICAgIGNsZWFyVGltZW91dChtYXAucHJvZ3Jlc3NCYXIuaW50ZXJ2YWwpO1xuXG4gICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgICAgICByZXR1cm4gZWxlbWVudC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogbWFwLm9wdGlvbnMuaGlkZUR1cmF0aW9uLFxuICAgICAgICAgICAgZXF1YXRpb246IG1hcC5vcHRpb25zLmhpZGVFcXVhdGlvbixcbiAgICAgICAgICAgIGNhbGxiYWNrOiBiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGlmIChtYXAub3B0aW9ucy5vbkhpZGRlbiAmJiBtYXAucmVzcG9uc2Uuc3RhdGUgIT09ICdoaWRkZW4nKSB7IG1hcC5vcHRpb25zLm9uSGlkZGVuKCk7IH1cbiAgICAgICAgICAgICAgICBtYXAucmVzcG9uc2Uuc3RhdGUgPSAnaGlkZGVuJztcbiAgICAgICAgICAgICAgICBtYXAucmVzcG9uc2UuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1hcC5zZXQoZWxlbWVudCwgbWFwKTtcbiAgICAgICAgICAgIH0sIHRoaXMpXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBkZWxheWVkSGlkZTogZnVuY3Rpb24oZWxlbWVudCwgb3ZlcnJpZGUpIHtcbiAgICAgICAgdmFyIG1hcCA9IHRoaXMubWFwLmdldChlbGVtZW50KTtcblxuICAgICAgICBpZiAobWFwLm9wdGlvbnMudGltZU91dCA+IDAgfHwgbWFwLm9wdGlvbnMuZXh0ZW5kZWRUaW1lb3V0ID4gMCkge1xuICAgICAgICAgICAgbWFwLmludGVydmFsID0gc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZShlbGVtZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpLCBtYXAub3B0aW9ucy5leHRlbmRlZFRpbWVvdXQpO1xuICAgICAgICAgICAgbWFwLnByb2dyZXNzQmFyLm1heEhpZGVUaW1lID0gcGFyc2VGbG9hdChtYXAub3B0aW9ucy5leHRlbmRlZFRpbWVvdXQpO1xuICAgICAgICAgICAgbWFwLnByb2dyZXNzQmFyLmhpZGVFVEEgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIG1hcC5wcm9ncmVzc0Jhci5tYXhIaWRlVGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgIH0sXG5cbiAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24oZWxlbWVudCwgcHJvZ3Jlc3MpIHtcbiAgICAgICAgdmFyIG1hcCA9IHRoaXMubWFwLmdldChlbGVtZW50KSxcbiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAoKG1hcC5wcm9ncmVzc0Jhci5oaWRlRVRBIC0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSkgLyBtYXAucHJvZ3Jlc3NCYXIubWF4SGlkZVRpbWUpICogMTAwO1xuXG4gICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgICAgICBwcm9ncmVzcy5zdHlsZSh7IHdpZHRoOiBwZXJjZW50YWdlICsgJyUnIH0pO1xuICAgIH0sXG5cbiAgICBnZXRDb250YWluZXI6IGZ1bmN0aW9uKG9wdGlvbnMsIGNyZWF0ZSkge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoJyMnICsgb3B0aW9ucy5jb250YWluZXJJRCk7XG4gICAgICAgIGlmIChjb250YWluZXIpIHsgcmV0dXJuIGNvbnRhaW5lcjsgfVxuXG4gICAgICAgIGlmIChjcmVhdGUpIHsgY29udGFpbmVyID0gdGhpcy5jcmVhdGVDb250YWluZXIob3B0aW9ucyk7IH1cblxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH0sXG5cbiAgICBjcmVhdGVDb250YWluZXI6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB6ZW4oJ2RpdiMnICsgb3B0aW9ucy5jb250YWluZXJJRCArICcuJyArIG9wdGlvbnMubG9jYXRpb24pW29wdGlvbnMudGFyZ2V0TG9jYXRpb25dKG9wdGlvbnMudGFyZ2V0KS5hdHRyaWJ1dGUoJ2FyaWEtbGl2ZScsICdwb2xpdGUnKS5hdHRyaWJ1dGUoJ3JvbGUnLCAnYWxlcnQnKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGlmICghZWxlbWVudCkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXAuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoIW1hcC5jb250YWluZXIpIHsgbWFwLmNvbnRhaW5lciA9IHRoaXMuZ2V0Q29udGFpbmVyKG1hcC5vcHRpb25zKTsgfVxuICAgICAgICAvKmlmICgkdG9hc3RFbGVtZW50LmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0qL1xuXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIGlmICghbWFwLmNvbnRhaW5lci5jaGlsZHJlbigpKSB7XG4gICAgICAgICAgICBtYXAuY29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5wcmV2aW91c05vdGljZSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcC5zZXQoZWxlbWVudCwgbWFwKTtcbiAgICB9XG59KTtcblxudmFyIHRvYXN0ZXIgPSBuZXcgVG9hc3RlcigpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHRvYXN0ZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcblxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuL21vZGFsJyksXG4gICAgdG9hc3RyICAgICAgICA9IHJlcXVpcmUoJy4vdG9hc3RyJyksXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG5cbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4JyksXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4uL3V0aWxzL2dldC1hamF4LXVybCcpLnBhcnNlLFxuICAgIGdldEFqYXhVUkwgICAgPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC11cmwnKS5nbG9iYWw7XG5cbnZhciBoaWRkZW5zLFxuICAgIHRvZ2dsZXMgPSBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoLykgfHwgZXZlbnQudHlwZSA9PSAnY2xpY2snKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT0gJ2NsaWNrJykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGhpZGRlbnMgPSBlbGVtZW50LmZpbmQoJ35+IFt0eXBlPWhpZGRlbl0nKTtcblxuICAgICAgICBpZiAoIWhpZGRlbnMpIHJldHVybiB0cnVlO1xuICAgICAgICBoaWRkZW5zLnZhbHVlKGhpZGRlbnMudmFsdWUoKSA9PSAnMCcgPyAnMScgOiAnMCcpO1xuICAgICAgICBlbGVtZW50LnBhcmVudCgnLmVuYWJsZXInKS5hdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcsIGhpZGRlbnMudmFsdWUoKSA9PSAnMScgPyAndHJ1ZScgOiAnZmFsc2UnKTtcblxuICAgICAgICBoaWRkZW5zLmVtaXQoJ2NoYW5nZScpO1xuICAgICAgICAkKCdib2R5JykuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGhpZGRlbnMgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2tleWRvd24nLCAnLmVuYWJsZXInLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudC5kaXNhYmxlZCgpIHx8IGVsZW1lbnQuZmluZCgnW2Rpc2FibGVkXScpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIga2V5ID0gKGV2ZW50LndoaWNoID8gZXZlbnQud2hpY2ggOiBldmVudC5rZXlDb2RlKTtcbiAgICAgICAgaWYgKGtleSA9PSAzMiB8fCBrZXkgPT0gMTMpIHsgLy8gQVJJQSBzdXBwb3J0OiBTcGFjZSAvIEVudGVyIHRvZ2dsZVxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRvZ2dsZXMoZXZlbnQsIGVsZW1lbnQuZmluZCgnLnRvZ2dsZScpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgWyd0b3VjaGVuZCcsICdtb3VzZXVwJywgJ2NsaWNrJ10uZm9yRWFjaChmdW5jdGlvbihldmVudCkge1xuICAgICAgICBib2R5LmRlbGVnYXRlKGV2ZW50LCAnLmVuYWJsZXIgLnRvZ2dsZScsIHRvZ2dsZXMpO1xuICAgIH0pO1xuXG4gICAgdmFyIFVSSSA9IHBhcnNlQWpheFVSSShnZXRBamF4VVJMKCdkZXZwcm9kJykgKyBnZXRBamF4U3VmZml4KCkpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICdbZGF0YS1nLWRldnByb2RdIGlucHV0W3R5cGU9XCJoaWRkZW5cIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnZhbHVlKCksXG4gICAgICAgICAgICBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtZy1kZXZwcm9kXScpLFxuICAgICAgICAgICAgbGFiZWxzID0gSlNPTi5wYXJzZShwYXJlbnQuZGF0YSgnZy1kZXZwcm9kJykpO1xuXG4gICAgICAgIHBhcmVudC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgcmVxdWVzdCgncG9zdCcsIFVSSSwgeyBtb2RlOiB2YWx1ZSB9LCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsdWUoIXZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyZW50LmZpbmQoJy5kZXZwcm9kLW1vZGUnKS50ZXh0KGxhYmVsc1tyZXNwb25zZS5ib2R5Lm1vZGVdIHx8ICdVbmtub3duJyk7XG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuYm9keS5odG1sLCByZXNwb25zZS5ib2R5LnRpdGxlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcmVhZHkgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHRvb2x0aXBzID0gcmVxdWlyZSgnZXh0L3Rvb2x0aXBzJyk7XG5cbnRvb2x0aXBzLmRlZmF1bHRzID0ge1xuICAgIGJhc2VDbGFzczogJ2ctdGlwcycsXG4gICAgdHlwZUNsYXNzOiBudWxsLFxuICAgIGVmZmVjdENsYXNzOiAnZy1mYWRlJyxcbiAgICBpbkNsYXNzOiAnZy10aXAtaW4nLFxuICAgIHBsYWNlOiAndG9wJyxcbiAgICBzcGFjaW5nOiAxMCxcbiAgICBvZmZzZXQ6IC0zLFxuICAgIGF1dG86IDFcbn07XG5cbnZhciBJbnN0YW5jZSA9IG51bGw7XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIEluc3RhbmNlID0gbmV3IHRvb2x0aXBzKGRvY3VtZW50LCB7XG4gICAgICAgIHRvb2x0aXA6IHRvb2x0aXBzLmRlZmF1bHRzLFxuICAgICAgICBrZXk6ICd0aXAnLFxuICAgICAgICBzaG93T246ICdtb3VzZWVudGVyJyxcbiAgICAgICAgaGlkZU9uOiAnbW91c2VsZWF2ZScsXG4gICAgICAgIG9ic2VydmU6IDFcbiAgICB9KTtcblxuICAgIHdpbmRvdy5HNS50aXBzID0gSW5zdGFuY2U7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBJbnN0YW5jZTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgICAgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIGRvbXJlYWR5ICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHN0b3JhZ2UgICAgICAgPSByZXF1aXJlKCdwcmltZS9tYXAnKSgpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLm1vZGFsLFxuXG4gICAgc2l6ZSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvY29sbGVjdGlvbi9zaXplJyksXG4gICAgaW5kZXhPZiAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIG1lcmdlICAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9tZXJnZScpLFxuICAgIGtleXMgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9rZXlzJyksXG4gICAgZ3VpZCAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvcmFuZG9tL2d1aWQnKSxcbiAgICB0b1F1ZXJ5U3RyaW5nID0gcmVxdWlyZSgnbW91dC9xdWVyeVN0cmluZy9lbmNvZGUnKSxcbiAgICBjb250YWlucyAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvY29udGFpbnMnKSxcblxuICAgIGdldFBhcmFtICAgICAgPSByZXF1aXJlKCdtb3V0L3F1ZXJ5U3RyaW5nL2dldFBhcmFtJyksXG4gICAgc2V0UGFyYW0gICAgICA9IHJlcXVpcmUoJ21vdXQvcXVlcnlTdHJpbmcvc2V0UGFyYW0nKSxcblxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpKCksXG4gICAgSGlzdG9yeSAgICAgICA9IHJlcXVpcmUoJy4vaGlzdG9yeScpLFxuICAgIGZsYWdzICAgICAgICAgPSByZXF1aXJlKCcuL2ZsYWdzLXN0YXRlJyksXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4vZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4vZ2V0LWFqYXgtc3VmZml4JyksXG4gICAgbG0gICAgICAgICAgICA9IHJlcXVpcmUoJy4uL2xtJyksXG4gICAgbW0gICAgICAgICAgICA9IHJlcXVpcmUoJy4uL21lbnUnKSxcbiAgICBhc3NpZ25tZW50cyAgID0gcmVxdWlyZSgnLi4vYXNzaWdubWVudHMnKTtcblxucmVxdWlyZSgnLi4vdWkvcG9wb3ZlcicpO1xuXG52YXIgRVJST1IgPSBmYWxzZSwgVE1QX1NFTEVDVElaRV9ESVNBQkxFID0gZmFsc2UsIENvbmZOYXZJbmRleCA9IC0xO1xuXG5IaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csICdzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgIGlmIChyZXF1ZXN0LnJ1bm5pbmcoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBib2R5ID0gJCgnYm9keScpLFxuICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKSxcbiAgICAgICAgVVJJID0gU3RhdGUudXJsLFxuICAgICAgICBEYXRhID0gU3RhdGUuZGF0YSxcbiAgICAgICAgc2lkZWJhciA9ICQoJyNuYXZiYXInKSxcbiAgICAgICAgbWFpbmhlYWRlciA9ICQoJyNtYWluLWhlYWRlcicpLFxuICAgICAgICBwYXJhbXMgPSAnJztcblxuICAgIGlmIChEYXRhLmRvTm90aGluZykgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgaWYgKHNpemUoRGF0YSkgJiYgRGF0YS5wYXJzZWQgIT09IGZhbHNlICYmIHN0b3JhZ2UuZ2V0KERhdGEudXVpZCkpIHtcbiAgICAgICAgRGF0YSA9IHN0b3JhZ2UuZ2V0KERhdGEudXVpZCk7XG4gICAgfVxuXG4gICAgaWYgKERhdGEuZWxlbWVudCkge1xuICAgICAgICB2YXIgaXNUb3BOYXZPck1lbnUgPSBEYXRhLmVsZW1lbnQucGFyZW50KCcjbWFpbi1oZWFkZXInKSB8fCBEYXRhLmVsZW1lbnQubWF0Y2hlcygnLm1lbnUtc2VsZWN0LXdyYXAnKTtcbiAgICAgICAgYm9keS5lbWl0KCdzdGF0ZWNoYW5nZUJlZm9yZScsIHtcbiAgICAgICAgICAgIHRhcmdldDogRGF0YS5lbGVtZW50LFxuICAgICAgICAgICAgRGF0YTogRGF0YVxuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXJsID0gVVJJLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLm9yaWdpbiwgJycpO1xuICAgICAgICBEYXRhLmVsZW1lbnQgPSAkKCdbaHJlZj1cIicgKyB1cmwgKyAnXCJdJyk7XG4gICAgfVxuXG4gICAgVVJJID0gcGFyc2VBamF4VVJJKFVSSSArIGdldEFqYXhTdWZmaXgoKSk7XG5cbiAgICB2YXIgbGlzO1xuICAgIGlmIChzaWRlYmFyICYmIERhdGEuZWxlbWVudCkge1xuICAgICAgICB2YXIgYWN0aXZlID0gc2lkZWJhci5zZWFyY2goJ2xpLmFjdGl2ZScpO1xuICAgICAgICBsaXMgPSBzaWRlYmFyLnNlYXJjaCgnbGknKTtcbiAgICAgICAgbGlzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICBpZiAoRGF0YS5lbGVtZW50LnBhcmVudCgnI25hdmJhcicpKSB7XG4gICAgICAgICAgICBEYXRhLmVsZW1lbnQucGFyZW50KCdsaScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChtYWluaGVhZGVyICYmIERhdGEuZWxlbWVudCAmJiAoIURhdGEuZWxlbWVudC5tYXRjaGVzKCdhLm1lbnUtaXRlbScpICYmICFEYXRhLmVsZW1lbnQubWF0Y2hlcygnc2VsZWN0Lm1lbnUtc2VsZWN0LXdyYXAnKSkpIHtcbiAgICAgICAgbGlzID0gbWFpbmhlYWRlci5zZWFyY2goJy5mbG9hdC1yaWdodCBsaScpO1xuICAgICAgICBsaXMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgIGlmIChEYXRhLmVsZW1lbnQucGFyZW50KCcjbWFpbi1oZWFkZXInKSkge1xuICAgICAgICAgICAgRGF0YS5lbGVtZW50LnBhcmVudCgnbGknKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoRGF0YS5wYXJhbXMpIHtcbiAgICAgICAgcGFyYW1zID0gdG9RdWVyeVN0cmluZyhKU09OLnBhcnNlKERhdGEucGFyYW1zKSk7XG4gICAgICAgIGlmIChjb250YWlucyhVUkksICc/JykpIHsgcGFyYW1zID0gcGFyYW1zLnJlcGxhY2UoL15cXD8vLCAnJicpOyB9XG4gICAgfVxuXG4gICAgaWYgKCFFUlJPUikgeyBtb2RhbC5jbG9zZUFsbCgpOyB9XG4gICAgcmVxdWVzdC51cmwoVVJJICsgcGFyYW1zKS5kYXRhKERhdGEuZXh0cmFzIHx8IHt9KS5tZXRob2QoRGF0YS5leHRyYXMgPyAncG9zdCcgOiAnZ2V0Jykuc2VuZChmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGlmICghRVJST1IpIHtcbiAgICAgICAgICAgICAgICBFUlJPUiA9IHRydWU7XG4gICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIEhpc3RvcnkuYmFjaygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBFUlJPUiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoRGF0YS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgRGF0YS5lbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdGFyZ2V0ID0gRGF0YS5wYXJlbnQgPyBEYXRhLmVsZW1lbnQucGFyZW50KERhdGEucGFyZW50KSA6ICQoRGF0YS50YXJnZXQpLFxuICAgICAgICAgICAgZGVzdGluYXRpb24gPSAodGFyZ2V0IHx8ICQoJ1tkYXRhLWc1LWNvbnRlbnRdJykgfHwgYm9keSk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkgJiYgcmVzcG9uc2UuYm9keS5odG1sKSB7XG4gICAgICAgICAgICB2YXIgZmFkZXI7XG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCk7XG4gICAgICAgICAgICBpZiAoZmFkZXIgPSAoZGVzdGluYXRpb24ubWF0Y2hlcygnW2RhdGEtZzUtY29udGVudF0nKSA/IGRlc3RpbmF0aW9uIDogZGVzdGluYXRpb24uZmluZCgnW2RhdGEtZzUtY29udGVudF0nKSkpIHtcbiAgICAgICAgICAgICAgICBmYWRlci5zdHlsZSh7IG9wYWNpdHk6IDAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGlzVG9wTmF2T3JNZW51KSB7ICQobmF2YmFyKS5hdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJykuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7IH1cbiAgICAgICAgICAgICAgICAkKCcjbmF2YmFyJylbaXNUb3BOYXZPck1lbnUgPyAnc2xpZGVVcCcgOiAnc2xpZGVEb3duJ10oKTtcbiAgICAgICAgICAgICAgICBmYWRlci5hbmltYXRlKHsgb3BhY2l0eTogMSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHsgZGVzdGluYXRpb24uaHRtbChyZXNwb25zZS5ib2R5KTsgfVxuXG4gICAgICAgIGJvZHkuZ2V0UG9wb3ZlcigpLmhpZGVBbGwodHJ1ZSkuZGVzdHJveSgpO1xuXG4gICAgICAgIGlmIChEYXRhLmVsZW1lbnQpIHtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnc3RhdGVjaGFuZ2VBZnRlcicsIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IERhdGEuZWxlbWVudCxcbiAgICAgICAgICAgICAgICBEYXRhOiBEYXRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBlbGVtZW50ID0gKERhdGEuZXZlbnQgJiYgRGF0YS5ldmVudC5hY3RpdmVTcGlubmVyKSB8fCBEYXRhLmVsZW1lbnQ7XG4gICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzZWxlY3RzID0gJCgnW2RhdGEtc2VsZWN0aXplXScpO1xuICAgICAgICBpZiAoc2VsZWN0cykgeyBzZWxlY3RzLnNlbGVjdGl6ZSgpOyB9XG4gICAgICAgIHNlbGVjdG9yQ2hhbmdlRXZlbnQoKTtcbiAgICAgICAgYXNzaWdubWVudHMuY2hyb21lRml4KCk7XG5cbiAgICAgICAgYm9keS5lbWl0KCdzdGF0ZWNoYW5nZUVuZCcpO1xuICAgIH0pO1xufSk7XG5cbnZhciBzZWxlY3RvckNoYW5nZUV2ZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdG9ycyA9ICQoJ1tkYXRhLXNlbGVjdGl6ZS1hamF4aWZ5XScpO1xuICAgIGlmICghc2VsZWN0b3JzKSB7IHJldHVybjsgfVxuXG4gICAgc2VsZWN0b3JzLmZvckVhY2goZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgICAgICAgc2VsZWN0b3IgPSAkKHNlbGVjdG9yKTtcbiAgICAgICAgdmFyIHNlbGVjdGl6ZSA9IHNlbGVjdG9yLnNlbGVjdGl6ZSgpLnNlbGVjdGl6ZUluc3RhbmNlO1xuICAgICAgICBpZiAoIXNlbGVjdGl6ZSB8fCBzZWxlY3RpemUuSGFzQ2hhbmdlRXZlbnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgc2VsZWN0aXplLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChUTVBfU0VMRUNUSVpFX0RJU0FCTEUpIHtcbiAgICAgICAgICAgICAgICBUTVBfU0VMRUNUSVpFX0RJU0FCTEUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxlY3RpemUuZ2V0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gc2VsZWN0aXplLk9wdGlvbnMsXG4gICAgICAgICAgICAgICAgZmxhZ0NhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGZsYWdzLm9mZigndXBkYXRlOnBlbmRpbmcnLCBmbGFnQ2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGl6ZS5pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2c1LWFqYXhpZnknLCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldCcsIHNlbGVjdG9yLmRhdGEoJ2c1LWFqYXhpZnktdGFyZ2V0JykgfHwgJ1tkYXRhLWc1LWNvbnRlbnQtd3JhcHBlcl0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2c1LWFqYXhpZnktdGFyZ2V0LXBhcmVudCcsIHNlbGVjdG9yLmRhdGEoJ2c1LWFqYXhpZnktdGFyZ2V0LXBhcmVudCcpIHx8IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgnZzUtYWpheGlmeS1ocmVmJywgb3B0aW9uc1t2YWx1ZV0udXJsKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2c1LWFqYXhpZnktcGFyYW1zJywgb3B0aW9uc1t2YWx1ZV0ucGFyYW1zID8gSlNPTi5zdHJpbmdpZnkob3B0aW9uc1t2YWx1ZV0ucGFyYW1zKSA6IG51bGwpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZSA9ICQoJyNuYXZiYXIgbGkuYWN0aXZlJykgfHwgJCgnI21haW4taGVhZGVyIGxpLmFjdGl2ZScpIHx8ICQoJyNuYXZiYXIgbGk6bnRoLWNoaWxkKDIpJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUpIHsgYWN0aXZlLnNob3dJbmRpY2F0b3IoKTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5lbWl0KCdjbGljaycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogc2VsZWN0aXplLmlucHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlU3Bpbm5lcjogYWN0aXZlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICghb3B0aW9uc1t2YWx1ZV0pIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIGlmIChmbGFncy5nZXQoJ3BlbmRpbmcnKSkge1xuICAgICAgICAgICAgICAgIGZsYWdzLndhcm5pbmcoe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlQ29udGludWUgPSBjb250ZW50LmZpbmQoJ1tkYXRhLWctdW5zYXZlZC1zYXZlXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NhcmRDb250aW51ZSA9IGNvbnRlbnQuZmluZCgnW2RhdGEtZy11bnNhdmVkLWRpc2NhcmRdJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZUNvbnRpbnVlKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvbnRpbnVlLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChbc2F2ZUNvbnRpbnVlLCBkaXNjYXJkQ29udGludWVdKS5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3Mub24oJ3VwZGF0ZTpwZW5kaW5nJywgZmxhZ0NhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogJCgnLmJ1dHRvbi1zYXZlJykgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY2FyZENvbnRpbnVlLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChbc2F2ZUNvbnRpbnVlLCBkaXNjYXJkQ29udGludWVdKS5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3Muc2V0KCdwZW5kaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUTVBfU0VMRUNUSVpFX0RJU0FCTEUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aXplLnNldFZhbHVlKHNlbGVjdGl6ZS5nZXRQcmV2aW91c1ZhbHVlKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZsYWdDYWxsYmFjaygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZWxlY3RpemUuSGFzQ2hhbmdlRXZlbnQgPSB0cnVlO1xuICAgIH0pO1xufTtcblxuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIC8vIFVwZGF0ZSBOT05DRSBpZiBhbnlcbiAgICBpZiAoR0FOVFJZX0FKQVhfTk9OQ0UpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRVUkkgPSBIaXN0b3J5LmdldFBhZ2VVcmwoKSxcbiAgICAgICAgICAgIGN1cnJlbnROb25jZSwgY3VycmVudFZpZXc7XG5cbiAgICAgICAgLy8gaGFjayB0byBpbmplY3QgdGhlIGRlZmF1bHQgdmlldyBpbiBXUC9HcmF2IGluIGNhc2UgaXQncyBtaXNzaW5nXG4gICAgICAgIHN3aXRjaCAoR0FOVFJZX1BMQVRGT1JNKSB7XG4gICAgICAgICAgICBjYXNlICd3b3JkcHJlc3MnOlxuICAgICAgICAgICAgICAgIGN1cnJlbnROb25jZSA9IGdldFBhcmFtKGN1cnJlbnRVUkksICdfd3Bub25jZScpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3ID0gZ2V0UGFyYW0oY3VycmVudFVSSSwgJ3ZpZXcnKTtcblxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudFZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFVSSSA9IHNldFBhcmFtKGN1cnJlbnRVUkksICd2aWV3JywgJ2NvbmZpZ3VyYXRpb25zL2RlZmF1bHQvc3R5bGVzJyk7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlKHsgdXVpZDogZ3VpZCgpLCBkb05vdGhpbmc6IHRydWUgfSwgd2luZG93LmRvY3VtZW50LnRpdGxlLCBjdXJyZW50VVJJKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyByZWZyZXNoIG5vbmNlXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb25jZSAhPT0gR0FOVFJZX0FKQVhfTk9OQ0UpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFVSSSA9IHNldFBhcmFtKGN1cnJlbnRVUkksICdfd3Bub25jZScsIEdBTlRSWV9BSkFYX05PTkNFKTtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUoeyB1dWlkOiBndWlkKCksIGRvTm90aGluZzogdHJ1ZSB9LCB3aW5kb3cuZG9jdW1lbnQudGl0bGUsIGN1cnJlbnRVUkkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZ3Jhdic6XG4gICAgICAgICAgICAgICAgY3VycmVudE5vbmNlID0gZ2V0UGFyYW0oY3VycmVudFVSSSwgJ25vbmNlJyk7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcgPSBjb250YWlucyhjdXJyZW50VVJJLCAnY29uZmlndXJhdGlvbnMvZGVmYXVsdC9zdHlsZXMnKTtcblxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudFZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFVSSSArPSAnY29uZmlndXJhdGlvbnMvZGVmYXVsdC9zdHlsZXMnO1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LnJlcGxhY2VTdGF0ZSh7IHV1aWQ6IGd1aWQoKSwgZG9Ob3RoaW5nOiB0cnVlIH0sIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgY3VycmVudFVSSSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gcmVmcmVzaCBub25jZVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9uY2UgIT09IEdBTlRSWV9BSkFYX05PTkNFKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRVUkkgPSBzZXRQYXJhbShjdXJyZW50VVJJLCAnbm9uY2UnLCBHQU5UUllfQUpBWF9OT05DRSk7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlKHsgdXVpZDogZ3VpZCgpLCBkb05vdGhpbmc6IHRydWUgfSwgd2luZG93LmRvY3VtZW50LnRpdGxlLCBjdXJyZW50VVJJKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgLy8gYmFjayB0byBjb25maWd1cmF0aW9uXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnLmJ1dHRvbi1iYWNrLXRvLWNvbmYnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciBjb25mU2VsZWN0b3IgPSAkKCcjY29uZmlndXJhdGlvbi1zZWxlY3RvcicpLFxuICAgICAgICAgICAgb3V0bGluZURlbGV0ZWQgPSBib2R5Lm91dGxpbmVEZWxldGVkLFxuICAgICAgICAgICAgY3VycmVudE91dGxpbmUgPSBjb25mU2VsZWN0b3IudmFsdWUoKTtcblxuICAgICAgICBDb25mTmF2SW5kZXggPSBDb25mTmF2SW5kZXggPT0gLTEgPyAxIDogQ29uZk5hdkluZGV4O1xuICAgICAgICB2YXIgbmF2YmFyID0gJCgnI25hdmJhcicpLFxuICAgICAgICAgICAgaXRlbSA9IG5hdmJhci5maW5kKCdsaTpudGgtY2hpbGQoJyArIChDb25mTmF2SW5kZXggKyAxKSArICcpIFtkYXRhLWc1LWFqYXhpZnldJyk7XG5cbiAgICAgICAgaWYgKGZsYWdzLmdldCgncGVuZGluZycpKSB7XG4gICAgICAgICAgICBmbGFncy53YXJuaW5nKHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmVDb250aW51ZSA9IGNvbnRlbnQuZmluZCgnW2RhdGEtZy11bnNhdmVkLXNhdmVdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjYXJkQ29udGludWUgPSBjb250ZW50LmZpbmQoJ1tkYXRhLWctdW5zYXZlZC1kaXNjYXJkXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ0NhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3Mub2ZmKCd1cGRhdGU6cGVuZGluZycsIGZsYWdDYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogaXRlbSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZiYXIuYXR0cmlidXRlKCd0YWJpbmRleCcsIG51bGwpLmF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZiYXIuc2xpZGVEb3duKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZUNvbnRpbnVlKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgICAgICAgICBzYXZlQ29udGludWUub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFtzYXZlQ29udGludWUsIGRpc2NhcmRDb250aW51ZV0pLmF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLm9uKCd1cGRhdGU6cGVuZGluZycsIGZsYWdDYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6ICQoJy5idXR0b24tc2F2ZScpIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBkaXNjYXJkQ29udGludWUub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFtzYXZlQ29udGludWUsIGRpc2NhcmRDb250aW51ZV0pLmF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLnNldCgncGVuZGluZycsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgaWYgKG91dGxpbmVEZWxldGVkID09IGN1cnJlbnRPdXRsaW5lKSB7XG4gICAgICAgICAgICB2YXIgaWRzID0ga2V5cyhjb25mU2VsZWN0b3Iuc2VsZWN0aXplSW5zdGFuY2UuT3B0aW9ucyksXG4gICAgICAgICAgICAgICAgaWQgPSBpZHMuc2hpZnQoKTtcbiAgICAgICAgICAgIGJvZHkub3V0bGluZURlbGV0ZWQgPSBudWxsO1xuICAgICAgICAgICAgaXRlbS5ocmVmKGl0ZW0uaHJlZigpLnJlcGxhY2UoJy8nICsgb3V0bGluZURlbGV0ZWQgKyAnLycsICcvJyArIGlkICsgJy8nKS5yZXBsYWNlKCdzdHlsZT0nICsgb3V0bGluZURlbGV0ZWQsICdzdHlsZT0nICsgaWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogaXRlbSB9KTtcbiAgICAgICAgbmF2YmFyLmF0dHJpYnV0ZSgndGFiaW5kZXgnLCBudWxsKTtcbiAgICAgICAgbmF2YmFyLnNsaWRlRG93bigpO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnI25hdmJhciBhW2RhdGEtZzUtYWpheGlmeV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgbmF2YmFyID0gJCgnI25hdmJhcicpLFxuICAgICAgICAgICAgbGlzID0gbmF2YmFyLnNlYXJjaCgnbGkgYVtkYXRhLWc1LWFqYXhpZnldJyk7XG5cbiAgICAgICAgQ29uZk5hdkluZGV4ID0gaW5kZXhPZihsaXMsIGVsZW1lbnRbMF0pICsgMTtcbiAgICB9KTtcblxuICAgIC8vIGdlbmVyaWMgYWpheGlmaWVkIGxpbmtzXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtYWpheGlmeV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMiB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZmxhZ3MuZ2V0KCdwZW5kaW5nJykgJiYgKCFlbGVtZW50Lm1hdGNoZXMoJ2EubWVudS1pdGVtJykgJiYgIWVsZW1lbnQucGFyZW50KCdbZGF0YS1tZW51LWl0ZW1zXScpKSkge1xuICAgICAgICAgICAgZmxhZ3Mud2FybmluZyh7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzYXZlQ29udGludWUgPSBjb250ZW50LmZpbmQoJ1tkYXRhLWctdW5zYXZlZC1zYXZlXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY2FyZENvbnRpbnVlID0gY29udGVudC5maW5kKCdbZGF0YS1nLXVuc2F2ZWQtZGlzY2FyZF0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdDYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLm9mZigndXBkYXRlOnBlbmRpbmcnLCBmbGFnQ2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjbGljaycsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzYXZlQ29udGludWUpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgICAgIHNhdmVDb250aW51ZS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoW3NhdmVDb250aW51ZSwgZGlzY2FyZENvbnRpbnVlXSkuYXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3Mub24oJ3VwZGF0ZTpwZW5kaW5nJywgZmxhZ0NhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogJCgnLmJ1dHRvbi1zYXZlJykgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGRpc2NhcmRDb250aW51ZS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoW3NhdmVDb250aW51ZSwgZGlzY2FyZENvbnRpbnVlXSkuYXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3Muc2V0KCdwZW5kaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YSgnZzUtYWpheGlmeScpLFxuICAgICAgICAgICAgdGFyZ2V0ID0gZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldCcpLFxuICAgICAgICAgICAgcGFyZW50ID0gZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldC1wYXJlbnQnKSxcbiAgICAgICAgICAgIHVybCA9IGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJykgfHwgZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LWhyZWYnKSxcbiAgICAgICAgICAgIHBhcmFtcyA9IGVsZW1lbnQuZGF0YSgnZzUtYWpheGlmeS1wYXJhbXMnKSB8fCBmYWxzZSxcbiAgICAgICAgICAgIHRpdGxlID0gZWxlbWVudC5hdHRyaWJ1dGUoJ3RpdGxlJykgfHwgd2luZG93LmRvY3VtZW50LnRpdGxlO1xuXG4gICAgICAgIGRhdGEgPSBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IHsgcGFyc2VkOiBmYWxzZSB9O1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHV1aWQgPSBndWlkKCksIGV4dHJhcztcblxuICAgICAgICAgICAgLy8gVE9ETzogVGhlIG1lbnUgbmVlZHMgdG8gYmUgYWJsZSB0byByZWNlaXZlIFBPU1RcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmRhdGEoJ21tLWlkJykgfHwgZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpKSB7XG4gICAgICAgICAgICAgICAgZXh0cmFzID0ge307XG4gICAgICAgICAgICAgICAgZXh0cmFzLm1lbnV0eXBlID0gJCgnc2VsZWN0Lm1lbnUtc2VsZWN0LXdyYXAnKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIGV4dHJhcy5zZXR0aW5ncyA9IEpTT04uc3RyaW5naWZ5KG1tLm1lbnVtYW5hZ2VyLnNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICBleHRyYXMub3JkZXJpbmcgPSBKU09OLnN0cmluZ2lmeShtbS5tZW51bWFuYWdlci5vcmRlcmluZyk7XG4gICAgICAgICAgICAgICAgZXh0cmFzLml0ZW1zID0gSlNPTi5zdHJpbmdpZnkobW0ubWVudW1hbmFnZXIuaXRlbXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdG9yYWdlLnNldCh1dWlkLCBtZXJnZSh7fSwgZGF0YSwge1xuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgICAgICAgIHBhcmVudDogcGFyZW50LFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgZXh0cmFzOiBleHRyYXMsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBkYXRhID0geyB1dWlkOiB1dWlkIH07XG4gICAgICAgIH1cblxuICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZShkYXRhLCB0aXRsZSwgdXJsKTtcblxuICAgICAgICB2YXIgbmF2YmFyLCBhY3RpdmUsIGFjdGl2ZXMgPSAkKCcjbmF2YmFyIC5hY3RpdmUsICNtYWluLWhlYWRlciAuYWN0aXZlJyk7XG5cbiAgICAgICAgaWYgKG5hdmJhciA9IGVsZW1lbnQucGFyZW50KCcjbmF2YmFyLCAjbWFpbi1oZWFkZXInKSkge1xuICAgICAgICAgICAgaWYgKGFjdGl2ZXMpIHsgYWN0aXZlcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cblxuICAgICAgICAgICAgYWN0aXZlID0gbmF2YmFyLnNlYXJjaCgnLmFjdGl2ZScpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZSkgeyBhY3RpdmUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudCgnbGknKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGF0dGFjaCBjaGFuZ2UgZXZlbnRzIHRvIGNvbmZpZ3VyYXRpb25zIHNlbGVjdG9yXG4gICAgc2VsZWN0b3JDaGFuZ2VFdmVudCgpO1xufSk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG4vLyBjcmVkaXRzOiBodHRwczovL2dpdGh1Yi5jb20vY293Ym95L2phdmFzY3JpcHQtc3luYy1hc3luYy1mb3JlYWNoXG52YXIgYXN5bmNGb3JFYWNoID0gZnVuY3Rpb24oYXJyLCBlYWNoRm4sIGRvbmVGbikge1xuICAgIGFyciA9IGFyciB8fCBbXTtcbiAgICB2YXIgaSA9IC0xO1xuICAgIC8vIFJlc29sdmUgYXJyYXkgbGVuZ3RoIHRvIGEgdmFsaWQgKFRvVWludDMyKSBudW1iZXIuXG4gICAgdmFyIGxlbiA9IGFyci5sZW5ndGggPj4+IDA7XG5cbiAgICAoZnVuY3Rpb24gbmV4dChyZXN1bHQpIHtcbiAgICAgICAgLy8gVGhpcyBmbGFnIHdpbGwgYmUgc2V0IHRvIHRydWUgaWYgYHRoaXMuYXN5bmNgIGlzIGNhbGxlZCBpbnNpZGUgdGhlXG4gICAgICAgIC8vIGVhY2hGbmAgY2FsbGJhY2suXG4gICAgICAgIHZhciBhc3luYztcbiAgICAgICAgLy8gV2FzIGZhbHNlIHJldHVybmVkIGZyb20gdGhlIGBlYWNoRm5gIGNhbGxiYWNrIG9yIHBhc3NlZCB0byB0aGVcbiAgICAgICAgLy8gYHRoaXMuYXN5bmNgIGRvbmUgZnVuY3Rpb24/XG4gICAgICAgIHZhciBhYm9ydCA9IHJlc3VsdCA9PT0gZmFsc2U7XG5cbiAgICAgICAgLy8gSW5jcmVtZW50IGNvdW50ZXIgdmFyaWFibGUgYW5kIHNraXAgYW55IGluZGljZXMgdGhhdCBkb24ndCBleGlzdC4gVGhpc1xuICAgICAgICAvLyBhbGxvd3Mgc3BhcnNlIGFycmF5cyB0byBiZSBpdGVyYXRlZC5cbiAgICAgICAgZG8geyArK2k7IH0gd2hpbGUgKCEoaSBpbiBhcnIpICYmIGkgIT09IGxlbik7XG5cbiAgICAgICAgLy8gRXhpdCBpZiByZXN1bHQgcGFzc2VkIHRvIGB0aGlzLmFzeW5jYCBkb25lIGZ1bmN0aW9uIG9yIHJldHVybmVkIGZyb21cbiAgICAgICAgLy8gdGhlIGBlYWNoRm5gIGNhbGxiYWNrIHdhcyBmYWxzZSwgb3Igd2hlbiBkb25lIGl0ZXJhdGluZy5cbiAgICAgICAgaWYgKGFib3J0IHx8IGkgPT09IGxlbikge1xuICAgICAgICAgICAgLy8gSWYgYSBgZG9uZUZuYCBjYWxsYmFjayB3YXMgc3BlY2lmaWVkLCBpbnZva2UgdGhhdCBub3cuIFBhc3MgaW4gYVxuICAgICAgICAgICAgLy8gYm9vbGVhbiB2YWx1ZSByZXByZXNlbnRpbmcgXCJub3QgYWJvcnRlZFwiIHN0YXRlIGFsb25nIHdpdGggdGhlIGFycmF5LlxuICAgICAgICAgICAgaWYgKGRvbmVGbikge1xuICAgICAgICAgICAgICAgIGRvbmVGbighYWJvcnQsIGFycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJbnZva2UgdGhlIGBlYWNoRm5gIGNhbGxiYWNrLCBzZXR0aW5nIGB0aGlzYCBpbnNpZGUgdGhlIGNhbGxiYWNrIHRvIGFcbiAgICAgICAgLy8gY3VzdG9tIG9iamVjdCB0aGF0IGNvbnRhaW5zIG9uZSBtZXRob2QsIGFuZCBwYXNzaW5nIGluIHRoZSBhcnJheSBpdGVtLFxuICAgICAgICAvLyBpbmRleCwgYW5kIHRoZSBhcnJheS5cbiAgICAgICAgcmVzdWx0ID0gZWFjaEZuLmNhbGwoe1xuICAgICAgICAgICAgLy8gSWYgYHRoaXMuYXN5bmNgIGlzIGNhbGxlZCBpbnNpZGUgdGhlIGBlYWNoRm5gIGNhbGxiYWNrLCBzZXQgdGhlIGFzeW5jXG4gICAgICAgICAgICAvLyBmbGFnIGFuZCByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbnRpbnVlIGl0ZXJhdGluZy5cbiAgICAgICAgICAgIGFzeW5jOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBhc3luYyA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGFycltpXSwgaSwgYXJyKTtcblxuICAgICAgICAvLyBJZiB0aGUgYXN5bmMgZmxhZyB3YXNuJ3Qgc2V0LCBjb250aW51ZSBieSBjYWxsaW5nIGBuZXh0YCBzeW5jaHJvbm91c2x5LFxuICAgICAgICAvLyBwYXNzaW5nIGluIHRoZSByZXN1bHQgb2YgdGhlIGBlYWNoRm5gIGNhbGxiYWNrLlxuICAgICAgICBpZiAoIWFzeW5jKSB7XG4gICAgICAgICAgICBuZXh0KHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICB9KCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luY0ZvckVhY2g7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciByQUYgPSAoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICBmdW5jdGlvbihjYWxsYmFjaykgeyB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTsgfTtcbn0oKSk7XG5cbnZhciBkZWNvdXBsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHZhciBldnQsIHRyYWNraW5nID0gZmFsc2U7XG4gICAgZWxlbWVudCA9IGVsZW1lbnRbMF0gfHwgZWxlbWVudDtcblxuICAgIHZhciBjYXB0dXJlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBldnQgPSBlO1xuICAgICAgICB0cmFjaygpO1xuICAgIH07XG5cbiAgICB2YXIgdHJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0cmFja2luZykge1xuICAgICAgICAgICAgckFGKHVwZGF0ZSk7XG4gICAgICAgICAgICB0cmFja2luZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFjay5jYWxsKGVsZW1lbnQsIGV2dCk7XG4gICAgICAgIHRyYWNraW5nID0gZmFsc2U7XG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2FwdHVyZSwgZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICByZXR1cm4gY2FwdHVyZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZGVjb3VwbGU7IiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgbW9vZnggICAgICA9IHJlcXVpcmUoJ21vb2Z4JyksXG4gICAgbWFwICAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvbWFwJyksXG4gICAgc2VyaWVzICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vc2VyaWVzJyksXG4gICAgc2xpY2sgICAgICA9IHJlcXVpcmUoJ3NsaWNrJyksXG4gICAgemVuICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHByb2dyZXNzZXIgPSByZXF1aXJlKCcuLi91aS9wcm9ncmVzc2VyJyk7XG5cbnZhciB3YWxrID0gZnVuY3Rpb24oY29tYmluYXRvciwgbWV0aG9kKSB7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oZXhwcmVzc2lvbikge1xuICAgICAgICB2YXIgcGFydHMgPSBzbGljay5wYXJzZShleHByZXNzaW9uIHx8IFwiKlwiKTtcblxuICAgICAgICBleHByZXNzaW9uID0gbWFwKHBhcnRzLCBmdW5jdGlvbihwYXJ0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tYmluYXRvciArIFwiIFwiICsgcGFydDtcbiAgICAgICAgfSkuam9pbignLCAnKTtcblxuICAgICAgICByZXR1cm4gdGhpc1ttZXRob2RdKGV4cHJlc3Npb24pO1xuICAgIH07XG5cbn07XG5cblxuJC5pbXBsZW1lbnQoe1xuICAgIHN0eWxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1vbyA9IG1vb2Z4KHRoaXMpO1xuICAgICAgICBtb28uc3R5bGUuYXBwbHkobW9vLCBhcmd1bWVudHMpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYW5pbWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBtb28gPSBtb29meCh0aGlzKTtcbiAgICAgICAgbW9vLmFuaW1hdGUuYXBwbHkobW9vLCBhcmd1bWVudHMpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24obW9kZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdHlsZSgnZGlzcGxheScsIG1vZGUgfHwgJ2luaGVyaXQnKTtcbiAgICB9LFxuXG4gICAgcHJvZ3Jlc3NlcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB2YXIgaW5zdGFuY2U7XG5cbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgIGluc3RhbmNlID0gbm9kZS5Qcm9ncmVzc2VySW5zdGFuY2U7XG5cbiAgICAgICAgICAgIGlmICghaW5zdGFuY2UpIHsgaW5zdGFuY2UgPSBuZXcgcHJvZ3Jlc3Nlcihub2RlLCBvcHRpb25zKTsgfVxuICAgICAgICAgICAgZWxzZSB7IGluc3RhbmNlLmNvbnN0cnVjdG9yKG5vZGUsIG9wdGlvbnMpOyB9XG5cbiAgICAgICAgICAgIG5vZGUuUHJvZ3Jlc3Nlckluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjb21wdXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1vbyA9IG1vb2Z4KHRoaXMpO1xuICAgICAgICByZXR1cm4gbW9vLmNvbXB1dGUuYXBwbHkobW9vLCBhcmd1bWVudHMpO1xuICAgIH0sXG5cbiAgICBzaG93SW5kaWNhdG9yOiBmdW5jdGlvbihrbGFzcywga2VlcEljb24pIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSAkKG5vZGUpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBrbGFzcyA9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBrZWVwSWNvbiA9IGtsYXNzO1xuICAgICAgICAgICAgICAgIGtsYXNzID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGljb24gPSBrZWVwSWNvbiA/IGZhbHNlIDogbm9kZS5maW5kKCdpJyk7XG4gICAgICAgICAgICBub2RlLmdIYWRJY29uID0gISFpY29uO1xuXG4gICAgICAgICAgICBpZiAoIWljb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUuZmluZCgnc3BhbicpICYmICFub2RlLmNoaWxkcmVuKCkpIHsgemVuKCdzcGFuJykudGV4dChub2RlLnRleHQoKSkudG9wKG5vZGUuZW1wdHkoKSk7IH1cblxuICAgICAgICAgICAgICAgIGljb24gPSB6ZW4oJ2knKTtcbiAgICAgICAgICAgICAgICBpY29uLnRvcChub2RlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFub2RlLmdJbmRpY2F0b3IpIHsgbm9kZS5nSW5kaWNhdG9yID0gaWNvbi5hdHRyaWJ1dGUoJ2NsYXNzJykgfHwgdHJ1ZTsgfVxuICAgICAgICAgICAgaWNvbi5hdHRyaWJ1dGUoJ2NsYXNzJywga2xhc3MgfHwgJ2ZhIGZhLWZ3IGZhLXNwaW4tZmFzdCBmYS1zcGlubmVyJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBoaWRlSW5kaWNhdG9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSAkKG5vZGUpO1xuICAgICAgICAgICAgaWYgKCFub2RlLmdJbmRpY2F0b3IpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIHZhciBpY29uID0gbm9kZS5maW5kKCdpJyk7XG5cbiAgICAgICAgICAgIGlmICghaWNvbikgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgaWYgKCFub2RlLmdIYWRJY29uKSB7IGljb24ucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGVsc2UgeyBpY29uLmF0dHJpYnV0ZSgnY2xhc3MnLCBub2RlLmdJbmRpY2F0b3IpOyB9XG5cbiAgICAgICAgICAgIG5vZGUuZ0luZGljYXRvciA9IG51bGw7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzbGlkZURvd246IGZ1bmN0aW9uKGFuaW1hdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgc2l6ZSAgICAgICAgICA9IHRoaXMuZ2V0UmVhbFNpemUoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrU3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmdTbGlkZUNvbGxhcHNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGxiYWNrRW5kICAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBlbGVtZW50LmdTbGlkZVN0eWxlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgY2FsbGJhY2sgPSB0eXBlb2YgYW5pbWF0aW9uID09ICdmdW5jdGlvbicgPyBhbmltYXRpb24gOiAoY2FsbGJhY2sgfHwgZnVuY3Rpb24oKSB7fSk7XG4gICAgICAgIGlmICh0aGlzLmdTbGlkZUNvbGxhcHNlZCA9PT0gZmFsc2UpIHsgcmV0dXJuIGNhbGxiYWNrKCk7IH1cbiAgICAgICAgY2FsbGJhY2sgPSBzZXJpZXMoY2FsbGJhY2tTdGFydCwgY2FsbGJhY2ssIGNhbGxiYWNrRW5kKTtcblxuICAgICAgICBhbmltYXRpb24gPSB0eXBlb2YgYW5pbWF0aW9uID09ICdzdHJpbmcnID8gYW5pbWF0aW9uIDoge1xuICAgICAgICAgICAgZHVyYXRpb246ICcyNTBtcycsXG4gICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnN0eWxlKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKS5hdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICB0aGlzLmFuaW1hdGUoeyBoZWlnaHQ6IHNpemUuaGVpZ2h0IH0sIGFuaW1hdGlvbik7XG4gICAgfSxcblxuICAgIHNsaWRlVXA6IGZ1bmN0aW9uKGFuaW1hdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmdTbGlkZUNvbGxhcHNlZCA9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5nU2xpZGVTdHlsZSA9IHRoaXMuYXR0cmlidXRlKCdzdHlsZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGVsZW1lbnQgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgY2FsbGJhY2tTdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZ1NsaWRlQ29sbGFwc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxsYmFja0VuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJykuYXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICBjYWxsYmFjayA9IHR5cGVvZiBhbmltYXRpb24gPT0gJ2Z1bmN0aW9uJyA/IGFuaW1hdGlvbiA6IChjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9KTtcbiAgICAgICAgaWYgKHRoaXMuZ1NsaWRlQ29sbGFwc2VkID09PSB0cnVlKSB7IHJldHVybiBjYWxsYmFjaygpOyB9XG4gICAgICAgIGNhbGxiYWNrID0gc2VyaWVzKGNhbGxiYWNrU3RhcnQsIGNhbGxiYWNrLCBjYWxsYmFja0VuZCk7XG5cbiAgICAgICAgYW5pbWF0aW9uID0gdHlwZW9mIGFuaW1hdGlvbiA9PSAnc3RyaW5nJyA/IGFuaW1hdGlvbiA6IHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAnMjUwbXMnLFxuICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3R5bGUoeyBvdmVyZmxvdzogJ2hpZGRlbicgfSkuYW5pbWF0ZSh7IGhlaWdodDogMCB9LCBhbmltYXRpb24pO1xuICAgIH0sXG5cbiAgICBzbGlkZVRvZ2dsZTogZnVuY3Rpb24oYW5pbWF0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuZ2V0UmVhbFNpemUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXNbc2l6ZS5oZWlnaHQgJiYgIXRoaXMuZ1NsaWRlQ29sbGFwc2VkID8gJ3NsaWRlVXAnIDogJ3NsaWRlRG93biddKGFuaW1hdGlvbiwgY2FsbGJhY2spO1xuICAgIH0sXG5cbiAgICBnZXRSZWFsU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdHlsZSA9IHRoaXMuYXR0cmlidXRlKCdzdHlsZScpLCBzaXplO1xuICAgICAgICB0aGlzLnN0eWxlKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgICAgICAgICAgb3ZlcmZsb3c6ICdpbmhlcml0JyxcbiAgICAgICAgICAgIHRvcDogLTUwMDAwLFxuICAgICAgICAgICAgaGVpZ2h0OiAnYXV0bycsXG4gICAgICAgICAgICB3aWR0aDogJ2F1dG8nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNpemUgPSB7XG4gICAgICAgICAgICB3aWR0aDogcGFyc2VJbnQodGhpcy5jb21wdXRlKCd3aWR0aCcpLCAxMCksXG4gICAgICAgICAgICBoZWlnaHQ6IHBhcnNlSW50KHRoaXMuY29tcHV0ZSgnaGVpZ2h0JyksIDEwKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTtcblxuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9LFxuXG4gICAgc2libGluZzogd2FsaygnKysnLCAnZmluZCcpLFxuXG4gICAgc2libGluZ3M6IHdhbGsoJ35+JywgJ3NlYXJjaCcpXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSAkO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpO1xuXG4kLmltcGxlbWVudCh7XG4gICAgYmVsb3d0aGVmb2xkOiBmdW5jdGlvbihleHByZXNzaW9uLCB0cmVzaG9sZCkge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSB0aGlzLnNlYXJjaChleHByZXNzaW9uKTtcbiAgICAgICAgdHJlc2hvbGQgPSB0cmVzaG9sZCB8fCAwO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBmb2xkID0gdGhpcy5wb3NpdGlvbigpLmhlaWdodCArIHRoaXNbMF0uc2Nyb2xsVG9wO1xuICAgICAgICByZXR1cm4gZWxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmb2xkIDw9ICQoZWxlbWVudClbMF0ub2Zmc2V0VG9wIC0gdHJlc2hvbGQ7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhYm92ZXRoZXRvcDogZnVuY3Rpb24oZXhwcmVzc2lvbiwgdHJlc2hvbGQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5zZWFyY2goZXhwcmVzc2lvbik7XG4gICAgICAgIHRyZXNob2xkID0gdHJlc2hvbGQgfHwgMDtcbiAgICAgICAgaWYgKCFlbGVtZW50cykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgdG9wID0gdGhpc1swXS5zY3JvbGxUb3A7XG4gICAgICAgIHJldHVybiBlbGVtZW50cy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvcCA+PSAkKGVsZW1lbnQpWzBdLm9mZnNldFRvcCArICQoZWxlbWVudCkucG9zaXRpb24oKS5oZWlnaHQgLSB0cmVzaG9sZDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHJpZ2h0b2ZzY3JlZW46IGZ1bmN0aW9uKGV4cHJlc3Npb24sIHRyZXNob2xkKSB7XG4gICAgICAgIHZhciBlbGVtZW50cyA9IHRoaXMuc2VhcmNoKGV4cHJlc3Npb24pO1xuICAgICAgICB0cmVzaG9sZCA9IHRyZXNob2xkIHx8IDA7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdmFyIGZvbGQgPSB0aGlzLnBvc2l0aW9uKCkud2lkdGggKyB0aGlzWzBdLnNjcm9sbExlZnQ7XG4gICAgICAgIHJldHVybiBlbGVtZW50cy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGZvbGQgPD0gJChlbGVtZW50KVswXS5vZmZzZXRMZWZ0IC0gdHJlc2hvbGQ7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBsZWZ0b2ZzY3JlZW46IGZ1bmN0aW9uKGV4cHJlc3Npb24sIHRyZXNob2xkKSB7XG4gICAgICAgIHZhciBlbGVtZW50cyA9IHRoaXMuc2VhcmNoKGV4cHJlc3Npb24pO1xuICAgICAgICB0cmVzaG9sZCA9IHRyZXNob2xkIHx8IDA7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdmFyIGxlZnQgPSB0aGlzWzBdLnNjcm9sbExlZnQ7XG4gICAgICAgIHJldHVybiBlbGVtZW50cy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGxlZnQgPj0gJChlbGVtZW50KVswXS5vZmZzZXRMZWZ0ICsgJChlbGVtZW50KS5wb3NpdGlvbigpLndpZHRoIC0gdHJlc2hvbGQ7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBpbnZpZXdwb3J0OiBmdW5jdGlvbihleHByZXNzaW9uLCB0cmVzaG9sZCkge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSB0aGlzLnNlYXJjaChleHByZXNzaW9uKTtcbiAgICAgICAgdHJlc2hvbGQgPSB0cmVzaG9sZCB8fCAwO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBwb3NpdGlvbiA9IHRoaXMucG9zaXRpb24oKTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzLmZpbHRlcihmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50WzBdLm9mZnNldFRvcCArIHRyZXNob2xkID49IHRoaXNbMF0uc2Nyb2xsVG9wICYmXG4gICAgICAgICAgICAgICAgZWxlbWVudFswXS5vZmZzZXRUb3AgLSB0cmVzaG9sZCA8PSB0aGlzWzBdLnNjcm9sbFRvcCArIHBvc2l0aW9uLmhlaWdodDtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gJDtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCA9IHJlcXVpcmUoJ2VsZW1lbnRzJyk7XG5cbnZhciBmaWVsZFZhbGlkYXRpb24gPSBmdW5jdGlvbihmaWVsZCkge1xuICAgIGZpZWxkID0gJChmaWVsZCk7XG4gICAgdmFyIF9maWVsZCA9IGZpZWxkWzBdLFxuICAgICAgICB0YWcgPSBmaWVsZC50YWcoKSxcbiAgICAgICAgdHlwZSA9IGZpZWxkLnR5cGUoKSxcbiAgICAgICAgaXNWYWxpZCA9IHRydWU7XG5cbiAgICAvLyBvbmx5IHZhbGlkYXRlIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0XG4gICAgaWYgKCF+WydpbnB1dCcsICd0ZXh0YXJlYScsICdzZWxlY3QnXS5pbmRleE9mKHRhZykpIHsgcmV0dXJuIGlzVmFsaWQ7IH1cblxuICAgIC8vIHVzZSBuYXRpdmUgdmFsaWRhdGlvbiBpZiBhdmFpbGFibGVcbiAgICBpZiAodHlwZW9mIF9maWVsZC53aWxsVmFsaWRhdGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlmICh0YWcgPT0gJ2lucHV0JyAmJiAoX2ZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSAhPT0gdHlwZSB8fCBmaWVsZC5oYXNDbGFzcygnY3VzdG9tLXZhbGlkYXRpb24tZmllbGQnKSkpIHtcbiAgICAgICAgICAgIC8vIHR5cGUgbm90IHN1cHBvcnRlZCBvciBjdXN0b20sIGZhbGxiYWNrIHZhbGlkYXRpb25cbiAgICAgICAgICAgIF9maWVsZC5zZXRDdXN0b21WYWxpZGl0eSh2YWxpZGF0ZShmaWVsZCkgPyAnJyA6ICdUaGUgZmllbGQgdmFsdWUgaXMgaW52YWxpZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbmF0aXZlIHZhbGlkaXR5IGNoZWNrXG4gICAgICAgIF9maWVsZC5jaGVja1ZhbGlkaXR5KCk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgICBfZmllbGQudmFsaWRpdHkgPSBfZmllbGQudmFsaWRpdHkgfHwge307XG4gICAgICAgIF9maWVsZC52YWxpZGl0eS52YWxpZCA9IHZhbGlkYXRlKGZpZWxkKTtcbiAgICB9XG5cbiAgICBpc1ZhbGlkID0gX2ZpZWxkLnZhbGlkaXR5LnZhbGlkO1xuXG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59O1xuXG52YXIgdmFsaWRhdGUgPSBmdW5jdGlvbihmaWVsZCkge1xuICAgIGZpZWxkID0gJChmaWVsZCk7XG5cbiAgICB2YXIgaXNWYWxpZCA9IHRydWUsXG4gICAgICAgIHZhbHVlID0gZmllbGQudmFsdWUoKSxcbiAgICAgICAgdHlwZSA9IGZpZWxkLnR5cGUoKSxcbiAgICAgICAgaXNDaGVja2JveCA9ICh0eXBlID09ICdjaGVja2JveCcgfHwgdHlwZSA9PSAncmFkaW8nKSxcbiAgICAgICAgZGlzYWJsZWQgPSBmaWVsZC5hdHRyaWJ1dGUoJ2Rpc2FibGVkJyksXG4gICAgICAgIHJlcXVpcmVkID0gZmllbGQuYXR0cmlidXRlKCdyZXF1aXJlZCcpLFxuICAgICAgICBtaW5sZW5ndGggPSBmaWVsZC5hdHRyaWJ1dGUoJ21pbmxlbmd0aCcpLFxuICAgICAgICBtYXhsZW5ndGggPSBmaWVsZC5hdHRyaWJ1dGUoJ21heGxlbmd0aCcpLFxuICAgICAgICBtaW4gPSBmaWVsZC5hdHRyaWJ1dGUoJ21pbicpLFxuICAgICAgICBtYXggPSBmaWVsZC5hdHRyaWJ1dGUoJ21heCcpLFxuICAgICAgICBwYXR0ZXJuID0gZmllbGQuYXR0cmlidXRlKCdwYXR0ZXJuJyk7XG5cbiAgICAvLyBkaXNhYmxlZCBmaWVsZHMgc2hvdWxkIG5vdCBiZSB2YWxpZGF0ZWRcbiAgICBpZiAoZGlzYWJsZWQpIHsgcmV0dXJuIGlzVmFsaWQ7IH1cblxuICAgIC8vIHJlcXVpcmVkXG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgKCFyZXF1aXJlZCB8fCAoaXNDaGVja2JveCAmJiBmaWVsZC5jaGVja2VkKCkpIHx8ICghaXNDaGVja2JveCAmJiB2YWx1ZSkpO1xuXG4gICAgLy8gbWlubGVuZ3RoIC8gbWF4bGVuZ3RoXG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgKGlzQ2hlY2tib3ggfHwgKCghbWlubGVuZ3RoIHx8IHZhbHVlLmxlbmd0aCA+PSBtaW5sZW5ndGgpICYmICghbWF4bGVuZ3RoIHx8IHZhbHVlLmxlbmd0aCA8PSBtYXhsZW5ndGgpKSk7XG5cbiAgICAvLyBwYXR0ZXJuXG4gICAgaWYgKGlzVmFsaWQgJiYgcGF0dGVybikge1xuICAgICAgICBwYXR0ZXJuID0gbmV3IFJlZ0V4cChwYXR0ZXJuKTtcbiAgICAgICAgaXNWYWxpZCA9IHBhdHRlcm4udGVzdCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLy8gbWluIC8gbWF4XG4gICAgaWYgKGlzVmFsaWQgJiYgKG1pbiAhPT0gbnVsbCB8fCBtYXggIT09IG51bGwpKSB7XG4gICAgICAgIGlmIChtaW4gIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlzVmFsaWQgPSBwYXJzZUZsb2F0KHZhbHVlKSA+PSBwYXJzZUZsb2F0KG1pbik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWF4ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBpc1ZhbGlkID0gcGFyc2VGbG9hdCh2YWx1ZSkgPD0gcGFyc2VGbG9hdChtYXgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZpZWxkVmFsaWRhdGlvbjtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgICAgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgbWFwICAgICAgICAgICA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpLFxuICAgIEVtaXR0ZXIgICAgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG5cbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi9nZXQtYWpheC11cmwnKS5nbG9iYWwsXG4gICAgcGFyc2VBamF4VVJJICA9IHJlcXVpcmUoJy4vZ2V0LWFqYXgtdXJsJykucGFyc2UsXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4vZ2V0LWFqYXgtc3VmZml4Jyk7XG5cbnZhciBGbGFnc1N0YXRlID0gbmV3IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmZsYWdzID0gbWFwKCk7XG4gICAgfSxcblxuICAgIHNldDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5mbGFncy5zZXQoa2V5LCB2YWx1ZSkuZ2V0KGtleSk7XG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oa2V5LCBkZWYpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5mbGFncy5nZXQoa2V5KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWUgOiB0aGlzLnNldChrZXksIGRlZik7XG4gICAgfSxcblxuICAgIGtleXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5mbGFncy5rZXlzKCk7XG4gICAgfSxcblxuICAgIHZhbHVlczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZsYWdzLnZhbHVlcygpO1xuICAgIH0sXG5cbiAgICB3YXJuaW5nOiBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9LFxuICAgICAgICAgICAgYWZ0ZXJjbG9zZSA9IG9wdGlvbnMuYWZ0ZXJjbG9zZSB8fCBmdW5jdGlvbigpIHt9LFxuICAgICAgICAgICAgd2FybmluZ1VSTCA9IHBhcnNlQWpheFVSSShvcHRpb25zLnVybCB8fCBnZXRBamF4VVJMKCd1bnNhdmVkJykgKyBnZXRBamF4U3VmZml4KCkpO1xuXG4gICAgICAgIGlmICghb3B0aW9ucy51cmwgJiYgIW9wdGlvbnMubWVzc2FnZSkgeyBvcHRpb25zLnVybCA9IHRydWU7IH1cbiAgICAgICAgaWYgKG9wdGlvbnMudXJsKSB7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiAnTG9hZGluZy4uLicsXG4gICAgICAgICAgICAgICAgcmVtb3RlOiB3YXJuaW5nVVJMLFxuICAgICAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMuZGF0YSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBtb2RhbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG1vZGFsLmVsZW1lbnRzLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2FsbGJhY2spIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCByZXNwb25zZSwgY29udGVudCwgbW9kYWwpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWZ0ZXJDbG9zZTogYWZ0ZXJjbG9zZSB8fCBmdW5jdGlvbigpIHt9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG9wdGlvbnMubWVzc2FnZSxcbiAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKHJlc3BvbnNlLCBtb2RhbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG1vZGFsLmVsZW1lbnRzLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2FsbGJhY2spIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCByZXNwb25zZSwgY29udGVudCwgbW9kYWwpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWZ0ZXJDbG9zZTogYWZ0ZXJjbG9zZSB8fCBmdW5jdGlvbigpIHt9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IEZsYWdzU3RhdGUoKTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgZ2V0QWpheFN1ZmZpeCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBHQU5UUllfQUpBWF9TVUZGSVggPSB3aW5kb3cuR0FOVFJZX0FKQVhfU1VGRklYIHx8IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gdHlwZW9mIEdBTlRSWV9BSkFYX1NVRkZJWCA9PSAndW5kZWZpbmVkJyA/ICcnIDogR0FOVFJZX0FKQVhfU1VGRklYO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBnZXRBamF4U3VmZml4O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgdW5lc2NhcGVIdG1sICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3VuZXNjYXBlSHRtbCcpLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuL2dldC1hamF4LXN1ZmZpeCcpLFxuICAgIGVuZHNXaXRoICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9lbmRzV2l0aCcpLFxuICAgIGdldFF1ZXJ5ICAgICAgPSByZXF1aXJlKCdtb3V0L3F1ZXJ5U3RyaW5nL2dldFF1ZXJ5JyksXG4gICAgZ2V0UGFyYW0gICAgICA9IHJlcXVpcmUoJ21vdXQvcXVlcnlTdHJpbmcvZ2V0UGFyYW0nKSxcbiAgICBzZXRQYXJhbSAgICAgID0gcmVxdWlyZSgnbW91dC9xdWVyeVN0cmluZy9zZXRQYXJhbScpO1xuXG52YXIgZ2V0QWpheFVSTCA9IGZ1bmN0aW9uKHZpZXcsIHNlYXJjaCkge1xuICAgIHZhciBHQU5UUllfQUpBWF9VUkwgPSB3aW5kb3cuR0FOVFJZX0FKQVhfVVJMIHx8ICcnO1xuICAgIGlmICghc2VhcmNoKSB7IHNlYXJjaCA9ICclYWpheCUnOyB9XG4gICAgdmFyIHJlICA9IG5ldyBSZWdFeHAoc2VhcmNoLCAnZycpLFxuICAgICAgICB1cmwgPSB0eXBlb2YgR0FOVFJZX0FKQVhfVVJMID09ICd1bmRlZmluZWQnID8gJycgOiBHQU5UUllfQUpBWF9VUkw7XG5cbiAgICByZXR1cm4gdW5lc2NhcGVIdG1sKHVybC5yZXBsYWNlKHJlLCB2aWV3KSk7XG59O1xuXG52YXIgZ2V0Q29uZkFqYXhVUkwgPSBmdW5jdGlvbih2aWV3LCBzZWFyY2gpIHtcbiAgICB2YXIgR0FOVFJZX0FKQVhfQ09ORl9VUkwgPSB3aW5kb3cuR0FOVFJZX0FKQVhfQ09ORl9VUkwgfHwgJyc7XG4gICAgaWYgKCFzZWFyY2gpIHsgc2VhcmNoID0gJyVhamF4JSc7IH1cbiAgICB2YXIgcmUgID0gbmV3IFJlZ0V4cChzZWFyY2gsICdnJyksXG4gICAgICAgIHVybCA9IHR5cGVvZiBHQU5UUllfQUpBWF9DT05GX1VSTCA9PSAndW5kZWZpbmVkJyA/ICcnIDogR0FOVFJZX0FKQVhfQ09ORl9VUkw7XG5cbiAgICByZXR1cm4gdW5lc2NhcGVIdG1sKHVybC5yZXBsYWNlKHJlLCB2aWV3KSk7XG59O1xuXG52YXIgcGFyc2VBamF4VVJJID0gZnVuY3Rpb24odXJpKSB7XG4gICAgdmFyIEdBTlRSWV9QTEFURk9STSA9IHdpbmRvdy5HQU5UUllfUExBVEZPUk0gfHwgJycsXG4gICAgICAgIHBsYXRmb3JtICAgICAgICA9IHR5cGVvZiBHQU5UUllfUExBVEZPUk0gPT0gJ3VuZGVmaW5lZCcgPyAnJyA6IEdBTlRSWV9QTEFURk9STTtcblxuICAgIHN3aXRjaCAocGxhdGZvcm0pIHtcbiAgICAgICAgY2FzZSAnd29yZHByZXNzJzpcbiAgICAgICAgICAgIHVyaSA9IHVyaS5yZXBsYWNlKC90aGVtZXNcXC5waHAvaWcsICdhZG1pbi1hamF4LnBocCcpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2dyYXYnOlxuICAgICAgICAgICAgLy8gY29udmVydHMgZm9vL2Jhcj9ub25jZT0xMjM0Lmpzb24gdG8gZm9vL2Jhci5qc29uP25vbmNlPTEyMzRcbiAgICAgICAgICAgIHZhciBzdWZmaXggPSBnZXRBamF4U3VmZml4KCk7XG4gICAgICAgICAgICBpZiAoZW5kc1dpdGgodXJpLCBzdWZmaXgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ICA9ICcnICsgZ2V0UXVlcnkodXJpKSxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2UgID0gJycgKyBnZXRQYXJhbSh1cmksICdub25jZScpO1xuXG4gICAgICAgICAgICAgICAgdXJpID0gdXJpLnJlcGxhY2UocXVlcnksIHN1ZmZpeCkgKyBxdWVyeS5yZXBsYWNlKG5vbmNlLCAobm9uY2UucmVwbGFjZShzdWZmaXgsICcnKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgfVxuXG4gICAgcmV0dXJuIHVyaTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIGdsb2JhbDogZ2V0QWpheFVSTCxcbiAgICBjb25maWc6IGdldENvbmZBamF4VVJMLFxuICAgIHBhcnNlOiBwYXJzZUFqYXhVUklcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciAkICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB0cmltID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpO1xuXG52YXIgZ2V0T3V0bGluZU5hbWVCeUlkID0gZnVuY3Rpb24ob3V0bGluZSkge1xuICAgIGlmIChvdXRsaW5lID09IG51bGwpIHsgcmV0dXJuICcnOyB9XG4gICAgcmV0dXJuIHRyaW0oJCgnI2NvbmZpZ3VyYXRpb24tc2VsZWN0b3InKS5zZWxlY3RpemVJbnN0YW5jZS5PcHRpb25zW291dGxpbmVdLnRleHQpO1xufTtcblxudmFyIGdldEN1cnJlbnRPdXRsaW5lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRyaW0oJCgnI2NvbmZpZ3VyYXRpb24tc2VsZWN0b3InKS5zZWxlY3RpemVJbnN0YW5jZS5nZXRWYWx1ZSgpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0geyBnZXRPdXRsaW5lTmFtZUJ5SWQ6IGdldE91dGxpbmVOYW1lQnlJZCwgZ2V0Q3VycmVudE91dGxpbmU6IGdldEN1cnJlbnRPdXRsaW5lIH07XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHplbiA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpO1xuXG52YXIgY2FjaGVkICAgICAgICAgICAgPSBudWxsLFxuICAgIGdldFNjcm9sbGJhcldpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjYWNoZWQgIT09IG51bGwpIHsgcmV0dXJuIGNhY2hlZDsgfVxuXG4gICAgICAgIHZhciBzaXplLCBkdW1teSA9IHplbignZGl2JykuYm90dG9tKCcjZzUtY29udGFpbmVyJyk7XG4gICAgICAgIGR1bW15LnN0eWxlKHtcbiAgICAgICAgICAgIHdpZHRoOiAxMDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDEwMCxcbiAgICAgICAgICAgIG92ZXJmbG93OiAnc2Nyb2xsJyxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgekluZGV4OiAtOTk5OVxuICAgICAgICB9KTtcblxuICAgICAgICBzaXplID0gZHVtbXlbMF0ub2Zmc2V0V2lkdGggLSBkdW1teVswXS5jbGllbnRXaWR0aDtcbiAgICAgICAgZHVtbXkucmVtb3ZlKCk7XG5cbiAgICAgICAgY2FjaGVkID0gc2l6ZTtcbiAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgfTtcblxubW9kdWxlLmV4cG9ydHMgPSBnZXRTY3JvbGxiYXJXaWR0aDtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgJCAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIGRvbXJlYWR5ID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKTtcblxuLy8gTG9jYWxpc2UgR2xvYmFsc1xudmFyIEhpc3RvcnkgPSB7fTtcblxuLy8gQ2hlY2sgRXhpc3RlbmNlXG5pZiAodHlwZW9mIEhpc3RvcnkuQWRhcHRlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0hpc3RvcnkuanMgQWRhcHRlciBoYXMgYWxyZWFkeSBiZWVuIGxvYWRlZC4uLicpO1xufVxuXG4vLyBBZGQgdGhlIEFkYXB0ZXJcbkhpc3RvcnkuQWRhcHRlciA9IHtcbiAgICAvKipcbiAgICAgKiBIaXN0b3J5LkFkYXB0ZXIuYmluZChlbCxldmVudCxjYWxsYmFjaylcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8c3RyaW5nfSBlbFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudCAtIGN1c3RvbSBhbmQgc3RhbmRhcmQgZXZlbnRzXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIGJpbmQ6IGZ1bmN0aW9uKGVsLCBldmVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgJChlbCkub24oZXZlbnQsIGNhbGxiYWNrKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIoZWwsZXZlbnQpXG4gICAgICogQHBhcmFtIHtFbGVtZW50fHN0cmluZ30gZWxcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQgLSBjdXN0b20gYW5kIHN0YW5kYXJkIGV2ZW50c1xuICAgICAqIEBwYXJhbSB7T2JqZWN0PX0gZXh0cmEgLSBhIG9iamVjdCBvZiBleHRyYSBldmVudCBkYXRhIChvcHRpb25hbClcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICB0cmlnZ2VyOiBmdW5jdGlvbihlbCwgZXZlbnQsIGV4dHJhKSB7XG4gICAgICAgICQoZWwpLmVtaXQoZXZlbnQsIGV4dHJhKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGlzdG9yeS5BZGFwdGVyLmV4dHJhY3RFdmVudERhdGEoa2V5LGV2ZW50LGV4dHJhKVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSBrZXkgZm9yIHRoZSBldmVudCBkYXRhIHRvIGV4dHJhY3RcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQgLSBjdXN0b20gYW5kIHN0YW5kYXJkIGV2ZW50c1xuICAgICAqL1xuICAgIGV4dHJhY3RFdmVudERhdGE6IGZ1bmN0aW9uKGtleSwgZXZlbnQpIHtcbiAgICAgICAgLy8gTW9vVG9vbHMgTmF0aXZlIHRoZW4gTW9vVG9vbHMgQ3VzdG9tXG4gICAgICAgIHJldHVybiAoZXZlbnQgJiYgZXZlbnQuZXZlbnQgJiYgZXZlbnQuZXZlbnRba2V5XSkgfHwgKGV2ZW50ICYmIGV2ZW50W2tleV0pIHx8IHVuZGVmaW5lZDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGlzdG9yeS5BZGFwdGVyLm9uRG9tTG9hZChjYWxsYmFjaylcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgb25Eb21Mb2FkOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICBkb21yZWFkeShjYWxsYmFjayk7XG4gICAgfVxufTtcblxuLy8gVHJ5IGFuZCBJbml0aWFsaXNlIEhpc3RvcnlcbmlmICh0eXBlb2YgSGlzdG9yeS5pbml0ICE9PSAndW5kZWZpbmVkJykge1xuICAgIEhpc3RvcnkuaW5pdCgpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEhpc3Rvcnk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSW5pdGlhbGlzZVxuXG4vLyBMb2NhbGlzZSBHbG9iYWxzXG52YXJcbiAgICBjb25zb2xlICAgICAgICA9IHdpbmRvdy5jb25zb2xlIHx8IHVuZGVmaW5lZCwgLy8gUHJldmVudCBhIEpTTGludCBjb21wbGFpblxuICAgIGRvY3VtZW50ICAgICAgID0gd2luZG93LmRvY3VtZW50LCAvLyBNYWtlIHN1cmUgd2UgYXJlIHVzaW5nIHRoZSBjb3JyZWN0IGRvY3VtZW50XG4gICAgbmF2aWdhdG9yICAgICAgPSB3aW5kb3cubmF2aWdhdG9yLCAvLyBNYWtlIHN1cmUgd2UgYXJlIHVzaW5nIHRoZSBjb3JyZWN0IG5hdmlnYXRvclxuICAgIHNlc3Npb25TdG9yYWdlID0gZmFsc2UsIC8vIHNlc3Npb25TdG9yYWdlXG4gICAgc2V0VGltZW91dCAgICAgPSB3aW5kb3cuc2V0VGltZW91dCxcbiAgICBjbGVhclRpbWVvdXQgICA9IHdpbmRvdy5jbGVhclRpbWVvdXQsXG4gICAgc2V0SW50ZXJ2YWwgICAgPSB3aW5kb3cuc2V0SW50ZXJ2YWwsXG4gICAgY2xlYXJJbnRlcnZhbCAgPSB3aW5kb3cuY2xlYXJJbnRlcnZhbCxcbiAgICBKU09OICAgICAgICAgICA9IHdpbmRvdy5KU09OLFxuICAgIGFsZXJ0ICAgICAgICAgID0gd2luZG93LmFsZXJ0LFxuICAgIEhpc3RvcnkgICAgICAgID0gd2luZG93Lkhpc3RvcnkgPSByZXF1aXJlKCcuL2hpc3RvcnktYWRhcHRlcicpIHx8IHt9LCAvLyBQdWJsaWMgSGlzdG9yeSBPYmplY3RcbiAgICBoaXN0b3J5ICAgICAgICA9IHdpbmRvdy5oaXN0b3J5OyAvLyBPbGQgSGlzdG9yeSBPYmplY3RcblxudHJ5IHtcbiAgICBzZXNzaW9uU3RvcmFnZSA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZTsgLy8gVGhpcyB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbiBpbiBzb21lIGJyb3dzZXJzIHdoZW4gY29va2llcy9sb2NhbFN0b3JhZ2UgYXJlIGV4cGxpY2l0bHkgZGlzYWJsZWQgKGkuZS4gQ2hyb21lKVxuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ1RFU1QnLCAnMScpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ1RFU1QnKTtcbn0gY2F0Y2ggKGUpIHtcbiAgICBzZXNzaW9uU3RvcmFnZSA9IGZhbHNlO1xufVxuXG4vLyBNb29Ub29scyBDb21wYXRpYmlsaXR5XG5KU09OLnN0cmluZ2lmeSA9IEpTT04uc3RyaW5naWZ5IHx8IEpTT04uZW5jb2RlO1xuSlNPTi5wYXJzZSA9IEpTT04ucGFyc2UgfHwgSlNPTi5kZWNvZGU7XG5cbi8vIENoZWNrIEV4aXN0ZW5jZVxuaWYgKHR5cGVvZiBIaXN0b3J5LmluaXQgPT09ICd1bmRlZmluZWQnKSB7XG5cbiAgICAvLyBJbml0aWFsaXNlIEhpc3RvcnlcbiAgICBIaXN0b3J5LmluaXQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAvLyBDaGVjayBMb2FkIFN0YXR1cyBvZiBBZGFwdGVyXG4gICAgICAgIGlmICh0eXBlb2YgSGlzdG9yeS5BZGFwdGVyID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgTG9hZCBTdGF0dXMgb2YgQ29yZVxuICAgICAgICBpZiAodHlwZW9mIEhpc3RvcnkuaW5pdENvcmUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBIaXN0b3J5LmluaXRDb3JlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBMb2FkIFN0YXR1cyBvZiBIVE1MNCBTdXBwb3J0XG4gICAgICAgIGlmICh0eXBlb2YgSGlzdG9yeS5pbml0SHRtbDQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBIaXN0b3J5LmluaXRIdG1sNCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmV0dXJuIHRydWVcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gSW5pdGlhbGlzZSBDb3JlXG5cbiAgICAvLyBJbml0aWFsaXNlIENvcmVcbiAgICBIaXN0b3J5LmluaXRDb3JlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgLy8gSW5pdGlhbGlzZVxuICAgICAgICBpZiAodHlwZW9mIEhpc3RvcnkuaW5pdENvcmUuaW5pdGlhbGl6ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyBBbHJlYWR5IExvYWRlZFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgSGlzdG9yeS5pbml0Q29yZS5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIE9wdGlvbnNcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zXG4gICAgICAgICAqIENvbmZpZ3VyYWJsZSBvcHRpb25zXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMgPSBIaXN0b3J5Lm9wdGlvbnMgfHwge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5oYXNoQ2hhbmdlSW50ZXJ2YWxcbiAgICAgICAgICogSG93IGxvbmcgc2hvdWxkIHRoZSBpbnRlcnZhbCBiZSBiZWZvcmUgaGFzaGNoYW5nZSBjaGVja3NcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5oYXNoQ2hhbmdlSW50ZXJ2YWwgPSBIaXN0b3J5Lm9wdGlvbnMuaGFzaENoYW5nZUludGVydmFsIHx8IDEwMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLnNhZmFyaVBvbGxJbnRlcnZhbFxuICAgICAgICAgKiBIb3cgbG9uZyBzaG91bGQgdGhlIGludGVydmFsIGJlIGJlZm9yZSBzYWZhcmkgcG9sbCBjaGVja3NcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5zYWZhcmlQb2xsSW50ZXJ2YWwgPSBIaXN0b3J5Lm9wdGlvbnMuc2FmYXJpUG9sbEludGVydmFsIHx8IDUwMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmRvdWJsZUNoZWNrSW50ZXJ2YWxcbiAgICAgICAgICogSG93IGxvbmcgc2hvdWxkIHRoZSBpbnRlcnZhbCBiZSBiZWZvcmUgd2UgcGVyZm9ybSBhIGRvdWJsZSBjaGVja1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmRvdWJsZUNoZWNrSW50ZXJ2YWwgPSBIaXN0b3J5Lm9wdGlvbnMuZG91YmxlQ2hlY2tJbnRlcnZhbCB8fCA1MDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5kaXNhYmxlU3VpZFxuICAgICAgICAgKiBGb3JjZSBIaXN0b3J5IG5vdCB0byBhcHBlbmQgc3VpZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmRpc2FibGVTdWlkID0gSGlzdG9yeS5vcHRpb25zLmRpc2FibGVTdWlkIHx8IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuc3RvcmVJbnRlcnZhbFxuICAgICAgICAgKiBIb3cgbG9uZyBzaG91bGQgd2Ugd2FpdCBiZXR3ZWVuIHN0b3JlIGNhbGxzXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuc3RvcmVJbnRlcnZhbCA9IEhpc3Rvcnkub3B0aW9ucy5zdG9yZUludGVydmFsIHx8IDEwMDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5idXN5RGVsYXlcbiAgICAgICAgICogSG93IGxvbmcgc2hvdWxkIHdlIHdhaXQgYmV0d2VlbiBidXN5IGV2ZW50c1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmJ1c3lEZWxheSA9IEhpc3Rvcnkub3B0aW9ucy5idXN5RGVsYXkgfHwgMjUwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuZGVidWdcbiAgICAgICAgICogSWYgdHJ1ZSB3aWxsIGVuYWJsZSBkZWJ1ZyBtZXNzYWdlcyB0byBiZSBsb2dnZWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5kZWJ1ZyA9IEhpc3Rvcnkub3B0aW9ucy5kZWJ1ZyB8fCBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmluaXRpYWxUaXRsZVxuICAgICAgICAgKiBXaGF0IGlzIHRoZSB0aXRsZSBvZiB0aGUgaW5pdGlhbCBzdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmluaXRpYWxUaXRsZSA9IEhpc3Rvcnkub3B0aW9ucy5pbml0aWFsVGl0bGUgfHwgZG9jdW1lbnQudGl0bGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5odG1sNE1vZGVcbiAgICAgICAgICogSWYgdHJ1ZSwgd2lsbCBmb3JjZSBIVE1sNCBtb2RlIChoYXNodGFncylcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5odG1sNE1vZGUgPSBIaXN0b3J5Lm9wdGlvbnMuaHRtbDRNb2RlIHx8IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuZGVsYXlJbml0XG4gICAgICAgICAqIFdhbnQgdG8gb3ZlcnJpZGUgZGVmYXVsdCBvcHRpb25zIGFuZCBjYWxsIGluaXQgbWFudWFsbHkuXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuZGVsYXlJbml0ID0gSGlzdG9yeS5vcHRpb25zLmRlbGF5SW5pdCB8fCBmYWxzZTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEludGVydmFsIHJlY29yZFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmludGVydmFsTGlzdFxuICAgICAgICAgKiBMaXN0IG9mIGludGVydmFscyBzZXQsIHRvIGJlIGNsZWFyZWQgd2hlbiBkb2N1bWVudCBpcyB1bmxvYWRlZC5cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuaW50ZXJ2YWxMaXN0ID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuY2xlYXJBbGxJbnRlcnZhbHNcbiAgICAgICAgICogQ2xlYXJzIGFsbCBzZXRJbnRlcnZhbCBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmNsZWFyQWxsSW50ZXJ2YWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGksIGlsID0gSGlzdG9yeS5pbnRlcnZhbExpc3Q7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGlsICE9PSBcInVuZGVmaW5lZFwiICYmIGlsICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaWxbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBIaXN0b3J5LmludGVydmFsTGlzdCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBEZWJ1Z1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmRlYnVnKG1lc3NhZ2UsLi4uKVxuICAgICAgICAgKiBMb2dzIHRoZSBwYXNzZWQgYXJndW1lbnRzIGlmIGRlYnVnIGVuYWJsZWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZGVidWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoKEhpc3Rvcnkub3B0aW9ucy5kZWJ1ZyB8fCBmYWxzZSkpIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmxvZy5hcHBseShIaXN0b3J5LCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmxvZyhtZXNzYWdlLC4uLilcbiAgICAgICAgICogTG9ncyB0aGUgcGFzc2VkIGFyZ3VtZW50c1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5sb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBjb25zb2xlRXhpc3RzID0gISh0eXBlb2YgY29uc29sZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGNvbnNvbGUubG9nID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29uc29sZS5sb2cuYXBwbHkgPT09ICd1bmRlZmluZWQnKSxcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2cnKSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIGksIG4sXG4gICAgICAgICAgICAgICAgYXJncywgYXJnXG4gICAgICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICAvLyBXcml0ZSB0byBDb25zb2xlXG4gICAgICAgICAgICBpZiAoY29uc29sZUV4aXN0cykge1xuICAgICAgICAgICAgICAgIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBhcmdzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlLmRlYnVnICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIFttZXNzYWdlLCBhcmdzXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBbbWVzc2FnZSwgYXJnc10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAoXCJcXG5cIiArIGFyZ3VtZW50c1swXSArIFwiXFxuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBXcml0ZSB0byBsb2dcbiAgICAgICAgICAgIGZvciAoaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgYXJnID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgSlNPTiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IEpTT04uc3RyaW5naWZ5KGFyZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjdXJzaXZlIE9iamVjdFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gXCJcXG5cIiArIGFyZyArIFwiXFxuXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRleHRhcmVhXG4gICAgICAgICAgICBpZiAodGV4dGFyZWEpIHtcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYS52YWx1ZSArPSBtZXNzYWdlICsgXCJcXG4tLS0tLVxcblwiO1xuICAgICAgICAgICAgICAgIHRleHRhcmVhLnNjcm9sbFRvcCA9IHRleHRhcmVhLnNjcm9sbEhlaWdodCAtIHRleHRhcmVhLmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5vIFRleHRhcmVhLCBObyBDb25zb2xlXG4gICAgICAgICAgICBlbHNlIGlmICghY29uc29sZUV4aXN0cykge1xuICAgICAgICAgICAgICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFbXVsYXRlZCBTdGF0dXNcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uKClcbiAgICAgICAgICogR2V0J3MgdGhlIG1ham9yIHZlcnNpb24gb2YgSW50ZXJuZXQgRXhwbG9yZXJcbiAgICAgICAgICogQHJldHVybiB7aW50ZWdlcn1cbiAgICAgICAgICogQGxpY2Vuc2UgUHVibGljIERvbWFpblxuICAgICAgICAgKiBAYXV0aG9yIEJlbmphbWluIEFydGh1ciBMdXB0b24gPGNvbnRhY3RAYmFsdXB0b24uY29tPlxuICAgICAgICAgKiBAYXV0aG9yIEphbWVzIFBhZG9sc2V5IDxodHRwczovL2dpc3QuZ2l0aHViLmNvbS81Mjc2ODM+XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uLmNhY2hlZCA9XG4gICAgICAgICAgICAgICAgICAgICh0eXBlb2YgSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uLmNhY2hlZCAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IEhpc3RvcnkuZ2V0SW50ZXJuZXRFeHBsb3Jlck1ham9yVmVyc2lvbi5jYWNoZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGwgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2knKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoZGl2LmlubmVySFRNTCA9ICc8IS0tW2lmIGd0IElFICcgKyAoKyt2KSArICddPjxpPjwvaT48IVtlbmRpZl0tLT4nKSAmJiBhbGxbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodiA+IDQpID8gdiA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KSgpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIoKVxuICAgICAgICAgKiBBcmUgd2UgdXNpbmcgSW50ZXJuZXQgRXhwbG9yZXI/XG4gICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAgICAgICAqIEBsaWNlbnNlIFB1YmxpYyBEb21haW5cbiAgICAgICAgICogQGF1dGhvciBCZW5qYW1pbiBBcnRodXIgTHVwdG9uIDxjb250YWN0QGJhbHVwdG9uLmNvbT5cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyLmNhY2hlZCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAodHlwZW9mIEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyLmNhY2hlZCAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBIaXN0b3J5LmlzSW50ZXJuZXRFeHBsb3Jlci5jYWNoZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4oSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uKCkpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5lbXVsYXRlZFxuICAgICAgICAgKiBXaGljaCBmZWF0dXJlcyByZXF1aXJlIGVtdWxhdGluZz9cbiAgICAgICAgICovXG5cbiAgICAgICAgaWYgKEhpc3Rvcnkub3B0aW9ucy5odG1sNE1vZGUpIHtcbiAgICAgICAgICAgIEhpc3RvcnkuZW11bGF0ZWQgPSB7XG4gICAgICAgICAgICAgICAgcHVzaFN0YXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhc2hDaGFuZ2U6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgSGlzdG9yeS5lbXVsYXRlZCA9IHtcbiAgICAgICAgICAgICAgICBwdXNoU3RhdGU6ICFCb29sZWFuKFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeSAmJiB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgJiYgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlXG4gICAgICAgICAgICAgICAgICAgICYmICEoXG4gICAgICAgICAgICAgICAgICAgICgvIE1vYmlsZVxcLyhbMS03XVthLXpdfCg4KFthYmNkZV18ZigxWzAtOF0pKSkpL2kpLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgLyogZGlzYWJsZSBmb3IgdmVyc2lvbnMgb2YgaU9TIGJlZm9yZSB2ZXJzaW9uIDQuMyAoOEYxOTApICovXG4gICAgICAgICAgICAgICAgICAgIHx8ICgvQXBwbGVXZWJLaXRcXC81KFswLTJdfDNbMC0yXSkvaSkudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAvKiBkaXNhYmxlIGZvciB0aGUgbWVyY3VyeSBpT1MgYnJvd3Nlciwgb3IgYXQgbGVhc3Qgb2xkZXIgdmVyc2lvbnMgb2YgdGhlIHdlYmtpdCBlbmdpbmUgKi9cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgaGFzaENoYW5nZTogQm9vbGVhbihcbiAgICAgICAgICAgICAgICAgICAgISgoJ29uaGFzaGNoYW5nZScgaW4gd2luZG93KSB8fCAoJ29uaGFzaGNoYW5nZScgaW4gZG9jdW1lbnQpKVxuICAgICAgICAgICAgICAgICAgICB8fFxuICAgICAgICAgICAgICAgICAgICAoSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIoKSAmJiBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24oKSA8IDgpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmVuYWJsZWRcbiAgICAgICAgICogSXMgSGlzdG9yeSBlbmFibGVkP1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5lbmFibGVkID0gIUhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmJ1Z3NcbiAgICAgICAgICogV2hpY2ggYnVncyBhcmUgcHJlc2VudFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5idWdzID0ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBTYWZhcmkgNSBhbmQgU2FmYXJpIGlPUyA0IGZhaWwgdG8gcmV0dXJuIHRvIHRoZSBjb3JyZWN0IHN0YXRlIG9uY2UgYSBoYXNoIGlzIHJlcGxhY2VkIGJ5IGEgYHJlcGxhY2VTdGF0ZWAgY2FsbFxuICAgICAgICAgICAgICogaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTU2MjQ5XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHNldEhhc2g6IEJvb2xlYW4oIUhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlICYmIG5hdmlnYXRvci52ZW5kb3IgPT09ICdBcHBsZSBDb21wdXRlciwgSW5jLicgJiYgL0FwcGxlV2ViS2l0XFwvNShbMC0yXXwzWzAtM10pLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBTYWZhcmkgNSBhbmQgU2FmYXJpIGlPUyA0IHNvbWV0aW1lcyBmYWlsIHRvIGFwcGx5IHRoZSBzdGF0ZSBjaGFuZ2UgdW5kZXIgYnVzeSBjb25kaXRpb25zXG4gICAgICAgICAgICAgKiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NDI5NDBcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgc2FmYXJpUG9sbDogQm9vbGVhbighSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUgJiYgbmF2aWdhdG9yLnZlbmRvciA9PT0gJ0FwcGxlIENvbXB1dGVyLCBJbmMuJyAmJiAvQXBwbGVXZWJLaXRcXC81KFswLTJdfDNbMC0zXSkvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpLFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE1TSUUgNiBhbmQgNyBzb21ldGltZXMgZG8gbm90IGFwcGx5IGEgaGFzaCBldmVuIGl0IHdhcyB0b2xkIHRvIChyZXF1aXJpbmcgYSBzZWNvbmQgY2FsbCB0byB0aGUgYXBwbHkgZnVuY3Rpb24pXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGllRG91YmxlQ2hlY2s6IEJvb2xlYW4oSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIoKSAmJiBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24oKSA8IDgpLFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE1TSUUgNiByZXF1aXJlcyB0aGUgZW50aXJlIGhhc2ggdG8gYmUgZW5jb2RlZCBmb3IgdGhlIGhhc2hlcyB0byB0cmlnZ2VyIHRoZSBvbkhhc2hDaGFuZ2UgZXZlbnRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaGFzaEVzY2FwZTogQm9vbGVhbihIaXN0b3J5LmlzSW50ZXJuZXRFeHBsb3JlcigpICYmIEhpc3RvcnkuZ2V0SW50ZXJuZXRFeHBsb3Jlck1ham9yVmVyc2lvbigpIDwgNylcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5pc0VtcHR5T2JqZWN0KG9iailcbiAgICAgICAgICogQ2hlY2tzIHRvIHNlZSBpZiB0aGUgT2JqZWN0IGlzIEVtcHR5XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmpcbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuaXNFbXB0eU9iamVjdCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuY2xvbmVPYmplY3Qob2JqKVxuICAgICAgICAgKiBDbG9uZXMgYSBvYmplY3QgYW5kIGVsaW1pbmF0ZSBhbGwgcmVmZXJlbmNlcyB0byB0aGUgb3JpZ2luYWwgY29udGV4dHNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9ialxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmNsb25lT2JqZWN0ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgdmFyIGhhc2gsIG5ld09iajtcbiAgICAgICAgICAgIGlmIChvYmopIHtcbiAgICAgICAgICAgICAgICBoYXNoID0gSlNPTi5zdHJpbmdpZnkob2JqKTtcbiAgICAgICAgICAgICAgICBuZXdPYmogPSBKU09OLnBhcnNlKGhhc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3T2JqID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3T2JqO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gVVJMIEhlbHBlcnNcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRSb290VXJsKClcbiAgICAgICAgICogVHVybnMgXCJodHRwOi8vbXlzaXRlLmNvbS9kaXIvcGFnZS5odG1sP2FzZFwiIGludG8gXCJodHRwOi8vbXlzaXRlLmNvbVwiXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gcm9vdFVybFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRSb290VXJsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICB2YXIgcm9vdFVybCA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIChkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSB8fCBkb2N1bWVudC5sb2NhdGlvbi5ob3N0KTtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5sb2NhdGlvbi5wb3J0IHx8IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcm9vdFVybCArPSAnOicgKyBkb2N1bWVudC5sb2NhdGlvbi5wb3J0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcm9vdFVybCArPSAnLyc7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIHJvb3RVcmw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0QmFzZUhyZWYoKVxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBgaHJlZmAgYXR0cmlidXRlIG9mIHRoZSBgPGJhc2UgaHJlZj1cIi4uLlwiPmAgZWxlbWVudCBpZiBpdCBleGlzdHNcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBiYXNlSHJlZlxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRCYXNlSHJlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZVxuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgYmFzZUVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2Jhc2UnKSxcbiAgICAgICAgICAgICAgICBiYXNlRWxlbWVudCA9IG51bGwsXG4gICAgICAgICAgICAgICAgYmFzZUhyZWYgPSAnJztcblxuICAgICAgICAgICAgLy8gVGVzdCBmb3IgQmFzZSBFbGVtZW50XG4gICAgICAgICAgICBpZiAoYmFzZUVsZW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIEJhc2UgRWxlbWVudFxuICAgICAgICAgICAgICAgIGJhc2VFbGVtZW50ID0gYmFzZUVsZW1lbnRzWzBdO1xuICAgICAgICAgICAgICAgIGJhc2VIcmVmID0gYmFzZUVsZW1lbnQuaHJlZi5yZXBsYWNlKC9bXlxcL10rJC8sICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRqdXN0IHRyYWlsaW5nIHNsYXNoXG4gICAgICAgICAgICBiYXNlSHJlZiA9IGJhc2VIcmVmLnJlcGxhY2UoL1xcLyskLywgJycpO1xuICAgICAgICAgICAgaWYgKGJhc2VIcmVmKSBiYXNlSHJlZiArPSAnLyc7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIGJhc2VIcmVmO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEJhc2VVcmwoKVxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBiYXNlSHJlZiBvciBiYXNlUGFnZVVybCBvciByb290VXJsICh3aGljaGV2ZXIgb25lIGV4aXN0cyBmaXJzdClcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBiYXNlVXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEJhc2VVcmwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGVcbiAgICAgICAgICAgIHZhciBiYXNlVXJsID0gSGlzdG9yeS5nZXRCYXNlSHJlZigpIHx8IEhpc3RvcnkuZ2V0QmFzZVBhZ2VVcmwoKSB8fCBIaXN0b3J5LmdldFJvb3RVcmwoKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gYmFzZVVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRQYWdlVXJsKClcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgVVJMIG9mIHRoZSBjdXJyZW50IHBhZ2VcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBwYWdlVXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFBhZ2VVcmwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgU3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKGZhbHNlLCBmYWxzZSksXG4gICAgICAgICAgICAgICAgc3RhdGVVcmwgPSAoU3RhdGUgfHwge30pLnVybCB8fCBIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpLFxuICAgICAgICAgICAgICAgIHBhZ2VVcmw7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZVxuICAgICAgICAgICAgcGFnZVVybCA9IHN0YXRlVXJsLnJlcGxhY2UoL1xcLyskLywgJycpLnJlcGxhY2UoL1teXFwvXSskLywgZnVuY3Rpb24gKHBhcnQsIGluZGV4LCBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKC9cXC4vKS50ZXN0KHBhcnQpID8gcGFydCA6IHBhcnQgKyAnLyc7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gcGFnZVVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRCYXNlUGFnZVVybCgpXG4gICAgICAgICAqIEZldGNoZXMgdGhlIFVybCBvZiB0aGUgZGlyZWN0b3J5IG9mIHRoZSBjdXJyZW50IHBhZ2VcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBiYXNlUGFnZVVybFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRCYXNlUGFnZVVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZVxuICAgICAgICAgICAgdmFyIGJhc2VQYWdlVXJsID0gKEhpc3RvcnkuZ2V0TG9jYXRpb25IcmVmKCkpLnJlcGxhY2UoL1sjXFw/XS4qLywgJycpLnJlcGxhY2UoL1teXFwvXSskLywgZnVuY3Rpb24gKHBhcnQsIGluZGV4LCBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgvW15cXC9dJC8pLnRlc3QocGFydCkgPyAnJyA6IHBhcnQ7XG4gICAgICAgICAgICAgICAgfSkucmVwbGFjZSgvXFwvKyQvLCAnJykgKyAnLyc7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIGJhc2VQYWdlVXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEZ1bGxVcmwodXJsKVxuICAgICAgICAgKiBFbnN1cmVzIHRoYXQgd2UgaGF2ZSBhbiBhYnNvbHV0ZSBVUkwgYW5kIG5vdCBhIHJlbGF0aXZlIFVSTFxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gYWxsb3dCYXNlSHJlZlxuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IGZ1bGxVcmxcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0RnVsbFVybCA9IGZ1bmN0aW9uICh1cmwsIGFsbG93QmFzZUhyZWYpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBmdWxsVXJsID0gdXJsLCBmaXJzdENoYXIgPSB1cmwuc3Vic3RyaW5nKDAsIDEpO1xuICAgICAgICAgICAgYWxsb3dCYXNlSHJlZiA9ICh0eXBlb2YgYWxsb3dCYXNlSHJlZiA9PT0gJ3VuZGVmaW5lZCcpID8gdHJ1ZSA6IGFsbG93QmFzZUhyZWY7XG5cbiAgICAgICAgICAgIC8vIENoZWNrXG4gICAgICAgICAgICBpZiAoL1thLXpdK1xcOlxcL1xcLy8udGVzdCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgLy8gRnVsbCBVUkxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpcnN0Q2hhciA9PT0gJy8nKSB7XG4gICAgICAgICAgICAgICAgLy8gUm9vdCBVUkxcbiAgICAgICAgICAgICAgICBmdWxsVXJsID0gSGlzdG9yeS5nZXRSb290VXJsKCkgKyB1cmwucmVwbGFjZSgvXlxcLysvLCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaXJzdENoYXIgPT09ICcjJykge1xuICAgICAgICAgICAgICAgIC8vIEFuY2hvciBVUkxcbiAgICAgICAgICAgICAgICBmdWxsVXJsID0gSGlzdG9yeS5nZXRQYWdlVXJsKCkucmVwbGFjZSgvIy4qLywgJycpICsgdXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmlyc3RDaGFyID09PSAnPycpIHtcbiAgICAgICAgICAgICAgICAvLyBRdWVyeSBVUkxcbiAgICAgICAgICAgICAgICBmdWxsVXJsID0gSGlzdG9yeS5nZXRQYWdlVXJsKCkucmVwbGFjZSgvW1xcPyNdLiovLCAnJykgKyB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBSZWxhdGl2ZSBVUkxcbiAgICAgICAgICAgICAgICBpZiAoYWxsb3dCYXNlSHJlZikge1xuICAgICAgICAgICAgICAgICAgICBmdWxsVXJsID0gSGlzdG9yeS5nZXRCYXNlVXJsKCkgKyB1cmwucmVwbGFjZSgvXihcXC5cXC8pKy8sICcnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmdWxsVXJsID0gSGlzdG9yeS5nZXRCYXNlUGFnZVVybCgpICsgdXJsLnJlcGxhY2UoL14oXFwuXFwvKSsvLCAnJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgYW4gaWYgY29uZGl0aW9uIGFib3ZlIGFzIHdlIGRvIG5vdCB3YW50IGhhc2hlc1xuICAgICAgICAgICAgICAgIC8vIHdoaWNoIGFyZSByZWxhdGl2ZSB0byB0aGUgYmFzZUhyZWYgaW4gb3VyIFVSTHNcbiAgICAgICAgICAgICAgICAvLyBhcyBpZiB0aGUgYmFzZUhyZWYgY2hhbmdlcywgdGhlbiBhbGwgb3VyIGJvb2ttYXJrc1xuICAgICAgICAgICAgICAgIC8vIHdvdWxkIG5vdyBwb2ludCB0byBkaWZmZXJlbnQgbG9jYXRpb25zXG4gICAgICAgICAgICAgICAgLy8gd2hlcmVhcyB0aGUgYmFzZVBhZ2VVcmwgd2lsbCBhbHdheXMgc3RheSB0aGUgc2FtZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBmdWxsVXJsLnJlcGxhY2UoL1xcIyQvLCAnJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0U2hvcnRVcmwodXJsKVxuICAgICAgICAgKiBFbnN1cmVzIHRoYXQgd2UgaGF2ZSBhIHJlbGF0aXZlIFVSTCBhbmQgbm90IGEgYWJzb2x1dGUgVVJMXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSB1cmxcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0U2hvcnRVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgc2hvcnRVcmwgPSB1cmwsIGJhc2VVcmwgPSBIaXN0b3J5LmdldEJhc2VVcmwoKSwgcm9vdFVybCA9IEhpc3RvcnkuZ2V0Um9vdFVybCgpO1xuXG4gICAgICAgICAgICAvLyBUcmltIGJhc2VVcmxcbiAgICAgICAgICAgIGlmIChIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZSkge1xuICAgICAgICAgICAgICAgIC8vIFdlIGFyZSBpbiBhIGlmIHN0YXRlbWVudCBhcyB3aGVuIHB1c2hTdGF0ZSBpcyBub3QgZW11bGF0ZWRcbiAgICAgICAgICAgICAgICAvLyBUaGUgYWN0dWFsIHVybCB0aGVzZSBzaG9ydCB1cmxzIGFyZSByZWxhdGl2ZSB0byBjYW4gY2hhbmdlXG4gICAgICAgICAgICAgICAgLy8gU28gd2l0aGluIHRoZSBzYW1lIHNlc3Npb24sIHdlIHRoZSB1cmwgbWF5IGVuZCB1cCBzb21ld2hlcmUgZGlmZmVyZW50XG4gICAgICAgICAgICAgICAgc2hvcnRVcmwgPSBzaG9ydFVybC5yZXBsYWNlKGJhc2VVcmwsICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVHJpbSByb290VXJsXG4gICAgICAgICAgICBzaG9ydFVybCA9IHNob3J0VXJsLnJlcGxhY2Uocm9vdFVybCwgJy8nKTtcblxuICAgICAgICAgICAgLy8gRW5zdXJlIHdlIGNhbiBzdGlsbCBkZXRlY3QgaXQgYXMgYSBzdGF0ZVxuICAgICAgICAgICAgaWYgKEhpc3RvcnkuaXNUcmFkaXRpb25hbEFuY2hvcihzaG9ydFVybCkpIHtcbiAgICAgICAgICAgICAgICBzaG9ydFVybCA9ICcuLycgKyBzaG9ydFVybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2xlYW4gSXRcbiAgICAgICAgICAgIHNob3J0VXJsID0gc2hvcnRVcmwucmVwbGFjZSgvXihcXC5cXC8pKy9nLCAnLi8nKS5yZXBsYWNlKC9cXCMkLywgJycpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBzaG9ydFVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoZG9jdW1lbnQpXG4gICAgICAgICAqIFJldHVybnMgYSBub3JtYWxpemVkIHZlcnNpb24gb2YgZG9jdW1lbnQubG9jYXRpb24uaHJlZlxuICAgICAgICAgKiBhY2NvdW50aW5nIGZvciBicm93c2VyIGluY29uc2lzdGVuY2llcywgZXRjLlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIFVSTCB3aWxsIGJlIFVSSS1lbmNvZGVkIGFuZCB3aWxsIGluY2x1ZGUgdGhlIGhhc2hcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGRvY3VtZW50XG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gdXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldExvY2F0aW9uSHJlZiA9IGZ1bmN0aW9uIChkb2MpIHtcbiAgICAgICAgICAgIGRvYyA9IGRvYyB8fCBkb2N1bWVudDtcblxuICAgICAgICAgICAgLy8gbW9zdCBvZiB0aGUgdGltZSwgdGhpcyB3aWxsIGJlIHRydWVcbiAgICAgICAgICAgIGlmIChkb2MuVVJMID09PSBkb2MubG9jYXRpb24uaHJlZilcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jLmxvY2F0aW9uLmhyZWY7XG5cbiAgICAgICAgICAgIC8vIHNvbWUgdmVyc2lvbnMgb2Ygd2Via2l0IFVSSS1kZWNvZGUgZG9jdW1lbnQubG9jYXRpb24uaHJlZlxuICAgICAgICAgICAgLy8gYnV0IHRoZXkgbGVhdmUgZG9jdW1lbnQuVVJMIGluIGFuIGVuY29kZWQgc3RhdGVcbiAgICAgICAgICAgIGlmIChkb2MubG9jYXRpb24uaHJlZiA9PT0gZGVjb2RlVVJJQ29tcG9uZW50KGRvYy5VUkwpKVxuICAgICAgICAgICAgICAgIHJldHVybiBkb2MuVVJMO1xuXG4gICAgICAgICAgICAvLyBGRiAzLjYgb25seSB1cGRhdGVzIGRvY3VtZW50LlVSTCB3aGVuIGEgcGFnZSBpcyByZWxvYWRlZFxuICAgICAgICAgICAgLy8gZG9jdW1lbnQubG9jYXRpb24uaHJlZiBpcyB1cGRhdGVkIGNvcnJlY3RseVxuICAgICAgICAgICAgaWYgKGRvYy5sb2NhdGlvbi5oYXNoICYmIGRlY29kZVVSSUNvbXBvbmVudChkb2MubG9jYXRpb24uaHJlZi5yZXBsYWNlKC9eW14jXSsvLCBcIlwiKSkgPT09IGRvYy5sb2NhdGlvbi5oYXNoKVxuICAgICAgICAgICAgICAgIHJldHVybiBkb2MubG9jYXRpb24uaHJlZjtcblxuICAgICAgICAgICAgaWYgKGRvYy5VUkwuaW5kZXhPZignIycpID09IC0xICYmIGRvYy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJyMnKSAhPSAtMSlcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jLmxvY2F0aW9uLmhyZWY7XG5cbiAgICAgICAgICAgIHJldHVybiBkb2MuVVJMIHx8IGRvYy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gU3RhdGUgU3RvcmFnZVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnN0b3JlXG4gICAgICAgICAqIFRoZSBzdG9yZSBmb3IgYWxsIHNlc3Npb24gc3BlY2lmaWMgZGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zdG9yZSA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmlkVG9TdGF0ZVxuICAgICAgICAgKiAxLTE6IFN0YXRlIElEIHRvIFN0YXRlIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5pZFRvU3RhdGUgPSBIaXN0b3J5LmlkVG9TdGF0ZSB8fCB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5zdGF0ZVRvSWRcbiAgICAgICAgICogMS0xOiBTdGF0ZSBTdHJpbmcgdG8gU3RhdGUgSURcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc3RhdGVUb0lkID0gSGlzdG9yeS5zdGF0ZVRvSWQgfHwge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkudXJsVG9JZFxuICAgICAgICAgKiAxLTE6IFN0YXRlIFVSTCB0byBTdGF0ZSBJRFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS51cmxUb0lkID0gSGlzdG9yeS51cmxUb0lkIHx8IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnN0b3JlZFN0YXRlc1xuICAgICAgICAgKiBTdG9yZSB0aGUgc3RhdGVzIGluIGFuIGFycmF5XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnN0b3JlZFN0YXRlcyA9IEhpc3Rvcnkuc3RvcmVkU3RhdGVzIHx8IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnNhdmVkU3RhdGVzXG4gICAgICAgICAqIFNhdmVkIHRoZSBzdGF0ZXMgaW4gYW4gYXJyYXlcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc2F2ZWRTdGF0ZXMgPSBIaXN0b3J5LnNhdmVkU3RhdGVzIHx8IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm5vcmFtbGl6ZVN0b3JlKClcbiAgICAgICAgICogTm9yYW1saXplIHRoZSBzdG9yZSBieSBhZGRpbmcgbmVjZXNzYXJ5IHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5ub3JtYWxpemVTdG9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUuaWRUb1N0YXRlID0gSGlzdG9yeS5zdG9yZS5pZFRvU3RhdGUgfHwge307XG4gICAgICAgICAgICBIaXN0b3J5LnN0b3JlLnVybFRvSWQgPSBIaXN0b3J5LnN0b3JlLnVybFRvSWQgfHwge307XG4gICAgICAgICAgICBIaXN0b3J5LnN0b3JlLnN0YXRlVG9JZCA9IEhpc3Rvcnkuc3RvcmUuc3RhdGVUb0lkIHx8IHt9O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldFN0YXRlKClcbiAgICAgICAgICogR2V0IGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhLCB0aXRsZSBhbmQgdXJsIG9mIHRoZSBjdXJyZW50IHN0YXRlXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZnJpZW5kbHlcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBjcmVhdGVcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBTdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRTdGF0ZSA9IGZ1bmN0aW9uIChmcmllbmRseSwgY3JlYXRlKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZyaWVuZGx5ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGZyaWVuZGx5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY3JlYXRlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGNyZWF0ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICB2YXIgU3RhdGUgPSBIaXN0b3J5LmdldExhc3RTYXZlZFN0YXRlKCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZVxuICAgICAgICAgICAgaWYgKCFTdGF0ZSAmJiBjcmVhdGUpIHtcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRqdXN0XG4gICAgICAgICAgICBpZiAoZnJpZW5kbHkpIHtcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuY2xvbmVPYmplY3QoU3RhdGUpO1xuICAgICAgICAgICAgICAgIFN0YXRlLnVybCA9IFN0YXRlLmNsZWFuVXJsIHx8IFN0YXRlLnVybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gU3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0SWRCeVN0YXRlKFN0YXRlKVxuICAgICAgICAgKiBHZXRzIGEgSUQgZm9yIGEgU3RhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBpZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRJZEJ5U3RhdGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcblxuICAgICAgICAgICAgLy8gRmV0Y2ggSURcbiAgICAgICAgICAgIHZhciBpZCA9IEhpc3RvcnkuZXh0cmFjdElkKG5ld1N0YXRlLnVybCksXG4gICAgICAgICAgICAgICAgc3RyO1xuXG4gICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgLy8gRmluZCBJRCB2aWEgU3RhdGUgU3RyaW5nXG4gICAgICAgICAgICAgICAgc3RyID0gSGlzdG9yeS5nZXRTdGF0ZVN0cmluZyhuZXdTdGF0ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBIaXN0b3J5LnN0YXRlVG9JZFtzdHJdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IEhpc3Rvcnkuc3RhdGVUb0lkW3N0cl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBIaXN0b3J5LnN0b3JlLnN0YXRlVG9JZFtzdHJdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IEhpc3Rvcnkuc3RvcmUuc3RhdGVUb0lkW3N0cl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBJRFxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgU3RyaW5nKE1hdGgucmFuZG9tKCkpLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIEhpc3RvcnkuaWRUb1N0YXRlW2lkXSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIEhpc3Rvcnkuc3RvcmUuaWRUb1N0YXRlW2lkXSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IHRoZSBuZXcgU3RhdGUgdG8gdGhlIElEXG4gICAgICAgICAgICAgICAgICAgIEhpc3Rvcnkuc3RhdGVUb0lkW3N0cl0gPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5pZFRvU3RhdGVbaWRdID0gbmV3U3RhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm4gSURcbiAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5ub3JtYWxpemVTdGF0ZShTdGF0ZSlcbiAgICAgICAgICogRXhwYW5kcyBhIFN0YXRlIE9iamVjdFxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gU3RhdGVcbiAgICAgICAgICogQHJldHVybiB7b2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5ub3JtYWxpemVTdGF0ZSA9IGZ1bmN0aW9uIChvbGRTdGF0ZSkge1xuICAgICAgICAgICAgLy8gVmFyaWFibGVzXG4gICAgICAgICAgICB2YXIgbmV3U3RhdGUsIGRhdGFOb3RFbXB0eTtcblxuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgaWYgKCFvbGRTdGF0ZSB8fCAodHlwZW9mIG9sZFN0YXRlICE9PSAnb2JqZWN0JykpIHtcbiAgICAgICAgICAgICAgICBvbGRTdGF0ZSA9IHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvbGRTdGF0ZS5ub3JtYWxpemVkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBvbGRTdGF0ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRqdXN0XG4gICAgICAgICAgICBpZiAoIW9sZFN0YXRlLmRhdGEgfHwgKHR5cGVvZiBvbGRTdGF0ZS5kYXRhICE9PSAnb2JqZWN0JykpIHtcbiAgICAgICAgICAgICAgICBvbGRTdGF0ZS5kYXRhID0ge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICBuZXdTdGF0ZSA9IHt9O1xuICAgICAgICAgICAgbmV3U3RhdGUubm9ybWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICBuZXdTdGF0ZS50aXRsZSA9IG9sZFN0YXRlLnRpdGxlIHx8ICcnO1xuICAgICAgICAgICAgbmV3U3RhdGUudXJsID0gSGlzdG9yeS5nZXRGdWxsVXJsKG9sZFN0YXRlLnVybCA/IG9sZFN0YXRlLnVybCA6IChIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpKSk7XG4gICAgICAgICAgICBuZXdTdGF0ZS5oYXNoID0gSGlzdG9yeS5nZXRTaG9ydFVybChuZXdTdGF0ZS51cmwpO1xuICAgICAgICAgICAgbmV3U3RhdGUuZGF0YSA9IEhpc3RvcnkuY2xvbmVPYmplY3Qob2xkU3RhdGUuZGF0YSk7XG5cbiAgICAgICAgICAgIC8vIEZldGNoIElEXG4gICAgICAgICAgICBuZXdTdGF0ZS5pZCA9IEhpc3RvcnkuZ2V0SWRCeVN0YXRlKG5ld1N0YXRlKTtcblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAvLyBDbGVhbiB0aGUgVVJMXG4gICAgICAgICAgICBuZXdTdGF0ZS5jbGVhblVybCA9IG5ld1N0YXRlLnVybC5yZXBsYWNlKC9cXD8/XFwmX3N1aWQuKi8sICcnKTtcbiAgICAgICAgICAgIG5ld1N0YXRlLnVybCA9IG5ld1N0YXRlLmNsZWFuVXJsO1xuXG4gICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBtb3JlIHRoYW4ganVzdCBhIHVybFxuICAgICAgICAgICAgZGF0YU5vdEVtcHR5ID0gIUhpc3RvcnkuaXNFbXB0eU9iamVjdChuZXdTdGF0ZS5kYXRhKTtcblxuICAgICAgICAgICAgLy8gQXBwbHlcbiAgICAgICAgICAgIGlmICgobmV3U3RhdGUudGl0bGUgfHwgZGF0YU5vdEVtcHR5KSAmJiBIaXN0b3J5Lm9wdGlvbnMuZGlzYWJsZVN1aWQgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgSUQgdG8gSGFzaFxuICAgICAgICAgICAgICAgIG5ld1N0YXRlLmhhc2ggPSBIaXN0b3J5LmdldFNob3J0VXJsKG5ld1N0YXRlLnVybCkucmVwbGFjZSgvXFw/P1xcJl9zdWlkLiovLCAnJyk7XG4gICAgICAgICAgICAgICAgaWYgKCEvXFw/Ly50ZXN0KG5ld1N0YXRlLmhhc2gpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1N0YXRlLmhhc2ggKz0gJz8nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5oYXNoICs9ICcmX3N1aWQ9JyArIG5ld1N0YXRlLmlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIEhhc2hlZCBVUkxcbiAgICAgICAgICAgIG5ld1N0YXRlLmhhc2hlZFVybCA9IEhpc3RvcnkuZ2V0RnVsbFVybChuZXdTdGF0ZS5oYXNoKTtcblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIFVSTCBpZiB3ZSBoYXZlIGEgZHVwbGljYXRlXG4gICAgICAgICAgICBpZiAoKEhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlIHx8IEhpc3RvcnkuYnVncy5zYWZhcmlQb2xsKSAmJiBIaXN0b3J5Lmhhc1VybER1cGxpY2F0ZShuZXdTdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS51cmwgPSBuZXdTdGF0ZS5oYXNoZWRVcmw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QoZGF0YSx0aXRsZSx1cmwpXG4gICAgICAgICAqIENyZWF0ZXMgYSBvYmplY3QgYmFzZWQgb24gdGhlIGRhdGEsIHRpdGxlIGFuZCB1cmwgc3RhdGUgcGFyYW1zXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZVxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAgICAgICAqIEByZXR1cm4ge29iamVjdH1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QgPSBmdW5jdGlvbiAoZGF0YSwgdGl0bGUsIHVybCkge1xuICAgICAgICAgICAgLy8gSGFzaGlmeVxuICAgICAgICAgICAgdmFyIFN0YXRlID0ge1xuICAgICAgICAgICAgICAgICdkYXRhJzogZGF0YSxcbiAgICAgICAgICAgICAgICAndGl0bGUnOiB0aXRsZSxcbiAgICAgICAgICAgICAgICAndXJsJzogdXJsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBFeHBhbmQgdGhlIFN0YXRlXG4gICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkubm9ybWFsaXplU3RhdGUoU3RhdGUpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gb2JqZWN0XG4gICAgICAgICAgICByZXR1cm4gU3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0U3RhdGVCeUlkKGlkKVxuICAgICAgICAgKiBHZXQgYSBzdGF0ZSBieSBpdCdzIFVJRFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0U3RhdGVCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICBpZCA9IFN0cmluZyhpZCk7XG5cbiAgICAgICAgICAgIC8vIFJldHJpZXZlXG4gICAgICAgICAgICB2YXIgU3RhdGUgPSBIaXN0b3J5LmlkVG9TdGF0ZVtpZF0gfHwgSGlzdG9yeS5zdG9yZS5pZFRvU3RhdGVbaWRdIHx8IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIFN0YXRlXG4gICAgICAgICAgICByZXR1cm4gU3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBhIFN0YXRlJ3MgU3RyaW5nXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IHBhc3NlZFN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFN0YXRlU3RyaW5nID0gZnVuY3Rpb24gKHBhc3NlZFN0YXRlKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgU3RhdGUsIGNsZWFuZWRTdGF0ZSwgc3RyO1xuXG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgU3RhdGUgPSBIaXN0b3J5Lm5vcm1hbGl6ZVN0YXRlKHBhc3NlZFN0YXRlKTtcblxuICAgICAgICAgICAgLy8gQ2xlYW5cbiAgICAgICAgICAgIGNsZWFuZWRTdGF0ZSA9IHtcbiAgICAgICAgICAgICAgICBkYXRhOiBTdGF0ZS5kYXRhLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBwYXNzZWRTdGF0ZS50aXRsZSxcbiAgICAgICAgICAgICAgICB1cmw6IHBhc3NlZFN0YXRlLnVybFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIHN0ciA9IEpTT04uc3RyaW5naWZ5KGNsZWFuZWRTdGF0ZSk7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGEgU3RhdGUncyBJRFxuICAgICAgICAgKiBAcGFyYW0ge1N0YXRlfSBwYXNzZWRTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGlkXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFN0YXRlSWQgPSBmdW5jdGlvbiAocGFzc2VkU3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBTdGF0ZSwgaWQ7XG5cbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkubm9ybWFsaXplU3RhdGUocGFzc2VkU3RhdGUpO1xuXG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgaWQgPSBTdGF0ZS5pZDtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0SGFzaEJ5U3RhdGUoU3RhdGUpXG4gICAgICAgICAqIENyZWF0ZXMgYSBIYXNoIGZvciB0aGUgU3RhdGUgT2JqZWN0XG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IHBhc3NlZFN0YXRlXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gaGFzaFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRIYXNoQnlTdGF0ZSA9IGZ1bmN0aW9uIChwYXNzZWRTdGF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIFN0YXRlLCBoYXNoO1xuXG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgU3RhdGUgPSBIaXN0b3J5Lm5vcm1hbGl6ZVN0YXRlKHBhc3NlZFN0YXRlKTtcblxuICAgICAgICAgICAgLy8gSGFzaFxuICAgICAgICAgICAgaGFzaCA9IFN0YXRlLmhhc2g7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIGhhc2g7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZXh0cmFjdElkKHVybF9vcl9oYXNoKVxuICAgICAgICAgKiBHZXQgYSBTdGF0ZSBJRCBieSBpdCdzIFVSTCBvciBIYXNoXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxfb3JfaGFzaFxuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IGlkXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmV4dHJhY3RJZCA9IGZ1bmN0aW9uICh1cmxfb3JfaGFzaCkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGlkLCBwYXJ0cywgdXJsLCB0bXA7XG5cbiAgICAgICAgICAgIC8vIEV4dHJhY3RcblxuICAgICAgICAgICAgLy8gSWYgdGhlIFVSTCBoYXMgYSAjLCB1c2UgdGhlIGlkIGZyb20gYmVmb3JlIHRoZSAjXG4gICAgICAgICAgICBpZiAodXJsX29yX2hhc2guaW5kZXhPZignIycpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgdG1wID0gdXJsX29yX2hhc2guc3BsaXQoXCIjXCIpWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdG1wID0gdXJsX29yX2hhc2g7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcnRzID0gLyguKilcXCZfc3VpZD0oWzAtOV0rKSQvLmV4ZWModG1wKTtcbiAgICAgICAgICAgIHVybCA9IHBhcnRzID8gKHBhcnRzWzFdIHx8IHVybF9vcl9oYXNoKSA6IHVybF9vcl9oYXNoO1xuICAgICAgICAgICAgaWQgPSBwYXJ0cyA/IFN0cmluZyhwYXJ0c1syXSB8fCAnJykgOiAnJztcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaWQgfHwgZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuaXNUcmFkaXRpb25hbEFuY2hvclxuICAgICAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHRoZSB1cmwgaXMgYSB0cmFkaXRpb25hbCBhbmNob3Igb3Igbm90XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmxfb3JfaGFzaFxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5pc1RyYWRpdGlvbmFsQW5jaG9yID0gZnVuY3Rpb24gKHVybF9vcl9oYXNoKSB7XG4gICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgdmFyIGlzVHJhZGl0aW9uYWwgPSAhKC9bXFwvXFw/XFwuXS8udGVzdCh1cmxfb3JfaGFzaCkpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBpc1RyYWRpdGlvbmFsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmV4dHJhY3RTdGF0ZVxuICAgICAgICAgKiBHZXQgYSBTdGF0ZSBieSBpdCdzIFVSTCBvciBIYXNoXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmxfb3JfaGFzaFxuICAgICAgICAgKiBAcmV0dXJuIHtTdGF0ZXxudWxsfVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5leHRyYWN0U3RhdGUgPSBmdW5jdGlvbiAodXJsX29yX2hhc2gsIGNyZWF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIFN0YXRlID0gbnVsbCwgaWQsIHVybDtcbiAgICAgICAgICAgIGNyZWF0ZSA9IGNyZWF0ZSB8fCBmYWxzZTtcblxuICAgICAgICAgICAgLy8gRmV0Y2ggU1VJRFxuICAgICAgICAgICAgaWQgPSBIaXN0b3J5LmV4dHJhY3RJZCh1cmxfb3JfaGFzaCk7XG4gICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGVCeUlkKGlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmV0Y2ggU1VJRCByZXR1cm5lZCBubyBTdGF0ZVxuICAgICAgICAgICAgaWYgKCFTdGF0ZSkge1xuICAgICAgICAgICAgICAgIC8vIEZldGNoIFVSTFxuICAgICAgICAgICAgICAgIHVybCA9IEhpc3RvcnkuZ2V0RnVsbFVybCh1cmxfb3JfaGFzaCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVjayBVUkxcbiAgICAgICAgICAgICAgICBpZCA9IEhpc3RvcnkuZ2V0SWRCeVVybCh1cmwpIHx8IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGVCeUlkKGlkKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgU3RhdGVcbiAgICAgICAgICAgICAgICBpZiAoIVN0YXRlICYmIGNyZWF0ZSAmJiAhSGlzdG9yeS5pc1RyYWRpdGlvbmFsQW5jaG9yKHVybF9vcl9oYXNoKSkge1xuICAgICAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QobnVsbCwgbnVsbCwgdXJsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIFN0YXRlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldElkQnlVcmwoKVxuICAgICAgICAgKiBHZXQgYSBTdGF0ZSBJRCBieSBhIFN0YXRlIFVSTFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRJZEJ5VXJsID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIHZhciBpZCA9IEhpc3RvcnkudXJsVG9JZFt1cmxdIHx8IEhpc3Rvcnkuc3RvcmUudXJsVG9JZFt1cmxdIHx8IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0TGFzdFNhdmVkU3RhdGUoKVxuICAgICAgICAgKiBHZXQgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEsIHRpdGxlIGFuZCB1cmwgb2YgdGhlIGN1cnJlbnQgc3RhdGVcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBTdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRMYXN0U2F2ZWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5LnNhdmVkU3RhdGVzW0hpc3Rvcnkuc2F2ZWRTdGF0ZXMubGVuZ3RoIC0gMV0gfHwgdW5kZWZpbmVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldExhc3RTdG9yZWRTdGF0ZSgpXG4gICAgICAgICAqIEdldCBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSwgdGl0bGUgYW5kIHVybCBvZiB0aGUgY3VycmVudCBzdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldExhc3RTdG9yZWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5LnN0b3JlZFN0YXRlc1tIaXN0b3J5LnN0b3JlZFN0YXRlcy5sZW5ndGggLSAxXSB8fCB1bmRlZmluZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuaGFzVXJsRHVwbGljYXRlXG4gICAgICAgICAqIENoZWNrcyBpZiBhIFVybCB3aWxsIGhhdmUgYSB1cmwgY29uZmxpY3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG5ld1N0YXRlXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IGhhc0R1cGxpY2F0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5oYXNVcmxEdXBsaWNhdGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBoYXNEdXBsaWNhdGUgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICBvbGRTdGF0ZTtcblxuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIG9sZFN0YXRlID0gSGlzdG9yeS5leHRyYWN0U3RhdGUobmV3U3RhdGUudXJsKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2tcbiAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IG9sZFN0YXRlICYmIG9sZFN0YXRlLmlkICE9PSBuZXdTdGF0ZS5pZDtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaGFzRHVwbGljYXRlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnN0b3JlU3RhdGVcbiAgICAgICAgICogU3RvcmUgYSBTdGF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBuZXdTdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zdG9yZVN0YXRlID0gZnVuY3Rpb24gKG5ld1N0YXRlKSB7XG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgU3RhdGVcbiAgICAgICAgICAgIEhpc3RvcnkudXJsVG9JZFtuZXdTdGF0ZS51cmxdID0gbmV3U3RhdGUuaWQ7XG5cbiAgICAgICAgICAgIC8vIFB1c2ggdGhlIFN0YXRlXG4gICAgICAgICAgICBIaXN0b3J5LnN0b3JlZFN0YXRlcy5wdXNoKEhpc3RvcnkuY2xvbmVPYmplY3QobmV3U3RhdGUpKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuaXNMYXN0U2F2ZWRTdGF0ZShuZXdTdGF0ZSlcbiAgICAgICAgICogVGVzdHMgdG8gc2VlIGlmIHRoZSBzdGF0ZSBpcyB0aGUgbGFzdCBzdGF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gaXNMYXN0XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmlzTGFzdFNhdmVkU3RhdGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBpc0xhc3QgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICBuZXdJZCwgb2xkU3RhdGUsIG9sZElkO1xuXG4gICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgaWYgKEhpc3Rvcnkuc2F2ZWRTdGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbmV3SWQgPSBuZXdTdGF0ZS5pZDtcbiAgICAgICAgICAgICAgICBvbGRTdGF0ZSA9IEhpc3RvcnkuZ2V0TGFzdFNhdmVkU3RhdGUoKTtcbiAgICAgICAgICAgICAgICBvbGRJZCA9IG9sZFN0YXRlLmlkO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2tcbiAgICAgICAgICAgICAgICBpc0xhc3QgPSAobmV3SWQgPT09IG9sZElkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaXNMYXN0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnNhdmVTdGF0ZVxuICAgICAgICAgKiBQdXNoIGEgU3RhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG5ld1N0YXRlXG4gICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IGNoYW5nZWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc2F2ZVN0YXRlID0gZnVuY3Rpb24gKG5ld1N0YXRlKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBIYXNoXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUHVzaCB0aGUgU3RhdGVcbiAgICAgICAgICAgIEhpc3Rvcnkuc2F2ZWRTdGF0ZXMucHVzaChIaXN0b3J5LmNsb25lT2JqZWN0KG5ld1N0YXRlKSk7XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB0cnVlXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRTdGF0ZUJ5SW5kZXgoKVxuICAgICAgICAgKiBHZXRzIGEgc3RhdGUgYnkgdGhlIGluZGV4XG4gICAgICAgICAqIEBwYXJhbSB7aW50ZWdlcn0gaW5kZXhcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRTdGF0ZUJ5SW5kZXggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBTdGF0ZSA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGxhc3QgaW5zZXJ0ZWRcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkuc2F2ZWRTdGF0ZXNbSGlzdG9yeS5zYXZlZFN0YXRlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICAgICAgICAgIC8vIEdldCBmcm9tIHRoZSBlbmRcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkuc2F2ZWRTdGF0ZXNbSGlzdG9yeS5zYXZlZFN0YXRlcy5sZW5ndGggKyBpbmRleF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgZnJvbSB0aGUgYmVnaW5uaW5nXG4gICAgICAgICAgICAgICAgU3RhdGUgPSBIaXN0b3J5LnNhdmVkU3RhdGVzW2luZGV4XTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmV0dXJuIFN0YXRlXG4gICAgICAgICAgICByZXR1cm4gU3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0Q3VycmVudEluZGV4KClcbiAgICAgICAgICogR2V0cyB0aGUgY3VycmVudCBpbmRleFxuICAgICAgICAgKiBAcmV0dXJuIChpbnRlZ2VyKVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRDdXJyZW50SW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBudWxsO1xuXG4gICAgICAgICAgICAvLyBObyBzdGF0ZXMgc2F2ZWRcbiAgICAgICAgICAgIGlmIChIaXN0b3J5LnNhdmVkU3RhdGVzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IEhpc3Rvcnkuc2F2ZWRTdGF0ZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBIYXNoIEhlbHBlcnNcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRIYXNoKClcbiAgICAgICAgICogQHBhcmFtIHtMb2NhdGlvbj19IGxvY2F0aW9uXG4gICAgICAgICAqIEdldHMgdGhlIGN1cnJlbnQgZG9jdW1lbnQgaGFzaFxuICAgICAgICAgKiBOb3RlOiB1bmxpa2UgbG9jYXRpb24uaGFzaCwgdGhpcyBpcyBndWFyYW50ZWVkIHRvIHJldHVybiB0aGUgZXNjYXBlZCBoYXNoIGluIGFsbCBicm93c2Vyc1xuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEhhc2ggPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoZG9jKSxcbiAgICAgICAgICAgICAgICBoYXNoO1xuICAgICAgICAgICAgaGFzaCA9IEhpc3RvcnkuZ2V0SGFzaEJ5VXJsKHVybCk7XG4gICAgICAgICAgICByZXR1cm4gaGFzaDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS51bmVzY2FwZUhhc2goKVxuICAgICAgICAgKiBub3JtYWxpemUgYW5kIFVuZXNjYXBlIGEgSGFzaFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaGFzaFxuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnVuZXNjYXBlSGFzaCA9IGZ1bmN0aW9uIChoYXNoKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gSGlzdG9yeS5ub3JtYWxpemVIYXNoKGhhc2gpO1xuXG4gICAgICAgICAgICAvLyBVbmVzY2FwZSBoYXNoXG4gICAgICAgICAgICByZXN1bHQgPSBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0KTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIHJlc3VsdFxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5ub3JtYWxpemVIYXNoKClcbiAgICAgICAgICogbm9ybWFsaXplIGEgaGFzaCBhY3Jvc3MgYnJvd3NlcnNcbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5ub3JtYWxpemVIYXNoID0gZnVuY3Rpb24gKGhhc2gpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBoYXNoLnJlcGxhY2UoL1teI10qIy8sICcnKS5yZXBsYWNlKC8jLiovLCAnJyk7XG5cbiAgICAgICAgICAgIC8vIFJldHVybiByZXN1bHRcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc2V0SGFzaChoYXNoKVxuICAgICAgICAgKiBTZXRzIHRoZSBkb2N1bWVudCBoYXNoXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoXG4gICAgICAgICAqIEByZXR1cm4ge0hpc3Rvcnl9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnNldEhhc2ggPSBmdW5jdGlvbiAoaGFzaCwgcXVldWUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBTdGF0ZSwgcGFnZVVybDtcblxuICAgICAgICAgICAgLy8gSGFuZGxlIFF1ZXVlaW5nXG4gICAgICAgICAgICBpZiAocXVldWUgIT09IGZhbHNlICYmIEhpc3RvcnkuYnVzeSgpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2FpdCArIFB1c2ggdG8gUXVldWVcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkuc2V0SGFzaDogd2UgbXVzdCB3YWl0JywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSh7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiBIaXN0b3J5LFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogSGlzdG9yeS5zZXRIYXNoLFxuICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBxdWV1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9nXG4gICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkuc2V0SGFzaDogY2FsbGVkJyxoYXNoKTtcblxuICAgICAgICAgICAgLy8gTWFrZSBCdXN5ICsgQ29udGludWVcbiAgICAgICAgICAgIEhpc3RvcnkuYnVzeSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaGFzaCBpcyBhIHN0YXRlXG4gICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuZXh0cmFjdFN0YXRlKGhhc2gsIHRydWUpO1xuICAgICAgICAgICAgaWYgKFN0YXRlICYmICFIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZSkge1xuICAgICAgICAgICAgICAgIC8vIEhhc2ggaXMgYSBzdGF0ZSBzbyBza2lwIHRoZSBzZXRIYXNoXG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnNldEhhc2g6IEhhc2ggaXMgYSBzdGF0ZSBzbyBza2lwcGluZyB0aGUgaGFzaCBzZXQgd2l0aCBhIGRpcmVjdCBwdXNoU3RhdGUgY2FsbCcsYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgICAgIC8vIFB1c2hTdGF0ZVxuICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKFN0YXRlLmRhdGEsIFN0YXRlLnRpdGxlLCBTdGF0ZS51cmwsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEhpc3RvcnkuZ2V0SGFzaCgpICE9PSBoYXNoKSB7XG4gICAgICAgICAgICAgICAgLy8gSGFzaCBpcyBhIHByb3BlciBoYXNoLCBzbyBhcHBseSBpdFxuXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGJyb3dzZXIgYnVnc1xuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmJ1Z3Muc2V0SGFzaCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaXggU2FmYXJpIEJ1ZyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NTYyNDlcblxuICAgICAgICAgICAgICAgICAgICAvLyBGZXRjaCB0aGUgYmFzZSBwYWdlXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VVcmwgPSBIaXN0b3J5LmdldFBhZ2VVcmwoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTYWZhcmkgaGFzaCBhcHBseVxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBwYWdlVXJsICsgJyMnICsgaGFzaCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm9ybWFsIGhhc2ggYXBwbHlcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaGFzaCA9IGhhc2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGFpblxuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZXNjYXBlKClcbiAgICAgICAgICogbm9ybWFsaXplIGFuZCBFc2NhcGUgYSBIYXNoXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZXNjYXBlSGFzaCA9IGZ1bmN0aW9uIChoYXNoKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gSGlzdG9yeS5ub3JtYWxpemVIYXNoKGhhc2gpO1xuXG4gICAgICAgICAgICAvLyBFc2NhcGUgaGFzaFxuICAgICAgICAgICAgcmVzdWx0ID0gd2luZG93LmVuY29kZVVSSUNvbXBvbmVudChyZXN1bHQpO1xuXG4gICAgICAgICAgICAvLyBJRTYgRXNjYXBlIEJ1Z1xuICAgICAgICAgICAgaWYgKCFIaXN0b3J5LmJ1Z3MuaGFzaEVzY2FwZSkge1xuICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgY29tbW9uIHBhcnRzXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0XG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCUyMS9nLCAnIScpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCUyNi9nLCAnJicpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCUzRC9nLCAnPScpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCUzRi9nLCAnPycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm4gcmVzdWx0XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEhhc2hCeVVybCh1cmwpXG4gICAgICAgICAqIEV4dHJhY3RzIHRoZSBIYXNoIGZyb20gYSBVUkxcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHVybFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRIYXNoQnlVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICAvLyBFeHRyYWN0IHRoZSBoYXNoXG4gICAgICAgICAgICB2YXIgaGFzaCA9IFN0cmluZyh1cmwpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oW14jXSopIz8oW14jXSopIz8oLiopLywgJyQyJylcbiAgICAgICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIC8vIFVuZXNjYXBlIGhhc2hcbiAgICAgICAgICAgIGhhc2ggPSBIaXN0b3J5LnVuZXNjYXBlSGFzaChoYXNoKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIGhhc2hcbiAgICAgICAgICAgIHJldHVybiBoYXNoO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnNldFRpdGxlKHRpdGxlKVxuICAgICAgICAgKiBBcHBsaWVzIHRoZSB0aXRsZSB0byB0aGUgZG9jdW1lbnRcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc2V0VGl0bGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IG5ld1N0YXRlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGZpcnN0U3RhdGU7XG5cbiAgICAgICAgICAgIC8vIEluaXRpYWxcbiAgICAgICAgICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgICAgICAgICBmaXJzdFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZUJ5SW5kZXgoMCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0U3RhdGUgJiYgZmlyc3RTdGF0ZS51cmwgPT09IG5ld1N0YXRlLnVybCkge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGZpcnN0U3RhdGUudGl0bGUgfHwgSGlzdG9yeS5vcHRpb25zLmluaXRpYWxUaXRsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEFwcGx5XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aXRsZScpWzBdLmlubmVySFRNTCA9IHRpdGxlLnJlcGxhY2UoJzwnLCAnJmx0OycpLnJlcGxhY2UoJz4nLCAnJmd0OycpLnJlcGxhY2UoJyAmICcsICcgJmFtcDsgJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uKSB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRpdGxlO1xuXG4gICAgICAgICAgICAvLyBDaGFpblxuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBRdWV1ZWluZ1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnF1ZXVlc1xuICAgICAgICAgKiBUaGUgbGlzdCBvZiBxdWV1ZXMgdG8gdXNlXG4gICAgICAgICAqIEZpcnN0IEluLCBGaXJzdCBPdXRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkucXVldWVzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuYnVzeSh2YWx1ZSlcbiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSB2YWx1ZSBbb3B0aW9uYWxdXG4gICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IGJ1c3lcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuYnVzeSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgLy8gQXBwbHlcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LmJ1c3k6IGNoYW5naW5nIFsnKyhIaXN0b3J5LmJ1c3kuZmxhZ3x8ZmFsc2UpKyddIHRvIFsnKyh2YWx1ZXx8ZmFsc2UpKyddJywgSGlzdG9yeS5xdWV1ZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3kuZmxhZyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRGVmYXVsdFxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIEhpc3RvcnkuYnVzeS5mbGFnID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeS5mbGFnID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFF1ZXVlXG4gICAgICAgICAgICBpZiAoIUhpc3RvcnkuYnVzeS5mbGFnKSB7XG4gICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgbmV4dCBpdGVtIGluIHRoZSBxdWV1ZVxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChIaXN0b3J5LmJ1c3kudGltZW91dCk7XG4gICAgICAgICAgICAgICAgdmFyIGZpcmVOZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSwgcXVldWUsIGl0ZW07XG4gICAgICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmJ1c3kuZmxhZykgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBIaXN0b3J5LnF1ZXVlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUgPSBIaXN0b3J5LnF1ZXVlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmZpcmVRdWV1ZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3kudGltZW91dCA9IHNldFRpbWVvdXQoZmlyZU5leHQsIEhpc3Rvcnkub3B0aW9ucy5idXN5RGVsYXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3kudGltZW91dCA9IHNldFRpbWVvdXQoZmlyZU5leHQsIEhpc3Rvcnkub3B0aW9ucy5idXN5RGVsYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5LmJ1c3kuZmxhZztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5idXN5LmZsYWdcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuYnVzeS5mbGFnID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZmlyZVF1ZXVlSXRlbShpdGVtKVxuICAgICAgICAgKiBGaXJlIGEgUXVldWUgSXRlbVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbVxuICAgICAgICAgKiBAcmV0dXJuIHtNaXhlZH0gcmVzdWx0XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmZpcmVRdWV1ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uY2FsbGJhY2suYXBwbHkoaXRlbS5zY29wZSB8fCBIaXN0b3J5LCBpdGVtLmFyZ3MgfHwgW10pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnB1c2hRdWV1ZShjYWxsYmFjayxhcmdzKVxuICAgICAgICAgKiBBZGQgYW4gaXRlbSB0byB0aGUgcXVldWVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gW3Njb3BlLGNhbGxiYWNrLGFyZ3MscXVldWVdXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlIHRoZSBxdWV1ZVxuICAgICAgICAgICAgSGlzdG9yeS5xdWV1ZXNbaXRlbS5xdWV1ZSB8fCAwXSA9IEhpc3RvcnkucXVldWVzW2l0ZW0ucXVldWUgfHwgMF0gfHwgW107XG5cbiAgICAgICAgICAgIC8vIEFkZCB0byB0aGUgcXVldWVcbiAgICAgICAgICAgIEhpc3RvcnkucXVldWVzW2l0ZW0ucXVldWUgfHwgMF0ucHVzaChpdGVtKTtcblxuICAgICAgICAgICAgLy8gQ2hhaW5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnF1ZXVlIChpdGVtLHF1ZXVlKSwgKGZ1bmMscXVldWUpLCAoZnVuYyksIChpdGVtKVxuICAgICAgICAgKiBFaXRoZXIgZmlycyB0aGUgaXRlbSBub3cgaWYgbm90IGJ1c3ksIG9yIGFkZHMgaXQgdG8gdGhlIHF1ZXVlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnF1ZXVlID0gZnVuY3Rpb24gKGl0ZW0sIHF1ZXVlKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBpdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogaXRlbVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXVlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGl0ZW0ucXVldWUgPSBxdWV1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGFuZGxlXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZShpdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5maXJlUXVldWVJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGFpblxuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuY2xlYXJRdWV1ZSgpXG4gICAgICAgICAqIENsZWFycyB0aGUgUXVldWVcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuY2xlYXJRdWV1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEhpc3RvcnkuYnVzeS5mbGFnID0gZmFsc2U7XG4gICAgICAgICAgICBIaXN0b3J5LnF1ZXVlcyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBJRSBCdWcgRml4XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc3RhdGVDaGFuZ2VkXG4gICAgICAgICAqIFN0YXRlcyB3aGV0aGVyIG9yIG5vdCB0aGUgc3RhdGUgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgZG91YmxlIGNoZWNrIHdhcyBpbml0aWFsaXNlZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zdGF0ZUNoYW5nZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5kb3VibGVDaGVja2VyXG4gICAgICAgICAqIENvbnRhaW5zIHRoZSB0aW1lb3V0IHVzZWQgZm9yIHRoZSBkb3VibGUgY2hlY2tzXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrZXIgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5kb3VibGVDaGVja0NvbXBsZXRlKClcbiAgICAgICAgICogQ29tcGxldGUgYSBkb3VibGUgY2hlY2tcbiAgICAgICAgICogQHJldHVybiB7SGlzdG9yeX1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tDb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZVxuICAgICAgICAgICAgSGlzdG9yeS5zdGF0ZUNoYW5nZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBDbGVhclxuICAgICAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVja0NsZWFyKCk7XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5kb3VibGVDaGVja0NsZWFyKClcbiAgICAgICAgICogQ2xlYXIgYSBkb3VibGUgY2hlY2tcbiAgICAgICAgICogQHJldHVybiB7SGlzdG9yeX1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tDbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIENsZWFyXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5kb3VibGVDaGVja2VyKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KEhpc3RvcnkuZG91YmxlQ2hlY2tlcik7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVja2VyID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5kb3VibGVDaGVjaygpXG4gICAgICAgICAqIENyZWF0ZSBhIGRvdWJsZSBjaGVja1xuICAgICAgICAgKiBAcmV0dXJuIHtIaXN0b3J5fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVjayA9IGZ1bmN0aW9uICh0cnlBZ2Fpbikge1xuICAgICAgICAgICAgLy8gUmVzZXRcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RhdGVDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrQ2xlYXIoKTtcblxuICAgICAgICAgICAgLy8gRml4IElFNixJRTcgYnVnIHdoZXJlIGNhbGxpbmcgaGlzdG9yeS5iYWNrIG9yIGhpc3RvcnkuZm9yd2FyZCBkb2VzIG5vdCBhY3R1YWxseSBjaGFuZ2UgdGhlIGhhc2ggKHdoZXJlYXMgZG9pbmcgaXQgbWFudWFsbHkgZG9lcylcbiAgICAgICAgICAgIC8vIEZpeCBTYWZhcmkgNSBidWcgd2hlcmUgc29tZXRpbWVzIHRoZSBzdGF0ZSBkb2VzIG5vdCBjaGFuZ2U6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD00Mjk0MFxuICAgICAgICAgICAgaWYgKEhpc3RvcnkuYnVncy5pZURvdWJsZUNoZWNrKSB7XG4gICAgICAgICAgICAgICAgLy8gQXBwbHkgQ2hlY2tcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrZXIgPSBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrQ2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSGlzdG9yeS5zdGF0ZUNoYW5nZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuZG91YmxlQ2hlY2s6IFN0YXRlIGhhcyBub3QgeWV0IGNoYW5nZWQsIHRyeWluZyBhZ2FpbicsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmUtQXR0ZW1wdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeUFnYWluKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5vcHRpb25zLmRvdWJsZUNoZWNrSW50ZXJ2YWxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGFpblxuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBTYWZhcmkgQnVnIEZpeFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnNhZmFyaVN0YXRlUG9sbCgpXG4gICAgICAgICAqIFBvbGwgdGhlIGN1cnJlbnQgc3RhdGVcbiAgICAgICAgICogQHJldHVybiB7SGlzdG9yeX1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc2FmYXJpU3RhdGVQb2xsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gUG9sbCB0aGUgVVJMXG5cbiAgICAgICAgICAgIC8vIEdldCB0aGUgTGFzdCBTdGF0ZSB3aGljaCBoYXMgdGhlIG5ldyBVUkxcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIHVybFN0YXRlID0gSGlzdG9yeS5leHRyYWN0U3RhdGUoSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSksXG4gICAgICAgICAgICAgICAgbmV3U3RhdGU7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBhIGRpZmZlcmVuY2VcbiAgICAgICAgICAgIGlmICghSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKHVybFN0YXRlKSkge1xuICAgICAgICAgICAgICAgIG5ld1N0YXRlID0gdXJsU3RhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSBzdGF0ZSB3aXRoIHRoYXQgdXJsXG4gICAgICAgICAgICAvLyBJZiBub3QgY3JlYXRlIGl0XG4gICAgICAgICAgICBpZiAoIW5ld1N0YXRlKSB7XG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnNhZmFyaVN0YXRlUG9sbDogbmV3Jyk7XG4gICAgICAgICAgICAgICAgbmV3U3RhdGUgPSBIaXN0b3J5LmNyZWF0ZVN0YXRlT2JqZWN0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEFwcGx5IHRoZSBOZXcgU3RhdGVcbiAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5zYWZhcmlTdGF0ZVBvbGw6IHRyaWdnZXInKTtcbiAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci50cmlnZ2VyKHdpbmRvdywgJ3BvcHN0YXRlJyk7XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFN0YXRlIEFsaWFzZXNcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5iYWNrKHF1ZXVlKVxuICAgICAgICAgKiBTZW5kIHRoZSBicm93c2VyIGhpc3RvcnkgYmFjayBvbmUgaXRlbVxuICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IHF1ZXVlIFtvcHRpb25hbF1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuYmFjayA9IGZ1bmN0aW9uIChxdWV1ZSkge1xuICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LmJhY2s6IGNhbGxlZCcsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZSBRdWV1ZWluZ1xuICAgICAgICAgICAgaWYgKHF1ZXVlICE9PSBmYWxzZSAmJiBIaXN0b3J5LmJ1c3koKSkge1xuICAgICAgICAgICAgICAgIC8vIFdhaXQgKyBQdXNoIHRvIFF1ZXVlXG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LmJhY2s6IHdlIG11c3Qgd2FpdCcsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5wdXNoUXVldWUoe1xuICAgICAgICAgICAgICAgICAgICBzY29wZTogSGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IEhpc3RvcnkuYmFjayxcbiAgICAgICAgICAgICAgICAgICAgYXJnczogYXJndW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZTogcXVldWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1ha2UgQnVzeSArIENvbnRpbnVlXG4gICAgICAgICAgICBIaXN0b3J5LmJ1c3kodHJ1ZSk7XG5cbiAgICAgICAgICAgIC8vIEZpeCBjZXJ0YWluIGJyb3dzZXIgYnVncyB0aGF0IHByZXZlbnQgdGhlIHN0YXRlIGZyb20gY2hhbmdpbmdcbiAgICAgICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuYmFjayhmYWxzZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gR28gYmFja1xuICAgICAgICAgICAgaGlzdG9yeS5nbygtMSk7XG5cbiAgICAgICAgICAgIC8vIEVuZCBiYWNrIGNsb3N1cmVcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmZvcndhcmQocXVldWUpXG4gICAgICAgICAqIFNlbmQgdGhlIGJyb3dzZXIgaGlzdG9yeSBmb3J3YXJkIG9uZSBpdGVtXG4gICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gcXVldWUgW29wdGlvbmFsXVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5mb3J3YXJkID0gZnVuY3Rpb24gKHF1ZXVlKSB7XG4gICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuZm9yd2FyZDogY2FsbGVkJywgYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgLy8gSGFuZGxlIFF1ZXVlaW5nXG4gICAgICAgICAgICBpZiAocXVldWUgIT09IGZhbHNlICYmIEhpc3RvcnkuYnVzeSgpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2FpdCArIFB1c2ggdG8gUXVldWVcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuZm9yd2FyZDogd2UgbXVzdCB3YWl0JywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSh7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiBIaXN0b3J5LFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogSGlzdG9yeS5mb3J3YXJkLFxuICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBxdWV1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWFrZSBCdXN5ICsgQ29udGludWVcbiAgICAgICAgICAgIEhpc3RvcnkuYnVzeSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gRml4IGNlcnRhaW4gYnJvd3NlciBidWdzIHRoYXQgcHJldmVudCB0aGUgc3RhdGUgZnJvbSBjaGFuZ2luZ1xuICAgICAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVjayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5mb3J3YXJkKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBHbyBmb3J3YXJkXG4gICAgICAgICAgICBoaXN0b3J5LmdvKDEpO1xuXG4gICAgICAgICAgICAvLyBFbmQgZm9yd2FyZCBjbG9zdXJlXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nbyhpbmRleCxxdWV1ZSlcbiAgICAgICAgICogU2VuZCB0aGUgYnJvd3NlciBoaXN0b3J5IGJhY2sgb3IgZm9yd2FyZCBpbmRleCB0aW1lc1xuICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IHF1ZXVlIFtvcHRpb25hbF1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ28gPSBmdW5jdGlvbiAoaW5kZXgsIHF1ZXVlKSB7XG4gICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuZ286IGNhbGxlZCcsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICAvLyBIYW5kbGVcbiAgICAgICAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBGb3J3YXJkXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8PSBpbmRleDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZm9yd2FyZChxdWV1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgLy8gQmFja3dhcmRcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAtMTsgaSA+PSBpbmRleDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuYmFjayhxdWV1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5LmdvOiBIaXN0b3J5LmdvIHJlcXVpcmVzIGEgcG9zaXRpdmUgb3IgbmVnYXRpdmUgaW50ZWdlciBwYXNzZWQuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEhUTUw1IFN0YXRlIFN1cHBvcnRcblxuICAgICAgICAvLyBOb24tTmF0aXZlIHB1c2hTdGF0ZSBJbXBsZW1lbnRhdGlvblxuICAgICAgICBpZiAoSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUpIHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgKiBQcm92aWRlIFNrZWxldG9uIGZvciBIVE1MNCBCcm93c2Vyc1xuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBlbXB0eUZ1bmN0aW9uID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZSA9IEhpc3RvcnkucHVzaFN0YXRlIHx8IGVtcHR5RnVuY3Rpb247XG4gICAgICAgICAgICBIaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IEhpc3RvcnkucmVwbGFjZVN0YXRlIHx8IGVtcHR5RnVuY3Rpb247XG4gICAgICAgIH0gLy8gSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGVcblxuICAgICAgICAvLyBOYXRpdmUgcHVzaFN0YXRlIEltcGxlbWVudGF0aW9uXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAqIFVzZSBuYXRpdmUgSFRNTDUgSGlzdG9yeSBBUEkgSW1wbGVtZW50YXRpb25cbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEhpc3Rvcnkub25Qb3BTdGF0ZShldmVudCxleHRyYSlcbiAgICAgICAgICAgICAqIFJlZnJlc2ggdGhlIEN1cnJlbnQgU3RhdGVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgSGlzdG9yeS5vblBvcFN0YXRlID0gZnVuY3Rpb24gKGV2ZW50LCBleHRyYSkge1xuICAgICAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGVJZCA9IGZhbHNlLCBuZXdTdGF0ZSA9IGZhbHNlLCBjdXJyZW50SGFzaCwgY3VycmVudFN0YXRlO1xuXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGRvdWJsZSBjaGVja1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tDb21wbGV0ZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGEgSGFzaCwgYW5kIGhhbmRsZSBhcHBvcmlhdGx5XG4gICAgICAgICAgICAgICAgY3VycmVudEhhc2ggPSBIaXN0b3J5LmdldEhhc2goKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEhhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhwYW5kIEhhc2hcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gSGlzdG9yeS5leHRyYWN0U3RhdGUoY3VycmVudEhhc2ggfHwgSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgYWJsZSB0byBwYXJzZSBpdCwgaXQgbXVzdCBiZSBhIFN0YXRlIVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGV0J3MgZm9yd2FyZCB0byByZXBsYWNlU3RhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5vblBvcFN0YXRlOiBzdGF0ZSBhbmNob3InLCBjdXJyZW50SGFzaCwgY3VycmVudFN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlKGN1cnJlbnRTdGF0ZS5kYXRhLCBjdXJyZW50U3RhdGUudGl0bGUsIGN1cnJlbnRTdGF0ZS51cmwsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyYWRpdGlvbmFsIEFuY2hvclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5Lm9uUG9wU3RhdGU6IHRyYWRpdGlvbmFsIGFuY2hvcicsIGN1cnJlbnRIYXNoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci50cmlnZ2VyKHdpbmRvdywgJ2FuY2hvcmNoYW5nZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5idXN5KGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IGNhcmUgZm9yIGhhc2hlc1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmV4cGVjdGVkU3RhdGVJZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRW5zdXJlXG4gICAgICAgICAgICAgICAgc3RhdGVJZCA9IEhpc3RvcnkuQWRhcHRlci5leHRyYWN0RXZlbnREYXRhKCdzdGF0ZScsIGV2ZW50LCBleHRyYSkgfHwgZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBGZXRjaCBTdGF0ZVxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFZhbmlsbGE6IEJhY2svZm9yd2FyZCBidXR0b24gd2FzIHVzZWRcbiAgICAgICAgICAgICAgICAgICAgbmV3U3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlQnlJZChzdGF0ZUlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoSGlzdG9yeS5leHBlY3RlZFN0YXRlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFuaWxsYTogQSBuZXcgc3RhdGUgd2FzIHB1c2hlZCwgYW5kIHBvcHN0YXRlIHdhcyBjYWxsZWQgbWFudWFsbHlcbiAgICAgICAgICAgICAgICAgICAgbmV3U3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlQnlJZChIaXN0b3J5LmV4cGVjdGVkU3RhdGVJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsIFN0YXRlXG4gICAgICAgICAgICAgICAgICAgIG5ld1N0YXRlID0gSGlzdG9yeS5leHRyYWN0U3RhdGUoSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVGhlIFN0YXRlIGRpZCBub3QgZXhpc3QgaW4gb3VyIHN0b3JlXG4gICAgICAgICAgICAgICAgaWYgKCFuZXdTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZWdlbmVyYXRlIHRoZSBTdGF0ZVxuICAgICAgICAgICAgICAgICAgICBuZXdTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QobnVsbCwgbnVsbCwgSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ2xlYW5cbiAgICAgICAgICAgICAgICBIaXN0b3J5LmV4cGVjdGVkU3RhdGVJZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYXJlIHRoZSBzYW1lIHN0YXRlXG4gICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuaXNMYXN0U2F2ZWRTdGF0ZShuZXdTdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaGFzIGJlZW4gbm8gY2hhbmdlIChqdXN0IHRoZSBwYWdlJ3MgaGFzaCBoYXMgZmluYWxseSBwcm9wYWdhdGVkKVxuICAgICAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkub25Qb3BTdGF0ZTogbm8gY2hhbmdlJywgbmV3U3RhdGUsIEhpc3Rvcnkuc2F2ZWRTdGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3koZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIFN0YXRlXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5zdG9yZVN0YXRlKG5ld1N0YXRlKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnNhdmVTdGF0ZShuZXdTdGF0ZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBGb3JjZSB1cGRhdGUgb2YgdGhlIHRpdGxlXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5zZXRUaXRsZShuZXdTdGF0ZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBGaXJlIE91ciBFdmVudFxuICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci50cmlnZ2VyKHdpbmRvdywgJ3N0YXRlY2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5idXN5KGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0cnVlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAncG9wc3RhdGUnLCBIaXN0b3J5Lm9uUG9wU3RhdGUpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEhpc3RvcnkucHVzaFN0YXRlKGRhdGEsdGl0bGUsdXJsKVxuICAgICAgICAgICAgICogQWRkIGEgbmV3IFN0YXRlIHRvIHRoZSBoaXN0b3J5IG9iamVjdCwgYmVjb21lIGl0LCBhbmQgdHJpZ2dlciBvbnBvcHN0YXRlXG4gICAgICAgICAgICAgKiBXZSBoYXZlIHRvIHRyaWdnZXIgZm9yIEhUTUw0IGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGl0bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAgICAgICAqIEByZXR1cm4ge3RydWV9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24gKGRhdGEsIHRpdGxlLCB1cmwsIHF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnB1c2hTdGF0ZTogY2FsbGVkJywgYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIHRoZSBTdGF0ZVxuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmdldEhhc2hCeVVybCh1cmwpICYmIEhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeS5qcyBkb2VzIG5vdCBzdXBwb3J0IHN0YXRlcyB3aXRoIGZyYWdlbWVudC1pZGVudGlmaWVycyAoaGFzaGVzL2FuY2hvcnMpLicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBRdWV1ZWluZ1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZSAhPT0gZmFsc2UgJiYgSGlzdG9yeS5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2FpdCArIFB1c2ggdG8gUXVldWVcbiAgICAgICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnB1c2hTdGF0ZTogd2UgbXVzdCB3YWl0JywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5wdXNoUXVldWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6IEhpc3RvcnksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogSGlzdG9yeS5wdXNoU3RhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogcXVldWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBNYWtlIEJ1c3kgKyBDb250aW51ZVxuICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeSh0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSBIaXN0b3J5LmNyZWF0ZVN0YXRlT2JqZWN0KGRhdGEsIHRpdGxlLCB1cmwpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaXRcbiAgICAgICAgICAgICAgICBpZiAoSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXb24ndCBiZSBhIGNoYW5nZVxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3koZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIG5ld1N0YXRlXG4gICAgICAgICAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmVTdGF0ZShuZXdTdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZXhwZWN0ZWRTdGF0ZUlkID0gbmV3U3RhdGUuaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUHVzaCB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUobmV3U3RhdGUuaWQsIG5ld1N0YXRlLnRpdGxlLCBuZXdTdGF0ZS51cmwpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcmUgSFRNTDUgRXZlbnRcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAncG9wc3RhdGUnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbmQgcHVzaFN0YXRlIGNsb3N1cmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSGlzdG9yeS5yZXBsYWNlU3RhdGUoZGF0YSx0aXRsZSx1cmwpXG4gICAgICAgICAgICAgKiBSZXBsYWNlIHRoZSBTdGF0ZSBhbmQgdHJpZ2dlciBvbnBvcHN0YXRlXG4gICAgICAgICAgICAgKiBXZSBoYXZlIHRvIHRyaWdnZXIgZm9yIEhUTUw0IGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGl0bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAgICAgICAqIEByZXR1cm4ge3RydWV9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlID0gZnVuY3Rpb24gKGRhdGEsIHRpdGxlLCB1cmwsIHF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnJlcGxhY2VTdGF0ZTogY2FsbGVkJywgYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIHRoZSBTdGF0ZVxuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmdldEhhc2hCeVVybCh1cmwpICYmIEhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeS5qcyBkb2VzIG5vdCBzdXBwb3J0IHN0YXRlcyB3aXRoIGZyYWdlbWVudC1pZGVudGlmaWVycyAoaGFzaGVzL2FuY2hvcnMpLicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBRdWV1ZWluZ1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZSAhPT0gZmFsc2UgJiYgSGlzdG9yeS5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2FpdCArIFB1c2ggdG8gUXVldWVcbiAgICAgICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnJlcGxhY2VTdGF0ZTogd2UgbXVzdCB3YWl0JywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5wdXNoUXVldWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6IEhpc3RvcnksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogSGlzdG9yeS5yZXBsYWNlU3RhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogcXVldWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBNYWtlIEJ1c3kgKyBDb250aW51ZVxuICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeSh0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSBIaXN0b3J5LmNyZWF0ZVN0YXRlT2JqZWN0KGRhdGEsIHRpdGxlLCB1cmwpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaXRcbiAgICAgICAgICAgICAgICBpZiAoSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXb24ndCBiZSBhIGNoYW5nZVxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3koZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIG5ld1N0YXRlXG4gICAgICAgICAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmVTdGF0ZShuZXdTdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZXhwZWN0ZWRTdGF0ZUlkID0gbmV3U3RhdGUuaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUHVzaCB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUobmV3U3RhdGUuaWQsIG5ld1N0YXRlLnRpdGxlLCBuZXdTdGF0ZS51cmwpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcmUgSFRNTDUgRXZlbnRcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAncG9wc3RhdGUnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbmQgcmVwbGFjZVN0YXRlIGNsb3N1cmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSAvLyAhSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGVcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEluaXRpYWxpc2VcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9hZCB0aGUgU3RvcmVcbiAgICAgICAgICovXG4gICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZSkge1xuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5zdG9yZSA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnSGlzdG9yeS5zdG9yZScpKSB8fCB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnN0b3JlID0ge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZVxuICAgICAgICAgICAgSGlzdG9yeS5ub3JtYWxpemVTdG9yZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gRGVmYXVsdCBMb2FkXG4gICAgICAgICAgICBIaXN0b3J5LnN0b3JlID0ge307XG4gICAgICAgICAgICBIaXN0b3J5Lm5vcm1hbGl6ZVN0b3JlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xlYXIgSW50ZXJ2YWxzIG9uIGV4aXQgdG8gcHJldmVudCBtZW1vcnkgbGVha3NcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgXCJ1bmxvYWRcIiwgSGlzdG9yeS5jbGVhckFsbEludGVydmFscyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSB0aGUgaW5pdGlhbCBTdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zYXZlU3RhdGUoSGlzdG9yeS5zdG9yZVN0YXRlKEhpc3RvcnkuZXh0cmFjdFN0YXRlKEhpc3RvcnkuZ2V0TG9jYXRpb25IcmVmKCksIHRydWUpKSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJpbmQgZm9yIFNhdmluZyBTdG9yZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBXaGVuIHRoZSBwYWdlIGlzIGNsb3NlZFxuICAgICAgICAgICAgSGlzdG9yeS5vblVubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRTdG9yZSwgaXRlbSwgY3VycmVudFN0b3JlU3RyaW5nO1xuXG4gICAgICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ0hpc3Rvcnkuc3RvcmUnKSkgfHwge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0b3JlID0ge307XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRW5zdXJlXG4gICAgICAgICAgICAgICAgY3VycmVudFN0b3JlLmlkVG9TdGF0ZSA9IGN1cnJlbnRTdG9yZS5pZFRvU3RhdGUgfHwge307XG4gICAgICAgICAgICAgICAgY3VycmVudFN0b3JlLnVybFRvSWQgPSBjdXJyZW50U3RvcmUudXJsVG9JZCB8fCB7fTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUuc3RhdGVUb0lkID0gY3VycmVudFN0b3JlLnN0YXRlVG9JZCB8fCB7fTtcblxuICAgICAgICAgICAgICAgIC8vIFN5bmNcbiAgICAgICAgICAgICAgICBmb3IgKGl0ZW0gaW4gSGlzdG9yeS5pZFRvU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFIaXN0b3J5LmlkVG9TdGF0ZS5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0b3JlLmlkVG9TdGF0ZVtpdGVtXSA9IEhpc3RvcnkuaWRUb1N0YXRlW2l0ZW1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGl0ZW0gaW4gSGlzdG9yeS51cmxUb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghSGlzdG9yeS51cmxUb0lkLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUudXJsVG9JZFtpdGVtXSA9IEhpc3RvcnkudXJsVG9JZFtpdGVtXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChpdGVtIGluIEhpc3Rvcnkuc3RhdGVUb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghSGlzdG9yeS5zdGF0ZVRvSWQuaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZS5zdGF0ZVRvSWRbaXRlbV0gPSBIaXN0b3J5LnN0YXRlVG9JZFtpdGVtXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnN0b3JlID0gY3VycmVudFN0b3JlO1xuICAgICAgICAgICAgICAgIEhpc3Rvcnkubm9ybWFsaXplU3RvcmUoKTtcblxuICAgICAgICAgICAgICAgIC8vIEluIFNhZmFyaSwgZ29pbmcgaW50byBQcml2YXRlIEJyb3dzaW5nIG1vZGUgY2F1c2VzIHRoZVxuICAgICAgICAgICAgICAgIC8vIFNlc3Npb24gU3RvcmFnZSBvYmplY3QgdG8gc3RpbGwgZXhpc3QgYnV0IGlmIHlvdSB0cnkgYW5kIHVzZVxuICAgICAgICAgICAgICAgIC8vIG9yIHNldCBhbnkgcHJvcGVydHkvZnVuY3Rpb24gb2YgaXQgaXQgdGhyb3dzIHRoZSBleGNlcHRpb25cbiAgICAgICAgICAgICAgICAvLyBcIlFVT1RBX0VYQ0VFREVEX0VSUjogRE9NIEV4Y2VwdGlvbiAyMjogQW4gYXR0ZW1wdCB3YXMgbWFkZSB0b1xuICAgICAgICAgICAgICAgIC8vIGFkZCBzb21ldGhpbmcgdG8gc3RvcmFnZSB0aGF0IGV4Y2VlZGVkIHRoZSBxdW90YS5cIiBpbmZpbml0ZWx5XG4gICAgICAgICAgICAgICAgLy8gZXZlcnkgc2Vjb25kLlxuICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGN1cnJlbnRTdG9yZSk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmVcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnSGlzdG9yeS5zdG9yZScsIGN1cnJlbnRTdG9yZVN0cmluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmNvZGUgPT09IERPTUV4Y2VwdGlvbi5RVU9UQV9FWENFRURFRF9FUlIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBhIGJ1ZyBzZWVuIG9uIGlQYWRzLiBTb21ldGltZXMgdGhlIHF1b3RhIGV4Y2VlZGVkIGVycm9yIGNvbWVzIHVwIGFuZCBzaW1wbHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmluZy9yZXNldHRpbmcgdGhlIHN0b3JhZ2UgY2FuIHdvcmsuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnSGlzdG9yeS5zdG9yZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ0hpc3Rvcnkuc3RvcmUnLCBjdXJyZW50U3RvcmVTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHdlJ3JlIHByb2JhYmx5IHByaXZhdGUgYnJvd3NpbmcgaW4gU2FmYXJpLCBzbyB3ZSdsbCBpZ25vcmUgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBGb3IgSW50ZXJuZXQgRXhwbG9yZXJcbiAgICAgICAgICAgIEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyKCkgJiYgSGlzdG9yeS5pbnRlcnZhbExpc3QucHVzaChzZXRJbnRlcnZhbChIaXN0b3J5Lm9uVW5sb2FkLCBIaXN0b3J5Lm9wdGlvbnMuc3RvcmVJbnRlcnZhbCkpO1xuXG4gICAgICAgICAgICAvLyBGb3IgT3RoZXIgQnJvd3NlcnNcbiAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgJ2JlZm9yZXVubG9hZCcsIEhpc3Rvcnkub25VbmxvYWQpO1xuICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAndW5sb2FkJywgSGlzdG9yeS5vblVubG9hZCk7XG5cbiAgICAgICAgICAgIC8vIEJvdGggYXJlIGVuYWJsZWQgZm9yIGNvbnNpc3RlbmN5XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb24tTmF0aXZlIHB1c2hTdGF0ZSBJbXBsZW1lbnRhdGlvblxuICAgICAgICBpZiAoIUhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlKSB7XG4gICAgICAgICAgICAvLyBCZSBhd2FyZSwgdGhlIGZvbGxvd2luZyBpcyBvbmx5IGZvciBuYXRpdmUgcHVzaFN0YXRlIGltcGxlbWVudGF0aW9uc1xuICAgICAgICAgICAgLy8gSWYgeW91IGFyZSB3YW50aW5nIHRvIGluY2x1ZGUgc29tZXRoaW5nIGZvciBhbGwgYnJvd3NlcnNcbiAgICAgICAgICAgIC8vIFRoZW4gaW5jbHVkZSBpdCBhYm92ZSB0aGlzIGlmIGJsb2NrXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogU2V0dXAgU2FmYXJpIEZpeFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5idWdzLnNhZmFyaVBvbGwpIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmludGVydmFsTGlzdC5wdXNoKHNldEludGVydmFsKEhpc3Rvcnkuc2FmYXJpU3RhdGVQb2xsLCBIaXN0b3J5Lm9wdGlvbnMuc2FmYXJpUG9sbEludGVydmFsKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5zdXJlIENyb3NzIEJyb3dzZXIgQ29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAobmF2aWdhdG9yLnZlbmRvciA9PT0gJ0FwcGxlIENvbXB1dGVyLCBJbmMuJyB8fCAobmF2aWdhdG9yLmFwcENvZGVOYW1lIHx8ICcnKSA9PT0gJ01vemlsbGEnKSB7XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRml4IFNhZmFyaSBIYXNoQ2hhbmdlIElzc3VlXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0dXAgQWxpYXNcbiAgICAgICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csICdoYXNoY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIudHJpZ2dlcih3aW5kb3csICdwb3BzdGF0ZScpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGlzZSBBbGlhc1xuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmdldEhhc2goKSkge1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIub25Eb21Mb2FkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci50cmlnZ2VyKHdpbmRvdywgJ2hhc2hjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gLy8gIUhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlXG5cblxuICAgIH07IC8vIEhpc3RvcnkuaW5pdENvcmVcblxuICAgIC8vIFRyeSB0byBJbml0aWFsaXNlIEhpc3RvcnlcbiAgICBpZiAoIUhpc3Rvcnkub3B0aW9ucyB8fCAhSGlzdG9yeS5vcHRpb25zLmRlbGF5SW5pdCkge1xuICAgICAgICBIaXN0b3J5LmluaXQoKTtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gSGlzdG9yeTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxhc3RUaW1lID0gMDtcbiAgICB2YXIgdmVuZG9ycyA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XG4gICAgZm9yKHZhciB4ID0gMDsgeCA8IHZlbmRvcnMubGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyArK3gpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbEFuaW1hdGlvbkZyYW1lJ11cbiAgICAgICAgfHwgd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgIH1cblxuICAgIGlmICghd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSlcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgY3VyclRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgIHZhciB0aW1lVG9DYWxsID0gTWF0aC5tYXgoMCwgMTYgLSAoY3VyclRpbWUgLSBsYXN0VGltZSkpO1xuICAgICAgICAgICAgdmFyIGlkID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNhbGxiYWNrKGN1cnJUaW1lICsgdGltZVRvQ2FsbCk7IH0sXG4gICAgICAgICAgICAgICAgdGltZVRvQ2FsbCk7XG4gICAgICAgICAgICBsYXN0VGltZSA9IGN1cnJUaW1lICsgdGltZVRvQ2FsbDtcbiAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgfTtcblxuICAgIGlmICghd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKVxuICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGlkKTtcbiAgICAgICAgfTtcbn0oKSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307IiwidmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIGRlZXBDbG9uZSAgPSByZXF1aXJlKCdtb3V0L2xhbmcvZGVlcENsb25lJyk7XG5cbi8vdmFyIG9iamVjdERpZmYgPSByZXF1aXJlKCdvYmplY3RkaWZmJyk7XG5cbnZhciBTYXZlU3RhdGUgPSBuZXcgcHJpbWUoe1xuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKHNlc3Npb24pIHtcbiAgICAgICAgc2Vzc2lvbiA9IGRlZXBDbG9uZShzZXNzaW9uKTtcbiAgICAgICAgdGhpcy5zZXRTZXNzaW9uKHNlc3Npb24pO1xuICAgIH0sXG5cbiAgICBzZXRTZXNzaW9uOiBmdW5jdGlvbihzZXNzaW9uKSB7XG4gICAgICAgIHNlc3Npb24gPSAhc2Vzc2lvbiA/IHt9XG4gICAgICAgICAgICA6IHtcbiAgICAgICAgICAgIHRpbWU6ICsobmV3IERhdGUoKSksXG4gICAgICAgICAgICBkYXRhOiBkZWVwQ2xvbmUoc2Vzc2lvbilcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uO1xuICAgIH0sXG5cbiAgICBnZXRUaW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi50aW1lO1xuICAgIH0sXG5cbiAgICBnZXREYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5kYXRhO1xuICAgIH0sXG5cbiAgICBnZXRTZXNzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbjtcbiAgICB9LFxuXG4gICAgZ2V0RGlmZjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBVbnN1cHBvcnRlZCBhdCB0aGlzIHN0YXRlXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAvKlxuICAgICAgICB2YXIgZGlmZiA9IG9iamVjdERpZmYuZGlmZih0aGlzLmdldERhdGEoKSwgZGF0YSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkaWZmOiBkaWZmLFxuICAgICAgICAgICAgeG1sOiBvYmplY3REaWZmLmNvbnZlcnRUb1hNTFN0cmluZyhkaWZmKVxuICAgICAgICB9O1xuICAgICAgICAqL1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNhdmVTdGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcmVwbGFjZSA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3JlcGxhY2UnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXksIHJlcGxhY2VtZW50KSB7XG4gICAgdmFyIEc1VCA9IGdsb2JhbC5HNVQgfHwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiBrZXk7IH07XG4gICAgcmV0dXJuIHJlcGxhY2UoRzVUKGtleSksICclcycsIHJlcGxhY2VtZW50IHx8ICcnKTtcbn07IiwidmFyICQgPSByZXF1aXJlKCdlbGVtZW50cycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZpZWxkKSB7XG4gICAgaWYgKCFmaWVsZCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3dwLWN1c3RvbWl6ZXInKSAmJiBqUXVlcnkpIHtcbiAgICAgICAgdmFyIHdpZGdldENvbnRhaW5lciA9IGZpZWxkLnBhcmVudCgnLndpZGdldC1jb250ZW50JyksXG4gICAgICAgICAgICB0aXRsZSA9IGZpZWxkLnNpYmxpbmdzKCcuZy1pbnN0YW5jZXBpY2tlci10aXRsZScpO1xuXG4gICAgICAgIGlmICh3aWRnZXRDb250YWluZXIpIHtcbiAgICAgICAgICAgIHZhciBqUXVlcnlFdmVudCA9IGpRdWVyeS5FdmVudCgnY2hhbmdlJyk7XG4gICAgICAgICAgICBqUXVlcnlFdmVudC50YXJnZXQgPSBmaWVsZFswXTtcbiAgICAgICAgICAgIGpRdWVyeSh3aWRnZXRDb250YWluZXJbMF0pLnRyaWdnZXIoalF1ZXJ5RXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGl0bGUuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgIH1cbiAgICB9XG59OyIsIi8qXG5BZ2VudFxuLSBoZWF2aWx5IGluc3BpcmVkIGJ5IHN1cGVyYWdlbnQgYnkgdmlzaW9ubWVkaWEgaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnQsIHJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuLSBjb2RlIGRlcml2ZWQgZnJvbSBNb29Ub29scyAxLjQgUmVxdWVzdC5qcyAmJiBzdXBlcmFnZW50XG4tIE1JVC1MaWNlbnNlXG4qL1widXNlIHN0cmljdFwiO1xuLyogZ2xvYmFsIEFjdGl2ZVhPYmplY3QgKi9cblxudmFyIHByaW1lICAgPSByZXF1aXJlKFwicHJpbWVcIiksXG4gICAgRW1pdHRlciA9IHJlcXVpcmUoXCJwcmltZS9lbWl0dGVyXCIpXG5cbnZhciBpc09iamVjdCAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc09iamVjdFwiKSxcbiAgICBpc1N0cmluZyAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc1N0cmluZ1wiKSxcbiAgICBpc0FycmF5ICAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc0FycmF5XCIpLFxuICAgIGlzRnVuY3Rpb24gPSByZXF1aXJlKFwibW91dC9sYW5nL2lzRnVuY3Rpb25cIiksXG4gICAgdHJpbSAgICAgICA9IHJlcXVpcmUoXCJtb3V0L3N0cmluZy90cmltXCIpLFxuICAgIHVwcGVyQ2FzZSAgPSByZXF1aXJlKFwibW91dC9zdHJpbmcvdXBwZXJDYXNlXCIpLFxuICAgIGZvckluICAgICAgPSByZXF1aXJlKFwibW91dC9vYmplY3QvZm9ySW5cIiksXG4gICAgbWl4SW4gICAgICA9IHJlcXVpcmUoXCJtb3V0L29iamVjdC9taXhJblwiKSxcbiAgICByZW1vdmUgICAgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvcmVtb3ZlXCIpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpXG5cbnZhciBjYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyKXtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1xcYlthLXpdL2csIHVwcGVyQ2FzZSlcbn1cblxuLy8gTW9vVG9vbHNcblxudmFyIGdldFJlcXVlc3QgPSAoZnVuY3Rpb24oKXtcblxuICAgIHZhciBYTUxIVFRQID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpXG4gICAgfSwgTVNYTUwyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KFwiTVNYTUwyLlhNTEhUVFBcIilcbiAgICB9LCBNU1hNTCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxIVFRQXCIpXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIFhNTEhUVFAoKVxuICAgICAgcmV0dXJuIFhNTEhUVFBcbiAgICB9IGNhdGNoKGUpe31cbiAgICB0cnkge1xuICAgICAgICBNU1hNTDIoKVxuICAgICAgICByZXR1cm4gTVNYTUwyXG4gICAgfSBjYXRjaChlKXt9XG4gICAgdHJ5IHtcbiAgICAgICAgTVNYTUwoKVxuICAgICAgICByZXR1cm4gTVNYTUxcbiAgICB9IGNhdGNoKGUpe31cblxuICAgIHJldHVybiBudWxsXG5cbn0pKClcblxudmFyIGVuY29kZUpTT04gPSBmdW5jdGlvbihvYmplY3Qpe1xuICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuIFwiXCJcbiAgICBpZiAob2JqZWN0LnRvSlNPTikgcmV0dXJuIG9iamVjdC50b0pTT04oKVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QpXG59XG5cbi8vIE1vb1Rvb2xzXG5cbnZhciBlbmNvZGVRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKG9iamVjdCwgYmFzZSl7XG5cbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiBcIlwiXG4gICAgaWYgKG9iamVjdC50b1F1ZXJ5U3RyaW5nKSByZXR1cm4gb2JqZWN0LnRvUXVlcnlTdHJpbmcoKVxuXG4gICAgdmFyIHF1ZXJ5U3RyaW5nID0gW11cblxuICAgIGZvckluKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgICAgIGlmIChiYXNlKSBrZXkgPSBiYXNlICsgXCJbXCIgKyBrZXkgKyBcIl1cIlxuICAgICAgICB2YXIgcmVzdWx0XG5cbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVyblxuXG4gICAgICAgIGlmIChpc0FycmF5KHZhbHVlKSl7XG4gICAgICAgICAgICB2YXIgcXMgPSB7fVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgcXNbaV0gPSB2YWx1ZVtpXVxuICAgICAgICAgICAgcmVzdWx0ID0gZW5jb2RlUXVlcnlTdHJpbmcocXMsIGtleSlcbiAgICAgICAgfSBlbHNlIGlmIChpc09iamVjdCh2YWx1ZSkpe1xuICAgICAgICAgICAgcmVzdWx0ID0gZW5jb2RlUXVlcnlTdHJpbmcodmFsdWUsIGtleSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGtleSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKVxuICAgICAgICB9XG5cbiAgICAgICAgcXVlcnlTdHJpbmcucHVzaChyZXN1bHQpXG4gICAgfSlcblxuICAgIHJldHVybiBxdWVyeVN0cmluZy5qb2luKFwiJlwiKVxuXG59XG5cbnZhciBkZWNvZGVKU09OID0gSlNPTi5wYXJzZVxuXG4vLyBkZWNvZGVRdWVyeVN0cmluZyBieSBCcmlhbiBEb25vdmFuXG4vLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vdXNlcnMvNTQ5MzYzL2JyaWFuLWRvbm92YW5cblxudmFyIGRlY29kZVF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ocGFyYW1zKXtcblxuICAgIHZhciBwYWlycyAgPSBwYXJhbXMuc3BsaXQoJyYnKSxcbiAgICAgICAgcmVzdWx0ID0ge31cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspe1xuXG4gICAgICAgIHZhciBwYWlyICAgICAgPSBwYWlyc1tpXS5zcGxpdCgnPScpLFxuICAgICAgICAgICAga2V5ICAgICAgID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMF0pLFxuICAgICAgICAgICAgdmFsdWUgICAgID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pLFxuICAgICAgICAgICAgaXNBcnJheSAgID0gL1xcW1xcXSQvLnRlc3Qoa2V5KSxcbiAgICAgICAgICAgIGRpY3RNYXRjaCA9IGtleS5tYXRjaCgvXiguKylcXFsoW15cXF1dKylcXF0kLylcblxuICAgICAgICBpZiAoZGljdE1hdGNoKXtcbiAgICAgICAgICAgIGtleSA9IGRpY3RNYXRjaFsxXVxuICAgICAgICAgICAgdmFyIHN1YmtleSA9IGRpY3RNYXRjaFsyXVxuXG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlc3VsdFtrZXldIHx8IHt9XG4gICAgICAgICAgICByZXN1bHRba2V5XVtzdWJrZXldID0gdmFsdWVcbiAgICAgICAgfSBlbHNlIGlmIChpc0FycmF5KXtcbiAgICAgICAgICAgIGtleSA9IGtleS5zdWJzdHJpbmcoMCwga2V5Lmxlbmd0aCAtIDIpXG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlc3VsdFtrZXldIHx8IFtdXG4gICAgICAgICAgICByZXN1bHRba2V5XS5wdXNoKHZhbHVlKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG5cbn1cblxudmFyIGVuY29kZXJzID0ge1xuICAgIFwiYXBwbGljYXRpb24vanNvblwiIDogZW5jb2RlSlNPTixcbiAgICBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiIDogZW5jb2RlUXVlcnlTdHJpbmdcbn1cblxudmFyIGRlY29kZXJzID0ge1xuICAgIFwiYXBwbGljYXRpb24vanNvblwiOiBkZWNvZGVKU09OLFxuICAgIFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCI6IGRlY29kZVF1ZXJ5U3RyaW5nXG59XG5cbi8vIHBhcnNlSGVhZGVyIGZyb20gc3VwZXJhZ2VudFxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnRcbi8vIE1JVFxuXG52YXIgcGFyc2VIZWFkZXIgPSBmdW5jdGlvbihzdHIpe1xuICAgIHZhciBsaW5lcyA9IHN0ci5zcGxpdCgvXFxyP1xcbi8pLCBmaWVsZHMgPSB7fVxuXG4gICAgbGluZXMucG9wKCkgLy8gdHJhaWxpbmcgQ1JMRlxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBsaW5lcy5sZW5ndGg7IGkgPCBsOyArK2kpe1xuICAgICAgICB2YXIgbGluZSAgPSBsaW5lc1tpXSxcbiAgICAgICAgICAgIGluZGV4ID0gbGluZS5pbmRleE9mKCc6JyksXG4gICAgICAgICAgICBmaWVsZCA9IGNhcGl0YWxpemUobGluZS5zbGljZSgwLCBpbmRleCkpLFxuICAgICAgICAgICAgdmFsdWUgPSB0cmltKGxpbmUuc2xpY2UoaW5kZXggKyAxKSlcblxuICAgICAgICBmaWVsZHNbZmllbGRdID0gdmFsdWVcbiAgICB9XG5cbiAgICByZXR1cm4gZmllbGRzXG59XG5cbnZhciBSRVFVRVNUUyA9IDAsIFEgPSBbXSAvLyBRdWV1ZSBzdHVmZlxuXG52YXIgUmVxdWVzdCA9IHByaW1lKHtcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBSZXF1ZXN0KCl7XG4gICAgICAgIHRoaXMuX2hlYWRlciA9IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoZWFkZXI6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXtcbiAgICAgICAgaWYgKGlzT2JqZWN0KG5hbWUpKSBmb3IgKHZhciBrZXkgaW4gbmFtZSkgdGhpcy5oZWFkZXIoa2V5LCBuYW1lW2tleV0pXG4gICAgICAgIGVsc2UgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5faGVhZGVyXG4gICAgICAgIGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiB0aGlzLl9oZWFkZXJbY2FwaXRhbGl6ZShuYW1lKV1cbiAgICAgICAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMil7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgZGVsZXRlIHRoaXMuX2hlYWRlcltjYXBpdGFsaXplKG5hbWUpXVxuICAgICAgICAgICAgZWxzZSB0aGlzLl9oZWFkZXJbY2FwaXRhbGl6ZShuYW1lKV0gPSB2YWx1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHJ1bm5pbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAhIXRoaXMuX3J1bm5pbmdcbiAgICB9LFxuXG4gICAgYWJvcnQ6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgaWYgKHRoaXMuX3F1ZXVlZCl7XG4gICAgICAgICAgICByZW1vdmUoUSwgdGhpcy5fcXVldWVkKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3F1ZXVlZFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX3hocil7XG4gICAgICAgICAgICB0aGlzLl94aHIuYWJvcnQoKVxuICAgICAgICAgICAgdGhpcy5fZW5kKClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIG1ldGhvZDogZnVuY3Rpb24obSl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX21ldGhvZFxuICAgICAgICB0aGlzLl9tZXRob2QgPSBtLnRvVXBwZXJDYXNlKClcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgZGF0YTogZnVuY3Rpb24oZCl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX2RhdGFcbiAgICAgICAgdGhpcy5fZGF0YSA9IGRcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgdXJsOiBmdW5jdGlvbih1KXtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5fdXJsXG4gICAgICAgIHRoaXMuX3VybCA9IHVcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgdXNlcjogZnVuY3Rpb24odSl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX3VzZXJcbiAgICAgICAgdGhpcy5fdXNlciA9IHVcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgcGFzc3dvcmQ6IGZ1bmN0aW9uKHApe1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGlzLl9wYXNzd29yZFxuICAgICAgICB0aGlzLl9wYXNzd29yZCA9IHBcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgX3NlbmQ6IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBkYXRhLCBoZWFkZXIsIHVzZXIsIHBhc3N3b3JkLCBjYWxsYmFjayl7XG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuXG4gICAgICAgIGlmIChSRVFVRVNUUyA9PT0gYWdlbnQuTUFYX1JFUVVFU1RTKSByZXR1cm4gUS51bnNoaWZ0KHRoaXMuX3F1ZXVlZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBkZWxldGUgc2VsZi5fcXVldWVkXG4gICAgICAgICAgICBzZWxmLl9zZW5kKG1ldGhvZCwgdXJsLCBkYXRhLCBoZWFkZXIsIHVzZXIsIHBhc3N3b3JkLCBjYWxsYmFjaylcbiAgICAgICAgfSlcblxuICAgICAgICBSRVFVRVNUUysrXG5cbiAgICAgICAgdmFyIHhociA9IHRoaXMuX3hociA9IGFnZW50LmdldFJlcXVlc3QoKVxuXG4gICAgICAgIGlmICh4aHIuYWRkRXZlbnRMaXN0ZW5lcikgZm9yRWFjaChbJ3Byb2dyZXNzJywgJ2xvYWQnLCAnZXJyb3InICwgJ2Fib3J0JywgJ2xvYWRlbmQnXSwgZnVuY3Rpb24obWV0aG9kKXtcbiAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKG1ldGhvZCwgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgICAgICAgIHNlbGYuZW1pdChtZXRob2QsIGV2ZW50KVxuICAgICAgICAgICAgfSwgZmFsc2UpXG4gICAgICAgIH0pXG5cbiAgICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIHRydWUsIHVzZXIsIHBhc3N3b3JkKVxuICAgICAgICBpZiAodXNlciAhPSBudWxsICYmIFwid2l0aENyZWRlbnRpYWxzXCIgaW4geGhyKSB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZVxuXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KXtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0geGhyLnN0YXR1c1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBSZXNwb25zZSh4aHIucmVzcG9uc2VUZXh0LCBzdGF0dXMsIHBhcnNlSGVhZGVyKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gcmVzcG9uc2UuZXJyb3IgPyBuZXcgRXJyb3IobWV0aG9kICsgXCIgXCIgKyB1cmwgKyBcIiBcIiArIHN0YXR1cykgOiBudWxsXG4gICAgICAgICAgICAgICAgc2VsZi5fZW5kKClcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgcmVzcG9uc2UpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBoZWFkZXIpIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGZpZWxkLCBoZWFkZXJbZmllbGRdKVxuICAgICAgICB4aHIuc2VuZChkYXRhIHx8IG51bGwpXG4gICAgfSxcblxuICAgIF9lbmQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX3hoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpe31cblxuICAgICAgICBkZWxldGUgdGhpcy5feGhyXG4gICAgICAgIGRlbGV0ZSB0aGlzLl9ydW5uaW5nXG5cbiAgICAgICAgUkVRVUVTVFMtLVxuXG4gICAgICAgIHZhciBxdWV1ZWQgPSBRLnBvcCgpXG4gICAgICAgIGlmIChxdWV1ZWQpIHF1ZXVlZCgpXG4gICAgfSxcblxuICAgIHNlbmQ6IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICAgICAgaWYgKHRoaXMuX3J1bm5pbmcpIHRoaXMuYWJvcnQoKVxuICAgICAgICB0aGlzLl9ydW5uaW5nID0gdHJ1ZVxuXG4gICAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gZnVuY3Rpb24oKXt9XG5cbiAgICAgICAgdmFyIG1ldGhvZCAgID0gdGhpcy5fbWV0aG9kIHx8IFwiUE9TVFwiLFxuICAgICAgICAgICAgZGF0YSAgICAgPSB0aGlzLl9kYXRhIHx8IG51bGwsXG4gICAgICAgICAgICB1cmwgICAgICA9IHRoaXMuX3VybCxcbiAgICAgICAgICAgIHVzZXIgICAgID0gdGhpcy5fdXNlciB8fCBudWxsLFxuICAgICAgICAgICAgcGFzc3dvcmQgPSB0aGlzLl9wYXNzd29yZCB8fCBudWxsXG5cbiAgICAgICAgaWYgKGRhdGEgJiYgIWlzU3RyaW5nKGRhdGEpKXtcbiAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IHRoaXMuX2hlYWRlclsnQ29udGVudC1UeXBlJ10uc3BsaXQoLyAqOyAqLykuc2hpZnQoKSxcbiAgICAgICAgICAgICAgICBlbmNvZGUgICAgICA9IGVuY29kZXJzW2NvbnRlbnRUeXBlXVxuICAgICAgICAgICAgaWYgKGVuY29kZSkgZGF0YSA9IGVuY29kZShkYXRhKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKC9HRVR8SEVBRC8udGVzdChtZXRob2QpICYmIGRhdGEpIHVybCArPSAodXJsLmluZGV4T2YoXCI/XCIpID4gLTEgPyBcIiZcIiA6IFwiP1wiKSArIGRhdGFcblxuICAgICAgICB2YXIgaGVhZGVyID0gbWl4SW4oe30sIHRoaXMuX2hlYWRlcik7XG5cbiAgICAgICAgdGhpcy5fc2VuZChtZXRob2QsIHVybCwgZGF0YSwgaGVhZGVyLCB1c2VyLCBwYXNzd29yZCwgY2FsbGJhY2spXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcblxuICAgIH1cblxufSlcblxuUmVxdWVzdC5pbXBsZW1lbnQobmV3IEVtaXR0ZXIpXG5cbnZhciBSZXNwb25zZSA9IHByaW1lKHtcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBSZXNwb25zZSh0ZXh0LCBzdGF0dXMsIGhlYWRlcil7XG5cbiAgICAgICAgdGhpcy50ZXh0ICAgPSB0ZXh0XG4gICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzXG5cbiAgICAgICAgdGhpcy5oZWFkZXIgPSBoZWFkZXJcblxuICAgICAgICAvLyBzdGF0dXNlcyBmcm9tIHN1cGVyYWdlbnRcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnRcbiAgICAgICAgLy8gTUlUXG5cbiAgICAgICAgdmFyIHQgPSBzdGF0dXMgLyAxMDAgfCAwXG5cbiAgICAgICAgdGhpcy5pbmZvICAgICAgICA9IHQgPT09IDFcbiAgICAgICAgdGhpcy5vayAgICAgICAgICA9IHQgPT09IDJcbiAgICAgICAgdGhpcy5jbGllbnRFcnJvciA9IHQgPT09IDRcbiAgICAgICAgdGhpcy5zZXJ2ZXJFcnJvciA9IHQgPT09IDVcbiAgICAgICAgdGhpcy5lcnJvciAgICAgICA9IHQgPT09IDQgfHwgdCA9PT0gNVxuICAgICAgICB2YXIgbGVuZ3RoID0gJycgKyBoZWFkZXJbJ0NvbnRlbnQtTGVuZ3RoJ11cblxuICAgICAgICAvLyBzdWdhclxuICAgICAgICB0aGlzLmFjY2VwdGVkICAgICAgPSBzdGF0dXMgPT09IDIwMlxuICAgICAgICB0aGlzLm5vQ29udGVudCAgICAgPSBsZW5ndGggPT09ICcwJyB8fCBzdGF0dXMgPT09IDIwNCB8fCBzdGF0dXMgPT09IDEyMjNcbiAgICAgICAgdGhpcy5iYWRSZXF1ZXN0ICAgID0gc3RhdHVzID09PSA0MDBcbiAgICAgICAgdGhpcy51bmF1dGhvcml6ZWQgID0gc3RhdHVzID09PSA0MDFcbiAgICAgICAgdGhpcy5ub3RBY2NlcHRhYmxlID0gc3RhdHVzID09PSA0MDZcbiAgICAgICAgdGhpcy5ub3RGb3VuZCAgICAgID0gc3RhdHVzID09PSA0MDRcblxuICAgICAgICB2YXIgY29udGVudFR5cGUgPSBoZWFkZXJbJ0NvbnRlbnQtVHlwZSddID8gaGVhZGVyWydDb250ZW50LVR5cGUnXS5zcGxpdCgvICo7ICovKS5zaGlmdCgpIDogJycsXG4gICAgICAgICAgICBkZWNvZGVcblxuICAgICAgICBpZiAoIXRoaXMubm9Db250ZW50KSBkZWNvZGUgPSBkZWNvZGVyc1tjb250ZW50VHlwZV1cblxuICAgICAgICB0aGlzLmJvZHkgPSBkZWNvZGUgPyBkZWNvZGUodGhpcy50ZXh0KSA6IHRoaXMudGV4dFxuXG4gICAgfVxuXG59KVxuXG52YXIgbWV0aG9kcyAgPSBcImdldHxwb3N0fHB1dHxkZWxldGV8aGVhZHxwYXRjaHxvcHRpb25zXCIsXG4gICAgck1ldGhvZHMgPSBuZXcgUmVnRXhwKFwiXihcIiArIG1ldGhvZHMgKyBcIikkXCIsIFwiaVwiKVxuXG52YXIgYWdlbnQgPSBmdW5jdGlvbihtZXRob2QsIHVybCwgZGF0YSwgY2FsbGJhY2spe1xuICAgIHZhciByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoKVxuXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcmVxdWVzdFxuXG4gICAgaWYgKCFyTWV0aG9kcy50ZXN0KG1ldGhvZCkpeyAvLyBzaGlmdFxuICAgICAgICBjYWxsYmFjayA9IGRhdGFcbiAgICAgICAgZGF0YSAgICAgPSB1cmxcbiAgICAgICAgdXJsICAgICAgPSBtZXRob2RcbiAgICAgICAgbWV0aG9kICAgPSBcInBvc3RcIlxuICAgIH1cblxuICAgIGlmIChpc0Z1bmN0aW9uKGRhdGEpKXtcbiAgICAgICAgY2FsbGJhY2sgPSBkYXRhXG4gICAgICAgIGRhdGEgPSBudWxsXG4gICAgfVxuXG4gICAgcmVxdWVzdC5tZXRob2QobWV0aG9kKVxuXG4gICAgaWYgKHVybCkgcmVxdWVzdC51cmwodXJsKVxuICAgIGlmIChkYXRhKSByZXF1ZXN0LmRhdGEoZGF0YSlcbiAgICBpZiAoY2FsbGJhY2spIHJlcXVlc3Quc2VuZChjYWxsYmFjaylcblxuICAgIHJldHVybiByZXF1ZXN0XG59XG5cbmFnZW50LmVuY29kZXIgPSBmdW5jdGlvbihjdCwgZW5jb2RlKXtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgcmV0dXJuIGVuY29kZXJzW2N0XVxuICAgIGVuY29kZXJzW2N0XSA9IGVuY29kZVxuICAgIHJldHVybiBhZ2VudFxufVxuXG5hZ2VudC5kZWNvZGVyID0gZnVuY3Rpb24oY3QsIGRlY29kZSl7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiBkZWNvZGVyc1tjdF1cbiAgICBkZWNvZGVyc1tjdF0gPSBkZWNvZGVcbiAgICByZXR1cm4gYWdlbnRcbn1cblxuZm9yRWFjaChtZXRob2RzLnNwbGl0KFwifFwiKSwgZnVuY3Rpb24obWV0aG9kKXtcbiAgICBhZ2VudFttZXRob2RdID0gZnVuY3Rpb24odXJsLCBkYXRhLCBjYWxsYmFjayl7XG4gICAgICAgIHJldHVybiBhZ2VudChtZXRob2QsIHVybCwgZGF0YSwgY2FsbGJhY2spXG4gICAgfVxufSlcblxuYWdlbnQuTUFYX1JFUVVFU1RTID0gSW5maW5pdHlcbmFnZW50LmdldFJlcXVlc3QgPSBnZXRSZXF1ZXN0XG5hZ2VudC5SZXF1ZXN0ICA9IFJlcXVlc3RcbmFnZW50LlJlc3BvbnNlID0gUmVzcG9uc2VcblxubW9kdWxlLmV4cG9ydHMgPSBhZ2VudFxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBBcnJheSBmb3JFYWNoXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9yRWFjaChhcnIsIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpID0gLTEsXG4gICAgICAgICAgICBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICAvLyB3ZSBpdGVyYXRlIG92ZXIgc3BhcnNlIGl0ZW1zIHNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byBtYWtlIGl0XG4gICAgICAgICAgICAvLyB3b3JrIHByb3Blcmx5IG9uIElFIDctOC4gc2VlICM2NFxuICAgICAgICAgICAgaWYgKCBjYWxsYmFjay5jYWxsKHRoaXNPYmosIGFycltpXSwgaSwgYXJyKSA9PT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZvckVhY2g7XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBBcnJheS5pbmRleE9mXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5kZXhPZihhcnIsIGl0ZW0sIGZyb21JbmRleCkge1xuICAgICAgICBmcm9tSW5kZXggPSBmcm9tSW5kZXggfHwgMDtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aCxcbiAgICAgICAgICAgIGkgPSBmcm9tSW5kZXggPCAwID8gbGVuICsgZnJvbUluZGV4IDogZnJvbUluZGV4O1xuICAgICAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICAgICAgLy8gd2UgaXRlcmF0ZSBvdmVyIHNwYXJzZSBpdGVtcyBzaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gbWFrZSBpdFxuICAgICAgICAgICAgLy8gd29yayBwcm9wZXJseSBvbiBJRSA3LTguIHNlZSAjNjRcbiAgICAgICAgICAgIGlmIChhcnJbaV0gPT09IGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gaW5kZXhPZjtcblxuIiwidmFyIGluZGV4T2YgPSByZXF1aXJlKCcuL2luZGV4T2YnKTtcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIHNpbmdsZSBpdGVtIGZyb20gdGhlIGFycmF5LlxuICAgICAqIChpdCB3b24ndCByZW1vdmUgZHVwbGljYXRlcywganVzdCBhIHNpbmdsZSBpdGVtKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZShhcnIsIGl0ZW0pe1xuICAgICAgICB2YXIgaWR4ID0gaW5kZXhPZihhcnIsIGl0ZW0pO1xuICAgICAgICBpZiAoaWR4ICE9PSAtMSkgYXJyLnNwbGljZShpZHgsIDEpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcmVtb3ZlO1xuXG4iLCJ2YXIgbWl4SW4gPSByZXF1aXJlKCcuLi9vYmplY3QvbWl4SW4nKTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBPYmplY3QgdXNpbmcgcHJvdG90eXBhbCBpbmhlcml0YW5jZSBhbmQgc2V0dGluZyBjdXN0b20gcHJvcGVydGllcy5cbiAgICAgKiAtIE1peCBiZXR3ZWVuIERvdWdsYXMgQ3JvY2tmb3JkIFByb3RvdHlwYWwgSW5oZXJpdGFuY2UgPGh0dHA6Ly9qYXZhc2NyaXB0LmNyb2NrZm9yZC5jb20vcHJvdG90eXBhbC5odG1sPiBhbmQgdGhlIEVjbWFTY3JpcHQgNSBgT2JqZWN0LmNyZWF0ZSgpYCBtZXRob2QuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmVudCAgICBQYXJlbnQgT2JqZWN0LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbcHJvcHNdIE9iamVjdCBwcm9wZXJ0aWVzLlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gQ3JlYXRlZCBvYmplY3QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlT2JqZWN0KHBhcmVudCwgcHJvcHMpe1xuICAgICAgICBmdW5jdGlvbiBGKCl7fVxuICAgICAgICBGLnByb3RvdHlwZSA9IHBhcmVudDtcbiAgICAgICAgcmV0dXJuIG1peEluKG5ldyBGKCksIHByb3BzKTtcblxuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZU9iamVjdDtcblxuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICByZXR1cm4gaXNLaW5kKHZhbCwgJ0FycmF5Jyk7XG4gICAgfTtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzQXJyYXk7XG5cbiIsInZhciBpc0tpbmQgPSByZXF1aXJlKCcuL2lzS2luZCcpO1xuICAgIC8qKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsKSB7XG4gICAgICAgIHJldHVybiBpc0tpbmQodmFsLCAnRnVuY3Rpb24nKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc0Z1bmN0aW9uO1xuXG4iLCJ2YXIga2luZE9mID0gcmVxdWlyZSgnLi9raW5kT2YnKTtcbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB2YWx1ZSBpcyBmcm9tIGEgc3BlY2lmaWMgXCJraW5kXCIuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNLaW5kKHZhbCwga2luZCl7XG4gICAgICAgIHJldHVybiBraW5kT2YodmFsKSA9PT0ga2luZDtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc0tpbmQ7XG5cbiIsInZhciBpc0tpbmQgPSByZXF1aXJlKCcuL2lzS2luZCcpO1xuICAgIC8qKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzT2JqZWN0KHZhbCkge1xuICAgICAgICByZXR1cm4gaXNLaW5kKHZhbCwgJ09iamVjdCcpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzT2JqZWN0O1xuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc1N0cmluZyh2YWwpIHtcbiAgICAgICAgcmV0dXJuIGlzS2luZCh2YWwsICdTdHJpbmcnKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc1N0cmluZztcblxuIiwiXG5cbiAgICB2YXIgX3JLaW5kID0gL15cXFtvYmplY3QgKC4qKVxcXSQvLFxuICAgICAgICBfdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgICAgICBVTkRFRjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIFwia2luZFwiIG9mIHZhbHVlLiAoZS5nLiBcIlN0cmluZ1wiLCBcIk51bWJlclwiLCBldGMpXG4gICAgICovXG4gICAgZnVuY3Rpb24ga2luZE9mKHZhbCkge1xuICAgICAgICBpZiAodmFsID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gJ051bGwnO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gVU5ERUYpIHtcbiAgICAgICAgICAgIHJldHVybiAnVW5kZWZpbmVkJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBfcktpbmQuZXhlYyggX3RvU3RyaW5nLmNhbGwodmFsKSApWzFdO1xuICAgICAgICB9XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0ga2luZE9mO1xuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIFR5cGVjYXN0IGEgdmFsdWUgdG8gYSBTdHJpbmcsIHVzaW5nIGFuIGVtcHR5IHN0cmluZyB2YWx1ZSBmb3IgbnVsbCBvclxuICAgICAqIHVuZGVmaW5lZC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b1N0cmluZyh2YWwpe1xuICAgICAgICByZXR1cm4gdmFsID09IG51bGwgPyAnJyA6IHZhbC50b1N0cmluZygpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdG9TdHJpbmc7XG5cblxuIiwidmFyIGhhc093biA9IHJlcXVpcmUoJy4vaGFzT3duJyk7XG5cbiAgICB2YXIgX2hhc0RvbnRFbnVtQnVnLFxuICAgICAgICBfZG9udEVudW1zO1xuXG4gICAgZnVuY3Rpb24gY2hlY2tEb250RW51bSgpe1xuICAgICAgICBfZG9udEVudW1zID0gW1xuICAgICAgICAgICAgICAgICd0b1N0cmluZycsXG4gICAgICAgICAgICAgICAgJ3RvTG9jYWxlU3RyaW5nJyxcbiAgICAgICAgICAgICAgICAndmFsdWVPZicsXG4gICAgICAgICAgICAgICAgJ2hhc093blByb3BlcnR5JyxcbiAgICAgICAgICAgICAgICAnaXNQcm90b3R5cGVPZicsXG4gICAgICAgICAgICAgICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJyxcbiAgICAgICAgICAgICAgICAnY29uc3RydWN0b3InXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgIF9oYXNEb250RW51bUJ1ZyA9IHRydWU7XG5cbiAgICAgICAgZm9yICh2YXIga2V5IGluIHsndG9TdHJpbmcnOiBudWxsfSkge1xuICAgICAgICAgICAgX2hhc0RvbnRFbnVtQnVnID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaW1pbGFyIHRvIEFycmF5L2ZvckVhY2ggYnV0IHdvcmtzIG92ZXIgb2JqZWN0IHByb3BlcnRpZXMgYW5kIGZpeGVzIERvbid0XG4gICAgICogRW51bSBidWcgb24gSUUuXG4gICAgICogYmFzZWQgb246IGh0dHA6Ly93aGF0dGhlaGVhZHNhaWQuY29tLzIwMTAvMTAvYS1zYWZlci1vYmplY3Qta2V5cy1jb21wYXRpYmlsaXR5LWltcGxlbWVudGF0aW9uXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9ySW4ob2JqLCBmbiwgdGhpc09iail7XG4gICAgICAgIHZhciBrZXksIGkgPSAwO1xuICAgICAgICAvLyBubyBuZWVkIHRvIGNoZWNrIGlmIGFyZ3VtZW50IGlzIGEgcmVhbCBvYmplY3QgdGhhdCB3YXkgd2UgY2FuIHVzZVxuICAgICAgICAvLyBpdCBmb3IgYXJyYXlzLCBmdW5jdGlvbnMsIGRhdGUsIGV0Yy5cblxuICAgICAgICAvL3Bvc3QtcG9uZSBjaGVjayB0aWxsIG5lZWRlZFxuICAgICAgICBpZiAoX2hhc0RvbnRFbnVtQnVnID09IG51bGwpIGNoZWNrRG9udEVudW0oKTtcblxuICAgICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmIChleGVjKGZuLCBvYmosIGtleSwgdGhpc09iaikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChfaGFzRG9udEVudW1CdWcpIHtcbiAgICAgICAgICAgIHZhciBjdG9yID0gb2JqLmNvbnN0cnVjdG9yLFxuICAgICAgICAgICAgICAgIGlzUHJvdG8gPSAhIWN0b3IgJiYgb2JqID09PSBjdG9yLnByb3RvdHlwZTtcblxuICAgICAgICAgICAgd2hpbGUgKGtleSA9IF9kb250RW51bXNbaSsrXSkge1xuICAgICAgICAgICAgICAgIC8vIEZvciBjb25zdHJ1Y3RvciwgaWYgaXQgaXMgYSBwcm90b3R5cGUgb2JqZWN0IHRoZSBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgICAgIC8vIGlzIGFsd2F5cyBub24tZW51bWVyYWJsZSB1bmxlc3MgZGVmaW5lZCBvdGhlcndpc2UgKGFuZFxuICAgICAgICAgICAgICAgIC8vIGVudW1lcmF0ZWQgYWJvdmUpLiAgRm9yIG5vbi1wcm90b3R5cGUgb2JqZWN0cywgaXQgd2lsbCBoYXZlXG4gICAgICAgICAgICAgICAgLy8gdG8gYmUgZGVmaW5lZCBvbiB0aGlzIG9iamVjdCwgc2luY2UgaXQgY2Fubm90IGJlIGRlZmluZWQgb25cbiAgICAgICAgICAgICAgICAvLyBhbnkgcHJvdG90eXBlIG9iamVjdHMuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBGb3Igb3RoZXIgW1tEb250RW51bV1dIHByb3BlcnRpZXMsIGNoZWNrIGlmIHRoZSB2YWx1ZSBpc1xuICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCB0aGFuIE9iamVjdCBwcm90b3R5cGUgdmFsdWUuXG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAoa2V5ICE9PSAnY29uc3RydWN0b3InIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAoIWlzUHJvdG8gJiYgaGFzT3duKG9iaiwga2V5KSkpICYmXG4gICAgICAgICAgICAgICAgICAgIG9ialtrZXldICE9PSBPYmplY3QucHJvdG90eXBlW2tleV1cbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4ZWMoZm4sIG9iaiwga2V5LCB0aGlzT2JqKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXhlYyhmbiwgb2JqLCBrZXksIHRoaXNPYmope1xuICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGlzT2JqLCBvYmpba2V5XSwga2V5LCBvYmopO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZm9ySW47XG5cblxuIiwidmFyIGhhc093biA9IHJlcXVpcmUoJy4vaGFzT3duJyk7XG52YXIgZm9ySW4gPSByZXF1aXJlKCcuL2ZvckluJyk7XG5cbiAgICAvKipcbiAgICAgKiBTaW1pbGFyIHRvIEFycmF5L2ZvckVhY2ggYnV0IHdvcmtzIG92ZXIgb2JqZWN0IHByb3BlcnRpZXMgYW5kIGZpeGVzIERvbid0XG4gICAgICogRW51bSBidWcgb24gSUUuXG4gICAgICogYmFzZWQgb246IGh0dHA6Ly93aGF0dGhlaGVhZHNhaWQuY29tLzIwMTAvMTAvYS1zYWZlci1vYmplY3Qta2V5cy1jb21wYXRpYmlsaXR5LWltcGxlbWVudGF0aW9uXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9yT3duKG9iaiwgZm4sIHRoaXNPYmope1xuICAgICAgICBmb3JJbihvYmosIGZ1bmN0aW9uKHZhbCwga2V5KXtcbiAgICAgICAgICAgIGlmIChoYXNPd24ob2JqLCBrZXkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhpc09iaiwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmb3JPd247XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBTYWZlciBPYmplY3QuaGFzT3duUHJvcGVydHlcbiAgICAgKi9cbiAgICAgZnVuY3Rpb24gaGFzT3duKG9iaiwgcHJvcCl7XG4gICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7XG4gICAgIH1cblxuICAgICBtb2R1bGUuZXhwb3J0cyA9IGhhc093bjtcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcblxuICAgIC8qKlxuICAgICogQ29tYmluZSBwcm9wZXJ0aWVzIGZyb20gYWxsIHRoZSBvYmplY3RzIGludG8gZmlyc3Qgb25lLlxuICAgICogLSBUaGlzIG1ldGhvZCBhZmZlY3RzIHRhcmdldCBvYmplY3QgaW4gcGxhY2UsIGlmIHlvdSB3YW50IHRvIGNyZWF0ZSBhIG5ldyBPYmplY3QgcGFzcyBhbiBlbXB0eSBvYmplY3QgYXMgZmlyc3QgcGFyYW0uXG4gICAgKiBAcGFyYW0ge29iamVjdH0gdGFyZ2V0ICAgIFRhcmdldCBPYmplY3RcbiAgICAqIEBwYXJhbSB7Li4ub2JqZWN0fSBvYmplY3RzICAgIE9iamVjdHMgdG8gYmUgY29tYmluZWQgKDAuLi5uIG9iamVjdHMpLlxuICAgICogQHJldHVybiB7b2JqZWN0fSBUYXJnZXQgT2JqZWN0LlxuICAgICovXG4gICAgZnVuY3Rpb24gbWl4SW4odGFyZ2V0LCBvYmplY3RzKXtcbiAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgbiA9IGFyZ3VtZW50cy5sZW5ndGgsXG4gICAgICAgICAgICBvYmo7XG4gICAgICAgIHdoaWxlKCsraSA8IG4pe1xuICAgICAgICAgICAgb2JqID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZm9yT3duKG9iaiwgY29weVByb3AsIHRhcmdldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb3B5UHJvcCh2YWwsIGtleSl7XG4gICAgICAgIHRoaXNba2V5XSA9IHZhbDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1peEluO1xuXG4iLCJcbiAgICAvKipcbiAgICAgKiBDb250YWlucyBhbGwgVW5pY29kZSB3aGl0ZS1zcGFjZXMuIFRha2VuIGZyb21cbiAgICAgKiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1doaXRlc3BhY2VfY2hhcmFjdGVyLlxuICAgICAqL1xuICAgIG1vZHVsZS5leHBvcnRzID0gW1xuICAgICAgICAnICcsICdcXG4nLCAnXFxyJywgJ1xcdCcsICdcXGYnLCAnXFx2JywgJ1xcdTAwQTAnLCAnXFx1MTY4MCcsICdcXHUxODBFJyxcbiAgICAgICAgJ1xcdTIwMDAnLCAnXFx1MjAwMScsICdcXHUyMDAyJywgJ1xcdTIwMDMnLCAnXFx1MjAwNCcsICdcXHUyMDA1JywgJ1xcdTIwMDYnLFxuICAgICAgICAnXFx1MjAwNycsICdcXHUyMDA4JywgJ1xcdTIwMDknLCAnXFx1MjAwQScsICdcXHUyMDI4JywgJ1xcdTIwMjknLCAnXFx1MjAyRicsXG4gICAgICAgICdcXHUyMDVGJywgJ1xcdTMwMDAnXG4gICAgXTtcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIFdISVRFX1NQQUNFUyA9IHJlcXVpcmUoJy4vV0hJVEVfU1BBQ0VTJyk7XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGNoYXJzIGZyb20gYmVnaW5uaW5nIG9mIHN0cmluZy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsdHJpbShzdHIsIGNoYXJzKSB7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIGNoYXJzID0gY2hhcnMgfHwgV0hJVEVfU1BBQ0VTO1xuXG4gICAgICAgIHZhciBzdGFydCA9IDAsXG4gICAgICAgICAgICBsZW4gPSBzdHIubGVuZ3RoLFxuICAgICAgICAgICAgY2hhckxlbiA9IGNoYXJzLmxlbmd0aCxcbiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZSxcbiAgICAgICAgICAgIGksIGM7XG5cbiAgICAgICAgd2hpbGUgKGZvdW5kICYmIHN0YXJ0IDwgbGVuKSB7XG4gICAgICAgICAgICBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgaSA9IC0xO1xuICAgICAgICAgICAgYyA9IHN0ci5jaGFyQXQoc3RhcnQpO1xuXG4gICAgICAgICAgICB3aGlsZSAoKytpIDwgY2hhckxlbikge1xuICAgICAgICAgICAgICAgIGlmIChjID09PSBjaGFyc1tpXSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Kys7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoc3RhcnQgPj0gbGVuKSA/ICcnIDogc3RyLnN1YnN0cihzdGFydCwgbGVuKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGx0cmltO1xuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG52YXIgV0hJVEVfU1BBQ0VTID0gcmVxdWlyZSgnLi9XSElURV9TUEFDRVMnKTtcbiAgICAvKipcbiAgICAgKiBSZW1vdmUgY2hhcnMgZnJvbSBlbmQgb2Ygc3RyaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJ0cmltKHN0ciwgY2hhcnMpIHtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgY2hhcnMgPSBjaGFycyB8fCBXSElURV9TUEFDRVM7XG5cbiAgICAgICAgdmFyIGVuZCA9IHN0ci5sZW5ndGggLSAxLFxuICAgICAgICAgICAgY2hhckxlbiA9IGNoYXJzLmxlbmd0aCxcbiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZSxcbiAgICAgICAgICAgIGksIGM7XG5cbiAgICAgICAgd2hpbGUgKGZvdW5kICYmIGVuZCA+PSAwKSB7XG4gICAgICAgICAgICBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgaSA9IC0xO1xuICAgICAgICAgICAgYyA9IHN0ci5jaGFyQXQoZW5kKTtcblxuICAgICAgICAgICAgd2hpbGUgKCsraSA8IGNoYXJMZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gY2hhcnNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBlbmQtLTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChlbmQgPj0gMCkgPyBzdHIuc3Vic3RyaW5nKDAsIGVuZCArIDEpIDogJyc7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBydHJpbTtcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIFdISVRFX1NQQUNFUyA9IHJlcXVpcmUoJy4vV0hJVEVfU1BBQ0VTJyk7XG52YXIgbHRyaW0gPSByZXF1aXJlKCcuL2x0cmltJyk7XG52YXIgcnRyaW0gPSByZXF1aXJlKCcuL3J0cmltJyk7XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHdoaXRlLXNwYWNlcyBmcm9tIGJlZ2lubmluZyBhbmQgZW5kIG9mIHN0cmluZy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0cmltKHN0ciwgY2hhcnMpIHtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgY2hhcnMgPSBjaGFycyB8fCBXSElURV9TUEFDRVM7XG4gICAgICAgIHJldHVybiBsdHJpbShydHJpbShzdHIsIGNoYXJzKSwgY2hhcnMpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdHJpbTtcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuICAgIC8qKlxuICAgICAqIFwiU2FmZXJcIiBTdHJpbmcudG9VcHBlckNhc2UoKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwcGVyQ2FzZShzdHIpe1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gdXBwZXJDYXNlO1xuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IHRpbWUgaW4gbWlsaXNlY29uZHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBub3coKXtcbiAgICAgICAgLy8geWVzLCB3ZSBkZWZlciB0aGUgd29yayB0byBhbm90aGVyIGZ1bmN0aW9uIHRvIGFsbG93IG1vY2tpbmcgaXRcbiAgICAgICAgLy8gZHVyaW5nIHRoZSB0ZXN0c1xuICAgICAgICByZXR1cm4gbm93LmdldCgpO1xuICAgIH1cblxuICAgIG5vdy5nZXQgPSAodHlwZW9mIERhdGUubm93ID09PSAnZnVuY3Rpb24nKT8gRGF0ZS5ub3cgOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gKyhuZXcgRGF0ZSgpKTtcbiAgICB9O1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBub3c7XG5cblxuIiwiLypcbmRlZmVyXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBraW5kT2YgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9raW5kT2ZcIiksXG4gICAgbm93ICAgICA9IHJlcXVpcmUoXCJtb3V0L3RpbWUvbm93XCIpLFxuICAgIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpLFxuICAgIGluZGV4T2YgPSByZXF1aXJlKFwibW91dC9hcnJheS9pbmRleE9mXCIpXG5cbnZhciBjYWxsYmFja3MgPSB7XG4gICAgdGltZW91dDoge30sXG4gICAgZnJhbWU6IFtdLFxuICAgIGltbWVkaWF0ZTogW11cbn1cblxudmFyIHB1c2ggPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBjYWxsYmFjaywgY29udGV4dCwgZGVmZXIpe1xuXG4gICAgdmFyIGl0ZXJhdG9yID0gZnVuY3Rpb24oKXtcbiAgICAgICAgaXRlcmF0ZShjb2xsZWN0aW9uKVxuICAgIH1cblxuICAgIGlmICghY29sbGVjdGlvbi5sZW5ndGgpIGRlZmVyKGl0ZXJhdG9yKVxuXG4gICAgdmFyIGVudHJ5ID0ge1xuICAgICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICAgIGNvbnRleHQ6IGNvbnRleHRcbiAgICB9XG5cbiAgICBjb2xsZWN0aW9uLnB1c2goZW50cnkpXG5cbiAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGlvID0gaW5kZXhPZihjb2xsZWN0aW9uLCBlbnRyeSlcbiAgICAgICAgaWYgKGlvID4gLTEpIGNvbGxlY3Rpb24uc3BsaWNlKGlvLCAxKVxuICAgIH1cbn1cblxudmFyIGl0ZXJhdGUgPSBmdW5jdGlvbihjb2xsZWN0aW9uKXtcbiAgICB2YXIgdGltZSA9IG5vdygpXG5cbiAgICBmb3JFYWNoKGNvbGxlY3Rpb24uc3BsaWNlKDApLCBmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICBlbnRyeS5jYWxsYmFjay5jYWxsKGVudHJ5LmNvbnRleHQsIHRpbWUpXG4gICAgfSlcbn1cblxudmFyIGRlZmVyID0gZnVuY3Rpb24oY2FsbGJhY2ssIGFyZ3VtZW50LCBjb250ZXh0KXtcbiAgICByZXR1cm4gKGtpbmRPZihhcmd1bWVudCkgPT09IFwiTnVtYmVyXCIpID8gZGVmZXIudGltZW91dChjYWxsYmFjaywgYXJndW1lbnQsIGNvbnRleHQpIDogZGVmZXIuaW1tZWRpYXRlKGNhbGxiYWNrLCBhcmd1bWVudClcbn1cblxuaWYgKGdsb2JhbC5wcm9jZXNzICYmIHByb2Nlc3MubmV4dFRpY2spe1xuXG4gICAgZGVmZXIuaW1tZWRpYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gcHVzaChjYWxsYmFja3MuaW1tZWRpYXRlLCBjYWxsYmFjaywgY29udGV4dCwgcHJvY2Vzcy5uZXh0VGljaylcbiAgICB9XG5cbn0gZWxzZSBpZiAoZ2xvYmFsLnNldEltbWVkaWF0ZSl7XG5cbiAgICBkZWZlci5pbW1lZGlhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5pbW1lZGlhdGUsIGNhbGxiYWNrLCBjb250ZXh0LCBzZXRJbW1lZGlhdGUpXG4gICAgfVxuXG59IGVsc2UgaWYgKGdsb2JhbC5wb3N0TWVzc2FnZSAmJiBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcil7XG5cbiAgICBhZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbihldmVudCl7XG4gICAgICAgIGlmIChldmVudC5zb3VyY2UgPT09IGdsb2JhbCAmJiBldmVudC5kYXRhID09PSBcIkBkZWZlcnJlZFwiKXtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgICAgICBpdGVyYXRlKGNhbGxiYWNrcy5pbW1lZGlhdGUpXG4gICAgICAgIH1cbiAgICB9LCB0cnVlKVxuXG4gICAgZGVmZXIuaW1tZWRpYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gcHVzaChjYWxsYmFja3MuaW1tZWRpYXRlLCBjYWxsYmFjaywgY29udGV4dCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHBvc3RNZXNzYWdlKFwiQGRlZmVycmVkXCIsIFwiKlwiKVxuICAgICAgICB9KVxuICAgIH1cblxufSBlbHNlIHtcblxuICAgIGRlZmVyLmltbWVkaWF0ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIHB1c2goY2FsbGJhY2tzLmltbWVkaWF0ZSwgY2FsbGJhY2ssIGNvbnRleHQsIGZ1bmN0aW9uKGl0ZXJhdG9yKXtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoaXRlcmF0b3IsIDApXG4gICAgICAgIH0pXG4gICAgfVxuXG59XG5cbnZhciByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBnbG9iYWwucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgZ2xvYmFsLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIGdsb2JhbC5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICBnbG9iYWwub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIGdsb2JhbC5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIDFlMyAvIDYwKVxuICAgIH1cblxuZGVmZXIuZnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjaywgY29udGV4dCl7XG4gICAgcmV0dXJuIHB1c2goY2FsbGJhY2tzLmZyYW1lLCBjYWxsYmFjaywgY29udGV4dCwgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxufVxuXG52YXIgY2xlYXJcblxuZGVmZXIudGltZW91dCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBtcywgY29udGV4dCl7XG4gICAgdmFyIGN0ID0gY2FsbGJhY2tzLnRpbWVvdXRcblxuICAgIGlmICghY2xlYXIpIGNsZWFyID0gZGVmZXIuaW1tZWRpYXRlKGZ1bmN0aW9uKCl7XG4gICAgICAgIGNsZWFyID0gbnVsbFxuICAgICAgICBjYWxsYmFja3MudGltZW91dCA9IHt9XG4gICAgfSlcblxuICAgIHJldHVybiBwdXNoKGN0W21zXSB8fCAoY3RbbXNdID0gW10pLCBjYWxsYmFjaywgY29udGV4dCwgZnVuY3Rpb24oaXRlcmF0b3Ipe1xuICAgICAgICBzZXRUaW1lb3V0KGl0ZXJhdG9yLCBtcylcbiAgICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGRlZmVyXG4iLCIvKlxuRW1pdHRlclxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgaW5kZXhPZiA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2luZGV4T2ZcIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZvckVhY2hcIilcblxudmFyIHByaW1lID0gcmVxdWlyZShcIi4vaW5kZXhcIiksXG4gICAgZGVmZXIgPSByZXF1aXJlKFwiLi9kZWZlclwiKVxuXG52YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cbnZhciBFbWl0dGVyID0gcHJpbWUoe1xuXG4gICAgb246IGZ1bmN0aW9uKGV2ZW50LCBmbil7XG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnMgfHwgKHRoaXMuX2xpc3RlbmVycyA9IHt9KSxcbiAgICAgICAgICAgIGV2ZW50cyA9IGxpc3RlbmVyc1tldmVudF0gfHwgKGxpc3RlbmVyc1tldmVudF0gPSBbXSlcblxuICAgICAgICBpZiAoaW5kZXhPZihldmVudHMsIGZuKSA9PT0gLTEpIGV2ZW50cy5wdXNoKGZuKVxuXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIG9mZjogZnVuY3Rpb24oZXZlbnQsIGZuKXtcbiAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycywgZXZlbnRzLCBrZXksIGxlbmd0aCA9IDBcbiAgICAgICAgaWYgKGxpc3RlbmVycyAmJiAoZXZlbnRzID0gbGlzdGVuZXJzW2V2ZW50XSkpe1xuXG4gICAgICAgICAgICB2YXIgaW8gPSBpbmRleE9mKGV2ZW50cywgZm4pXG4gICAgICAgICAgICBpZiAoaW8gPiAtMSkgZXZlbnRzLnNwbGljZShpbywgMSlcbiAgICAgICAgICAgIGlmICghZXZlbnRzLmxlbmd0aCkgZGVsZXRlIGxpc3RlbmVyc1tldmVudF07XG4gICAgICAgICAgICBmb3IgKHZhciBsIGluIGxpc3RlbmVycykgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9saXN0ZW5lcnNcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBlbWl0OiBmdW5jdGlvbihldmVudCl7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSlcblxuICAgICAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gc2VsZi5fbGlzdGVuZXJzLCBldmVudHNcbiAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMgJiYgKGV2ZW50cyA9IGxpc3RlbmVyc1tldmVudF0pKXtcbiAgICAgICAgICAgICAgICBmb3JFYWNoKGV2ZW50cy5zbGljZSgwKSwgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQuYXBwbHkoc2VsZiwgYXJncylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gRW1pdHRlci5FTUlUX1NZTkMpe1xuICAgICAgICAgICAgYXJncy5wb3AoKVxuICAgICAgICAgICAgZW1pdCgpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWZlcihlbWl0KVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG5cbn0pXG5cbkVtaXR0ZXIuRU1JVF9TWU5DID0ge31cblxubW9kdWxlLmV4cG9ydHMgPSBFbWl0dGVyXG4iLCIvKlxucHJpbWVcbiAtIHByb3RvdHlwYWwgaW5oZXJpdGFuY2VcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGhhc093biA9IHJlcXVpcmUoXCJtb3V0L29iamVjdC9oYXNPd25cIiksXG4gICAgbWl4SW4gID0gcmVxdWlyZShcIm1vdXQvb2JqZWN0L21peEluXCIpLFxuICAgIGNyZWF0ZSA9IHJlcXVpcmUoXCJtb3V0L2xhbmcvY3JlYXRlT2JqZWN0XCIpLFxuICAgIGtpbmRPZiA9IHJlcXVpcmUoXCJtb3V0L2xhbmcva2luZE9mXCIpXG5cbnZhciBoYXNEZXNjcmlwdG9ycyA9IHRydWVcblxudHJ5IHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIFwiflwiLCB7fSlcbiAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHt9LCBcIn5cIilcbn0gY2F0Y2ggKGUpe1xuICAgIGhhc0Rlc2NyaXB0b3JzID0gZmFsc2Vcbn1cblxuLy8gd2Ugb25seSBuZWVkIHRvIGJlIGFibGUgdG8gaW1wbGVtZW50IFwidG9TdHJpbmdcIiBhbmQgXCJ2YWx1ZU9mXCIgaW4gSUUgPCA5XG52YXIgaGFzRW51bUJ1ZyA9ICEoe3ZhbHVlT2Y6IDB9KS5wcm9wZXJ0eUlzRW51bWVyYWJsZShcInZhbHVlT2ZcIiksXG4gICAgYnVnZ3kgICAgICA9IFtcInRvU3RyaW5nXCIsIFwidmFsdWVPZlwiXVxuXG52YXIgdmVyYnMgPSAvXmNvbnN0cnVjdG9yfGluaGVyaXRzfG1peGluJC9cblxudmFyIGltcGxlbWVudCA9IGZ1bmN0aW9uKHByb3RvKXtcbiAgICB2YXIgcHJvdG90eXBlID0gdGhpcy5wcm90b3R5cGVcblxuICAgIGZvciAodmFyIGtleSBpbiBwcm90byl7XG4gICAgICAgIGlmIChrZXkubWF0Y2godmVyYnMpKSBjb250aW51ZVxuICAgICAgICBpZiAoaGFzRGVzY3JpcHRvcnMpe1xuICAgICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvLCBrZXkpXG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRvcil7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwga2V5LCBkZXNjcmlwdG9yKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHJvdG90eXBlW2tleV0gPSBwcm90b1trZXldXG4gICAgfVxuXG4gICAgaWYgKGhhc0VudW1CdWcpIGZvciAodmFyIGkgPSAwOyAoa2V5ID0gYnVnZ3lbaV0pOyBpKyspe1xuICAgICAgICB2YXIgdmFsdWUgPSBwcm90b1trZXldXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gT2JqZWN0LnByb3RvdHlwZVtrZXldKSBwcm90b3R5cGVba2V5XSA9IHZhbHVlXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXNcbn1cblxudmFyIHByaW1lID0gZnVuY3Rpb24ocHJvdG8pe1xuXG4gICAgaWYgKGtpbmRPZihwcm90bykgPT09IFwiRnVuY3Rpb25cIikgcHJvdG8gPSB7Y29uc3RydWN0b3I6IHByb3RvfVxuXG4gICAgdmFyIHN1cGVycHJpbWUgPSBwcm90by5pbmhlcml0c1xuXG4gICAgLy8gaWYgb3VyIG5pY2UgcHJvdG8gb2JqZWN0IGhhcyBubyBvd24gY29uc3RydWN0b3IgcHJvcGVydHlcbiAgICAvLyB0aGVuIHdlIHByb2NlZWQgdXNpbmcgYSBnaG9zdGluZyBjb25zdHJ1Y3RvciB0aGF0IGFsbCBpdCBkb2VzIGlzXG4gICAgLy8gY2FsbCB0aGUgcGFyZW50J3MgY29uc3RydWN0b3IgaWYgaXQgaGFzIGEgc3VwZXJwcmltZSwgZWxzZSBhbiBlbXB0eSBjb25zdHJ1Y3RvclxuICAgIC8vIHByb3RvLmNvbnN0cnVjdG9yIGJlY29tZXMgdGhlIGVmZmVjdGl2ZSBjb25zdHJ1Y3RvclxuICAgIHZhciBjb25zdHJ1Y3RvciA9IChoYXNPd24ocHJvdG8sIFwiY29uc3RydWN0b3JcIikpID8gcHJvdG8uY29uc3RydWN0b3IgOiAoc3VwZXJwcmltZSkgPyBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gc3VwZXJwcmltZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgfSA6IGZ1bmN0aW9uKCl7fVxuXG4gICAgaWYgKHN1cGVycHJpbWUpe1xuXG4gICAgICAgIG1peEluKGNvbnN0cnVjdG9yLCBzdXBlcnByaW1lKVxuXG4gICAgICAgIHZhciBzdXBlcnByb3RvID0gc3VwZXJwcmltZS5wcm90b3R5cGVcbiAgICAgICAgLy8gaW5oZXJpdCBmcm9tIHN1cGVycHJpbWVcbiAgICAgICAgdmFyIGNwcm90byA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGNyZWF0ZShzdXBlcnByb3RvKVxuXG4gICAgICAgIC8vIHNldHRpbmcgY29uc3RydWN0b3IucGFyZW50IHRvIHN1cGVycHJpbWUucHJvdG90eXBlXG4gICAgICAgIC8vIGJlY2F1c2UgaXQncyB0aGUgc2hvcnRlc3QgcG9zc2libGUgYWJzb2x1dGUgcmVmZXJlbmNlXG4gICAgICAgIGNvbnN0cnVjdG9yLnBhcmVudCA9IHN1cGVycHJvdG9cbiAgICAgICAgY3Byb3RvLmNvbnN0cnVjdG9yID0gY29uc3RydWN0b3JcbiAgICB9XG5cbiAgICBpZiAoIWNvbnN0cnVjdG9yLmltcGxlbWVudCkgY29uc3RydWN0b3IuaW1wbGVtZW50ID0gaW1wbGVtZW50XG5cbiAgICB2YXIgbWl4aW5zID0gcHJvdG8ubWl4aW5cbiAgICBpZiAobWl4aW5zKXtcbiAgICAgICAgaWYgKGtpbmRPZihtaXhpbnMpICE9PSBcIkFycmF5XCIpIG1peGlucyA9IFttaXhpbnNdXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWl4aW5zLmxlbmd0aDsgaSsrKSBjb25zdHJ1Y3Rvci5pbXBsZW1lbnQoY3JlYXRlKG1peGluc1tpXS5wcm90b3R5cGUpKVxuICAgIH1cblxuICAgIC8vIGltcGxlbWVudCBwcm90byBhbmQgcmV0dXJuIGNvbnN0cnVjdG9yXG4gICAgcmV0dXJuIGNvbnN0cnVjdG9yLmltcGxlbWVudChwcm90bylcblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHByaW1lXG4iLCJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIGVwc2lsb24pe1xuXG5cdHZhciBjdXJ2ZVggPSBmdW5jdGlvbih0KXtcblx0XHR2YXIgdiA9IDEgLSB0O1xuXHRcdHJldHVybiAzICogdiAqIHYgKiB0ICogeDEgKyAzICogdiAqIHQgKiB0ICogeDIgKyB0ICogdCAqIHQ7XG5cdH07XG5cblx0dmFyIGN1cnZlWSA9IGZ1bmN0aW9uKHQpe1xuXHRcdHZhciB2ID0gMSAtIHQ7XG5cdFx0cmV0dXJuIDMgKiB2ICogdiAqIHQgKiB5MSArIDMgKiB2ICogdCAqIHQgKiB5MiArIHQgKiB0ICogdDtcblx0fTtcblxuXHR2YXIgZGVyaXZhdGl2ZUN1cnZlWCA9IGZ1bmN0aW9uKHQpe1xuXHRcdHZhciB2ID0gMSAtIHQ7XG5cdFx0cmV0dXJuIDMgKiAoMiAqICh0IC0gMSkgKiB0ICsgdiAqIHYpICogeDEgKyAzICogKC0gdCAqIHQgKiB0ICsgMiAqIHYgKiB0KSAqIHgyO1xuXHR9O1xuXG5cdHJldHVybiBmdW5jdGlvbih0KXtcblxuXHRcdHZhciB4ID0gdCwgdDAsIHQxLCB0MiwgeDIsIGQyLCBpO1xuXG5cdFx0Ly8gRmlyc3QgdHJ5IGEgZmV3IGl0ZXJhdGlvbnMgb2YgTmV3dG9uJ3MgbWV0aG9kIC0tIG5vcm1hbGx5IHZlcnkgZmFzdC5cblx0XHRmb3IgKHQyID0geCwgaSA9IDA7IGkgPCA4OyBpKyspe1xuXHRcdFx0eDIgPSBjdXJ2ZVgodDIpIC0geDtcblx0XHRcdGlmIChNYXRoLmFicyh4MikgPCBlcHNpbG9uKSByZXR1cm4gY3VydmVZKHQyKTtcblx0XHRcdGQyID0gZGVyaXZhdGl2ZUN1cnZlWCh0Mik7XG5cdFx0XHRpZiAoTWF0aC5hYnMoZDIpIDwgMWUtNikgYnJlYWs7XG5cdFx0XHR0MiA9IHQyIC0geDIgLyBkMjtcblx0XHR9XG5cblx0XHR0MCA9IDAsIHQxID0gMSwgdDIgPSB4O1xuXG5cdFx0aWYgKHQyIDwgdDApIHJldHVybiBjdXJ2ZVkodDApO1xuXHRcdGlmICh0MiA+IHQxKSByZXR1cm4gY3VydmVZKHQxKTtcblxuXHRcdC8vIEZhbGxiYWNrIHRvIHRoZSBiaXNlY3Rpb24gbWV0aG9kIGZvciByZWxpYWJpbGl0eS5cblx0XHR3aGlsZSAodDAgPCB0MSl7XG5cdFx0XHR4MiA9IGN1cnZlWCh0Mik7XG5cdFx0XHRpZiAoTWF0aC5hYnMoeDIgLSB4KSA8IGVwc2lsb24pIHJldHVybiBjdXJ2ZVkodDIpO1xuXHRcdFx0aWYgKHggPiB4MikgdDAgPSB0Mjtcblx0XHRcdGVsc2UgdDEgPSB0Mjtcblx0XHRcdHQyID0gKHQxIC0gdDApICogLjUgKyB0MDtcblx0XHR9XG5cblx0XHQvLyBGYWlsdXJlXG5cdFx0cmV0dXJuIGN1cnZlWSh0Mik7XG5cblx0fTtcblxufTtcbiIsIi8qIVxuICogZGVlcC1kaWZmLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxuICovXG47KGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxuICAgIGRlZmluZShbXSwgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZmFjdG9yeSgpO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxuICAgIC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLFxuICAgIC8vIGxpa2UgTm9kZS5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KVxuICAgIHJvb3QuRGVlcERpZmYgPSBmYWN0b3J5KCk7XG4gIH1cbn0odGhpcywgZnVuY3Rpb24odW5kZWZpbmVkKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgJHNjb3BlLCBjb25mbGljdCwgY29uZmxpY3RSZXNvbHV0aW9uID0gW107XG4gIGlmICh0eXBlb2YgZ2xvYmFsID09PSAnb2JqZWN0JyAmJiBnbG9iYWwpIHtcbiAgICAkc2NvcGUgPSBnbG9iYWw7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAkc2NvcGUgPSB3aW5kb3c7XG4gIH0gZWxzZSB7XG4gICAgJHNjb3BlID0ge307XG4gIH1cbiAgY29uZmxpY3QgPSAkc2NvcGUuRGVlcERpZmY7XG4gIGlmIChjb25mbGljdCkge1xuICAgIGNvbmZsaWN0UmVzb2x1dGlvbi5wdXNoKFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGNvbmZsaWN0ICYmICRzY29wZS5EZWVwRGlmZiA9PT0gYWNjdW11bGF0ZURpZmYpIHtcbiAgICAgICAgICAkc2NvcGUuRGVlcERpZmYgPSBjb25mbGljdDtcbiAgICAgICAgICBjb25mbGljdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICAvLyBub2RlanMgY29tcGF0aWJsZSBvbiBzZXJ2ZXIgc2lkZSBhbmQgaW4gdGhlIGJyb3dzZXIuXG4gIGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3Rvcikge1xuICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yO1xuICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7XG4gICAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgICB2YWx1ZTogY3RvcixcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIERpZmYoa2luZCwgcGF0aCkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAna2luZCcsIHtcbiAgICAgIHZhbHVlOiBraW5kLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIGlmIChwYXRoICYmIHBhdGgubGVuZ3RoKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3BhdGgnLCB7XG4gICAgICAgIHZhbHVlOiBwYXRoLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBEaWZmRWRpdChwYXRoLCBvcmlnaW4sIHZhbHVlKSB7XG4gICAgRGlmZkVkaXQuc3VwZXJfLmNhbGwodGhpcywgJ0UnLCBwYXRoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2xocycsIHtcbiAgICAgIHZhbHVlOiBvcmlnaW4sXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdyaHMnLCB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH1cbiAgaW5oZXJpdHMoRGlmZkVkaXQsIERpZmYpO1xuXG4gIGZ1bmN0aW9uIERpZmZOZXcocGF0aCwgdmFsdWUpIHtcbiAgICBEaWZmTmV3LnN1cGVyXy5jYWxsKHRoaXMsICdOJywgcGF0aCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdyaHMnLCB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH1cbiAgaW5oZXJpdHMoRGlmZk5ldywgRGlmZik7XG5cbiAgZnVuY3Rpb24gRGlmZkRlbGV0ZWQocGF0aCwgdmFsdWUpIHtcbiAgICBEaWZmRGVsZXRlZC5zdXBlcl8uY2FsbCh0aGlzLCAnRCcsIHBhdGgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbGhzJywge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9XG4gIGluaGVyaXRzKERpZmZEZWxldGVkLCBEaWZmKTtcblxuICBmdW5jdGlvbiBEaWZmQXJyYXkocGF0aCwgaW5kZXgsIGl0ZW0pIHtcbiAgICBEaWZmQXJyYXkuc3VwZXJfLmNhbGwodGhpcywgJ0EnLCBwYXRoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2luZGV4Jywge1xuICAgICAgdmFsdWU6IGluZGV4LFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnaXRlbScsIHtcbiAgICAgIHZhbHVlOiBpdGVtLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9XG4gIGluaGVyaXRzKERpZmZBcnJheSwgRGlmZik7XG5cbiAgZnVuY3Rpb24gYXJyYXlSZW1vdmUoYXJyLCBmcm9tLCB0bykge1xuICAgIHZhciByZXN0ID0gYXJyLnNsaWNlKCh0byB8fCBmcm9tKSArIDEgfHwgYXJyLmxlbmd0aCk7XG4gICAgYXJyLmxlbmd0aCA9IGZyb20gPCAwID8gYXJyLmxlbmd0aCArIGZyb20gOiBmcm9tO1xuICAgIGFyci5wdXNoLmFwcGx5KGFyciwgcmVzdCk7XG4gICAgcmV0dXJuIGFycjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWxUeXBlT2Yoc3ViamVjdCkge1xuICAgIHZhciB0eXBlID0gdHlwZW9mIHN1YmplY3Q7XG4gICAgaWYgKHR5cGUgIT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG5cbiAgICBpZiAoc3ViamVjdCA9PT0gTWF0aCkge1xuICAgICAgcmV0dXJuICdtYXRoJztcbiAgICB9IGVsc2UgaWYgKHN1YmplY3QgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiAnbnVsbCc7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHN1YmplY3QpKSB7XG4gICAgICByZXR1cm4gJ2FycmF5JztcbiAgICB9IGVsc2UgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChzdWJqZWN0KSA9PT0gJ1tvYmplY3QgRGF0ZV0nKSB7XG4gICAgICByZXR1cm4gJ2RhdGUnO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHN1YmplY3QudG9TdHJpbmcgIT09ICd1bmRlZmluZWQnICYmIC9eXFwvLipcXC8vLnRlc3Qoc3ViamVjdC50b1N0cmluZygpKSkge1xuICAgICAgcmV0dXJuICdyZWdleHAnO1xuICAgIH1cbiAgICByZXR1cm4gJ29iamVjdCc7XG4gIH1cblxuICBmdW5jdGlvbiBkZWVwRGlmZihsaHMsIHJocywgY2hhbmdlcywgcHJlZmlsdGVyLCBwYXRoLCBrZXksIHN0YWNrKSB7XG4gICAgcGF0aCA9IHBhdGggfHwgW107XG4gICAgdmFyIGN1cnJlbnRQYXRoID0gcGF0aC5zbGljZSgwKTtcbiAgICBpZiAodHlwZW9mIGtleSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmIChwcmVmaWx0ZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZihwcmVmaWx0ZXIpID09PSAnZnVuY3Rpb24nICYmIHByZWZpbHRlcihjdXJyZW50UGF0aCwga2V5KSkgeyByZXR1cm47IH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mKHByZWZpbHRlcikgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgaWYgKHByZWZpbHRlci5wcmVmaWx0ZXIgJiYgcHJlZmlsdGVyLnByZWZpbHRlcihjdXJyZW50UGF0aCwga2V5KSkgeyByZXR1cm47IH1cbiAgICAgICAgICBpZiAocHJlZmlsdGVyLm5vcm1hbGl6ZSkge1xuICAgICAgICAgICAgdmFyIGFsdCA9IHByZWZpbHRlci5ub3JtYWxpemUoY3VycmVudFBhdGgsIGtleSwgbGhzLCByaHMpO1xuICAgICAgICAgICAgaWYgKGFsdCkge1xuICAgICAgICAgICAgICBsaHMgPSBhbHRbMF07XG4gICAgICAgICAgICAgIHJocyA9IGFsdFsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGN1cnJlbnRQYXRoLnB1c2goa2V5KTtcbiAgICB9XG5cbiAgICAvLyBVc2Ugc3RyaW5nIGNvbXBhcmlzb24gZm9yIHJlZ2V4ZXNcbiAgICBpZiAocmVhbFR5cGVPZihsaHMpID09PSAncmVnZXhwJyAmJiByZWFsVHlwZU9mKHJocykgPT09ICdyZWdleHAnKSB7XG4gICAgICBsaHMgPSBsaHMudG9TdHJpbmcoKTtcbiAgICAgIHJocyA9IHJocy50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHZhciBsdHlwZSA9IHR5cGVvZiBsaHM7XG4gICAgdmFyIHJ0eXBlID0gdHlwZW9mIHJocztcbiAgICBpZiAobHR5cGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAocnR5cGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGNoYW5nZXMobmV3IERpZmZOZXcoY3VycmVudFBhdGgsIHJocykpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAocnR5cGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjaGFuZ2VzKG5ldyBEaWZmRGVsZXRlZChjdXJyZW50UGF0aCwgbGhzKSk7XG4gICAgfSBlbHNlIGlmIChyZWFsVHlwZU9mKGxocykgIT09IHJlYWxUeXBlT2YocmhzKSkge1xuICAgICAgY2hhbmdlcyhuZXcgRGlmZkVkaXQoY3VycmVudFBhdGgsIGxocywgcmhzKSk7XG4gICAgfSBlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobGhzKSA9PT0gJ1tvYmplY3QgRGF0ZV0nICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChyaHMpID09PSAnW29iamVjdCBEYXRlXScgJiYgKChsaHMgLSByaHMpICE9PSAwKSkge1xuICAgICAgY2hhbmdlcyhuZXcgRGlmZkVkaXQoY3VycmVudFBhdGgsIGxocywgcmhzKSk7XG4gICAgfSBlbHNlIGlmIChsdHlwZSA9PT0gJ29iamVjdCcgJiYgbGhzICE9PSBudWxsICYmIHJocyAhPT0gbnVsbCkge1xuICAgICAgc3RhY2sgPSBzdGFjayB8fCBbXTtcbiAgICAgIGlmIChzdGFjay5pbmRleE9mKGxocykgPCAwKSB7XG4gICAgICAgIHN0YWNrLnB1c2gobGhzKTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGhzKSkge1xuICAgICAgICAgIHZhciBpLCBsZW4gPSBsaHMubGVuZ3RoO1xuICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChpID49IHJocy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgY2hhbmdlcyhuZXcgRGlmZkFycmF5KGN1cnJlbnRQYXRoLCBpLCBuZXcgRGlmZkRlbGV0ZWQodW5kZWZpbmVkLCBsaHNbaV0pKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkZWVwRGlmZihsaHNbaV0sIHJoc1tpXSwgY2hhbmdlcywgcHJlZmlsdGVyLCBjdXJyZW50UGF0aCwgaSwgc3RhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB3aGlsZSAoaSA8IHJocy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNoYW5nZXMobmV3IERpZmZBcnJheShjdXJyZW50UGF0aCwgaSwgbmV3IERpZmZOZXcodW5kZWZpbmVkLCByaHNbaSsrXSkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIGFrZXlzID0gT2JqZWN0LmtleXMobGhzKTtcbiAgICAgICAgICB2YXIgcGtleXMgPSBPYmplY3Qua2V5cyhyaHMpO1xuICAgICAgICAgIGFrZXlzLmZvckVhY2goZnVuY3Rpb24oaywgaSkge1xuICAgICAgICAgICAgdmFyIG90aGVyID0gcGtleXMuaW5kZXhPZihrKTtcbiAgICAgICAgICAgIGlmIChvdGhlciA+PSAwKSB7XG4gICAgICAgICAgICAgIGRlZXBEaWZmKGxoc1trXSwgcmhzW2tdLCBjaGFuZ2VzLCBwcmVmaWx0ZXIsIGN1cnJlbnRQYXRoLCBrLCBzdGFjayk7XG4gICAgICAgICAgICAgIHBrZXlzID0gYXJyYXlSZW1vdmUocGtleXMsIG90aGVyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRlZXBEaWZmKGxoc1trXSwgdW5kZWZpbmVkLCBjaGFuZ2VzLCBwcmVmaWx0ZXIsIGN1cnJlbnRQYXRoLCBrLCBzdGFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcGtleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG4gICAgICAgICAgICBkZWVwRGlmZih1bmRlZmluZWQsIHJoc1trXSwgY2hhbmdlcywgcHJlZmlsdGVyLCBjdXJyZW50UGF0aCwgaywgc3RhY2spO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHN0YWNrLmxlbmd0aCA9IHN0YWNrLmxlbmd0aCAtIDE7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChsaHMgIT09IHJocykge1xuICAgICAgaWYgKCEobHR5cGUgPT09ICdudW1iZXInICYmIGlzTmFOKGxocykgJiYgaXNOYU4ocmhzKSkpIHtcbiAgICAgICAgY2hhbmdlcyhuZXcgRGlmZkVkaXQoY3VycmVudFBhdGgsIGxocywgcmhzKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYWNjdW11bGF0ZURpZmYobGhzLCByaHMsIHByZWZpbHRlciwgYWNjdW0pIHtcbiAgICBhY2N1bSA9IGFjY3VtIHx8IFtdO1xuICAgIGRlZXBEaWZmKGxocywgcmhzLFxuICAgICAgZnVuY3Rpb24oZGlmZikge1xuICAgICAgICBpZiAoZGlmZikge1xuICAgICAgICAgIGFjY3VtLnB1c2goZGlmZik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwcmVmaWx0ZXIpO1xuICAgIHJldHVybiAoYWNjdW0ubGVuZ3RoKSA/IGFjY3VtIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgZnVuY3Rpb24gYXBwbHlBcnJheUNoYW5nZShhcnIsIGluZGV4LCBjaGFuZ2UpIHtcbiAgICBpZiAoY2hhbmdlLnBhdGggJiYgY2hhbmdlLnBhdGgubGVuZ3RoKSB7XG4gICAgICB2YXIgaXQgPSBhcnJbaW5kZXhdLFxuICAgICAgICAgIGksIHUgPSBjaGFuZ2UucGF0aC5sZW5ndGggLSAxO1xuICAgICAgZm9yIChpID0gMDsgaSA8IHU7IGkrKykge1xuICAgICAgICBpdCA9IGl0W2NoYW5nZS5wYXRoW2ldXTtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAoY2hhbmdlLmtpbmQpIHtcbiAgICAgICAgY2FzZSAnQSc6XG4gICAgICAgICAgYXBwbHlBcnJheUNoYW5nZShpdFtjaGFuZ2UucGF0aFtpXV0sIGNoYW5nZS5pbmRleCwgY2hhbmdlLml0ZW0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdEJzpcbiAgICAgICAgICBkZWxldGUgaXRbY2hhbmdlLnBhdGhbaV1dO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdFJzpcbiAgICAgICAgY2FzZSAnTic6XG4gICAgICAgICAgaXRbY2hhbmdlLnBhdGhbaV1dID0gY2hhbmdlLnJocztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3dpdGNoIChjaGFuZ2Uua2luZCkge1xuICAgICAgICBjYXNlICdBJzpcbiAgICAgICAgICBhcHBseUFycmF5Q2hhbmdlKGFycltpbmRleF0sIGNoYW5nZS5pbmRleCwgY2hhbmdlLml0ZW0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdEJzpcbiAgICAgICAgICBhcnIgPSBhcnJheVJlbW92ZShhcnIsIGluZGV4KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnRSc6XG4gICAgICAgIGNhc2UgJ04nOlxuICAgICAgICAgIGFycltpbmRleF0gPSBjaGFuZ2UucmhzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXJyO1xuICB9XG5cbiAgZnVuY3Rpb24gYXBwbHlDaGFuZ2UodGFyZ2V0LCBzb3VyY2UsIGNoYW5nZSkge1xuICAgIGlmICh0YXJnZXQgJiYgc291cmNlICYmIGNoYW5nZSAmJiBjaGFuZ2Uua2luZCkge1xuICAgICAgdmFyIGl0ID0gdGFyZ2V0LFxuICAgICAgICAgIGkgPSAtMSxcbiAgICAgICAgICBsYXN0ID0gY2hhbmdlLnBhdGggPyBjaGFuZ2UucGF0aC5sZW5ndGggLSAxIDogMDtcbiAgICAgIHdoaWxlICgrK2kgPCBsYXN0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgaXRbY2hhbmdlLnBhdGhbaV1dID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGl0W2NoYW5nZS5wYXRoW2ldXSA9ICh0eXBlb2YgY2hhbmdlLnBhdGhbaV0gPT09ICdudW1iZXInKSA/IFtdIDoge307XG4gICAgICAgIH1cbiAgICAgICAgaXQgPSBpdFtjaGFuZ2UucGF0aFtpXV07XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKGNoYW5nZS5raW5kKSB7XG4gICAgICAgIGNhc2UgJ0EnOlxuICAgICAgICAgIGFwcGx5QXJyYXlDaGFuZ2UoY2hhbmdlLnBhdGggPyBpdFtjaGFuZ2UucGF0aFtpXV0gOiBpdCwgY2hhbmdlLmluZGV4LCBjaGFuZ2UuaXRlbSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0QnOlxuICAgICAgICAgIGRlbGV0ZSBpdFtjaGFuZ2UucGF0aFtpXV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0UnOlxuICAgICAgICBjYXNlICdOJzpcbiAgICAgICAgICBpdFtjaGFuZ2UucGF0aFtpXV0gPSBjaGFuZ2UucmhzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJldmVydEFycmF5Q2hhbmdlKGFyciwgaW5kZXgsIGNoYW5nZSkge1xuICAgIGlmIChjaGFuZ2UucGF0aCAmJiBjaGFuZ2UucGF0aC5sZW5ndGgpIHtcbiAgICAgIC8vIHRoZSBzdHJ1Y3R1cmUgb2YgdGhlIG9iamVjdCBhdCB0aGUgaW5kZXggaGFzIGNoYW5nZWQuLi5cbiAgICAgIHZhciBpdCA9IGFycltpbmRleF0sXG4gICAgICAgICAgaSwgdSA9IGNoYW5nZS5wYXRoLmxlbmd0aCAtIDE7XG4gICAgICBmb3IgKGkgPSAwOyBpIDwgdTsgaSsrKSB7XG4gICAgICAgIGl0ID0gaXRbY2hhbmdlLnBhdGhbaV1dO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChjaGFuZ2Uua2luZCkge1xuICAgICAgICBjYXNlICdBJzpcbiAgICAgICAgICByZXZlcnRBcnJheUNoYW5nZShpdFtjaGFuZ2UucGF0aFtpXV0sIGNoYW5nZS5pbmRleCwgY2hhbmdlLml0ZW0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdEJzpcbiAgICAgICAgICBpdFtjaGFuZ2UucGF0aFtpXV0gPSBjaGFuZ2UubGhzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdFJzpcbiAgICAgICAgICBpdFtjaGFuZ2UucGF0aFtpXV0gPSBjaGFuZ2UubGhzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdOJzpcbiAgICAgICAgICBkZWxldGUgaXRbY2hhbmdlLnBhdGhbaV1dO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0aGUgYXJyYXkgaXRlbSBpcyBkaWZmZXJlbnQuLi5cbiAgICAgIHN3aXRjaCAoY2hhbmdlLmtpbmQpIHtcbiAgICAgICAgY2FzZSAnQSc6XG4gICAgICAgICAgcmV2ZXJ0QXJyYXlDaGFuZ2UoYXJyW2luZGV4XSwgY2hhbmdlLmluZGV4LCBjaGFuZ2UuaXRlbSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0QnOlxuICAgICAgICAgIGFycltpbmRleF0gPSBjaGFuZ2UubGhzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdFJzpcbiAgICAgICAgICBhcnJbaW5kZXhdID0gY2hhbmdlLmxocztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnTic6XG4gICAgICAgICAgYXJyID0gYXJyYXlSZW1vdmUoYXJyLCBpbmRleCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH1cblxuICBmdW5jdGlvbiByZXZlcnRDaGFuZ2UodGFyZ2V0LCBzb3VyY2UsIGNoYW5nZSkge1xuICAgIGlmICh0YXJnZXQgJiYgc291cmNlICYmIGNoYW5nZSAmJiBjaGFuZ2Uua2luZCkge1xuICAgICAgdmFyIGl0ID0gdGFyZ2V0LFxuICAgICAgICAgIGksIHU7XG4gICAgICB1ID0gY2hhbmdlLnBhdGgubGVuZ3RoIC0gMTtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCB1OyBpKyspIHtcbiAgICAgICAgaWYgKHR5cGVvZiBpdFtjaGFuZ2UucGF0aFtpXV0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgaXRbY2hhbmdlLnBhdGhbaV1dID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaXQgPSBpdFtjaGFuZ2UucGF0aFtpXV07XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKGNoYW5nZS5raW5kKSB7XG4gICAgICAgIGNhc2UgJ0EnOlxuICAgICAgICAgIC8vIEFycmF5IHdhcyBtb2RpZmllZC4uLlxuICAgICAgICAgIC8vIGl0IHdpbGwgYmUgYW4gYXJyYXkuLi5cbiAgICAgICAgICByZXZlcnRBcnJheUNoYW5nZShpdFtjaGFuZ2UucGF0aFtpXV0sIGNoYW5nZS5pbmRleCwgY2hhbmdlLml0ZW0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdEJzpcbiAgICAgICAgICAvLyBJdGVtIHdhcyBkZWxldGVkLi4uXG4gICAgICAgICAgaXRbY2hhbmdlLnBhdGhbaV1dID0gY2hhbmdlLmxocztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnRSc6XG4gICAgICAgICAgLy8gSXRlbSB3YXMgZWRpdGVkLi4uXG4gICAgICAgICAgaXRbY2hhbmdlLnBhdGhbaV1dID0gY2hhbmdlLmxocztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnTic6XG4gICAgICAgICAgLy8gSXRlbSBpcyBuZXcuLi5cbiAgICAgICAgICBkZWxldGUgaXRbY2hhbmdlLnBhdGhbaV1dO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFwcGx5RGlmZih0YXJnZXQsIHNvdXJjZSwgZmlsdGVyKSB7XG4gICAgaWYgKHRhcmdldCAmJiBzb3VyY2UpIHtcbiAgICAgIHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKGNoYW5nZSkge1xuICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIodGFyZ2V0LCBzb3VyY2UsIGNoYW5nZSkpIHtcbiAgICAgICAgICBhcHBseUNoYW5nZSh0YXJnZXQsIHNvdXJjZSwgY2hhbmdlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGRlZXBEaWZmKHRhcmdldCwgc291cmNlLCBvbkNoYW5nZSk7XG4gICAgfVxuICB9XG5cbiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYWNjdW11bGF0ZURpZmYsIHtcblxuICAgIGRpZmY6IHtcbiAgICAgIHZhbHVlOiBhY2N1bXVsYXRlRGlmZixcbiAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9LFxuICAgIG9ic2VydmFibGVEaWZmOiB7XG4gICAgICB2YWx1ZTogZGVlcERpZmYsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSxcbiAgICBhcHBseURpZmY6IHtcbiAgICAgIHZhbHVlOiBhcHBseURpZmYsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSxcbiAgICBhcHBseUNoYW5nZToge1xuICAgICAgdmFsdWU6IGFwcGx5Q2hhbmdlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0sXG4gICAgcmV2ZXJ0Q2hhbmdlOiB7XG4gICAgICB2YWx1ZTogcmV2ZXJ0Q2hhbmdlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0sXG4gICAgaXNDb25mbGljdDoge1xuICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBjb25mbGljdDtcbiAgICAgIH0sXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSxcbiAgICBub0NvbmZsaWN0OiB7XG4gICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjb25mbGljdFJlc29sdXRpb24pIHtcbiAgICAgICAgICBjb25mbGljdFJlc29sdXRpb24uZm9yRWFjaChmdW5jdGlvbihpdCkge1xuICAgICAgICAgICAgaXQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25mbGljdFJlc29sdXRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2N1bXVsYXRlRGlmZjtcbiAgICAgIH0sXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gYWNjdW11bGF0ZURpZmY7XG59KSk7XG4iLCJcbi8qXG4gKlxuICogTW9yZSBpbmZvIGF0IFt3d3cuZHJvcHpvbmVqcy5jb21dKGh0dHA6Ly93d3cuZHJvcHpvbmVqcy5jb20pXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEyLCBNYXRpYXMgTWVub1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gKiBUSEUgU09GVFdBUkUuXG4gKlxuICovXG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIERyb3B6b25lLCBFbWl0dGVyLCBjYW1lbGl6ZSwgY29udGVudExvYWRlZCwgZGV0ZWN0VmVydGljYWxTcXVhc2gsIGRyYXdJbWFnZUlPU0ZpeCwgbm9vcCwgd2l0aG91dCxcbiAgICBfX3NsaWNlID0gW10uc2xpY2UsXG4gICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbiAgbm9vcCA9IGZ1bmN0aW9uKCkge307XG5cbiAgRW1pdHRlciA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBFbWl0dGVyKCkge31cblxuICAgIEVtaXR0ZXIucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBFbWl0dGVyLnByb3RvdHlwZS5vbjtcblxuICAgIEVtaXR0ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oZXZlbnQsIGZuKSB7XG4gICAgICB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge307XG4gICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudF0pIHtcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50XSA9IFtdO1xuICAgICAgfVxuICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50XS5wdXNoKGZuKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYXJncywgY2FsbGJhY2ssIGNhbGxiYWNrcywgZXZlbnQsIF9pLCBfbGVuO1xuICAgICAgZXZlbnQgPSBhcmd1bWVudHNbMF0sIGFyZ3MgPSAyIDw9IGFyZ3VtZW50cy5sZW5ndGggPyBfX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSA6IFtdO1xuICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9O1xuICAgICAgY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzW2V2ZW50XTtcbiAgICAgIGlmIChjYWxsYmFja3MpIHtcbiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBjYWxsYmFja3MubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrc1tfaV07XG4gICAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IEVtaXR0ZXIucHJvdG90eXBlLm9mZjtcblxuICAgIEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IEVtaXR0ZXIucHJvdG90eXBlLm9mZjtcblxuICAgIEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBFbWl0dGVyLnByb3RvdHlwZS5vZmY7XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihldmVudCwgZm4pIHtcbiAgICAgIHZhciBjYWxsYmFjaywgY2FsbGJhY2tzLCBpLCBfaSwgX2xlbjtcbiAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0ge307XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzW2V2ZW50XTtcbiAgICAgIGlmICghY2FsbGJhY2tzKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc1tldmVudF07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgZm9yIChpID0gX2kgPSAwLCBfbGVuID0gY2FsbGJhY2tzLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrc1tpXTtcbiAgICAgICAgaWYgKGNhbGxiYWNrID09PSBmbikge1xuICAgICAgICAgIGNhbGxiYWNrcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICByZXR1cm4gRW1pdHRlcjtcblxuICB9KSgpO1xuXG4gIERyb3B6b25lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICAgIHZhciBleHRlbmQsIHJlc29sdmVPcHRpb247XG5cbiAgICBfX2V4dGVuZHMoRHJvcHpvbmUsIF9zdXBlcik7XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuRW1pdHRlciA9IEVtaXR0ZXI7XG5cblxuICAgIC8qXG4gICAgVGhpcyBpcyBhIGxpc3Qgb2YgYWxsIGF2YWlsYWJsZSBldmVudHMgeW91IGNhbiByZWdpc3RlciBvbiBhIGRyb3B6b25lIG9iamVjdC5cbiAgICBcbiAgICBZb3UgY2FuIHJlZ2lzdGVyIGFuIGV2ZW50IGhhbmRsZXIgbGlrZSB0aGlzOlxuICAgIFxuICAgICAgICBkcm9wem9uZS5vbihcImRyYWdFbnRlclwiLCBmdW5jdGlvbigpIHsgfSk7XG4gICAgICovXG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZXZlbnRzID0gW1wiZHJvcFwiLCBcImRyYWdzdGFydFwiLCBcImRyYWdlbmRcIiwgXCJkcmFnZW50ZXJcIiwgXCJkcmFnb3ZlclwiLCBcImRyYWdsZWF2ZVwiLCBcImFkZGVkZmlsZVwiLCBcImFkZGVkZmlsZXNcIiwgXCJyZW1vdmVkZmlsZVwiLCBcInRodW1ibmFpbFwiLCBcImVycm9yXCIsIFwiZXJyb3JtdWx0aXBsZVwiLCBcInByb2Nlc3NpbmdcIiwgXCJwcm9jZXNzaW5nbXVsdGlwbGVcIiwgXCJ1cGxvYWRwcm9ncmVzc1wiLCBcInRvdGFsdXBsb2FkcHJvZ3Jlc3NcIiwgXCJzZW5kaW5nXCIsIFwic2VuZGluZ211bHRpcGxlXCIsIFwic3VjY2Vzc1wiLCBcInN1Y2Nlc3NtdWx0aXBsZVwiLCBcImNhbmNlbGVkXCIsIFwiY2FuY2VsZWRtdWx0aXBsZVwiLCBcImNvbXBsZXRlXCIsIFwiY29tcGxldGVtdWx0aXBsZVwiLCBcInJlc2V0XCIsIFwibWF4ZmlsZXNleGNlZWRlZFwiLCBcIm1heGZpbGVzcmVhY2hlZFwiLCBcInF1ZXVlY29tcGxldGVcIl07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICB1cmw6IG51bGwsXG4gICAgICBtZXRob2Q6IFwicG9zdFwiLFxuICAgICAgd2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcbiAgICAgIHBhcmFsbGVsVXBsb2FkczogMixcbiAgICAgIHVwbG9hZE11bHRpcGxlOiBmYWxzZSxcbiAgICAgIG1heEZpbGVzaXplOiAyNTYsXG4gICAgICBwYXJhbU5hbWU6IFwiZmlsZVwiLFxuICAgICAgY3JlYXRlSW1hZ2VUaHVtYm5haWxzOiB0cnVlLFxuICAgICAgbWF4VGh1bWJuYWlsRmlsZXNpemU6IDEwLFxuICAgICAgdGh1bWJuYWlsV2lkdGg6IDEyMCxcbiAgICAgIHRodW1ibmFpbEhlaWdodDogMTIwLFxuICAgICAgZmlsZXNpemVCYXNlOiAxMDAwLFxuICAgICAgbWF4RmlsZXM6IG51bGwsXG4gICAgICBwYXJhbXM6IHt9LFxuICAgICAgY2xpY2thYmxlOiB0cnVlLFxuICAgICAgaWdub3JlSGlkZGVuRmlsZXM6IHRydWUsXG4gICAgICBhY2NlcHRlZEZpbGVzOiBudWxsLFxuICAgICAgYWNjZXB0ZWRNaW1lVHlwZXM6IG51bGwsXG4gICAgICBhdXRvUHJvY2Vzc1F1ZXVlOiB0cnVlLFxuICAgICAgYXV0b1F1ZXVlOiB0cnVlLFxuICAgICAgYWRkUmVtb3ZlTGlua3M6IGZhbHNlLFxuICAgICAgcHJldmlld3NDb250YWluZXI6IG51bGwsXG4gICAgICBoaWRkZW5JbnB1dENvbnRhaW5lcjogXCJib2R5XCIsXG4gICAgICBjYXB0dXJlOiBudWxsLFxuICAgICAgcmVuYW1lRmlsZW5hbWU6IG51bGwsXG4gICAgICBkaWN0RGVmYXVsdE1lc3NhZ2U6IFwiRHJvcCBmaWxlcyBoZXJlIHRvIHVwbG9hZFwiLFxuICAgICAgZGljdEZhbGxiYWNrTWVzc2FnZTogXCJZb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBkcmFnJ24nZHJvcCBmaWxlIHVwbG9hZHMuXCIsXG4gICAgICBkaWN0RmFsbGJhY2tUZXh0OiBcIlBsZWFzZSB1c2UgdGhlIGZhbGxiYWNrIGZvcm0gYmVsb3cgdG8gdXBsb2FkIHlvdXIgZmlsZXMgbGlrZSBpbiB0aGUgb2xkZW4gZGF5cy5cIixcbiAgICAgIGRpY3RGaWxlVG9vQmlnOiBcIkZpbGUgaXMgdG9vIGJpZyAoe3tmaWxlc2l6ZX19TWlCKS4gTWF4IGZpbGVzaXplOiB7e21heEZpbGVzaXplfX1NaUIuXCIsXG4gICAgICBkaWN0SW52YWxpZEZpbGVUeXBlOiBcIllvdSBjYW4ndCB1cGxvYWQgZmlsZXMgb2YgdGhpcyB0eXBlLlwiLFxuICAgICAgZGljdFJlc3BvbnNlRXJyb3I6IFwiU2VydmVyIHJlc3BvbmRlZCB3aXRoIHt7c3RhdHVzQ29kZX19IGNvZGUuXCIsXG4gICAgICBkaWN0Q2FuY2VsVXBsb2FkOiBcIkNhbmNlbCB1cGxvYWRcIixcbiAgICAgIGRpY3RDYW5jZWxVcGxvYWRDb25maXJtYXRpb246IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNhbmNlbCB0aGlzIHVwbG9hZD9cIixcbiAgICAgIGRpY3RSZW1vdmVGaWxlOiBcIlJlbW92ZSBmaWxlXCIsXG4gICAgICBkaWN0UmVtb3ZlRmlsZUNvbmZpcm1hdGlvbjogbnVsbCxcbiAgICAgIGRpY3RNYXhGaWxlc0V4Y2VlZGVkOiBcIllvdSBjYW4gbm90IHVwbG9hZCBhbnkgbW9yZSBmaWxlcy5cIixcbiAgICAgIGFjY2VwdDogZnVuY3Rpb24oZmlsZSwgZG9uZSkge1xuICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgfSxcbiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbm9vcDtcbiAgICAgIH0sXG4gICAgICBmb3JjZUZhbGxiYWNrOiBmYWxzZSxcbiAgICAgIGZhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNoaWxkLCBtZXNzYWdlRWxlbWVudCwgc3BhbiwgX2ksIF9sZW4sIF9yZWY7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc05hbWUgPSBcIlwiICsgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSArIFwiIGR6LWJyb3dzZXItbm90LXN1cHBvcnRlZFwiO1xuICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBjaGlsZCA9IF9yZWZbX2ldO1xuICAgICAgICAgIGlmICgvKF58IClkei1tZXNzYWdlKCR8ICkvLnRlc3QoY2hpbGQuY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgbWVzc2FnZUVsZW1lbnQgPSBjaGlsZDtcbiAgICAgICAgICAgIGNoaWxkLmNsYXNzTmFtZSA9IFwiZHotbWVzc2FnZVwiO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghbWVzc2FnZUVsZW1lbnQpIHtcbiAgICAgICAgICBtZXNzYWdlRWxlbWVudCA9IERyb3B6b25lLmNyZWF0ZUVsZW1lbnQoXCI8ZGl2IGNsYXNzPVxcXCJkei1tZXNzYWdlXFxcIj48c3Bhbj48L3NwYW4+PC9kaXY+XCIpO1xuICAgICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChtZXNzYWdlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgc3BhbiA9IG1lc3NhZ2VFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3BhblwiKVswXTtcbiAgICAgICAgaWYgKHNwYW4pIHtcbiAgICAgICAgICBpZiAoc3Bhbi50ZXh0Q29udGVudCAhPSBudWxsKSB7XG4gICAgICAgICAgICBzcGFuLnRleHRDb250ZW50ID0gdGhpcy5vcHRpb25zLmRpY3RGYWxsYmFja01lc3NhZ2U7XG4gICAgICAgICAgfSBlbHNlIGlmIChzcGFuLmlubmVyVGV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICBzcGFuLmlubmVyVGV4dCA9IHRoaXMub3B0aW9ucy5kaWN0RmFsbGJhY2tNZXNzYWdlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZ2V0RmFsbGJhY2tGb3JtKCkpO1xuICAgICAgfSxcbiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICB2YXIgaW5mbywgc3JjUmF0aW8sIHRyZ1JhdGlvO1xuICAgICAgICBpbmZvID0ge1xuICAgICAgICAgIHNyY1g6IDAsXG4gICAgICAgICAgc3JjWTogMCxcbiAgICAgICAgICBzcmNXaWR0aDogZmlsZS53aWR0aCxcbiAgICAgICAgICBzcmNIZWlnaHQ6IGZpbGUuaGVpZ2h0XG4gICAgICAgIH07XG4gICAgICAgIHNyY1JhdGlvID0gZmlsZS53aWR0aCAvIGZpbGUuaGVpZ2h0O1xuICAgICAgICBpbmZvLm9wdFdpZHRoID0gdGhpcy5vcHRpb25zLnRodW1ibmFpbFdpZHRoO1xuICAgICAgICBpbmZvLm9wdEhlaWdodCA9IHRoaXMub3B0aW9ucy50aHVtYm5haWxIZWlnaHQ7XG4gICAgICAgIGlmICgoaW5mby5vcHRXaWR0aCA9PSBudWxsKSAmJiAoaW5mby5vcHRIZWlnaHQgPT0gbnVsbCkpIHtcbiAgICAgICAgICBpbmZvLm9wdFdpZHRoID0gaW5mby5zcmNXaWR0aDtcbiAgICAgICAgICBpbmZvLm9wdEhlaWdodCA9IGluZm8uc3JjSGVpZ2h0O1xuICAgICAgICB9IGVsc2UgaWYgKGluZm8ub3B0V2lkdGggPT0gbnVsbCkge1xuICAgICAgICAgIGluZm8ub3B0V2lkdGggPSBzcmNSYXRpbyAqIGluZm8ub3B0SGVpZ2h0O1xuICAgICAgICB9IGVsc2UgaWYgKGluZm8ub3B0SGVpZ2h0ID09IG51bGwpIHtcbiAgICAgICAgICBpbmZvLm9wdEhlaWdodCA9ICgxIC8gc3JjUmF0aW8pICogaW5mby5vcHRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICB0cmdSYXRpbyA9IGluZm8ub3B0V2lkdGggLyBpbmZvLm9wdEhlaWdodDtcbiAgICAgICAgaWYgKGZpbGUuaGVpZ2h0IDwgaW5mby5vcHRIZWlnaHQgfHwgZmlsZS53aWR0aCA8IGluZm8ub3B0V2lkdGgpIHtcbiAgICAgICAgICBpbmZvLnRyZ0hlaWdodCA9IGluZm8uc3JjSGVpZ2h0O1xuICAgICAgICAgIGluZm8udHJnV2lkdGggPSBpbmZvLnNyY1dpZHRoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzcmNSYXRpbyA+IHRyZ1JhdGlvKSB7XG4gICAgICAgICAgICBpbmZvLnNyY0hlaWdodCA9IGZpbGUuaGVpZ2h0O1xuICAgICAgICAgICAgaW5mby5zcmNXaWR0aCA9IGluZm8uc3JjSGVpZ2h0ICogdHJnUmF0aW87XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGluZm8uc3JjV2lkdGggPSBmaWxlLndpZHRoO1xuICAgICAgICAgICAgaW5mby5zcmNIZWlnaHQgPSBpbmZvLnNyY1dpZHRoIC8gdHJnUmF0aW87XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGluZm8uc3JjWCA9IChmaWxlLndpZHRoIC0gaW5mby5zcmNXaWR0aCkgLyAyO1xuICAgICAgICBpbmZvLnNyY1kgPSAoZmlsZS5oZWlnaHQgLSBpbmZvLnNyY0hlaWdodCkgLyAyO1xuICAgICAgICByZXR1cm4gaW5mbztcbiAgICAgIH0sXG5cbiAgICAgIC8qXG4gICAgICBUaG9zZSBmdW5jdGlvbnMgcmVnaXN0ZXIgdGhlbXNlbHZlcyB0byB0aGUgZXZlbnRzIG9uIGluaXQgYW5kIGhhbmRsZSBhbGxcbiAgICAgIHRoZSB1c2VyIGludGVyZmFjZSBzcGVjaWZpYyBzdHVmZi4gT3ZlcndyaXRpbmcgdGhlbSB3b24ndCBicmVhayB0aGUgdXBsb2FkXG4gICAgICBidXQgY2FuIGJyZWFrIHRoZSB3YXkgaXQncyBkaXNwbGF5ZWQuXG4gICAgICBZb3UgY2FuIG92ZXJ3cml0ZSB0aGVtIGlmIHlvdSBkb24ndCBsaWtlIHRoZSBkZWZhdWx0IGJlaGF2aW9yLiBJZiB5b3UganVzdFxuICAgICAgd2FudCB0byBhZGQgYW4gYWRkaXRpb25hbCBldmVudCBoYW5kbGVyLCByZWdpc3RlciBpdCBvbiB0aGUgZHJvcHpvbmUgb2JqZWN0XG4gICAgICBhbmQgZG9uJ3Qgb3ZlcndyaXRlIHRob3NlIG9wdGlvbnMuXG4gICAgICAgKi9cbiAgICAgIGRyb3A6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHotZHJhZy1ob3ZlclwiKTtcbiAgICAgIH0sXG4gICAgICBkcmFnc3RhcnQ6IG5vb3AsXG4gICAgICBkcmFnZW5kOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImR6LWRyYWctaG92ZXJcIik7XG4gICAgICB9LFxuICAgICAgZHJhZ2VudGVyOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImR6LWRyYWctaG92ZXJcIik7XG4gICAgICB9LFxuICAgICAgZHJhZ292ZXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotZHJhZy1ob3ZlclwiKTtcbiAgICAgIH0sXG4gICAgICBkcmFnbGVhdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHotZHJhZy1ob3ZlclwiKTtcbiAgICAgIH0sXG4gICAgICBwYXN0ZTogbm9vcCxcbiAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHotc3RhcnRlZFwiKTtcbiAgICAgIH0sXG4gICAgICBhZGRlZGZpbGU6IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgdmFyIG5vZGUsIHJlbW92ZUZpbGVFdmVudCwgcmVtb3ZlTGluaywgX2ksIF9qLCBfaywgX2xlbiwgX2xlbjEsIF9sZW4yLCBfcmVmLCBfcmVmMSwgX3JlZjIsIF9yZXN1bHRzO1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50ID09PSB0aGlzLnByZXZpZXdzQ29udGFpbmVyKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1zdGFydGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByZXZpZXdzQ29udGFpbmVyKSB7XG4gICAgICAgICAgZmlsZS5wcmV2aWV3RWxlbWVudCA9IERyb3B6b25lLmNyZWF0ZUVsZW1lbnQodGhpcy5vcHRpb25zLnByZXZpZXdUZW1wbGF0ZS50cmltKCkpO1xuICAgICAgICAgIGZpbGUucHJldmlld1RlbXBsYXRlID0gZmlsZS5wcmV2aWV3RWxlbWVudDtcbiAgICAgICAgICB0aGlzLnByZXZpZXdzQ29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGUucHJldmlld0VsZW1lbnQpO1xuICAgICAgICAgIF9yZWYgPSBmaWxlLnByZXZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1kei1uYW1lXVwiKTtcbiAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgIG5vZGUgPSBfcmVmW19pXTtcbiAgICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB0aGlzLl9yZW5hbWVGaWxlbmFtZShmaWxlLm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfcmVmMSA9IGZpbGUucHJldmlld0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWR6LXNpemVdXCIpO1xuICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykge1xuICAgICAgICAgICAgbm9kZSA9IF9yZWYxW19qXTtcbiAgICAgICAgICAgIG5vZGUuaW5uZXJIVE1MID0gdGhpcy5maWxlc2l6ZShmaWxlLnNpemUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmFkZFJlbW92ZUxpbmtzKSB7XG4gICAgICAgICAgICBmaWxlLl9yZW1vdmVMaW5rID0gRHJvcHpvbmUuY3JlYXRlRWxlbWVudChcIjxhIGNsYXNzPVxcXCJkei1yZW1vdmVcXFwiIGhyZWY9XFxcImphdmFzY3JpcHQ6dW5kZWZpbmVkO1xcXCIgZGF0YS1kei1yZW1vdmU+XCIgKyB0aGlzLm9wdGlvbnMuZGljdFJlbW92ZUZpbGUgKyBcIjwvYT5cIik7XG4gICAgICAgICAgICBmaWxlLnByZXZpZXdFbGVtZW50LmFwcGVuZENoaWxkKGZpbGUuX3JlbW92ZUxpbmspO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZW1vdmVGaWxlRXZlbnQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5VUExPQURJTkcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gRHJvcHpvbmUuY29uZmlybShfdGhpcy5vcHRpb25zLmRpY3RDYW5jZWxVcGxvYWRDb25maXJtYXRpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuZGljdFJlbW92ZUZpbGVDb25maXJtYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBEcm9wem9uZS5jb25maXJtKF90aGlzLm9wdGlvbnMuZGljdFJlbW92ZUZpbGVDb25maXJtYXRpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucmVtb3ZlRmlsZShmaWxlKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucmVtb3ZlRmlsZShmaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkodGhpcyk7XG4gICAgICAgICAgX3JlZjIgPSBmaWxlLnByZXZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1kei1yZW1vdmVdXCIpO1xuICAgICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgICAgZm9yIChfayA9IDAsIF9sZW4yID0gX3JlZjIubGVuZ3RoOyBfayA8IF9sZW4yOyBfaysrKSB7XG4gICAgICAgICAgICByZW1vdmVMaW5rID0gX3JlZjJbX2tdO1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChyZW1vdmVMaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCByZW1vdmVGaWxlRXZlbnQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVtb3ZlZGZpbGU6IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgdmFyIF9yZWY7XG4gICAgICAgIGlmIChmaWxlLnByZXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgaWYgKChfcmVmID0gZmlsZS5wcmV2aWV3RWxlbWVudCkgIT0gbnVsbCkge1xuICAgICAgICAgICAgX3JlZi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZpbGUucHJldmlld0VsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlTWF4RmlsZXNSZWFjaGVkQ2xhc3MoKTtcbiAgICAgIH0sXG4gICAgICB0aHVtYm5haWw6IGZ1bmN0aW9uKGZpbGUsIGRhdGFVcmwpIHtcbiAgICAgICAgdmFyIHRodW1ibmFpbEVsZW1lbnQsIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgICBpZiAoZmlsZS5wcmV2aWV3RWxlbWVudCkge1xuICAgICAgICAgIGZpbGUucHJldmlld0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImR6LWZpbGUtcHJldmlld1wiKTtcbiAgICAgICAgICBfcmVmID0gZmlsZS5wcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtZHotdGh1bWJuYWlsXVwiKTtcbiAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgIHRodW1ibmFpbEVsZW1lbnQgPSBfcmVmW19pXTtcbiAgICAgICAgICAgIHRodW1ibmFpbEVsZW1lbnQuYWx0ID0gZmlsZS5uYW1lO1xuICAgICAgICAgICAgdGh1bWJuYWlsRWxlbWVudC5zcmMgPSBkYXRhVXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmaWxlLnByZXZpZXdFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1pbWFnZS1wcmV2aWV3XCIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSh0aGlzKSksIDEpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGZpbGUsIG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG5vZGUsIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgICAgaWYgKGZpbGUucHJldmlld0VsZW1lbnQpIHtcbiAgICAgICAgICBmaWxlLnByZXZpZXdFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1lcnJvclwiKTtcbiAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwiU3RyaW5nXCIgJiYgbWVzc2FnZS5lcnJvcikge1xuICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UuZXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICAgIF9yZWYgPSBmaWxlLnByZXZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1kei1lcnJvcm1lc3NhZ2VdXCIpO1xuICAgICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICBub2RlID0gX3JlZltfaV07XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG5vZGUudGV4dENvbnRlbnQgPSBtZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3JtdWx0aXBsZTogbm9vcCxcbiAgICAgIHByb2Nlc3Npbmc6IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgaWYgKGZpbGUucHJldmlld0VsZW1lbnQpIHtcbiAgICAgICAgICBmaWxlLnByZXZpZXdFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1wcm9jZXNzaW5nXCIpO1xuICAgICAgICAgIGlmIChmaWxlLl9yZW1vdmVMaW5rKSB7XG4gICAgICAgICAgICByZXR1cm4gZmlsZS5fcmVtb3ZlTGluay50ZXh0Q29udGVudCA9IHRoaXMub3B0aW9ucy5kaWN0Q2FuY2VsVXBsb2FkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHByb2Nlc3NpbmdtdWx0aXBsZTogbm9vcCxcbiAgICAgIHVwbG9hZHByb2dyZXNzOiBmdW5jdGlvbihmaWxlLCBwcm9ncmVzcywgYnl0ZXNTZW50KSB7XG4gICAgICAgIHZhciBub2RlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgIGlmIChmaWxlLnByZXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgX3JlZiA9IGZpbGUucHJldmlld0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWR6LXVwbG9hZHByb2dyZXNzXVwiKTtcbiAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgbm9kZSA9IF9yZWZbX2ldO1xuICAgICAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICdQUk9HUkVTUycpIHtcbiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChub2RlLnZhbHVlID0gcHJvZ3Jlc3MpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChub2RlLnN0eWxlLndpZHRoID0gXCJcIiArIHByb2dyZXNzICsgXCIlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0b3RhbHVwbG9hZHByb2dyZXNzOiBub29wLFxuICAgICAgc2VuZGluZzogbm9vcCxcbiAgICAgIHNlbmRpbmdtdWx0aXBsZTogbm9vcCxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgaWYgKGZpbGUucHJldmlld0VsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gZmlsZS5wcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotc3VjY2Vzc1wiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3NtdWx0aXBsZTogbm9vcCxcbiAgICAgIGNhbmNlbGVkOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoXCJlcnJvclwiLCBmaWxlLCBcIlVwbG9hZCBjYW5jZWxlZC5cIik7XG4gICAgICB9LFxuICAgICAgY2FuY2VsZWRtdWx0aXBsZTogbm9vcCxcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIGlmIChmaWxlLl9yZW1vdmVMaW5rKSB7XG4gICAgICAgICAgZmlsZS5fcmVtb3ZlTGluay50ZXh0Q29udGVudCA9IHRoaXMub3B0aW9ucy5kaWN0UmVtb3ZlRmlsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsZS5wcmV2aWV3RWxlbWVudCkge1xuICAgICAgICAgIHJldHVybiBmaWxlLnByZXZpZXdFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1jb21wbGV0ZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlbXVsdGlwbGU6IG5vb3AsXG4gICAgICBtYXhmaWxlc2V4Y2VlZGVkOiBub29wLFxuICAgICAgbWF4ZmlsZXNyZWFjaGVkOiBub29wLFxuICAgICAgcXVldWVjb21wbGV0ZTogbm9vcCxcbiAgICAgIGFkZGVkZmlsZXM6IG5vb3AsXG4gICAgICBwcmV2aWV3VGVtcGxhdGU6IFwiPGRpdiBjbGFzcz1cXFwiZHotcHJldmlldyBkei1maWxlLXByZXZpZXdcXFwiPlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotaW1hZ2VcXFwiPjxpbWcgZGF0YS1kei10aHVtYm5haWwgLz48L2Rpdj5cXG4gIDxkaXYgY2xhc3M9XFxcImR6LWRldGFpbHNcXFwiPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJkei1zaXplXFxcIj48c3BhbiBkYXRhLWR6LXNpemU+PC9zcGFuPjwvZGl2PlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJkei1maWxlbmFtZVxcXCI+PHNwYW4gZGF0YS1kei1uYW1lPjwvc3Bhbj48L2Rpdj5cXG4gIDwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotcHJvZ3Jlc3NcXFwiPjxzcGFuIGNsYXNzPVxcXCJkei11cGxvYWRcXFwiIGRhdGEtZHotdXBsb2FkcHJvZ3Jlc3M+PC9zcGFuPjwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotZXJyb3ItbWVzc2FnZVxcXCI+PHNwYW4gZGF0YS1kei1lcnJvcm1lc3NhZ2U+PC9zcGFuPjwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotc3VjY2Vzcy1tYXJrXFxcIj5cXG4gICAgPHN2ZyB3aWR0aD1cXFwiNTRweFxcXCIgaGVpZ2h0PVxcXCI1NHB4XFxcIiB2aWV3Qm94PVxcXCIwIDAgNTQgNTRcXFwiIHZlcnNpb249XFxcIjEuMVxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIiB4bWxuczp4bGluaz1cXFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1xcXCIgeG1sbnM6c2tldGNoPVxcXCJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnNcXFwiPlxcbiAgICAgIDx0aXRsZT5DaGVjazwvdGl0bGU+XFxuICAgICAgPGRlZnM+PC9kZWZzPlxcbiAgICAgIDxnIGlkPVxcXCJQYWdlLTFcXFwiIHN0cm9rZT1cXFwibm9uZVxcXCIgc3Ryb2tlLXdpZHRoPVxcXCIxXFxcIiBmaWxsPVxcXCJub25lXFxcIiBmaWxsLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIHNrZXRjaDp0eXBlPVxcXCJNU1BhZ2VcXFwiPlxcbiAgICAgICAgPHBhdGggZD1cXFwiTTIzLjUsMzEuODQzMTQ1OCBMMTcuNTg1MjQxOSwyNS45MjgzODc3IEMxNi4wMjQ4MjUzLDI0LjM2Nzk3MTEgMTMuNDkxMDI5NCwyNC4zNjY4MzUgMTEuOTI4OTMyMiwyNS45Mjg5MzIyIEMxMC4zNzAwMTM2LDI3LjQ4Nzg1MDggMTAuMzY2NTkxMiwzMC4wMjM0NDU1IDExLjkyODM4NzcsMzEuNTg1MjQxOSBMMjAuNDE0NzU4MSw0MC4wNzE2MTIzIEMyMC41MTMzOTk5LDQwLjE3MDI1NDEgMjAuNjE1OTMxNSw0MC4yNjI2NjQ5IDIwLjcyMTg2MTUsNDAuMzQ4ODQzNSBDMjIuMjgzNTY2OSw0MS44NzI1NjUxIDI0Ljc5NDIzNCw0MS44NjI2MjAyIDI2LjM0NjE1NjQsNDAuMzEwNjk3OCBMNDMuMzEwNjk3OCwyMy4zNDYxNTY0IEM0NC44NzcxMDIxLDIxLjc3OTc1MjEgNDQuODc1ODA1NywxOS4yNDgzODg3IDQzLjMxMzcwODUsMTcuNjg2MjkxNSBDNDEuNzU0Nzg5OSwxNi4xMjczNzI5IDM5LjIxNzYwMzUsMTYuMTI1NTQyMiAzNy42NTM4NDM2LDE3LjY4OTMwMjIgTDIzLjUsMzEuODQzMTQ1OCBaIE0yNyw1MyBDNDEuMzU5NDAzNSw1MyA1Myw0MS4zNTk0MDM1IDUzLDI3IEM1MywxMi42NDA1OTY1IDQxLjM1OTQwMzUsMSAyNywxIEMxMi42NDA1OTY1LDEgMSwxMi42NDA1OTY1IDEsMjcgQzEsNDEuMzU5NDAzNSAxMi42NDA1OTY1LDUzIDI3LDUzIFpcXFwiIGlkPVxcXCJPdmFsLTJcXFwiIHN0cm9rZS1vcGFjaXR5PVxcXCIwLjE5ODc5NDE1OFxcXCIgc3Ryb2tlPVxcXCIjNzQ3NDc0XFxcIiBmaWxsLW9wYWNpdHk9XFxcIjAuODE2NTE5NDc1XFxcIiBmaWxsPVxcXCIjRkZGRkZGXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNTaGFwZUdyb3VwXFxcIj48L3BhdGg+XFxuICAgICAgPC9nPlxcbiAgICA8L3N2Zz5cXG4gIDwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotZXJyb3ItbWFya1xcXCI+XFxuICAgIDxzdmcgd2lkdGg9XFxcIjU0cHhcXFwiIGhlaWdodD1cXFwiNTRweFxcXCIgdmlld0JveD1cXFwiMCAwIDU0IDU0XFxcIiB2ZXJzaW9uPVxcXCIxLjFcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCIgeG1sbnM6eGxpbms9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcXFwiIHhtbG5zOnNrZXRjaD1cXFwiaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zXFxcIj5cXG4gICAgICA8dGl0bGU+RXJyb3I8L3RpdGxlPlxcbiAgICAgIDxkZWZzPjwvZGVmcz5cXG4gICAgICA8ZyBpZD1cXFwiUGFnZS0xXFxcIiBzdHJva2U9XFxcIm5vbmVcXFwiIHN0cm9rZS13aWR0aD1cXFwiMVxcXCIgZmlsbD1cXFwibm9uZVxcXCIgZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNQYWdlXFxcIj5cXG4gICAgICAgIDxnIGlkPVxcXCJDaGVjay0rLU92YWwtMlxcXCIgc2tldGNoOnR5cGU9XFxcIk1TTGF5ZXJHcm91cFxcXCIgc3Ryb2tlPVxcXCIjNzQ3NDc0XFxcIiBzdHJva2Utb3BhY2l0eT1cXFwiMC4xOTg3OTQxNThcXFwiIGZpbGw9XFxcIiNGRkZGRkZcXFwiIGZpbGwtb3BhY2l0eT1cXFwiMC44MTY1MTk0NzVcXFwiPlxcbiAgICAgICAgICA8cGF0aCBkPVxcXCJNMzIuNjU2ODU0MiwyOSBMMzguMzEwNjk3OCwyMy4zNDYxNTY0IEMzOS44NzcxMDIxLDIxLjc3OTc1MjEgMzkuODc1ODA1NywxOS4yNDgzODg3IDM4LjMxMzcwODUsMTcuNjg2MjkxNSBDMzYuNzU0Nzg5OSwxNi4xMjczNzI5IDM0LjIxNzYwMzUsMTYuMTI1NTQyMiAzMi42NTM4NDM2LDE3LjY4OTMwMjIgTDI3LDIzLjM0MzE0NTggTDIxLjM0NjE1NjQsMTcuNjg5MzAyMiBDMTkuNzgyMzk2NSwxNi4xMjU1NDIyIDE3LjI0NTIxMDEsMTYuMTI3MzcyOSAxNS42ODYyOTE1LDE3LjY4NjI5MTUgQzE0LjEyNDE5NDMsMTkuMjQ4Mzg4NyAxNC4xMjI4OTc5LDIxLjc3OTc1MjEgMTUuNjg5MzAyMiwyMy4zNDYxNTY0IEwyMS4zNDMxNDU4LDI5IEwxNS42ODkzMDIyLDM0LjY1Mzg0MzYgQzE0LjEyMjg5NzksMzYuMjIwMjQ3OSAxNC4xMjQxOTQzLDM4Ljc1MTYxMTMgMTUuNjg2MjkxNSw0MC4zMTM3MDg1IEMxNy4yNDUyMTAxLDQxLjg3MjYyNzEgMTkuNzgyMzk2NSw0MS44NzQ0NTc4IDIxLjM0NjE1NjQsNDAuMzEwNjk3OCBMMjcsMzQuNjU2ODU0MiBMMzIuNjUzODQzNiw0MC4zMTA2OTc4IEMzNC4yMTc2MDM1LDQxLjg3NDQ1NzggMzYuNzU0Nzg5OSw0MS44NzI2MjcxIDM4LjMxMzcwODUsNDAuMzEzNzA4NSBDMzkuODc1ODA1NywzOC43NTE2MTEzIDM5Ljg3NzEwMjEsMzYuMjIwMjQ3OSAzOC4zMTA2OTc4LDM0LjY1Mzg0MzYgTDMyLjY1Njg1NDIsMjkgWiBNMjcsNTMgQzQxLjM1OTQwMzUsNTMgNTMsNDEuMzU5NDAzNSA1MywyNyBDNTMsMTIuNjQwNTk2NSA0MS4zNTk0MDM1LDEgMjcsMSBDMTIuNjQwNTk2NSwxIDEsMTIuNjQwNTk2NSAxLDI3IEMxLDQxLjM1OTQwMzUgMTIuNjQwNTk2NSw1MyAyNyw1MyBaXFxcIiBpZD1cXFwiT3ZhbC0yXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNTaGFwZUdyb3VwXFxcIj48L3BhdGg+XFxuICAgICAgICA8L2c+XFxuICAgICAgPC9nPlxcbiAgICA8L3N2Zz5cXG4gIDwvZGl2PlxcbjwvZGl2PlwiXG4gICAgfTtcblxuICAgIGV4dGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGtleSwgb2JqZWN0LCBvYmplY3RzLCB0YXJnZXQsIHZhbCwgX2ksIF9sZW47XG4gICAgICB0YXJnZXQgPSBhcmd1bWVudHNbMF0sIG9iamVjdHMgPSAyIDw9IGFyZ3VtZW50cy5sZW5ndGggPyBfX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSA6IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBvYmplY3RzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIG9iamVjdCA9IG9iamVjdHNbX2ldO1xuICAgICAgICBmb3IgKGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICB2YWwgPSBvYmplY3Rba2V5XTtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gRHJvcHpvbmUoZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgdmFyIGVsZW1lbnRPcHRpb25zLCBmYWxsYmFjaywgX3JlZjtcbiAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICB0aGlzLnZlcnNpb24gPSBEcm9wem9uZS52ZXJzaW9uO1xuICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucy5wcmV2aWV3VGVtcGxhdGUgPSB0aGlzLmRlZmF1bHRPcHRpb25zLnByZXZpZXdUZW1wbGF0ZS5yZXBsYWNlKC9cXG4qL2csIFwiXCIpO1xuICAgICAgdGhpcy5jbGlja2FibGVFbGVtZW50cyA9IFtdO1xuICAgICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcbiAgICAgIHRoaXMuZmlsZXMgPSBbXTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5lbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGlmICghKHRoaXMuZWxlbWVudCAmJiAodGhpcy5lbGVtZW50Lm5vZGVUeXBlICE9IG51bGwpKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGRyb3B6b25lIGVsZW1lbnQuXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudC5kcm9wem9uZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEcm9wem9uZSBhbHJlYWR5IGF0dGFjaGVkLlwiKTtcbiAgICAgIH1cbiAgICAgIERyb3B6b25lLmluc3RhbmNlcy5wdXNoKHRoaXMpO1xuICAgICAgdGhpcy5lbGVtZW50LmRyb3B6b25lID0gdGhpcztcbiAgICAgIGVsZW1lbnRPcHRpb25zID0gKF9yZWYgPSBEcm9wem9uZS5vcHRpb25zRm9yRWxlbWVudCh0aGlzLmVsZW1lbnQpKSAhPSBudWxsID8gX3JlZiA6IHt9O1xuICAgICAgdGhpcy5vcHRpb25zID0gZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zLCBlbGVtZW50T3B0aW9ucywgb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucyA6IHt9KTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9yY2VGYWxsYmFjayB8fCAhRHJvcHpvbmUuaXNCcm93c2VyU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5mYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cmwgPT0gbnVsbCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMudXJsID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZShcImFjdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnVybCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBVUkwgcHJvdmlkZWQuXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hY2NlcHRlZEZpbGVzICYmIHRoaXMub3B0aW9ucy5hY2NlcHRlZE1pbWVUeXBlcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgY2FuJ3QgcHJvdmlkZSBib3RoICdhY2NlcHRlZEZpbGVzJyBhbmQgJ2FjY2VwdGVkTWltZVR5cGVzJy4gJ2FjY2VwdGVkTWltZVR5cGVzJyBpcyBkZXByZWNhdGVkLlwiKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmFjY2VwdGVkRmlsZXMgPSB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXM7XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXM7XG4gICAgICB9XG4gICAgICB0aGlzLm9wdGlvbnMubWV0aG9kID0gdGhpcy5vcHRpb25zLm1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKChmYWxsYmFjayA9IHRoaXMuZ2V0RXhpc3RpbmdGYWxsYmFjaygpKSAmJiBmYWxsYmFjay5wYXJlbnROb2RlKSB7XG4gICAgICAgIGZhbGxiYWNrLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZmFsbGJhY2spO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lciAhPT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lcikge1xuICAgICAgICAgIHRoaXMucHJldmlld3NDb250YWluZXIgPSBEcm9wem9uZS5nZXRFbGVtZW50KHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lciwgXCJwcmV2aWV3c0NvbnRhaW5lclwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnByZXZpZXdzQ29udGFpbmVyID0gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHRoaXMuY2xpY2thYmxlRWxlbWVudHMgPSBbdGhpcy5lbGVtZW50XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsaWNrYWJsZUVsZW1lbnRzID0gRHJvcHpvbmUuZ2V0RWxlbWVudHModGhpcy5vcHRpb25zLmNsaWNrYWJsZSwgXCJjbGlja2FibGVcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRBY2NlcHRlZEZpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuYWNjZXB0ZWQpIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRSZWplY3RlZEZpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKCFmaWxlLmFjY2VwdGVkKSB7XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaChmaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZ2V0RmlsZXNXaXRoU3RhdHVzID0gZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBzdGF0dXMpIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRRdWV1ZWRGaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsZXNXaXRoU3RhdHVzKERyb3B6b25lLlFVRVVFRCk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRVcGxvYWRpbmdGaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsZXNXaXRoU3RhdHVzKERyb3B6b25lLlVQTE9BRElORyk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRBZGRlZEZpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRGaWxlc1dpdGhTdGF0dXMoRHJvcHpvbmUuQURERUQpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZ2V0QWN0aXZlRmlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICBfcmVmID0gdGhpcy5maWxlcztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IF9yZWZbX2ldO1xuICAgICAgICBpZiAoZmlsZS5zdGF0dXMgPT09IERyb3B6b25lLlVQTE9BRElORyB8fCBmaWxlLnN0YXR1cyA9PT0gRHJvcHpvbmUuUVVFVUVEKSB7XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaChmaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGV2ZW50TmFtZSwgbm9Qcm9wYWdhdGlvbiwgc2V0dXBIaWRkZW5GaWxlSW5wdXQsIF9pLCBfbGVuLCBfcmVmLCBfcmVmMTtcbiAgICAgIGlmICh0aGlzLmVsZW1lbnQudGFnTmFtZSA9PT0gXCJmb3JtXCIpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcImVuY3R5cGVcIiwgXCJtdWx0aXBhcnQvZm9ybS1kYXRhXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJkcm9wem9uZVwiKSAmJiAhdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZHotbWVzc2FnZVwiKSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoRHJvcHpvbmUuY3JlYXRlRWxlbWVudChcIjxkaXYgY2xhc3M9XFxcImR6LWRlZmF1bHQgZHotbWVzc2FnZVxcXCI+PHNwYW4+XCIgKyB0aGlzLm9wdGlvbnMuZGljdERlZmF1bHRNZXNzYWdlICsgXCI8L3NwYW4+PC9kaXY+XCIpKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNsaWNrYWJsZUVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgICBzZXR1cEhpZGRlbkZpbGVJbnB1dCA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5oaWRkZW5GaWxlSW5wdXQpIHtcbiAgICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoX3RoaXMuaGlkZGVuRmlsZUlucHV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiZmlsZVwiKTtcbiAgICAgICAgICAgIGlmICgoX3RoaXMub3B0aW9ucy5tYXhGaWxlcyA9PSBudWxsKSB8fCBfdGhpcy5vcHRpb25zLm1heEZpbGVzID4gMSkge1xuICAgICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc2V0QXR0cmlidXRlKFwibXVsdGlwbGVcIiwgXCJtdWx0aXBsZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5jbGFzc05hbWUgPSBcImR6LWhpZGRlbi1pbnB1dFwiO1xuICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuYWNjZXB0ZWRGaWxlcyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoXCJhY2NlcHRcIiwgX3RoaXMub3B0aW9ucy5hY2NlcHRlZEZpbGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmNhcHR1cmUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc2V0QXR0cmlidXRlKFwiY2FwdHVyZVwiLCBfdGhpcy5vcHRpb25zLmNhcHR1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnN0eWxlLnRvcCA9IFwiMFwiO1xuICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnN0eWxlLmxlZnQgPSBcIjBcIjtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjBcIjtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS53aWR0aCA9IFwiMFwiO1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihfdGhpcy5vcHRpb25zLmhpZGRlbklucHV0Q29udGFpbmVyKS5hcHBlbmRDaGlsZChfdGhpcy5oaWRkZW5GaWxlSW5wdXQpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB2YXIgZmlsZSwgZmlsZXMsIF9pLCBfbGVuO1xuICAgICAgICAgICAgICBmaWxlcyA9IF90aGlzLmhpZGRlbkZpbGVJbnB1dC5maWxlcztcbiAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgICAgICAgICAgICBfdGhpcy5hZGRGaWxlKGZpbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBfdGhpcy5lbWl0KFwiYWRkZWRmaWxlc1wiLCBmaWxlcyk7XG4gICAgICAgICAgICAgIHJldHVybiBzZXR1cEhpZGRlbkZpbGVJbnB1dCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyk7XG4gICAgICAgIHNldHVwSGlkZGVuRmlsZUlucHV0KCk7XG4gICAgICB9XG4gICAgICB0aGlzLlVSTCA9IChfcmVmID0gd2luZG93LlVSTCkgIT0gbnVsbCA/IF9yZWYgOiB3aW5kb3cud2Via2l0VVJMO1xuICAgICAgX3JlZjEgPSB0aGlzLmV2ZW50cztcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjEubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZXZlbnROYW1lID0gX3JlZjFbX2ldO1xuICAgICAgICB0aGlzLm9uKGV2ZW50TmFtZSwgdGhpcy5vcHRpb25zW2V2ZW50TmFtZV0pO1xuICAgICAgfVxuICAgICAgdGhpcy5vbihcInVwbG9hZHByb2dyZXNzXCIsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLnVwZGF0ZVRvdGFsVXBsb2FkUHJvZ3Jlc3MoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHRoaXMub24oXCJyZW1vdmVkZmlsZVwiLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBfdGhpcy51cGRhdGVUb3RhbFVwbG9hZFByb2dyZXNzKCk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICB0aGlzLm9uKFwiY2FuY2VsZWRcIiwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJjb21wbGV0ZVwiLCBmaWxlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHRoaXMub24oXCJjb21wbGV0ZVwiLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICBpZiAoX3RoaXMuZ2V0QWRkZWRGaWxlcygpLmxlbmd0aCA9PT0gMCAmJiBfdGhpcy5nZXRVcGxvYWRpbmdGaWxlcygpLmxlbmd0aCA9PT0gMCAmJiBfdGhpcy5nZXRRdWV1ZWRGaWxlcygpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZW1pdChcInF1ZXVlY29tcGxldGVcIik7XG4gICAgICAgICAgICB9KSwgMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgbm9Qcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLmxpc3RlbmVycyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuZWxlbWVudCxcbiAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgIFwiZHJhZ3N0YXJ0XCI6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KFwiZHJhZ3N0YXJ0XCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdlbnRlclwiOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBub1Byb3BhZ2F0aW9uKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KFwiZHJhZ2VudGVyXCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdvdmVyXCI6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHZhciBlZmN0O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBlZmN0ID0gZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZDtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJyA9PT0gZWZjdCB8fCAnbGlua01vdmUnID09PSBlZmN0ID8gJ21vdmUnIDogJ2NvcHknO1xuICAgICAgICAgICAgICAgIG5vUHJvcGFnYXRpb24oZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnb3ZlclwiLCBlKTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKHRoaXMpLFxuICAgICAgICAgICAgXCJkcmFnbGVhdmVcIjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnbGVhdmVcIiwgZSk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgICAgIFwiZHJvcFwiOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBub1Byb3BhZ2F0aW9uKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5kcm9wKGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdlbmRcIjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnZW5kXCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICB0aGlzLmNsaWNrYWJsZUVsZW1lbnRzLmZvckVhY2goKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihjbGlja2FibGVFbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLmxpc3RlbmVycy5wdXNoKHtcbiAgICAgICAgICAgIGVsZW1lbnQ6IGNsaWNrYWJsZUVsZW1lbnQsXG4gICAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICAgXCJjbGlja1wiOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoKGNsaWNrYWJsZUVsZW1lbnQgIT09IF90aGlzLmVsZW1lbnQpIHx8IChldnQudGFyZ2V0ID09PSBfdGhpcy5lbGVtZW50IHx8IERyb3B6b25lLmVsZW1lbnRJbnNpZGUoZXZ0LnRhcmdldCwgX3RoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmR6LW1lc3NhZ2VcIikpKSkge1xuICAgICAgICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pbml0LmNhbGwodGhpcyk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX3JlZjtcbiAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgdGhpcy5yZW1vdmVBbGxGaWxlcyh0cnVlKTtcbiAgICAgIGlmICgoX3JlZiA9IHRoaXMuaGlkZGVuRmlsZUlucHV0KSAhPSBudWxsID8gX3JlZi5wYXJlbnROb2RlIDogdm9pZCAwKSB7XG4gICAgICAgIHRoaXMuaGlkZGVuRmlsZUlucHV0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5oaWRkZW5GaWxlSW5wdXQpO1xuICAgICAgICB0aGlzLmhpZGRlbkZpbGVJbnB1dCA9IG51bGw7XG4gICAgICB9XG4gICAgICBkZWxldGUgdGhpcy5lbGVtZW50LmRyb3B6b25lO1xuICAgICAgcmV0dXJuIERyb3B6b25lLmluc3RhbmNlcy5zcGxpY2UoRHJvcHpvbmUuaW5zdGFuY2VzLmluZGV4T2YodGhpcyksIDEpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUudXBkYXRlVG90YWxVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFjdGl2ZUZpbGVzLCBmaWxlLCB0b3RhbEJ5dGVzLCB0b3RhbEJ5dGVzU2VudCwgdG90YWxVcGxvYWRQcm9ncmVzcywgX2ksIF9sZW4sIF9yZWY7XG4gICAgICB0b3RhbEJ5dGVzU2VudCA9IDA7XG4gICAgICB0b3RhbEJ5dGVzID0gMDtcbiAgICAgIGFjdGl2ZUZpbGVzID0gdGhpcy5nZXRBY3RpdmVGaWxlcygpO1xuICAgICAgaWYgKGFjdGl2ZUZpbGVzLmxlbmd0aCkge1xuICAgICAgICBfcmVmID0gdGhpcy5nZXRBY3RpdmVGaWxlcygpO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBmaWxlID0gX3JlZltfaV07XG4gICAgICAgICAgdG90YWxCeXRlc1NlbnQgKz0gZmlsZS51cGxvYWQuYnl0ZXNTZW50O1xuICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZmlsZS51cGxvYWQudG90YWw7XG4gICAgICAgIH1cbiAgICAgICAgdG90YWxVcGxvYWRQcm9ncmVzcyA9IDEwMCAqIHRvdGFsQnl0ZXNTZW50IC8gdG90YWxCeXRlcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvdGFsVXBsb2FkUHJvZ3Jlc3MgPSAxMDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5lbWl0KFwidG90YWx1cGxvYWRwcm9ncmVzc1wiLCB0b3RhbFVwbG9hZFByb2dyZXNzLCB0b3RhbEJ5dGVzLCB0b3RhbEJ5dGVzU2VudCk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fZ2V0UGFyYW1OYW1lID0gZnVuY3Rpb24obikge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMucGFyYW1OYW1lID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wYXJhbU5hbWUobik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJcIiArIHRoaXMub3B0aW9ucy5wYXJhbU5hbWUgKyAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlID8gXCJbXCIgKyBuICsgXCJdXCIgOiBcIlwiKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9yZW5hbWVGaWxlbmFtZSA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnJlbmFtZUZpbGVuYW1lICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnJlbmFtZUZpbGVuYW1lKG5hbWUpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZ2V0RmFsbGJhY2tGb3JtID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZXhpc3RpbmdGYWxsYmFjaywgZmllbGRzLCBmaWVsZHNTdHJpbmcsIGZvcm07XG4gICAgICBpZiAoZXhpc3RpbmdGYWxsYmFjayA9IHRoaXMuZ2V0RXhpc3RpbmdGYWxsYmFjaygpKSB7XG4gICAgICAgIHJldHVybiBleGlzdGluZ0ZhbGxiYWNrO1xuICAgICAgfVxuICAgICAgZmllbGRzU3RyaW5nID0gXCI8ZGl2IGNsYXNzPVxcXCJkei1mYWxsYmFja1xcXCI+XCI7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmRpY3RGYWxsYmFja1RleHQpIHtcbiAgICAgICAgZmllbGRzU3RyaW5nICs9IFwiPHA+XCIgKyB0aGlzLm9wdGlvbnMuZGljdEZhbGxiYWNrVGV4dCArIFwiPC9wPlwiO1xuICAgICAgfVxuICAgICAgZmllbGRzU3RyaW5nICs9IFwiPGlucHV0IHR5cGU9XFxcImZpbGVcXFwiIG5hbWU9XFxcIlwiICsgKHRoaXMuX2dldFBhcmFtTmFtZSgwKSkgKyBcIlxcXCIgXCIgKyAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlID8gJ211bHRpcGxlPVwibXVsdGlwbGVcIicgOiB2b2lkIDApICsgXCIgLz48aW5wdXQgdHlwZT1cXFwic3VibWl0XFxcIiB2YWx1ZT1cXFwiVXBsb2FkIVxcXCI+PC9kaXY+XCI7XG4gICAgICBmaWVsZHMgPSBEcm9wem9uZS5jcmVhdGVFbGVtZW50KGZpZWxkc1N0cmluZyk7XG4gICAgICBpZiAodGhpcy5lbGVtZW50LnRhZ05hbWUgIT09IFwiRk9STVwiKSB7XG4gICAgICAgIGZvcm0gPSBEcm9wem9uZS5jcmVhdGVFbGVtZW50KFwiPGZvcm0gYWN0aW9uPVxcXCJcIiArIHRoaXMub3B0aW9ucy51cmwgKyBcIlxcXCIgZW5jdHlwZT1cXFwibXVsdGlwYXJ0L2Zvcm0tZGF0YVxcXCIgbWV0aG9kPVxcXCJcIiArIHRoaXMub3B0aW9ucy5tZXRob2QgKyBcIlxcXCI+PC9mb3JtPlwiKTtcbiAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChmaWVsZHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcImVuY3R5cGVcIiwgXCJtdWx0aXBhcnQvZm9ybS1kYXRhXCIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwibWV0aG9kXCIsIHRoaXMub3B0aW9ucy5tZXRob2QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZvcm0gIT0gbnVsbCA/IGZvcm0gOiBmaWVsZHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRFeGlzdGluZ0ZhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmFsbGJhY2ssIGdldEZhbGxiYWNrLCB0YWdOYW1lLCBfaSwgX2xlbiwgX3JlZjtcbiAgICAgIGdldEZhbGxiYWNrID0gZnVuY3Rpb24oZWxlbWVudHMpIHtcbiAgICAgICAgdmFyIGVsLCBfaSwgX2xlbjtcbiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBlbGVtZW50cy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIGVsID0gZWxlbWVudHNbX2ldO1xuICAgICAgICAgIGlmICgvKF58IClmYWxsYmFjaygkfCApLy50ZXN0KGVsLmNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBlbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBfcmVmID0gW1wiZGl2XCIsIFwiZm9ybVwiXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICB0YWdOYW1lID0gX3JlZltfaV07XG4gICAgICAgIGlmIChmYWxsYmFjayA9IGdldEZhbGxiYWNrKHRoaXMuZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnNldHVwRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBlbGVtZW50TGlzdGVuZXJzLCBldmVudCwgbGlzdGVuZXIsIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgIF9yZWYgPSB0aGlzLmxpc3RlbmVycztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZWxlbWVudExpc3RlbmVycyA9IF9yZWZbX2ldO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKChmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgX3JlZjEsIF9yZXN1bHRzMTtcbiAgICAgICAgICBfcmVmMSA9IGVsZW1lbnRMaXN0ZW5lcnMuZXZlbnRzO1xuICAgICAgICAgIF9yZXN1bHRzMSA9IFtdO1xuICAgICAgICAgIGZvciAoZXZlbnQgaW4gX3JlZjEpIHtcbiAgICAgICAgICAgIGxpc3RlbmVyID0gX3JlZjFbZXZlbnRdO1xuICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2goZWxlbWVudExpc3RlbmVycy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGxpc3RlbmVyLCBmYWxzZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgICB9KSgpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZWxlbWVudExpc3RlbmVycywgZXZlbnQsIGxpc3RlbmVyLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICBfcmVmID0gdGhpcy5saXN0ZW5lcnM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGVsZW1lbnRMaXN0ZW5lcnMgPSBfcmVmW19pXTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCgoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIF9yZWYxLCBfcmVzdWx0czE7XG4gICAgICAgICAgX3JlZjEgPSBlbGVtZW50TGlzdGVuZXJzLmV2ZW50cztcbiAgICAgICAgICBfcmVzdWx0czEgPSBbXTtcbiAgICAgICAgICBmb3IgKGV2ZW50IGluIF9yZWYxKSB7XG4gICAgICAgICAgICBsaXN0ZW5lciA9IF9yZWYxW2V2ZW50XTtcbiAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKGVsZW1lbnRMaXN0ZW5lcnMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBsaXN0ZW5lciwgZmFsc2UpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzMTtcbiAgICAgICAgfSkoKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgdGhpcy5jbGlja2FibGVFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImR6LWNsaWNrYWJsZVwiKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLmNhbmNlbFVwbG9hZChmaWxlKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY2xpY2thYmxlRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1jbGlja2FibGVcIik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmZpbGVzaXplID0gZnVuY3Rpb24oc2l6ZSkge1xuICAgICAgdmFyIGN1dG9mZiwgaSwgc2VsZWN0ZWRTaXplLCBzZWxlY3RlZFVuaXQsIHVuaXQsIHVuaXRzLCBfaSwgX2xlbjtcbiAgICAgIHNlbGVjdGVkU2l6ZSA9IDA7XG4gICAgICBzZWxlY3RlZFVuaXQgPSBcImJcIjtcbiAgICAgIGlmIChzaXplID4gMCkge1xuICAgICAgICB1bml0cyA9IFsnVEInLCAnR0InLCAnTUInLCAnS0InLCAnYiddO1xuICAgICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSB1bml0cy5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHtcbiAgICAgICAgICB1bml0ID0gdW5pdHNbaV07XG4gICAgICAgICAgY3V0b2ZmID0gTWF0aC5wb3codGhpcy5vcHRpb25zLmZpbGVzaXplQmFzZSwgNCAtIGkpIC8gMTA7XG4gICAgICAgICAgaWYgKHNpemUgPj0gY3V0b2ZmKSB7XG4gICAgICAgICAgICBzZWxlY3RlZFNpemUgPSBzaXplIC8gTWF0aC5wb3codGhpcy5vcHRpb25zLmZpbGVzaXplQmFzZSwgNCAtIGkpO1xuICAgICAgICAgICAgc2VsZWN0ZWRVbml0ID0gdW5pdDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzZWxlY3RlZFNpemUgPSBNYXRoLnJvdW5kKDEwICogc2VsZWN0ZWRTaXplKSAvIDEwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFwiPHN0cm9uZz5cIiArIHNlbGVjdGVkU2l6ZSArIFwiPC9zdHJvbmc+IFwiICsgc2VsZWN0ZWRVbml0O1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX3VwZGF0ZU1heEZpbGVzUmVhY2hlZENsYXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoKHRoaXMub3B0aW9ucy5tYXhGaWxlcyAhPSBudWxsKSAmJiB0aGlzLmdldEFjY2VwdGVkRmlsZXMoKS5sZW5ndGggPj0gdGhpcy5vcHRpb25zLm1heEZpbGVzKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEFjY2VwdGVkRmlsZXMoKS5sZW5ndGggPT09IHRoaXMub3B0aW9ucy5tYXhGaWxlcykge1xuICAgICAgICAgIHRoaXMuZW1pdCgnbWF4ZmlsZXNyZWFjaGVkJywgdGhpcy5maWxlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotbWF4LWZpbGVzLXJlYWNoZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1tYXgtZmlsZXMtcmVhY2hlZFwiKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmRyb3AgPSBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZXMsIGl0ZW1zO1xuICAgICAgaWYgKCFlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmVtaXQoXCJkcm9wXCIsIGUpO1xuICAgICAgZmlsZXMgPSBlLmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgIHRoaXMuZW1pdChcImFkZGVkZmlsZXNcIiwgZmlsZXMpO1xuICAgICAgaWYgKGZpbGVzLmxlbmd0aCkge1xuICAgICAgICBpdGVtcyA9IGUuZGF0YVRyYW5zZmVyLml0ZW1zO1xuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoICYmIChpdGVtc1swXS53ZWJraXRHZXRBc0VudHJ5ICE9IG51bGwpKSB7XG4gICAgICAgICAgdGhpcy5fYWRkRmlsZXNGcm9tSXRlbXMoaXRlbXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRmlsZXMoZmlsZXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5wYXN0ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBpdGVtcywgX3JlZjtcbiAgICAgIGlmICgoZSAhPSBudWxsID8gKF9yZWYgPSBlLmNsaXBib2FyZERhdGEpICE9IG51bGwgPyBfcmVmLml0ZW1zIDogdm9pZCAwIDogdm9pZCAwKSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuZW1pdChcInBhc3RlXCIsIGUpO1xuICAgICAgaXRlbXMgPSBlLmNsaXBib2FyZERhdGEuaXRlbXM7XG4gICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hZGRGaWxlc0Zyb21JdGVtcyhpdGVtcyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5oYW5kbGVGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IGZpbGVzW19pXTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLmFkZEZpbGUoZmlsZSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX2FkZEZpbGVzRnJvbUl0ZW1zID0gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICAgIHZhciBlbnRyeSwgaXRlbSwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gaXRlbXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgaXRlbSA9IGl0ZW1zW19pXTtcbiAgICAgICAgaWYgKChpdGVtLndlYmtpdEdldEFzRW50cnkgIT0gbnVsbCkgJiYgKGVudHJ5ID0gaXRlbS53ZWJraXRHZXRBc0VudHJ5KCkpKSB7XG4gICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLmFkZEZpbGUoaXRlbS5nZXRBc0ZpbGUoKSkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnkuaXNEaXJlY3RvcnkpIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5fYWRkRmlsZXNGcm9tRGlyZWN0b3J5KGVudHJ5LCBlbnRyeS5uYW1lKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS5nZXRBc0ZpbGUgIT0gbnVsbCkge1xuICAgICAgICAgIGlmICgoaXRlbS5raW5kID09IG51bGwpIHx8IGl0ZW0ua2luZCA9PT0gXCJmaWxlXCIpIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5hZGRGaWxlKGl0ZW0uZ2V0QXNGaWxlKCkpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9hZGRGaWxlc0Zyb21EaXJlY3RvcnkgPSBmdW5jdGlvbihkaXJlY3RvcnksIHBhdGgpIHtcbiAgICAgIHZhciBkaXJSZWFkZXIsIGVycm9ySGFuZGxlciwgcmVhZEVudHJpZXM7XG4gICAgICBkaXJSZWFkZXIgPSBkaXJlY3RvcnkuY3JlYXRlUmVhZGVyKCk7XG4gICAgICBlcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZSAhPT0gbnVsbCA/IHR5cGVvZiBjb25zb2xlLmxvZyA9PT0gXCJmdW5jdGlvblwiID8gY29uc29sZS5sb2coZXJyb3IpIDogdm9pZCAwIDogdm9pZCAwO1xuICAgICAgfTtcbiAgICAgIHJlYWRFbnRyaWVzID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gZGlyUmVhZGVyLnJlYWRFbnRyaWVzKGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICAgICAgIHZhciBlbnRyeSwgX2ksIF9sZW47XG4gICAgICAgICAgICBpZiAoZW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZW50cmllcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgICAgIGVudHJ5ID0gZW50cmllc1tfaV07XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgICAgICAgZW50cnkuZmlsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmlnbm9yZUhpZGRlbkZpbGVzICYmIGZpbGUubmFtZS5zdWJzdHJpbmcoMCwgMSkgPT09ICcuJykge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmaWxlLmZ1bGxQYXRoID0gXCJcIiArIHBhdGggKyBcIi9cIiArIGZpbGUubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmFkZEZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICBfdGhpcy5fYWRkRmlsZXNGcm9tRGlyZWN0b3J5KGVudHJ5LCBcIlwiICsgcGF0aCArIFwiL1wiICsgZW50cnkubmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlYWRFbnRyaWVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9LCBlcnJvckhhbmRsZXIpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICByZXR1cm4gcmVhZEVudHJpZXMoKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uKGZpbGUsIGRvbmUpIHtcbiAgICAgIGlmIChmaWxlLnNpemUgPiB0aGlzLm9wdGlvbnMubWF4RmlsZXNpemUgKiAxMDI0ICogMTAyNCkge1xuICAgICAgICByZXR1cm4gZG9uZSh0aGlzLm9wdGlvbnMuZGljdEZpbGVUb29CaWcucmVwbGFjZShcInt7ZmlsZXNpemV9fVwiLCBNYXRoLnJvdW5kKGZpbGUuc2l6ZSAvIDEwMjQgLyAxMC4yNCkgLyAxMDApLnJlcGxhY2UoXCJ7e21heEZpbGVzaXplfX1cIiwgdGhpcy5vcHRpb25zLm1heEZpbGVzaXplKSk7XG4gICAgICB9IGVsc2UgaWYgKCFEcm9wem9uZS5pc1ZhbGlkRmlsZShmaWxlLCB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRGaWxlcykpIHtcbiAgICAgICAgcmV0dXJuIGRvbmUodGhpcy5vcHRpb25zLmRpY3RJbnZhbGlkRmlsZVR5cGUpO1xuICAgICAgfSBlbHNlIGlmICgodGhpcy5vcHRpb25zLm1heEZpbGVzICE9IG51bGwpICYmIHRoaXMuZ2V0QWNjZXB0ZWRGaWxlcygpLmxlbmd0aCA+PSB0aGlzLm9wdGlvbnMubWF4RmlsZXMpIHtcbiAgICAgICAgZG9uZSh0aGlzLm9wdGlvbnMuZGljdE1heEZpbGVzRXhjZWVkZWQucmVwbGFjZShcInt7bWF4RmlsZXN9fVwiLCB0aGlzLm9wdGlvbnMubWF4RmlsZXMpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChcIm1heGZpbGVzZXhjZWVkZWRcIiwgZmlsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFjY2VwdC5jYWxsKHRoaXMsIGZpbGUsIGRvbmUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuYWRkRmlsZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIGZpbGUudXBsb2FkID0ge1xuICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgdG90YWw6IGZpbGUuc2l6ZSxcbiAgICAgICAgYnl0ZXNTZW50OiAwXG4gICAgICB9O1xuICAgICAgdGhpcy5maWxlcy5wdXNoKGZpbGUpO1xuICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5BRERFRDtcbiAgICAgIHRoaXMuZW1pdChcImFkZGVkZmlsZVwiLCBmaWxlKTtcbiAgICAgIHRoaXMuX2VucXVldWVUaHVtYm5haWwoZmlsZSk7XG4gICAgICByZXR1cm4gdGhpcy5hY2NlcHQoZmlsZSwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgZmlsZS5hY2NlcHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2Vycm9yUHJvY2Vzc2luZyhbZmlsZV0sIGVycm9yKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlsZS5hY2NlcHRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5hdXRvUXVldWUpIHtcbiAgICAgICAgICAgICAgX3RoaXMuZW5xdWV1ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdXBkYXRlTWF4RmlsZXNSZWFjaGVkQ2xhc3MoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmVucXVldWVGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW47XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIHRoaXMuZW5xdWV1ZUZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmVucXVldWVGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5BRERFRCAmJiBmaWxlLmFjY2VwdGVkID09PSB0cnVlKSB7XG4gICAgICAgIGZpbGUuc3RhdHVzID0gRHJvcHpvbmUuUVVFVUVEO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9Qcm9jZXNzUXVldWUpIHtcbiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9jZXNzUXVldWUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkodGhpcykpLCAwKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhpcyBmaWxlIGNhbid0IGJlIHF1ZXVlZCBiZWNhdXNlIGl0IGhhcyBhbHJlYWR5IGJlZW4gcHJvY2Vzc2VkIG9yIHdhcyByZWplY3RlZC5cIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fdGh1bWJuYWlsUXVldWUgPSBbXTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IGZhbHNlO1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9lbnF1ZXVlVGh1bWJuYWlsID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcmVhdGVJbWFnZVRodW1ibmFpbHMgJiYgZmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykgJiYgZmlsZS5zaXplIDw9IHRoaXMub3B0aW9ucy5tYXhUaHVtYm5haWxGaWxlc2l6ZSAqIDEwMjQgKiAxMDI0KSB7XG4gICAgICAgIHRoaXMuX3RodW1ibmFpbFF1ZXVlLnB1c2goZmlsZSk7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuX3Byb2Nlc3NUaHVtYm5haWxRdWV1ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpKSwgMCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fcHJvY2Vzc1RodW1ibmFpbFF1ZXVlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCB8fCB0aGlzLl90aHVtYm5haWxRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVUaHVtYm5haWwodGhpcy5fdGh1bWJuYWlsUXVldWUuc2hpZnQoKSwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBfdGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBfdGhpcy5fcHJvY2Vzc1RodW1ibmFpbFF1ZXVlKCk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5yZW1vdmVGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5VUExPQURJTkcpIHtcbiAgICAgICAgdGhpcy5jYW5jZWxVcGxvYWQoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpbGVzID0gd2l0aG91dCh0aGlzLmZpbGVzLCBmaWxlKTtcbiAgICAgIHRoaXMuZW1pdChcInJlbW92ZWRmaWxlXCIsIGZpbGUpO1xuICAgICAgaWYgKHRoaXMuZmlsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoXCJyZXNldFwiKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnJlbW92ZUFsbEZpbGVzID0gZnVuY3Rpb24oY2FuY2VsSWZOZWNlc3NhcnkpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbiwgX3JlZjtcbiAgICAgIGlmIChjYW5jZWxJZk5lY2Vzc2FyeSA9PSBudWxsKSB7XG4gICAgICAgIGNhbmNlbElmTmVjZXNzYXJ5ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBfcmVmID0gdGhpcy5maWxlcy5zbGljZSgpO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuc3RhdHVzICE9PSBEcm9wem9uZS5VUExPQURJTkcgfHwgY2FuY2VsSWZOZWNlc3NhcnkpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuY3JlYXRlVGh1bWJuYWlsID0gZnVuY3Rpb24oZmlsZSwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBmaWxlUmVhZGVyO1xuICAgICAgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyO1xuICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChmaWxlLnR5cGUgPT09IFwiaW1hZ2Uvc3ZnK3htbFwiKSB7XG4gICAgICAgICAgICBfdGhpcy5lbWl0KFwidGh1bWJuYWlsXCIsIGZpbGUsIGZpbGVSZWFkZXIucmVzdWx0KTtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5jcmVhdGVUaHVtYm5haWxGcm9tVXJsKGZpbGUsIGZpbGVSZWFkZXIucmVzdWx0LCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIHJldHVybiBmaWxlUmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5jcmVhdGVUaHVtYm5haWxGcm9tVXJsID0gZnVuY3Rpb24oZmlsZSwgaW1hZ2VVcmwsIGNhbGxiYWNrLCBjcm9zc09yaWdpbikge1xuICAgICAgdmFyIGltZztcbiAgICAgIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICBpZiAoY3Jvc3NPcmlnaW4pIHtcbiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47XG4gICAgICB9XG4gICAgICBpbWcub25sb2FkID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgY2FudmFzLCBjdHgsIHJlc2l6ZUluZm8sIHRodW1ibmFpbCwgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVmMztcbiAgICAgICAgICBmaWxlLndpZHRoID0gaW1nLndpZHRoO1xuICAgICAgICAgIGZpbGUuaGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICAgICAgICByZXNpemVJbmZvID0gX3RoaXMub3B0aW9ucy5yZXNpemUuY2FsbChfdGhpcywgZmlsZSk7XG4gICAgICAgICAgaWYgKHJlc2l6ZUluZm8udHJnV2lkdGggPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzaXplSW5mby50cmdXaWR0aCA9IHJlc2l6ZUluZm8ub3B0V2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZXNpemVJbmZvLnRyZ0hlaWdodCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXNpemVJbmZvLnRyZ0hlaWdodCA9IHJlc2l6ZUluZm8ub3B0SGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gcmVzaXplSW5mby50cmdXaWR0aDtcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gcmVzaXplSW5mby50cmdIZWlnaHQ7XG4gICAgICAgICAgZHJhd0ltYWdlSU9TRml4KGN0eCwgaW1nLCAoX3JlZiA9IHJlc2l6ZUluZm8uc3JjWCkgIT0gbnVsbCA/IF9yZWYgOiAwLCAoX3JlZjEgPSByZXNpemVJbmZvLnNyY1kpICE9IG51bGwgPyBfcmVmMSA6IDAsIHJlc2l6ZUluZm8uc3JjV2lkdGgsIHJlc2l6ZUluZm8uc3JjSGVpZ2h0LCAoX3JlZjIgPSByZXNpemVJbmZvLnRyZ1gpICE9IG51bGwgPyBfcmVmMiA6IDAsIChfcmVmMyA9IHJlc2l6ZUluZm8udHJnWSkgIT0gbnVsbCA/IF9yZWYzIDogMCwgcmVzaXplSW5mby50cmdXaWR0aCwgcmVzaXplSW5mby50cmdIZWlnaHQpO1xuICAgICAgICAgIHRodW1ibmFpbCA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XG4gICAgICAgICAgX3RoaXMuZW1pdChcInRodW1ibmFpbFwiLCBmaWxlLCB0aHVtYm5haWwpO1xuICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICAgIGltZy5vbmVycm9yID0gY2FsbGJhY2s7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW1nLnNyYyA9IGltYWdlVXJsO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUucHJvY2Vzc1F1ZXVlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaSwgcGFyYWxsZWxVcGxvYWRzLCBwcm9jZXNzaW5nTGVuZ3RoLCBxdWV1ZWRGaWxlcztcbiAgICAgIHBhcmFsbGVsVXBsb2FkcyA9IHRoaXMub3B0aW9ucy5wYXJhbGxlbFVwbG9hZHM7XG4gICAgICBwcm9jZXNzaW5nTGVuZ3RoID0gdGhpcy5nZXRVcGxvYWRpbmdGaWxlcygpLmxlbmd0aDtcbiAgICAgIGkgPSBwcm9jZXNzaW5nTGVuZ3RoO1xuICAgICAgaWYgKHByb2Nlc3NpbmdMZW5ndGggPj0gcGFyYWxsZWxVcGxvYWRzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHF1ZXVlZEZpbGVzID0gdGhpcy5nZXRRdWV1ZWRGaWxlcygpO1xuICAgICAgaWYgKCEocXVldWVkRmlsZXMubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmlsZXMocXVldWVkRmlsZXMuc2xpY2UoMCwgcGFyYWxsZWxVcGxvYWRzIC0gcHJvY2Vzc2luZ0xlbmd0aCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2hpbGUgKGkgPCBwYXJhbGxlbFVwbG9hZHMpIHtcbiAgICAgICAgICBpZiAoIXF1ZXVlZEZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnByb2Nlc3NGaWxlKHF1ZXVlZEZpbGVzLnNoaWZ0KCkpO1xuICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUucHJvY2Vzc0ZpbGUgPSBmdW5jdGlvbihmaWxlKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmlsZXMoW2ZpbGVdKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnByb2Nlc3NGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW47XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIGZpbGUucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICAgIGZpbGUuc3RhdHVzID0gRHJvcHpvbmUuVVBMT0FESU5HO1xuICAgICAgICB0aGlzLmVtaXQoXCJwcm9jZXNzaW5nXCIsIGZpbGUpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICB0aGlzLmVtaXQoXCJwcm9jZXNzaW5nbXVsdGlwbGVcIiwgZmlsZXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudXBsb2FkRmlsZXMoZmlsZXMpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX2dldEZpbGVzV2l0aFhociA9IGZ1bmN0aW9uKHhocikge1xuICAgICAgdmFyIGZpbGUsIGZpbGVzO1xuICAgICAgcmV0dXJuIGZpbGVzID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgICBfcmVmID0gdGhpcy5maWxlcztcbiAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZmlsZSA9IF9yZWZbX2ldO1xuICAgICAgICAgIGlmIChmaWxlLnhociA9PT0geGhyKSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgICB9KS5jYWxsKHRoaXMpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuY2FuY2VsVXBsb2FkID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgdmFyIGdyb3VwZWRGaWxlLCBncm91cGVkRmlsZXMsIF9pLCBfaiwgX2xlbiwgX2xlbjEsIF9yZWY7XG4gICAgICBpZiAoZmlsZS5zdGF0dXMgPT09IERyb3B6b25lLlVQTE9BRElORykge1xuICAgICAgICBncm91cGVkRmlsZXMgPSB0aGlzLl9nZXRGaWxlc1dpdGhYaHIoZmlsZS54aHIpO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGdyb3VwZWRGaWxlcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIGdyb3VwZWRGaWxlID0gZ3JvdXBlZEZpbGVzW19pXTtcbiAgICAgICAgICBncm91cGVkRmlsZS5zdGF0dXMgPSBEcm9wem9uZS5DQU5DRUxFRDtcbiAgICAgICAgfVxuICAgICAgICBmaWxlLnhoci5hYm9ydCgpO1xuICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBncm91cGVkRmlsZXMubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgICAgZ3JvdXBlZEZpbGUgPSBncm91cGVkRmlsZXNbX2pdO1xuICAgICAgICAgIHRoaXMuZW1pdChcImNhbmNlbGVkXCIsIGdyb3VwZWRGaWxlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlKSB7XG4gICAgICAgICAgdGhpcy5lbWl0KFwiY2FuY2VsZWRtdWx0aXBsZVwiLCBncm91cGVkRmlsZXMpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKChfcmVmID0gZmlsZS5zdGF0dXMpID09PSBEcm9wem9uZS5BRERFRCB8fCBfcmVmID09PSBEcm9wem9uZS5RVUVVRUQpIHtcbiAgICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5DQU5DRUxFRDtcbiAgICAgICAgdGhpcy5lbWl0KFwiY2FuY2VsZWRcIiwgZmlsZSk7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudXBsb2FkTXVsdGlwbGUpIHtcbiAgICAgICAgICB0aGlzLmVtaXQoXCJjYW5jZWxlZG11bHRpcGxlXCIsIFtmaWxlXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b1Byb2Nlc3NRdWV1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzUXVldWUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVzb2x2ZU9wdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MsIG9wdGlvbjtcbiAgICAgIG9wdGlvbiA9IGFyZ3VtZW50c1swXSwgYXJncyA9IDIgPD0gYXJndW1lbnRzLmxlbmd0aCA/IF9fc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpIDogW107XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gb3B0aW9uLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvbjtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnVwbG9hZEZpbGUgPSBmdW5jdGlvbihmaWxlKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGxvYWRGaWxlcyhbZmlsZV0pO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUudXBsb2FkRmlsZXMgPSBmdW5jdGlvbihmaWxlcykge1xuICAgICAgdmFyIGZpbGUsIGZvcm1EYXRhLCBoYW5kbGVFcnJvciwgaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUsIGhlYWRlcnMsIGksIGlucHV0LCBpbnB1dE5hbWUsIGlucHV0VHlwZSwga2V5LCBtZXRob2QsIG9wdGlvbiwgcHJvZ3Jlc3NPYmosIHJlc3BvbnNlLCB1cGRhdGVQcm9ncmVzcywgdXJsLCB2YWx1ZSwgeGhyLCBfaSwgX2osIF9rLCBfbCwgX2xlbiwgX2xlbjEsIF9sZW4yLCBfbGVuMywgX20sIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNTtcbiAgICAgIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBmaWxlcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBmaWxlID0gZmlsZXNbX2ldO1xuICAgICAgICBmaWxlLnhociA9IHhocjtcbiAgICAgIH1cbiAgICAgIG1ldGhvZCA9IHJlc29sdmVPcHRpb24odGhpcy5vcHRpb25zLm1ldGhvZCwgZmlsZXMpO1xuICAgICAgdXJsID0gcmVzb2x2ZU9wdGlvbih0aGlzLm9wdGlvbnMudXJsLCBmaWxlcyk7XG4gICAgICB4aHIub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7XG4gICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gISF0aGlzLm9wdGlvbnMud2l0aENyZWRlbnRpYWxzO1xuICAgICAgcmVzcG9uc2UgPSBudWxsO1xuICAgICAgaGFuZGxlRXJyb3IgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBfaiwgX2xlbjEsIF9yZXN1bHRzO1xuICAgICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gZmlsZXMubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgICAgICBmaWxlID0gZmlsZXNbX2pdO1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChfdGhpcy5fZXJyb3JQcm9jZXNzaW5nKGZpbGVzLCByZXNwb25zZSB8fCBfdGhpcy5vcHRpb25zLmRpY3RSZXNwb25zZUVycm9yLnJlcGxhY2UoXCJ7e3N0YXR1c0NvZGV9fVwiLCB4aHIuc3RhdHVzKSwgeGhyKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgdXBkYXRlUHJvZ3Jlc3MgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICB2YXIgYWxsRmlsZXNGaW5pc2hlZCwgcHJvZ3Jlc3MsIF9qLCBfaywgX2wsIF9sZW4xLCBfbGVuMiwgX2xlbjMsIF9yZXN1bHRzO1xuICAgICAgICAgIGlmIChlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHByb2dyZXNzID0gMTAwICogZS5sb2FkZWQgLyBlLnRvdGFsO1xuICAgICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gZmlsZXMubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgICAgICAgIGZpbGUgPSBmaWxlc1tfal07XG4gICAgICAgICAgICAgIGZpbGUudXBsb2FkID0ge1xuICAgICAgICAgICAgICAgIHByb2dyZXNzOiBwcm9ncmVzcyxcbiAgICAgICAgICAgICAgICB0b3RhbDogZS50b3RhbCxcbiAgICAgICAgICAgICAgICBieXRlc1NlbnQ6IGUubG9hZGVkXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFsbEZpbGVzRmluaXNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgcHJvZ3Jlc3MgPSAxMDA7XG4gICAgICAgICAgICBmb3IgKF9rID0gMCwgX2xlbjIgPSBmaWxlcy5sZW5ndGg7IF9rIDwgX2xlbjI7IF9rKyspIHtcbiAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzW19rXTtcbiAgICAgICAgICAgICAgaWYgKCEoZmlsZS51cGxvYWQucHJvZ3Jlc3MgPT09IDEwMCAmJiBmaWxlLnVwbG9hZC5ieXRlc1NlbnQgPT09IGZpbGUudXBsb2FkLnRvdGFsKSkge1xuICAgICAgICAgICAgICAgIGFsbEZpbGVzRmluaXNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBmaWxlLnVwbG9hZC5wcm9ncmVzcyA9IHByb2dyZXNzO1xuICAgICAgICAgICAgICBmaWxlLnVwbG9hZC5ieXRlc1NlbnQgPSBmaWxlLnVwbG9hZC50b3RhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhbGxGaWxlc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICBmb3IgKF9sID0gMCwgX2xlbjMgPSBmaWxlcy5sZW5ndGg7IF9sIDwgX2xlbjM7IF9sKyspIHtcbiAgICAgICAgICAgIGZpbGUgPSBmaWxlc1tfbF07XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKF90aGlzLmVtaXQoXCJ1cGxvYWRwcm9ncmVzc1wiLCBmaWxlLCBwcm9ncmVzcywgZmlsZS51cGxvYWQuYnl0ZXNTZW50KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgeGhyLm9ubG9hZCA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgIHZhciBfcmVmO1xuICAgICAgICAgIGlmIChmaWxlc1swXS5zdGF0dXMgPT09IERyb3B6b25lLkNBTkNFTEVEKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPT0gNCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXNwb25zZSA9IHhoci5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgaWYgKHhoci5nZXRSZXNwb25zZUhlYWRlcihcImNvbnRlbnQtdHlwZVwiKSAmJiB+eGhyLmdldFJlc3BvbnNlSGVhZGVyKFwiY29udGVudC10eXBlXCIpLmluZGV4T2YoXCJhcHBsaWNhdGlvbi9qc29uXCIpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7XG4gICAgICAgICAgICAgIGUgPSBfZXJyb3I7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gXCJJbnZhbGlkIEpTT04gcmVzcG9uc2UgZnJvbSBzZXJ2ZXIuXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKCk7XG4gICAgICAgICAgaWYgKCEoKDIwMCA8PSAoX3JlZiA9IHhoci5zdGF0dXMpICYmIF9yZWYgPCAzMDApKSkge1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5fZmluaXNoZWQoZmlsZXMsIHJlc3BvbnNlLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIHhoci5vbmVycm9yID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoZmlsZXNbMF0uc3RhdHVzID09PSBEcm9wem9uZS5DQU5DRUxFRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgcHJvZ3Jlc3NPYmogPSAoX3JlZiA9IHhoci51cGxvYWQpICE9IG51bGwgPyBfcmVmIDogeGhyO1xuICAgICAgcHJvZ3Jlc3NPYmoub25wcm9ncmVzcyA9IHVwZGF0ZVByb2dyZXNzO1xuICAgICAgaGVhZGVycyA9IHtcbiAgICAgICAgXCJBY2NlcHRcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiQ2FjaGUtQ29udHJvbFwiOiBcIm5vLWNhY2hlXCIsXG4gICAgICAgIFwiWC1SZXF1ZXN0ZWQtV2l0aFwiOiBcIlhNTEh0dHBSZXF1ZXN0XCJcbiAgICAgIH07XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgZXh0ZW5kKGhlYWRlcnMsIHRoaXMub3B0aW9ucy5oZWFkZXJzKTtcbiAgICAgIH1cbiAgICAgIGZvciAoaGVhZGVyTmFtZSBpbiBoZWFkZXJzKSB7XG4gICAgICAgIGhlYWRlclZhbHVlID0gaGVhZGVyc1toZWFkZXJOYW1lXTtcbiAgICAgICAgaWYgKGhlYWRlclZhbHVlKSB7XG4gICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wYXJhbXMpIHtcbiAgICAgICAgX3JlZjEgPSB0aGlzLm9wdGlvbnMucGFyYW1zO1xuICAgICAgICBmb3IgKGtleSBpbiBfcmVmMSkge1xuICAgICAgICAgIHZhbHVlID0gX3JlZjFba2V5XTtcbiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGZpbGVzLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykge1xuICAgICAgICBmaWxlID0gZmlsZXNbX2pdO1xuICAgICAgICB0aGlzLmVtaXQoXCJzZW5kaW5nXCIsIGZpbGUsIHhociwgZm9ybURhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICB0aGlzLmVtaXQoXCJzZW5kaW5nbXVsdGlwbGVcIiwgZmlsZXMsIHhociwgZm9ybURhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudC50YWdOYW1lID09PSBcIkZPUk1cIikge1xuICAgICAgICBfcmVmMiA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIGJ1dHRvblwiKTtcbiAgICAgICAgZm9yIChfayA9IDAsIF9sZW4yID0gX3JlZjIubGVuZ3RoOyBfayA8IF9sZW4yOyBfaysrKSB7XG4gICAgICAgICAgaW5wdXQgPSBfcmVmMltfa107XG4gICAgICAgICAgaW5wdXROYW1lID0gaW5wdXQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcbiAgICAgICAgICBpbnB1dFR5cGUgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpO1xuICAgICAgICAgIGlmIChpbnB1dC50YWdOYW1lID09PSBcIlNFTEVDVFwiICYmIGlucHV0Lmhhc0F0dHJpYnV0ZShcIm11bHRpcGxlXCIpKSB7XG4gICAgICAgICAgICBfcmVmMyA9IGlucHV0Lm9wdGlvbnM7XG4gICAgICAgICAgICBmb3IgKF9sID0gMCwgX2xlbjMgPSBfcmVmMy5sZW5ndGg7IF9sIDwgX2xlbjM7IF9sKyspIHtcbiAgICAgICAgICAgICAgb3B0aW9uID0gX3JlZjNbX2xdO1xuICAgICAgICAgICAgICBpZiAob3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGlucHV0TmFtZSwgb3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoIWlucHV0VHlwZSB8fCAoKF9yZWY0ID0gaW5wdXRUeXBlLnRvTG93ZXJDYXNlKCkpICE9PSBcImNoZWNrYm94XCIgJiYgX3JlZjQgIT09IFwicmFkaW9cIikgfHwgaW5wdXQuY2hlY2tlZCkge1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGlucHV0TmFtZSwgaW5wdXQudmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChpID0gX20gPSAwLCBfcmVmNSA9IGZpbGVzLmxlbmd0aCAtIDE7IDAgPD0gX3JlZjUgPyBfbSA8PSBfcmVmNSA6IF9tID49IF9yZWY1OyBpID0gMCA8PSBfcmVmNSA/ICsrX20gOiAtLV9tKSB7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCh0aGlzLl9nZXRQYXJhbU5hbWUoaSksIGZpbGVzW2ldLCB0aGlzLl9yZW5hbWVGaWxlbmFtZShmaWxlc1tpXS5uYW1lKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5zdWJtaXRSZXF1ZXN0KHhociwgZm9ybURhdGEsIGZpbGVzKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnN1Ym1pdFJlcXVlc3QgPSBmdW5jdGlvbih4aHIsIGZvcm1EYXRhLCBmaWxlcykge1xuICAgICAgcmV0dXJuIHhoci5zZW5kKGZvcm1EYXRhKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9maW5pc2hlZCA9IGZ1bmN0aW9uKGZpbGVzLCByZXNwb25zZVRleHQsIGUpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbjtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IGZpbGVzW19pXTtcbiAgICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5TVUNDRVNTO1xuICAgICAgICB0aGlzLmVtaXQoXCJzdWNjZXNzXCIsIGZpbGUsIHJlc3BvbnNlVGV4dCwgZSk7XG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIGZpbGUpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICB0aGlzLmVtaXQoXCJzdWNjZXNzbXVsdGlwbGVcIiwgZmlsZXMsIHJlc3BvbnNlVGV4dCwgZSk7XG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlbXVsdGlwbGVcIiwgZmlsZXMpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvUHJvY2Vzc1F1ZXVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NRdWV1ZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX2Vycm9yUHJvY2Vzc2luZyA9IGZ1bmN0aW9uKGZpbGVzLCBtZXNzYWdlLCB4aHIpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbjtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IGZpbGVzW19pXTtcbiAgICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5FUlJPUjtcbiAgICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgZmlsZSwgbWVzc2FnZSwgeGhyKTtcbiAgICAgICAgdGhpcy5lbWl0KFwiY29tcGxldGVcIiwgZmlsZSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlKSB7XG4gICAgICAgIHRoaXMuZW1pdChcImVycm9ybXVsdGlwbGVcIiwgZmlsZXMsIG1lc3NhZ2UsIHhocik7XG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlbXVsdGlwbGVcIiwgZmlsZXMpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvUHJvY2Vzc1F1ZXVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NRdWV1ZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gRHJvcHpvbmU7XG5cbiAgfSkoRW1pdHRlcik7XG5cbiAgRHJvcHpvbmUudmVyc2lvbiA9IFwiNC4zLjBcIjtcblxuICBEcm9wem9uZS5vcHRpb25zID0ge307XG5cbiAgRHJvcHpvbmUub3B0aW9uc0ZvckVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgIHJldHVybiBEcm9wem9uZS5vcHRpb25zW2NhbWVsaXplKGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIikpXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gIH07XG5cbiAgRHJvcHpvbmUuaW5zdGFuY2VzID0gW107XG5cbiAgRHJvcHpvbmUuZm9yRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQuZHJvcHpvbmUgOiB2b2lkIDApID09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIERyb3B6b25lIGZvdW5kIGZvciBnaXZlbiBlbGVtZW50LiBUaGlzIGlzIHByb2JhYmx5IGJlY2F1c2UgeW91J3JlIHRyeWluZyB0byBhY2Nlc3MgaXQgYmVmb3JlIERyb3B6b25lIGhhZCB0aGUgdGltZSB0byBpbml0aWFsaXplLiBVc2UgdGhlIGBpbml0YCBvcHRpb24gdG8gc2V0dXAgYW55IGFkZGl0aW9uYWwgb2JzZXJ2ZXJzIG9uIHlvdXIgRHJvcHpvbmUuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5kcm9wem9uZTtcbiAgfTtcblxuICBEcm9wem9uZS5hdXRvRGlzY292ZXIgPSB0cnVlO1xuXG4gIERyb3B6b25lLmRpc2NvdmVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNoZWNrRWxlbWVudHMsIGRyb3B6b25lLCBkcm9wem9uZXMsIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCkge1xuICAgICAgZHJvcHpvbmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5kcm9wem9uZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZHJvcHpvbmVzID0gW107XG4gICAgICBjaGVja0VsZW1lbnRzID0gZnVuY3Rpb24oZWxlbWVudHMpIHtcbiAgICAgICAgdmFyIGVsLCBfaSwgX2xlbiwgX3Jlc3VsdHM7XG4gICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZWxlbWVudHMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBlbCA9IGVsZW1lbnRzW19pXTtcbiAgICAgICAgICBpZiAoLyhefCApZHJvcHpvbmUoJHwgKS8udGVzdChlbC5jbGFzc05hbWUpKSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKGRyb3B6b25lcy5wdXNoKGVsKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgfTtcbiAgICAgIGNoZWNrRWxlbWVudHMoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkaXZcIikpO1xuICAgICAgY2hlY2tFbGVtZW50cyhkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImZvcm1cIikpO1xuICAgIH1cbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZHJvcHpvbmVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICBkcm9wem9uZSA9IGRyb3B6b25lc1tfaV07XG4gICAgICBpZiAoRHJvcHpvbmUub3B0aW9uc0ZvckVsZW1lbnQoZHJvcHpvbmUpICE9PSBmYWxzZSkge1xuICAgICAgICBfcmVzdWx0cy5wdXNoKG5ldyBEcm9wem9uZShkcm9wem9uZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgRHJvcHpvbmUuYmxhY2tsaXN0ZWRCcm93c2VycyA9IFsvb3BlcmEuKk1hY2ludG9zaC4qdmVyc2lvblxcLzEyL2ldO1xuXG4gIERyb3B6b25lLmlzQnJvd3NlclN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjYXBhYmxlQnJvd3NlciwgcmVnZXgsIF9pLCBfbGVuLCBfcmVmO1xuICAgIGNhcGFibGVCcm93c2VyID0gdHJ1ZTtcbiAgICBpZiAod2luZG93LkZpbGUgJiYgd2luZG93LkZpbGVSZWFkZXIgJiYgd2luZG93LkZpbGVMaXN0ICYmIHdpbmRvdy5CbG9iICYmIHdpbmRvdy5Gb3JtRGF0YSAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKSB7XG4gICAgICBpZiAoIShcImNsYXNzTGlzdFwiIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpKSkge1xuICAgICAgICBjYXBhYmxlQnJvd3NlciA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3JlZiA9IERyb3B6b25lLmJsYWNrbGlzdGVkQnJvd3NlcnM7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIHJlZ2V4ID0gX3JlZltfaV07XG4gICAgICAgICAgaWYgKHJlZ2V4LnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgICAgIGNhcGFibGVCcm93c2VyID0gZmFsc2U7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY2FwYWJsZUJyb3dzZXIgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGNhcGFibGVCcm93c2VyO1xuICB9O1xuXG4gIHdpdGhvdXQgPSBmdW5jdGlvbihsaXN0LCByZWplY3RlZEl0ZW0pIHtcbiAgICB2YXIgaXRlbSwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgZm9yIChfaSA9IDAsIF9sZW4gPSBsaXN0Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICBpdGVtID0gbGlzdFtfaV07XG4gICAgICBpZiAoaXRlbSAhPT0gcmVqZWN0ZWRJdGVtKSB7XG4gICAgICAgIF9yZXN1bHRzLnB1c2goaXRlbSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICBjYW1lbGl6ZSA9IGZ1bmN0aW9uKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1xcLV9dKFxcdykvZywgZnVuY3Rpb24obWF0Y2gpIHtcbiAgICAgIHJldHVybiBtYXRjaC5jaGFyQXQoMSkudG9VcHBlckNhc2UoKTtcbiAgICB9KTtcbiAgfTtcblxuICBEcm9wem9uZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgdmFyIGRpdjtcbiAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGRpdi5pbm5lckhUTUwgPSBzdHJpbmc7XG4gICAgcmV0dXJuIGRpdi5jaGlsZE5vZGVzWzBdO1xuICB9O1xuXG4gIERyb3B6b25lLmVsZW1lbnRJbnNpZGUgPSBmdW5jdGlvbihlbGVtZW50LCBjb250YWluZXIpIHtcbiAgICBpZiAoZWxlbWVudCA9PT0gY29udGFpbmVyKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgIGlmIChlbGVtZW50ID09PSBjb250YWluZXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBEcm9wem9uZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24oZWwsIG5hbWUpIHtcbiAgICB2YXIgZWxlbWVudDtcbiAgICBpZiAodHlwZW9mIGVsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbCk7XG4gICAgfSBlbHNlIGlmIChlbC5ub2RlVHlwZSAhPSBudWxsKSB7XG4gICAgICBlbGVtZW50ID0gZWw7XG4gICAgfVxuICAgIGlmIChlbGVtZW50ID09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYFwiICsgbmFtZSArIFwiYCBvcHRpb24gcHJvdmlkZWQuIFBsZWFzZSBwcm92aWRlIGEgQ1NTIHNlbGVjdG9yIG9yIGEgcGxhaW4gSFRNTCBlbGVtZW50LlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH07XG5cbiAgRHJvcHpvbmUuZ2V0RWxlbWVudHMgPSBmdW5jdGlvbihlbHMsIG5hbWUpIHtcbiAgICB2YXIgZSwgZWwsIGVsZW1lbnRzLCBfaSwgX2osIF9sZW4sIF9sZW4xLCBfcmVmO1xuICAgIGlmIChlbHMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgZWxlbWVudHMgPSBbXTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZWxzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZWwgPSBlbHNbX2ldO1xuICAgICAgICAgIGVsZW1lbnRzLnB1c2godGhpcy5nZXRFbGVtZW50KGVsLCBuYW1lKSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKF9lcnJvcikge1xuICAgICAgICBlID0gX2Vycm9yO1xuICAgICAgICBlbGVtZW50cyA9IG51bGw7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZWxzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBlbGVtZW50cyA9IFtdO1xuICAgICAgX3JlZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZWxzKTtcbiAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IF9yZWYubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgIGVsID0gX3JlZltfal07XG4gICAgICAgIGVsZW1lbnRzLnB1c2goZWwpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZWxzLm5vZGVUeXBlICE9IG51bGwpIHtcbiAgICAgIGVsZW1lbnRzID0gW2Vsc107XG4gICAgfVxuICAgIGlmICghKChlbGVtZW50cyAhPSBudWxsKSAmJiBlbGVtZW50cy5sZW5ndGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGBcIiArIG5hbWUgKyBcImAgb3B0aW9uIHByb3ZpZGVkLiBQbGVhc2UgcHJvdmlkZSBhIENTUyBzZWxlY3RvciwgYSBwbGFpbiBIVE1MIGVsZW1lbnQgb3IgYSBsaXN0IG9mIHRob3NlLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnRzO1xuICB9O1xuXG4gIERyb3B6b25lLmNvbmZpcm0gPSBmdW5jdGlvbihxdWVzdGlvbiwgYWNjZXB0ZWQsIHJlamVjdGVkKSB7XG4gICAgaWYgKHdpbmRvdy5jb25maXJtKHF1ZXN0aW9uKSkge1xuICAgICAgcmV0dXJuIGFjY2VwdGVkKCk7XG4gICAgfSBlbHNlIGlmIChyZWplY3RlZCAhPSBudWxsKSB7XG4gICAgICByZXR1cm4gcmVqZWN0ZWQoKTtcbiAgICB9XG4gIH07XG5cbiAgRHJvcHpvbmUuaXNWYWxpZEZpbGUgPSBmdW5jdGlvbihmaWxlLCBhY2NlcHRlZEZpbGVzKSB7XG4gICAgdmFyIGJhc2VNaW1lVHlwZSwgbWltZVR5cGUsIHZhbGlkVHlwZSwgX2ksIF9sZW47XG4gICAgaWYgKCFhY2NlcHRlZEZpbGVzKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYWNjZXB0ZWRGaWxlcyA9IGFjY2VwdGVkRmlsZXMuc3BsaXQoXCIsXCIpO1xuICAgIG1pbWVUeXBlID0gZmlsZS50eXBlO1xuICAgIGJhc2VNaW1lVHlwZSA9IG1pbWVUeXBlLnJlcGxhY2UoL1xcLy4qJC8sIFwiXCIpO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYWNjZXB0ZWRGaWxlcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgdmFsaWRUeXBlID0gYWNjZXB0ZWRGaWxlc1tfaV07XG4gICAgICB2YWxpZFR5cGUgPSB2YWxpZFR5cGUudHJpbSgpO1xuICAgICAgaWYgKHZhbGlkVHlwZS5jaGFyQXQoMCkgPT09IFwiLlwiKSB7XG4gICAgICAgIGlmIChmaWxlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbGlkVHlwZS50b0xvd2VyQ2FzZSgpLCBmaWxlLm5hbWUubGVuZ3RoIC0gdmFsaWRUeXBlLmxlbmd0aCkgIT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoL1xcL1xcKiQvLnRlc3QodmFsaWRUeXBlKSkge1xuICAgICAgICBpZiAoYmFzZU1pbWVUeXBlID09PSB2YWxpZFR5cGUucmVwbGFjZSgvXFwvLiokLywgXCJcIikpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG1pbWVUeXBlID09PSB2YWxpZFR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBqUXVlcnkgIT09IFwidW5kZWZpbmVkXCIgJiYgalF1ZXJ5ICE9PSBudWxsKSB7XG4gICAgalF1ZXJ5LmZuLmRyb3B6b25lID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEcm9wem9uZSh0aGlzLCBvcHRpb25zKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IERyb3B6b25lO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvdy5Ecm9wem9uZSA9IERyb3B6b25lO1xuICB9XG5cbiAgRHJvcHpvbmUuQURERUQgPSBcImFkZGVkXCI7XG5cbiAgRHJvcHpvbmUuUVVFVUVEID0gXCJxdWV1ZWRcIjtcblxuICBEcm9wem9uZS5BQ0NFUFRFRCA9IERyb3B6b25lLlFVRVVFRDtcblxuICBEcm9wem9uZS5VUExPQURJTkcgPSBcInVwbG9hZGluZ1wiO1xuXG4gIERyb3B6b25lLlBST0NFU1NJTkcgPSBEcm9wem9uZS5VUExPQURJTkc7XG5cbiAgRHJvcHpvbmUuQ0FOQ0VMRUQgPSBcImNhbmNlbGVkXCI7XG5cbiAgRHJvcHpvbmUuRVJST1IgPSBcImVycm9yXCI7XG5cbiAgRHJvcHpvbmUuU1VDQ0VTUyA9IFwic3VjY2Vzc1wiO1xuXG5cbiAgLypcbiAgXG4gIEJ1Z2ZpeCBmb3IgaU9TIDYgYW5kIDdcbiAgU291cmNlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExOTI5MDk5L2h0bWw1LWNhbnZhcy1kcmF3aW1hZ2UtcmF0aW8tYnVnLWlvc1xuICBiYXNlZCBvbiB0aGUgd29yayBvZiBodHRwczovL2dpdGh1Yi5jb20vc3RvbWl0YS9pb3MtaW1hZ2VmaWxlLW1lZ2FwaXhlbFxuICAgKi9cblxuICBkZXRlY3RWZXJ0aWNhbFNxdWFzaCA9IGZ1bmN0aW9uKGltZykge1xuICAgIHZhciBhbHBoYSwgY2FudmFzLCBjdHgsIGRhdGEsIGV5LCBpaCwgaXcsIHB5LCByYXRpbywgc3k7XG4gICAgaXcgPSBpbWcubmF0dXJhbFdpZHRoO1xuICAgIGloID0gaW1nLm5hdHVyYWxIZWlnaHQ7XG4gICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMud2lkdGggPSAxO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBpaDtcbiAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICBkYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCBpaCkuZGF0YTtcbiAgICBzeSA9IDA7XG4gICAgZXkgPSBpaDtcbiAgICBweSA9IGloO1xuICAgIHdoaWxlIChweSA+IHN5KSB7XG4gICAgICBhbHBoYSA9IGRhdGFbKHB5IC0gMSkgKiA0ICsgM107XG4gICAgICBpZiAoYWxwaGEgPT09IDApIHtcbiAgICAgICAgZXkgPSBweTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN5ID0gcHk7XG4gICAgICB9XG4gICAgICBweSA9IChleSArIHN5KSA+PiAxO1xuICAgIH1cbiAgICByYXRpbyA9IHB5IC8gaWg7XG4gICAgaWYgKHJhdGlvID09PSAwKSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJhdGlvO1xuICAgIH1cbiAgfTtcblxuICBkcmF3SW1hZ2VJT1NGaXggPSBmdW5jdGlvbihjdHgsIGltZywgc3gsIHN5LCBzdywgc2gsIGR4LCBkeSwgZHcsIGRoKSB7XG4gICAgdmFyIHZlcnRTcXVhc2hSYXRpbztcbiAgICB2ZXJ0U3F1YXNoUmF0aW8gPSBkZXRlY3RWZXJ0aWNhbFNxdWFzaChpbWcpO1xuICAgIHJldHVybiBjdHguZHJhd0ltYWdlKGltZywgc3gsIHN5LCBzdywgc2gsIGR4LCBkeSwgZHcsIGRoIC8gdmVydFNxdWFzaFJhdGlvKTtcbiAgfTtcblxuXG4gIC8qXG4gICAqIGNvbnRlbnRsb2FkZWQuanNcbiAgICpcbiAgICogQXV0aG9yOiBEaWVnbyBQZXJpbmkgKGRpZWdvLnBlcmluaSBhdCBnbWFpbC5jb20pXG4gICAqIFN1bW1hcnk6IGNyb3NzLWJyb3dzZXIgd3JhcHBlciBmb3IgRE9NQ29udGVudExvYWRlZFxuICAgKiBVcGRhdGVkOiAyMDEwMTAyMFxuICAgKiBMaWNlbnNlOiBNSVRcbiAgICogVmVyc2lvbjogMS4yXG4gICAqXG4gICAqIFVSTDpcbiAgICogaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0NvbnRlbnRMb2FkZWQvXG4gICAqIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9Db250ZW50TG9hZGVkL01JVC1MSUNFTlNFXG4gICAqL1xuXG4gIGNvbnRlbnRMb2FkZWQgPSBmdW5jdGlvbih3aW4sIGZuKSB7XG4gICAgdmFyIGFkZCwgZG9jLCBkb25lLCBpbml0LCBwb2xsLCBwcmUsIHJlbSwgcm9vdCwgdG9wO1xuICAgIGRvbmUgPSBmYWxzZTtcbiAgICB0b3AgPSB0cnVlO1xuICAgIGRvYyA9IHdpbi5kb2N1bWVudDtcbiAgICByb290ID0gZG9jLmRvY3VtZW50RWxlbWVudDtcbiAgICBhZGQgPSAoZG9jLmFkZEV2ZW50TGlzdGVuZXIgPyBcImFkZEV2ZW50TGlzdGVuZXJcIiA6IFwiYXR0YWNoRXZlbnRcIik7XG4gICAgcmVtID0gKGRvYy5hZGRFdmVudExpc3RlbmVyID8gXCJyZW1vdmVFdmVudExpc3RlbmVyXCIgOiBcImRldGFjaEV2ZW50XCIpO1xuICAgIHByZSA9IChkb2MuYWRkRXZlbnRMaXN0ZW5lciA/IFwiXCIgOiBcIm9uXCIpO1xuICAgIGluaXQgPSBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS50eXBlID09PSBcInJlYWR5c3RhdGVjaGFuZ2VcIiAmJiBkb2MucmVhZHlTdGF0ZSAhPT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIChlLnR5cGUgPT09IFwibG9hZFwiID8gd2luIDogZG9jKVtyZW1dKHByZSArIGUudHlwZSwgaW5pdCwgZmFsc2UpO1xuICAgICAgaWYgKCFkb25lICYmIChkb25lID0gdHJ1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZuLmNhbGwod2luLCBlLnR5cGUgfHwgZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBwb2xsID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJvb3QuZG9TY3JvbGwoXCJsZWZ0XCIpO1xuICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7XG4gICAgICAgIGUgPSBfZXJyb3I7XG4gICAgICAgIHNldFRpbWVvdXQocG9sbCwgNTApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICByZXR1cm4gaW5pdChcInBvbGxcIik7XG4gICAgfTtcbiAgICBpZiAoZG9jLnJlYWR5U3RhdGUgIT09IFwiY29tcGxldGVcIikge1xuICAgICAgaWYgKGRvYy5jcmVhdGVFdmVudE9iamVjdCAmJiByb290LmRvU2Nyb2xsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdG9wID0gIXdpbi5mcmFtZUVsZW1lbnQ7XG4gICAgICAgIH0gY2F0Y2ggKF9lcnJvcikge31cbiAgICAgICAgaWYgKHRvcCkge1xuICAgICAgICAgIHBvbGwoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZG9jW2FkZF0ocHJlICsgXCJET01Db250ZW50TG9hZGVkXCIsIGluaXQsIGZhbHNlKTtcbiAgICAgIGRvY1thZGRdKHByZSArIFwicmVhZHlzdGF0ZWNoYW5nZVwiLCBpbml0LCBmYWxzZSk7XG4gICAgICByZXR1cm4gd2luW2FkZF0ocHJlICsgXCJsb2FkXCIsIGluaXQsIGZhbHNlKTtcbiAgICB9XG4gIH07XG5cbiAgRHJvcHpvbmUuX2F1dG9EaXNjb3ZlckZ1bmN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKERyb3B6b25lLmF1dG9EaXNjb3Zlcikge1xuICAgICAgcmV0dXJuIERyb3B6b25lLmRpc2NvdmVyKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnRlbnRMb2FkZWQod2luZG93LCBEcm9wem9uZS5fYXV0b0Rpc2NvdmVyRnVuY3Rpb24pO1xuXG59KS5jYWxsKHRoaXMpO1xuIiwiLypcbmF0dHJpYnV0ZXNcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyICQgICAgICAgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG5cbnZhciB0cmltICAgID0gcmVxdWlyZShcIm1vdXQvc3RyaW5nL3RyaW1cIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZvckVhY2hcIiksXG4gICAgZmlsdGVyICA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZpbHRlclwiKSxcbiAgICBpbmRleE9mID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvaW5kZXhPZlwiKVxuXG4vLyBhdHRyaWJ1dGVzXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIHNldEF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSwgdmFsdWUpe1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgIHZhciBhdHRyID0gdGhpc1swXS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpXG4gICAgICAgIHJldHVybiAoYXR0ciAmJiBhdHRyLnNwZWNpZmllZCkgPyBhdHRyLnZhbHVlIDogbnVsbFxuICAgIH0sXG5cbiAgICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXNbMF1cbiAgICAgICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlKSByZXR1cm4gbm9kZS5oYXNBdHRyaWJ1dGUobmFtZSlcbiAgICAgICAgdmFyIGF0dHIgPSBub2RlLmdldEF0dHJpYnV0ZU5vZGUobmFtZSlcbiAgICAgICAgcmV0dXJuICEhKGF0dHIgJiYgYXR0ci5zcGVjaWZpZWQpXG4gICAgfSxcblxuICAgIHJlbW92ZUF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICB2YXIgYXR0ciA9IG5vZGUuZ2V0QXR0cmlidXRlTm9kZShuYW1lKVxuICAgICAgICAgICAgaWYgKGF0dHIpIG5vZGUucmVtb3ZlQXR0cmlidXRlTm9kZShhdHRyKVxuICAgICAgICB9KVxuICAgIH1cblxufSlcblxudmFyIGFjY2Vzc29ycyA9IHt9XG5cbmZvckVhY2goW1widHlwZVwiLCBcInZhbHVlXCIsIFwibmFtZVwiLCBcImhyZWZcIiwgXCJ0aXRsZVwiLCBcImlkXCJdLCBmdW5jdGlvbihuYW1lKXtcblxuICAgIGFjY2Vzc29yc1tuYW1lXSA9IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIG5vZGVbbmFtZV0gPSB2YWx1ZVxuICAgICAgICB9KSA6IHRoaXNbMF1bbmFtZV1cbiAgICB9XG5cbn0pXG5cbi8vIGJvb2xlYW5zXG5cbmZvckVhY2goW1wiY2hlY2tlZFwiLCBcImRpc2FibGVkXCIsIFwic2VsZWN0ZWRcIl0sIGZ1bmN0aW9uKG5hbWUpe1xuXG4gICAgYWNjZXNzb3JzW25hbWVdID0gZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICByZXR1cm4gKHZhbHVlICE9PSB1bmRlZmluZWQpID8gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgbm9kZVtuYW1lXSA9ICEhdmFsdWVcbiAgICAgICAgfSkgOiAhIXRoaXNbMF1bbmFtZV1cbiAgICB9XG5cbn0pXG5cbi8vIGNsYXNzTmFtZVxuXG52YXIgY2xhc3NlcyA9IGZ1bmN0aW9uKGNsYXNzTmFtZSl7XG4gICAgdmFyIGNsYXNzTmFtZXMgPSB0cmltKGNsYXNzTmFtZSkucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikuc3BsaXQoXCIgXCIpLFxuICAgICAgICB1bmlxdWVzICAgID0ge31cblxuICAgIHJldHVybiBmaWx0ZXIoY2xhc3NOYW1lcywgZnVuY3Rpb24oY2xhc3NOYW1lKXtcbiAgICAgICAgaWYgKGNsYXNzTmFtZSAhPT0gXCJcIiAmJiAhdW5pcXVlc1tjbGFzc05hbWVdKSByZXR1cm4gdW5pcXVlc1tjbGFzc05hbWVdID0gY2xhc3NOYW1lXG4gICAgfSkuc29ydCgpXG59XG5cbmFjY2Vzc29ycy5jbGFzc05hbWUgPSBmdW5jdGlvbihjbGFzc05hbWUpe1xuICAgIHJldHVybiAoY2xhc3NOYW1lICE9PSB1bmRlZmluZWQpID8gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICBub2RlLmNsYXNzTmFtZSA9IGNsYXNzZXMoY2xhc3NOYW1lKS5qb2luKFwiIFwiKVxuICAgIH0pIDogY2xhc3Nlcyh0aGlzWzBdLmNsYXNzTmFtZSkuam9pbihcIiBcIilcbn1cblxuLy8gYXR0cmlidXRlXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIGF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSwgdmFsdWUpe1xuICAgICAgICB2YXIgYWNjZXNzb3IgPSBhY2Nlc3NvcnNbbmFtZV1cbiAgICAgICAgaWYgKGFjY2Vzc29yKSByZXR1cm4gYWNjZXNzb3IuY2FsbCh0aGlzLCB2YWx1ZSlcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHJldHVybiB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSlcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gdGhpcy5yZW1vdmVBdHRyaWJ1dGUobmFtZSlcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKVxuICAgIH1cblxufSlcblxuJC5pbXBsZW1lbnQoYWNjZXNzb3JzKVxuXG4vLyBzaG9ydGN1dHNcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgY2hlY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrZWQodHJ1ZSlcbiAgICB9LFxuXG4gICAgdW5jaGVjazogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tlZChmYWxzZSlcbiAgICB9LFxuXG4gICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQodHJ1ZSlcbiAgICB9LFxuXG4gICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZChmYWxzZSlcbiAgICB9LFxuXG4gICAgc2VsZWN0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZCh0cnVlKVxuICAgIH0sXG5cbiAgICBkZXNlbGVjdDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQoZmFsc2UpXG4gICAgfVxuXG59KVxuXG4vLyBjbGFzc05hbWVzLCBoYXMgLyBhZGQgLyByZW1vdmUgQ2xhc3NcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgY2xhc3NOYW1lczogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGNsYXNzZXModGhpc1swXS5jbGFzc05hbWUpXG4gICAgfSxcblxuICAgIGhhc0NsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpe1xuICAgICAgICByZXR1cm4gaW5kZXhPZih0aGlzLmNsYXNzTmFtZXMoKSwgY2xhc3NOYW1lKSA+IC0xXG4gICAgfSxcblxuICAgIGFkZENsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpe1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIG5vZGVDbGFzc05hbWUgPSBub2RlLmNsYXNzTmFtZVxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBjbGFzc2VzKG5vZGVDbGFzc05hbWUgKyBcIiBcIiArIGNsYXNzTmFtZSkuam9pbihcIiBcIilcbiAgICAgICAgICAgIGlmIChub2RlQ2xhc3NOYW1lICE9PSBjbGFzc05hbWVzKSBub2RlLmNsYXNzTmFtZSA9IGNsYXNzTmFtZXNcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKGNsYXNzTmFtZSl7XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lcyA9IGNsYXNzZXMobm9kZS5jbGFzc05hbWUpXG4gICAgICAgICAgICBmb3JFYWNoKGNsYXNzZXMoY2xhc3NOYW1lKSwgZnVuY3Rpb24oY2xhc3NOYW1lKXtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKGNsYXNzTmFtZXMsIGNsYXNzTmFtZSlcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgY2xhc3NOYW1lcy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgbm9kZS5jbGFzc05hbWUgPSBjbGFzc05hbWVzLmpvaW4oXCIgXCIpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUsIGZvcmNlKXtcbiAgICAgICAgdmFyIGFkZCA9IGZvcmNlICE9PSB1bmRlZmluZWQgPyBmb3JjZSA6ICF0aGlzLmhhc0NsYXNzKGNsYXNzTmFtZSlcbiAgICAgICAgaWYgKGFkZClcbiAgICAgICAgICAgIHRoaXMuYWRkQ2xhc3MoY2xhc3NOYW1lKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNsYXNzKGNsYXNzTmFtZSlcbiAgICAgICAgcmV0dXJuICEhYWRkXG4gICAgfVxuXG59KVxuXG4vLyB0b1N0cmluZ1xuXG4kLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHRhZyAgICAgPSB0aGlzLnRhZygpLFxuICAgICAgICBpZCAgICAgID0gdGhpcy5pZCgpLFxuICAgICAgICBjbGFzc2VzID0gdGhpcy5jbGFzc05hbWVzKClcblxuICAgIHZhciBzdHIgPSB0YWdcbiAgICBpZiAoaWQpIHN0ciArPSAnIycgKyBpZFxuICAgIGlmIChjbGFzc2VzLmxlbmd0aCkgc3RyICs9ICcuJyArIGNsYXNzZXMuam9pbihcIi5cIilcbiAgICByZXR1cm4gc3RyXG59XG5cbnZhciB0ZXh0UHJvcGVydHkgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykudGV4dENvbnRlbnQgPT0gbnVsbCkgPyAnaW5uZXJUZXh0JyA6ICd0ZXh0Q29udGVudCdcblxuLy8gdGFnLCBodG1sLCB0ZXh0LCBkYXRhXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIHRhZzogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXNbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpXG4gICAgfSxcblxuICAgIGh0bWw6IGZ1bmN0aW9uKGh0bWwpe1xuICAgICAgICByZXR1cm4gKGh0bWwgIT09IHVuZGVmaW5lZCkgPyB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBub2RlLmlubmVySFRNTCA9IGh0bWxcbiAgICAgICAgfSkgOiB0aGlzWzBdLmlubmVySFRNTFxuICAgIH0sXG5cbiAgICB0ZXh0OiBmdW5jdGlvbih0ZXh0KXtcbiAgICAgICAgcmV0dXJuICh0ZXh0ICE9PSB1bmRlZmluZWQpID8gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgbm9kZVt0ZXh0UHJvcGVydHldID0gdGV4dFxuICAgICAgICB9KSA6IHRoaXNbMF1bdGV4dFByb3BlcnR5XVxuICAgIH0sXG5cbiAgICBkYXRhOiBmdW5jdGlvbihrZXksIHZhbHVlKXtcbiAgICAgICAgc3dpdGNoKHZhbHVlKSB7XG4gICAgICAgICAgICBjYXNlIHVuZGVmaW5lZDogcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKFwiZGF0YS1cIiArIGtleSlcbiAgICAgICAgICAgIGNhc2UgbnVsbDogcmV0dXJuIHRoaXMucmVtb3ZlQXR0cmlidXRlKFwiZGF0YS1cIiArIGtleSlcbiAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiB0aGlzLnNldEF0dHJpYnV0ZShcImRhdGEtXCIgKyBrZXksIHZhbHVlKVxuICAgICAgICB9XG4gICAgfVxuXG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9ICRcbiIsIi8qXG5lbGVtZW50c1xuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgcHJpbWUgICA9IHJlcXVpcmUoXCJwcmltZVwiKVxuXG52YXIgZm9yRWFjaCA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZvckVhY2hcIiksXG4gICAgbWFwICAgICA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L21hcFwiKSxcbiAgICBmaWx0ZXIgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvZmlsdGVyXCIpLFxuICAgIGV2ZXJ5ICAgPSByZXF1aXJlKFwibW91dC9hcnJheS9ldmVyeVwiKSxcbiAgICBzb21lICAgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvc29tZVwiKVxuXG4vLyB1bmlxdWVJRFxuXG52YXIgaW5kZXggPSAwLFxuICAgIF9fZGMgPSBkb2N1bWVudC5fX2NvdW50ZXIsXG4gICAgY291bnRlciA9IGRvY3VtZW50Ll9fY291bnRlciA9IChfX2RjID8gcGFyc2VJbnQoX19kYywgMzYpICsgMSA6IDApLnRvU3RyaW5nKDM2KSxcbiAgICBrZXkgPSBcInVpZDpcIiArIGNvdW50ZXJcblxudmFyIHVuaXF1ZUlEID0gZnVuY3Rpb24obil7XG4gICAgaWYgKG4gPT09IHdpbmRvdykgcmV0dXJuIFwid2luZG93XCJcbiAgICBpZiAobiA9PT0gZG9jdW1lbnQpIHJldHVybiBcImRvY3VtZW50XCJcbiAgICBpZiAobiA9PT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSByZXR1cm4gXCJodG1sXCJcbiAgICByZXR1cm4gbltrZXldIHx8IChuW2tleV0gPSAoaW5kZXgrKykudG9TdHJpbmcoMzYpKVxufVxuXG52YXIgaW5zdGFuY2VzID0ge31cblxuLy8gZWxlbWVudHMgcHJpbWVcblxudmFyICQgPSBwcmltZSh7Y29uc3RydWN0b3I6IGZ1bmN0aW9uICQobiwgY29udGV4dCl7XG5cbiAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gKHRoaXMgJiYgdGhpcy5jb25zdHJ1Y3RvciA9PT0gJCkgPyBuZXcgRWxlbWVudHMgOiBudWxsXG5cbiAgICB2YXIgc2VsZiwgdWlkXG5cbiAgICBpZiAobi5jb25zdHJ1Y3RvciAhPT0gRWxlbWVudHMpe1xuXG4gICAgICAgIHNlbGYgPSBuZXcgRWxlbWVudHNcblxuICAgICAgICBpZiAodHlwZW9mIG4gPT09IFwic3RyaW5nXCIpe1xuICAgICAgICAgICAgaWYgKCFzZWxmLnNlYXJjaCkgcmV0dXJuIG51bGxcbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBjb250ZXh0IHx8IGRvY3VtZW50XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5zZWFyY2gobilcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuLm5vZGVUeXBlIHx8IG4gPT09IHdpbmRvdyl7XG5cbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBuXG5cbiAgICAgICAgfSBlbHNlIGlmIChuLmxlbmd0aCl7XG5cbiAgICAgICAgICAgIC8vIHRoaXMgY291bGQgYmUgYW4gYXJyYXksIG9yIGFueSBvYmplY3Qgd2l0aCBhIGxlbmd0aCBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAvLyBpbmNsdWRpbmcgYW5vdGhlciBpbnN0YW5jZSBvZiBlbGVtZW50cyBmcm9tIGFub3RoZXIgaW50ZXJmYWNlLlxuXG4gICAgICAgICAgICB2YXIgdW5pcXVlcyA9IHt9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbi5sZW5ndGg7IGkgPCBsOyBpKyspeyAvLyBwZXJmb3JtIGVsZW1lbnRzIGZsYXR0ZW5pbmdcbiAgICAgICAgICAgICAgICB2YXIgbm9kZXMgPSAkKG5baV0sIGNvbnRleHQpXG4gICAgICAgICAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkgZm9yICh2YXIgaiA9IDAsIGsgPSBub2Rlcy5sZW5ndGg7IGogPCBrOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2pdXG4gICAgICAgICAgICAgICAgICAgIHVpZCA9IHVuaXF1ZUlEKG5vZGUpXG4gICAgICAgICAgICAgICAgICAgIGlmICghdW5pcXVlc1t1aWRdKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBub2RlXG4gICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVzW3VpZF0gPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYgPSBuXG4gICAgfVxuXG4gICAgaWYgKCFzZWxmLmxlbmd0aCkgcmV0dXJuIG51bGxcblxuICAgIC8vIHdoZW4gbGVuZ3RoIGlzIDEgYWx3YXlzIHVzZSB0aGUgc2FtZSBlbGVtZW50cyBpbnN0YW5jZVxuXG4gICAgaWYgKHNlbGYubGVuZ3RoID09PSAxKXtcbiAgICAgICAgdWlkID0gdW5pcXVlSUQoc2VsZlswXSlcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlc1t1aWRdIHx8IChpbnN0YW5jZXNbdWlkXSA9IHNlbGYpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGZcblxufX0pXG5cbnZhciBFbGVtZW50cyA9IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiAkLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIEVsZW1lbnRzKCl7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMFxuICAgIH0sXG5cbiAgICB1bmxpbms6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIGRlbGV0ZSBpbnN0YW5jZXNbdW5pcXVlSUQobm9kZSldXG4gICAgICAgICAgICByZXR1cm4gbm9kZVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvLyBtZXRob2RzXG5cbiAgICBmb3JFYWNoOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICBmb3JFYWNoKHRoaXMsIG1ldGhvZCwgY29udGV4dClcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgbWFwOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gbWFwKHRoaXMsIG1ldGhvZCwgY29udGV4dClcbiAgICB9LFxuXG4gICAgZmlsdGVyOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gZmlsdGVyKHRoaXMsIG1ldGhvZCwgY29udGV4dClcbiAgICB9LFxuXG4gICAgZXZlcnk6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBldmVyeSh0aGlzLCBtZXRob2QsIGNvbnRleHQpXG4gICAgfSxcblxuICAgIHNvbWU6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBzb21lKHRoaXMsIG1ldGhvZCwgY29udGV4dClcbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gJFxuIiwiLypcbmRlbGVnYXRpb25cbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIE1hcCA9IHJlcXVpcmUoXCJwcmltZS9tYXBcIilcblxudmFyICQgPSByZXF1aXJlKFwiLi9ldmVudHNcIilcbiAgICAgICAgcmVxdWlyZSgnLi90cmF2ZXJzYWwnKVxuXG4kLmltcGxlbWVudCh7XG5cbiAgICBkZWxlZ2F0ZTogZnVuY3Rpb24oZXZlbnQsIHNlbGVjdG9yLCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG5cbiAgICAgICAgICAgIHZhciBzZWxmID0gJChub2RlKVxuXG4gICAgICAgICAgICB2YXIgZGVsZWdhdGlvbiA9IHNlbGYuX2RlbGVnYXRpb24gfHwgKHNlbGYuX2RlbGVnYXRpb24gPSB7fSksXG4gICAgICAgICAgICAgICAgZXZlbnRzICAgICA9IGRlbGVnYXRpb25bZXZlbnRdIHx8IChkZWxlZ2F0aW9uW2V2ZW50XSA9IHt9KSxcbiAgICAgICAgICAgICAgICBtYXAgICAgICAgID0gKGV2ZW50c1tzZWxlY3Rvcl0gfHwgKGV2ZW50c1tzZWxlY3Rvcl0gPSBuZXcgTWFwKSlcblxuICAgICAgICAgICAgaWYgKG1hcC5nZXQoaGFuZGxlKSkgcmV0dXJuXG5cbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQpLFxuICAgICAgICAgICAgICAgICAgICBtYXRjaCAgPSB0YXJnZXQubWF0Y2hlcyhzZWxlY3RvcikgPyB0YXJnZXQgOiB0YXJnZXQucGFyZW50KHNlbGVjdG9yKVxuXG4gICAgICAgICAgICAgICAgdmFyIHJlc1xuXG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSByZXMgPSBoYW5kbGUuY2FsbChzZWxmLCBlLCBtYXRjaClcblxuICAgICAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWFwLnNldChoYW5kbGUsIGFjdGlvbilcblxuICAgICAgICAgICAgc2VsZi5vbihldmVudCwgYWN0aW9uLCB1c2VDYXB0dXJlKVxuXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgdW5kZWxlZ2F0ZTogZnVuY3Rpb24oZXZlbnQsIHNlbGVjdG9yLCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG5cbiAgICAgICAgICAgIHZhciBzZWxmID0gJChub2RlKSwgZGVsZWdhdGlvbiwgZXZlbnRzLCBtYXBcblxuICAgICAgICAgICAgaWYgKCEoZGVsZWdhdGlvbiA9IHNlbGYuX2RlbGVnYXRpb24pIHx8ICEoZXZlbnRzID0gZGVsZWdhdGlvbltldmVudF0pIHx8ICEobWFwID0gZXZlbnRzW3NlbGVjdG9yXSkpIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9IG1hcC5nZXQoaGFuZGxlKVxuXG4gICAgICAgICAgICBpZiAoYWN0aW9uKXtcbiAgICAgICAgICAgICAgICBzZWxmLm9mZihldmVudCwgYWN0aW9uLCB1c2VDYXB0dXJlKVxuICAgICAgICAgICAgICAgIG1hcC5yZW1vdmUoYWN0aW9uKVxuXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIG1vcmUgaGFuZGxlcyBpbiBhIGdpdmVuIHNlbGVjdG9yLCBkZWxldGUgaXRcbiAgICAgICAgICAgICAgICBpZiAoIW1hcC5jb3VudCgpKSBkZWxldGUgZXZlbnRzW3NlbGVjdG9yXVxuICAgICAgICAgICAgICAgIC8vIHZhciBldmMgPSBldmQgPSAwLCB4XG4gICAgICAgICAgICAgICAgdmFyIGUxID0gdHJ1ZSwgZTIgPSB0cnVlLCB4XG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGV2ZW50cyl7XG4gICAgICAgICAgICAgICAgICAgIGUxID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgbm8gbW9yZSBzZWxlY3RvcnMgaW4gYSBnaXZlbiBldmVudCB0eXBlLCBkZWxldGUgaXRcbiAgICAgICAgICAgICAgICBpZiAoZTEpIGRlbGV0ZSBkZWxlZ2F0aW9uW2V2ZW50XVxuICAgICAgICAgICAgICAgIGZvciAoeCBpbiBkZWxlZ2F0aW9uKXtcbiAgICAgICAgICAgICAgICAgICAgZTIgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gbW9yZSBkZWxlZ2F0aW9uIGV2ZW50cyBpbiB0aGUgZWxlbWVudCwgZGVsZXRlIHRoZSBfZGVsZWdhdGlvbiBvYmplY3RcbiAgICAgICAgICAgICAgICBpZiAoZTIpIGRlbGV0ZSBzZWxmLl9kZWxlZ2F0aW9uXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSlcblxuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuZG9tcmVhZHlcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyICQgPSByZXF1aXJlKFwiLi9ldmVudHNcIilcblxudmFyIHJlYWR5c3RhdGVjaGFuZ2UgPSAnb25yZWFkeXN0YXRlY2hhbmdlJyBpbiBkb2N1bWVudCxcbiAgICBzaG91bGRQb2xsICAgICAgID0gZmFsc2UsXG4gICAgbG9hZGVkICAgICAgICAgICA9IGZhbHNlLFxuICAgIHJlYWR5cyAgICAgICAgICAgPSBbXSxcbiAgICBjaGVja3MgICAgICAgICAgID0gW10sXG4gICAgcmVhZHkgICAgICAgICAgICA9IG51bGwsXG4gICAgdGltZXIgICAgICAgICAgICA9IG51bGwsXG4gICAgdGVzdCAgICAgICAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgIGRvYyAgICAgICAgICAgICAgPSAkKGRvY3VtZW50KSxcbiAgICB3aW4gICAgICAgICAgICAgID0gJCh3aW5kb3cpXG5cbnZhciBkb21yZWFkeSA9IGZ1bmN0aW9uKCl7XG5cbiAgICBpZiAodGltZXIpIHRpbWVyID0gY2xlYXJUaW1lb3V0KHRpbWVyKVxuXG4gICAgaWYgKCFsb2FkZWQpe1xuXG4gICAgICAgIGlmIChyZWFkeXN0YXRlY2hhbmdlKSBkb2Mub2ZmKCdyZWFkeXN0YXRlY2hhbmdlJywgY2hlY2spXG4gICAgICAgIGRvYy5vZmYoJ0RPTUNvbnRlbnRMb2FkZWQnLCBkb21yZWFkeSlcbiAgICAgICAgd2luLm9mZignbG9hZCcsIGRvbXJlYWR5KVxuXG4gICAgICAgIGxvYWRlZCA9IHRydWVcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgcmVhZHkgPSByZWFkeXNbaSsrXTspIHJlYWR5KClcbiAgICB9XG5cbiAgICByZXR1cm4gbG9hZGVkXG5cbn1cblxudmFyIGNoZWNrID0gZnVuY3Rpb24oKXtcbiAgICBmb3IgKHZhciBpID0gY2hlY2tzLmxlbmd0aDsgaS0tOykgaWYgKGNoZWNrc1tpXSgpKSByZXR1cm4gZG9tcmVhZHkoKVxuICAgIHJldHVybiBmYWxzZVxufVxuXG52YXIgcG9sbCA9IGZ1bmN0aW9uKCl7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxuICAgIGlmICghY2hlY2soKSkgdGltZXIgPSBzZXRUaW1lb3V0KHBvbGwsIDFlMyAvIDYwKVxufVxuXG5pZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSl7IC8vIHVzZSByZWFkeVN0YXRlIGlmIGF2YWlsYWJsZVxuXG4gICAgdmFyIGNvbXBsZXRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICEhKC9sb2FkZWR8Y29tcGxldGUvKS50ZXN0KGRvY3VtZW50LnJlYWR5U3RhdGUpXG4gICAgfVxuXG4gICAgY2hlY2tzLnB1c2goY29tcGxldGUpXG5cbiAgICBpZiAoIWNvbXBsZXRlKCkpeyAvLyB1bmxlc3MgZG9tIGlzIGFscmVhZHkgbG9hZGVkXG4gICAgICAgIGlmIChyZWFkeXN0YXRlY2hhbmdlKSBkb2Mub24oJ3JlYWR5c3RhdGVjaGFuZ2UnLCBjaGVjaykgLy8gb25yZWFkeXN0YXRlY2hhbmdlIGV2ZW50XG4gICAgICAgIGVsc2Ugc2hvdWxkUG9sbCA9IHRydWUgLy9vciBwb2xsIHJlYWR5U3RhdGUgY2hlY2tcbiAgICB9IGVsc2UgeyAvLyBkb20gaXMgYWxyZWFkeSBsb2FkZWRcbiAgICAgICAgZG9tcmVhZHkoKVxuICAgIH1cblxufVxuXG5pZiAodGVzdC5kb1Njcm9sbCl7IC8vIGFsc28gdXNlIGRvU2Nyb2xsIGlmIGF2YWlsYWJsZSAoZG9zY3JvbGwgY29tZXMgYmVmb3JlIHJlYWR5U3RhdGUgXCJjb21wbGV0ZVwiKVxuXG4gICAgLy8gTEVHQUwgREVQVDpcbiAgICAvLyBkb1Njcm9sbCB0ZWNobmlxdWUgZGlzY292ZXJlZCBieSwgb3duZWQgYnksIGFuZCBjb3B5cmlnaHRlZCB0byBEaWVnbyBQZXJpbmkgaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC9cblxuICAgIC8vIHRlc3RFbGVtZW50LmRvU2Nyb2xsKCkgdGhyb3dzIHdoZW4gdGhlIERPTSBpcyBub3QgcmVhZHksIG9ubHkgaW4gdGhlIHRvcCB3aW5kb3dcblxuICAgIHZhciBzY3JvbGxzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRlc3QuZG9TY3JvbGwoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSBjYXRjaCAoZSl7fVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICAvLyBJZiBkb1Njcm9sbCB3b3JrcyBhbHJlYWR5LCBpdCBjYW4ndCBiZSB1c2VkIHRvIGRldGVybWluZSBkb21yZWFkeVxuICAgIC8vIGUuZy4gaW4gYW4gaWZyYW1lXG5cbiAgICBpZiAoIXNjcm9sbHMoKSl7XG4gICAgICAgIGNoZWNrcy5wdXNoKHNjcm9sbHMpXG4gICAgICAgIHNob3VsZFBvbGwgPSB0cnVlXG4gICAgfVxuXG59XG5cbmlmIChzaG91bGRQb2xsKSBwb2xsKClcblxuLy8gbWFrZSBzdXJlIHRoYXQgZG9tcmVhZHkgZmlyZXMgYmVmb3JlIGxvYWQsIGFsc28gaWYgbm90IG9ucmVhZHlzdGF0ZWNoYW5nZSBhbmQgZG9TY3JvbGwgYW5kIERPTUNvbnRlbnRMb2FkZWQgbG9hZCB3aWxsIGZpcmVcbmRvYy5vbignRE9NQ29udGVudExvYWRlZCcsIGRvbXJlYWR5KVxud2luLm9uKCdsb2FkJywgZG9tcmVhZHkpXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ocmVhZHkpe1xuICAgIChsb2FkZWQpID8gcmVhZHkoKSA6IHJlYWR5cy5wdXNoKHJlYWR5KVxuICAgIHJldHVybiBudWxsXG59XG4iLCIvKlxuZXZlbnRzXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBFbWl0dGVyID0gcmVxdWlyZShcInByaW1lL2VtaXR0ZXJcIilcblxudmFyICQgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG5cbnZhciBodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XG5cbnZhciBhZGRFdmVudExpc3RlbmVyID0gaHRtbC5hZGRFdmVudExpc3RlbmVyID8gZnVuY3Rpb24obm9kZSwgZXZlbnQsIGhhbmRsZSwgdXNlQ2FwdHVyZSl7XG4gICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGUsIHVzZUNhcHR1cmUgfHwgZmFsc2UpXG4gICAgcmV0dXJuIGhhbmRsZVxufSA6IGZ1bmN0aW9uKG5vZGUsIGV2ZW50LCBoYW5kbGUpe1xuICAgIG5vZGUuYXR0YWNoRXZlbnQoJ29uJyArIGV2ZW50LCBoYW5kbGUpXG4gICAgcmV0dXJuIGhhbmRsZVxufVxuXG52YXIgcmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGh0bWwucmVtb3ZlRXZlbnRMaXN0ZW5lciA/IGZ1bmN0aW9uKG5vZGUsIGV2ZW50LCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuICAgIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlLCB1c2VDYXB0dXJlIHx8IGZhbHNlKVxufSA6IGZ1bmN0aW9uKG5vZGUsIGV2ZW50LCBoYW5kbGUpe1xuICAgIG5vZGUuZGV0YWNoRXZlbnQoXCJvblwiICsgZXZlbnQsIGhhbmRsZSlcbn1cblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgb246IGZ1bmN0aW9uKGV2ZW50LCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICB2YXIgc2VsZiA9ICQobm9kZSlcblxuICAgICAgICAgICAgdmFyIGludGVybmFsRXZlbnQgPSBldmVudCArICh1c2VDYXB0dXJlID8gXCI6Y2FwdHVyZVwiIDogXCJcIilcblxuICAgICAgICAgICAgRW1pdHRlci5wcm90b3R5cGUub24uY2FsbChzZWxmLCBpbnRlcm5hbEV2ZW50LCBoYW5kbGUpXG5cbiAgICAgICAgICAgIHZhciBkb21MaXN0ZW5lcnMgPSBzZWxmLl9kb21MaXN0ZW5lcnMgfHwgKHNlbGYuX2RvbUxpc3RlbmVycyA9IHt9KVxuICAgICAgICAgICAgaWYgKCFkb21MaXN0ZW5lcnNbaW50ZXJuYWxFdmVudF0pIGRvbUxpc3RlbmVyc1tpbnRlcm5hbEV2ZW50XSA9IGFkZEV2ZW50TGlzdGVuZXIobm9kZSwgZXZlbnQsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIEVtaXR0ZXIucHJvdG90eXBlLmVtaXQuY2FsbChzZWxmLCBpbnRlcm5hbEV2ZW50LCBlIHx8IHdpbmRvdy5ldmVudCwgRW1pdHRlci5FTUlUX1NZTkMpXG4gICAgICAgICAgICB9LCB1c2VDYXB0dXJlKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBvZmY6IGZ1bmN0aW9uKGV2ZW50LCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG5cbiAgICAgICAgICAgIHZhciBzZWxmID0gJChub2RlKVxuXG4gICAgICAgICAgICB2YXIgaW50ZXJuYWxFdmVudCA9IGV2ZW50ICsgKHVzZUNhcHR1cmUgPyBcIjpjYXB0dXJlXCIgOiBcIlwiKVxuXG4gICAgICAgICAgICB2YXIgZG9tTGlzdGVuZXJzID0gc2VsZi5fZG9tTGlzdGVuZXJzLCBkb21FdmVudCwgbGlzdGVuZXJzID0gc2VsZi5fbGlzdGVuZXJzLCBldmVudHNcblxuICAgICAgICAgICAgaWYgKGRvbUxpc3RlbmVycyAmJiAoZG9tRXZlbnQgPSBkb21MaXN0ZW5lcnNbaW50ZXJuYWxFdmVudF0pICYmIGxpc3RlbmVycyAmJiAoZXZlbnRzID0gbGlzdGVuZXJzW2ludGVybmFsRXZlbnRdKSl7XG5cbiAgICAgICAgICAgICAgICBFbWl0dGVyLnByb3RvdHlwZS5vZmYuY2FsbChzZWxmLCBpbnRlcm5hbEV2ZW50LCBoYW5kbGUpXG5cbiAgICAgICAgICAgICAgICBpZiAoIXNlbGYuX2xpc3RlbmVycyB8fCAhc2VsZi5fbGlzdGVuZXJzW2V2ZW50XSl7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIobm9kZSwgZXZlbnQsIGRvbUV2ZW50KVxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgZG9tTGlzdGVuZXJzW2V2ZW50XVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGwgaW4gZG9tTGlzdGVuZXJzKSByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHNlbGYuX2RvbUxpc3RlbmVyc1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBlbWl0OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50c1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgRW1pdHRlci5wcm90b3R5cGUuZW1pdC5hcHBseSgkKG5vZGUpLCBhcmdzKVxuICAgICAgICB9KVxuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuZWxlbWVudHNcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyICQgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG4gICAgICAgIHJlcXVpcmUoXCIuL2F0dHJpYnV0ZXNcIilcbiAgICAgICAgcmVxdWlyZShcIi4vZXZlbnRzXCIpXG4gICAgICAgIHJlcXVpcmUoXCIuL2luc2VydGlvblwiKVxuICAgICAgICByZXF1aXJlKFwiLi90cmF2ZXJzYWxcIilcbiAgICAgICAgcmVxdWlyZShcIi4vZGVsZWdhdGlvblwiKVxuXG5tb2R1bGUuZXhwb3J0cyA9ICRcbiIsIi8qXG5pbnNlcnRpb25cbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyICQgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG5cbi8vIGJhc2UgaW5zZXJ0aW9uXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIGFwcGVuZENoaWxkOiBmdW5jdGlvbihjaGlsZCl7XG4gICAgICAgIHRoaXNbMF0uYXBwZW5kQ2hpbGQoJChjaGlsZClbMF0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIGluc2VydEJlZm9yZTogZnVuY3Rpb24oY2hpbGQsIHJlZil7XG4gICAgICAgIHRoaXNbMF0uaW5zZXJ0QmVmb3JlKCQoY2hpbGQpWzBdLCAkKHJlZilbMF0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHJlbW92ZUNoaWxkOiBmdW5jdGlvbihjaGlsZCl7XG4gICAgICAgIHRoaXNbMF0ucmVtb3ZlQ2hpbGQoJChjaGlsZClbMF0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHJlcGxhY2VDaGlsZDogZnVuY3Rpb24oY2hpbGQsIHJlZil7XG4gICAgICAgIHRoaXNbMF0ucmVwbGFjZUNoaWxkKCQoY2hpbGQpWzBdLCAkKHJlZilbMF0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfVxuXG59KVxuXG4vLyBiZWZvcmUsIGFmdGVyLCBib3R0b20sIHRvcFxuXG4kLmltcGxlbWVudCh7XG5cbiAgICBiZWZvcmU6IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KVswXVxuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlXG4gICAgICAgIGlmIChwYXJlbnQpIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbWVudClcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgYWZ0ZXI6IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KVswXVxuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlXG4gICAgICAgIGlmIChwYXJlbnQpIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbWVudC5uZXh0U2libGluZylcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgYm90dG9tOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudClbMF1cbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSlcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgdG9wOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudClbMF1cbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIGVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQuZmlyc3RDaGlsZClcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbi8vIGluc2VydCwgcmVwbGFjZVxuXG4kLmltcGxlbWVudCh7XG5cbiAgICBpbnNlcnQ6ICQucHJvdG90eXBlLmJvdHRvbSxcblxuICAgIHJlbW92ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGVcbiAgICAgICAgICAgIGlmIChwYXJlbnQpIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICByZXBsYWNlOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudClbMF1cbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh0aGlzWzBdLCBlbGVtZW50KVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCJ2YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogQXJyYXkgZXZlcnlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBldmVyeShhcnIsIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpID0gLTEsIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIC8vIHdlIGl0ZXJhdGUgb3ZlciBzcGFyc2UgaXRlbXMgc2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIG1ha2UgaXRcbiAgICAgICAgICAgIC8vIHdvcmsgcHJvcGVybHkgb24gSUUgNy04LiBzZWUgIzY0XG4gICAgICAgICAgICBpZiAoIWNhbGxiYWNrKGFycltpXSwgaSwgYXJyKSApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBldmVyeTtcblxuIiwidmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIEFycmF5IGZpbHRlclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbHRlcihhcnIsIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpID0gLTEsIGxlbiA9IGFyci5sZW5ndGgsIHZhbHVlO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGFycltpXTtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayh2YWx1ZSwgaSwgYXJyKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZpbHRlcjtcblxuXG4iLCJ2YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogQXJyYXkgbWFwXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwKGFyciwgY2FsbGJhY2ssIHRoaXNPYmopIHtcbiAgICAgICAgY2FsbGJhY2sgPSBtYWtlSXRlcmF0b3IoY2FsbGJhY2ssIHRoaXNPYmopO1xuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICBpZiAoYXJyID09IG51bGwpe1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xLCBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICByZXN1bHRzW2ldID0gY2FsbGJhY2soYXJyW2ldLCBpLCBhcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgIG1vZHVsZS5leHBvcnRzID0gbWFwO1xuXG4iLCJ2YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogQXJyYXkgc29tZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvbWUoYXJyLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgLy8gd2UgaXRlcmF0ZSBvdmVyIHNwYXJzZSBpdGVtcyBzaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gbWFrZSBpdFxuICAgICAgICAgICAgLy8gd29yayBwcm9wZXJseSBvbiBJRSA3LTguIHNlZSAjNjRcbiAgICAgICAgICAgIGlmICggY2FsbGJhY2soYXJyW2ldLCBpLCBhcnIpICkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc29tZTtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBmaXJzdCBhcmd1bWVudCBwcm92aWRlZCB0byBpdC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpZGVudGl0eSh2YWwpe1xuICAgICAgICByZXR1cm4gdmFsO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gaWRlbnRpdHk7XG5cblxuIiwidmFyIGlkZW50aXR5ID0gcmVxdWlyZSgnLi9pZGVudGl0eScpO1xudmFyIHByb3AgPSByZXF1aXJlKCcuL3Byb3AnKTtcbnZhciBkZWVwTWF0Y2hlcyA9IHJlcXVpcmUoJy4uL29iamVjdC9kZWVwTWF0Y2hlcycpO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYXJndW1lbnQgaW50byBhIHZhbGlkIGl0ZXJhdG9yLlxuICAgICAqIFVzZWQgaW50ZXJuYWxseSBvbiBtb3N0IGFycmF5L29iamVjdC9jb2xsZWN0aW9uIG1ldGhvZHMgdGhhdCByZWNlaXZlcyBhXG4gICAgICogY2FsbGJhY2svaXRlcmF0b3IgcHJvdmlkaW5nIGEgc2hvcnRjdXQgc3ludGF4LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VJdGVyYXRvcihzcmMsIHRoaXNPYmope1xuICAgICAgICBpZiAoc3JjID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBpZGVudGl0eTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2godHlwZW9mIHNyYykge1xuICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uIGlzIHRoZSBmaXJzdCB0byBpbXByb3ZlIHBlcmYgKG1vc3QgY29tbW9uIGNhc2UpXG4gICAgICAgICAgICAgICAgLy8gYWxzbyBhdm9pZCB1c2luZyBgRnVuY3Rpb24jY2FsbGAgaWYgbm90IG5lZWRlZCwgd2hpY2ggYm9vc3RzXG4gICAgICAgICAgICAgICAgLy8gcGVyZiBhIGxvdCBpbiBzb21lIGNhc2VzXG4gICAgICAgICAgICAgICAgcmV0dXJuICh0eXBlb2YgdGhpc09iaiAhPT0gJ3VuZGVmaW5lZCcpPyBmdW5jdGlvbih2YWwsIGksIGFycil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzcmMuY2FsbCh0aGlzT2JqLCB2YWwsIGksIGFycik7XG4gICAgICAgICAgICAgICAgfSA6IHNyYztcbiAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWVwTWF0Y2hlcyh2YWwsIHNyYyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wKHNyYyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1ha2VJdGVyYXRvcjtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGdldHMgYSBwcm9wZXJ0eSBvZiB0aGUgcGFzc2VkIG9iamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByb3AobmFtZSl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgcmV0dXJuIG9ialtuYW1lXTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHByb3A7XG5cblxuIiwidmFyIGZvck93biA9IHJlcXVpcmUoJy4vZm9yT3duJyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNBcnJheScpO1xuXG4gICAgZnVuY3Rpb24gY29udGFpbnNNYXRjaChhcnJheSwgcGF0dGVybikge1xuICAgICAgICB2YXIgaSA9IC0xLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChkZWVwTWF0Y2hlcyhhcnJheVtpXSwgcGF0dGVybikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYXRjaEFycmF5KHRhcmdldCwgcGF0dGVybikge1xuICAgICAgICB2YXIgaSA9IC0xLCBwYXR0ZXJuTGVuZ3RoID0gcGF0dGVybi5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBwYXR0ZXJuTGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5zTWF0Y2godGFyZ2V0LCBwYXR0ZXJuW2ldKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1hdGNoT2JqZWN0KHRhcmdldCwgcGF0dGVybikge1xuICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgZm9yT3duKHBhdHRlcm4sIGZ1bmN0aW9uKHZhbCwga2V5KSB7XG4gICAgICAgICAgICBpZiAoIWRlZXBNYXRjaGVzKHRhcmdldFtrZXldLCB2YWwpKSB7XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIHRvIGJyZWFrIG91dCBvZiBmb3JPd24gZWFybHlcbiAgICAgICAgICAgICAgICByZXR1cm4gKHJlc3VsdCA9IGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWN1cnNpdmVseSBjaGVjayBpZiB0aGUgb2JqZWN0cyBtYXRjaC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWVwTWF0Y2hlcyh0YXJnZXQsIHBhdHRlcm4pe1xuICAgICAgICBpZiAodGFyZ2V0ICYmIHR5cGVvZiB0YXJnZXQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAoaXNBcnJheSh0YXJnZXQpICYmIGlzQXJyYXkocGF0dGVybikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hBcnJheSh0YXJnZXQsIHBhdHRlcm4pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hPYmplY3QodGFyZ2V0LCBwYXR0ZXJuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQgPT09IHBhdHRlcm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGRlZXBNYXRjaGVzO1xuXG5cbiIsIi8qXG50cmF2ZXJzYWxcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIG1hcCA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L21hcFwiKVxuXG52YXIgc2xpY2sgPSByZXF1aXJlKFwic2xpY2tcIilcblxudmFyICQgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG5cbnZhciBnZW4gPSBmdW5jdGlvbihjb21iaW5hdG9yLCBleHByZXNzaW9uKXtcbiAgICByZXR1cm4gbWFwKHNsaWNrLnBhcnNlKGV4cHJlc3Npb24gfHwgXCIqXCIpLCBmdW5jdGlvbihwYXJ0KXtcbiAgICAgICAgcmV0dXJuIGNvbWJpbmF0b3IgKyBcIiBcIiArIHBhcnRcbiAgICB9KS5qb2luKFwiLCBcIilcbn1cblxudmFyIHB1c2hfID0gQXJyYXkucHJvdG90eXBlLnB1c2hcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgc2VhcmNoOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAxKSByZXR1cm4gJChzbGljay5zZWFyY2goZXhwcmVzc2lvbiwgdGhpc1swXSwgbmV3ICQpKVxuXG4gICAgICAgIHZhciBidWZmZXIgPSBbXVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IHRoaXNbaV07IGkrKykgcHVzaF8uYXBwbHkoYnVmZmVyLCBzbGljay5zZWFyY2goZXhwcmVzc2lvbiwgbm9kZSkpXG4gICAgICAgIGJ1ZmZlciA9ICQoYnVmZmVyKVxuICAgICAgICByZXR1cm4gYnVmZmVyICYmIGJ1ZmZlci5zb3J0KClcbiAgICB9LFxuXG4gICAgZmluZDogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMSkgcmV0dXJuICQoc2xpY2suZmluZChleHByZXNzaW9uLCB0aGlzWzBdKSlcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IHRoaXNbaV07IGkrKykge1xuICAgICAgICAgICAgdmFyIGZvdW5kID0gc2xpY2suZmluZChleHByZXNzaW9uLCBub2RlKVxuICAgICAgICAgICAgaWYgKGZvdW5kKSByZXR1cm4gJChmb3VuZClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfSxcblxuICAgIHNvcnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBzbGljay5zb3J0KHRoaXMpXG4gICAgfSxcblxuICAgIG1hdGNoZXM6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gc2xpY2subWF0Y2hlcyh0aGlzWzBdLCBleHByZXNzaW9uKVxuICAgIH0sXG5cbiAgICBjb250YWluczogZnVuY3Rpb24obm9kZSl7XG4gICAgICAgIHJldHVybiBzbGljay5jb250YWlucyh0aGlzWzBdLCBub2RlKVxuICAgIH0sXG5cbiAgICBuZXh0U2libGluZ3M6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2goZ2VuKCd+JywgZXhwcmVzc2lvbikpXG4gICAgfSxcblxuICAgIG5leHRTaWJsaW5nOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZChnZW4oJysnLCBleHByZXNzaW9uKSlcbiAgICB9LFxuXG4gICAgcHJldmlvdXNTaWJsaW5nczogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLnNlYXJjaChnZW4oJyF+JywgZXhwcmVzc2lvbikpXG4gICAgfSxcblxuICAgIHByZXZpb3VzU2libGluZzogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmQoZ2VuKCchKycsIGV4cHJlc3Npb24pKVxuICAgIH0sXG5cbiAgICBjaGlsZHJlbjogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLnNlYXJjaChnZW4oJz4nLCBleHByZXNzaW9uKSlcbiAgICB9LFxuXG4gICAgZmlyc3RDaGlsZDogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmQoZ2VuKCdeJywgZXhwcmVzc2lvbikpXG4gICAgfSxcblxuICAgIGxhc3RDaGlsZDogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmQoZ2VuKCchXicsIGV4cHJlc3Npb24pKVxuICAgIH0sXG5cbiAgICBwYXJlbnQ6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICB2YXIgYnVmZmVyID0gW11cbiAgICAgICAgbG9vcDogZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSB0aGlzW2ldOyBpKyspIHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkgJiYgKG5vZGUgIT09IGRvY3VtZW50KSl7XG4gICAgICAgICAgICBpZiAoIWV4cHJlc3Npb24gfHwgc2xpY2subWF0Y2hlcyhub2RlLCBleHByZXNzaW9uKSl7XG4gICAgICAgICAgICAgICAgYnVmZmVyLnB1c2gobm9kZSlcbiAgICAgICAgICAgICAgICBicmVhayBsb29wXG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJChidWZmZXIpXG4gICAgfSxcblxuICAgIHBhcmVudHM6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICB2YXIgYnVmZmVyID0gW11cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSB0aGlzW2ldOyBpKyspIHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkgJiYgKG5vZGUgIT09IGRvY3VtZW50KSl7XG4gICAgICAgICAgICBpZiAoIWV4cHJlc3Npb24gfHwgc2xpY2subWF0Y2hlcyhub2RlLCBleHByZXNzaW9uKSkgYnVmZmVyLnB1c2gobm9kZSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJChidWZmZXIpXG4gICAgfVxuXG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9ICRcbiIsIi8qXG56ZW5cbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpLFxuICAgIG1hcCAgICAgPSByZXF1aXJlKFwibW91dC9hcnJheS9tYXBcIilcblxudmFyIHBhcnNlID0gcmVxdWlyZShcInNsaWNrL3BhcnNlclwiKVxuXG52YXIgJCA9IHJlcXVpcmUoXCIuL2Jhc2VcIilcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihleHByZXNzaW9uLCBkb2Mpe1xuXG4gICAgcmV0dXJuICQobWFwKHBhcnNlKGV4cHJlc3Npb24pLCBmdW5jdGlvbihleHByZXNzaW9uKXtcblxuICAgICAgICB2YXIgcHJldmlvdXMsIHJlc3VsdFxuXG4gICAgICAgIGZvckVhY2goZXhwcmVzc2lvbiwgZnVuY3Rpb24ocGFydCwgaSl7XG5cbiAgICAgICAgICAgIHZhciBub2RlID0gKGRvYyB8fCBkb2N1bWVudCkuY3JlYXRlRWxlbWVudChwYXJ0LnRhZylcblxuICAgICAgICAgICAgaWYgKHBhcnQuaWQpIG5vZGUuaWQgPSBwYXJ0LmlkXG5cbiAgICAgICAgICAgIGlmIChwYXJ0LmNsYXNzTGlzdCkgbm9kZS5jbGFzc05hbWUgPSBwYXJ0LmNsYXNzTGlzdC5qb2luKFwiIFwiKVxuXG4gICAgICAgICAgICBpZiAocGFydC5hdHRyaWJ1dGVzKSBmb3JFYWNoKHBhcnQuYXR0cmlidXRlcywgZnVuY3Rpb24oYXR0cmlidXRlKXtcbiAgICAgICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUubmFtZSwgYXR0cmlidXRlLnZhbHVlIHx8IFwiXCIpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpZiAocGFydC5wc2V1ZG9zKSBmb3JFYWNoKHBhcnQucHNldWRvcywgZnVuY3Rpb24ocHNldWRvKXtcbiAgICAgICAgICAgICAgICB2YXIgbiA9ICQobm9kZSksIG1ldGhvZCA9IG5bcHNldWRvLm5hbWVdXG4gICAgICAgICAgICAgICAgaWYgKG1ldGhvZCkgbWV0aG9kLmNhbGwobiwgcHNldWRvLnZhbHVlKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgaWYgKGkgPT09IDApe1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gbm9kZVxuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQuY29tYmluYXRvciA9PT0gXCIgXCIpe1xuXG4gICAgICAgICAgICAgICAgcHJldmlvdXMuYXBwZW5kQ2hpbGQobm9kZSlcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LmNvbWJpbmF0b3IgPT09IFwiK1wiKXtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50Tm9kZSA9IHByZXZpb3VzLnBhcmVudE5vZGVcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZSkgcGFyZW50Tm9kZS5hcHBlbmRDaGlsZChub2RlKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcmV2aW91cyA9IG5vZGVcblxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiByZXN1bHRcblxuICAgIH0pKVxuXG59XG4iLCIvKiAgICAgICAgICAuLSAgIDNcbi4tLi0uLi0uLi0uLXwtLl8uXG4nICcgJ2AtJ2AtJyAnICcgJ1xuKi9cInVzZSBzdHJpY3RcIlxuXG4vLyBjb2xvciBhbmQgdGltZXJcbnZhciBjb2xvciA9IHJlcXVpcmUoXCIuL2xpYi9jb2xvclwiKSxcbiAgICBmcmFtZSA9IHJlcXVpcmUoXCIuL2xpYi9mcmFtZVwiKVxuXG4vLyBpZiB3ZSdyZSBpbiBhIGJyb3dzZXIgd2UgbmVlZCAuL2Jyb3dzZXIsIG90aGVyd2lzZSAuL2Z4XG52YXIgbW9vZnggPSAodHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiKSA/IHJlcXVpcmUoXCIuL2xpYi9icm93c2VyXCIpIDogcmVxdWlyZShcIi4vbGliL2Z4XCIpXG5cbm1vb2Z4LnJlcXVlc3RGcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICBmcmFtZS5yZXF1ZXN0KGNhbGxiYWNrKVxuICAgIHJldHVybiB0aGlzXG59XG5cbm1vb2Z4LmNhbmNlbEZyYW1lID0gZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgIGZyYW1lLmNhbmNlbChjYWxsYmFjaylcbiAgICByZXR1cm4gdGhpc1xufVxuXG5tb29meC5jb2xvciA9IGNvbG9yXG5cbi8vIGFuZCBleHBvcnQgbW9vZnhcblxubW9kdWxlLmV4cG9ydHMgPSBtb29meFxuIiwiLypcbk1vb0Z4XG4qL1widXNlIHN0cmljdFwiXG5cbi8vIHJlcXVpcmVzXG5cbnZhciBjb2xvciAgPSByZXF1aXJlKFwiLi9jb2xvclwiKSxcbiAgICBmcmFtZSAgPSByZXF1aXJlKFwiLi9mcmFtZVwiKVxuXG52YXIgY2FuY2VsRnJhbWUgPSBmcmFtZS5jYW5jZWwsXG4gICAgcmVxdWVzdEZyYW1lID0gZnJhbWUucmVxdWVzdFxuXG52YXIgcHJpbWUgID0gcmVxdWlyZShcInByaW1lXCIpXG5cbnZhciBjYW1lbGl6ZSAgICAgICAgPSByZXF1aXJlKFwicHJpbWUvc3RyaW5nL2NhbWVsaXplXCIpLFxuICAgIGNsZWFuICAgICAgICAgICA9IHJlcXVpcmUoXCJwcmltZS9zdHJpbmcvY2xlYW5cIiksXG4gICAgY2FwaXRhbGl6ZSAgICAgID0gcmVxdWlyZShcInByaW1lL3N0cmluZy9jYXBpdGFsaXplXCIpLFxuICAgIGh5cGhlbmF0ZVN0cmluZyA9IHJlcXVpcmUoXCJwcmltZS9zdHJpbmcvaHlwaGVuYXRlXCIpXG5cbnZhciBtYXAgICAgID0gcmVxdWlyZShcInByaW1lL2FycmF5L21hcFwiKSxcbiAgICBmb3JFYWNoID0gcmVxdWlyZShcInByaW1lL2FycmF5L2ZvckVhY2hcIiksXG4gICAgaW5kZXhPZiA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9pbmRleE9mXCIpXG5cbnZhciBlbGVtZW50cyA9IHJlcXVpcmUoXCJlbGVtZW50c1wiKVxuXG52YXIgZnggPSByZXF1aXJlKFwiLi9meFwiKVxuXG4vLyB1dGlsXG5cbnZhciBtYXRjaFN0cmluZyA9IGZ1bmN0aW9uKHMsIHIpe1xuICAgIHJldHVybiBTdHJpbmcucHJvdG90eXBlLm1hdGNoLmNhbGwocywgcik7XG59XG5cbnZhciBoeXBoZW5hdGVkID0ge31cbnZhciBoeXBoZW5hdGUgPSBmdW5jdGlvbihzZWxmKXtcbiAgICByZXR1cm4gaHlwaGVuYXRlZFtzZWxmXSB8fCAoaHlwaGVuYXRlZFtzZWxmXSA9IGh5cGhlbmF0ZVN0cmluZyhzZWxmKSlcbn1cblxudmFyIHJvdW5kID0gZnVuY3Rpb24obil7XG4gICAgcmV0dXJuIE1hdGgucm91bmQobiAqIDFlMykgLyAxZTNcbn1cblxuLy8gY29tcHV0ZSA+IG5vZGUgPiBwcm9wZXJ0eVxuXG52YXIgY29tcHV0ZSA9IGdsb2JhbC5nZXRDb21wdXRlZFN0eWxlID8gZnVuY3Rpb24obm9kZSl7XG4gICAgdmFyIGN0cyA9IGdldENvbXB1dGVkU3R5bGUobm9kZSwgbnVsbClcbiAgICByZXR1cm4gZnVuY3Rpb24ocHJvcGVydHkpe1xuICAgICAgICByZXR1cm4gY3RzID8gY3RzLmdldFByb3BlcnR5VmFsdWUoaHlwaGVuYXRlKHByb3BlcnR5KSkgOiBcIlwiXG4gICAgfVxufSA6IC8qKGNzczMpPyovZnVuY3Rpb24obm9kZSl7XG4gICAgdmFyIGN0cyA9IG5vZGUuY3VycmVudFN0eWxlXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHByb3BlcnR5KXtcbiAgICAgICAgcmV0dXJuIGN0cyA/IGN0c1tjYW1lbGl6ZShwcm9wZXJ0eSldIDogXCJcIlxuICAgIH1cbn0vKjpudWxsKi9cblxuLy8gcGl4ZWwgcmF0aW8gcmV0cmlldmVyXG5cbnZhciB0ZXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuXG52YXIgY3NzVGV4dCA9IFwiYm9yZGVyOm5vbmU7bWFyZ2luOm5vbmU7cGFkZGluZzpub25lO3Zpc2liaWxpdHk6aGlkZGVuO3Bvc2l0aW9uOmFic29sdXRlO2hlaWdodDowO1wiO1xuXG4vLyByZXR1cm5zIHRoZSBhbW91bnQgb2YgcGl4ZWxzIHRoYXQgdGFrZXMgdG8gbWFrZSBvbmUgb2YgdGhlIHVuaXRcblxudmFyIHBpeGVsUmF0aW8gPSBmdW5jdGlvbihlbGVtZW50LCB1KXtcbiAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlLCByYXRpbyA9IDFcbiAgICBpZiAocGFyZW50KXtcbiAgICAgICAgdGVzdC5zdHlsZS5jc3NUZXh0ID0gY3NzVGV4dCArIChcIndpZHRoOjEwMFwiICsgdSArIFwiO1wiKVxuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGVzdClcbiAgICAgICAgcmF0aW8gPSB0ZXN0Lm9mZnNldFdpZHRoIC8gMTAwXG4gICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZCh0ZXN0KVxuICAgIH1cbiAgICByZXR1cm4gcmF0aW9cbn1cblxuLy8gbWlycm9yIDQgdmFsdWVzXG5cbnZhciBtaXJyb3I0ID0gZnVuY3Rpb24odmFsdWVzKXtcbiAgICB2YXIgbGVuZ3RoID0gdmFsdWVzLmxlbmd0aFxuICAgIGlmICAgICAgKGxlbmd0aCA9PT0gMSkgdmFsdWVzLnB1c2godmFsdWVzWzBdLCB2YWx1ZXNbMF0sIHZhbHVlc1swXSlcbiAgICBlbHNlIGlmIChsZW5ndGggPT09IDIpIHZhbHVlcy5wdXNoKHZhbHVlc1swXSwgdmFsdWVzWzFdKVxuICAgIGVsc2UgaWYgKGxlbmd0aCA9PT0gMykgdmFsdWVzLnB1c2godmFsdWVzWzFdKVxuICAgIHJldHVybiB2YWx1ZXNcbn1cblxuLy8gcmVndWxhciBleHByZXNzaW9ucyBzdHJpbmdzXG5cbnZhciBzTGVuZ3RoICAgICAgPSBcIihbLS5cXFxcZF0rKSglfGNtfG1tfGlufHB4fHB0fHBjfGVtfGV4fGNofHJlbXx2d3x2aHx2bSlcIixcbiAgICBzTGVuZ3RoTnVtICAgPSBzTGVuZ3RoICsgXCI/XCIsXG4gICAgc0JvcmRlclN0eWxlID0gXCJub25lfGhpZGRlbnxkb3R0ZWR8ZGFzaGVkfHNvbGlkfGRvdWJsZXxncm9vdmV8cmlkZ2V8aW5zZXR8b3V0c2V0fGluaGVyaXRcIlxuXG4vLyByZWd1bGFyIGV4cHJlc3Npb25zXG5cbnZhciByZ0xlbmd0aCAgICAgPSBSZWdFeHAoc0xlbmd0aCwgXCJnXCIpLFxuICAgIHJMZW5ndGhOdW0gICA9IFJlZ0V4cChzTGVuZ3RoTnVtKSxcbiAgICByZ0xlbmd0aE51bSAgPSBSZWdFeHAoc0xlbmd0aE51bSwgXCJnXCIpLFxuICAgIHJCb3JkZXJTdHlsZSA9IFJlZ0V4cChzQm9yZGVyU3R5bGUpXG5cbi8vIG5vcm1hbGl6ZSA+IGNzc1xuXG52YXIgcGFyc2VTdHJpbmcgPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgcmV0dXJuICh2YWx1ZSA9PSBudWxsKSA/IFwiXCIgOiB2YWx1ZSArIFwiXCJcbn1cblxudmFyIHBhcnNlT3BhY2l0eSA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiKSByZXR1cm4gbm9ybWFsaXplID8gXCIxXCIgOiBcIlwiXG4gICAgcmV0dXJuIChpc0Zpbml0ZSgodmFsdWUgPSArdmFsdWUpKSkgPyAodmFsdWUgPCAwID8gXCIwXCIgOiB2YWx1ZSArIFwiXCIpIDogXCIxXCJcbn1cblxudHJ5IHt0ZXN0LnN0eWxlLmNvbG9yID0gXCJyZ2JhKDAsMCwwLDAuNSlcIn0gY2F0Y2goZSl7fVxudmFyIHJnYmEgPSAvXnJnYmEvLnRlc3QodGVzdC5zdHlsZS5jb2xvcilcblxudmFyIHBhcnNlQ29sb3IgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICB2YXIgYmxhY2sgPSBcInJnYmEoMCwwLDAsMSlcIiwgY1xuICAgIGlmICghdmFsdWUgfHwgIShjID0gY29sb3IodmFsdWUsIHRydWUpKSkgcmV0dXJuIG5vcm1hbGl6ZSA/IGJsYWNrIDogXCJcIlxuICAgIGlmIChub3JtYWxpemUpIHJldHVybiBcInJnYmEoXCIgKyBjICsgXCIpXCJcblxuICAgIHZhciBhbHBoYSA9IGNbM11cbiAgICBpZiAoYWxwaGEgPT09IDApIHJldHVybiBcInRyYW5zcGFyZW50XCJcbiAgICByZXR1cm4gKCFyZ2JhIHx8IGFscGhhID09PSAxKSA/IFwicmdiKFwiICsgYy5zbGljZSgwLCAzKSArIFwiKVwiIDogXCJyZ2JhKFwiICsgYyArIFwiKVwiXG59XG5cbnZhciBwYXJzZUxlbmd0aCA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiKSByZXR1cm4gbm9ybWFsaXplID8gXCIwcHhcIiA6IFwiXCJcbiAgICB2YXIgbWF0Y2ggPSBtYXRjaFN0cmluZyh2YWx1ZSwgckxlbmd0aE51bSlcbiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSArIChtYXRjaFsyXSB8fCBcInB4XCIpIDogdmFsdWUgLy8gY2Fubm90IGJlIHBhcnNlZC4gcHJvYmFibHkgXCJhdXRvXCJcbn1cblxudmFyIHBhcnNlQm9yZGVyU3R5bGUgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IFwibm9uZVwiIDogXCJcIlxuICAgIHZhciBtYXRjaCA9IHZhbHVlLm1hdGNoKHJCb3JkZXJTdHlsZSlcbiAgICByZXR1cm4gbWF0Y2ggPyB2YWx1ZSA6IG5vcm1hbGl6ZSA/IFwibm9uZVwiIDogXCJcIlxufVxuXG52YXIgcGFyc2VCb3JkZXIgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICB2YXIgbm9ybWFsaXplZCA9IFwiMHB4IG5vbmUgcmdiYSgwLDAsMCwxKVwiXG4gICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT09IFwiXCIpICAgICByZXR1cm4gbm9ybWFsaXplID8gbm9ybWFsaXplZCA6IFwiXCJcbiAgICBpZiAodmFsdWUgPT09IDAgICB8fCB2YWx1ZSA9PT0gXCJub25lXCIpIHJldHVybiBub3JtYWxpemUgPyBub3JtYWxpemVkIDogdmFsdWUgKyBcIlwiXG5cbiAgICB2YXIgY1xuICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShjb2xvci54LCBmdW5jdGlvbihtYXRjaCl7XG4gICAgICAgIGMgPSBtYXRjaFxuICAgICAgICByZXR1cm4gXCJcIlxuICAgIH0pXG5cbiAgICB2YXIgcyA9IHZhbHVlLm1hdGNoKHJCb3JkZXJTdHlsZSksXG4gICAgICAgIGwgPSB2YWx1ZS5tYXRjaChyZ0xlbmd0aE51bSlcblxuICAgIHJldHVybiBjbGVhbihbXG4gICAgICAgIHBhcnNlTGVuZ3RoKGwgPyBsWzBdIDogXCJcIiwgbm9ybWFsaXplKSxcbiAgICAgICAgcGFyc2VCb3JkZXJTdHlsZShzID8gc1swXSA6IFwiXCIsIG5vcm1hbGl6ZSksXG4gICAgICAgIHBhcnNlQ29sb3IoYywgbm9ybWFsaXplKVxuICAgIF0uam9pbihcIiBcIikpXG59XG5cbnZhciBwYXJzZVNob3J0NCA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiKSByZXR1cm4gbm9ybWFsaXplID8gXCIwcHggMHB4IDBweCAwcHhcIiA6IFwiXCJcbiAgICByZXR1cm4gY2xlYW4obWlycm9yNChtYXAoY2xlYW4odmFsdWUpLnNwbGl0KFwiIFwiKSwgZnVuY3Rpb24odil7XG4gICAgICAgIHJldHVybiBwYXJzZUxlbmd0aCh2LCBub3JtYWxpemUpXG4gICAgfSkpLmpvaW4oXCIgXCIpKVxufVxuXG52YXIgcGFyc2VTaGFkb3cgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplLCBsZW4pe1xuICAgIHZhciB0cmFuc3BhcmVudCA9IFwicmdiYSgwLDAsMCwwKVwiLFxuICAgICAgICBub3JtYWxpemVkICA9IChsZW4gPT09IDMpID8gdHJhbnNwYXJlbnQgKyBcIiAwcHggMHB4IDBweFwiIDogdHJhbnNwYXJlbnQgKyBcIiAwcHggMHB4IDBweCAwcHhcIlxuXG4gICAgaWYgKHZhbHVlID09ICBudWxsIHx8IHZhbHVlID09PSBcIlwiKSByZXR1cm4gbm9ybWFsaXplID8gbm9ybWFsaXplZCA6IFwiXCJcbiAgICBpZiAodmFsdWUgPT09IFwibm9uZVwiKSByZXR1cm4gbm9ybWFsaXplID8gbm9ybWFsaXplZCA6IHZhbHVlXG5cbiAgICB2YXIgY29sb3JzID0gW10sIHZhbHVlID0gY2xlYW4odmFsdWUpLnJlcGxhY2UoY29sb3IueCwgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICBjb2xvcnMucHVzaChtYXRjaClcbiAgICAgICAgcmV0dXJuIFwiXCJcbiAgICB9KVxuXG4gICAgcmV0dXJuIG1hcCh2YWx1ZS5zcGxpdChcIixcIiksIGZ1bmN0aW9uKHNoYWRvdywgaSl7XG5cbiAgICAgICAgdmFyIGMgICAgICAgPSBwYXJzZUNvbG9yKGNvbG9yc1tpXSwgbm9ybWFsaXplKSxcbiAgICAgICAgICAgIGluc2V0ICAgPSAvaW5zZXQvLnRlc3Qoc2hhZG93KSxcbiAgICAgICAgICAgIGxlbmd0aHMgPSBzaGFkb3cubWF0Y2gocmdMZW5ndGhOdW0pIHx8IFtcIjBweFwiXVxuXG4gICAgICAgIGxlbmd0aHMgPSBtYXAobGVuZ3RocywgZnVuY3Rpb24obSl7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VMZW5ndGgobSwgbm9ybWFsaXplKVxuICAgICAgICB9KVxuXG4gICAgICAgIHdoaWxlIChsZW5ndGhzLmxlbmd0aCA8IGxlbikgbGVuZ3Rocy5wdXNoKFwiMHB4XCIpXG5cbiAgICAgICAgdmFyIHJldCA9IGluc2V0ID8gW1wiaW5zZXRcIiwgY10gOiBbY11cblxuICAgICAgICByZXR1cm4gcmV0LmNvbmNhdChsZW5ndGhzKS5qb2luKFwiIFwiKVxuXG4gICAgfSkuam9pbihcIiwgXCIpXG59XG5cbnZhciBwYXJzZSA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiKSByZXR1cm4gXCJcIiAvLyBjYW50IG5vcm1hbGl6ZSBcIlwiIHx8IG51bGxcbiAgICByZXR1cm4gdmFsdWUucmVwbGFjZShjb2xvci54LCBmdW5jdGlvbihtYXRjaCl7XG4gICAgICAgIHJldHVybiBwYXJzZUNvbG9yKG1hdGNoLCBub3JtYWxpemUpXG4gICAgfSkucmVwbGFjZShyZ0xlbmd0aCwgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICByZXR1cm4gcGFyc2VMZW5ndGgobWF0Y2gsIG5vcm1hbGl6ZSlcbiAgICB9KVxufVxuXG4vLyBnZXQgJiYgc2V0XG5cbnZhciBnZXR0ZXJzID0ge30sIHNldHRlcnMgPSB7fSwgcGFyc2VycyA9IHt9LCBhbGlhc2VzID0ge31cblxudmFyIGdldHRlciA9IGZ1bmN0aW9uKGtleSl7XG4gICAgcmV0dXJuIGdldHRlcnNba2V5XSB8fCAoZ2V0dGVyc1trZXldID0gKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBhbGlhcyAgPSBhbGlhc2VzW2tleV0gfHwga2V5LFxuICAgICAgICAgICAgcGFyc2VyID0gcGFyc2Vyc1trZXldIHx8IHBhcnNlXG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VyKGNvbXB1dGUodGhpcykoYWxpYXMpLCB0cnVlKVxuICAgICAgICB9XG5cbiAgICB9KCkpKVxufVxuXG52YXIgc2V0dGVyID0gZnVuY3Rpb24oa2V5KXtcbiAgICByZXR1cm4gc2V0dGVyc1trZXldIHx8IChzZXR0ZXJzW2tleV0gPSAoZnVuY3Rpb24oKXtcblxuICAgICAgICB2YXIgYWxpYXMgID0gYWxpYXNlc1trZXldIHx8IGtleSxcbiAgICAgICAgICAgIHBhcnNlciA9IHBhcnNlcnNba2V5XSB8fCBwYXJzZVxuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICB0aGlzLnN0eWxlW2FsaWFzXSA9IHBhcnNlcih2YWx1ZSwgZmFsc2UpXG4gICAgICAgIH1cblxuICAgIH0oKSkpXG59XG5cbi8vIHBhcnNlcnNcblxudmFyIHRyYmwgPSBbXCJUb3BcIiwgXCJSaWdodFwiLCBcIkJvdHRvbVwiLCBcIkxlZnRcIl0sIHRsYmwgPSBbXCJUb3BMZWZ0XCIsIFwiVG9wUmlnaHRcIiwgXCJCb3R0b21SaWdodFwiLCBcIkJvdHRvbUxlZnRcIl1cblxuZm9yRWFjaCh0cmJsLCBmdW5jdGlvbihkKXtcbiAgICB2YXIgYmQgPSBcImJvcmRlclwiICsgZFxuICAgIGZvckVhY2goWyBcIm1hcmdpblwiICsgZCwgXCJwYWRkaW5nXCIgKyBkLCBiZCArIFwiV2lkdGhcIiwgZC50b0xvd2VyQ2FzZSgpXSwgZnVuY3Rpb24obil7XG4gICAgICAgIHBhcnNlcnNbbl0gPSBwYXJzZUxlbmd0aFxuICAgIH0pXG4gICAgcGFyc2Vyc1tiZCArIFwiQ29sb3JcIl0gPSBwYXJzZUNvbG9yXG4gICAgcGFyc2Vyc1tiZCArIFwiU3R5bGVcIl0gPSBwYXJzZUJvcmRlclN0eWxlXG5cbiAgICAvLyBib3JkZXJESVJcbiAgICBwYXJzZXJzW2JkXSA9IHBhcnNlQm9yZGVyXG4gICAgZ2V0dGVyc1tiZF0gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgZ2V0dGVyKGJkICsgXCJXaWR0aFwiKS5jYWxsKHRoaXMpLFxuICAgICAgICAgICAgZ2V0dGVyKGJkICsgXCJTdHlsZVwiKS5jYWxsKHRoaXMpLFxuICAgICAgICAgICAgZ2V0dGVyKGJkICsgXCJDb2xvclwiKS5jYWxsKHRoaXMpXG4gICAgICAgIF0uam9pbihcIiBcIilcbiAgICB9XG59KVxuXG5mb3JFYWNoKHRsYmwsIGZ1bmN0aW9uKGQpe1xuICAgIHBhcnNlcnNbXCJib3JkZXJcIiArIGQgKyBcIlJhZGl1c1wiXSA9IHBhcnNlTGVuZ3RoXG59KVxuXG5wYXJzZXJzLmNvbG9yID0gcGFyc2Vycy5iYWNrZ3JvdW5kQ29sb3IgPSBwYXJzZUNvbG9yXG5wYXJzZXJzLndpZHRoID0gcGFyc2Vycy5oZWlnaHQgPSBwYXJzZXJzLm1pbldpZHRoID0gcGFyc2Vycy5taW5IZWlnaHQgPSBwYXJzZXJzLm1heFdpZHRoID0gcGFyc2Vycy5tYXhIZWlnaHQgPSBwYXJzZXJzLmZvbnRTaXplID0gcGFyc2Vycy5iYWNrZ3JvdW5kU2l6ZSA9IHBhcnNlTGVuZ3RoXG5cbi8vIG1hcmdpbiArIHBhZGRpbmdcblxuZm9yRWFjaChbXCJtYXJnaW5cIiwgXCJwYWRkaW5nXCJdLCBmdW5jdGlvbihuYW1lKXtcbiAgICBwYXJzZXJzW25hbWVdID0gcGFyc2VTaG9ydDRcbiAgICBnZXR0ZXJzW25hbWVdID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG1hcCh0cmJsLCBmdW5jdGlvbihkKXtcbiAgICAgICAgICAgIHJldHVybiBnZXR0ZXIobmFtZSArIGQpLmNhbGwodGhpcylcbiAgICAgICAgfSwgdGhpcykuam9pbihcIiBcIilcbiAgICB9XG59KVxuXG4vLyBib3JkZXJzXG5cbi8vIGJvcmRlckRJUldpZHRoLCBib3JkZXJESVJTdHlsZSwgYm9yZGVyRElSQ29sb3JcblxucGFyc2Vycy5ib3JkZXJXaWR0aCA9IHBhcnNlU2hvcnQ0XG5cbnBhcnNlcnMuYm9yZGVyU3R5bGUgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IG1pcnJvcjQoW1wibm9uZVwiXSkuam9pbihcIiBcIikgOiBcIlwiXG4gICAgdmFsdWUgPSBjbGVhbih2YWx1ZSkuc3BsaXQoXCIgXCIpXG4gICAgcmV0dXJuIGNsZWFuKG1pcnJvcjQobWFwKHZhbHVlLCBmdW5jdGlvbih2KXtcbiAgICAgICAgcGFyc2VCb3JkZXJTdHlsZSh2LCBub3JtYWxpemUpXG4gICAgfSkpLmpvaW4oXCIgXCIpKVxufVxuXG5wYXJzZXJzLmJvcmRlckNvbG9yID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgaWYgKCF2YWx1ZSB8fCAhKHZhbHVlID0gbWF0Y2hTdHJpbmcodmFsdWUsIGNvbG9yLngpKSkgcmV0dXJuIG5vcm1hbGl6ZSA/IG1pcnJvcjQoW1wicmdiYSgwLDAsMCwxKVwiXSkuam9pbihcIiBcIikgOiBcIlwiXG4gICAgcmV0dXJuIGNsZWFuKG1pcnJvcjQobWFwKHZhbHVlLCBmdW5jdGlvbih2KXtcbiAgICAgICAgcmV0dXJuIHBhcnNlQ29sb3Iodiwgbm9ybWFsaXplKVxuICAgIH0pKS5qb2luKFwiIFwiKSlcbn1cblxuZm9yRWFjaChbXCJXaWR0aFwiLCBcIlN0eWxlXCIsIFwiQ29sb3JcIl0sIGZ1bmN0aW9uKG5hbWUpe1xuICAgIGdldHRlcnNbXCJib3JkZXJcIiArIG5hbWVdID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG1hcCh0cmJsLCBmdW5jdGlvbihkKXtcbiAgICAgICAgICAgIHJldHVybiBnZXR0ZXIoXCJib3JkZXJcIiArIGQgKyBuYW1lKS5jYWxsKHRoaXMpXG4gICAgICAgIH0sIHRoaXMpLmpvaW4oXCIgXCIpXG4gICAgfVxufSlcblxuLy8gYm9yZGVyUmFkaXVzXG5cbnBhcnNlcnMuYm9yZGVyUmFkaXVzID0gcGFyc2VTaG9ydDRcblxuZ2V0dGVycy5ib3JkZXJSYWRpdXMgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBtYXAodGxibCwgZnVuY3Rpb24oZCl7XG4gICAgICAgIHJldHVybiBnZXR0ZXIoXCJib3JkZXJcIiArIGQgKyBcIlJhZGl1c1wiKS5jYWxsKHRoaXMpXG4gICAgfSwgdGhpcykuam9pbihcIiBcIilcbn1cblxuLy8gYm9yZGVyXG5cbnBhcnNlcnMuYm9yZGVyID0gcGFyc2VCb3JkZXJcblxuZ2V0dGVycy5ib3JkZXIgPSBmdW5jdGlvbigpe1xuICAgIHZhciBwdmFsdWVcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyYmwubGVuZ3RoOyBpKyspe1xuICAgICAgICB2YXIgdmFsdWUgPSBnZXR0ZXIoXCJib3JkZXJcIiArIHRyYmxbaV0pLmNhbGwodGhpcylcbiAgICAgICAgaWYgKHB2YWx1ZSAmJiB2YWx1ZSAhPT0gcHZhbHVlKSByZXR1cm4gbnVsbFxuICAgICAgICBwdmFsdWUgPSB2YWx1ZVxuICAgIH1cbiAgICByZXR1cm4gcHZhbHVlXG59XG5cbi8vIHpJbmRleFxuXG5wYXJzZXJzLnpJbmRleCA9IHBhcnNlU3RyaW5nXG5cbi8vIG9wYWNpdHlcblxucGFyc2Vycy5vcGFjaXR5ID0gcGFyc2VPcGFjaXR5XG5cbi8qKGNzczMpPyovXG5cbnZhciBmaWx0ZXJOYW1lID0gKHRlc3Quc3R5bGUuTXNGaWx0ZXIgIT0gbnVsbCAmJiBcIk1zRmlsdGVyXCIpIHx8ICh0ZXN0LnN0eWxlLmZpbHRlciAhPSBudWxsICYmIFwiZmlsdGVyXCIpXG5cbmlmIChmaWx0ZXJOYW1lICYmIHRlc3Quc3R5bGUub3BhY2l0eSA9PSBudWxsKXtcblxuICAgIHZhciBtYXRjaE9wID0gL2FscGhhXFwob3BhY2l0eT0oW1xcZC5dKylcXCkvaVxuXG4gICAgc2V0dGVycy5vcGFjaXR5ID0gZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICB2YWx1ZSA9ICgodmFsdWUgPSBwYXJzZU9wYWNpdHkodmFsdWUpKSA9PT0gXCIxXCIpID8gXCJcIiA6IFwiYWxwaGEob3BhY2l0eT1cIiArIE1hdGgucm91bmQodmFsdWUgKiAxMDApICsgXCIpXCJcbiAgICAgICAgdmFyIGZpbHRlciA9IGNvbXB1dGUodGhpcykoZmlsdGVyTmFtZSlcbiAgICAgICAgcmV0dXJuIHRoaXMuc3R5bGVbZmlsdGVyTmFtZV0gPSBtYXRjaE9wLnRlc3QoZmlsdGVyKSA/IGZpbHRlci5yZXBsYWNlKG1hdGNoT3AsIHZhbHVlKSA6IGZpbHRlciArIFwiIFwiICsgdmFsdWVcbiAgICB9XG5cbiAgICBnZXR0ZXJzLm9wYWNpdHkgPSBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbWF0Y2ggPSBjb21wdXRlKHRoaXMpKGZpbHRlck5hbWUpLm1hdGNoKG1hdGNoT3ApXG4gICAgICAgIHJldHVybiAoIW1hdGNoID8gMSA6IG1hdGNoWzFdIC8gMTAwKSArIFwiXCJcbiAgICB9XG5cbn0vKjoqL1xuXG52YXIgcGFyc2VCb3hTaGFkb3cgPSBwYXJzZXJzLmJveFNoYWRvdyA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIHJldHVybiBwYXJzZVNoYWRvdyh2YWx1ZSwgbm9ybWFsaXplLCA0KVxufVxuXG52YXIgcGFyc2VUZXh0U2hhZG93ID0gcGFyc2Vycy50ZXh0U2hhZG93ID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgcmV0dXJuIHBhcnNlU2hhZG93KHZhbHVlLCBub3JtYWxpemUsIDMpXG59XG5cbi8vIEFsaWFzZXNcblxuZm9yRWFjaChbJ1dlYmtpdCcsIFwiTW96XCIsIFwibXNcIiwgXCJPXCIsIG51bGxdLCBmdW5jdGlvbihwcmVmaXgpe1xuICAgIGZvckVhY2goW1xuICAgICAgICBcInRyYW5zaXRpb25cIiwgXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2Zvcm1PcmlnaW5cIiwgXCJ0cmFuc2Zvcm1TdHlsZVwiLCBcInBlcnNwZWN0aXZlXCIsIFwicGVyc3BlY3RpdmVPcmlnaW5cIiwgXCJiYWNrZmFjZVZpc2liaWxpdHlcIlxuICAgIF0sIGZ1bmN0aW9uKHN0eWxlKXtcbiAgICAgICAgdmFyIGNjID0gcHJlZml4ID8gcHJlZml4ICsgY2FwaXRhbGl6ZShzdHlsZSkgOiBzdHlsZVxuICAgICAgICBpZiAocHJlZml4ID09PSBcIm1zXCIpIGh5cGhlbmF0ZWRbY2NdID0gXCItbXMtXCIgKyBoeXBoZW5hdGUoc3R5bGUpXG4gICAgICAgIGlmICh0ZXN0LnN0eWxlW2NjXSAhPSBudWxsKSBhbGlhc2VzW3N0eWxlXSA9IGNjXG4gICAgfSlcbn0pXG5cbnZhciB0cmFuc2l0aW9uTmFtZSA9IGFsaWFzZXMudHJhbnNpdGlvbixcbiAgICB0cmFuc2Zvcm1OYW1lICA9IGFsaWFzZXMudHJhbnNmb3JtXG5cbi8vIG1hbnVhbGx5IGRpc2FibGUgY3NzMyB0cmFuc2l0aW9ucyBpbiBPcGVyYSwgYmVjYXVzZSB0aGV5IGRvIG5vdCB3b3JrIHByb3Blcmx5LlxuXG5pZiAodHJhbnNpdGlvbk5hbWUgPT09IFwiT1RyYW5zaXRpb25cIikgdHJhbnNpdGlvbk5hbWUgPSBudWxsXG5cblxuLy8gdGhpcyB0YWtlcyBjYXJlIG9mIG1hdHJpeCBkZWNvbXBvc2l0aW9uIG9uIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBvbmx5IDJkIHRyYW5zZm9ybXMgYnV0IG5vIENTUzMgdHJhbnNpdGlvbnMuXG4vLyBiYXNpY2FsbHksIElFOSAoYW5kIE9wZXJhIGFzIHdlbGwsIHNpbmNlIHdlIGRpc2FibGVkIENTUzMgdHJhbnNpdGlvbnMgbWFudWFsbHkpXG5cbnZhciBwYXJzZVRyYW5zZm9ybTJkLCBUcmFuc2Zvcm0yZFxuXG4vKihjc3MzKT8qL1xuXG5pZiAoIXRyYW5zaXRpb25OYW1lICYmIHRyYW5zZm9ybU5hbWUpIChmdW5jdGlvbigpe1xuXG4gICAgdmFyIHVubWF0cml4ID0gcmVxdWlyZShcIi4vdW5tYXRyaXgyZFwiKVxuXG4gICAgdmFyIHYgPSBcIlxcXFxzKihbLVxcXFxkXFxcXHcuXSspXFxcXHMqXCJcblxuICAgIHZhciByTWF0cml4ID0gUmVnRXhwKFwibWF0cml4XFxcXChcIiArIFt2LCB2LCB2LCB2LCB2LCB2XSArIFwiXFxcXClcIilcblxuICAgIHZhciBkZWNvbXBvc2VNYXRyaXggPSBmdW5jdGlvbihtYXRyaXgpe1xuXG4gICAgICAgIHZhciBkID0gdW5tYXRyaXguYXBwbHkobnVsbCwgbWF0cml4Lm1hdGNoKHJNYXRyaXgpLnNsaWNlKDEpKSB8fCBbWzAsIDBdLCAwLCAwLCBbMCwgMF1dXG5cbiAgICAgICAgcmV0dXJuIFtcblxuICAgICAgICAgICAgXCJ0cmFuc2xhdGUoXCIgKyBtYXAoZFswXSwgZnVuY3Rpb24odil7cmV0dXJuIHJvdW5kKHYpICsgXCJweFwifSkgKyBcIilcIixcbiAgICAgICAgICAgIFwicm90YXRlKFwiICsgcm91bmQoZFsxXSAqIDE4MCAvIE1hdGguUEkpICsgXCJkZWcpXCIsXG4gICAgICAgICAgICBcInNrZXdYKFwiICsgcm91bmQoZFsyXSAqIDE4MCAvIE1hdGguUEkpICsgXCJkZWcpXCIsXG4gICAgICAgICAgICBcInNjYWxlKFwiICsgbWFwKGRbM10sIHJvdW5kKSArIFwiKVwiXG5cbiAgICAgICAgXS5qb2luKFwiIFwiKVxuXG4gICAgfVxuXG4gICAgdmFyIGRlZjBweCAgPSBmdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlIHx8IFwiMHB4XCJ9LFxuICAgICAgICBkZWYxICAgID0gZnVuY3Rpb24odmFsdWUpe3JldHVybiB2YWx1ZSB8fCBcIjFcIn0sXG4gICAgICAgIGRlZjBkZWcgPSBmdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlIHx8IFwiMGRlZ1wifVxuXG4gICAgdmFyIHRyYW5zZm9ybXMgPSB7XG5cbiAgICAgICAgdHJhbnNsYXRlOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICBpZiAoIXZhbHVlKSB2YWx1ZSA9IFwiMHB4LDBweFwiXG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gdmFsdWUuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgICBpZiAoIXZhbHVlc1sxXSkgdmFsdWVzWzFdID0gXCIwcHhcIlxuICAgICAgICAgICAgcmV0dXJuIG1hcCh2YWx1ZXMsIGNsZWFuKSArIFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgdHJhbnNsYXRlWDogZGVmMHB4LFxuICAgICAgICB0cmFuc2xhdGVZOiBkZWYwcHgsXG4gICAgICAgIHNjYWxlOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICBpZiAoIXZhbHVlKSB2YWx1ZSA9IFwiMSwxXCJcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB2YWx1ZS5zcGxpdChcIixcIilcbiAgICAgICAgICAgIGlmICghdmFsdWVzWzFdKSB2YWx1ZXNbMV0gPSB2YWx1ZXNbMF1cbiAgICAgICAgICAgIHJldHVybiBtYXAodmFsdWVzLCBjbGVhbikgKyBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIHNjYWxlWDogZGVmMSxcbiAgICAgICAgc2NhbGVZOiBkZWYxLFxuICAgICAgICByb3RhdGU6IGRlZjBkZWcsXG4gICAgICAgIHNrZXdYOiBkZWYwZGVnLFxuICAgICAgICBza2V3WTogZGVmMGRlZ1xuXG4gICAgfVxuXG4gICAgVHJhbnNmb3JtMmQgPSBwcmltZSh7XG5cbiAgICAgICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKHRyYW5zZm9ybSl7XG5cbiAgICAgICAgICAgIHZhciBuYW1lcyA9IHRoaXMubmFtZXMgPSBbXVxuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzID0gW11cblxuICAgICAgICAgICAgdHJhbnNmb3JtLnJlcGxhY2UoLyhcXHcrKVxcKChbLS5cXGRcXHNcXHcsXSspXFwpL2csIGZ1bmN0aW9uKG1hdGNoLCBuYW1lLCB2YWx1ZSl7XG4gICAgICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKVxuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9LFxuXG4gICAgICAgIGlkZW50aXR5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGZ1bmN0aW9ucyA9IFtdXG4gICAgICAgICAgICBmb3JFYWNoKHRoaXMubmFtZXMsIGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IHRyYW5zZm9ybXNbbmFtZV1cbiAgICAgICAgICAgICAgICBpZiAoZm4pIGZ1bmN0aW9ucy5wdXNoKG5hbWUgKyBcIihcIiArIGZuKCkgKyBcIilcIilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmpvaW4oXCIgXCIpXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2FtZVR5cGU6IGZ1bmN0aW9uKHRyYW5zZm9ybU9iamVjdCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lcy50b1N0cmluZygpID09PSB0cmFuc2Zvcm1PYmplY3QubmFtZXMudG9TdHJpbmcoKVxuICAgICAgICB9LFxuXG4gICAgICAgIC8vIHRoaXMgaXMsIGJhc2ljYWxseSwgY2hlYXRpbmcuXG4gICAgICAgIC8vIHJldHJpZXZpbmcgdGhlIG1hdHJpeCB2YWx1ZSBmcm9tIHRoZSBkb20sIHJhdGhlciB0aGFuIGNhbGN1bGF0aW5nIGl0XG5cbiAgICAgICAgZGVjb21wb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMudG9TdHJpbmcoKVxuXG4gICAgICAgICAgICB0ZXN0LnN0eWxlLmNzc1RleHQgPSBjc3NUZXh0ICsgaHlwaGVuYXRlKHRyYW5zZm9ybU5hbWUpICsgXCI6XCIgKyB0cmFuc2Zvcm0gKyBcIjtcIlxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXN0KVxuICAgICAgICAgICAgdmFyIG0gPSBjb21wdXRlKHRlc3QpKHRyYW5zZm9ybU5hbWUpXG4gICAgICAgICAgICBpZiAoIW0gfHwgbSA9PT0gXCJub25lXCIpIG0gPSBcIm1hdHJpeCgxLCAwLCAwLCAxLCAwLCAwKVwiXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlc3QpXG4gICAgICAgICAgICByZXR1cm4gZGVjb21wb3NlTWF0cml4KG0pXG4gICAgICAgIH1cblxuICAgIH0pXG5cbiAgICBUcmFuc2Zvcm0yZC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihjbGVhbil7XG4gICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcywgZnVuY3Rpb25zID0gW11cbiAgICAgICAgZm9yRWFjaCh0aGlzLm5hbWVzLCBmdW5jdGlvbihuYW1lLCBpKXtcbiAgICAgICAgICAgIHZhciBmbiA9IHRyYW5zZm9ybXNbbmFtZV1cbiAgICAgICAgICAgIGlmICghZm4pIHJldHVyblxuICAgICAgICAgICAgdmFyIHZhbHVlID0gZm4odmFsdWVzW2ldKVxuICAgICAgICAgICAgaWYgKCFjbGVhbiB8fCB2YWx1ZSAhPT0gZm4oKSkgZnVuY3Rpb25zLnB1c2gobmFtZSArIFwiKFwiICsgdmFsdWUgKyBcIilcIilcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5sZW5ndGggPyBmdW5jdGlvbnMuam9pbihcIiBcIikgOiBcIm5vbmVcIlxuICAgIH1cblxuICAgIFRyYW5zZm9ybTJkLnVuaW9uID0gZnVuY3Rpb24oZnJvbSwgdG8pe1xuXG4gICAgICAgIGlmIChmcm9tID09PSB0bykgcmV0dXJuIC8vIG5vdGhpbmcgdG8gZG9cblxuICAgICAgICB2YXIgZnJvbU1hcCwgdG9NYXBcblxuICAgICAgICBpZiAoZnJvbSA9PT0gXCJub25lXCIpe1xuXG4gICAgICAgICAgICB0b01hcCAgID0gbmV3IFRyYW5zZm9ybTJkKHRvKVxuICAgICAgICAgICAgdG8gICAgICA9IHRvTWFwLnRvU3RyaW5nKClcbiAgICAgICAgICAgIGZyb20gICAgPSB0b01hcC5pZGVudGl0eSgpXG4gICAgICAgICAgICBmcm9tTWFwID0gbmV3IFRyYW5zZm9ybTJkKGZyb20pXG5cbiAgICAgICAgfSBlbHNlIGlmICh0byA9PT0gXCJub25lXCIpe1xuXG4gICAgICAgICAgICBmcm9tTWFwID0gbmV3IFRyYW5zZm9ybTJkKGZyb20pXG4gICAgICAgICAgICBmcm9tICAgID0gZnJvbU1hcC50b1N0cmluZygpXG4gICAgICAgICAgICB0byAgICAgID0gZnJvbU1hcC5pZGVudGl0eSgpXG4gICAgICAgICAgICB0b01hcCAgID0gbmV3IFRyYW5zZm9ybTJkKHRvKVxuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGZyb21NYXAgPSBuZXcgVHJhbnNmb3JtMmQoZnJvbSlcbiAgICAgICAgICAgIGZyb20gICAgPSBmcm9tTWFwLnRvU3RyaW5nKClcbiAgICAgICAgICAgIHRvTWFwICAgPSBuZXcgVHJhbnNmb3JtMmQodG8pXG4gICAgICAgICAgICB0byAgICAgID0gdG9NYXAudG9TdHJpbmcoKVxuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZnJvbSA9PT0gdG8pIHJldHVybiAvLyBub3RoaW5nIHRvIGRvXG5cbiAgICAgICAgaWYgKCFmcm9tTWFwLnNhbWVUeXBlKHRvTWFwKSl7XG5cbiAgICAgICAgICAgIGZyb20gPSBmcm9tTWFwLmRlY29tcG9zZSgpXG4gICAgICAgICAgICB0byAgID0gdG9NYXAuZGVjb21wb3NlKClcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZyb20gPT09IHRvKSByZXR1cm4gLy8gbm90aGluZyB0byBkb1xuXG4gICAgICAgIHJldHVybiBbZnJvbSwgdG9dXG5cbiAgICB9XG5cbiAgICAvLyB0aGlzIHBhcnNlciBtYWtlcyBzdXJlIGl0IG5ldmVyIGdldHMgXCJtYXRyaXhcIlxuXG4gICAgcGFyc2VUcmFuc2Zvcm0yZCA9IHBhcnNlcnMudHJhbnNmb3JtID0gZnVuY3Rpb24odHJhbnNmb3JtKXtcbiAgICAgICAgaWYgKCF0cmFuc2Zvcm0gfHwgdHJhbnNmb3JtID09PSBcIm5vbmVcIikgcmV0dXJuIFwibm9uZVwiXG4gICAgICAgIHJldHVybiBuZXcgVHJhbnNmb3JtMmQock1hdHJpeC50ZXN0KHRyYW5zZm9ybSkgPyBkZWNvbXBvc2VNYXRyaXgodHJhbnNmb3JtKSA6IHRyYW5zZm9ybSkudG9TdHJpbmcodHJ1ZSlcbiAgICB9XG5cbiAgICAvLyB0aGlzIGdldHRlciBtYWtlcyBzdXJlIHdlIHJlYWQgZnJvbSB0aGUgZG9tIG9ubHkgdGhlIGZpcnN0IHRpbWVcbiAgICAvLyB0aGlzIHdheSB3ZSBzYXZlIHRoZSBhY3R1YWwgdHJhbnNmb3JtIGFuZCBub3QgXCJtYXRyaXhcIlxuICAgIC8vIHNldHRpbmcgbWF0cml4KCkgd2lsbCB1c2UgcGFyc2VUcmFuc2Zvcm0yZCBhcyB3ZWxsLCB0aHVzIHNldHRpbmcgdGhlIGRlY29tcG9zZWQgbWF0cml4XG5cbiAgICBnZXR0ZXJzLnRyYW5zZm9ybSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBzID0gdGhpcy5zdHlsZVxuICAgICAgICByZXR1cm4gc1t0cmFuc2Zvcm1OYW1lXSB8fCAoc1t0cmFuc2Zvcm1OYW1lXSA9IHBhcnNlVHJhbnNmb3JtMmQoY29tcHV0ZSh0aGlzKSh0cmFuc2Zvcm1OYW1lKSkpXG4gICAgfVxuXG5cbn0pKCkvKjoqL1xuXG4vLyB0cmllcyB0byBtYXRjaCBmcm9tIGFuZCB0byB2YWx1ZXNcblxudmFyIHByZXBhcmUgPSBmdW5jdGlvbihub2RlLCBwcm9wZXJ0eSwgdG8pe1xuXG4gICAgdmFyIHBhcnNlciA9IHBhcnNlcnNbcHJvcGVydHldIHx8IHBhcnNlLFxuICAgICAgICBmcm9tICAgPSBnZXR0ZXIocHJvcGVydHkpLmNhbGwobm9kZSksIC8vIFwibm9ybWFsaXplZFwiIGJ5IHRoZSBnZXR0ZXJcbiAgICAgICAgdG8gICAgID0gcGFyc2VyKHRvLCB0cnVlKSAvLyBub3JtYWxpemUgcGFyc2VkIHByb3BlcnR5XG5cbiAgICBpZiAoZnJvbSA9PT0gdG8pIHJldHVyblxuXG4gICAgaWYgKHBhcnNlciA9PT0gcGFyc2VMZW5ndGggfHwgcGFyc2VyID09PSBwYXJzZUJvcmRlciB8fCBwYXJzZXIgPT09IHBhcnNlU2hvcnQ0KXtcblxuICAgICAgICB2YXIgdG9BbGwgPSB0by5tYXRjaChyZ0xlbmd0aCksIGkgPSAwIC8vIHRoaXMgc2hvdWxkIGFsd2F5cyBtYXRjaCBzb21ldGhpbmdcblxuICAgICAgICBpZiAodG9BbGwpIGZyb20gPSBmcm9tLnJlcGxhY2UocmdMZW5ndGgsIGZ1bmN0aW9uKGZyb21GdWxsLCBmcm9tVmFsdWUsIGZyb21Vbml0KXtcblxuICAgICAgICAgICAgdmFyIHRvRnVsbCAgICA9IHRvQWxsW2krK10sXG4gICAgICAgICAgICAgICAgdG9NYXRjaGVkID0gdG9GdWxsLm1hdGNoKHJMZW5ndGhOdW0pLFxuICAgICAgICAgICAgICAgIHRvVW5pdCAgICA9IHRvTWF0Y2hlZFsyXVxuXG4gICAgICAgICAgICBpZiAoZnJvbVVuaXQgIT09IHRvVW5pdCl7XG4gICAgICAgICAgICAgICAgdmFyIGZyb21QaXhlbHMgPSAoZnJvbVVuaXQgPT09IFwicHhcIikgPyBmcm9tVmFsdWUgOiBwaXhlbFJhdGlvKG5vZGUsIGZyb21Vbml0KSAqIGZyb21WYWx1ZVxuICAgICAgICAgICAgICAgIHJldHVybiByb3VuZChmcm9tUGl4ZWxzIC8gcGl4ZWxSYXRpbyhub2RlLCB0b1VuaXQpKSArIHRvVW5pdFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZnJvbUZ1bGxcblxuICAgICAgICB9KVxuXG4gICAgICAgIGlmIChpID4gMCkgc2V0dGVyKHByb3BlcnR5KS5jYWxsKG5vZGUsIGZyb20pXG5cbiAgICB9LyooY3NzMyk/Ki9lbHNlIGlmIChwYXJzZXIgPT09IHBhcnNlVHJhbnNmb3JtMmQpeyAvLyBJRTkvT3BlcmFcblxuICAgICAgICByZXR1cm4gVHJhbnNmb3JtMmQudW5pb24oZnJvbSwgdG8pXG5cbiAgICB9Lyo6Ki9cblxuICAgIHJldHVybiAoZnJvbSAhPT0gdG8pID8gW2Zyb20sIHRvXSA6IG51bGxcblxufVxuXG4vLyBCcm93c2VyQW5pbWF0aW9uXG5cbnZhciBCcm93c2VyQW5pbWF0aW9uID0gcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IGZ4LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIEJyb3dzZXJBbmltYXRpb24obm9kZSwgcHJvcGVydHkpe1xuXG4gICAgICAgIHZhciBfZ2V0dGVyID0gZ2V0dGVyKHByb3BlcnR5KSxcbiAgICAgICAgICAgIF9zZXR0ZXIgPSBzZXR0ZXIocHJvcGVydHkpXG5cbiAgICAgICAgdGhpcy5nZXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIF9nZXR0ZXIuY2FsbChub2RlKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXQgPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICByZXR1cm4gX3NldHRlci5jYWxsKG5vZGUsIHZhbHVlKVxuICAgICAgICB9XG5cbiAgICAgICAgQnJvd3NlckFuaW1hdGlvbi5wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLCB0aGlzLnNldClcblxuICAgICAgICB0aGlzLm5vZGUgPSBub2RlXG4gICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eVxuXG4gICAgfVxuXG59KVxuXG52YXIgSlNBbmltYXRpb25cblxuLyooY3NzMyk/Ki9cblxuSlNBbmltYXRpb24gPSBwcmltZSh7XG5cbiAgICBpbmhlcml0czogQnJvd3NlckFuaW1hdGlvbixcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBKU0FuaW1hdGlvbigpe1xuICAgICAgICByZXR1cm4gSlNBbmltYXRpb24ucGFyZW50LmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICB9LFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKHRvKXtcblxuICAgICAgICB0aGlzLnN0b3AoKVxuXG4gICAgICAgIGlmICh0aGlzLmR1cmF0aW9uID09PSAwKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsKHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmcm9tVG8gPSBwcmVwYXJlKHRoaXMubm9kZSwgdGhpcy5wcm9wZXJ0eSwgdG8pXG5cbiAgICAgICAgaWYgKCFmcm9tVG8pe1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwodG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG5cbiAgICAgICAgSlNBbmltYXRpb24ucGFyZW50LnN0YXJ0LmFwcGx5KHRoaXMsIGZyb21UbylcblxuICAgICAgICBpZiAoIXRoaXMuY2FuY2VsU3RlcCkgcmV0dXJuIHRoaXNcblxuICAgICAgICAvLyB0aGUgYW5pbWF0aW9uIHdvdWxkIGhhdmUgc3RhcnRlZCBidXQgd2UgbmVlZCBhZGRpdGlvbmFsIGNoZWNrc1xuXG4gICAgICAgIHZhciBwYXJzZXIgPSBwYXJzZXJzW3RoaXMucHJvcGVydHldIHx8IHBhcnNlXG5cbiAgICAgICAgLy8gY29tcGxleCBpbnRlcnBvbGF0aW9ucyBKU0FuaW1hdGlvbiBjYW4ndCBoYW5kbGVcbiAgICAgICAgLy8gZXZlbiBDU1MzIGFuaW1hdGlvbiBncmFjZWZ1bGx5IGZhaWwgd2l0aCBzb21lIG9mIHRob3NlIGVkZ2UgY2FzZXNcbiAgICAgICAgLy8gb3RoZXIgXCJzaW1wbGVcIiBwcm9wZXJ0aWVzLCBzdWNoIGFzIGBib3JkZXJgIGNhbiBoYXZlIGRpZmZlcmVudCB0ZW1wbGF0ZXNcbiAgICAgICAgLy8gYmVjYXVzZSBvZiBzdHJpbmcgcHJvcGVydGllcyBsaWtlIFwic29saWRcIiBhbmQgXCJkYXNoZWRcIlxuXG4gICAgICAgIGlmICgocGFyc2VyID09PSBwYXJzZUJveFNoYWRvdyB8fCBwYXJzZXIgPT09IHBhcnNlVGV4dFNoYWRvdyB8fCBwYXJzZXIgPT09IHBhcnNlKSAmJlxuICAgICAgICAgICAgKHRoaXMudGVtcGxhdGVGcm9tICE9PSB0aGlzLnRlbXBsYXRlVG8pKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbFN0ZXAoKVxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbFN0ZXBcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbCh0bylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHBhcnNlRXF1YXRpb246IGZ1bmN0aW9uKGVxdWF0aW9uKXtcbiAgICAgICAgaWYgKHR5cGVvZiBlcXVhdGlvbiA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIEpTQW5pbWF0aW9uLnBhcmVudC5wYXJzZUVxdWF0aW9uLmNhbGwodGhpcywgZXF1YXRpb24pXG4gICAgfVxuXG5cbn0pLyo6Ki9cblxuLy8gQ1NTQW5pbWF0aW9uXG5cbnZhciByZW1vdmUzID0gZnVuY3Rpb24odmFsdWUsIGEsIGIsIGMpe1xuICAgIHZhciBpbmRleCA9IGluZGV4T2YoYSwgdmFsdWUpXG4gICAgaWYgKGluZGV4ICE9PSAtMSl7XG4gICAgICAgIGEuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICBiLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgYy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgfVxufVxuXG52YXIgQ1NTQW5pbWF0aW9uID0gcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEJyb3dzZXJBbmltYXRpb24sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gQ1NTQW5pbWF0aW9uKG5vZGUsIHByb3BlcnR5KXtcbiAgICAgICAgQ1NTQW5pbWF0aW9uLnBhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG5vZGUsIHByb3BlcnR5KVxuXG4gICAgICAgIHRoaXMuaHByb3BlcnR5ID0gaHlwaGVuYXRlKGFsaWFzZXNbcHJvcGVydHldIHx8IHByb3BlcnR5KVxuXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuXG4gICAgICAgIHRoaXMuYlNldFRyYW5zaXRpb25DU1MgPSBmdW5jdGlvbih0aW1lKXtcbiAgICAgICAgICAgIHNlbGYuc2V0VHJhbnNpdGlvbkNTUyh0aW1lKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5iU2V0U3R5bGVDU1MgPSBmdW5jdGlvbih0aW1lKXtcbiAgICAgICAgICAgIHNlbGYuc2V0U3R5bGVDU1ModGltZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYkNvbXBsZXRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHNlbGYuY29tcGxldGUoKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbih0byl7XG5cbiAgICAgICAgdGhpcy5zdG9wKClcblxuICAgICAgICBpZiAodGhpcy5kdXJhdGlvbiA9PT0gMCl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbCh0bylcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZnJvbVRvID0gcHJlcGFyZSh0aGlzLm5vZGUsIHRoaXMucHJvcGVydHksIHRvKVxuXG4gICAgICAgIGlmICghZnJvbVRvKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsKHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudG8gPSBmcm9tVG9bMV1cbiAgICAgICAgLy8gc2V0dGluZyB0cmFuc2l0aW9uIHN0eWxlcyBpbW1lZGlhdGVseSB3aWxsIG1ha2UgZ29vZCBicm93c2VycyBiZWhhdmUgd2VpcmRseVxuICAgICAgICAvLyBiZWNhdXNlIERPTSBjaGFuZ2VzIGFyZSBhbHdheXMgZGVmZXJyZWQsIHNvIHdlIHJlcXVlc3RGcmFtZVxuICAgICAgICB0aGlzLmNhbmNlbFNldFRyYW5zaXRpb25DU1MgPSByZXF1ZXN0RnJhbWUodGhpcy5iU2V0VHJhbnNpdGlvbkNTUylcblxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBzZXRUcmFuc2l0aW9uQ1NTOiBmdW5jdGlvbih0aW1lKXtcbiAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU2V0VHJhbnNpdGlvbkNTU1xuICAgICAgICB0aGlzLnJlc2V0Q1NTKHRydWUpXG4gICAgICAgIC8vIGZpcmVmb3ggZmxpY2tlcnMgaWYgd2Ugc2V0IGNzcyBmb3IgdHJhbnNpdGlvbiBhcyB3ZWxsIGFzIHN0eWxlcyBhdCB0aGUgc2FtZSB0aW1lXG4gICAgICAgIC8vIHNvLCBvdGhlciB0aGFuIGRlZmVycmluZyB0cmFuc2l0aW9uIHN0eWxlcyB3ZSBkZWZlciBhY3R1YWwgc3R5bGVzIGFzIHdlbGwgb24gYSByZXF1ZXN0RnJhbWVcbiAgICAgICAgdGhpcy5jYW5jZWxTZXRTdHlsZUNTUyA9IHJlcXVlc3RGcmFtZSh0aGlzLmJTZXRTdHlsZUNTUylcbiAgICB9LFxuXG4gICAgc2V0U3R5bGVDU1M6IGZ1bmN0aW9uKHRpbWUpe1xuICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxTZXRTdHlsZUNTU1xuICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLmR1cmF0aW9uXG4gICAgICAgIC8vIHdlIHVzZSBzZXRUaW1lb3V0IGluc3RlYWQgb2YgdHJhbnNpdGlvbkVuZCBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgKGxvb2tpbmcgYXQgeW91IGZveHkpXG4gICAgICAgIC8vIGluY29ycmVjdGx5IHNldCBldmVudC5wcm9wZXJ0eU5hbWUsIHNvIHdlIGNhbm5vdCBjaGVjayB3aGljaCBhbmltYXRpb24gd2UgYXJlIGNhbmNlbGluZ1xuICAgICAgICB0aGlzLmNhbmNlbENvbXBsZXRlID0gc2V0VGltZW91dCh0aGlzLmJDb21wbGV0ZSwgZHVyYXRpb24pXG4gICAgICAgIHRoaXMuZW5kVGltZSA9IHRpbWUgKyBkdXJhdGlvblxuICAgICAgICB0aGlzLnNldCh0aGlzLnRvKVxuICAgIH0sXG5cbiAgICBjb21wbGV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsQ29tcGxldGVcbiAgICAgICAgdGhpcy5yZXNldENTUygpXG4gICAgICAgIHRoaXMuY2FsbGJhY2sodGhpcy5lbmRUaW1lKVxuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbihoYXJkKXtcbiAgICAgICAgaWYgKHRoaXMuY2FuY2VsRXhpdCl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbEV4aXQoKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsRXhpdFxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2FuY2VsU2V0VHJhbnNpdGlvbkNTUyl7XG4gICAgICAgICAgICAvLyBpZiBjYW5jZWxTZXRUcmFuc2l0aW9uQ1NTIGlzIHNldCwgbWVhbnMgbm90aGluZyBpcyBzZXQgeWV0XG4gICAgICAgICAgICB0aGlzLmNhbmNlbFNldFRyYW5zaXRpb25DU1MoKSAvL3NvIHdlIGNhbmNlbCBhbmQgd2UncmUgZ29vZFxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU2V0VHJhbnNpdGlvbkNTU1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2FuY2VsU2V0U3R5bGVDU1Mpe1xuICAgICAgICAgICAgLy8gaWYgY2FuY2VsU2V0U3R5bGVDU1MgaXMgc2V0LCBtZWFucyB0cmFuc2l0aW9uIGNzcyBoYXMgYmVlbiBzZXQsIGJ1dCBubyBhY3R1YWwgc3R5bGVzLlxuICAgICAgICAgICAgdGhpcy5jYW5jZWxTZXRTdHlsZUNTUygpXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxTZXRTdHlsZUNTU1xuICAgICAgICAgICAgLy8gaWYgaXRzIGEgaGFyZCBzdG9wIChhbmQgbm90IGFub3RoZXIgc3RhcnQgb24gdG9wIG9mIHRoZSBjdXJyZW50IGFuaW1hdGlvbilcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHRyYW5zaXRpb24gQ1NTXG4gICAgICAgICAgICBpZiAoaGFyZCkgdGhpcy5yZXNldENTUygpXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jYW5jZWxDb21wbGV0ZSl7XG4gICAgICAgICAgICAvLyBpZiBjYW5jZWxDb21wbGV0ZSBpcyBzZXQsIG1lYW5zIHN0eWxlIGFuZCB0cmFuc2l0aW9uIGNzcyBoYXZlIGJlZW4gc2V0LCBub3QgeWV0IGNvbXBsZXRlZC5cbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNhbmNlbENvbXBsZXRlKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsQ29tcGxldGVcbiAgICAgICAgICAgIC8vIGlmIGl0cyBhIGhhcmQgc3RvcCAoYW5kIG5vdCBhbm90aGVyIHN0YXJ0IG9uIHRvcCBvZiB0aGUgY3VycmVudCBhbmltYXRpb24pXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlc2V0IHRoZSB0cmFuc2l0aW9uIENTUyBzZXQgdGhlIGN1cnJlbnQgYW5pbWF0aW9uIHN0eWxlc1xuICAgICAgICAgICAgaWYgKGhhcmQpe1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRDU1MoKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0KHRoaXMuZ2V0KCkpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgcmVzZXRDU1M6IGZ1bmN0aW9uKGluY2x1c2l2ZSl7XG4gICAgICAgIHZhciBydWxlcyAgICAgID0gY29tcHV0ZSh0aGlzLm5vZGUpLFxuICAgICAgICAgICAgcHJvcGVydGllcyA9IChydWxlcyh0cmFuc2l0aW9uTmFtZSArIFwiUHJvcGVydHlcIikucmVwbGFjZSgvXFxzKy9nLCBcIlwiKSB8fCBcImFsbFwiKS5zcGxpdChcIixcIiksXG4gICAgICAgICAgICBkdXJhdGlvbnMgID0gKHJ1bGVzKHRyYW5zaXRpb25OYW1lICsgXCJEdXJhdGlvblwiKS5yZXBsYWNlKC9cXHMrL2csIFwiXCIpIHx8IFwiMHNcIikuc3BsaXQoXCIsXCIpLFxuICAgICAgICAgICAgZXF1YXRpb25zICA9IChydWxlcyh0cmFuc2l0aW9uTmFtZSArIFwiVGltaW5nRnVuY3Rpb25cIikucmVwbGFjZSgvXFxzKy9nLCBcIlwiKSB8fCBcImVhc2VcIikubWF0Y2goL2N1YmljLWJlemllclxcKFtcXGQtLixdK1xcKXwoW2Etei1dKykvZylcblxuICAgICAgICByZW1vdmUzKFwiYWxsXCIsICAgICAgICAgIHByb3BlcnRpZXMsIGR1cmF0aW9ucywgZXF1YXRpb25zKVxuICAgICAgICByZW1vdmUzKHRoaXMuaHByb3BlcnR5LCBwcm9wZXJ0aWVzLCBkdXJhdGlvbnMsIGVxdWF0aW9ucylcblxuICAgICAgICBpZiAoaW5jbHVzaXZlKXtcbiAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaCh0aGlzLmhwcm9wZXJ0eSlcbiAgICAgICAgICAgIGR1cmF0aW9ucy5wdXNoKHRoaXMuZHVyYXRpb24gKyBcIm1zXCIpXG4gICAgICAgICAgICBlcXVhdGlvbnMucHVzaChcImN1YmljLWJlemllcihcIiArIHRoaXMuZXF1YXRpb24gKyBcIilcIilcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBub2RlU3R5bGUgPSB0aGlzLm5vZGUuc3R5bGVcblxuICAgICAgICBub2RlU3R5bGVbdHJhbnNpdGlvbk5hbWUgKyBcIlByb3BlcnR5XCJdICAgICAgID0gcHJvcGVydGllc1xuICAgICAgICBub2RlU3R5bGVbdHJhbnNpdGlvbk5hbWUgKyBcIkR1cmF0aW9uXCJdICAgICAgID0gZHVyYXRpb25zXG4gICAgICAgIG5vZGVTdHlsZVt0cmFuc2l0aW9uTmFtZSArIFwiVGltaW5nRnVuY3Rpb25cIl0gPSBlcXVhdGlvbnNcbiAgICB9LFxuXG4gICAgcGFyc2VFcXVhdGlvbjogZnVuY3Rpb24oZXF1YXRpb24pe1xuICAgICAgICBpZiAodHlwZW9mIGVxdWF0aW9uID09PSBcInN0cmluZ1wiKSByZXR1cm4gQ1NTQW5pbWF0aW9uLnBhcmVudC5wYXJzZUVxdWF0aW9uLmNhbGwodGhpcywgZXF1YXRpb24sIHRydWUpXG4gICAgfVxuXG59KVxuXG4vLyBlbGVtZW50cyBtZXRob2RzXG5cbnZhciBCYXNlQW5pbWF0aW9uID0gdHJhbnNpdGlvbk5hbWUgPyBDU1NBbmltYXRpb24gOiBKU0FuaW1hdGlvblxuXG52YXIgbW9vZnggPSBmdW5jdGlvbih4LCB5KXtcbiAgICByZXR1cm4gKHR5cGVvZiB4ID09PSBcImZ1bmN0aW9uXCIpID8gZngoeCkgOiBlbGVtZW50cyh4LCB5KVxufVxuXG5lbGVtZW50cy5pbXBsZW1lbnQoe1xuXG4gICAgLy8ge3Byb3BlcnRpZXN9LCBvcHRpb25zIG9yXG4gICAgLy8gcHJvcGVydHksIHZhbHVlIG9wdGlvbnNcbiAgICBhbmltYXRlOiBmdW5jdGlvbihBLCBCLCBDKXtcblxuICAgICAgICB2YXIgc3R5bGVzID0gQSwgb3B0aW9ucyA9IEJcblxuICAgICAgICBpZiAodHlwZW9mIEEgPT09IFwic3RyaW5nXCIpe1xuICAgICAgICAgICAgc3R5bGVzID0ge31cbiAgICAgICAgICAgIHN0eWxlc1tBXSA9IEJcbiAgICAgICAgICAgIG9wdGlvbnMgPSBDXG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSBvcHRpb25zID0ge31cblxuICAgICAgICB2YXIgdHlwZSA9IHR5cGVvZiBvcHRpb25zXG5cbiAgICAgICAgb3B0aW9ucyA9IHR5cGUgPT09IFwiZnVuY3Rpb25cIiA/IHtcbiAgICAgICAgICAgIGNhbGxiYWNrOiBvcHRpb25zXG4gICAgICAgIH0gOiAodHlwZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlID09PSBcIm51bWJlclwiKSA/IHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiBvcHRpb25zXG4gICAgICAgIH0gOiBvcHRpb25zXG5cbiAgICAgICAgdmFyIGNhbGxiYWNrICA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgZnVuY3Rpb24oKXt9LFxuICAgICAgICAgICAgY29tcGxldGVkID0gMCxcbiAgICAgICAgICAgIGxlbmd0aCAgICA9IDBcblxuICAgICAgICBvcHRpb25zLmNhbGxiYWNrID0gZnVuY3Rpb24odCl7XG4gICAgICAgICAgICBpZiAoKytjb21wbGV0ZWQgPT09IGxlbmd0aCkgY2FsbGJhY2sodClcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHN0eWxlcyl7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZSAgICA9IHN0eWxlc1twcm9wZXJ0eV0sXG4gICAgICAgICAgICAgICAgcHJvcGVydHkgPSBjYW1lbGl6ZShwcm9wZXJ0eSlcblxuICAgICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgICAgIGxlbmd0aCsrXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSBlbGVtZW50cyhub2RlKSwgYW5pbXMgPSBzZWxmLl9hbmltYXRpb25zIHx8IChzZWxmLl9hbmltYXRpb25zID0ge30pXG4gICAgICAgICAgICAgICAgdmFyIGFuaW0gID0gYW5pbXNbcHJvcGVydHldIHx8IChhbmltc1twcm9wZXJ0eV0gPSBuZXcgQmFzZUFuaW1hdGlvbihub2RlLCBwcm9wZXJ0eSkpXG4gICAgICAgICAgICAgICAgYW5pbS5zZXRPcHRpb25zKG9wdGlvbnMpLnN0YXJ0KHZhbHVlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG5cbiAgICB9LFxuXG4gICAgLy8ge3Byb3BlcnRpZXN9IG9yXG4gICAgLy8gcHJvcGVydHksIHZhbHVlXG4gICAgc3R5bGU6IGZ1bmN0aW9uKEEsIEIpe1xuXG4gICAgICAgIHZhciBzdHlsZXMgPSBBXG5cbiAgICAgICAgaWYgKHR5cGVvZiBBID09PSBcInN0cmluZ1wiKXtcbiAgICAgICAgICAgIHN0eWxlcyA9IHt9XG4gICAgICAgICAgICBzdHlsZXNbQV0gPSBCXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZXMpe1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVzW3Byb3BlcnR5XSxcbiAgICAgICAgICAgICAgICBzZXQgICA9IHNldHRlcihwcm9wZXJ0eSA9IGNhbWVsaXplKHByb3BlcnR5KSlcblxuICAgICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gZWxlbWVudHMobm9kZSksIGFuaW1zID0gc2VsZi5fYW5pbWF0aW9ucywgYW5pbVxuICAgICAgICAgICAgICAgIGlmIChhbmltcyAmJiAoYW5pbSA9IGFuaW1zW3Byb3BlcnR5XSkpIGFuaW0uc3RvcCh0cnVlKVxuICAgICAgICAgICAgICAgIHNldC5jYWxsKG5vZGUsIHZhbHVlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG5cbiAgICB9LFxuXG4gICAgY29tcHV0ZTogZnVuY3Rpb24ocHJvcGVydHkpe1xuXG4gICAgICAgIHByb3BlcnR5ID0gY2FtZWxpemUocHJvcGVydHkpXG4gICAgICAgIHZhciBub2RlID0gdGhpc1swXVxuXG4gICAgICAgIC8vIHJldHVybiBkZWZhdWx0IG1hdHJpeCBmb3IgdHJhbnNmb3JtLCBpbnN0ZWFkIG9mIHBhcnNlZCAoZm9yIGNvbnNpc3RlbmN5KVxuXG4gICAgICAgIGlmIChwcm9wZXJ0eSA9PT0gXCJ0cmFuc2Zvcm1cIiAmJiBwYXJzZVRyYW5zZm9ybTJkKSByZXR1cm4gY29tcHV0ZShub2RlKSh0cmFuc2Zvcm1OYW1lKVxuXG4gICAgICAgIHZhciB2YWx1ZSA9IGdldHRlcihwcm9wZXJ0eSkuY2FsbChub2RlKVxuXG4gICAgICAgIC8vIHVuaXQgY29udmVyc2lvbiB0byBgcHhgXG5cbiAgICAgICAgcmV0dXJuICh2YWx1ZSAhPSBudWxsKSA/IHZhbHVlLnJlcGxhY2UocmdMZW5ndGgsIGZ1bmN0aW9uKG1hdGNoLCB2YWx1ZSwgdW5pdCl7XG4gICAgICAgICAgICByZXR1cm4gKHVuaXQgPT09IFwicHhcIikgPyBtYXRjaCA6IHBpeGVsUmF0aW8obm9kZSwgdW5pdCkgKiB2YWx1ZSArIFwicHhcIlxuICAgICAgICB9KSA6ICcnXG5cbiAgICB9XG5cbn0pXG5cbm1vb2Z4LnBhcnNlID0gZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlLCBub3JtYWxpemUpe1xuICAgIHJldHVybiAocGFyc2Vyc1tjYW1lbGl6ZShwcm9wZXJ0eSldIHx8IHBhcnNlKSh2YWx1ZSwgbm9ybWFsaXplKVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG1vb2Z4XG4iLCIvKlxuY29sb3JcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGNvbG9ycyA9IHtcbiAgICBtYXJvb24gICAgICA6IFwiIzgwMDAwMFwiLFxuICAgIHJlZCAgICAgICAgIDogXCIjZmYwMDAwXCIsXG4gICAgb3JhbmdlICAgICAgOiBcIiNmZkE1MDBcIixcbiAgICB5ZWxsb3cgICAgICA6IFwiI2ZmZmYwMFwiLFxuICAgIG9saXZlICAgICAgIDogXCIjODA4MDAwXCIsXG4gICAgcHVycGxlICAgICAgOiBcIiM4MDAwODBcIixcbiAgICBmdWNoc2lhICAgICA6IFwiI2ZmMDBmZlwiLFxuICAgIHdoaXRlICAgICAgIDogXCIjZmZmZmZmXCIsXG4gICAgbGltZSAgICAgICAgOiBcIiMwMGZmMDBcIixcbiAgICBncmVlbiAgICAgICA6IFwiIzAwODAwMFwiLFxuICAgIG5hdnkgICAgICAgIDogXCIjMDAwMDgwXCIsXG4gICAgYmx1ZSAgICAgICAgOiBcIiMwMDAwZmZcIixcbiAgICBhcXVhICAgICAgICA6IFwiIzAwZmZmZlwiLFxuICAgIHRlYWwgICAgICAgIDogXCIjMDA4MDgwXCIsXG4gICAgYmxhY2sgICAgICAgOiBcIiMwMDAwMDBcIixcbiAgICBzaWx2ZXIgICAgICA6IFwiI2MwYzBjMFwiLFxuICAgIGdyYXkgICAgICAgIDogXCIjODA4MDgwXCIsXG4gICAgdHJhbnNwYXJlbnQgOiBcIiMwMDAwXCJcbn1cblxudmFyIFJHQnRvUkdCID0gZnVuY3Rpb24ociwgZywgYiwgYSl7XG4gICAgaWYgKGEgPT0gbnVsbCB8fCBhID09PSBcIlwiKSBhID0gMVxuICAgIHIgPSBwYXJzZUZsb2F0KHIpXG4gICAgZyA9IHBhcnNlRmxvYXQoZylcbiAgICBiID0gcGFyc2VGbG9hdChiKVxuICAgIGEgPSBwYXJzZUZsb2F0KGEpXG4gICAgaWYgKCEociA8PSAyNTUgJiYgciA+PSAwICYmIGcgPD0gMjU1ICYmIGcgPj0gMCAmJiBiIDw9IDI1NSAmJiBiID49IDAgJiYgYSA8PSAxICYmIGEgPj0gMCkpIHJldHVybiBudWxsXG5cbiAgICByZXR1cm4gW01hdGgucm91bmQociksIE1hdGgucm91bmQoZyksIE1hdGgucm91bmQoYiksIGFdXG59XG5cbnZhciBIRVh0b1JHQiA9IGZ1bmN0aW9uKGhleCl7XG4gICAgaWYgKGhleC5sZW5ndGggPT09IDMpIGhleCArPSBcImZcIlxuICAgIGlmIChoZXgubGVuZ3RoID09PSA0KXtcbiAgICAgICAgdmFyIGgwID0gaGV4LmNoYXJBdCgwKSxcbiAgICAgICAgICAgIGgxID0gaGV4LmNoYXJBdCgxKSxcbiAgICAgICAgICAgIGgyID0gaGV4LmNoYXJBdCgyKSxcbiAgICAgICAgICAgIGgzID0gaGV4LmNoYXJBdCgzKVxuXG4gICAgICAgIGhleCA9IGgwICsgaDAgKyBoMSArIGgxICsgaDIgKyBoMiArIGgzICsgaDNcbiAgICB9XG4gICAgaWYgKGhleC5sZW5ndGggPT09IDYpIGhleCArPSBcImZmXCJcbiAgICB2YXIgcmdiID0gW11cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGhleC5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHJnYi5wdXNoKHBhcnNlSW50KGhleC5zdWJzdHIoaSwgMiksIDE2KSAvIChpID09PSA2ID8gMjU1IDogMSkpXG4gICAgcmV0dXJuIHJnYlxufVxuXG4vLyBIU0wgdG8gUkdCIGNvbnZlcnNpb24gZnJvbTpcbi8vIGh0dHA6Ly9tamlqYWNrc29uLmNvbS8yMDA4LzAyL3JnYi10by1oc2wtYW5kLXJnYi10by1oc3YtY29sb3ItbW9kZWwtY29udmVyc2lvbi1hbGdvcml0aG1zLWluLWphdmFzY3JpcHRcbi8vIHRoYW5rIHlvdSFcblxudmFyIEhVRXRvUkdCID0gZnVuY3Rpb24ocCwgcSwgdCl7XG4gICAgaWYgKHQgPCAwKSB0ICs9IDFcbiAgICBpZiAodCA+IDEpIHQgLT0gMVxuICAgIGlmICh0IDwgMSAvIDYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0XG4gICAgaWYgKHQgPCAxIC8gMikgcmV0dXJuIHFcbiAgICBpZiAodCA8IDIgLyAzKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMiAvIDMgLSB0KSAqIDZcbiAgICByZXR1cm4gcFxufVxuXG52YXIgSFNMdG9SR0IgPSBmdW5jdGlvbihoLCBzLCBsLCBhKXtcbiAgICB2YXIgciwgYiwgZ1xuICAgIGlmIChhID09IG51bGwgfHwgYSA9PT0gXCJcIikgYSA9IDFcbiAgICBoID0gcGFyc2VGbG9hdChoKSAvIDM2MFxuICAgIHMgPSBwYXJzZUZsb2F0KHMpIC8gMTAwXG4gICAgbCA9IHBhcnNlRmxvYXQobCkgLyAxMDBcbiAgICBhID0gcGFyc2VGbG9hdChhKSAvIDFcbiAgICBpZiAoaCA+IDEgfHwgaCA8IDAgfHwgcyA+IDEgfHwgcyA8IDAgfHwgbCA+IDEgfHwgbCA8IDAgfHwgYSA+IDEgfHwgYSA8IDApIHJldHVybiBudWxsXG4gICAgaWYgKHMgPT09IDApe1xuICAgICAgICByID0gYiA9IGcgPSBsXG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzXG4gICAgICAgIHZhciBwID0gMiAqIGwgLSBxXG4gICAgICAgIHIgPSBIVUV0b1JHQihwLCBxLCBoICsgMSAvIDMpXG4gICAgICAgIGcgPSBIVUV0b1JHQihwLCBxLCBoKVxuICAgICAgICBiID0gSFVFdG9SR0IocCwgcSwgaCAtIDEgLyAzKVxuICAgIH1cbiAgICByZXR1cm4gW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTUsIGFdXG59XG5cbnZhciBrZXlzID0gW11cbmZvciAodmFyIGMgaW4gY29sb3JzKSBrZXlzLnB1c2goYylcblxudmFyIHNoZXggID0gXCIoPzojKFthLWYwLTldezMsOH0pKVwiLFxuICAgIHN2YWwgID0gXCJcXFxccyooWy5cXFxcZCVdKylcXFxccypcIixcbiAgICBzb3AgICA9IFwiKD86LFxcXFxzKihbLlxcXFxkXSspXFxcXHMqKT9cIixcbiAgICBzbGlzdCA9IFwiXFxcXChcIiArIFtzdmFsLCBzdmFsLCBzdmFsXSArIHNvcCArIFwiXFxcXClcIixcbiAgICBzcmdiICA9IFwiKD86cmdiKWE/XCIsXG4gICAgc2hzbCAgPSBcIig/OmhzbClhP1wiLFxuICAgIHNrZXlzID0gXCIoXCIgKyBrZXlzLmpvaW4oXCJ8XCIpICsgXCIpXCJcblxuXG52YXIgeGhleCAgID0gUmVnRXhwKHNoZXgsIFwiaVwiKSxcbiAgICB4cmdiICAgPSBSZWdFeHAoc3JnYiArIHNsaXN0LCBcImlcIiksXG4gICAgeGhzbCAgID0gUmVnRXhwKHNoc2wgKyBzbGlzdCwgXCJpXCIpXG5cbnZhciBjb2xvciA9IGZ1bmN0aW9uKGlucHV0LCBhcnJheSl7XG4gICAgaWYgKGlucHV0ID09IG51bGwpIHJldHVybiBudWxsXG4gICAgaW5wdXQgPSAoaW5wdXQgKyBcIlwiKS5yZXBsYWNlKC9cXHMrLywgXCJcIilcblxuICAgIHZhciBtYXRjaCA9IGNvbG9yc1tpbnB1dF1cbiAgICBpZiAobWF0Y2gpe1xuICAgICAgICByZXR1cm4gY29sb3IobWF0Y2gsIGFycmF5KVxuICAgIH0gZWxzZSBpZiAobWF0Y2ggPSBpbnB1dC5tYXRjaCh4aGV4KSl7XG4gICAgICAgIGlucHV0ID0gSEVYdG9SR0IobWF0Y2hbMV0pXG4gICAgfSBlbHNlIGlmIChtYXRjaCA9IGlucHV0Lm1hdGNoKHhyZ2IpKXtcbiAgICAgICAgaW5wdXQgPSBtYXRjaC5zbGljZSgxKVxuICAgIH0gZWxzZSBpZiAobWF0Y2ggPSBpbnB1dC5tYXRjaCh4aHNsKSl7XG4gICAgICAgIGlucHV0ID0gSFNMdG9SR0IuYXBwbHkobnVsbCwgbWF0Y2guc2xpY2UoMSkpXG4gICAgfSBlbHNlIHJldHVybiBudWxsXG5cbiAgICBpZiAoIShpbnB1dCAmJiAoaW5wdXQgPSBSR0J0b1JHQi5hcHBseShudWxsLCBpbnB1dCkpKSkgcmV0dXJuIG51bGxcbiAgICBpZiAoYXJyYXkpIHJldHVybiBpbnB1dFxuICAgIGlmIChpbnB1dFszXSA9PT0gMSkgaW5wdXQuc3BsaWNlKDMsIDEpXG4gICAgcmV0dXJuIFwicmdiXCIgKyAoaW5wdXQubGVuZ3RoID09PSA0ID8gXCJhXCIgOiBcIlwiKSArIFwiKFwiICsgaW5wdXQgKyBcIilcIlxufVxuXG5jb2xvci54ID0gUmVnRXhwKFtza2V5cywgc2hleCwgc3JnYiArIHNsaXN0LCBzaHNsICsgc2xpc3RdLmpvaW4oXCJ8XCIpLCBcImdpXCIpXG5cbm1vZHVsZS5leHBvcnRzID0gY29sb3JcbiIsIi8qXG5yZXF1ZXN0RnJhbWUgLyBjYW5jZWxGcmFtZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgaW5kZXhPZiA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9pbmRleE9mXCIpXG5cbnZhciByZXF1ZXN0RnJhbWUgPSBnbG9iYWwucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICAgICAgICAgZ2xvYmFsLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgICAgIGdsb2JhbC5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICAgICBnbG9iYWwub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgICAgIGdsb2JhbC5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKClcbiAgICAgICAgICAgICAgICAgICAgICAgfSwgMWUzIC8gNjApXG4gICAgICAgICAgICAgICAgICAgfVxuXG52YXIgY2FsbGJhY2tzID0gW11cblxudmFyIGl0ZXJhdG9yID0gZnVuY3Rpb24odGltZSl7XG4gICAgdmFyIHNwbGl0ID0gY2FsbGJhY2tzLnNwbGljZSgwLCBjYWxsYmFja3MubGVuZ3RoKVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gc3BsaXQubGVuZ3RoOyBpIDwgbDsgaSsrKSBzcGxpdFtpXSh0aW1lIHx8ICh0aW1lID0gKyhuZXcgRGF0ZSkpKVxufVxuXG52YXIgY2FuY2VsID0gZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgIHZhciBpbyA9IGluZGV4T2YoY2FsbGJhY2tzLCBjYWxsYmFjaylcbiAgICBpZiAoaW8gPiAtMSkgY2FsbGJhY2tzLnNwbGljZShpbywgMSlcbn1cblxudmFyIHJlcXVlc3QgPSBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgdmFyIGkgPSBjYWxsYmFja3MucHVzaChjYWxsYmFjaylcbiAgICBpZiAoaSA9PT0gMSkgcmVxdWVzdEZyYW1lKGl0ZXJhdG9yKVxuICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICBjYW5jZWwoY2FsbGJhY2spXG4gICAgfVxufVxuXG5leHBvcnRzLnJlcXVlc3QgPSByZXF1ZXN0XG5leHBvcnRzLmNhbmNlbCA9IGNhbmNlbFxuIiwiLypcbmZ4XG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBwcmltZSAgICAgICAgPSByZXF1aXJlKFwicHJpbWVcIiksXG4gICAgcmVxdWVzdEZyYW1lID0gcmVxdWlyZShcIi4vZnJhbWVcIikucmVxdWVzdCxcbiAgICBiZXppZXIgICAgICAgPSByZXF1aXJlKFwiY3ViaWMtYmV6aWVyXCIpXG5cbnZhciBtYXAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvbWFwXCIpXG5cbnZhciBzRHVyYXRpb24gICAgPSBcIihbXFxcXGQuXSspKHN8bXMpP1wiLFxuICAgIHNDdWJpY0JlemllciA9IFwiY3ViaWMtYmV6aWVyXFxcXCgoWy0uXFxcXGRdKyksKFstLlxcXFxkXSspLChbLS5cXFxcZF0rKSwoWy0uXFxcXGRdKylcXFxcKVwiXG5cbnZhciByRHVyYXRpb24gICAgID0gUmVnRXhwKHNEdXJhdGlvbiksXG4gICAgckN1YmljQmV6aWVyICA9IFJlZ0V4cChzQ3ViaWNCZXppZXIpLFxuICAgIHJnQ3ViaWNCZXppZXIgPSBSZWdFeHAoc0N1YmljQmV6aWVyLCBcImdcIilcblxuICAgIC8vIGVxdWF0aW9ucyBjb2xsZWN0aW9uXG5cbnZhciBlcXVhdGlvbnMgPSB7XG4gICAgXCJkZWZhdWx0XCIgICAgIDogXCJjdWJpYy1iZXppZXIoMC4yNSwgMC4xLCAwLjI1LCAxLjApXCIsXG4gICAgXCJsaW5lYXJcIiAgICAgIDogXCJjdWJpYy1iZXppZXIoMCwgMCwgMSwgMSlcIixcbiAgICBcImVhc2UtaW5cIiAgICAgOiBcImN1YmljLWJlemllcigwLjQyLCAwLCAxLjAsIDEuMClcIixcbiAgICBcImVhc2Utb3V0XCIgICAgOiBcImN1YmljLWJlemllcigwLCAwLCAwLjU4LCAxLjApXCIsXG4gICAgXCJlYXNlLWluLW91dFwiIDogXCJjdWJpYy1iZXppZXIoMC40MiwgMCwgMC41OCwgMS4wKVwiXG59XG5cbmVxdWF0aW9ucy5lYXNlID0gZXF1YXRpb25zW1wiZGVmYXVsdFwiXVxuXG52YXIgY29tcHV0ZSA9IGZ1bmN0aW9uKGZyb20sIHRvLCBkZWx0YSl7XG4gICAgcmV0dXJuICh0byAtIGZyb20pICogZGVsdGEgKyBmcm9tXG59XG5cbnZhciBkaXZpZGUgPSBmdW5jdGlvbihzdHJpbmcpe1xuICAgIHZhciBudW1iZXJzID0gW11cbiAgICB2YXIgdGVtcGxhdGUgPSAoc3RyaW5nICsgXCJcIikucmVwbGFjZSgvWy0uXFxkXSsvZywgZnVuY3Rpb24obnVtYmVyKXtcbiAgICAgICAgbnVtYmVycy5wdXNoKCtudW1iZXIpXG4gICAgICAgIHJldHVybiBcIkBcIlxuICAgIH0pXG4gICAgcmV0dXJuIFtudW1iZXJzLCB0ZW1wbGF0ZV1cbn1cblxudmFyIEZ4ID0gcHJpbWUoe1xuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIEZ4KHJlbmRlciwgb3B0aW9ucyl7XG5cbiAgICAgICAgLy8gc2V0IG9wdGlvbnNcblxuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucylcblxuICAgICAgICAvLyByZW5kZXJlclxuXG4gICAgICAgIHRoaXMucmVuZGVyID0gcmVuZGVyIHx8IGZ1bmN0aW9uKCl7fVxuXG4gICAgICAgIC8vIGJvdW5kIGZ1bmN0aW9uc1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuXG4gICAgICAgIHRoaXMuYlN0ZXAgPSBmdW5jdGlvbih0KXtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnN0ZXAodClcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYkV4aXQgPSBmdW5jdGlvbih0aW1lKXtcbiAgICAgICAgICAgIHNlbGYuZXhpdCh0aW1lKVxuICAgICAgICB9XG5cbiAgICB9LFxuXG4gICAgc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIGlmIChvcHRpb25zID09IG51bGwpIG9wdGlvbnMgPSB7fVxuXG4gICAgICAgIGlmICghKHRoaXMuZHVyYXRpb24gPSB0aGlzLnBhcnNlRHVyYXRpb24ob3B0aW9ucy5kdXJhdGlvbiB8fCBcIjUwMG1zXCIpKSkgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCBkdXJhdGlvblwiKVxuICAgICAgICBpZiAoISh0aGlzLmVxdWF0aW9uID0gdGhpcy5wYXJzZUVxdWF0aW9uKG9wdGlvbnMuZXF1YXRpb24gfHwgXCJkZWZhdWx0XCIpKSkgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCBlcXVhdGlvblwiKVxuICAgICAgICB0aGlzLmNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjayB8fCBmdW5jdGlvbigpe31cblxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBwYXJzZUR1cmF0aW9uOiBmdW5jdGlvbihkdXJhdGlvbil7XG4gICAgICAgIGlmIChkdXJhdGlvbiA9IChkdXJhdGlvbiArIFwiXCIpLm1hdGNoKHJEdXJhdGlvbikpe1xuICAgICAgICAgICAgdmFyIHRpbWUgPSArZHVyYXRpb25bMV0sXG4gICAgICAgICAgICAgICAgdW5pdCA9IGR1cmF0aW9uWzJdIHx8IFwibXNcIlxuXG4gICAgICAgICAgICBpZiAodW5pdCA9PT0gXCJzXCIpICByZXR1cm4gdGltZSAqIDFlM1xuICAgICAgICAgICAgaWYgKHVuaXQgPT09IFwibXNcIikgcmV0dXJuIHRpbWVcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwYXJzZUVxdWF0aW9uOiBmdW5jdGlvbihlcXVhdGlvbiwgYXJyYXkpe1xuICAgICAgICB2YXIgdHlwZSA9IHR5cGVvZiBlcXVhdGlvblxuXG4gICAgICAgIGlmICh0eXBlID09PSBcImZ1bmN0aW9uXCIpeyAvLyBmdW5jdGlvblxuICAgICAgICAgICAgcmV0dXJuIGVxdWF0aW9uXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJzdHJpbmdcIil7IC8vIGN1YmljLWJlemllciBzdHJpbmdcbiAgICAgICAgICAgIGVxdWF0aW9uID0gZXF1YXRpb25zW2VxdWF0aW9uXSB8fCBlcXVhdGlvblxuICAgICAgICAgICAgdmFyIG1hdGNoID0gZXF1YXRpb24ucmVwbGFjZSgvXFxzKy9nLCBcIlwiKS5tYXRjaChyQ3ViaWNCZXppZXIpXG4gICAgICAgICAgICBpZiAobWF0Y2gpe1xuICAgICAgICAgICAgICAgIGVxdWF0aW9uID0gbWFwKG1hdGNoLnNsaWNlKDEpLCBmdW5jdGlvbih2KXtyZXR1cm4gK3Z9KVxuICAgICAgICAgICAgICAgIGlmIChhcnJheSkgcmV0dXJuIGVxdWF0aW9uXG4gICAgICAgICAgICAgICAgaWYgKGVxdWF0aW9uLnRvU3RyaW5nKCkgPT09IFwiMCwwLDEsMVwiKSByZXR1cm4gZnVuY3Rpb24oeCl7cmV0dXJuIHh9XG4gICAgICAgICAgICAgICAgdHlwZSA9IFwib2JqZWN0XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlID09PSBcIm9iamVjdFwiKXsgLy8gYXJyYXlcbiAgICAgICAgICAgIHJldHVybiBiZXppZXIoZXF1YXRpb25bMF0sIGVxdWF0aW9uWzFdLCBlcXVhdGlvblsyXSwgZXF1YXRpb25bM10sIDFlMyAvIDYwIC8gdGhpcy5kdXJhdGlvbiAvIDQpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2FuY2VsOiBmdW5jdGlvbih0byl7XG4gICAgICAgIHRoaXMudG8gPSB0b1xuICAgICAgICB0aGlzLmNhbmNlbEV4aXQgPSByZXF1ZXN0RnJhbWUodGhpcy5iRXhpdClcbiAgICB9LFxuXG4gICAgZXhpdDogZnVuY3Rpb24odGltZSl7XG4gICAgICAgIHRoaXMucmVuZGVyKHRoaXMudG8pXG4gICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbEV4aXRcbiAgICAgICAgdGhpcy5jYWxsYmFjayh0aW1lKVxuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZnJvbSwgdG8pe1xuXG4gICAgICAgIHRoaXMuc3RvcCgpXG5cbiAgICAgICAgaWYgKHRoaXMuZHVyYXRpb24gPT09IDApe1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwodG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc0FycmF5ID0gZmFsc2VcbiAgICAgICAgdGhpcy5pc051bWJlciA9IGZhbHNlXG5cbiAgICAgICAgdmFyIGZyb21UeXBlID0gdHlwZW9mIGZyb20sXG4gICAgICAgICAgICB0b1R5cGUgICA9IHR5cGVvZiB0b1xuXG4gICAgICAgIGlmIChmcm9tVHlwZSA9PT0gXCJvYmplY3RcIiAmJiB0b1R5cGUgPT09IFwib2JqZWN0XCIpe1xuICAgICAgICAgICAgdGhpcy5pc0FycmF5ID0gdHJ1ZVxuICAgICAgICB9IGVsc2UgaWYgKGZyb21UeXBlID09PSBcIm51bWJlclwiICYmIHRvVHlwZSA9PT0gXCJudW1iZXJcIil7XG4gICAgICAgICAgICB0aGlzLmlzTnVtYmVyID0gdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZyb21fID0gZGl2aWRlKGZyb20pLFxuICAgICAgICAgICAgdG9fICAgPSBkaXZpZGUodG8pXG5cbiAgICAgICAgdGhpcy5mcm9tID0gZnJvbV9bMF1cbiAgICAgICAgdGhpcy50byA9IHRvX1swXVxuICAgICAgICB0aGlzLnRlbXBsYXRlRnJvbSA9IGZyb21fWzFdXG4gICAgICAgIHRoaXMudGVtcGxhdGVUbyA9IHRvX1sxXVxuXG4gICAgICAgIGlmICh0aGlzLmZyb20ubGVuZ3RoICE9PSB0aGlzLnRvLmxlbmd0aCB8fCB0aGlzLmZyb20udG9TdHJpbmcoKSA9PT0gdGhpcy50by50b1N0cmluZygpKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsKHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgICAgIGRlbGV0ZSB0aGlzLnRpbWVcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmZyb20ubGVuZ3RoXG4gICAgICAgIHRoaXMuY2FuY2VsU3RlcCA9IHJlcXVlc3RGcmFtZSh0aGlzLmJTdGVwKVxuXG4gICAgICAgIHJldHVybiB0aGlzXG5cbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oKXtcblxuICAgICAgICBpZiAodGhpcy5jYW5jZWxFeGl0KXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsRXhpdCgpXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxFeGl0XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jYW5jZWxTdGVwKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsU3RlcCgpXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxTdGVwXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBzdGVwOiBmdW5jdGlvbihub3cpe1xuXG4gICAgICAgIHRoaXMudGltZSB8fCAodGhpcy50aW1lID0gbm93KVxuXG4gICAgICAgIHZhciBmYWN0b3IgPSAobm93IC0gdGhpcy50aW1lKSAvIHRoaXMuZHVyYXRpb25cblxuICAgICAgICBpZiAoZmFjdG9yID4gMSkgZmFjdG9yID0gMVxuXG4gICAgICAgIHZhciBkZWx0YSA9IHRoaXMuZXF1YXRpb24oZmFjdG9yKSxcbiAgICAgICAgICAgIGZyb20gID0gdGhpcy5mcm9tLFxuICAgICAgICAgICAgdG8gICAgPSB0aGlzLnRvLFxuICAgICAgICAgICAgdHBsICAgPSB0aGlzLnRlbXBsYXRlVG9cblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgICAgIHZhciBmID0gZnJvbVtpXSwgdCA9IHRvW2ldXG4gICAgICAgICAgICB0cGwgPSB0cGwucmVwbGFjZShcIkBcIiwgdCAhPT0gZiA/IGNvbXB1dGUoZiwgdCwgZGVsdGEpIDogdClcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVuZGVyKHRoaXMuaXNBcnJheSA/IHRwbC5zcGxpdChcIixcIikgOiB0aGlzLmlzTnVtYmVyID8gK3RwbCA6IHRwbCwgZmFjdG9yKVxuXG4gICAgICAgIGlmIChmYWN0b3IgIT09IDEpe1xuICAgICAgICAgICAgdGhpcy5jYW5jZWxTdGVwID0gcmVxdWVzdEZyYW1lKHRoaXMuYlN0ZXApXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxTdGVwXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrKG5vdylcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KVxuXG52YXIgZnggPSBmdW5jdGlvbihyZW5kZXIpe1xuXG4gICAgdmFyIGZmeCA9IG5ldyBGeChyZW5kZXIpXG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIHN0YXJ0OiBmdW5jdGlvbihmcm9tLCB0bywgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgdHlwZSA9IHR5cGVvZiBvcHRpb25zXG4gICAgICAgICAgICBmZnguc2V0T3B0aW9ucygodHlwZSA9PT0gXCJmdW5jdGlvblwiKSA/IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogb3B0aW9uc1xuICAgICAgICAgICAgfSA6ICh0eXBlID09PSBcInN0cmluZ1wiIHx8IHR5cGUgPT09IFwibnVtYmVyXCIpID8ge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBvcHRpb25zXG4gICAgICAgICAgICB9IDogb3B0aW9ucykuc3RhcnQoZnJvbSwgdG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBmZnguc3RvcCgpXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG5cbiAgICB9XG5cbn1cblxuZngucHJvdG90eXBlID0gRngucHJvdG90eXBlXG5cbm1vZHVsZS5leHBvcnRzID0gZnhcbiIsIi8qXG5Vbm1hdHJpeCAyZFxuIC0gYSBjcnVkZSBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgc2xpZ2h0bHkgYnVnZ2VkIHBzZXVkbyBjb2RlIGluIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtMmQtdHJhbnNmb3Jtcy8jbWF0cml4LWRlY29tcG9zaXRpb25cbiovXCJ1c2Ugc3RyaWN0XCJcblxuLy8gcmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBwYXNzZWQgdmVjdG9yXG5cbnZhciBsZW5ndGggPSBmdW5jdGlvbihhKXtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGFbMF0gKiBhWzBdICsgYVsxXSAqIGFbMV0pXG59XG5cbi8vIG5vcm1hbGl6ZXMgdGhlIGxlbmd0aCBvZiB0aGUgcGFzc2VkIHBvaW50IHRvIDFcblxudmFyIG5vcm1hbGl6ZSA9IGZ1bmN0aW9uKGEpe1xuICAgIHZhciBsID0gbGVuZ3RoKGEpXG4gICAgcmV0dXJuIGwgPyBbYVswXSAvIGwsIGFbMV0gLyBsXSA6IFswLCAwXVxufVxuXG4vLyByZXR1cm5zIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGUgcGFzc2VkIHBvaW50c1xuXG52YXIgZG90ID0gZnVuY3Rpb24oYSwgYil7XG4gICAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV1cbn1cblxuLy8gcmV0dXJucyB0aGUgcHJpbmNpcGFsIHZhbHVlIG9mIHRoZSBhcmMgdGFuZ2VudCBvZlxuLy8geS94LCB1c2luZyB0aGUgc2lnbnMgb2YgYm90aCBhcmd1bWVudHMgdG8gZGV0ZXJtaW5lXG4vLyB0aGUgcXVhZHJhbnQgb2YgdGhlIHJldHVybiB2YWx1ZVxuXG52YXIgYXRhbjIgPSBNYXRoLmF0YW4yXG5cbnZhciBjb21iaW5lID0gZnVuY3Rpb24oYSwgYiwgYXNjbCwgYnNjbCl7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgKGFzY2wgKiBhWzBdKSArIChic2NsICogYlswXSksXG4gICAgICAgIChhc2NsICogYVsxXSkgKyAoYnNjbCAqIGJbMV0pXG4gICAgXVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIHR4LCB0eSl7XG5cbiAgICAvLyBNYWtlIHN1cmUgdGhlIG1hdHJpeCBpcyBpbnZlcnRpYmxlXG5cbiAgICBpZiAoKGEgKiBkIC0gYiAqIGMpID09PSAwKSByZXR1cm4gZmFsc2VcblxuICAgIC8vIFRha2UgY2FyZSBvZiB0cmFuc2xhdGlvblxuXG4gICAgdmFyIHRyYW5zbGF0ZSA9IFt0eCwgdHldXG5cbiAgICAvLyBQdXQgdGhlIGNvbXBvbmVudHMgaW50byBhIDJ4MiBtYXRyaXhcblxuICAgIHZhciBtID0gW1thLCBiXSwgW2MsIGRdXVxuXG4gICAgLy8gQ29tcHV0ZSBYIHNjYWxlIGZhY3RvciBhbmQgbm9ybWFsaXplIGZpcnN0IHJvdy5cblxuICAgIHZhciBzY2FsZSA9IFtsZW5ndGgobVswXSldXG4gICAgbVswXSA9IG5vcm1hbGl6ZShtWzBdKVxuXG4gICAgLy8gQ29tcHV0ZSBzaGVhciBmYWN0b3IgYW5kIG1ha2UgMm5kIHJvdyBvcnRob2dvbmFsIHRvIDFzdC5cblxuICAgIHZhciBza2V3ID0gZG90KG1bMF0sIG1bMV0pXG4gICAgbVsxXSA9IGNvbWJpbmUobVsxXSwgbVswXSwgMSwgLXNrZXcpXG5cbiAgICAvLyBOb3csIGNvbXB1dGUgWSBzY2FsZSBhbmQgbm9ybWFsaXplIDJuZCByb3cuXG5cbiAgICBzY2FsZVsxXSA9IGxlbmd0aChtWzFdKVxuICAgIC8vIG1bMV0gPSBub3JtYWxpemUobVsxXSkgLy9cbiAgICBza2V3IC89IHNjYWxlWzFdXG5cbiAgICAvLyBOb3csIGdldCB0aGUgcm90YXRpb24gb3V0XG5cbiAgICB2YXIgcm90YXRlID0gYXRhbjIobVswXVsxXSwgbVswXVswXSlcblxuICAgIHJldHVybiBbdHJhbnNsYXRlLCByb3RhdGUsIHNrZXcsIHNjYWxlXVxuXG59XG4iLCIvKlxuZWxlbWVudHNcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIHByaW1lICAgPSByZXF1aXJlKFwicHJpbWVcIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9mb3JFYWNoXCIpLFxuICAgIG1hcCAgICAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvbWFwXCIpLFxuICAgIGZpbHRlciAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvZmlsdGVyXCIpLFxuICAgIGV2ZXJ5ICAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvZXZlcnlcIiksXG4gICAgc29tZSAgICA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9zb21lXCIpXG5cbi8vIHVuaXF1ZUlEXG5cbnZhciB1bmlxdWVJbmRleCA9IDBcbnZhciB1bmlxdWVJRCA9IGZ1bmN0aW9uKG4pe1xuICAgIHJldHVybiAobiA9PT0gZ2xvYmFsKSA/IFwiZ2xvYmFsXCIgOiBuLnVuaXF1ZU51bWJlciB8fCAobi51bmlxdWVOdW1iZXIgPSBcIm46XCIgKyAodW5pcXVlSW5kZXgrKykudG9TdHJpbmcoMzYpKVxufVxuXG52YXIgaW5zdGFuY2VzID0ge31cblxuLy8gZWxlbWVudHMgcHJpbWVcblxudmFyICQgPSBwcmltZSh7Y29uc3RydWN0b3I6IGZ1bmN0aW9uICQobiwgY29udGV4dCl7XG5cbiAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gKHRoaXMgJiYgdGhpcy5jb25zdHJ1Y3RvciA9PT0gJCkgPyBuZXcgZWxlbWVudHMgOiBudWxsXG5cbiAgICB2YXIgc2VsZiA9IG5cblxuICAgIGlmIChuLmNvbnN0cnVjdG9yICE9PSBlbGVtZW50cyl7XG5cbiAgICAgICAgc2VsZiA9IG5ldyBlbGVtZW50c1xuXG4gICAgICAgIHZhciB1aWRcblxuICAgICAgICBpZiAodHlwZW9mIG4gPT09IFwic3RyaW5nXCIpe1xuICAgICAgICAgICAgaWYgKCFzZWxmLnNlYXJjaCkgcmV0dXJuIG51bGxcbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBjb250ZXh0IHx8IGRvY3VtZW50XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5zZWFyY2gobilcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuLm5vZGVUeXBlIHx8IG4gPT09IGdsb2JhbCl7XG5cbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBuXG5cbiAgICAgICAgfSBlbHNlIGlmIChuLmxlbmd0aCl7XG5cbiAgICAgICAgICAgIC8vIHRoaXMgY291bGQgYmUgYW4gYXJyYXksIG9yIGFueSBvYmplY3Qgd2l0aCBhIGxlbmd0aCBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAvLyBpbmNsdWRpbmcgYW5vdGhlciBpbnN0YW5jZSBvZiBlbGVtZW50cyBmcm9tIGFub3RoZXIgaW50ZXJmYWNlLlxuXG4gICAgICAgICAgICB2YXIgdW5pcXVlcyA9IHt9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbi5sZW5ndGg7IGkgPCBsOyBpKyspeyAvLyBwZXJmb3JtIGVsZW1lbnRzIGZsYXR0ZW5pbmdcbiAgICAgICAgICAgICAgICB2YXIgbm9kZXMgPSAkKG5baV0sIGNvbnRleHQpXG4gICAgICAgICAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkgZm9yICh2YXIgaiA9IDAsIGsgPSBub2Rlcy5sZW5ndGg7IGogPCBrOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2pdXG4gICAgICAgICAgICAgICAgICAgIHVpZCA9IHVuaXF1ZUlEKG5vZGUpXG4gICAgICAgICAgICAgICAgICAgIGlmICghdW5pcXVlc1t1aWRdKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBub2RlXG4gICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVzW3VpZF0gPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaWYgKCFzZWxmLmxlbmd0aCkgcmV0dXJuIG51bGxcblxuICAgIC8vIHdoZW4gbGVuZ3RoIGlzIDEgYWx3YXlzIHVzZSB0aGUgc2FtZSBlbGVtZW50cyBpbnN0YW5jZVxuXG4gICAgaWYgKHNlbGYubGVuZ3RoID09PSAxKXtcbiAgICAgICAgdWlkID0gdW5pcXVlSUQoc2VsZlswXSlcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlc1t1aWRdIHx8IChpbnN0YW5jZXNbdWlkXSA9IHNlbGYpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGZcblxufX0pXG5cbnZhciBlbGVtZW50cyA9IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiAkLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIGVsZW1lbnRzKCl7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMFxuICAgIH0sXG5cbiAgICB1bmxpbms6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihub2RlLCBpKXtcbiAgICAgICAgICAgIGRlbGV0ZSBpbnN0YW5jZXNbdW5pcXVlSUQobm9kZSldXG4gICAgICAgICAgICByZXR1cm4gbm9kZVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvLyBzdHJhaWdodCBlczUgcHJvdG90eXBlcyAob3IgZW11bGF0ZWQgbWV0aG9kcylcblxuICAgIGZvckVhY2g6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBmb3JFYWNoKHRoaXMsIG1ldGhvZCwgY29udGV4dCk7XG4gICAgfSxcblxuICAgIG1hcDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIG1hcCh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH0sXG5cbiAgICBmaWx0ZXI6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBmaWx0ZXIodGhpcywgbWV0aG9kLCBjb250ZXh0KTtcbiAgICB9LFxuXG4gICAgZXZlcnk6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBldmVyeSh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH0sXG5cbiAgICBzb21lOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gc29tZSh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuYXJyYXk6ZXZlcnlcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGV2ZXJ5ID0gZnVuY3Rpb24oc2VsZiwgbWV0aG9kLCBjb250ZXh0KXtcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHNlbGYubGVuZ3RoID4+PiAwOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgaWYgKCFtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSkgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZXZlcnlcbiIsIi8qXG5hcnJheTpmaWx0ZXJcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGZpbHRlciA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIHJlc3VsdHMgPSBbXVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gc2VsZi5sZW5ndGggPj4+IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc2VsZltpXVxuICAgICAgICBpZiAobWV0aG9kLmNhbGwoY29udGV4dCwgdmFsdWUsIGksIHNlbGYpKSByZXN1bHRzLnB1c2godmFsdWUpXG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZmlsdGVyXG4iLCIvKlxuYXJyYXk6Zm9yRWFjaFxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgZm9yRWFjaCA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxmLmxlbmd0aCA+Pj4gMDsgaSA8IGw7IGkrKyl7XG4gICAgICAgIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSA9PT0gZmFsc2UpIGJyZWFrXG4gICAgfVxuICAgIHJldHVybiBzZWxmXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZm9yRWFjaFxuIiwiLypcbmFycmF5OmluZGV4T2ZcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGluZGV4T2YgPSBmdW5jdGlvbihzZWxmLCBpdGVtLCBmcm9tKXtcbiAgICBmb3IgKHZhciBsID0gc2VsZi5sZW5ndGggPj4+IDAsIGkgPSAoZnJvbSA8IDApID8gTWF0aC5tYXgoMCwgbCArIGZyb20pIDogZnJvbSB8fCAwOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgaWYgKHNlbGZbaV0gPT09IGl0ZW0pIHJldHVybiBpXG4gICAgfVxuICAgIHJldHVybiAtMVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGluZGV4T2ZcbiIsIi8qXG5hcnJheTptYXBcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIG1hcCA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIGxlbmd0aCA9IHNlbGYubGVuZ3RoID4+PiAwLCByZXN1bHRzID0gQXJyYXkobGVuZ3RoKVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGVuZ3RoOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgcmVzdWx0c1tpXSA9IG1ldGhvZC5jYWxsKGNvbnRleHQsIHNlbGZbaV0sIGksIHNlbGYpXG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzXG59XG5cbm1vZHVsZS5leHBvcnRzID0gbWFwXG4iLCIvKlxuYXJyYXk6c29tZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgc29tZSA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxmLmxlbmd0aCA+Pj4gMDsgaSA8IGw7IGkrKyl7XG4gICAgICAgIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSkgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG59XG5cbm1vZHVsZS5leHBvcnRzID0gc29tZVxuIiwiLypcbnByaW1lXG4gLSBwcm90b3R5cGFsIGluaGVyaXRhbmNlXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBoYXNPd24gPSByZXF1aXJlKFwiLi9vYmplY3QvaGFzT3duXCIpLFxuICAgIGZvckluICA9IHJlcXVpcmUoXCIuL29iamVjdC9mb3JJblwiKSxcbiAgICBtaXhJbiAgPSByZXF1aXJlKFwiLi9vYmplY3QvbWl4SW5cIiksXG4gICAgZmlsdGVyID0gcmVxdWlyZShcIi4vb2JqZWN0L2ZpbHRlclwiKSxcbiAgICBjcmVhdGUgPSByZXF1aXJlKFwiLi9vYmplY3QvY3JlYXRlXCIpLFxuICAgIHR5cGUgICA9IHJlcXVpcmUoXCIuL3R5cGVcIilcblxudmFyIGRlZmluZVByb3BlcnR5ICAgICAgICAgICA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSxcbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yXG5cbnRyeSB7XG4gICAgZGVmaW5lUHJvcGVydHkoe30sIFwiflwiLCB7fSlcbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioe30sIFwiflwiKVxufSBjYXRjaCAoZSl7XG4gICAgZGVmaW5lUHJvcGVydHkgPSBudWxsXG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gbnVsbFxufVxuXG52YXIgZGVmaW5lID0gZnVuY3Rpb24odmFsdWUsIGtleSwgZnJvbSl7XG4gICAgZGVmaW5lUHJvcGVydHkodGhpcywga2V5LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZnJvbSwga2V5KSB8fCB7XG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgIH0pXG59XG5cbnZhciBjb3B5ID0gZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgdGhpc1trZXldID0gdmFsdWVcbn1cblxudmFyIGltcGxlbWVudCA9IGZ1bmN0aW9uKHByb3RvKXtcbiAgICBmb3JJbihwcm90bywgZGVmaW5lUHJvcGVydHkgPyBkZWZpbmUgOiBjb3B5LCB0aGlzLnByb3RvdHlwZSlcbiAgICByZXR1cm4gdGhpc1xufVxuXG52YXIgdmVyYnMgPSAvXmNvbnN0cnVjdG9yfGluaGVyaXRzfG1peGluJC9cblxudmFyIHByaW1lID0gZnVuY3Rpb24ocHJvdG8pe1xuXG4gICAgaWYgKHR5cGUocHJvdG8pID09PSBcImZ1bmN0aW9uXCIpIHByb3RvID0ge2NvbnN0cnVjdG9yOiBwcm90b31cblxuICAgIHZhciBzdXBlcnByaW1lID0gcHJvdG8uaW5oZXJpdHNcblxuICAgIC8vIGlmIG91ciBuaWNlIHByb3RvIG9iamVjdCBoYXMgbm8gb3duIGNvbnN0cnVjdG9yIHByb3BlcnR5XG4gICAgLy8gdGhlbiB3ZSBwcm9jZWVkIHVzaW5nIGEgZ2hvc3RpbmcgY29uc3RydWN0b3IgdGhhdCBhbGwgaXQgZG9lcyBpc1xuICAgIC8vIGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yIGlmIGl0IGhhcyBhIHN1cGVycHJpbWUsIGVsc2UgYW4gZW1wdHkgY29uc3RydWN0b3JcbiAgICAvLyBwcm90by5jb25zdHJ1Y3RvciBiZWNvbWVzIHRoZSBlZmZlY3RpdmUgY29uc3RydWN0b3JcbiAgICB2YXIgY29uc3RydWN0b3IgPSAoaGFzT3duKHByb3RvLCBcImNvbnN0cnVjdG9yXCIpKSA/IHByb3RvLmNvbnN0cnVjdG9yIDogKHN1cGVycHJpbWUpID8gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHN1cGVycHJpbWUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0gOiBmdW5jdGlvbigpe31cblxuICAgIGlmIChzdXBlcnByaW1lKXtcblxuICAgICAgICBtaXhJbihjb25zdHJ1Y3Rvciwgc3VwZXJwcmltZSlcblxuICAgICAgICB2YXIgc3VwZXJwcm90byA9IHN1cGVycHJpbWUucHJvdG90eXBlXG4gICAgICAgIC8vIGluaGVyaXQgZnJvbSBzdXBlcnByaW1lXG4gICAgICAgIHZhciBjcHJvdG8gPSBjb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoc3VwZXJwcm90bylcblxuICAgICAgICAvLyBzZXR0aW5nIGNvbnN0cnVjdG9yLnBhcmVudCB0byBzdXBlcnByaW1lLnByb3RvdHlwZVxuICAgICAgICAvLyBiZWNhdXNlIGl0J3MgdGhlIHNob3J0ZXN0IHBvc3NpYmxlIGFic29sdXRlIHJlZmVyZW5jZVxuICAgICAgICBjb25zdHJ1Y3Rvci5wYXJlbnQgPSBzdXBlcnByb3RvXG4gICAgICAgIGNwcm90by5jb25zdHJ1Y3RvciA9IGNvbnN0cnVjdG9yXG4gICAgfVxuXG4gICAgaWYgKCFjb25zdHJ1Y3Rvci5pbXBsZW1lbnQpIGNvbnN0cnVjdG9yLmltcGxlbWVudCA9IGltcGxlbWVudFxuXG4gICAgdmFyIG1peGlucyA9IHByb3RvLm1peGluXG4gICAgaWYgKG1peGlucyl7XG4gICAgICAgIGlmICh0eXBlKG1peGlucykgIT09IFwiYXJyYXlcIikgbWl4aW5zID0gW21peGluc11cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtaXhpbnMubGVuZ3RoOyBpKyspIGNvbnN0cnVjdG9yLmltcGxlbWVudChjcmVhdGUobWl4aW5zW2ldLnByb3RvdHlwZSkpXG4gICAgfVxuXG4gICAgLy8gaW1wbGVtZW50IHByb3RvIGFuZCByZXR1cm4gY29uc3RydWN0b3JcbiAgICByZXR1cm4gY29uc3RydWN0b3IuaW1wbGVtZW50KGZpbHRlcihwcm90bywgZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgICAgIHJldHVybiAha2V5Lm1hdGNoKHZlcmJzKVxuICAgIH0pKVxuXG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJpbWVcbiIsIi8qXG5vYmplY3Q6Y3JlYXRlXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBjcmVhdGUgPSBmdW5jdGlvbihzZWxmKXtcbiAgICB2YXIgY29uc3RydWN0b3IgPSBmdW5jdGlvbigpe31cbiAgICBjb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBzZWxmXG4gICAgcmV0dXJuIG5ldyBjb25zdHJ1Y3RvclxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVxuIiwiLypcbm9iamVjdDpmaWx0ZXJcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGZvckluID0gcmVxdWlyZShcIi4vZm9ySW5cIilcblxudmFyIGZpbHRlciA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIHJlc3VsdHMgPSB7fVxuICAgIGZvckluKHNlbGYsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICBpZiAobWV0aG9kLmNhbGwoY29udGV4dCwgdmFsdWUsIGtleSwgc2VsZikpIHJlc3VsdHNba2V5XSA9IHZhbHVlXG4gICAgfSlcbiAgICByZXR1cm4gcmVzdWx0c1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZpbHRlclxuIiwiLypcbm9iamVjdDpmb3JJblxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgaGFzID0gcmVxdWlyZShcIi4vaGFzT3duXCIpXG5cbnZhciBmb3JJbiA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIga2V5IGluIHNlbGYpIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2tleV0sIGtleSwgc2VsZikgPT09IGZhbHNlKSBicmVha1xuICAgIHJldHVybiBzZWxmXG59XG5cbmlmICghKHt2YWx1ZU9mOiAwfSkucHJvcGVydHlJc0VudW1lcmFibGUoXCJ2YWx1ZU9mXCIpKXsgLy8gZml4IGZvciBzdHVwaWQgSUUgZW51bWVyYXRpb24gYnVnXG5cbiAgICB2YXIgYnVnZ3kgPSBcImNvbnN0cnVjdG9yLHRvU3RyaW5nLHZhbHVlT2YsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZ1wiLnNwbGl0KFwiLFwiKVxuICAgIHZhciBwcm90byA9IE9iamVjdC5wcm90b3R5cGVcblxuICAgIGZvckluID0gZnVuY3Rpb24oc2VsZiwgbWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHNlbGYpIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2tleV0sIGtleSwgc2VsZikgPT09IGZhbHNlKSByZXR1cm4gc2VsZlxuICAgICAgICBmb3IgKHZhciBpID0gMDsga2V5ID0gYnVnZ3lbaV07IGkrKyl7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmW2tleV1cbiAgICAgICAgICAgIGlmICgodmFsdWUgIT09IHByb3RvW2tleV0gfHwgaGFzKHNlbGYsIGtleSkpICYmIG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHNlbGYpID09PSBmYWxzZSkgYnJlYWtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZlxuICAgIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZvckluXG4iLCIvKlxub2JqZWN0OmZvck93blxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgZm9ySW4gID0gcmVxdWlyZShcIi4vZm9ySW5cIiksXG4gICAgaGFzT3duID0gcmVxdWlyZShcIi4vaGFzT3duXCIpXG5cbnZhciBmb3JPd24gPSBmdW5jdGlvbihzZWxmLCBtZXRob2QsIGNvbnRleHQpe1xuICAgIGZvckluKHNlbGYsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICBpZiAoaGFzT3duKHNlbGYsIGtleSkpIHJldHVybiBtZXRob2QuY2FsbChjb250ZXh0LCB2YWx1ZSwga2V5LCBzZWxmKVxuICAgIH0pXG4gICAgcmV0dXJuIHNlbGZcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmb3JPd25cbiIsIi8qXG5vYmplY3Q6aGFzT3duXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5oYXNPd25Qcm9wZXJ0eVxuXG52YXIgaGFzT3duID0gZnVuY3Rpb24oc2VsZiwga2V5KXtcbiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChzZWxmLCBrZXkpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gaGFzT3duXG4iLCIvKlxub2JqZWN0Om1peEluXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBmb3JPd24gPSByZXF1aXJlKFwiLi9mb3JPd25cIilcblxudmFyIGNvcHkgPSBmdW5jdGlvbih2YWx1ZSwga2V5KXtcbiAgICB0aGlzW2tleV0gPSB2YWx1ZVxufVxuXG52YXIgbWl4SW4gPSBmdW5jdGlvbihzZWxmKXtcbiAgICBmb3IgKHZhciBpID0gMSwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIGZvck93bihhcmd1bWVudHNbaV0sIGNvcHksIHNlbGYpXG4gICAgcmV0dXJuIHNlbGZcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBtaXhJblxuIiwiLypcbnN0cmluZzpjYW1lbGl6ZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgY2FtZWxpemUgPSBmdW5jdGlvbihzZWxmKXtcbiAgICByZXR1cm4gKHNlbGYgKyBcIlwiKS5yZXBsYWNlKC8tXFxEL2csIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuIG1hdGNoLmNoYXJBdCgxKS50b1VwcGVyQ2FzZSgpXG4gICAgfSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjYW1lbGl6ZVxuIiwiLypcbnN0cmluZzpjYXBpdGFsaXplXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBjYXBpdGFsaXplID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIChzZWxmICsgXCJcIikucmVwbGFjZSgvXFxiW2Etel0vZywgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICByZXR1cm4gbWF0Y2gudG9VcHBlckNhc2UoKVxuICAgIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0gY2FwaXRhbGl6ZVxuIiwiLypcbnN0cmluZzpjbGVhblxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgdHJpbSA9IHJlcXVpcmUoXCIuL3RyaW1cIilcblxudmFyIGNsZWFuID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIHRyaW0oKHNlbGYgKyBcIlwiKS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjbGVhblxuIiwiLypcbnN0cmluZzpoeXBoZW5hdGVcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGh5cGhlbmF0ZSA9IGZ1bmN0aW9uKHNlbGYpe1xuICAgIHJldHVybiAoc2VsZiArIFwiXCIpLnJlcGxhY2UoL1tBLVpdL2csIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuICctJyArIG1hdGNoLnRvTG93ZXJDYXNlKClcbiAgICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGh5cGhlbmF0ZVxuIiwiLypcbnN0cmluZzp0cmltXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciB0cmltID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIChzZWxmICsgXCJcIikucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIilcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB0cmltXG4iLCIvKlxudHlwZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHR5cGVzID0gL251bWJlcnxvYmplY3R8YXJyYXl8c3RyaW5nfGZ1bmN0aW9ufGRhdGV8cmVnZXhwfGJvb2xlYW4vXG5cbnZhciB0eXBlID0gZnVuY3Rpb24ob2JqZWN0KXtcbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiBcIm51bGxcIlxuICAgIHZhciBzdHJpbmcgPSB0b1N0cmluZy5jYWxsKG9iamVjdCkuc2xpY2UoOCwgLTEpLnRvTG93ZXJDYXNlKClcbiAgICBpZiAoc3RyaW5nID09PSBcIm51bWJlclwiICYmIGlzTmFOKG9iamVjdCkpIHJldHVybiBcIm51bGxcIlxuICAgIGlmICh0eXBlcy50ZXN0KHN0cmluZykpIHJldHVybiBzdHJpbmdcbiAgICByZXR1cm4gXCJvYmplY3RcIlxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHR5cGVcbiIsIlxuXG4gICAgLyoqXG4gICAgICogQXBwZW5kcyBhbiBhcnJheSB0byB0aGUgZW5kIG9mIGFub3RoZXIuXG4gICAgICogVGhlIGZpcnN0IGFycmF5IHdpbGwgYmUgbW9kaWZpZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXBwZW5kKGFycjEsIGFycjIpIHtcbiAgICAgICAgaWYgKGFycjIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGFycjE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGFkID0gYXJyMS5sZW5ndGgsXG4gICAgICAgICAgICBpID0gLTEsXG4gICAgICAgICAgICBsZW4gPSBhcnIyLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgYXJyMVtwYWQgKyBpXSA9IGFycjJbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycjE7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gYXBwZW5kO1xuXG4iLCJ2YXIgaW5kZXhPZiA9IHJlcXVpcmUoJy4vaW5kZXhPZicpO1xuXG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGl0ZW1zIG9mIGFub3RoZXIuXG4gICAgICogRG9lcyBub3QgYWxsb3cgZHVwbGljYXRlcyBhbmQgaXMgY2FzZSBhbmQgdHlwZSBzZW5zaXRpdmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29tYmluZShhcnIxLCBhcnIyKSB7XG4gICAgICAgIGlmIChhcnIyID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBhcnIxO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuID0gYXJyMi5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIGlmIChpbmRleE9mKGFycjEsIGFycjJbaV0pID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGFycjEucHVzaChhcnIyW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnIxO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbWJpbmU7XG5cbiIsInZhciBpbmRleE9mID0gcmVxdWlyZSgnLi9pbmRleE9mJyk7XG5cbiAgICAvKipcbiAgICAgKiBJZiBhcnJheSBjb250YWlucyB2YWx1ZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udGFpbnMoYXJyLCB2YWwpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4T2YoYXJyLCB2YWwpICE9PSAtMTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBjb250YWlucztcblxuIiwidmFyIHVuaXF1ZSA9IHJlcXVpcmUoJy4vdW5pcXVlJyk7XG52YXIgZmlsdGVyID0gcmVxdWlyZSgnLi9maWx0ZXInKTtcbnZhciBzb21lID0gcmVxdWlyZSgnLi9zb21lJyk7XG52YXIgY29udGFpbnMgPSByZXF1aXJlKCcuL2NvbnRhaW5zJyk7XG52YXIgc2xpY2UgPSByZXF1aXJlKCcuL3NsaWNlJyk7XG5cblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIG5ldyBBcnJheSB3aXRoIGVsZW1lbnRzIHRoYXQgYXJlbid0IHByZXNlbnQgaW4gdGhlIG90aGVyIEFycmF5cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkaWZmZXJlbmNlKGFycikge1xuICAgICAgICB2YXIgYXJycyA9IHNsaWNlKGFyZ3VtZW50cywgMSksXG4gICAgICAgICAgICByZXN1bHQgPSBmaWx0ZXIodW5pcXVlKGFyciksIGZ1bmN0aW9uKG5lZWRsZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFzb21lKGFycnMsIGZ1bmN0aW9uKGhheXN0YWNrKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zKGhheXN0YWNrLCBuZWVkbGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkaWZmZXJlbmNlO1xuXG5cbiIsInZhciBpcyA9IHJlcXVpcmUoJy4uL2xhbmcvaXMnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy9pc0FycmF5Jyk7XG52YXIgZXZlcnkgPSByZXF1aXJlKCcuL2V2ZXJ5Jyk7XG5cbiAgICAvKipcbiAgICAgKiBDb21wYXJlcyBpZiBib3RoIGFycmF5cyBoYXZlIHRoZSBzYW1lIGVsZW1lbnRzXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXF1YWxzKGEsIGIsIGNhbGxiYWNrKXtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBpcztcblxuICAgICAgICBpZiAoIWlzQXJyYXkoYSkgfHwgIWlzQXJyYXkoYikpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBldmVyeShhLCBtYWtlQ29tcGFyZShjYWxsYmFjayksIGIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VDb21wYXJlKGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGkgaW4gdGhpcyAmJiBjYWxsYmFjayh2YWx1ZSwgdGhpc1tpXSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBlcXVhbHM7XG5cblxuIiwidmFyIGZpbmRJbmRleCA9IHJlcXVpcmUoJy4vZmluZEluZGV4Jyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGZpcnN0IGl0ZW0gdGhhdCBtYXRjaGVzIGNyaXRlcmlhXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmluZChhcnIsIGl0ZXJhdG9yLCB0aGlzT2JqKXtcbiAgICAgICAgdmFyIGlkeCA9IGZpbmRJbmRleChhcnIsIGl0ZXJhdG9yLCB0aGlzT2JqKTtcbiAgICAgICAgcmV0dXJuIGlkeCA+PSAwPyBhcnJbaWR4XSA6IHZvaWQoMCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaW5kO1xuXG5cbiIsInZhciBtYWtlSXRlcmF0b3IgPSByZXF1aXJlKCcuLi9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfJyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgaXRlbSB0aGF0IG1hdGNoZXMgY3JpdGVyaWFcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaW5kSW5kZXgoYXJyLCBpdGVyYXRvciwgdGhpc09iail7XG4gICAgICAgIGl0ZXJhdG9yID0gbWFrZUl0ZXJhdG9yKGl0ZXJhdG9yLCB0aGlzT2JqKTtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xLCBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoaXRlcmF0b3IoYXJyW2ldLCBpLCBhcnIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaW5kSW5kZXg7XG5cbiIsInZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy9pc0FycmF5Jyk7XG52YXIgYXBwZW5kID0gcmVxdWlyZSgnLi9hcHBlbmQnKTtcblxuICAgIC8qXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGZsYXR0ZW4gdG8gYSBkZXN0aW5hdGlvbiBhcnJheS5cbiAgICAgKiBVc2VkIHRvIHJlbW92ZSB0aGUgbmVlZCB0byBjcmVhdGUgaW50ZXJtZWRpYXRlIGFycmF5cyB3aGlsZSBmbGF0dGVuaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXR0ZW5UbyhhcnIsIHJlc3VsdCwgbGV2ZWwpIHtcbiAgICAgICAgaWYgKGxldmVsID09PSAwKSB7XG4gICAgICAgICAgICBhcHBlbmQocmVzdWx0LCBhcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB2YWx1ZSxcbiAgICAgICAgICAgIGkgPSAtMSxcbiAgICAgICAgICAgIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gYXJyW2ldO1xuICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgZmxhdHRlblRvKHZhbHVlLCByZXN1bHQsIGxldmVsIC0gMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW5zIGFuIGFycmF5LlxuICAgICAqIEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgYWxsIHRoZSBlbGVtZW50cyBpcyByZXR1cm5lZC5cbiAgICAgKiBJZiBsZXZlbCBpcyBzcGVjaWZpZWQsIGl0IHdpbGwgb25seSBmbGF0dGVuIHVwIHRvIHRoYXQgbGV2ZWwuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmxhdHRlbihhcnIsIGxldmVsKSB7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV2ZWwgPSBsZXZlbCA9PSBudWxsID8gLTEgOiBsZXZlbDtcbiAgICAgICAgcmV0dXJuIGZsYXR0ZW5UbyhhcnIsIFtdLCBsZXZlbCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmbGF0dGVuO1xuXG5cblxuIiwidmFyIGRpZmZlcmVuY2UgPSByZXF1aXJlKCcuL2RpZmZlcmVuY2UnKTtcbnZhciBzbGljZSA9IHJlcXVpcmUoJy4vc2xpY2UnKTtcblxuICAgIC8qKlxuICAgICAqIEluc2VydCBpdGVtIGludG8gYXJyYXkgaWYgbm90IGFscmVhZHkgcHJlc2VudC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbnNlcnQoYXJyLCByZXN0X2l0ZW1zKSB7XG4gICAgICAgIHZhciBkaWZmID0gZGlmZmVyZW5jZShzbGljZShhcmd1bWVudHMsIDEpLCBhcnIpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGgpIHtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGFyciwgZGlmZik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFyci5sZW5ndGg7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaW5zZXJ0O1xuXG4iLCJ2YXIgdW5pcXVlID0gcmVxdWlyZSgnLi91bmlxdWUnKTtcbnZhciBmaWx0ZXIgPSByZXF1aXJlKCcuL2ZpbHRlcicpO1xudmFyIGV2ZXJ5ID0gcmVxdWlyZSgnLi9ldmVyeScpO1xudmFyIGNvbnRhaW5zID0gcmVxdWlyZSgnLi9jb250YWlucycpO1xudmFyIHNsaWNlID0gcmVxdWlyZSgnLi9zbGljZScpO1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYSBuZXcgQXJyYXkgd2l0aCBlbGVtZW50cyBjb21tb24gdG8gYWxsIEFycmF5cy5cbiAgICAgKiAtIGJhc2VkIG9uIHVuZGVyc2NvcmUuanMgaW1wbGVtZW50YXRpb25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbnRlcnNlY3Rpb24oYXJyKSB7XG4gICAgICAgIHZhciBhcnJzID0gc2xpY2UoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICAgIHJlc3VsdCA9IGZpbHRlcih1bmlxdWUoYXJyKSwgZnVuY3Rpb24obmVlZGxlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZlcnkoYXJycywgZnVuY3Rpb24oaGF5c3RhY2spe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGFpbnMoaGF5c3RhY2ssIG5lZWRsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGludGVyc2VjdGlvbjtcblxuXG4iLCJ2YXIgc2xpY2UgPSByZXF1aXJlKCcuL3NsaWNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBDYWxsIGBtZXRob2ROYW1lYCBvbiBlYWNoIGl0ZW0gb2YgdGhlIGFycmF5IHBhc3NpbmcgY3VzdG9tIGFyZ3VtZW50cyBpZlxuICAgICAqIG5lZWRlZC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbnZva2UoYXJyLCBtZXRob2ROYW1lLCB2YXJfYXJncyl7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhcmdzID0gc2xpY2UoYXJndW1lbnRzLCAyKTtcbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuID0gYXJyLmxlbmd0aCwgdmFsdWU7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gYXJyW2ldO1xuICAgICAgICAgICAgdmFsdWVbbWV0aG9kTmFtZV0uYXBwbHkodmFsdWUsIGFyZ3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFycjtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGludm9rZTtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGxhc3QgZWxlbWVudCBvZiBhcnJheS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsYXN0KGFycil7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCB8fCBhcnIubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnJbYXJyLmxlbmd0aCAtIDFdO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gbGFzdDtcblxuXG4iLCJ2YXIgaW5kZXhPZiA9IHJlcXVpcmUoJy4vaW5kZXhPZicpO1xuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGFsbCBpbnN0YW5jZXMgb2YgYW4gaXRlbSBmcm9tIGFycmF5LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZUFsbChhcnIsIGl0ZW0pe1xuICAgICAgICB2YXIgaWR4ID0gaW5kZXhPZihhcnIsIGl0ZW0pO1xuICAgICAgICB3aGlsZSAoaWR4ICE9PSAtMSkge1xuICAgICAgICAgICAgYXJyLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgaWR4ID0gaW5kZXhPZihhcnIsIGl0ZW0sIGlkeCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlbW92ZUFsbDtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgc2xpY2Ugb2Ygc291cmNlIGFycmF5IG9yIGFycmF5LWxpa2Ugb2JqZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2xpY2UoYXJyLCBzdGFydCwgZW5kKXtcbiAgICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XG5cbiAgICAgICAgaWYgKHN0YXJ0ID09IG51bGwpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChzdGFydCA8IDApIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgobGVuICsgc3RhcnQsIDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhcnQgPSBNYXRoLm1pbihzdGFydCwgbGVuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbmQgPT0gbnVsbCkge1xuICAgICAgICAgICAgZW5kID0gbGVuO1xuICAgICAgICB9IGVsc2UgaWYgKGVuZCA8IDApIHtcbiAgICAgICAgICAgIGVuZCA9IE1hdGgubWF4KGxlbiArIGVuZCwgMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbmQgPSBNYXRoLm1pbihlbmQsIGxlbik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgIHdoaWxlIChzdGFydCA8IGVuZCkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goYXJyW3N0YXJ0KytdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBzbGljZTtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIFNwbGl0IGFycmF5IGludG8gYSBmaXhlZCBudW1iZXIgb2Ygc2VnbWVudHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3BsaXQoYXJyYXksIHNlZ21lbnRzKSB7XG4gICAgICAgIHNlZ21lbnRzID0gc2VnbWVudHMgfHwgMjtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgaWYgKGFycmF5ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG1pbkxlbmd0aCA9IE1hdGguZmxvb3IoYXJyYXkubGVuZ3RoIC8gc2VnbWVudHMpLFxuICAgICAgICAgICAgcmVtYWluZGVyID0gYXJyYXkubGVuZ3RoICUgc2VnbWVudHMsXG4gICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgIGxlbiA9IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICAgIHNlZ21lbnRJbmRleCA9IDAsXG4gICAgICAgICAgICBzZWdtZW50TGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlIChpIDwgbGVuKSB7XG4gICAgICAgICAgICBzZWdtZW50TGVuZ3RoID0gbWluTGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHNlZ21lbnRJbmRleCA8IHJlbWFpbmRlcikge1xuICAgICAgICAgICAgICAgIHNlZ21lbnRMZW5ndGgrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGFycmF5LnNsaWNlKGksIGkgKyBzZWdtZW50TGVuZ3RoKSk7XG5cbiAgICAgICAgICAgIHNlZ21lbnRJbmRleCsrO1xuICAgICAgICAgICAgaSArPSBzZWdtZW50TGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gc3BsaXQ7XG5cbiIsInZhciBmaWx0ZXIgPSByZXF1aXJlKCcuL2ZpbHRlcicpO1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7YXJyYXl9IEFycmF5IG9mIHVuaXF1ZSBpdGVtc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaXF1ZShhcnIsIGNvbXBhcmUpe1xuICAgICAgICBjb21wYXJlID0gY29tcGFyZSB8fCBpc0VxdWFsO1xuICAgICAgICByZXR1cm4gZmlsdGVyKGFyciwgZnVuY3Rpb24oaXRlbSwgaSwgYXJyKXtcbiAgICAgICAgICAgIHZhciBuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgICAgIHdoaWxlICgrK2kgPCBuKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBjb21wYXJlKGl0ZW0sIGFycltpXSkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNFcXVhbChhLCBiKXtcbiAgICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB1bmlxdWU7XG5cblxuIiwidmFyIG1ha2UgPSByZXF1aXJlKCcuL21ha2VfJyk7XG52YXIgYXJyQ29udGFpbnMgPSByZXF1aXJlKCcuLi9hcnJheS9jb250YWlucycpO1xudmFyIG9iakNvbnRhaW5zID0gcmVxdWlyZSgnLi4vb2JqZWN0L2NvbnRhaW5zJyk7XG5cbiAgICAvKipcbiAgICAgKi9cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1ha2UoYXJyQ29udGFpbnMsIG9iakNvbnRhaW5zKTtcblxuXG4iLCJ2YXIgbWFrZSA9IHJlcXVpcmUoJy4vbWFrZV8nKTtcbnZhciBhcnJGaW5kID0gcmVxdWlyZSgnLi4vYXJyYXkvZmluZCcpO1xudmFyIG9iakZpbmQgPSByZXF1aXJlKCcuLi9vYmplY3QvZmluZCcpO1xuXG4gICAgLyoqXG4gICAgICogRmluZCB2YWx1ZSB0aGF0IHJldHVybnMgdHJ1ZSBvbiBpdGVyYXRvciBjaGVjay5cbiAgICAgKi9cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1ha2UoYXJyRmluZCwgb2JqRmluZCk7XG5cblxuIiwidmFyIG1ha2UgPSByZXF1aXJlKCcuL21ha2VfJyk7XG52YXIgYXJyRm9yRWFjaCA9IHJlcXVpcmUoJy4uL2FycmF5L2ZvckVhY2gnKTtcbnZhciBvYmpGb3JFYWNoID0gcmVxdWlyZSgnLi4vb2JqZWN0L2Zvck93bicpO1xuXG4gICAgLyoqXG4gICAgICovXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtYWtlKGFyckZvckVhY2gsIG9iakZvckVhY2gpO1xuXG5cbiIsInZhciBzbGljZSA9IHJlcXVpcmUoJy4uL2FycmF5L3NsaWNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBpbnRlcm5hbCBtZXRob2QgdXNlZCB0byBjcmVhdGUgb3RoZXIgY29sbGVjdGlvbiBtb2R1bGVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VDb2xsZWN0aW9uTWV0aG9kKGFyck1ldGhvZCwgb2JqTWV0aG9kLCBkZWZhdWx0UmV0dXJuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBzbGljZShhcmd1bWVudHMpO1xuICAgICAgICAgICAgaWYgKGFyZ3NbMF0gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXJyYXktbGlrZSBpcyB0cmVhdGVkIGFzIGFycmF5XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBhcmdzWzBdLmxlbmd0aCA9PT0gJ251bWJlcicpPyBhcnJNZXRob2QuYXBwbHkobnVsbCwgYXJncykgOiBvYmpNZXRob2QuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtYWtlQ29sbGVjdGlvbk1ldGhvZDtcblxuXG4iLCJ2YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNBcnJheScpO1xudmFyIG9ialNpemUgPSByZXF1aXJlKCcuLi9vYmplY3Qvc2l6ZScpO1xuXG4gICAgLyoqXG4gICAgICogR2V0IGNvbGxlY3Rpb24gc2l6ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpemUobGlzdCkge1xuICAgICAgICBpZiAoIWxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0FycmF5KGxpc3QpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9ialNpemUobGlzdCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBzaXplO1xuXG5cbiIsInZhciBzbGljZSA9IHJlcXVpcmUoJy4uL2FycmF5L3NsaWNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHdpbGwgZXhlY3V0ZSBpbiB0aGUgZ2l2ZW4gY29udGV4dCwgb3B0aW9uYWxseSBhZGRpbmcgYW55IGFkZGl0aW9uYWwgc3VwcGxpZWQgcGFyYW1ldGVycyB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhcmd1bWVudHMgY29sbGVjdGlvbi5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiAgRnVuY3Rpb24uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbnRleHQgICBFeGVjdXRpb24gY29udGV4dC5cbiAgICAgKiBAcGFyYW0ge3Jlc3R9IGFyZ3MgICAgQXJndW1lbnRzICgwLi4ubiBhcmd1bWVudHMpLlxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBXcmFwcGVkIEZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJpbmQoZm4sIGNvbnRleHQsIGFyZ3Mpe1xuICAgICAgICB2YXIgYXJnc0FyciA9IHNsaWNlKGFyZ3VtZW50cywgMik7IC8vY3VycmllZCBhcmdzXG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KGNvbnRleHQsIGFyZ3NBcnIuY29uY2F0KHNsaWNlKGFyZ3VtZW50cykpKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGJpbmQ7XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBEZWJvdW5jZSBjYWxsYmFjayBleGVjdXRpb25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWJvdW5jZShmbiwgdGhyZXNob2xkLCBpc0FzYXApe1xuICAgICAgICB2YXIgdGltZW91dCwgcmVzdWx0O1xuICAgICAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKXtcbiAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLCBjb250ZXh0ID0gdGhpcztcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGF5ZWQoKXtcbiAgICAgICAgICAgICAgICBpZiAoISBpc0FzYXApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZm4uYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQXNhcCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoZGVsYXllZCwgdGhyZXNob2xkKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgZGVib3VuY2VkLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkZWJvdW5jZTtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgZXhlY3V0ZSBhIGxpc3Qgb2YgZnVuY3Rpb25zIGluIHNlcXVlbmNlXG4gICAgICogcGFzc2luZyB0aGUgc2FtZSBhcmd1bWVudHMgdG8gZWFjaCBvbmUuICh1c2VmdWwgZm9yIGJhdGNoIHByb2Nlc3NpbmdcbiAgICAgKiBpdGVtcyBkdXJpbmcgYSBmb3JFYWNoIGxvb3ApXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2VyaWVzKCl7XG4gICAgICAgIHZhciBmbnMgPSBhcmd1bWVudHM7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgIG4gPSBmbnMubGVuZ3RoO1xuICAgICAgICAgICAgd2hpbGUgKGkgPCBuKSB7XG4gICAgICAgICAgICAgICAgZm5zW2ldLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaSArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc2VyaWVzO1xuXG5cbiIsIlxuXG4gICAgLy8gUmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgY29udGV4dCAod29ya3Mgb24gRVMzIGFuZCBFUzUtc3RyaWN0IG1vZGUpXG4gICAgLy9qc2hpbnQgLVcwNjEsIC1XMDY0XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXG5cbiIsInZhciBraW5kT2YgPSByZXF1aXJlKCcuL2tpbmRPZicpO1xudmFyIGlzUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuL2lzUGxhaW5PYmplY3QnKTtcbnZhciBtaXhJbiA9IHJlcXVpcmUoJy4uL29iamVjdC9taXhJbicpO1xuXG4gICAgLyoqXG4gICAgICogQ2xvbmUgbmF0aXZlIHR5cGVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb25lKHZhbCl7XG4gICAgICAgIHN3aXRjaCAoa2luZE9mKHZhbCkpIHtcbiAgICAgICAgICAgIGNhc2UgJ09iamVjdCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lT2JqZWN0KHZhbCk7XG4gICAgICAgICAgICBjYXNlICdBcnJheSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lQXJyYXkodmFsKTtcbiAgICAgICAgICAgIGNhc2UgJ1JlZ0V4cCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lUmVnRXhwKHZhbCk7XG4gICAgICAgICAgICBjYXNlICdEYXRlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVEYXRlKHZhbCk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZU9iamVjdChzb3VyY2UpIHtcbiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3Qoc291cmNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIG1peEluKHt9LCBzb3VyY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHIpIHtcbiAgICAgICAgdmFyIGZsYWdzID0gJyc7XG4gICAgICAgIGZsYWdzICs9IHIubXVsdGlsaW5lID8gJ20nIDogJyc7XG4gICAgICAgIGZsYWdzICs9IHIuZ2xvYmFsID8gJ2cnIDogJyc7XG4gICAgICAgIGZsYWdzICs9IHIuaWdub3JlQ2FzZSA/ICdpJyA6ICcnO1xuICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChyLnNvdXJjZSwgZmxhZ3MpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lRGF0ZShkYXRlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSgrZGF0ZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVBcnJheShhcnIpIHtcbiAgICAgICAgcmV0dXJuIGFyci5zbGljZSgpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gY2xvbmU7XG5cblxuIiwidmFyIGNsb25lID0gcmVxdWlyZSgnLi9jbG9uZScpO1xudmFyIGZvck93biA9IHJlcXVpcmUoJy4uL29iamVjdC9mb3JPd24nKTtcbnZhciBraW5kT2YgPSByZXF1aXJlKCcuL2tpbmRPZicpO1xudmFyIGlzUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuL2lzUGxhaW5PYmplY3QnKTtcblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGNsb25lIG5hdGl2ZSB0eXBlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWVwQ2xvbmUodmFsLCBpbnN0YW5jZUNsb25lKSB7XG4gICAgICAgIHN3aXRjaCAoIGtpbmRPZih2YWwpICkge1xuICAgICAgICAgICAgY2FzZSAnT2JqZWN0JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVPYmplY3QodmFsLCBpbnN0YW5jZUNsb25lKTtcbiAgICAgICAgICAgIGNhc2UgJ0FycmF5JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVBcnJheSh2YWwsIGluc3RhbmNlQ2xvbmUpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmUodmFsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lT2JqZWN0KHNvdXJjZSwgaW5zdGFuY2VDbG9uZSkge1xuICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChzb3VyY2UpKSB7XG4gICAgICAgICAgICB2YXIgb3V0ID0ge307XG4gICAgICAgICAgICBmb3JPd24oc291cmNlLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IGRlZXBDbG9uZSh2YWwsIGluc3RhbmNlQ2xvbmUpO1xuICAgICAgICAgICAgfSwgb3V0KTtcbiAgICAgICAgICAgIHJldHVybiBvdXQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5zdGFuY2VDbG9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlQ2xvbmUoc291cmNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZUFycmF5KGFyciwgaW5zdGFuY2VDbG9uZSkge1xuICAgICAgICB2YXIgb3V0ID0gW10sXG4gICAgICAgICAgICBpID0gLTEsXG4gICAgICAgICAgICBuID0gYXJyLmxlbmd0aCxcbiAgICAgICAgICAgIHZhbDtcbiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHtcbiAgICAgICAgICAgIG91dFtpXSA9IGRlZXBDbG9uZShhcnJbaV0sIGluc3RhbmNlQ2xvbmUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkZWVwQ2xvbmU7XG5cblxuXG4iLCJ2YXIgaXMgPSByZXF1aXJlKCcuL2lzJyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL2lzT2JqZWN0Jyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4vaXNBcnJheScpO1xudmFyIG9iakVxdWFscyA9IHJlcXVpcmUoJy4uL29iamVjdC9lcXVhbHMnKTtcbnZhciBhcnJFcXVhbHMgPSByZXF1aXJlKCcuLi9hcnJheS9lcXVhbHMnKTtcblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGNoZWNrcyBmb3Igc2FtZSBwcm9wZXJ0aWVzIGFuZCB2YWx1ZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVlcEVxdWFscyhhLCBiLCBjYWxsYmFjayl7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgaXM7XG5cbiAgICAgICAgdmFyIGJvdGhPYmplY3RzID0gaXNPYmplY3QoYSkgJiYgaXNPYmplY3QoYik7XG4gICAgICAgIHZhciBib3RoQXJyYXlzID0gIWJvdGhPYmplY3RzICYmIGlzQXJyYXkoYSkgJiYgaXNBcnJheShiKTtcblxuICAgICAgICBpZiAoIWJvdGhPYmplY3RzICYmICFib3RoQXJyYXlzKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soYSwgYik7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb21wYXJlKGEsIGIpe1xuICAgICAgICAgICAgcmV0dXJuIGRlZXBFcXVhbHMoYSwgYiwgY2FsbGJhY2spO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG1ldGhvZCA9IGJvdGhPYmplY3RzID8gb2JqRXF1YWxzIDogYXJyRXF1YWxzO1xuICAgICAgICByZXR1cm4gbWV0aG9kKGEsIGIsIGNvbXBhcmUpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZGVlcEVxdWFscztcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGJvdGggYXJndW1lbnRzIGFyZSBlZ2FsLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzKHgsIHkpe1xuICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbiBib3Jyb3dlZCBmcm9tIGhhcm1vbnk6ZWdhbCBzcGVjXG4gICAgICAgIGlmICh4ID09PSB5KSB7XG4gICAgICAgICAgLy8gMCA9PT0gLTAsIGJ1dCB0aGV5IGFyZSBub3QgaWRlbnRpY2FsXG4gICAgICAgICAgcmV0dXJuIHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTmFOICE9PSBOYU4sIGJ1dCB0aGV5IGFyZSBpZGVudGljYWwuXG4gICAgICAgIC8vIE5hTnMgYXJlIHRoZSBvbmx5IG5vbi1yZWZsZXhpdmUgdmFsdWUsIGkuZS4sIGlmIHggIT09IHgsXG4gICAgICAgIC8vIHRoZW4geCBpcyBhIE5hTi5cbiAgICAgICAgLy8gaXNOYU4gaXMgYnJva2VuOiBpdCBjb252ZXJ0cyBpdHMgYXJndW1lbnQgdG8gbnVtYmVyLCBzb1xuICAgICAgICAvLyBpc05hTihcImZvb1wiKSA9PiB0cnVlXG4gICAgICAgIHJldHVybiB4ICE9PSB4ICYmIHkgIT09IHk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpcztcblxuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0Jvb2xlYW4odmFsKSB7XG4gICAgICAgIHJldHVybiBpc0tpbmQodmFsLCAnQm9vbGVhbicpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzQm9vbGVhbjtcblxuIiwidmFyIGlzS2luZCA9IHJlcXVpcmUoJy4vaXNLaW5kJyk7XG4gICAgLyoqXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNOdW1iZXIodmFsKSB7XG4gICAgICAgIHJldHVybiBpc0tpbmQodmFsLCAnTnVtYmVyJyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNOdW1iZXI7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSB2YWx1ZSBpcyBjcmVhdGVkIGJ5IHRoZSBgT2JqZWN0YCBjb25zdHJ1Y3Rvci5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAoISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmXG4gICAgICAgICAgICB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzUGxhaW5PYmplY3Q7XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdGhlIG9iamVjdCBpcyBhIHByaW1pdGl2ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzUHJpbWl0aXZlKHZhbHVlKSB7XG4gICAgICAgIC8vIFVzaW5nIHN3aXRjaCBmYWxsdGhyb3VnaCBiZWNhdXNlIGl0J3Mgc2ltcGxlIHRvIHJlYWQgYW5kIGlzXG4gICAgICAgIC8vIGdlbmVyYWxseSBmYXN0OiBodHRwOi8vanNwZXJmLmNvbS90ZXN0aW5nLXZhbHVlLWlzLXByaW1pdGl2ZS81XG4gICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7XG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGw7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc1ByaW1pdGl2ZTtcblxuXG4iLCJ2YXIga2luZE9mID0gcmVxdWlyZSgnLi9raW5kT2YnKTtcbnZhciBHTE9CQUwgPSByZXF1aXJlKCcuL0dMT0JBTCcpO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydCBhcnJheS1saWtlIG9iamVjdCBpbnRvIGFycmF5XG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9BcnJheSh2YWwpe1xuICAgICAgICB2YXIgcmV0ID0gW10sXG4gICAgICAgICAgICBraW5kID0ga2luZE9mKHZhbCksXG4gICAgICAgICAgICBuO1xuXG4gICAgICAgIGlmICh2YWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKCB2YWwubGVuZ3RoID09IG51bGwgfHwga2luZCA9PT0gJ1N0cmluZycgfHwga2luZCA9PT0gJ0Z1bmN0aW9uJyB8fCBraW5kID09PSAnUmVnRXhwJyB8fCB2YWwgPT09IEdMT0JBTCApIHtcbiAgICAgICAgICAgICAgICAvL3N0cmluZywgcmVnZXhwLCBmdW5jdGlvbiBoYXZlIC5sZW5ndGggYnV0IHVzZXIgcHJvYmFibHkganVzdCB3YW50XG4gICAgICAgICAgICAgICAgLy90byB3cmFwIHZhbHVlIGludG8gYW4gYXJyYXkuLlxuICAgICAgICAgICAgICAgIHJldFtyZXQubGVuZ3RoXSA9IHZhbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy93aW5kb3cgcmV0dXJucyB0cnVlIG9uIGlzT2JqZWN0IGluIElFNyBhbmQgbWF5IGhhdmUgbGVuZ3RoXG4gICAgICAgICAgICAgICAgLy9wcm9wZXJ0eS4gYHR5cGVvZiBOb2RlTGlzdGAgcmV0dXJucyBgZnVuY3Rpb25gIG9uIFNhZmFyaSBzb1xuICAgICAgICAgICAgICAgIC8vd2UgY2FuJ3QgdXNlIGl0ICgjNTgpXG4gICAgICAgICAgICAgICAgbiA9IHZhbC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgd2hpbGUgKG4tLSkge1xuICAgICAgICAgICAgICAgICAgICByZXRbbl0gPSB2YWxbbl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gdG9BcnJheTtcblxuIiwidmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuL2lzQXJyYXknKTtcblxuICAgIC8qKlxuICAgICAqIGNvdmVydCB2YWx1ZSBpbnRvIG51bWJlciBpZiBudW1lcmljXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9OdW1iZXIodmFsKXtcbiAgICAgICAgLy8gbnVtYmVyaWMgdmFsdWVzIHNob3VsZCBjb21lIGZpcnN0IGJlY2F1c2Ugb2YgLTBcbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSByZXR1cm4gdmFsO1xuICAgICAgICAvLyB3ZSB3YW50IGFsbCBmYWxzeSB2YWx1ZXMgKGJlc2lkZXMgLTApIHRvIHJldHVybiB6ZXJvIHRvIGF2b2lkXG4gICAgICAgIC8vIGhlYWRhY2hlc1xuICAgICAgICBpZiAoIXZhbCkgcmV0dXJuIDA7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgcmV0dXJuIHBhcnNlRmxvYXQodmFsKTtcbiAgICAgICAgLy8gYXJyYXlzIGFyZSBlZGdlIGNhc2VzLiBgTnVtYmVyKFs0XSkgPT09IDRgXG4gICAgICAgIGlmIChpc0FycmF5KHZhbCkpIHJldHVybiBOYU47XG4gICAgICAgIHJldHVybiBOdW1iZXIodmFsKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHRvTnVtYmVyO1xuXG5cbiIsIlxuICAgIC8qKlxuICAgICAqIENsYW1wcyB2YWx1ZSBpbnNpZGUgcmFuZ2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xhbXAodmFsLCBtaW4sIG1heCl7XG4gICAgICAgIHJldHVybiB2YWwgPCBtaW4/IG1pbiA6ICh2YWwgPiBtYXg/IG1heCA6IHZhbCk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gY2xhbXA7XG5cbiIsIlxuICAgIC8qKlxuICAgICogTGluZWFyIGludGVycG9sYXRpb24uXG4gICAgKiBJTVBPUlRBTlQ6d2lsbCByZXR1cm4gYEluZmluaXR5YCBpZiBudW1iZXJzIG92ZXJmbG93IE51bWJlci5NQVhfVkFMVUVcbiAgICAqL1xuICAgIGZ1bmN0aW9uIGxlcnAocmF0aW8sIHN0YXJ0LCBlbmQpe1xuICAgICAgICByZXR1cm4gc3RhcnQgKyAoZW5kIC0gc3RhcnQpICogcmF0aW87XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBsZXJwO1xuXG4iLCJ2YXIgbGVycCA9IHJlcXVpcmUoJy4vbGVycCcpO1xudmFyIG5vcm0gPSByZXF1aXJlKCcuL25vcm0nKTtcbiAgICAvKipcbiAgICAqIE1hcHMgYSBudW1iZXIgZnJvbSBvbmUgc2NhbGUgdG8gYW5vdGhlci5cbiAgICAqIEBleGFtcGxlIG1hcCgzLCAwLCA0LCAtMSwgMSkgLT4gMC41XG4gICAgKi9cbiAgICBmdW5jdGlvbiBtYXAodmFsLCBtaW4xLCBtYXgxLCBtaW4yLCBtYXgyKXtcbiAgICAgICAgcmV0dXJuIGxlcnAoIG5vcm0odmFsLCBtaW4xLCBtYXgxKSwgbWluMiwgbWF4MiApO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1hcDtcblxuIiwiXG4gICAgLyoqXG4gICAgKiBHZXRzIG5vcm1hbGl6ZWQgcmF0aW8gb2YgdmFsdWUgaW5zaWRlIHJhbmdlLlxuICAgICovXG4gICAgZnVuY3Rpb24gbm9ybSh2YWwsIG1pbiwgbWF4KXtcbiAgICAgICAgaWYgKHZhbCA8IG1pbiB8fCB2YWwgPiBtYXgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCd2YWx1ZSAoJyArIHZhbCArICcpIG11c3QgYmUgYmV0d2VlbiAnICsgbWluICsgJyBhbmQgJyArIG1heCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsID09PSBtYXggPyAxIDogKHZhbCAtIG1pbikgLyAobWF4IC0gbWluKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBub3JtO1xuXG4iLCIvKipcbiAqIEBjb25zdGFudCBNYXhpbXVtIDMyLWJpdCBzaWduZWQgaW50ZWdlciB2YWx1ZS4gKDJeMzEgLSAxKVxuICovXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IDIxNDc0ODM2NDc7XG5cbiIsIi8qKlxuICogQGNvbnN0YW50IE1pbmltdW0gMzItYml0IHNpZ25lZCBpbnRlZ2VyIHZhbHVlICgtMl4zMSkuXG4gKi9cblxuICAgIG1vZHVsZS5leHBvcnRzID0gLTIxNDc0ODM2NDg7XG5cbiIsInZhciB0b051bWJlciA9IHJlcXVpcmUoJy4uL2xhbmcvdG9OdW1iZXInKTtcbiAgICAvKipcbiAgICAgKiBFbmZvcmNlIGEgc3BlY2lmaWMgYW1vdW50IG9mIGRlY2ltYWwgZGlnaXRzIGFuZCBhbHNvIGZpeCBmbG9hdGluZ1xuICAgICAqIHBvaW50IHJvdW5kaW5nIGlzc3Vlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlbmZvcmNlUHJlY2lzaW9uKHZhbCwgbkRlY2ltYWxEaWdpdHMpe1xuICAgICAgICB2YWwgPSB0b051bWJlcih2YWwpO1xuICAgICAgICB2YXIgcG93ID0gTWF0aC5wb3coMTAsIG5EZWNpbWFsRGlnaXRzKTtcbiAgICAgICAgcmV0dXJuICsoTWF0aC5yb3VuZCh2YWwgKiBwb3cpIC8gcG93KS50b0ZpeGVkKG5EZWNpbWFsRGlnaXRzKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBlbmZvcmNlUHJlY2lzaW9uO1xuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIFwiQ29udmVydFwiIHZhbHVlIGludG8gYW4gMzItYml0IGludGVnZXIuXG4gICAgICogV29ya3MgbGlrZSBgTWF0aC5mbG9vcmAgaWYgdmFsID4gMCBhbmQgYE1hdGguY2VpbGAgaWYgdmFsIDwgMC5cbiAgICAgKiBJTVBPUlRBTlQ6IHZhbCB3aWxsIHdyYXAgYXQgMl4zMSBhbmQgLTJeMzEuXG4gICAgICogUGVyZiB0ZXN0czogaHR0cDovL2pzcGVyZi5jb20vdnMtdnMtcGFyc2VpbnQtYml0d2lzZS1vcGVyYXRvcnMvN1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvSW50KHZhbCl7XG4gICAgICAgIC8vIHdlIGRvIG5vdCB1c2UgbGFuZy90b051bWJlciBiZWNhdXNlIG9mIHBlcmYgYW5kIGFsc28gYmVjYXVzZSBpdFxuICAgICAgICAvLyBkb2Vzbid0IGJyZWFrIHRoZSBmdW5jdGlvbmFsaXR5XG4gICAgICAgIHJldHVybiB+fnZhbDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHRvSW50O1xuXG5cbiIsInZhciBzb21lID0gcmVxdWlyZSgnLi9zb21lJyk7XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBvYmplY3QgY29udGFpbnMgdmFsdWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb250YWlucyhvYmosIG5lZWRsZSkge1xuICAgICAgICByZXR1cm4gc29tZShvYmosIGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgcmV0dXJuICh2YWwgPT09IG5lZWRsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbnRhaW5zO1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xudmFyIGlzUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuLi9sYW5nL2lzUGxhaW5PYmplY3QnKTtcblxuICAgIC8qKlxuICAgICAqIERlZXBseSBjb3B5IG1pc3NpbmcgcHJvcGVydGllcyBpbiB0aGUgdGFyZ2V0IGZyb20gdGhlIGRlZmF1bHRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlZXBGaWxsSW4odGFyZ2V0LCBkZWZhdWx0cyl7XG4gICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgIG4gPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgb2JqO1xuXG4gICAgICAgIHdoaWxlKCsraSA8IG4pIHtcbiAgICAgICAgICAgIG9iaiA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgIGlmIChvYmopIHtcbiAgICAgICAgICAgICAgICAvLyBqc2hpbnQgbG9vcGZ1bmM6IHRydWVcbiAgICAgICAgICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbihuZXdWYWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJWYWx1ZSA9IHRhcmdldFtrZXldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyVmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KGN1clZhbHVlKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUGxhaW5PYmplY3QobmV3VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWVwRmlsbEluKGN1clZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkZWVwRmlsbEluO1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xudmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuLi9sYW5nL2lzQXJyYXknKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRhaW5zTWF0Y2goYXJyYXksIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoZGVlcE1hdGNoZXMoYXJyYXlbaV0sIHBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWF0Y2hBcnJheSh0YXJnZXQsIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIGkgPSAtMSwgcGF0dGVybkxlbmd0aCA9IHBhdHRlcm4ubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgcGF0dGVybkxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKCFjb250YWluc01hdGNoKHRhcmdldCwgcGF0dGVybltpXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYXRjaE9iamVjdCh0YXJnZXQsIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICAgIGZvck93bihwYXR0ZXJuLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgICAgICAgaWYgKCFkZWVwTWF0Y2hlcyh0YXJnZXRba2V5XSwgdmFsKSkge1xuICAgICAgICAgICAgICAgIC8vIFJldHVybiBmYWxzZSB0byBicmVhayBvdXQgb2YgZm9yT3duIGVhcmx5XG4gICAgICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPSBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlbHkgY2hlY2sgaWYgdGhlIG9iamVjdHMgbWF0Y2guXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVlcE1hdGNoZXModGFyZ2V0LCBwYXR0ZXJuKXtcbiAgICAgICAgaWYgKHRhcmdldCAmJiB0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgcGF0dGVybiAmJiB0eXBlb2YgcGF0dGVybiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGlmIChpc0FycmF5KHRhcmdldCkgJiYgaXNBcnJheShwYXR0ZXJuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaEFycmF5KHRhcmdldCwgcGF0dGVybik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaE9iamVjdCh0YXJnZXQsIHBhdHRlcm4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRhcmdldCA9PT0gcGF0dGVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZGVlcE1hdGNoZXM7XG5cblxuIiwidmFyIGhhc093biA9IHJlcXVpcmUoJy4vaGFzT3duJyk7XG52YXIgZXZlcnkgPSByZXF1aXJlKCcuL2V2ZXJ5Jyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuLi9sYW5nL2lzT2JqZWN0Jyk7XG52YXIgaXMgPSByZXF1aXJlKCcuLi9sYW5nL2lzJyk7XG5cbiAgICAvLyBNYWtlcyBhIGZ1bmN0aW9uIHRvIGNvbXBhcmUgdGhlIG9iamVjdCB2YWx1ZXMgZnJvbSB0aGUgc3BlY2lmaWVkIGNvbXBhcmVcbiAgICAvLyBvcGVyYXRpb24gY2FsbGJhY2suXG4gICAgZnVuY3Rpb24gbWFrZUNvbXBhcmUoY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBoYXNPd24odGhpcywga2V5KSAmJiBjYWxsYmFjayh2YWx1ZSwgdGhpc1trZXldKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja1Byb3BlcnRpZXModmFsdWUsIGtleSkge1xuICAgICAgICByZXR1cm4gaGFzT3duKHRoaXMsIGtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHR3byBvYmplY3RzIGhhdmUgdGhlIHNhbWUga2V5cyBhbmQgdmFsdWVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVxdWFscyhhLCBiLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGlzO1xuXG4gICAgICAgIGlmICghaXNPYmplY3QoYSkgfHwgIWlzT2JqZWN0KGIpKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soYSwgYik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKGV2ZXJ5KGEsIG1ha2VDb21wYXJlKGNhbGxiYWNrKSwgYikgJiZcbiAgICAgICAgICAgICAgICBldmVyeShiLCBjaGVja1Byb3BlcnRpZXMsIGEpKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGVxdWFscztcblxuIiwidmFyIGZvck93biA9IHJlcXVpcmUoJy4vZm9yT3duJyk7XG52YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogT2JqZWN0IGV2ZXJ5XG4gICAgICovXG4gICAgZnVuY3Rpb24gZXZlcnkob2JqLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHQgPSB0cnVlO1xuICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgICAgICAgLy8gd2UgY29uc2lkZXIgYW55IGZhbHN5IHZhbHVlcyBhcyBcImZhbHNlXCIgb24gcHVycG9zZSBzbyBzaG9ydGhhbmRcbiAgICAgICAgICAgIC8vIHN5bnRheCBjYW4gYmUgdXNlZCB0byBjaGVjayBwcm9wZXJ0eSBleGlzdGVuY2VcbiAgICAgICAgICAgIGlmICghY2FsbGJhY2sodmFsLCBrZXksIG9iaikpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZXZlcnk7XG5cblxuIiwidmFyIGZvck93biA9IHJlcXVpcmUoJy4vZm9yT3duJyk7XG52YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgd2hlcmUgdGhlIGNhbGxiYWNrIHJldHVybnNcbiAgICAgKiB0cnVlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbHRlclZhbHVlcyhvYmosIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIG91dHB1dCA9IHt9O1xuICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmopIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayh2YWx1ZSwga2V5LCBvYmopKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaWx0ZXJWYWx1ZXM7XG5cbiIsInZhciBzb21lID0gcmVxdWlyZSgnLi9zb21lJyk7XG52YXIgbWFrZUl0ZXJhdG9yID0gcmVxdWlyZSgnLi4vZnVuY3Rpb24vbWFrZUl0ZXJhdG9yXycpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBmaXJzdCBpdGVtIHRoYXQgbWF0Y2hlcyBjcml0ZXJpYVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbmQob2JqLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgIHNvbWUob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmopIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayh2YWx1ZSwga2V5LCBvYmopKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaW5kO1xuXG5cbiIsInZhciBpc1ByaW1pdGl2ZSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNQcmltaXRpdmUnKTtcblxuICAgIC8qKlxuICAgICAqIGdldCBcIm5lc3RlZFwiIG9iamVjdCBwcm9wZXJ0eVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldChvYmosIHByb3Ape1xuICAgICAgICB2YXIgcGFydHMgPSBwcm9wLnNwbGl0KCcuJyksXG4gICAgICAgICAgICBsYXN0ID0gcGFydHMucG9wKCk7XG5cbiAgICAgICAgd2hpbGUgKHByb3AgPSBwYXJ0cy5zaGlmdCgpKSB7XG4gICAgICAgICAgICBvYmogPSBvYmpbcHJvcF07XG4gICAgICAgICAgICBpZiAob2JqID09IG51bGwpIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvYmpbbGFzdF07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBnZXQ7XG5cblxuIiwidmFyIGdldCA9IHJlcXVpcmUoJy4vZ2V0Jyk7XG5cbiAgICB2YXIgVU5ERUY7XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBvYmplY3QgaGFzIG5lc3RlZCBwcm9wZXJ0eS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYXMob2JqLCBwcm9wKXtcbiAgICAgICAgcmV0dXJuIGdldChvYmosIHByb3ApICE9PSBVTkRFRjtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGhhcztcblxuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xuXG4gICAgLyoqXG4gICAgICogR2V0IG9iamVjdCBrZXlzXG4gICAgICovXG4gICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgdmFyIGtleXMgPSBbXTtcbiAgICAgICAgICAgIGZvck93bihvYmosIGZ1bmN0aW9uKHZhbCwga2V5KXtcbiAgICAgICAgICAgICAgICBrZXlzLnB1c2goa2V5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGtleXM7XG4gICAgICAgIH07XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGtleXM7XG5cblxuIiwidmFyIGhhc093biA9IHJlcXVpcmUoJy4vaGFzT3duJyk7XG52YXIgZGVlcENsb25lID0gcmVxdWlyZSgnLi4vbGFuZy9kZWVwQ2xvbmUnKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4uL2xhbmcvaXNPYmplY3QnKTtcblxuICAgIC8qKlxuICAgICAqIERlZXAgbWVyZ2Ugb2JqZWN0cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtZXJnZSgpIHtcbiAgICAgICAgdmFyIGkgPSAxLFxuICAgICAgICAgICAga2V5LCB2YWwsIG9iaiwgdGFyZ2V0O1xuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBtb2RpZnkgc291cmNlIGVsZW1lbnQgYW5kIGl0J3MgcHJvcGVydGllc1xuICAgICAgICAvLyBvYmplY3RzIGFyZSBwYXNzZWQgYnkgcmVmZXJlbmNlXG4gICAgICAgIHRhcmdldCA9IGRlZXBDbG9uZSggYXJndW1lbnRzWzBdICk7XG5cbiAgICAgICAgd2hpbGUgKG9iaiA9IGFyZ3VtZW50c1tpKytdKSB7XG4gICAgICAgICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAoICEgaGFzT3duKG9iaiwga2V5KSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFsID0gb2JqW2tleV07XG5cbiAgICAgICAgICAgICAgICBpZiAoIGlzT2JqZWN0KHZhbCkgJiYgaXNPYmplY3QodGFyZ2V0W2tleV0pICl7XG4gICAgICAgICAgICAgICAgICAgIC8vIGluY2VwdGlvbiwgZGVlcCBtZXJnZSBvYmplY3RzXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gbWVyZ2UodGFyZ2V0W2tleV0sIHZhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFycmF5cywgcmVnZXhwLCBkYXRlLCBvYmplY3RzIGFyZSBjbG9uZWRcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBkZWVwQ2xvbmUodmFsKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtZXJnZTtcblxuXG4iLCJ2YXIgZm9yRWFjaCA9IHJlcXVpcmUoJy4uL2FycmF5L2ZvckVhY2gnKTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBuZXN0ZWQgb2JqZWN0IGlmIG5vbi1leGlzdGVudFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG5hbWVzcGFjZShvYmosIHBhdGgpe1xuICAgICAgICBpZiAoIXBhdGgpIHJldHVybiBvYmo7XG4gICAgICAgIGZvckVhY2gocGF0aC5zcGxpdCgnLicpLCBmdW5jdGlvbihrZXkpe1xuICAgICAgICAgICAgaWYgKCFvYmpba2V5XSkge1xuICAgICAgICAgICAgICAgIG9ialtrZXldID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmogPSBvYmpba2V5XTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBuYW1lc3BhY2U7XG5cblxuIiwidmFyIHNsaWNlID0gcmVxdWlyZSgnLi4vYXJyYXkvc2xpY2UnKTtcbnZhciBjb250YWlucyA9IHJlcXVpcmUoJy4uL2FycmF5L2NvbnRhaW5zJyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3QsIGZpbHRlcmVkIHRvIG9ubHkgY29udGFpbiBwcm9wZXJ0aWVzIGV4Y2VwdCB0aGUgYmxhY2tsaXN0ZWQga2V5cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvbWl0KG9iaiwgdmFyX2tleXMpe1xuICAgICAgICB2YXIga2V5cyA9IHR5cGVvZiBhcmd1bWVudHNbMV0gIT09ICdzdHJpbmcnPyBhcmd1bWVudHNbMV0gOiBzbGljZShhcmd1bWVudHMsIDEpLFxuICAgICAgICAgICAgb3V0ID0ge307XG5cbiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqKSB7XG4gICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3BlcnR5KSAmJiAhY29udGFpbnMoa2V5cywgcHJvcGVydHkpKSB7XG4gICAgICAgICAgICAgICAgb3V0W3Byb3BlcnR5XSA9IG9ialtwcm9wZXJ0eV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG9taXQ7XG5cblxuIiwidmFyIG5hbWVzcGFjZSA9IHJlcXVpcmUoJy4vbmFtZXNwYWNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBzZXQgXCJuZXN0ZWRcIiBvYmplY3QgcHJvcGVydHlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXQob2JqLCBwcm9wLCB2YWwpe1xuICAgICAgICB2YXIgcGFydHMgPSAoL14oLispXFwuKC4rKSQvKS5leGVjKHByb3ApO1xuICAgICAgICBpZiAocGFydHMpe1xuICAgICAgICAgICAgbmFtZXNwYWNlKG9iaiwgcGFydHNbMV0pW3BhcnRzWzJdXSA9IHZhbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9ialtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc2V0O1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xuXG4gICAgLyoqXG4gICAgICogR2V0IG9iamVjdCBzaXplXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2l6ZShvYmopIHtcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgZm9yT3duKG9iaiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBzaXplO1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xudmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIE9iamVjdCBzb21lXG4gICAgICovXG4gICAgZnVuY3Rpb24gc29tZShvYmosIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKHZhbCwga2V5LCBvYmopKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc29tZTtcblxuXG4iLCJ2YXIgaGFzID0gcmVxdWlyZSgnLi9oYXMnKTtcblxuICAgIC8qKlxuICAgICAqIFVuc2V0IG9iamVjdCBwcm9wZXJ0eS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bnNldChvYmosIHByb3Ape1xuICAgICAgICBpZiAoaGFzKG9iaiwgcHJvcCkpIHtcbiAgICAgICAgICAgIHZhciBwYXJ0cyA9IHByb3Auc3BsaXQoJy4nKSxcbiAgICAgICAgICAgICAgICBsYXN0ID0gcGFydHMucG9wKCk7XG4gICAgICAgICAgICB3aGlsZSAocHJvcCA9IHBhcnRzLnNoaWZ0KCkpIHtcbiAgICAgICAgICAgICAgICBvYmogPSBvYmpbcHJvcF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGRlbGV0ZSBvYmpbbGFzdF0pO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBpZiBwcm9wZXJ0eSBkb2Vzbid0IGV4aXN0IHRyZWF0IGFzIGRlbGV0ZWRcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB1bnNldDtcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcblxuICAgIC8qKlxuICAgICAqIEdldCBvYmplY3QgdmFsdWVzXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsdWVzKG9iaikge1xuICAgICAgICB2YXIgdmFscyA9IFtdO1xuICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbih2YWwsIGtleSl7XG4gICAgICAgICAgICB2YWxzLnB1c2godmFsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWxzO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdmFsdWVzO1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuLi9vYmplY3QvZm9yT3duJyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNBcnJheScpO1xudmFyIGZvckVhY2ggPSByZXF1aXJlKCcuLi9hcnJheS9mb3JFYWNoJyk7XG5cbiAgICAvKipcbiAgICAgKiBFbmNvZGUgb2JqZWN0IGludG8gYSBxdWVyeSBzdHJpbmcuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZW5jb2RlKG9iail7XG4gICAgICAgIHZhciBxdWVyeSA9IFtdLFxuICAgICAgICAgICAgYXJyVmFsdWVzLCByZWc7XG4gICAgICAgIGZvck93bihvYmosIGZ1bmN0aW9uICh2YWwsIGtleSkge1xuICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgICAgIGFyclZhbHVlcyA9IGtleSArICc9JztcbiAgICAgICAgICAgICAgICByZWcgPSBuZXcgUmVnRXhwKCcmJytrZXkrJys9JCcpO1xuICAgICAgICAgICAgICAgIGZvckVhY2godmFsLCBmdW5jdGlvbiAoYVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyclZhbHVlcyArPSBlbmNvZGVVUklDb21wb25lbnQoYVZhbHVlKSArICcmJyArIGtleSArICc9JztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKGFyclZhbHVlcy5yZXBsYWNlKHJlZywgJycpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICBxdWVyeS5wdXNoKGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAocXVlcnkubGVuZ3RoKSA/ICc/JyArIHF1ZXJ5LmpvaW4oJyYnKSA6ICcnO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZW5jb2RlO1xuXG4iLCJ2YXIgdHlwZWNhc3QgPSByZXF1aXJlKCcuLi9zdHJpbmcvdHlwZWNhc3QnKTtcbnZhciBnZXRRdWVyeSA9IHJlcXVpcmUoJy4vZ2V0UXVlcnknKTtcblxuICAgIC8qKlxuICAgICAqIEdldCBxdWVyeSBwYXJhbWV0ZXIgdmFsdWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UGFyYW0odXJsLCBwYXJhbSwgc2hvdWxkVHlwZWNhc3Qpe1xuICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cCgnKFxcXFw/fCYpJysgcGFyYW0gKyAnPShbXiZdKiknKSwgLy9tYXRjaGVzIGA/cGFyYW09dmFsdWVgIG9yIGAmcGFyYW09dmFsdWVgLCB2YWx1ZSA9ICQyXG4gICAgICAgICAgICByZXN1bHQgPSByZWdleHAuZXhlYyggZ2V0UXVlcnkodXJsKSApLFxuICAgICAgICAgICAgdmFsID0gKHJlc3VsdCAmJiByZXN1bHRbMl0pPyByZXN1bHRbMl0gOiBudWxsO1xuICAgICAgICByZXR1cm4gc2hvdWxkVHlwZWNhc3QgPT09IGZhbHNlPyB2YWwgOiB0eXBlY2FzdCh2YWwpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0UGFyYW07XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogR2V0cyBmdWxsIHF1ZXJ5IGFzIHN0cmluZyB3aXRoIGFsbCBzcGVjaWFsIGNoYXJzIGRlY29kZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UXVlcnkodXJsKSB7XG4gICAgICAgIC8vIHVybCA9IHVybC5yZXBsYWNlKC8jLipcXD8vLCAnPycpOyAvL3JlbW92ZXMgaGFzaCAodG8gYXZvaWQgZ2V0dGluZyBoYXNoIHF1ZXJ5KVxuICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAvXFw/W2EtekEtWjAtOVxcPVxcJlxcJVxcJFxcLVxcX1xcLlxcK1xcIVxcKlxcJ1xcKFxcKVxcLF0rLy5leGVjKHVybCk7IC8vdmFsaWQgY2hhcnMgYWNjb3JkaW5nIHRvOiBodHRwOi8vd3d3LmlldGYub3JnL3JmYy9yZmMxNzM4LnR4dFxuICAgICAgICByZXR1cm4gKHF1ZXJ5U3RyaW5nKT8gZGVjb2RlVVJJQ29tcG9uZW50KHF1ZXJ5U3RyaW5nWzBdLnJlcGxhY2UoL1xcKy9nLCcgJykpIDogJyc7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBnZXRRdWVyeTtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBTZXQgcXVlcnkgc3RyaW5nIHBhcmFtZXRlciB2YWx1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldFBhcmFtKHVybCwgcGFyYW1OYW1lLCB2YWx1ZSl7XG4gICAgICAgIHVybCA9IHVybCB8fCAnJztcblxuICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCcoXFxcXD98JiknKyBwYXJhbU5hbWUgKyc9W14mXSonICk7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtTmFtZSArJz0nKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7XG5cbiAgICAgICAgaWYgKCByZS50ZXN0KHVybCkgKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsLnJlcGxhY2UocmUsICckMScrIHBhcmFtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignPycpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHVybCArPSAnPyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoJz0nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB1cmwgKz0gJyYnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVybCArIHBhcmFtO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNldFBhcmFtO1xuXG5cbiIsInZhciByYW5kSW50ID0gcmVxdWlyZSgnLi9yYW5kSW50Jyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNBcnJheScpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHJhbmRvbSBlbGVtZW50IGZyb20gdGhlIHN1cHBsaWVkIGFyZ3VtZW50c1xuICAgICAqIG9yIGZyb20gdGhlIGFycmF5IChpZiBzaW5nbGUgYXJndW1lbnQgaXMgYW4gYXJyYXkpLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNob2ljZShpdGVtcykge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShpdGVtcykpPyBpdGVtcyA6IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIHRhcmdldFsgcmFuZEludCgwLCB0YXJnZXQubGVuZ3RoIC0gMSkgXTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNob2ljZTtcblxuXG4iLCJ2YXIgcmFuZEhleCA9IHJlcXVpcmUoJy4vcmFuZEhleCcpO1xudmFyIGNob2ljZSA9IHJlcXVpcmUoJy4vY2hvaWNlJyk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgcHNldWRvLXJhbmRvbSBndWlkIChVVUlEIHY0KVxuICAgKiBJTVBPUlRBTlQ6IGl0J3Mgbm90IHRvdGFsbHkgXCJzYWZlXCIgc2luY2UgcmFuZEhleC9jaG9pY2UgdXNlcyBNYXRoLnJhbmRvbVxuICAgKiBieSBkZWZhdWx0IGFuZCBzZXF1ZW5jZXMgY2FuIGJlIHByZWRpY3RlZCBpbiBzb21lIGNhc2VzLiBTZWUgdGhlXG4gICAqIFwicmFuZG9tL3JhbmRvbVwiIGRvY3VtZW50YXRpb24gZm9yIG1vcmUgaW5mbyBhYm91dCBpdCBhbmQgaG93IHRvIHJlcGxhY2VcbiAgICogdGhlIGRlZmF1bHQgUFJORy5cbiAgICovXG4gIGZ1bmN0aW9uIGd1aWQoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgcmFuZEhleCg4KSsnLScrXG4gICAgICAgIHJhbmRIZXgoNCkrJy0nK1xuICAgICAgICAvLyB2NCBVVUlEIGFsd2F5cyBjb250YWluIFwiNFwiIGF0IHRoaXMgcG9zaXRpb24gdG8gc3BlY2lmeSBpdCB3YXNcbiAgICAgICAgLy8gcmFuZG9tbHkgZ2VuZXJhdGVkXG4gICAgICAgICc0JyArIHJhbmRIZXgoMykgKyctJytcbiAgICAgICAgLy8gdjQgVVVJRCBhbHdheXMgY29udGFpbiBjaGFycyBbYSxiLDgsOV0gYXQgdGhpcyBwb3NpdGlvblxuICAgICAgICBjaG9pY2UoOCwgOSwgJ2EnLCAnYicpICsgcmFuZEhleCgzKSsnLScrXG4gICAgICAgIHJhbmRIZXgoMTIpXG4gICAgKTtcbiAgfVxuICBtb2R1bGUuZXhwb3J0cyA9IGd1aWQ7XG5cbiIsInZhciByYW5kb20gPSByZXF1aXJlKCcuL3JhbmRvbScpO1xudmFyIE1JTl9JTlQgPSByZXF1aXJlKCcuLi9udW1iZXIvTUlOX0lOVCcpO1xudmFyIE1BWF9JTlQgPSByZXF1aXJlKCcuLi9udW1iZXIvTUFYX0lOVCcpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyByYW5kb20gbnVtYmVyIGluc2lkZSByYW5nZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJhbmQobWluLCBtYXgpe1xuICAgICAgICBtaW4gPSBtaW4gPT0gbnVsbD8gTUlOX0lOVCA6IG1pbjtcbiAgICAgICAgbWF4ID0gbWF4ID09IG51bGw/IE1BWF9JTlQgOiBtYXg7XG4gICAgICAgIHJldHVybiBtaW4gKyAobWF4IC0gbWluKSAqIHJhbmRvbSgpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcmFuZDtcblxuIiwidmFyIGNob2ljZSA9IHJlcXVpcmUoJy4vY2hvaWNlJyk7XG5cbiAgICB2YXIgX2NoYXJzID0gJzAxMjM0NTY3ODlhYmNkZWYnLnNwbGl0KCcnKTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSByYW5kb20gaGV4YWRlY2ltYWwgc3RyaW5nXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZEhleChzaXplKXtcbiAgICAgICAgc2l6ZSA9IHNpemUgJiYgc2l6ZSA+IDA/IHNpemUgOiA2O1xuICAgICAgICB2YXIgc3RyID0gJyc7XG4gICAgICAgIHdoaWxlIChzaXplLS0pIHtcbiAgICAgICAgICAgIHN0ciArPSBjaG9pY2UoX2NoYXJzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcmFuZEhleDtcblxuXG4iLCJ2YXIgTUlOX0lOVCA9IHJlcXVpcmUoJy4uL251bWJlci9NSU5fSU5UJyk7XG52YXIgTUFYX0lOVCA9IHJlcXVpcmUoJy4uL251bWJlci9NQVhfSU5UJyk7XG52YXIgcmFuZCA9IHJlcXVpcmUoJy4vcmFuZCcpO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyByYW5kb20gaW50ZWdlciBpbnNpZGUgcmFuZ2Ugb3Igc25hcCB0byBtaW4vbWF4IHZhbHVlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByYW5kSW50KG1pbiwgbWF4KXtcbiAgICAgICAgbWluID0gbWluID09IG51bGw/IE1JTl9JTlQgOiB+fm1pbjtcbiAgICAgICAgbWF4ID0gbWF4ID09IG51bGw/IE1BWF9JTlQgOiB+fm1heDtcbiAgICAgICAgLy8gY2FuJ3QgYmUgbWF4ICsgMC41IG90aGVyd2lzZSBpdCB3aWxsIHJvdW5kIHVwIGlmIGByYW5kYFxuICAgICAgICAvLyByZXR1cm5zIGBtYXhgIGNhdXNpbmcgaXQgdG8gb3ZlcmZsb3cgcmFuZ2UuXG4gICAgICAgIC8vIC0wLjUgYW5kICsgMC40OSBhcmUgcmVxdWlyZWQgdG8gYXZvaWQgYmlhcyBjYXVzZWQgYnkgcm91bmRpbmdcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoIHJhbmQobWluIC0gMC41LCBtYXggKyAwLjQ5OTk5OTk5OTk5OSkgKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJhbmRJbnQ7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogSnVzdCBhIHdyYXBwZXIgdG8gTWF0aC5yYW5kb20uIE5vIG1ldGhvZHMgaW5zaWRlIG1vdXQvcmFuZG9tIHNob3VsZCBjYWxsXG4gICAgICogTWF0aC5yYW5kb20oKSBkaXJlY3RseSBzbyB3ZSBjYW4gaW5qZWN0IHRoZSBwc2V1ZG8tcmFuZG9tIG51bWJlclxuICAgICAqIGdlbmVyYXRvciBpZiBuZWVkZWQgKGllLiBpbiBjYXNlIHdlIG5lZWQgYSBzZWVkZWQgcmFuZG9tIG9yIGEgYmV0dGVyXG4gICAgICogYWxnb3JpdGhtIHRoYW4gdGhlIG5hdGl2ZSBvbmUpXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZG9tKCl7XG4gICAgICAgIHJldHVybiByYW5kb20uZ2V0KCk7XG4gICAgfVxuXG4gICAgLy8gd2UgZXhwb3NlIHRoZSBtZXRob2Qgc28gaXQgY2FuIGJlIHN3YXBwZWQgaWYgbmVlZGVkXG4gICAgcmFuZG9tLmdldCA9IE1hdGgucmFuZG9tO1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSByYW5kb207XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuXG4gICAgLyoqXG4gICAgICogU2VhcmNoZXMgZm9yIGEgZ2l2ZW4gc3Vic3RyaW5nXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udGFpbnMoc3RyLCBzdWJzdHJpbmcsIGZyb21JbmRleCl7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHN1YnN0cmluZyA9IHRvU3RyaW5nKHN1YnN0cmluZyk7XG4gICAgICAgIHJldHVybiBzdHIuaW5kZXhPZihzdWJzdHJpbmcsIGZyb21JbmRleCkgIT09IC0xO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gY29udGFpbnM7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBzdHJpbmcgZW5kcyB3aXRoIHNwZWNpZmllZCBzdWZmaXguXG4gICAgICovXG4gICAgZnVuY3Rpb24gZW5kc1dpdGgoc3RyLCBzdWZmaXgpIHtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgc3VmZml4ID0gdG9TdHJpbmcoc3VmZml4KTtcblxuICAgICAgICByZXR1cm4gc3RyLmluZGV4T2Yoc3VmZml4LCBzdHIubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aCkgIT09IC0xO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZW5kc1dpdGg7XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcblxuICAgIC8qKlxuICAgICAqIEVzY2FwZXMgYSBzdHJpbmcgZm9yIGluc2VydGlvbiBpbnRvIEhUTUwuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpe1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpXG4gICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKVxuICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKVxuICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgICAgICAgICAgLnJlcGxhY2UoLycvZywgJyYjMzk7JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyk7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBlc2NhcGVIdG1sO1xuXG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcblxuICAgIC8qKlxuICAgICAqIEVzY2FwZSBzdHJpbmcgaW50byB1bmljb2RlIHNlcXVlbmNlc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVzY2FwZVVuaWNvZGUoc3RyLCBzaG91bGRFc2NhcGVQcmludGFibGUpe1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXHNcXFNdL2csIGZ1bmN0aW9uKGNoKXtcbiAgICAgICAgICAgIC8vIHNraXAgcHJpbnRhYmxlIEFTQ0lJIGNoYXJzIGlmIHdlIHNob3VsZCBub3QgZXNjYXBlIHRoZW1cbiAgICAgICAgICAgIGlmICghc2hvdWxkRXNjYXBlUHJpbnRhYmxlICYmICgvW1xceDIwLVxceDdFXS8pLnRlc3QoY2gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gd2UgdXNlIFwiMDAwXCIgYW5kIHNsaWNlKC00KSBmb3IgYnJldml0eSwgbmVlZCB0byBwYWQgemVyb3MsXG4gICAgICAgICAgICAvLyB1bmljb2RlIGVzY2FwZSBhbHdheXMgaGF2ZSA0IGNoYXJzIGFmdGVyIFwiXFx1XCJcbiAgICAgICAgICAgIHJldHVybiAnXFxcXHUnKyAoJzAwMCcrIGNoLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZXNjYXBlVW5pY29kZTtcblxuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG52YXIgZ2V0ID0gcmVxdWlyZSgnLi4vb2JqZWN0L2dldCcpO1xuXG4gICAgdmFyIHN0YWNoZSA9IC9cXHtcXHsoW15cXH1dKylcXH1cXH0vZzsgLy9tdXN0YWNoZS1saWtlXG5cbiAgICAvKipcbiAgICAgKiBTdHJpbmcgaW50ZXJwb2xhdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGludGVycG9sYXRlKHRlbXBsYXRlLCByZXBsYWNlbWVudHMsIHN5bnRheCl7XG4gICAgICAgIHRlbXBsYXRlID0gdG9TdHJpbmcodGVtcGxhdGUpO1xuICAgICAgICB2YXIgcmVwbGFjZUZuID0gZnVuY3Rpb24obWF0Y2gsIHByb3Ape1xuICAgICAgICAgICAgcmV0dXJuIHRvU3RyaW5nKCBnZXQocmVwbGFjZW1lbnRzLCBwcm9wKSApO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGVtcGxhdGUucmVwbGFjZShzeW50YXggfHwgc3RhY2hlLCByZXBsYWNlRm4pO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gaW50ZXJwb2xhdGU7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuICAgIC8qKlxuICAgICAqIFwiU2FmZXJcIiBTdHJpbmcudG9Mb3dlckNhc2UoKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxvd2VyQ2FzZShzdHIpe1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBsb3dlckNhc2U7XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciBsb3dlckNhc2UgPSByZXF1aXJlKCcuL2xvd2VyQ2FzZScpO1xudmFyIHVwcGVyQ2FzZSA9IHJlcXVpcmUoJy4vdXBwZXJDYXNlJyk7XG4gICAgLyoqXG4gICAgICogVVBQRVJDQVNFIGZpcnN0IGNoYXIgb2YgZWFjaCB3b3JkLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByb3BlckNhc2Uoc3RyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgcmV0dXJuIGxvd2VyQ2FzZShzdHIpLnJlcGxhY2UoL15cXHd8XFxzXFx3L2csIHVwcGVyQ2FzZSk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBwcm9wZXJDYXNlO1xuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG4gICAgLy8gVGhpcyBwYXR0ZXJuIGlzIGdlbmVyYXRlZCBieSB0aGUgX2J1aWxkL3BhdHRlcm4tcmVtb3ZlTm9uV29yZC5qcyBzY3JpcHRcbiAgICB2YXIgUEFUVEVSTiA9IC9bXlxceDIwXFx4MkQwLTlBLVpcXHg1RmEtelxceEMwLVxceEQ2XFx4RDgtXFx4RjZcXHhGOC1cXHhGRl0vZztcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBub24td29yZCBjaGFycy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVOb25Xb3JkKHN0cil7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHJldHVybiBzdHIucmVwbGFjZShQQVRURVJOLCAnJyk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSByZW1vdmVOb25Xb3JkO1xuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG52YXIgdG9JbnQgPSByZXF1aXJlKCcuLi9udW1iZXIvdG9JbnQnKTtcblxuICAgIC8qKlxuICAgICAqIFJlcGVhdCBzdHJpbmcgbiB0aW1lc1xuICAgICAqL1xuICAgICBmdW5jdGlvbiByZXBlYXQoc3RyLCBuKXtcbiAgICAgICAgIHZhciByZXN1bHQgPSAnJztcbiAgICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgICBuID0gdG9JbnQobik7XG4gICAgICAgIGlmIChuIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChuID4gMCkge1xuICAgICAgICAgICAgaWYgKG4gJSAyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN0cjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTtcbiAgICAgICAgICAgIHN0ciArPSBzdHI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgfVxuXG4gICAgIG1vZHVsZS5leHBvcnRzID0gcmVwZWF0O1xuXG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciB0b0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy90b0FycmF5Jyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIHN0cmluZyhzKSB3aXRoIHRoZSByZXBsYWNlbWVudChzKSBpbiB0aGUgc291cmNlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlcGxhY2Uoc3RyLCBzZWFyY2gsIHJlcGxhY2VtZW50cykge1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICBzZWFyY2ggPSB0b0FycmF5KHNlYXJjaCk7XG4gICAgICAgIHJlcGxhY2VtZW50cyA9IHRvQXJyYXkocmVwbGFjZW1lbnRzKTtcblxuICAgICAgICB2YXIgc2VhcmNoTGVuZ3RoID0gc2VhcmNoLmxlbmd0aCxcbiAgICAgICAgICAgIHJlcGxhY2VtZW50c0xlbmd0aCA9IHJlcGxhY2VtZW50cy5sZW5ndGg7XG5cbiAgICAgICAgaWYgKHJlcGxhY2VtZW50c0xlbmd0aCAhPT0gMSAmJiBzZWFyY2hMZW5ndGggIT09IHJlcGxhY2VtZW50c0xlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmVxdWFsIG51bWJlciBvZiBzZWFyY2hlcyBhbmQgcmVwbGFjZW1lbnRzJyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xO1xuICAgICAgICB3aGlsZSAoKytpIDwgc2VhcmNoTGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBVc2UgdGhlIGZpcnN0IHJlcGxhY2VtZW50IGZvciBhbGwgc2VhcmNoZXMgaWYgb25seSBvbmVcbiAgICAgICAgICAgIC8vIHJlcGxhY2VtZW50IGlzIHByb3ZpZGVkXG4gICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZShcbiAgICAgICAgICAgICAgICBzZWFyY2hbaV0sXG4gICAgICAgICAgICAgICAgcmVwbGFjZW1lbnRzWyhyZXBsYWNlbWVudHNMZW5ndGggPT09IDEpID8gMCA6IGldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSByZXBsYWNlO1xuXG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbiAgICAvKipcbiAgICAqIFJlcGxhY2VzIGFsbCBhY2NlbnRlZCBjaGFycyB3aXRoIHJlZ3VsYXIgb25lc1xuICAgICovXG4gICAgZnVuY3Rpb24gcmVwbGFjZUFjY2VudHMoc3RyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcblxuICAgICAgICAvLyB2ZXJpZmllcyBpZiB0aGUgU3RyaW5nIGhhcyBhY2NlbnRzIGFuZCByZXBsYWNlIHRoZW1cbiAgICAgICAgaWYgKHN0ci5zZWFyY2goL1tcXHhDMC1cXHhGRl0vZykgPiAtMSkge1xuICAgICAgICAgICAgc3RyID0gc3RyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4QzAtXFx4QzVdL2csIFwiQVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceEM2XS9nLCBcIkFFXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4QzddL2csIFwiQ1wiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceEM4LVxceENCXS9nLCBcIkVcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhDQy1cXHhDRl0vZywgXCJJXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RDBdL2csIFwiRFwiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceEQxXS9nLCBcIk5cIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhEMi1cXHhENlxceEQ4XS9nLCBcIk9cIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhEOS1cXHhEQ10vZywgXCJVXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RERdL2csIFwiWVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceERFXS9nLCBcIlBcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhFMC1cXHhFNV0vZywgXCJhXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RTZdL2csIFwiYWVcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhFN10vZywgXCJjXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RTgtXFx4RUJdL2csIFwiZVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceEVDLVxceEVGXS9nLCBcImlcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhGMV0vZywgXCJuXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RjItXFx4RjZcXHhGOF0vZywgXCJvXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFx4RjktXFx4RkNdL2csIFwidVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xceEZFXS9nLCBcInBcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHhGRFxceEZGXS9nLCBcInlcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSByZXBsYWNlQWNjZW50cztcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIHJlcGVhdCA9IHJlcXVpcmUoJy4vcmVwZWF0Jyk7XG5cbiAgICAvKipcbiAgICAgKiBQYWQgc3RyaW5nIHdpdGggYGNoYXJgIGlmIGl0cycgbGVuZ3RoIGlzIHNtYWxsZXIgdGhhbiBgbWluTGVuYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJwYWQoc3RyLCBtaW5MZW4sIGNoKSB7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIGNoID0gY2ggfHwgJyAnO1xuICAgICAgICByZXR1cm4gKHN0ci5sZW5ndGggPCBtaW5MZW4pPyBzdHIgKyByZXBlYXQoY2gsIG1pbkxlbiAtIHN0ci5sZW5ndGgpIDogc3RyO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcnBhZDtcblxuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG52YXIgcmVwbGFjZUFjY2VudHMgPSByZXF1aXJlKCcuL3JlcGxhY2VBY2NlbnRzJyk7XG52YXIgcmVtb3ZlTm9uV29yZCA9IHJlcXVpcmUoJy4vcmVtb3ZlTm9uV29yZCcpO1xudmFyIHRyaW0gPSByZXF1aXJlKCcuL3RyaW0nKTtcbiAgICAvKipcbiAgICAgKiBDb252ZXJ0IHRvIGxvd2VyIGNhc2UsIHJlbW92ZSBhY2NlbnRzLCByZW1vdmUgbm9uLXdvcmQgY2hhcnMgYW5kXG4gICAgICogcmVwbGFjZSBzcGFjZXMgd2l0aCB0aGUgc3BlY2lmaWVkIGRlbGltZXRlci5cbiAgICAgKiBEb2VzIG5vdCBzcGxpdCBjYW1lbENhc2UgdGV4dC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzbHVnaWZ5KHN0ciwgZGVsaW1ldGVyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcblxuICAgICAgICBpZiAoZGVsaW1ldGVyID09IG51bGwpIHtcbiAgICAgICAgICAgIGRlbGltZXRlciA9IFwiLVwiO1xuICAgICAgICB9XG4gICAgICAgIHN0ciA9IHJlcGxhY2VBY2NlbnRzKHN0cik7XG4gICAgICAgIHN0ciA9IHJlbW92ZU5vbldvcmQoc3RyKTtcbiAgICAgICAgc3RyID0gdHJpbShzdHIpIC8vc2hvdWxkIGNvbWUgYWZ0ZXIgcmVtb3ZlTm9uV29yZFxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8gKy9nLCBkZWxpbWV0ZXIpIC8vcmVwbGFjZSBzcGFjZXMgd2l0aCBkZWxpbWV0ZXJcbiAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBzbHVnaWZ5O1xuXG4iLCJcblxuICAgIHZhciBVTkRFRjtcblxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBzdHJpbmcgYW5kIGNvbnZlcnQgaXQgaW50byBhIG5hdGl2ZSB2YWx1ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0eXBlY2FzdCh2YWwpIHtcbiAgICAgICAgdmFyIHI7XG4gICAgICAgIGlmICggdmFsID09PSBudWxsIHx8IHZhbCA9PT0gJ251bGwnICkge1xuICAgICAgICAgICAgciA9IG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAoIHZhbCA9PT0gJ3RydWUnICkge1xuICAgICAgICAgICAgciA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoIHZhbCA9PT0gJ2ZhbHNlJyApIHtcbiAgICAgICAgICAgIHIgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICggdmFsID09PSBVTkRFRiB8fCB2YWwgPT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgciA9IFVOREVGO1xuICAgICAgICB9IGVsc2UgaWYgKCB2YWwgPT09ICcnIHx8IGlzTmFOKHZhbCkgKSB7XG4gICAgICAgICAgICAvL2lzTmFOKCcnKSByZXR1cm5zIGZhbHNlXG4gICAgICAgICAgICByID0gdmFsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy9wYXJzZUZsb2F0KG51bGwgfHwgJycpIHJldHVybnMgTmFOXG4gICAgICAgICAgICByID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdHlwZWNhc3Q7XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcblxuICAgIC8qKlxuICAgICAqIFVuZXNjYXBlcyBIVE1MIHNwZWNpYWwgY2hhcnNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bmVzY2FwZUh0bWwoc3RyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKVxuICAgICAgICAgICAgLnJlcGxhY2UoLyZhbXA7L2cgLCAnJicpXG4gICAgICAgICAgICAucmVwbGFjZSgvJmx0Oy9nICAsICc8JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mZ3Q7L2cgICwgJz4nKVxuICAgICAgICAgICAgLnJlcGxhY2UoLyYjMCozOTsvZyAsIFwiJ1wiKVxuICAgICAgICAgICAgLnJlcGxhY2UoLyZxdW90Oy9nLCAnXCInKTtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHVuZXNjYXBlSHRtbDtcblxuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG4gICAgLyoqXG4gICAgICogUmVwbGFjZXMgaHlwaGVucyB3aXRoIHNwYWNlcy4gKG9ubHkgaHlwaGVucyBiZXR3ZWVuIHdvcmQgY2hhcnMpXG4gICAgICovXG4gICAgZnVuY3Rpb24gdW5oeXBoZW5hdGUoc3RyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oXFx3KSgtKShcXHcpL2csICckMSAkMycpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHVuaHlwaGVuYXRlO1xuXG4iLCJ2YXIga2luZE9mID0gcmVxdWlyZSgnLi9raW5kT2YnKTtcbnZhciBpc1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnLi9pc1BsYWluT2JqZWN0Jyk7XG52YXIgbWl4SW4gPSByZXF1aXJlKCcuLi9vYmplY3QvbWl4SW4nKTtcblxuICAgIC8qKlxuICAgICAqIENsb25lIG5hdGl2ZSB0eXBlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZSh2YWwpe1xuICAgICAgICBzd2l0Y2ggKGtpbmRPZih2YWwpKSB7XG4gICAgICAgICAgICBjYXNlICdPYmplY3QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZU9iamVjdCh2YWwpO1xuICAgICAgICAgICAgY2FzZSAnQXJyYXknOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZUFycmF5KHZhbCk7XG4gICAgICAgICAgICBjYXNlICdSZWdFeHAnOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZVJlZ0V4cCh2YWwpO1xuICAgICAgICAgICAgY2FzZSAnRGF0ZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lRGF0ZSh2YWwpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVPYmplY3Qoc291cmNlKSB7XG4gICAgICAgIGlmIChpc1BsYWluT2JqZWN0KHNvdXJjZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBtaXhJbih7fSwgc291cmNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZVJlZ0V4cChyKSB7XG4gICAgICAgIHZhciBmbGFncyA9ICcnO1xuICAgICAgICBmbGFncyArPSByLm11bHRpbGluZSA/ICdtJyA6ICcnO1xuICAgICAgICBmbGFncyArPSByLmdsb2JhbCA/ICdnJyA6ICcnO1xuICAgICAgICBmbGFncyArPSByLmlnbm9yZWNhc2UgPyAnaScgOiAnJztcbiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoci5zb3VyY2UsIGZsYWdzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZURhdGUoZGF0ZSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoK2RhdGUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lQXJyYXkoYXJyKSB7XG4gICAgICAgIHJldHVybiBhcnIuc2xpY2UoKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNsb25lO1xuXG5cbiIsIlwidXNlIHN0cmljdFwiO1xuXG4vLyBjcmVkaXRzIHRvIEBjcG9qZXIncyBDbGFzcy5CaW5kcywgcmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4vLyBodHRwczovL2dpdGh1Yi5jb20vY3BvamVyL21vb3Rvb2xzLWNsYXNzLWV4dHJhcy9ibG9iL21hc3Rlci9Tb3VyY2UvQ2xhc3MuQmluZHMuanNcblxudmFyIHByaW1lID0gcmVxdWlyZShcInByaW1lXCIpXG52YXIgYmluZCA9IHJlcXVpcmUoXCJtb3V0L2Z1bmN0aW9uL2JpbmRcIilcblxudmFyIGJvdW5kID0gcHJpbWUoe1xuXG4gICAgYm91bmQ6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICB2YXIgYm91bmQgPSB0aGlzLl9ib3VuZCB8fCAodGhpcy5fYm91bmQgPSB7fSlcbiAgICAgICAgcmV0dXJuIGJvdW5kW25hbWVdIHx8IChib3VuZFtuYW1lXSA9IGJpbmQodGhpc1tuYW1lXSwgdGhpcykpXG4gICAgfVxuXG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9IGJvdW5kXG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHByaW1lID0gcmVxdWlyZShcInByaW1lXCIpXG52YXIgbWVyZ2UgPSByZXF1aXJlKFwibW91dC9vYmplY3QvbWVyZ2VcIilcblxudmFyIE9wdGlvbnMgPSBwcmltZSh7XG5cbiAgICBzZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBbe30sIHRoaXMub3B0aW9uc11cbiAgICAgICAgYXJncy5wdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cylcbiAgICAgICAgdGhpcy5vcHRpb25zID0gbWVyZ2UuYXBwbHkobnVsbCwgYXJncylcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gT3B0aW9uc1xuIiwiLypcclxuZGVmZXJcclxuKi9cInVzZSBzdHJpY3RcIlxyXG5cclxudmFyIGtpbmRPZiAgPSByZXF1aXJlKFwibW91dC9sYW5nL2tpbmRPZlwiKSxcclxuICAgIG5vdyAgICAgPSByZXF1aXJlKFwibW91dC90aW1lL25vd1wiKSxcclxuICAgIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpLFxyXG4gICAgaW5kZXhPZiA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2luZGV4T2ZcIilcclxuXHJcbnZhciBjYWxsYmFja3MgPSB7XHJcbiAgICB0aW1lb3V0OiB7fSxcclxuICAgIGZyYW1lOiBbXSxcclxuICAgIGltbWVkaWF0ZTogW11cclxufVxyXG5cclxudmFyIHB1c2ggPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBjYWxsYmFjaywgY29udGV4dCwgZGVmZXIpe1xyXG5cclxuICAgIHZhciBpdGVyYXRvciA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaXRlcmF0ZShjb2xsZWN0aW9uKVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghY29sbGVjdGlvbi5sZW5ndGgpIGRlZmVyKGl0ZXJhdG9yKVxyXG5cclxuICAgIHZhciBlbnRyeSA9IHtcclxuICAgICAgICBjYWxsYmFjazogY2FsbGJhY2ssXHJcbiAgICAgICAgY29udGV4dDogY29udGV4dFxyXG4gICAgfVxyXG5cclxuICAgIGNvbGxlY3Rpb24ucHVzaChlbnRyeSlcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgaW8gPSBpbmRleE9mKGNvbGxlY3Rpb24sIGVudHJ5KVxyXG4gICAgICAgIGlmIChpbyA+IC0xKSBjb2xsZWN0aW9uLnNwbGljZShpbywgMSlcclxuICAgIH1cclxufVxyXG5cclxudmFyIGl0ZXJhdGUgPSBmdW5jdGlvbihjb2xsZWN0aW9uKXtcclxuICAgIHZhciB0aW1lID0gbm93KClcclxuXHJcbiAgICBmb3JFYWNoKGNvbGxlY3Rpb24uc3BsaWNlKDApLCBmdW5jdGlvbihlbnRyeSkge1xyXG4gICAgICAgIGVudHJ5LmNhbGxiYWNrLmNhbGwoZW50cnkuY29udGV4dCwgdGltZSlcclxuICAgIH0pXHJcbn1cclxuXHJcbnZhciBkZWZlciA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBhcmd1bWVudCwgY29udGV4dCl7XHJcbiAgICByZXR1cm4gKGtpbmRPZihhcmd1bWVudCkgPT09IFwiTnVtYmVyXCIpID8gZGVmZXIudGltZW91dChjYWxsYmFjaywgYXJndW1lbnQsIGNvbnRleHQpIDogZGVmZXIuaW1tZWRpYXRlKGNhbGxiYWNrLCBhcmd1bWVudClcclxufVxyXG5cclxuaWYgKGdsb2JhbC5wcm9jZXNzICYmIHByb2Nlc3MubmV4dFRpY2spe1xyXG5cclxuICAgIGRlZmVyLmltbWVkaWF0ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KXtcclxuICAgICAgICByZXR1cm4gcHVzaChjYWxsYmFja3MuaW1tZWRpYXRlLCBjYWxsYmFjaywgY29udGV4dCwgcHJvY2Vzcy5uZXh0VGljaylcclxuICAgIH1cclxuXHJcbn0gZWxzZSBpZiAoZ2xvYmFsLnNldEltbWVkaWF0ZSl7XHJcblxyXG4gICAgZGVmZXIuaW1tZWRpYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvbnRleHQpe1xyXG4gICAgICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5pbW1lZGlhdGUsIGNhbGxiYWNrLCBjb250ZXh0LCBzZXRJbW1lZGlhdGUpXHJcbiAgICB9XHJcblxyXG59IGVsc2UgaWYgKGdsb2JhbC5wb3N0TWVzc2FnZSAmJiBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcil7XHJcblxyXG4gICAgYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgIGlmIChldmVudC5zb3VyY2UgPT09IGdsb2JhbCAmJiBldmVudC5kYXRhID09PSBcIkBkZWZlcnJlZFwiKXtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgICAgICAgICAgaXRlcmF0ZShjYWxsYmFja3MuaW1tZWRpYXRlKVxyXG4gICAgICAgIH1cclxuICAgIH0sIHRydWUpXHJcblxyXG4gICAgZGVmZXIuaW1tZWRpYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvbnRleHQpe1xyXG4gICAgICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5pbW1lZGlhdGUsIGNhbGxiYWNrLCBjb250ZXh0LCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBwb3N0TWVzc2FnZShcIkBkZWZlcnJlZFwiLCBcIipcIilcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxufSBlbHNlIHtcclxuXHJcbiAgICBkZWZlci5pbW1lZGlhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgY29udGV4dCl7XHJcbiAgICAgICAgcmV0dXJuIHB1c2goY2FsbGJhY2tzLmltbWVkaWF0ZSwgY2FsbGJhY2ssIGNvbnRleHQsIGZ1bmN0aW9uKGl0ZXJhdG9yKXtcclxuICAgICAgICAgICAgc2V0VGltZW91dChpdGVyYXRvciwgMClcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxudmFyIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGdsb2JhbC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgIGdsb2JhbC53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgIGdsb2JhbC5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgIGdsb2JhbC5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XHJcbiAgICBnbG9iYWwubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgc2V0VGltZW91dChjYWxsYmFjaywgMWUzIC8gNjApXHJcbiAgICB9XHJcblxyXG5kZWZlci5mcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KXtcclxuICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5mcmFtZSwgY2FsbGJhY2ssIGNvbnRleHQsIHJlcXVlc3RBbmltYXRpb25GcmFtZSlcclxufVxyXG5cclxudmFyIGNsZWFyXHJcblxyXG5kZWZlci50aW1lb3V0ID0gZnVuY3Rpb24oY2FsbGJhY2ssIG1zLCBjb250ZXh0KXtcclxuICAgIHZhciBjdCA9IGNhbGxiYWNrcy50aW1lb3V0XHJcblxyXG4gICAgaWYgKCFjbGVhcikgY2xlYXIgPSBkZWZlci5pbW1lZGlhdGUoZnVuY3Rpb24oKXtcclxuICAgICAgICBjbGVhciA9IG51bGxcclxuICAgICAgICBjYWxsYmFja3MudGltZW91dCA9IHt9XHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiBwdXNoKGN0W21zXSB8fCAoY3RbbXNdID0gW10pLCBjYWxsYmFjaywgY29udGV4dCwgZnVuY3Rpb24oaXRlcmF0b3Ipe1xyXG4gICAgICAgIHNldFRpbWVvdXQoaXRlcmF0b3IsIG1zKVxyXG4gICAgfSlcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBkZWZlclxyXG4iLCIvKlxyXG5FbWl0dGVyXHJcbiovXCJ1c2Ugc3RyaWN0XCJcclxuXHJcbnZhciBpbmRleE9mID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvaW5kZXhPZlwiKSxcclxuICAgIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpXHJcblxyXG52YXIgcHJpbWUgPSByZXF1aXJlKFwiLi9pbmRleFwiKSxcclxuICAgIGRlZmVyID0gcmVxdWlyZShcIi4vZGVmZXJcIilcclxuXHJcbnZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcclxuXHJcbnZhciBFbWl0dGVyID0gcHJpbWUoe1xyXG5cclxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihzdG9wcGFibGUpe1xyXG4gICAgICAgIHRoaXMuX3N0b3BwYWJsZSA9IHN0b3BwYWJsZVxyXG4gICAgfSxcclxuXHJcbiAgICBvbjogZnVuY3Rpb24oZXZlbnQsIGZuKXtcclxuICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzIHx8ICh0aGlzLl9saXN0ZW5lcnMgPSB7fSksXHJcbiAgICAgICAgICAgIGV2ZW50cyA9IGxpc3RlbmVyc1tldmVudF0gfHwgKGxpc3RlbmVyc1tldmVudF0gPSBbXSlcclxuXHJcbiAgICAgICAgaWYgKGluZGV4T2YoZXZlbnRzLCBmbikgPT09IC0xKSBldmVudHMucHVzaChmbilcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgIH0sXHJcblxyXG4gICAgb2ZmOiBmdW5jdGlvbihldmVudCwgZm4pe1xyXG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnMsIGV2ZW50c1xyXG4gICAgICAgIGlmIChsaXN0ZW5lcnMgJiYgKGV2ZW50cyA9IGxpc3RlbmVyc1tldmVudF0pKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbyA9IGluZGV4T2YoZXZlbnRzLCBmbilcclxuICAgICAgICAgICAgaWYgKGlvID4gLTEpIGV2ZW50cy5zcGxpY2UoaW8sIDEpXHJcbiAgICAgICAgICAgIGlmICghZXZlbnRzLmxlbmd0aCkgZGVsZXRlIGxpc3RlbmVyc1tldmVudF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGwgaW4gbGlzdGVuZXJzKSByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fbGlzdGVuZXJzXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzXHJcbiAgICB9LFxyXG5cclxuICAgIGVtaXQ6IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXMsXHJcbiAgICAgICAgICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSlcclxuXHJcbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gc2VsZi5fbGlzdGVuZXJzLCBldmVudHNcclxuICAgICAgICAgICAgaWYgKGxpc3RlbmVycyAmJiAoZXZlbnRzID0gbGlzdGVuZXJzW2V2ZW50XSkpe1xyXG4gICAgICAgICAgICAgICAgZm9yRWFjaChldmVudHMuc2xpY2UoMCksIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZXZlbnQuYXBwbHkoc2VsZiwgYXJncylcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5fc3RvcHBhYmxlKSByZXR1cm4gcmVzdWx0XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBFbWl0dGVyLkVNSVRfU1lOQyl7XHJcbiAgICAgICAgICAgIGFyZ3MucG9wKClcclxuICAgICAgICAgICAgZW1pdCgpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGVmZXIoZW1pdClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzXHJcbiAgICB9XHJcblxyXG59KVxyXG5cclxuRW1pdHRlci5FTUlUX1NZTkMgPSB7fVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBFbWl0dGVyXHJcbiIsIi8qXHJcbnByaW1lXHJcbiAtIHByb3RvdHlwYWwgaW5oZXJpdGFuY2VcclxuKi9cInVzZSBzdHJpY3RcIlxyXG5cclxudmFyIGhhc093biA9IHJlcXVpcmUoXCJtb3V0L29iamVjdC9oYXNPd25cIiksXHJcbiAgICBtaXhJbiAgPSByZXF1aXJlKFwibW91dC9vYmplY3QvbWl4SW5cIiksXHJcbiAgICBjcmVhdGUgPSByZXF1aXJlKFwibW91dC9sYW5nL2NyZWF0ZU9iamVjdFwiKSxcclxuICAgIGtpbmRPZiA9IHJlcXVpcmUoXCJtb3V0L2xhbmcva2luZE9mXCIpXHJcblxyXG52YXIgaGFzRGVzY3JpcHRvcnMgPSB0cnVlXHJcblxyXG50cnkge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCBcIn5cIiwge30pXHJcbiAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHt9LCBcIn5cIilcclxufSBjYXRjaCAoZSl7XHJcbiAgICBoYXNEZXNjcmlwdG9ycyA9IGZhbHNlXHJcbn1cclxuXHJcbi8vIHdlIG9ubHkgbmVlZCB0byBiZSBhYmxlIHRvIGltcGxlbWVudCBcInRvU3RyaW5nXCIgYW5kIFwidmFsdWVPZlwiIGluIElFIDwgOVxyXG52YXIgaGFzRW51bUJ1ZyA9ICEoe3ZhbHVlT2Y6IDB9KS5wcm9wZXJ0eUlzRW51bWVyYWJsZShcInZhbHVlT2ZcIiksXHJcbiAgICBidWdneSAgICAgID0gW1widG9TdHJpbmdcIiwgXCJ2YWx1ZU9mXCJdXHJcblxyXG52YXIgdmVyYnMgPSAvXmNvbnN0cnVjdG9yfGluaGVyaXRzfG1peGluJC9cclxuXHJcbnZhciBpbXBsZW1lbnQgPSBmdW5jdGlvbihwcm90byl7XHJcbiAgICB2YXIgcHJvdG90eXBlID0gdGhpcy5wcm90b3R5cGVcclxuXHJcbiAgICBmb3IgKHZhciBrZXkgaW4gcHJvdG8pe1xyXG4gICAgICAgIGlmIChrZXkubWF0Y2godmVyYnMpKSBjb250aW51ZVxyXG4gICAgICAgIGlmIChoYXNEZXNjcmlwdG9ycyl7XHJcbiAgICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihwcm90bywga2V5KVxyXG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRvcil7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCBrZXksIGRlc2NyaXB0b3IpXHJcbiAgICAgICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RvdHlwZVtrZXldID0gcHJvdG9ba2V5XVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChoYXNFbnVtQnVnKSBmb3IgKHZhciBpID0gMDsgKGtleSA9IGJ1Z2d5W2ldKTsgaSsrKXtcclxuICAgICAgICB2YXIgdmFsdWUgPSBwcm90b1trZXldXHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSBPYmplY3QucHJvdG90eXBlW2tleV0pIHByb3RvdHlwZVtrZXldID0gdmFsdWVcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpc1xyXG59XHJcblxyXG52YXIgcHJpbWUgPSBmdW5jdGlvbihwcm90byl7XHJcblxyXG4gICAgaWYgKGtpbmRPZihwcm90bykgPT09IFwiRnVuY3Rpb25cIikgcHJvdG8gPSB7Y29uc3RydWN0b3I6IHByb3RvfVxyXG5cclxuICAgIHZhciBzdXBlcnByaW1lID0gcHJvdG8uaW5oZXJpdHNcclxuXHJcbiAgICAvLyBpZiBvdXIgbmljZSBwcm90byBvYmplY3QgaGFzIG5vIG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eVxyXG4gICAgLy8gdGhlbiB3ZSBwcm9jZWVkIHVzaW5nIGEgZ2hvc3RpbmcgY29uc3RydWN0b3IgdGhhdCBhbGwgaXQgZG9lcyBpc1xyXG4gICAgLy8gY2FsbCB0aGUgcGFyZW50J3MgY29uc3RydWN0b3IgaWYgaXQgaGFzIGEgc3VwZXJwcmltZSwgZWxzZSBhbiBlbXB0eSBjb25zdHJ1Y3RvclxyXG4gICAgLy8gcHJvdG8uY29uc3RydWN0b3IgYmVjb21lcyB0aGUgZWZmZWN0aXZlIGNvbnN0cnVjdG9yXHJcbiAgICB2YXIgY29uc3RydWN0b3IgPSAoaGFzT3duKHByb3RvLCBcImNvbnN0cnVjdG9yXCIpKSA/IHByb3RvLmNvbnN0cnVjdG9yIDogKHN1cGVycHJpbWUpID8gZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gc3VwZXJwcmltZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpXHJcbiAgICB9IDogZnVuY3Rpb24oKXt9XHJcblxyXG4gICAgaWYgKHN1cGVycHJpbWUpe1xyXG5cclxuICAgICAgICBtaXhJbihjb25zdHJ1Y3Rvciwgc3VwZXJwcmltZSlcclxuXHJcbiAgICAgICAgdmFyIHN1cGVycHJvdG8gPSBzdXBlcnByaW1lLnByb3RvdHlwZVxyXG4gICAgICAgIC8vIGluaGVyaXQgZnJvbSBzdXBlcnByaW1lXHJcbiAgICAgICAgdmFyIGNwcm90byA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGNyZWF0ZShzdXBlcnByb3RvKVxyXG5cclxuICAgICAgICAvLyBzZXR0aW5nIGNvbnN0cnVjdG9yLnBhcmVudCB0byBzdXBlcnByaW1lLnByb3RvdHlwZVxyXG4gICAgICAgIC8vIGJlY2F1c2UgaXQncyB0aGUgc2hvcnRlc3QgcG9zc2libGUgYWJzb2x1dGUgcmVmZXJlbmNlXHJcbiAgICAgICAgY29uc3RydWN0b3IucGFyZW50ID0gc3VwZXJwcm90b1xyXG4gICAgICAgIGNwcm90by5jb25zdHJ1Y3RvciA9IGNvbnN0cnVjdG9yXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFjb25zdHJ1Y3Rvci5pbXBsZW1lbnQpIGNvbnN0cnVjdG9yLmltcGxlbWVudCA9IGltcGxlbWVudFxyXG5cclxuICAgIHZhciBtaXhpbnMgPSBwcm90by5taXhpblxyXG4gICAgaWYgKG1peGlucyl7XHJcbiAgICAgICAgaWYgKGtpbmRPZihtaXhpbnMpICE9PSBcIkFycmF5XCIpIG1peGlucyA9IFttaXhpbnNdXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtaXhpbnMubGVuZ3RoOyBpKyspIGNvbnN0cnVjdG9yLmltcGxlbWVudChjcmVhdGUobWl4aW5zW2ldLnByb3RvdHlwZSkpXHJcbiAgICB9XHJcblxyXG4gICAgLy8gaW1wbGVtZW50IHByb3RvIGFuZCByZXR1cm4gY29uc3RydWN0b3JcclxuICAgIHJldHVybiBjb25zdHJ1Y3Rvci5pbXBsZW1lbnQocHJvdG8pXHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHByaW1lXHJcbiIsIi8qXHJcbk1hcFxyXG4qL1widXNlIHN0cmljdFwiXHJcblxyXG52YXIgaW5kZXhPZiA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2luZGV4T2ZcIilcclxuXHJcbnZhciBwcmltZSA9IHJlcXVpcmUoXCIuL2luZGV4XCIpXHJcblxyXG52YXIgTWFwID0gcHJpbWUoe1xyXG5cclxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBNYXAoKXtcclxuICAgICAgICB0aGlzLmxlbmd0aCA9IDBcclxuICAgICAgICB0aGlzLl92YWx1ZXMgPSBbXVxyXG4gICAgICAgIHRoaXMuX2tleXMgPSBbXVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpe1xyXG4gICAgICAgIHZhciBpbmRleCA9IGluZGV4T2YodGhpcy5fa2V5cywga2V5KVxyXG5cclxuICAgICAgICBpZiAoaW5kZXggPT09IC0xKXtcclxuICAgICAgICAgICAgdGhpcy5fa2V5cy5wdXNoKGtleSlcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWVzLnB1c2godmFsdWUpXHJcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoKytcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl92YWx1ZXNbaW5kZXhdID0gdmFsdWVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzXHJcbiAgICB9LFxyXG5cclxuICAgIGdldDogZnVuY3Rpb24oa2V5KXtcclxuICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKHRoaXMuX2tleXMsIGtleSlcclxuICAgICAgICByZXR1cm4gKGluZGV4ID09PSAtMSkgPyBudWxsIDogdGhpcy5fdmFsdWVzW2luZGV4XVxyXG4gICAgfSxcclxuXHJcbiAgICBjb3VudDogZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGhcclxuICAgIH0sXHJcblxyXG4gICAgZm9yRWFjaDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKXtcclxuICAgICAgICAgICAgaWYgKG1ldGhvZC5jYWxsKGNvbnRleHQsIHRoaXMuX3ZhbHVlc1tpXSwgdGhpcy5fa2V5c1tpXSwgdGhpcykgPT09IGZhbHNlKSBicmVha1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgfSxcclxuXHJcbiAgICBtYXA6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XHJcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBuZXcgTWFwXHJcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xyXG4gICAgICAgICAgICByZXN1bHRzLnNldChrZXksIG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHRoaXMpKVxyXG4gICAgICAgIH0sIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcclxuICAgIH0sXHJcblxyXG4gICAgZmlsdGVyOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xyXG4gICAgICAgIHZhciByZXN1bHRzID0gbmV3IE1hcFxyXG4gICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KXtcclxuICAgICAgICAgICAgaWYgKG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHRoaXMpKSByZXN1bHRzLnNldChrZXksIHZhbHVlKVxyXG4gICAgICAgIH0sIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcclxuICAgIH0sXHJcblxyXG4gICAgZXZlcnk6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XHJcbiAgICAgICAgdmFyIGV2ZXJ5ID0gdHJ1ZVxyXG4gICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KXtcclxuICAgICAgICAgICAgaWYgKCFtZXRob2QuY2FsbChjb250ZXh0LCB2YWx1ZSwga2V5LCB0aGlzKSkgcmV0dXJuIChldmVyeSA9IGZhbHNlKVxyXG4gICAgICAgIH0sIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIGV2ZXJ5XHJcbiAgICB9LFxyXG5cclxuICAgIHNvbWU6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XHJcbiAgICAgICAgdmFyIHNvbWUgPSBmYWxzZVxyXG4gICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KXtcclxuICAgICAgICAgICAgaWYgKG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHRoaXMpKSByZXR1cm4gIShzb21lID0gdHJ1ZSlcclxuICAgICAgICB9LCB0aGlzKVxyXG4gICAgICAgIHJldHVybiBzb21lXHJcbiAgICB9LFxyXG5cclxuICAgIGluZGV4T2Y6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKHRoaXMuX3ZhbHVlcywgdmFsdWUpXHJcbiAgICAgICAgcmV0dXJuIChpbmRleCA+IC0xKSA/IHRoaXMuX2tleXNbaW5kZXhdIDogbnVsbFxyXG4gICAgfSxcclxuXHJcbiAgICByZW1vdmU6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKHRoaXMuX3ZhbHVlcywgdmFsdWUpXHJcblxyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpe1xyXG4gICAgICAgICAgICB0aGlzLl92YWx1ZXMuc3BsaWNlKGluZGV4LCAxKVxyXG4gICAgICAgICAgICB0aGlzLmxlbmd0aC0tXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9rZXlzLnNwbGljZShpbmRleCwgMSlbMF1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICB9LFxyXG5cclxuICAgIHVuc2V0OiBmdW5jdGlvbihrZXkpe1xyXG4gICAgICAgIHZhciBpbmRleCA9IGluZGV4T2YodGhpcy5fa2V5cywga2V5KVxyXG5cclxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKXtcclxuICAgICAgICAgICAgdGhpcy5fa2V5cy5zcGxpY2UoaW5kZXgsIDEpXHJcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoLS1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpWzBdXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgfSxcclxuXHJcbiAgICBrZXlzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9rZXlzLnNsaWNlKClcclxuICAgIH0sXHJcblxyXG4gICAgdmFsdWVzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZXMuc2xpY2UoKVxyXG4gICAgfVxyXG5cclxufSlcclxuXHJcbnZhciBtYXAgPSBmdW5jdGlvbigpe1xyXG4gICAgcmV0dXJuIG5ldyBNYXBcclxufVxyXG5cclxubWFwLnByb3RvdHlwZSA9IE1hcC5wcm90b3R5cGVcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbWFwXHJcbiIsIi8qKlxuICogc2lmdGVyLmpzXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMgQnJpYW4gUmVhdmlzICYgY29udHJpYnV0b3JzXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXNcbiAqIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0OlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlclxuICogdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRlxuICogQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlXG4gKiBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICpcbiAqIEBhdXRob3IgQnJpYW4gUmVhdmlzIDxicmlhbkB0aGlyZHJvdXRlLmNvbT5cbiAqL1xuXG4oZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG5cdFx0ZGVmaW5lKGZhY3RvcnkpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHR9IGVsc2Uge1xuXHRcdHJvb3QuU2lmdGVyID0gZmFjdG9yeSgpO1xuXHR9XG59KHRoaXMsIGZ1bmN0aW9uKCkge1xuXG5cdC8qKlxuXHQgKiBUZXh0dWFsbHkgc2VhcmNoZXMgYXJyYXlzIGFuZCBoYXNoZXMgb2Ygb2JqZWN0c1xuXHQgKiBieSBwcm9wZXJ0eSAob3IgbXVsdGlwbGUgcHJvcGVydGllcykuIERlc2lnbmVkXG5cdCAqIHNwZWNpZmljYWxseSBmb3IgYXV0b2NvbXBsZXRlLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQHBhcmFtIHthcnJheXxvYmplY3R9IGl0ZW1zXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtc1xuXHQgKi9cblx0dmFyIFNpZnRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBzZXR0aW5ncykge1xuXHRcdHRoaXMuaXRlbXMgPSBpdGVtcztcblx0XHR0aGlzLnNldHRpbmdzID0gc2V0dGluZ3MgfHwge2RpYWNyaXRpY3M6IHRydWV9O1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBTcGxpdHMgYSBzZWFyY2ggc3RyaW5nIGludG8gYW4gYXJyYXkgb2YgaW5kaXZpZHVhbFxuXHQgKiByZWdleHBzIHRvIGJlIHVzZWQgdG8gbWF0Y2ggcmVzdWx0cy5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5XG5cdCAqIEByZXR1cm5zIHthcnJheX1cblx0ICovXG5cdFNpZnRlci5wcm90b3R5cGUudG9rZW5pemUgPSBmdW5jdGlvbihxdWVyeSkge1xuXHRcdHF1ZXJ5ID0gdHJpbShTdHJpbmcocXVlcnkgfHwgJycpLnRvTG93ZXJDYXNlKCkpO1xuXHRcdGlmICghcXVlcnkgfHwgIXF1ZXJ5Lmxlbmd0aCkgcmV0dXJuIFtdO1xuXG5cdFx0dmFyIGksIG4sIHJlZ2V4LCBsZXR0ZXI7XG5cdFx0dmFyIHRva2VucyA9IFtdO1xuXHRcdHZhciB3b3JkcyA9IHF1ZXJ5LnNwbGl0KC8gKy8pO1xuXG5cdFx0Zm9yIChpID0gMCwgbiA9IHdvcmRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0cmVnZXggPSBlc2NhcGVfcmVnZXgod29yZHNbaV0pO1xuXHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MuZGlhY3JpdGljcykge1xuXHRcdFx0XHRmb3IgKGxldHRlciBpbiBESUFDUklUSUNTKSB7XG5cdFx0XHRcdFx0aWYgKERJQUNSSVRJQ1MuaGFzT3duUHJvcGVydHkobGV0dGVyKSkge1xuXHRcdFx0XHRcdFx0cmVnZXggPSByZWdleC5yZXBsYWNlKG5ldyBSZWdFeHAobGV0dGVyLCAnZycpLCBESUFDUklUSUNTW2xldHRlcl0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0dG9rZW5zLnB1c2goe1xuXHRcdFx0XHRzdHJpbmcgOiB3b3Jkc1tpXSxcblx0XHRcdFx0cmVnZXggIDogbmV3IFJlZ0V4cChyZWdleCwgJ2knKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRva2Vucztcblx0fTtcblxuXHQvKipcblx0ICogSXRlcmF0ZXMgb3ZlciBhcnJheXMgYW5kIGhhc2hlcy5cblx0ICpcblx0ICogYGBgXG5cdCAqIHRoaXMuaXRlcmF0b3IodGhpcy5pdGVtcywgZnVuY3Rpb24oaXRlbSwgaWQpIHtcblx0ICogICAgLy8gaW52b2tlZCBmb3IgZWFjaCBpdGVtXG5cdCAqIH0pO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIHthcnJheXxvYmplY3R9IG9iamVjdFxuXHQgKi9cblx0U2lmdGVyLnByb3RvdHlwZS5pdGVyYXRvciA9IGZ1bmN0aW9uKG9iamVjdCwgY2FsbGJhY2spIHtcblx0XHR2YXIgaXRlcmF0b3I7XG5cdFx0aWYgKGlzX2FycmF5KG9iamVjdCkpIHtcblx0XHRcdGl0ZXJhdG9yID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2ggfHwgZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRcdGNhbGxiYWNrKHRoaXNbaV0sIGksIHRoaXMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpdGVyYXRvciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiB0aGlzKSB7XG5cdFx0XHRcdFx0aWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sodGhpc1trZXldLCBrZXksIHRoaXMpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRpdGVyYXRvci5hcHBseShvYmplY3QsIFtjYWxsYmFja10pO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gYmUgdXNlZCB0byBzY29yZSBpbmRpdmlkdWFsIHJlc3VsdHMuXG5cdCAqXG5cdCAqIEdvb2QgbWF0Y2hlcyB3aWxsIGhhdmUgYSBoaWdoZXIgc2NvcmUgdGhhbiBwb29yIG1hdGNoZXMuXG5cdCAqIElmIGFuIGl0ZW0gaXMgbm90IGEgbWF0Y2gsIDAgd2lsbCBiZSByZXR1cm5lZCBieSB0aGUgZnVuY3Rpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSB7b2JqZWN0fHN0cmluZ30gc2VhcmNoXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIChvcHRpb25hbClcblx0ICogQHJldHVybnMge2Z1bmN0aW9ufVxuXHQgKi9cblx0U2lmdGVyLnByb3RvdHlwZS5nZXRTY29yZUZ1bmN0aW9uID0gZnVuY3Rpb24oc2VhcmNoLCBvcHRpb25zKSB7XG5cdFx0dmFyIHNlbGYsIGZpZWxkcywgdG9rZW5zLCB0b2tlbl9jb3VudCwgbmVzdGluZztcblxuXHRcdHNlbGYgICAgICAgID0gdGhpcztcblx0XHRzZWFyY2ggICAgICA9IHNlbGYucHJlcGFyZVNlYXJjaChzZWFyY2gsIG9wdGlvbnMpO1xuXHRcdHRva2VucyAgICAgID0gc2VhcmNoLnRva2Vucztcblx0XHRmaWVsZHMgICAgICA9IHNlYXJjaC5vcHRpb25zLmZpZWxkcztcblx0XHR0b2tlbl9jb3VudCA9IHRva2Vucy5sZW5ndGg7XG5cdFx0bmVzdGluZyAgICAgPSBzZWFyY2gub3B0aW9ucy5uZXN0aW5nO1xuXG5cdFx0LyoqXG5cdFx0ICogQ2FsY3VsYXRlcyBob3cgY2xvc2Ugb2YgYSBtYXRjaCB0aGVcblx0XHQgKiBnaXZlbiB2YWx1ZSBpcyBhZ2FpbnN0IGEgc2VhcmNoIHRva2VuLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHttaXhlZH0gdmFsdWVcblx0XHQgKiBAcGFyYW0ge29iamVjdH0gdG9rZW5cblx0XHQgKiBAcmV0dXJuIHtudW1iZXJ9XG5cdFx0ICovXG5cdFx0dmFyIHNjb3JlVmFsdWUgPSBmdW5jdGlvbih2YWx1ZSwgdG9rZW4pIHtcblx0XHRcdHZhciBzY29yZSwgcG9zO1xuXG5cdFx0XHRpZiAoIXZhbHVlKSByZXR1cm4gMDtcblx0XHRcdHZhbHVlID0gU3RyaW5nKHZhbHVlIHx8ICcnKTtcblx0XHRcdHBvcyA9IHZhbHVlLnNlYXJjaCh0b2tlbi5yZWdleCk7XG5cdFx0XHRpZiAocG9zID09PSAtMSkgcmV0dXJuIDA7XG5cdFx0XHRzY29yZSA9IHRva2VuLnN0cmluZy5sZW5ndGggLyB2YWx1ZS5sZW5ndGg7XG5cdFx0XHRpZiAocG9zID09PSAwKSBzY29yZSArPSAwLjU7XG5cdFx0XHRyZXR1cm4gc2NvcmU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENhbGN1bGF0ZXMgdGhlIHNjb3JlIG9mIGFuIG9iamVjdFxuXHRcdCAqIGFnYWluc3QgdGhlIHNlYXJjaCBxdWVyeS5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlblxuXHRcdCAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG5cdFx0ICogQHJldHVybiB7bnVtYmVyfVxuXHRcdCAqL1xuXHRcdHZhciBzY29yZU9iamVjdCA9IChmdW5jdGlvbigpIHtcblx0XHRcdHZhciBmaWVsZF9jb3VudCA9IGZpZWxkcy5sZW5ndGg7XG5cdFx0XHRpZiAoIWZpZWxkX2NvdW50KSB7XG5cdFx0XHRcdHJldHVybiBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG5cdFx0XHR9XG5cdFx0XHRpZiAoZmllbGRfY291bnQgPT09IDEpIHtcblx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBkYXRhKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHNjb3JlVmFsdWUoZ2V0YXR0cihkYXRhLCBmaWVsZHNbMF0sIG5lc3RpbmcpLCB0b2tlbik7XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24odG9rZW4sIGRhdGEpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIHN1bSA9IDA7IGkgPCBmaWVsZF9jb3VudDsgaSsrKSB7XG5cdFx0XHRcdFx0c3VtICs9IHNjb3JlVmFsdWUoZ2V0YXR0cihkYXRhLCBmaWVsZHNbaV0sIG5lc3RpbmcpLCB0b2tlbik7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHN1bSAvIGZpZWxkX2NvdW50O1xuXHRcdFx0fTtcblx0XHR9KSgpO1xuXG5cdFx0aWYgKCF0b2tlbl9jb3VudCkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcblx0XHR9XG5cdFx0aWYgKHRva2VuX2NvdW50ID09PSAxKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0XHRyZXR1cm4gc2NvcmVPYmplY3QodG9rZW5zWzBdLCBkYXRhKTtcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0aWYgKHNlYXJjaC5vcHRpb25zLmNvbmp1bmN0aW9uID09PSAnYW5kJykge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0dmFyIHNjb3JlO1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMCwgc3VtID0gMDsgaSA8IHRva2VuX2NvdW50OyBpKyspIHtcblx0XHRcdFx0XHRzY29yZSA9IHNjb3JlT2JqZWN0KHRva2Vuc1tpXSwgZGF0YSk7XG5cdFx0XHRcdFx0aWYgKHNjb3JlIDw9IDApIHJldHVybiAwO1xuXHRcdFx0XHRcdHN1bSArPSBzY29yZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gc3VtIC8gdG9rZW5fY291bnQ7XG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMCwgc3VtID0gMDsgaSA8IHRva2VuX2NvdW50OyBpKyspIHtcblx0XHRcdFx0XHRzdW0gKz0gc2NvcmVPYmplY3QodG9rZW5zW2ldLCBkYXRhKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gc3VtIC8gdG9rZW5fY291bnQ7XG5cdFx0XHR9O1xuXHRcdH1cblx0fTtcblxuXHQvKipcblx0ICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tcGFyZSB0d29cblx0ICogcmVzdWx0cywgZm9yIHNvcnRpbmcgcHVycG9zZXMuIElmIG5vIHNvcnRpbmcgc2hvdWxkXG5cdCAqIGJlIHBlcmZvcm1lZCwgYG51bGxgIHdpbGwgYmUgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gc2VhcmNoXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zXG5cdCAqIEByZXR1cm4gZnVuY3Rpb24oYSxiKVxuXHQgKi9cblx0U2lmdGVyLnByb3RvdHlwZS5nZXRTb3J0RnVuY3Rpb24gPSBmdW5jdGlvbihzZWFyY2gsIG9wdGlvbnMpIHtcblx0XHR2YXIgaSwgbiwgc2VsZiwgZmllbGQsIGZpZWxkcywgZmllbGRzX2NvdW50LCBtdWx0aXBsaWVyLCBtdWx0aXBsaWVycywgZ2V0X2ZpZWxkLCBpbXBsaWNpdF9zY29yZSwgc29ydDtcblxuXHRcdHNlbGYgICA9IHRoaXM7XG5cdFx0c2VhcmNoID0gc2VsZi5wcmVwYXJlU2VhcmNoKHNlYXJjaCwgb3B0aW9ucyk7XG5cdFx0c29ydCAgID0gKCFzZWFyY2gucXVlcnkgJiYgb3B0aW9ucy5zb3J0X2VtcHR5KSB8fCBvcHRpb25zLnNvcnQ7XG5cblx0XHQvKipcblx0XHQgKiBGZXRjaGVzIHRoZSBzcGVjaWZpZWQgc29ydCBmaWVsZCB2YWx1ZVxuXHRcdCAqIGZyb20gYSBzZWFyY2ggcmVzdWx0IGl0ZW0uXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIHtzdHJpbmd9IG5hbWVcblx0XHQgKiBAcGFyYW0gIHtvYmplY3R9IHJlc3VsdFxuXHRcdCAqIEByZXR1cm4ge21peGVkfVxuXHRcdCAqL1xuXHRcdGdldF9maWVsZCA9IGZ1bmN0aW9uKG5hbWUsIHJlc3VsdCkge1xuXHRcdFx0aWYgKG5hbWUgPT09ICckc2NvcmUnKSByZXR1cm4gcmVzdWx0LnNjb3JlO1xuXHRcdFx0cmV0dXJuIGdldGF0dHIoc2VsZi5pdGVtc1tyZXN1bHQuaWRdLCBuYW1lLCBvcHRpb25zLm5lc3RpbmcpO1xuXHRcdH07XG5cblx0XHQvLyBwYXJzZSBvcHRpb25zXG5cdFx0ZmllbGRzID0gW107XG5cdFx0aWYgKHNvcnQpIHtcblx0XHRcdGZvciAoaSA9IDAsIG4gPSBzb3J0Lmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRpZiAoc2VhcmNoLnF1ZXJ5IHx8IHNvcnRbaV0uZmllbGQgIT09ICckc2NvcmUnKSB7XG5cdFx0XHRcdFx0ZmllbGRzLnB1c2goc29ydFtpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyB0aGUgXCIkc2NvcmVcIiBmaWVsZCBpcyBpbXBsaWVkIHRvIGJlIHRoZSBwcmltYXJ5XG5cdFx0Ly8gc29ydCBmaWVsZCwgdW5sZXNzIGl0J3MgbWFudWFsbHkgc3BlY2lmaWVkXG5cdFx0aWYgKHNlYXJjaC5xdWVyeSkge1xuXHRcdFx0aW1wbGljaXRfc2NvcmUgPSB0cnVlO1xuXHRcdFx0Zm9yIChpID0gMCwgbiA9IGZpZWxkcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcblx0XHRcdFx0aWYgKGZpZWxkc1tpXS5maWVsZCA9PT0gJyRzY29yZScpIHtcblx0XHRcdFx0XHRpbXBsaWNpdF9zY29yZSA9IGZhbHNlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRpZiAoaW1wbGljaXRfc2NvcmUpIHtcblx0XHRcdFx0ZmllbGRzLnVuc2hpZnQoe2ZpZWxkOiAnJHNjb3JlJywgZGlyZWN0aW9uOiAnZGVzYyd9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9yIChpID0gMCwgbiA9IGZpZWxkcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcblx0XHRcdFx0aWYgKGZpZWxkc1tpXS5maWVsZCA9PT0gJyRzY29yZScpIHtcblx0XHRcdFx0XHRmaWVsZHMuc3BsaWNlKGksIDEpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0bXVsdGlwbGllcnMgPSBbXTtcblx0XHRmb3IgKGkgPSAwLCBuID0gZmllbGRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0bXVsdGlwbGllcnMucHVzaChmaWVsZHNbaV0uZGlyZWN0aW9uID09PSAnZGVzYycgPyAtMSA6IDEpO1xuXHRcdH1cblxuXHRcdC8vIGJ1aWxkIGZ1bmN0aW9uXG5cdFx0ZmllbGRzX2NvdW50ID0gZmllbGRzLmxlbmd0aDtcblx0XHRpZiAoIWZpZWxkc19jb3VudCkge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSBlbHNlIGlmIChmaWVsZHNfY291bnQgPT09IDEpIHtcblx0XHRcdGZpZWxkID0gZmllbGRzWzBdLmZpZWxkO1xuXHRcdFx0bXVsdGlwbGllciA9IG11bHRpcGxpZXJzWzBdO1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdFx0cmV0dXJuIG11bHRpcGxpZXIgKiBjbXAoXG5cdFx0XHRcdFx0Z2V0X2ZpZWxkKGZpZWxkLCBhKSxcblx0XHRcdFx0XHRnZXRfZmllbGQoZmllbGQsIGIpXG5cdFx0XHRcdCk7XG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHR2YXIgaSwgcmVzdWx0LCBhX3ZhbHVlLCBiX3ZhbHVlLCBmaWVsZDtcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGZpZWxkc19jb3VudDsgaSsrKSB7XG5cdFx0XHRcdFx0ZmllbGQgPSBmaWVsZHNbaV0uZmllbGQ7XG5cdFx0XHRcdFx0cmVzdWx0ID0gbXVsdGlwbGllcnNbaV0gKiBjbXAoXG5cdFx0XHRcdFx0XHRnZXRfZmllbGQoZmllbGQsIGEpLFxuXHRcdFx0XHRcdFx0Z2V0X2ZpZWxkKGZpZWxkLCBiKVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0aWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdH07XG5cdFx0fVxuXHR9O1xuXG5cdC8qKlxuXHQgKiBQYXJzZXMgYSBzZWFyY2ggcXVlcnkgYW5kIHJldHVybnMgYW4gb2JqZWN0XG5cdCAqIHdpdGggdG9rZW5zIGFuZCBmaWVsZHMgcmVhZHkgdG8gYmUgcG9wdWxhdGVkXG5cdCAqIHdpdGggcmVzdWx0cy5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5XG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zXG5cdCAqIEByZXR1cm5zIHtvYmplY3R9XG5cdCAqL1xuXHRTaWZ0ZXIucHJvdG90eXBlLnByZXBhcmVTZWFyY2ggPSBmdW5jdGlvbihxdWVyeSwgb3B0aW9ucykge1xuXHRcdGlmICh0eXBlb2YgcXVlcnkgPT09ICdvYmplY3QnKSByZXR1cm4gcXVlcnk7XG5cblx0XHRvcHRpb25zID0gZXh0ZW5kKHt9LCBvcHRpb25zKTtcblxuXHRcdHZhciBvcHRpb25fZmllbGRzICAgICA9IG9wdGlvbnMuZmllbGRzO1xuXHRcdHZhciBvcHRpb25fc29ydCAgICAgICA9IG9wdGlvbnMuc29ydDtcblx0XHR2YXIgb3B0aW9uX3NvcnRfZW1wdHkgPSBvcHRpb25zLnNvcnRfZW1wdHk7XG5cblx0XHRpZiAob3B0aW9uX2ZpZWxkcyAmJiAhaXNfYXJyYXkob3B0aW9uX2ZpZWxkcykpIG9wdGlvbnMuZmllbGRzID0gW29wdGlvbl9maWVsZHNdO1xuXHRcdGlmIChvcHRpb25fc29ydCAmJiAhaXNfYXJyYXkob3B0aW9uX3NvcnQpKSBvcHRpb25zLnNvcnQgPSBbb3B0aW9uX3NvcnRdO1xuXHRcdGlmIChvcHRpb25fc29ydF9lbXB0eSAmJiAhaXNfYXJyYXkob3B0aW9uX3NvcnRfZW1wdHkpKSBvcHRpb25zLnNvcnRfZW1wdHkgPSBbb3B0aW9uX3NvcnRfZW1wdHldO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdG9wdGlvbnMgOiBvcHRpb25zLFxuXHRcdFx0cXVlcnkgICA6IFN0cmluZyhxdWVyeSB8fCAnJykudG9Mb3dlckNhc2UoKSxcblx0XHRcdHRva2VucyAgOiB0aGlzLnRva2VuaXplKHF1ZXJ5KSxcblx0XHRcdHRvdGFsICAgOiAwLFxuXHRcdFx0aXRlbXMgICA6IFtdXG5cdFx0fTtcblx0fTtcblxuXHQvKipcblx0ICogU2VhcmNoZXMgdGhyb3VnaCBhbGwgaXRlbXMgYW5kIHJldHVybnMgYSBzb3J0ZWQgYXJyYXkgb2YgbWF0Y2hlcy5cblx0ICpcblx0ICogVGhlIGBvcHRpb25zYCBwYXJhbWV0ZXIgY2FuIGNvbnRhaW46XG5cdCAqXG5cdCAqICAgLSBmaWVsZHMge3N0cmluZ3xhcnJheX1cblx0ICogICAtIHNvcnQge2FycmF5fVxuXHQgKiAgIC0gc2NvcmUge2Z1bmN0aW9ufVxuXHQgKiAgIC0gZmlsdGVyIHtib29sfVxuXHQgKiAgIC0gbGltaXQge2ludGVnZXJ9XG5cdCAqXG5cdCAqIFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmc6XG5cdCAqXG5cdCAqICAgLSBvcHRpb25zIHtvYmplY3R9XG5cdCAqICAgLSBxdWVyeSB7c3RyaW5nfVxuXHQgKiAgIC0gdG9rZW5zIHthcnJheX1cblx0ICogICAtIHRvdGFsIHtpbnR9XG5cdCAqICAgLSBpdGVtcyB7YXJyYXl9XG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVxuXHQgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9uc1xuXHQgKiBAcmV0dXJucyB7b2JqZWN0fVxuXHQgKi9cblx0U2lmdGVyLnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbihxdWVyeSwgb3B0aW9ucykge1xuXHRcdHZhciBzZWxmID0gdGhpcywgdmFsdWUsIHNjb3JlLCBzZWFyY2gsIGNhbGN1bGF0ZVNjb3JlO1xuXHRcdHZhciBmbl9zb3J0O1xuXHRcdHZhciBmbl9zY29yZTtcblxuXHRcdHNlYXJjaCAgPSB0aGlzLnByZXBhcmVTZWFyY2gocXVlcnksIG9wdGlvbnMpO1xuXHRcdG9wdGlvbnMgPSBzZWFyY2gub3B0aW9ucztcblx0XHRxdWVyeSAgID0gc2VhcmNoLnF1ZXJ5O1xuXG5cdFx0Ly8gZ2VuZXJhdGUgcmVzdWx0IHNjb3JpbmcgZnVuY3Rpb25cblx0XHRmbl9zY29yZSA9IG9wdGlvbnMuc2NvcmUgfHwgc2VsZi5nZXRTY29yZUZ1bmN0aW9uKHNlYXJjaCk7XG5cblx0XHQvLyBwZXJmb3JtIHNlYXJjaCBhbmQgc29ydFxuXHRcdGlmIChxdWVyeS5sZW5ndGgpIHtcblx0XHRcdHNlbGYuaXRlcmF0b3Ioc2VsZi5pdGVtcywgZnVuY3Rpb24oaXRlbSwgaWQpIHtcblx0XHRcdFx0c2NvcmUgPSBmbl9zY29yZShpdGVtKTtcblx0XHRcdFx0aWYgKG9wdGlvbnMuZmlsdGVyID09PSBmYWxzZSB8fCBzY29yZSA+IDApIHtcblx0XHRcdFx0XHRzZWFyY2guaXRlbXMucHVzaCh7J3Njb3JlJzogc2NvcmUsICdpZCc6IGlkfSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZWxmLml0ZXJhdG9yKHNlbGYuaXRlbXMsIGZ1bmN0aW9uKGl0ZW0sIGlkKSB7XG5cdFx0XHRcdHNlYXJjaC5pdGVtcy5wdXNoKHsnc2NvcmUnOiAxLCAnaWQnOiBpZH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Zm5fc29ydCA9IHNlbGYuZ2V0U29ydEZ1bmN0aW9uKHNlYXJjaCwgb3B0aW9ucyk7XG5cdFx0aWYgKGZuX3NvcnQpIHNlYXJjaC5pdGVtcy5zb3J0KGZuX3NvcnQpO1xuXG5cdFx0Ly8gYXBwbHkgbGltaXRzXG5cdFx0c2VhcmNoLnRvdGFsID0gc2VhcmNoLml0ZW1zLmxlbmd0aDtcblx0XHRpZiAodHlwZW9mIG9wdGlvbnMubGltaXQgPT09ICdudW1iZXInKSB7XG5cdFx0XHRzZWFyY2guaXRlbXMgPSBzZWFyY2guaXRlbXMuc2xpY2UoMCwgb3B0aW9ucy5saW1pdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlYXJjaDtcblx0fTtcblxuXHQvLyB1dGlsaXRpZXNcblx0Ly8gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLVxuXG5cdHZhciBjbXAgPSBmdW5jdGlvbihhLCBiKSB7XG5cdFx0aWYgKHR5cGVvZiBhID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgYiA9PT0gJ251bWJlcicpIHtcblx0XHRcdHJldHVybiBhID4gYiA/IDEgOiAoYSA8IGIgPyAtMSA6IDApO1xuXHRcdH1cblx0XHRhID0gYXNjaWlmb2xkKFN0cmluZyhhIHx8ICcnKSk7XG5cdFx0YiA9IGFzY2lpZm9sZChTdHJpbmcoYiB8fCAnJykpO1xuXHRcdGlmIChhID4gYikgcmV0dXJuIDE7XG5cdFx0aWYgKGIgPiBhKSByZXR1cm4gLTE7XG5cdFx0cmV0dXJuIDA7XG5cdH07XG5cblx0dmFyIGV4dGVuZCA9IGZ1bmN0aW9uKGEsIGIpIHtcblx0XHR2YXIgaSwgbiwgaywgb2JqZWN0O1xuXHRcdGZvciAoaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRvYmplY3QgPSBhcmd1bWVudHNbaV07XG5cdFx0XHRpZiAoIW9iamVjdCkgY29udGludWU7XG5cdFx0XHRmb3IgKGsgaW4gb2JqZWN0KSB7XG5cdFx0XHRcdGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkoaykpIHtcblx0XHRcdFx0XHRhW2tdID0gb2JqZWN0W2tdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBhO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBBIHByb3BlcnR5IGdldHRlciByZXNvbHZpbmcgZG90LW5vdGF0aW9uXG5cdCAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAgICAgVGhlIHJvb3Qgb2JqZWN0IHRvIGZldGNoIHByb3BlcnR5IG9uXG5cdCAqIEBwYXJhbSAge1N0cmluZ30gIG5hbWUgICAgVGhlIG9wdGlvbmFsbHkgZG90dGVkIHByb3BlcnR5IG5hbWUgdG8gZmV0Y2hcblx0ICogQHBhcmFtICB7Qm9vbGVhbn0gbmVzdGluZyBIYW5kbGUgbmVzdGluZyBvciBub3Rcblx0ICogQHJldHVybiB7T2JqZWN0fSAgICAgICAgICBUaGUgcmVzb2x2ZWQgcHJvcGVydHkgdmFsdWVcblx0ICovXG5cdHZhciBnZXRhdHRyID0gZnVuY3Rpb24ob2JqLCBuYW1lLCBuZXN0aW5nKSB7XG5cdCAgICBpZiAoIW9iaiB8fCAhbmFtZSkgcmV0dXJuO1xuXHQgICAgaWYgKCFuZXN0aW5nKSByZXR1cm4gb2JqW25hbWVdO1xuXHQgICAgdmFyIG5hbWVzID0gbmFtZS5zcGxpdChcIi5cIik7XG5cdCAgICB3aGlsZShuYW1lcy5sZW5ndGggJiYgKG9iaiA9IG9ialtuYW1lcy5zaGlmdCgpXSkpO1xuXHQgICAgcmV0dXJuIG9iajtcblx0fTtcblxuXHR2YXIgdHJpbSA9IGZ1bmN0aW9uKHN0cikge1xuXHRcdHJldHVybiAoc3RyICsgJycpLnJlcGxhY2UoL15cXHMrfFxccyskfC9nLCAnJyk7XG5cdH07XG5cblx0dmFyIGVzY2FwZV9yZWdleCA9IGZ1bmN0aW9uKHN0cikge1xuXHRcdHJldHVybiAoc3RyICsgJycpLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9fC1dKS9nLCAnXFxcXCQxJyk7XG5cdH07XG5cblx0dmFyIGlzX2FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCAodHlwZW9mICQgIT09ICd1bmRlZmluZWQnICYmICQuaXNBcnJheSkgfHwgZnVuY3Rpb24ob2JqZWN0KSB7XG5cdFx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpID09PSAnW29iamVjdCBBcnJheV0nO1xuXHR9O1xuXG5cdHZhciBESUFDUklUSUNTID0ge1xuXHRcdCdhJzogJ1th4biA4biBxILEg8OCw6LHjceOyLrisaXIpsin4bqg4bqhw4TDpMOAw6DDgcOhxIDEgcODw6PDhcOlxIXEhMODxIXEhF0nLFxuXHRcdCdiJzogJ1ti4pCizrLOkkLguL/wkIyB4ZuSXScsXG5cdFx0J2MnOiAnW2PEhsSHxIjEicSMxI3EisSLQ8yEY8yEw4fDp+G4iOG4ici7yLzGh8aIyZXhtITvvKPvvYNdJyxcblx0XHQnZCc6ICdbZMSOxI/huIrhuIvhuJDhuJHhuIzhuI3huJLhuJPhuI7huI/EkMSRRMymZMymxonJlsaKyZfGi8aM4bWt4baB4baRyKHhtIXvvKTvvYTDsF0nLFxuXHRcdCdlJzogJ1tlw4nDqcOIw6jDisOq4biY4biZxJrEm8SUxJXhurzhur3huJrhuJvhurrhurvElsSXw4vDq8SSxJPIqMipxJjEmeG2ksmGyYfIhMiF4bq+4bq/4buA4buB4buE4buF4buC4buD4bic4bid4biW4biX4biU4biVyIbIh+G6uOG6ueG7huG7h+KxuOG0h++8pe+9hcmYx53Gj8aQzrVdJyxcblx0XHQnZic6ICdbZsaRxpLhuJ7huJ9dJyxcblx0XHQnZyc6ICdbZ8mi4oKyx6THpcScxJ3EnsSfxKLEo8aTyaDEoMShXScsXG5cdFx0J2gnOiAnW2jEpMSlxKbEp+G4qOG4qeG6luG6luG4pOG4peG4ouG4o8mmyrDHtsaVXScsXG5cdFx0J2knOiAnW2nDjcOtw4zDrMSsxK3DjsOux4/HkMOPw6/huK7huK/EqMSpxK7Er8SqxKvhu4jhu4nIiMiJyIrIi+G7iuG7i+G4rOG4rcaXyajJqMyG4bW74baWxLBpScSxyarvvKnvvYldJyxcblx0XHQnaic6ICdbasi3xLTEtcmIyYnKncmfyrJdJyxcblx0XHQnayc6ICdba8aYxpnqnYDqnYHhuLDhuLHHqMep4biy4biz4bi04bi1zrrPsOKCrV0nLFxuXHRcdCdsJzogJ1tsxYHFgsS9xL7Eu8S8xLnEuuG4tuG4t+G4uOG4ueG4vOG4veG4uuG4u8S/xYDIvcaa4rGg4rGh4rGiyavJrOG2hcmtyLTKn++8rO+9jF0nLFxuXHRcdCduJzogJ1tuxYPFhMe4x7nFh8WIw5HDseG5hOG5hcWFxYbhuYbhuYfhuYrhuYvhuYjhuYlOzIhuzIjGncmyyKDGnuG1sOG2h8mzyLXJtO+8ru+9jsWKxYtdJyxcblx0XHQnbyc6ICdbb8OYw7jDlsO2w5PDs8OSw7LDlMO0x5HHksWQxZHFjsWPyK7Ir+G7jOG7jcafybXGoMah4buO4buPxYzFjcOVw7XHqseryIzIjdWV1oVdJyxcblx0XHQncCc6ICdbcOG5lOG5leG5luG5l+Kxo+G1vcakxqXhtbFdJyxcblx0XHQncSc6ICdbceqdluqdl8qgyYrJi+qdmOqdmXHMg10nLFxuXHRcdCdyJzogJ1tyxZTFlcmMyY3FmMWZxZbFl+G5mOG5mciQyJHIksiT4bma4bmb4rGkyb1dJyxcblx0XHQncyc6ICdbc8WaxZvhuaDhuaHhuaLhuaPqnqjqnqnFnMWdxaDFocWexZ/ImMiZU8yIc8yIXScsXG5cdFx0J3QnOiAnW3TFpMWl4bmq4bmrxaLFo+G5rOG5rcauyojImsib4bmw4bmx4bmu4bmvxqzGrV0nLFxuXHRcdCd1JzogJ1t1xazFrcmEyonhu6Thu6XDnMO8w5rDusOZw7nDm8O7x5PHlMWwxbHFrMWtxq/GsOG7puG7p8WqxavFqMWpxbLFs8iUyJXiiKpdJyxcblx0XHQndic6ICdbduG5vOG5veG5vuG5v8ayyovqnZ7qnZ/isbHKi10nLFxuXHRcdCd3JzogJ1t34bqC4bqD4bqA4bqBxbTFteG6hOG6heG6huG6h+G6iOG6iV0nLFxuXHRcdCd4JzogJ1t44bqM4bqN4bqK4bqLz4ddJyxcblx0XHQneSc6ICdbecOdw73hu7Lhu7PFtsW3xbjDv+G7uOG7ueG6juG6j+G7tOG7tcmOyY/Gs8a0XScsXG5cdFx0J3onOiAnW3rFucW64bqQ4bqRxb3FvsW7xbzhupLhupPhupThupXGtca2XSdcblx0fTtcblxuXHR2YXIgYXNjaWlmb2xkID0gKGZ1bmN0aW9uKCkge1xuXHRcdHZhciBpLCBuLCBrLCBjaHVuaztcblx0XHR2YXIgZm9yZWlnbmxldHRlcnMgPSAnJztcblx0XHR2YXIgbG9va3VwID0ge307XG5cdFx0Zm9yIChrIGluIERJQUNSSVRJQ1MpIHtcblx0XHRcdGlmIChESUFDUklUSUNTLmhhc093blByb3BlcnR5KGspKSB7XG5cdFx0XHRcdGNodW5rID0gRElBQ1JJVElDU1trXS5zdWJzdHJpbmcoMiwgRElBQ1JJVElDU1trXS5sZW5ndGggLSAxKTtcblx0XHRcdFx0Zm9yZWlnbmxldHRlcnMgKz0gY2h1bms7XG5cdFx0XHRcdGZvciAoaSA9IDAsIG4gPSBjaHVuay5sZW5ndGg7IGkgPCBuOyBpKyspIHtcblx0XHRcdFx0XHRsb29rdXBbY2h1bmsuY2hhckF0KGkpXSA9IGs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0dmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ1snICsgIGZvcmVpZ25sZXR0ZXJzICsgJ10nLCAnZycpO1xuXHRcdHJldHVybiBmdW5jdGlvbihzdHIpIHtcblx0XHRcdHJldHVybiBzdHIucmVwbGFjZShyZWdleHAsIGZ1bmN0aW9uKGZvcmVpZ25sZXR0ZXIpIHtcblx0XHRcdFx0cmV0dXJuIGxvb2t1cFtmb3JlaWdubGV0dGVyXTtcblx0XHRcdH0pLnRvTG93ZXJDYXNlKCk7XG5cdFx0fTtcblx0fSkoKTtcblxuXG5cdC8vIGV4cG9ydFxuXHQvLyAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtXG5cblx0cmV0dXJuIFNpZnRlcjtcbn0pKTtcblxuIiwiLypcclxuU2xpY2sgRmluZGVyXHJcbiovXCJ1c2Ugc3RyaWN0XCJcclxuXHJcbi8vIE5vdGFibGUgY2hhbmdlcyBmcm9tIFNsaWNrLkZpbmRlciAxLjAueFxyXG5cclxuLy8gZmFzdGVyIGJvdHRvbSAtPiB1cCBleHByZXNzaW9uIG1hdGNoaW5nXHJcbi8vIHByZWZlcnMgbWVudGFsIHNhbml0eSBvdmVyICpvYnNlc3NpdmUgY29tcHVsc2l2ZSogbWlsbGlzZWNvbmRzIHNhdmluZ3NcclxuLy8gdXNlcyBwcm90b3R5cGVzIGluc3RlYWQgb2Ygb2JqZWN0c1xyXG4vLyB0cmllcyB0byB1c2UgbWF0Y2hlc1NlbGVjdG9yIHNtYXJ0bHksIHdoZW5ldmVyIGF2YWlsYWJsZVxyXG4vLyBjYW4gcG9wdWxhdGUgb2JqZWN0cyBhcyB3ZWxsIGFzIGFycmF5c1xyXG4vLyBsb3RzIG9mIHN0dWZmIGlzIGJyb2tlbiBvciBub3QgaW1wbGVtZW50ZWRcclxuXHJcbnZhciBwYXJzZSA9IHJlcXVpcmUoXCIuL3BhcnNlclwiKVxyXG5cclxuLy8gdXRpbGl0aWVzXHJcblxyXG52YXIgaW5kZXggPSAwLFxyXG4gICAgY291bnRlciA9IGRvY3VtZW50Ll9fY291bnRlciA9IChwYXJzZUludChkb2N1bWVudC5fX2NvdW50ZXIgfHwgLTEsIDM2KSArIDEpLnRvU3RyaW5nKDM2KSxcclxuICAgIGtleSA9IFwidWlkOlwiICsgY291bnRlclxyXG5cclxudmFyIHVuaXF1ZUlEID0gZnVuY3Rpb24obiwgeG1sKXtcclxuICAgIGlmIChuID09PSB3aW5kb3cpIHJldHVybiBcIndpbmRvd1wiXHJcbiAgICBpZiAobiA9PT0gZG9jdW1lbnQpIHJldHVybiBcImRvY3VtZW50XCJcclxuICAgIGlmIChuID09PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHJldHVybiBcImh0bWxcIlxyXG5cclxuICAgIGlmICh4bWwpIHtcclxuICAgICAgICB2YXIgdWlkID0gbi5nZXRBdHRyaWJ1dGUoa2V5KVxyXG4gICAgICAgIGlmICghdWlkKSB7XHJcbiAgICAgICAgICAgIHVpZCA9IChpbmRleCsrKS50b1N0cmluZygzNilcclxuICAgICAgICAgICAgbi5zZXRBdHRyaWJ1dGUoa2V5LCB1aWQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1aWRcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG5ba2V5XSB8fCAobltrZXldID0gKGluZGV4KyspLnRvU3RyaW5nKDM2KSlcclxuICAgIH1cclxufVxyXG5cclxudmFyIHVuaXF1ZUlEWE1MID0gZnVuY3Rpb24obikge1xyXG4gICAgcmV0dXJuIHVuaXF1ZUlEKG4sIHRydWUpXHJcbn1cclxuXHJcbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihvYmplY3Qpe1xyXG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpID09PSBcIltvYmplY3QgQXJyYXldXCJcclxufVxyXG5cclxuLy8gdGVzdHNcclxuXHJcbnZhciB1bmlxdWVJbmRleCA9IDA7XHJcblxyXG52YXIgSEFTID0ge1xyXG5cclxuICAgIEdFVF9FTEVNRU5UX0JZX0lEOiBmdW5jdGlvbih0ZXN0LCBpZCl7XHJcbiAgICAgICAgaWQgPSBcInNsaWNrX1wiICsgKHVuaXF1ZUluZGV4KyspO1xyXG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIGdldEVsZW1lbnRCeUlkLCBhbmQgaXQgd29ya3NcclxuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBpZD1cIicgKyBpZCArICdcIj48L2E+J1xyXG4gICAgICAgIHJldHVybiAhIXRoaXMuZ2V0RWxlbWVudEJ5SWQoaWQpXHJcbiAgICB9LFxyXG5cclxuICAgIFFVRVJZX1NFTEVDVE9SOiBmdW5jdGlvbih0ZXN0KXtcclxuICAgICAgICAvLyB0aGlzIHN1cHBvc2VkbHkgZml4ZXMgYSB3ZWJraXQgYnVnIHdpdGggbWF0Y2hlc1NlbGVjdG9yIC8gcXVlcnlTZWxlY3RvciAmIG50aC1jaGlsZFxyXG4gICAgICAgIHRlc3QuaW5uZXJIVE1MID0gJ188c3R5bGU+Om50aC1jaGlsZCgyKXt9PC9zdHlsZT4nXHJcblxyXG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIHF1ZXJ5U2VsZWN0b3JBbGwsIGFuZCBpdCB3b3Jrc1xyXG4gICAgICAgIHRlc3QuaW5uZXJIVE1MID0gJzxhIGNsYXNzPVwiTWlYXCI+PC9hPidcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlc3QucXVlcnlTZWxlY3RvckFsbCgnLk1pWCcpLmxlbmd0aCA9PT0gMVxyXG4gICAgfSxcclxuXHJcbiAgICBFWFBBTkRPUzogZnVuY3Rpb24odGVzdCwgaWQpe1xyXG4gICAgICAgIGlkID0gXCJzbGlja19cIiArICh1bmlxdWVJbmRleCsrKTtcclxuICAgICAgICAvLyBjaGVja3MgaWYgdGhlIGRvY3VtZW50IGhhcyBlbGVtZW50cyB0aGF0IHN1cHBvcnQgZXhwYW5kb3NcclxuICAgICAgICB0ZXN0Ll9jdXN0b21fcHJvcGVydHlfID0gaWRcclxuICAgICAgICByZXR1cm4gdGVzdC5fY3VzdG9tX3Byb3BlcnR5XyA9PT0gaWRcclxuICAgIH0sXHJcblxyXG4gICAgLy8gVE9ETzogdXNlIHRoaXMgP1xyXG5cclxuICAgIC8vIENIRUNLRURfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xyXG4gICAgLy9cclxuICAgIC8vICAgICAvLyBjaGVja3MgaWYgdGhlIGRvY3VtZW50IHN1cHBvcnRzIHRoZSBjaGVja2VkIHF1ZXJ5IHNlbGVjdG9yXHJcbiAgICAvLyAgICAgdGVzdC5pbm5lckhUTUwgPSAnPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj5hPC9vcHRpb24+PC9zZWxlY3Q+J1xyXG4gICAgLy8gICAgIHJldHVybiB0ZXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJzpjaGVja2VkJykubGVuZ3RoID09PSAxXHJcbiAgICAvLyB9LFxyXG5cclxuICAgIC8vIFRPRE86IHVzZSB0aGlzID9cclxuXHJcbiAgICAvLyBFTVBUWV9BVFRSSUJVVEVfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xyXG4gICAgLy9cclxuICAgIC8vICAgICAvLyBjaGVja3MgaWYgdGhlIGRvY3VtZW50IHN1cHBvcnRzIHRoZSBlbXB0eSBhdHRyaWJ1dGUgcXVlcnkgc2VsZWN0b3JcclxuICAgIC8vICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cIlwiPjwvYT4nXHJcbiAgICAvLyAgICAgcmV0dXJuIHRlc3QucXVlcnlTZWxlY3RvckFsbCgnW2NsYXNzKj1cIlwiXScpLmxlbmd0aCA9PT0gMVxyXG4gICAgLy8gfSxcclxuXHJcbiAgICBNQVRDSEVTX1NFTEVDVE9SOiBmdW5jdGlvbih0ZXN0KXtcclxuXHJcbiAgICAgICAgdGVzdC5jbGFzc05hbWUgPSBcIk1pWFwiXHJcblxyXG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIG1hdGNoZXNTZWxlY3RvciwgYW5kIHdlIGNhbiB1c2UgaXQuXHJcblxyXG4gICAgICAgIHZhciBtYXRjaGVzID0gdGVzdC5tYXRjaGVzU2VsZWN0b3IgfHwgdGVzdC5tb3pNYXRjaGVzU2VsZWN0b3IgfHwgdGVzdC53ZWJraXRNYXRjaGVzU2VsZWN0b3JcclxuXHJcbiAgICAgICAgLy8gaWYgbWF0Y2hlc1NlbGVjdG9yIHRyb3dzIGVycm9ycyBvbiBpbmNvcnJlY3Qgc3ludGF4IHdlIGNhbiB1c2UgaXRcclxuICAgICAgICBpZiAobWF0Y2hlcykgdHJ5IHtcclxuICAgICAgICAgICAgbWF0Y2hlcy5jYWxsKHRlc3QsICc6c2xpY2snKVxyXG4gICAgICAgIH0gY2F0Y2goZSl7XHJcbiAgICAgICAgICAgIC8vIGp1c3QgYXMgYSBzYWZldHkgcHJlY2F1dGlvbiwgYWxzbyB0ZXN0IGlmIGl0IHdvcmtzIG9uIG1peGVkY2FzZSAobGlrZSBxdWVyeVNlbGVjdG9yQWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlcy5jYWxsKHRlc3QsIFwiLk1pWFwiKSA/IG1hdGNoZXMgOiBmYWxzZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9LFxyXG5cclxuICAgIEdFVF9FTEVNRU5UU19CWV9DTEFTU19OQU1FOiBmdW5jdGlvbih0ZXN0KXtcclxuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cImZcIj48L2E+PGEgY2xhc3M9XCJiXCI+PC9hPidcclxuICAgICAgICBpZiAodGVzdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdiJykubGVuZ3RoICE9PSAxKSByZXR1cm4gZmFsc2VcclxuXHJcbiAgICAgICAgdGVzdC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICdiJ1xyXG4gICAgICAgIGlmICh0ZXN0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2InKS5sZW5ndGggIT09IDIpIHJldHVybiBmYWxzZVxyXG5cclxuICAgICAgICAvLyBPcGVyYSA5LjYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBkb2VzbnQgZGV0ZWN0cyB0aGUgY2xhc3MgaWYgaXRzIG5vdCB0aGUgZmlyc3Qgb25lXHJcbiAgICAgICAgdGVzdC5pbm5lckhUTUwgPSAnPGEgY2xhc3M9XCJhXCI+PC9hPjxhIGNsYXNzPVwiZiBiIGFcIj48L2E+J1xyXG4gICAgICAgIGlmICh0ZXN0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2EnKS5sZW5ndGggIT09IDIpIHJldHVybiBmYWxzZVxyXG5cclxuICAgICAgICAvLyB0ZXN0cyBwYXNzZWRcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBubyBuZWVkIHRvIGtub3dcclxuXHJcbiAgICAvLyBHRVRfRUxFTUVOVF9CWV9JRF9OT1RfTkFNRTogZnVuY3Rpb24odGVzdCwgaWQpe1xyXG4gICAgLy8gICAgIHRlc3QuaW5uZXJIVE1MID0gJzxhIG5hbWU9XCInKyBpZCArJ1wiPjwvYT48YiBpZD1cIicrIGlkICsnXCI+PC9iPidcclxuICAgIC8vICAgICByZXR1cm4gdGhpcy5nZXRFbGVtZW50QnlJZChpZCkgIT09IHRlc3QuZmlyc3RDaGlsZFxyXG4gICAgLy8gfSxcclxuXHJcbiAgICAvLyB0aGlzIGlzIGFsd2F5cyBjaGVja2VkIGZvciBhbmQgZml4ZWRcclxuXHJcbiAgICAvLyBTVEFSX0dFVF9FTEVNRU5UU19CWV9UQUdfTkFNRTogZnVuY3Rpb24odGVzdCl7XHJcbiAgICAvL1xyXG4gICAgLy8gICAgIC8vIElFIHJldHVybnMgY29tbWVudCBub2RlcyBmb3IgZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKSBmb3Igc29tZSBkb2N1bWVudHNcclxuICAgIC8vICAgICB0ZXN0LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlQ29tbWVudCgnJykpXHJcbiAgICAvLyAgICAgaWYgKHRlc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKS5sZW5ndGggPiAwKSByZXR1cm4gZmFsc2VcclxuICAgIC8vXHJcbiAgICAvLyAgICAgLy8gSUUgcmV0dXJucyBjbG9zZWQgbm9kZXMgKEVHOlwiPC9mb28+XCIpIGZvciBnZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpIGZvciBzb21lIGRvY3VtZW50c1xyXG4gICAgLy8gICAgIHRlc3QuaW5uZXJIVE1MID0gJ2ZvbzwvZm9vPidcclxuICAgIC8vICAgICBpZiAodGVzdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpLmxlbmd0aCkgcmV0dXJuIGZhbHNlXHJcbiAgICAvL1xyXG4gICAgLy8gICAgIC8vIHRlc3RzIHBhc3NlZFxyXG4gICAgLy8gICAgIHJldHVybiB0cnVlXHJcbiAgICAvLyB9LFxyXG5cclxuICAgIC8vIHRoaXMgaXMgYWx3YXlzIGNoZWNrZWQgZm9yIGFuZCBmaXhlZFxyXG5cclxuICAgIC8vIFNUQVJfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xyXG4gICAgLy9cclxuICAgIC8vICAgICAvLyByZXR1cm5zIGNsb3NlZCBub2RlcyAoRUc6XCI8L2Zvbz5cIikgZm9yIHF1ZXJ5U2VsZWN0b3IoJyonKSBmb3Igc29tZSBkb2N1bWVudHNcclxuICAgIC8vICAgICB0ZXN0LmlubmVySFRNTCA9ICdmb288L2Zvbz4nXHJcbiAgICAvLyAgICAgcmV0dXJuICEhKHRlc3QucXVlcnlTZWxlY3RvckFsbCgnKicpLmxlbmd0aClcclxuICAgIC8vIH0sXHJcblxyXG4gICAgR0VUX0FUVFJJQlVURTogZnVuY3Rpb24odGVzdCl7XHJcbiAgICAgICAgLy8gdGVzdHMgZm9yIHdvcmtpbmcgZ2V0QXR0cmlidXRlIGltcGxlbWVudGF0aW9uXHJcbiAgICAgICAgdmFyIHNob3V0ID0gXCJmdXMgcm8gZGFoXCJcclxuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cIicgKyBzaG91dCArICdcIj48L2E+J1xyXG4gICAgICAgIHJldHVybiB0ZXN0LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdjbGFzcycpID09PSBzaG91dFxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuLy8gRmluZGVyXHJcblxyXG52YXIgRmluZGVyID0gZnVuY3Rpb24gRmluZGVyKGRvY3VtZW50KXtcclxuXHJcbiAgICB0aGlzLmRvY3VtZW50ICAgICAgICA9IGRvY3VtZW50XHJcbiAgICB2YXIgcm9vdCA9IHRoaXMucm9vdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxyXG4gICAgdGhpcy50ZXN0ZWQgICAgICAgICAgPSB7fVxyXG5cclxuICAgIC8vIHVuaXF1ZUlEXHJcblxyXG4gICAgdGhpcy51bmlxdWVJRCA9IHRoaXMuaGFzKFwiRVhQQU5ET1NcIikgPyB1bmlxdWVJRCA6IHVuaXF1ZUlEWE1MXHJcblxyXG4gICAgLy8gZ2V0QXR0cmlidXRlXHJcblxyXG4gICAgdGhpcy5nZXRBdHRyaWJ1dGUgPSAodGhpcy5oYXMoXCJHRVRfQVRUUklCVVRFXCIpKSA/IGZ1bmN0aW9uKG5vZGUsIG5hbWUpe1xyXG5cclxuICAgICAgICByZXR1cm4gbm9kZS5nZXRBdHRyaWJ1dGUobmFtZSlcclxuXHJcbiAgICB9IDogZnVuY3Rpb24obm9kZSwgbmFtZSl7XHJcblxyXG4gICAgICAgIG5vZGUgPSBub2RlLmdldEF0dHJpYnV0ZU5vZGUobmFtZSlcclxuICAgICAgICByZXR1cm4gKG5vZGUgJiYgbm9kZS5zcGVjaWZpZWQpID8gbm9kZS52YWx1ZSA6IG51bGxcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gaGFzQXR0cmlidXRlXHJcblxyXG4gICAgdGhpcy5oYXNBdHRyaWJ1dGUgPSAocm9vdC5oYXNBdHRyaWJ1dGUpID8gZnVuY3Rpb24obm9kZSwgYXR0cmlidXRlKXtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGUuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSlcclxuXHJcbiAgICB9IDogZnVuY3Rpb24obm9kZSwgYXR0cmlidXRlKSB7XHJcblxyXG4gICAgICAgIG5vZGUgPSBub2RlLmdldEF0dHJpYnV0ZU5vZGUoYXR0cmlidXRlKVxyXG4gICAgICAgIHJldHVybiAhIShub2RlICYmIG5vZGUuc3BlY2lmaWVkKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvLyBjb250YWluc1xyXG5cclxuICAgIHRoaXMuY29udGFpbnMgPSAoZG9jdW1lbnQuY29udGFpbnMgJiYgcm9vdC5jb250YWlucykgPyBmdW5jdGlvbihjb250ZXh0LCBub2RlKXtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbnRleHQuY29udGFpbnMobm9kZSlcclxuXHJcbiAgICB9IDogKHJvb3QuY29tcGFyZURvY3VtZW50UG9zaXRpb24pID8gZnVuY3Rpb24oY29udGV4dCwgbm9kZSl7XHJcblxyXG4gICAgICAgIHJldHVybiBjb250ZXh0ID09PSBub2RlIHx8ICEhKGNvbnRleHQuY29tcGFyZURvY3VtZW50UG9zaXRpb24obm9kZSkgJiAxNilcclxuXHJcbiAgICB9IDogZnVuY3Rpb24oY29udGV4dCwgbm9kZSl7XHJcblxyXG4gICAgICAgIGRvIHtcclxuICAgICAgICAgICAgaWYgKG5vZGUgPT09IGNvbnRleHQpIHJldHVybiB0cnVlXHJcbiAgICAgICAgfSB3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpKVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuXHJcbiAgICAvLyBzb3J0XHJcbiAgICAvLyBjcmVkaXRzIHRvIFNpenpsZSAoaHR0cDovL3NpenpsZWpzLmNvbS8pXHJcblxyXG4gICAgdGhpcy5zb3J0ZXIgPSAocm9vdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbikgPyBmdW5jdGlvbihhLCBiKXtcclxuXHJcbiAgICAgICAgaWYgKCFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIHx8ICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSByZXR1cm4gMFxyXG4gICAgICAgIHJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgNCA/IC0xIDogYSA9PT0gYiA/IDAgOiAxXHJcblxyXG4gICAgfSA6ICgnc291cmNlSW5kZXgnIGluIHJvb3QpID8gZnVuY3Rpb24oYSwgYil7XHJcblxyXG4gICAgICAgIGlmICghYS5zb3VyY2VJbmRleCB8fCAhYi5zb3VyY2VJbmRleCkgcmV0dXJuIDBcclxuICAgICAgICByZXR1cm4gYS5zb3VyY2VJbmRleCAtIGIuc291cmNlSW5kZXhcclxuXHJcbiAgICB9IDogKGRvY3VtZW50LmNyZWF0ZVJhbmdlKSA/IGZ1bmN0aW9uKGEsIGIpe1xyXG5cclxuICAgICAgICBpZiAoIWEub3duZXJEb2N1bWVudCB8fCAhYi5vd25lckRvY3VtZW50KSByZXR1cm4gMFxyXG4gICAgICAgIHZhciBhUmFuZ2UgPSBhLm93bmVyRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKSxcclxuICAgICAgICAgICAgYlJhbmdlID0gYi5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKClcclxuXHJcbiAgICAgICAgYVJhbmdlLnNldFN0YXJ0KGEsIDApXHJcbiAgICAgICAgYVJhbmdlLnNldEVuZChhLCAwKVxyXG4gICAgICAgIGJSYW5nZS5zZXRTdGFydChiLCAwKVxyXG4gICAgICAgIGJSYW5nZS5zZXRFbmQoYiwgMClcclxuICAgICAgICByZXR1cm4gYVJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhSYW5nZS5TVEFSVF9UT19FTkQsIGJSYW5nZSlcclxuXHJcbiAgICB9IDogbnVsbFxyXG5cclxuICAgIHRoaXMuZmFpbGVkID0ge31cclxuXHJcbiAgICB2YXIgbmF0aXZlTWF0Y2hlcyA9IHRoaXMuaGFzKFwiTUFUQ0hFU19TRUxFQ1RPUlwiKVxyXG5cclxuICAgIGlmIChuYXRpdmVNYXRjaGVzKSB0aGlzLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKG5vZGUsIGV4cHJlc3Npb24pe1xyXG5cclxuICAgICAgICBpZiAodGhpcy5mYWlsZWRbZXhwcmVzc2lvbl0pIHJldHVybiBudWxsXHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuYXRpdmVNYXRjaGVzLmNhbGwobm9kZSwgZXhwcmVzc2lvbilcclxuICAgICAgICB9IGNhdGNoKGUpe1xyXG4gICAgICAgICAgICBpZiAoc2xpY2suZGVidWcpIGNvbnNvbGUud2FybihcIm1hdGNoZXNTZWxlY3RvciBmYWlsZWQgb24gXCIgKyBleHByZXNzaW9uKVxyXG4gICAgICAgICAgICB0aGlzLmZhaWxlZFtleHByZXNzaW9uXSA9IHRydWVcclxuICAgICAgICAgICAgcmV0dXJuIG51bGxcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmhhcyhcIlFVRVJZX1NFTEVDVE9SXCIpKXtcclxuXHJcbiAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsID0gZnVuY3Rpb24obm9kZSwgZXhwcmVzc2lvbil7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5mYWlsZWRbZXhwcmVzc2lvbl0pIHJldHVybiB0cnVlXHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0LCBfaWQsIF9leHByZXNzaW9uLCBfY29tYmluYXRvciwgX25vZGVcclxuXHJcblxyXG4gICAgICAgICAgICAvLyBub24tZG9jdW1lbnQgcm9vdGVkIFFTQVxyXG4gICAgICAgICAgICAvLyBjcmVkaXRzIHRvIEFuZHJldyBEdXBvbnRcclxuXHJcbiAgICAgICAgICAgIGlmIChub2RlICE9PSB0aGlzLmRvY3VtZW50KXtcclxuXHJcbiAgICAgICAgICAgICAgICBfY29tYmluYXRvciA9IGV4cHJlc3Npb25bMF0uY29tYmluYXRvclxyXG5cclxuICAgICAgICAgICAgICAgIF9pZCAgICAgICAgID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJpZFwiKVxyXG4gICAgICAgICAgICAgICAgX2V4cHJlc3Npb24gPSBleHByZXNzaW9uXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFfaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIF9ub2RlID0gbm9kZVxyXG4gICAgICAgICAgICAgICAgICAgIF9pZCA9IFwiX19zbGlja19fXCJcclxuICAgICAgICAgICAgICAgICAgICBfbm9kZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBfaWQpXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IFwiI1wiICsgX2lkICsgXCIgXCIgKyBfZXhwcmVzc2lvblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvLyB0aGVzZSBjb21iaW5hdG9ycyBuZWVkIGEgcGFyZW50Tm9kZSBkdWUgdG8gaG93IHF1ZXJ5U2VsZWN0b3JBbGwgd29ya3MsIHdoaWNoIGlzOlxyXG4gICAgICAgICAgICAgICAgLy8gZmluZGluZyBhbGwgdGhlIGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAvLyB0aGVuIGZpbHRlcmluZyBieSB0aGUgb25lcyB0aGF0IGhhdmUgdGhlIHNwZWNpZmllZCBlbGVtZW50IGFzIGFuIGFuY2VzdG9yXHJcbiAgICAgICAgICAgICAgICBpZiAoX2NvbWJpbmF0b3IuaW5kZXhPZihcIn5cIikgPiAtMSB8fCBfY29tYmluYXRvci5pbmRleE9mKFwiK1wiKSA+IC0xKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghbm9kZSkgcmVzdWx0ID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIG5vZGUgaGFzIG5vIHBhcmVudE5vZGUsIHdlIHJldHVybiBcInRydWVcIiBhcyBpZiBpdCBmYWlsZWQsIHdpdGhvdXQgcG9sbHV0aW5nIHRoZSBmYWlsZWQgY2FjaGVcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXJlc3VsdCkgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5vZGUucXVlcnlTZWxlY3RvckFsbChleHByZXNzaW9uLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgIH0gY2F0Y2goZSl7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2xpY2suZGVidWcpIGNvbnNvbGUud2FybihcInF1ZXJ5U2VsZWN0b3JBbGwgZmFpbGVkIG9uIFwiICsgKF9leHByZXNzaW9uIHx8IGV4cHJlc3Npb24pKVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5mYWlsZWRbX2V4cHJlc3Npb24gfHwgZXhwcmVzc2lvbl0gPSB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChfbm9kZSkgX25vZGUucmVtb3ZlQXR0cmlidXRlKFwiaWRcIilcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbkZpbmRlci5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24oRkVBVFVSRSl7XHJcblxyXG4gICAgdmFyIHRlc3RlZCAgICAgICAgPSB0aGlzLnRlc3RlZCxcclxuICAgICAgICB0ZXN0ZWRGRUFUVVJFID0gdGVzdGVkW0ZFQVRVUkVdXHJcblxyXG4gICAgaWYgKHRlc3RlZEZFQVRVUkUgIT0gbnVsbCkgcmV0dXJuIHRlc3RlZEZFQVRVUkVcclxuXHJcbiAgICB2YXIgcm9vdCAgICAgPSB0aGlzLnJvb3QsXHJcbiAgICAgICAgZG9jdW1lbnQgPSB0aGlzLmRvY3VtZW50LFxyXG4gICAgICAgIHRlc3ROb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxyXG5cclxuICAgIHRlc3ROb2RlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiZGlzcGxheTogbm9uZTtcIilcclxuXHJcbiAgICByb290LmFwcGVuZENoaWxkKHRlc3ROb2RlKVxyXG5cclxuICAgIHZhciBURVNUID0gSEFTW0ZFQVRVUkVdLCByZXN1bHQgPSBmYWxzZVxyXG5cclxuICAgIGlmIChURVNUKSB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IFRFU1QuY2FsbChkb2N1bWVudCwgdGVzdE5vZGUpXHJcbiAgICB9IGNhdGNoKGUpe31cclxuXHJcbiAgICBpZiAoc2xpY2suZGVidWcgJiYgIXJlc3VsdCkgY29uc29sZS53YXJuKFwiZG9jdW1lbnQgaGFzIG5vIFwiICsgRkVBVFVSRSlcclxuXHJcbiAgICByb290LnJlbW92ZUNoaWxkKHRlc3ROb2RlKVxyXG5cclxuICAgIHJldHVybiB0ZXN0ZWRbRkVBVFVSRV0gPSByZXN1bHRcclxuXHJcbn1cclxuXHJcbnZhciBjb21iaW5hdG9ycyA9IHtcclxuXHJcbiAgICBcIiBcIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7XHJcblxyXG4gICAgICAgIHZhciBpdGVtLCBpdGVtc1xyXG5cclxuICAgICAgICB2YXIgbm9JZCA9ICFwYXJ0LmlkLCBub1RhZyA9ICFwYXJ0LnRhZywgbm9DbGFzcyA9ICFwYXJ0LmNsYXNzZXNcclxuXHJcbiAgICAgICAgaWYgKHBhcnQuaWQgJiYgbm9kZS5nZXRFbGVtZW50QnlJZCAmJiB0aGlzLmhhcyhcIkdFVF9FTEVNRU5UX0JZX0lEXCIpKXtcclxuICAgICAgICAgICAgaXRlbSA9IG5vZGUuZ2V0RWxlbWVudEJ5SWQocGFydC5pZClcclxuXHJcbiAgICAgICAgICAgIC8vIHJldHVybiBvbmx5IGlmIGlkIGlzIGZvdW5kLCBlbHNlIGtlZXAgY2hlY2tpbmdcclxuICAgICAgICAgICAgLy8gbWlnaHQgYmUgYSB0YWQgc2xvd2VyIG9uIG5vbi1leGlzdGluZyBpZHMsIGJ1dCBsZXNzIGluc2FuZVxyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09IHBhcnQuaWQpe1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSBbaXRlbV1cclxuICAgICAgICAgICAgICAgIG5vSWQgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICAvLyBpZiB0YWcgaXMgc3Rhciwgbm8gbmVlZCB0byBjaGVjayBpdCBpbiBtYXRjaCgpXHJcbiAgICAgICAgICAgICAgICBpZiAocGFydC50YWcgPT09IFwiKlwiKSBub1RhZyA9IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFpdGVtcyl7XHJcblxyXG4gICAgICAgICAgICBpZiAocGFydC5jbGFzc2VzICYmIG5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiB0aGlzLmhhcyhcIkdFVF9FTEVNRU5UU19CWV9DTEFTU19OQU1FXCIpKXtcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gbm9kZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHBhcnQuY2xhc3NMaXN0KVxyXG4gICAgICAgICAgICAgICAgbm9DbGFzcyA9IHRydWVcclxuICAgICAgICAgICAgICAgIC8vIGlmIHRhZyBpcyBzdGFyLCBubyBuZWVkIHRvIGNoZWNrIGl0IGluIG1hdGNoKClcclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0LnRhZyA9PT0gXCIqXCIpIG5vVGFnID0gdHJ1ZVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHBhcnQudGFnKVxyXG4gICAgICAgICAgICAgICAgLy8gaWYgdGFnIGlzIHN0YXIsIG5lZWQgdG8gY2hlY2sgaXQgaW4gbWF0Y2ggYmVjYXVzZSBpdCBjb3VsZCBzZWxlY3QganVuaywgYm9ob1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnQudGFnICE9PSBcIipcIikgbm9UYWcgPSB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghaXRlbXMgfHwgIWl0ZW1zLmxlbmd0aCkgcmV0dXJuIGZhbHNlXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGl0ZW0gPSBpdGVtc1tpKytdOylcclxuICAgICAgICAgICAgaWYgKChub1RhZyAmJiBub0lkICYmIG5vQ2xhc3MgJiYgIXBhcnQuYXR0cmlidXRlcyAmJiAhcGFydC5wc2V1ZG9zKSB8fCB0aGlzLm1hdGNoKGl0ZW0sIHBhcnQsIG5vVGFnLCBub0lkLCBub0NsYXNzKSlcclxuICAgICAgICAgICAgICAgIHB1c2goaXRlbSlcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIFwiPlwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gZGlyZWN0IGNoaWxkcmVuXHJcbiAgICAgICAgaWYgKChub2RlID0gbm9kZS5maXJzdENoaWxkKSkgZG8ge1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxICYmIHRoaXMubWF0Y2gobm9kZSwgcGFydCkpIHB1c2gobm9kZSlcclxuICAgICAgICB9IHdoaWxlICgobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpKVxyXG4gICAgfSxcclxuXHJcbiAgICBcIitcIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIG5leHQgc2libGluZ1xyXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpKSBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2gobm9kZSwgcGFydCkpIHB1c2gobm9kZSlcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIFwiXlwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gZmlyc3QgY2hpbGRcclxuICAgICAgICBub2RlID0gbm9kZS5maXJzdENoaWxkXHJcbiAgICAgICAgaWYgKG5vZGUpe1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29tYmluYXRvcnNbJysnXS5jYWxsKHRoaXMsIG5vZGUsIHBhcnQsIHB1c2gpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIFwiflwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gbmV4dCBzaWJsaW5nc1xyXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpKXtcclxuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgdGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgXCIrK1wiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gbmV4dCBzaWJsaW5nIGFuZCBwcmV2aW91cyBzaWJsaW5nXHJcbiAgICAgICAgY29tYmluYXRvcnNbJysnXS5jYWxsKHRoaXMsIG5vZGUsIHBhcnQsIHB1c2gpXHJcbiAgICAgICAgY29tYmluYXRvcnNbJyErJ10uY2FsbCh0aGlzLCBub2RlLCBwYXJ0LCBwdXNoKVxyXG4gICAgfSxcclxuXHJcbiAgICBcIn5+XCI6IGZ1bmN0aW9uKG5vZGUsIHBhcnQsIHB1c2gpeyAvLyBuZXh0IHNpYmxpbmdzIGFuZCBwcmV2aW91cyBzaWJsaW5nc1xyXG4gICAgICAgIGNvbWJpbmF0b3JzWyd+J10uY2FsbCh0aGlzLCBub2RlLCBwYXJ0LCBwdXNoKVxyXG4gICAgICAgIGNvbWJpbmF0b3JzWychfiddLmNhbGwodGhpcywgbm9kZSwgcGFydCwgcHVzaClcclxuICAgIH0sXHJcblxyXG4gICAgXCIhXCI6IGZ1bmN0aW9uKG5vZGUsIHBhcnQsIHB1c2gpeyAvLyBhbGwgcGFyZW50IG5vZGVzIHVwIHRvIGRvY3VtZW50XHJcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5wYXJlbnROb2RlKSkgaWYgKG5vZGUgIT09IHRoaXMuZG9jdW1lbnQgJiYgdGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxyXG4gICAgfSxcclxuXHJcbiAgICBcIiE+XCI6IGZ1bmN0aW9uKG5vZGUsIHBhcnQsIHB1c2gpeyAvLyBkaXJlY3QgcGFyZW50IChvbmUgbGV2ZWwpXHJcbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZVxyXG4gICAgICAgIGlmIChub2RlICE9PSB0aGlzLmRvY3VtZW50ICYmIHRoaXMubWF0Y2gobm9kZSwgcGFydCkpIHB1c2gobm9kZSlcclxuICAgIH0sXHJcblxyXG4gICAgXCIhK1wiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gcHJldmlvdXMgc2libGluZ1xyXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nKSkgaWYgKG5vZGUubm9kZVR5cGUgPT0gMSl7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBcIiFeXCI6IGZ1bmN0aW9uKG5vZGUsIHBhcnQsIHB1c2gpeyAvLyBsYXN0IGNoaWxkXHJcbiAgICAgICAgbm9kZSA9IG5vZGUubGFzdENoaWxkXHJcbiAgICAgICAgaWYgKG5vZGUpe1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKXtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb21iaW5hdG9yc1snISsnXS5jYWxsKHRoaXMsIG5vZGUsIHBhcnQsIHB1c2gpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIFwiIX5cIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIHByZXZpb3VzIHNpYmxpbmdzXHJcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpKXtcclxuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgdGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbkZpbmRlci5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24oY29udGV4dCwgZXhwcmVzc2lvbiwgZm91bmQpe1xyXG5cclxuICAgIGlmICghY29udGV4dCkgY29udGV4dCA9IHRoaXMuZG9jdW1lbnRcclxuICAgIGVsc2UgaWYgKCFjb250ZXh0Lm5vZGVUeXBlICYmIGNvbnRleHQuZG9jdW1lbnQpIGNvbnRleHQgPSBjb250ZXh0LmRvY3VtZW50XHJcblxyXG4gICAgdmFyIGV4cHJlc3Npb25zID0gcGFyc2UoZXhwcmVzc2lvbilcclxuXHJcbiAgICAvLyBubyBleHByZXNzaW9ucyB3ZXJlIHBhcnNlZC4gdG9kbzogaXMgdGhpcyByZWFsbHkgbmVjZXNzYXJ5P1xyXG4gICAgaWYgKCFleHByZXNzaW9ucyB8fCAhZXhwcmVzc2lvbnMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIGV4cHJlc3Npb25cIilcclxuXHJcbiAgICBpZiAoIWZvdW5kKSBmb3VuZCA9IFtdXHJcblxyXG4gICAgdmFyIHVuaXF1ZXMsIHB1c2ggPSBpc0FycmF5KGZvdW5kKSA/IGZ1bmN0aW9uKG5vZGUpe1xyXG4gICAgICAgIGZvdW5kW2ZvdW5kLmxlbmd0aF0gPSBub2RlXHJcbiAgICB9IDogZnVuY3Rpb24obm9kZSl7XHJcbiAgICAgICAgZm91bmRbZm91bmQubGVuZ3RoKytdID0gbm9kZVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgZXhwcmVzc2lvbiB3ZSBuZWVkIHRvIGNoZWNrIGZvciBkdXBsaWNhdGVzIHdoZW4gd2UgcHVzaCB0byBmb3VuZFxyXG4gICAgLy8gdGhpcyBzaW1wbHkgc2F2ZXMgdGhlIG9sZCBwdXNoIGFuZCB3cmFwcyBpdCBhcm91bmQgYW4gdWlkIGR1cGUgY2hlY2suXHJcbiAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoID4gMSl7XHJcbiAgICAgICAgdW5pcXVlcyA9IHt9XHJcbiAgICAgICAgdmFyIHBsdXNoID0gcHVzaFxyXG4gICAgICAgIHB1c2ggPSBmdW5jdGlvbihub2RlKXtcclxuICAgICAgICAgICAgdmFyIHVpZCA9IHVuaXF1ZUlEKG5vZGUpXHJcbiAgICAgICAgICAgIGlmICghdW5pcXVlc1t1aWRdKXtcclxuICAgICAgICAgICAgICAgIHVuaXF1ZXNbdWlkXSA9IHRydWVcclxuICAgICAgICAgICAgICAgIHBsdXNoKG5vZGUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd2Fsa2VyXHJcblxyXG4gICAgdmFyIG5vZGUsIG5vZGVzLCBwYXJ0XHJcblxyXG4gICAgbWFpbjogZm9yICh2YXIgaSA9IDA7IGV4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpKytdOyl7XHJcblxyXG4gICAgICAgIC8vIHF1ZXJ5U2VsZWN0b3JcclxuXHJcbiAgICAgICAgLy8gVE9ETzogbW9yZSBmdW5jdGlvbmFsIHRlc3RzXHJcblxyXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIHF1ZXJ5U2VsZWN0b3JBbGwgKGFuZCB0aGUgZXhwcmVzc2lvbiBkb2VzIG5vdCBmYWlsKSB1c2UgaXQuXHJcbiAgICAgICAgaWYgKCFzbGljay5ub1FTQSAmJiB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwpe1xyXG5cclxuICAgICAgICAgICAgbm9kZXMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoY29udGV4dCwgZXhwcmVzc2lvbilcclxuICAgICAgICAgICAgaWYgKG5vZGVzICE9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIGZvciAodmFyIGogPSAwOyBub2RlID0gbm9kZXNbaisrXTspIGlmIChub2RlLm5vZGVOYW1lID4gJ0AnKXtcclxuICAgICAgICAgICAgICAgICAgICBwdXNoKG5vZGUpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZSBtYWluXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIHBhcnQgaW4gdGhlIGV4cHJlc3Npb24gd2UgZG9uJ3QgbmVlZCB0byBjaGVjayBlYWNoIHBhcnQgZm9yIGR1cGxpY2F0ZXMuXHJcbiAgICAgICAgLy8gdG9kbzogdGhpcyBtaWdodCBiZSB0b28gbmFpdmUuIHdoaWxlIHNvbGlkLCB0aGVyZSBjYW4gYmUgZXhwcmVzc2lvbiBzZXF1ZW5jZXMgdGhhdCBkbyBub3RcclxuICAgICAgICAvLyBwcm9kdWNlIGR1cGxpY2F0ZXMuIFwiYm9keSBkaXZcIiBmb3IgaW5zdGFuY2UsIGNhbiBuZXZlciBnaXZlIHlvdSBlYWNoIGRpdiBtb3JlIHRoYW4gb25jZS5cclxuICAgICAgICAvLyBcImJvZHkgZGl2IGFcIiBvbiB0aGUgb3RoZXIgaGFuZCBtaWdodC5cclxuICAgICAgICBpZiAoZXhwcmVzc2lvbi5sZW5ndGggPT09IDEpe1xyXG5cclxuICAgICAgICAgICAgcGFydCA9IGV4cHJlc3Npb25bMF1cclxuICAgICAgICAgICAgY29tYmluYXRvcnNbcGFydC5jb21iaW5hdG9yXS5jYWxsKHRoaXMsIGNvbnRleHQsIHBhcnQsIHB1c2gpXHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgY3MgPSBbY29udGV4dF0sIGMsIGYsIHUsIHAgPSBmdW5jdGlvbihub2RlKXtcclxuICAgICAgICAgICAgICAgIHZhciB1aWQgPSB1bmlxdWVJRChub2RlKVxyXG4gICAgICAgICAgICAgICAgaWYgKCF1W3VpZF0pe1xyXG4gICAgICAgICAgICAgICAgICAgIHVbdWlkXSA9IHRydWVcclxuICAgICAgICAgICAgICAgICAgICBmW2YubGVuZ3RoXSA9IG5vZGVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gbG9vcCB0aGUgZXhwcmVzc2lvbiBwYXJ0c1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgcGFydCA9IGV4cHJlc3Npb25baisrXTspe1xyXG4gICAgICAgICAgICAgICAgZiA9IFtdOyB1ID0ge31cclxuICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhlIGNvbnRleHRzXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgYyA9IGNzW2srK107KSBjb21iaW5hdG9yc1twYXJ0LmNvbWJpbmF0b3JdLmNhbGwodGhpcywgYywgcGFydCwgcClcclxuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgd2FzIGZvdW5kLCB0aGUgZXhwcmVzc2lvbiBmYWlsZWQsIGNvbnRpbnVlIHRvIHRoZSBuZXh0IGV4cHJlc3Npb24uXHJcbiAgICAgICAgICAgICAgICBpZiAoIWYubGVuZ3RoKSBjb250aW51ZSBtYWluXHJcbiAgICAgICAgICAgICAgICBjcyA9IGYgLy8gc2V0IHRoZSBjb250ZXh0cyBmb3IgZnV0dXJlIHBhcnRzIChpZiBhbnkpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpID09PSAwKSBmb3VuZCA9IGYgLy8gZmlyc3QgZXhwcmVzc2lvbi4gZGlyZWN0bHkgc2V0IGZvdW5kLlxyXG4gICAgICAgICAgICBlbHNlIGZvciAodmFyIGwgPSAwOyBsIDwgZi5sZW5ndGg7IGwrKykgcHVzaChmW2xdKSAvLyBhbnkgb3RoZXIgZXhwcmVzc2lvbiBuZWVkcyB0byBwdXNoIHRvIGZvdW5kLlxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHVuaXF1ZXMgJiYgZm91bmQgJiYgZm91bmQubGVuZ3RoID4gMSkgdGhpcy5zb3J0KGZvdW5kKVxyXG5cclxuICAgIHJldHVybiBmb3VuZFxyXG5cclxufVxyXG5cclxuRmluZGVyLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24obm9kZXMpe1xyXG4gICAgcmV0dXJuIHRoaXMuc29ydGVyID8gQXJyYXkucHJvdG90eXBlLnNvcnQuY2FsbChub2RlcywgdGhpcy5zb3J0ZXIpIDogbm9kZXNcclxufVxyXG5cclxuLy8gVE9ETzogbW9zdCBvZiB0aGVzZSBwc2V1ZG8gc2VsZWN0b3JzIGluY2x1ZGUgPGh0bWw+IGFuZCBxc2EgZG9lc250LiBmaXhtZS5cclxuXHJcbnZhciBwc2V1ZG9zID0ge1xyXG5cclxuXHJcbiAgICAvLyBUT0RPOiByZXR1cm5zIGRpZmZlcmVudCByZXN1bHRzIHRoYW4gcXNhIGVtcHR5LlxyXG5cclxuICAgICdlbXB0eSc6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuICEodGhpcyAmJiB0aGlzLm5vZGVUeXBlID09PSAxKSAmJiAhKHRoaXMuaW5uZXJUZXh0IHx8IHRoaXMudGV4dENvbnRlbnQgfHwgJycpLmxlbmd0aFxyXG4gICAgfSxcclxuXHJcbiAgICAnbm90JzogZnVuY3Rpb24oZXhwcmVzc2lvbil7XHJcbiAgICAgICAgcmV0dXJuICFzbGljay5tYXRjaGVzKHRoaXMsIGV4cHJlc3Npb24pXHJcbiAgICB9LFxyXG5cclxuICAgICdjb250YWlucyc6IGZ1bmN0aW9uKHRleHQpe1xyXG4gICAgICAgIHJldHVybiAodGhpcy5pbm5lclRleHQgfHwgdGhpcy50ZXh0Q29udGVudCB8fCAnJykuaW5kZXhPZih0ZXh0KSA+IC0xXHJcbiAgICB9LFxyXG5cclxuICAgICdmaXJzdC1jaGlsZCc6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzXHJcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpKSBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSByZXR1cm4gZmFsc2VcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuXHJcbiAgICAnbGFzdC1jaGlsZCc6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzXHJcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5uZXh0U2libGluZykpIGlmIChub2RlLm5vZGVUeXBlID09IDEpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9LFxyXG5cclxuICAgICdvbmx5LWNoaWxkJzogZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgcHJldiA9IHRoaXNcclxuICAgICAgICB3aGlsZSAoKHByZXYgPSBwcmV2LnByZXZpb3VzU2libGluZykpIGlmIChwcmV2Lm5vZGVUeXBlID09IDEpIHJldHVybiBmYWxzZVxyXG5cclxuICAgICAgICB2YXIgbmV4dCA9IHRoaXNcclxuICAgICAgICB3aGlsZSAoKG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nKSkgaWYgKG5leHQubm9kZVR5cGUgPT0gMSkgcmV0dXJuIGZhbHNlXHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9LFxyXG5cclxuICAgICdmaXJzdC1vZi10eXBlJzogZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbm9kZSA9IHRoaXMsIG5vZGVOYW1lID0gbm9kZS5ub2RlTmFtZVxyXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nKSkgaWYgKG5vZGUubm9kZU5hbWUgPT0gbm9kZU5hbWUpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9LFxyXG5cclxuICAgICdsYXN0LW9mLXR5cGUnOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBub2RlID0gdGhpcywgbm9kZU5hbWUgPSBub2RlLm5vZGVOYW1lXHJcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5uZXh0U2libGluZykpIGlmIChub2RlLm5vZGVOYW1lID09IG5vZGVOYW1lKSByZXR1cm4gZmFsc2VcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuXHJcbiAgICAnb25seS1vZi10eXBlJzogZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgcHJldiA9IHRoaXMsIG5vZGVOYW1lID0gdGhpcy5ub2RlTmFtZVxyXG4gICAgICAgIHdoaWxlICgocHJldiA9IHByZXYucHJldmlvdXNTaWJsaW5nKSkgaWYgKHByZXYubm9kZU5hbWUgPT0gbm9kZU5hbWUpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIHZhciBuZXh0ID0gdGhpc1xyXG4gICAgICAgIHdoaWxlICgobmV4dCA9IG5leHQubmV4dFNpYmxpbmcpKSBpZiAobmV4dC5ub2RlTmFtZSA9PSBub2RlTmFtZSkgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgIH0sXHJcblxyXG4gICAgJ2VuYWJsZWQnOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5kaXNhYmxlZFxyXG4gICAgfSxcclxuXHJcbiAgICAnZGlzYWJsZWQnOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkXHJcbiAgICB9LFxyXG5cclxuICAgICdjaGVja2VkJzogZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja2VkIHx8IHRoaXMuc2VsZWN0ZWRcclxuICAgIH0sXHJcblxyXG4gICAgJ3NlbGVjdGVkJzogZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFxyXG4gICAgfSxcclxuXHJcbiAgICAnZm9jdXMnOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnRcclxuICAgICAgICByZXR1cm4gZG9jLmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMgJiYgKHRoaXMuaHJlZiB8fCB0aGlzLnR5cGUgfHwgc2xpY2suaGFzQXR0cmlidXRlKHRoaXMsICd0YWJpbmRleCcpKVxyXG4gICAgfSxcclxuXHJcbiAgICAncm9vdCc6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzID09PSB0aGlzLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuRmluZGVyLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uKG5vZGUsIGJpdCwgbm9UYWcsIG5vSWQsIG5vQ2xhc3Mpe1xyXG5cclxuICAgIC8vIFRPRE86IG1vcmUgZnVuY3Rpb25hbCB0ZXN0cyA/XHJcblxyXG4gICAgaWYgKCFzbGljay5ub1FTQSAmJiB0aGlzLm1hdGNoZXNTZWxlY3Rvcil7XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm1hdGNoZXNTZWxlY3Rvcihub2RlLCBiaXQpXHJcbiAgICAgICAgaWYgKG1hdGNoZXMgIT09IG51bGwpIHJldHVybiBtYXRjaGVzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gbm9ybWFsIG1hdGNoaW5nXHJcblxyXG4gICAgaWYgKCFub1RhZyAmJiBiaXQudGFnKXtcclxuXHJcbiAgICAgICAgdmFyIG5vZGVOYW1lID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgaWYgKGJpdC50YWcgPT09IFwiKlwiKXtcclxuICAgICAgICAgICAgaWYgKG5vZGVOYW1lIDwgXCJAXCIpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH0gZWxzZSBpZiAobm9kZU5hbWUgIT0gYml0LnRhZyl7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFub0lkICYmIGJpdC5pZCAmJiBub2RlLmdldEF0dHJpYnV0ZSgnaWQnKSAhPT0gYml0LmlkKSByZXR1cm4gZmFsc2VcclxuXHJcbiAgICB2YXIgaSwgcGFydFxyXG5cclxuICAgIGlmICghbm9DbGFzcyAmJiBiaXQuY2xhc3Nlcyl7XHJcblxyXG4gICAgICAgIHZhciBjbGFzc05hbWUgPSB0aGlzLmdldEF0dHJpYnV0ZShub2RlLCBcImNsYXNzXCIpXHJcbiAgICAgICAgaWYgKCFjbGFzc05hbWUpIHJldHVybiBmYWxzZVxyXG5cclxuICAgICAgICBmb3IgKHBhcnQgaW4gYml0LmNsYXNzZXMpIGlmICghUmVnRXhwKCcoXnxcXFxccyknICsgYml0LmNsYXNzZXNbcGFydF0gKyAnKFxcXFxzfCQpJykudGVzdChjbGFzc05hbWUpKSByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuXHJcbiAgICB2YXIgbmFtZSwgdmFsdWVcclxuXHJcbiAgICBpZiAoYml0LmF0dHJpYnV0ZXMpIGZvciAoaSA9IDA7IHBhcnQgPSBiaXQuYXR0cmlidXRlc1tpKytdOyl7XHJcblxyXG4gICAgICAgIHZhciBvcGVyYXRvciAgPSBwYXJ0Lm9wZXJhdG9yLFxyXG4gICAgICAgICAgICBlc2NhcGVkICAgPSBwYXJ0LmVzY2FwZWRWYWx1ZVxyXG5cclxuICAgICAgICBuYW1lICA9IHBhcnQubmFtZVxyXG4gICAgICAgIHZhbHVlID0gcGFydC52YWx1ZVxyXG5cclxuICAgICAgICBpZiAoIW9wZXJhdG9yKXtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUobm9kZSwgbmFtZSkpIHJldHVybiBmYWxzZVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IHRoaXMuZ2V0QXR0cmlidXRlKG5vZGUsIG5hbWUpXHJcbiAgICAgICAgICAgIGlmIChhY3R1YWwgPT0gbnVsbCkgcmV0dXJuIGZhbHNlXHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKXtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ149JyA6IGlmICghUmVnRXhwKCAgICAgICdeJyArIGVzY2FwZWQgICAgICAgICAgICApLnRlc3QoYWN0dWFsKSkgcmV0dXJuIGZhbHNlOyBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnJD0nIDogaWYgKCFSZWdFeHAoICAgICAgICAgICAgZXNjYXBlZCArICckJyAgICAgICkudGVzdChhY3R1YWwpKSByZXR1cm4gZmFsc2U7IGJyZWFrXHJcbiAgICAgICAgICAgICAgICBjYXNlICd+PScgOiBpZiAoIVJlZ0V4cCgnKF58XFxcXHMpJyArIGVzY2FwZWQgKyAnKFxcXFxzfCQpJykudGVzdChhY3R1YWwpKSByZXR1cm4gZmFsc2U7IGJyZWFrXHJcbiAgICAgICAgICAgICAgICBjYXNlICd8PScgOiBpZiAoIVJlZ0V4cCggICAgICAnXicgKyBlc2NhcGVkICsgJygtfCQpJyAgKS50ZXN0KGFjdHVhbCkpIHJldHVybiBmYWxzZTsgYnJlYWtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICc9JyAgOiBpZiAoYWN0dWFsICE9PSB2YWx1ZSkgcmV0dXJuIGZhbHNlOyBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnKj0nIDogaWYgKGFjdHVhbC5pbmRleE9mKHZhbHVlKSA9PT0gLTEpIHJldHVybiBmYWxzZTsgYnJlYWtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQgICA6IHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoYml0LnBzZXVkb3MpIGZvciAoaSA9IDA7IHBhcnQgPSBiaXQucHNldWRvc1tpKytdOyl7XHJcblxyXG4gICAgICAgIG5hbWUgID0gcGFydC5uYW1lXHJcbiAgICAgICAgdmFsdWUgPSBwYXJ0LnZhbHVlXHJcblxyXG4gICAgICAgIGlmIChwc2V1ZG9zW25hbWVdKSByZXR1cm4gcHNldWRvc1tuYW1lXS5jYWxsKG5vZGUsIHZhbHVlKVxyXG5cclxuICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShub2RlLCBuYW1lKSAhPT0gdmFsdWUpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUobm9kZSwgbmFtZSkpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWVcclxuXHJcbn1cclxuXHJcbkZpbmRlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uKG5vZGUsIGV4cHJlc3Npb24pe1xyXG5cclxuICAgIHZhciBleHByZXNzaW9ucyA9IHBhcnNlKGV4cHJlc3Npb24pXHJcblxyXG4gICAgaWYgKGV4cHJlc3Npb25zLmxlbmd0aCA9PT0gMSAmJiBleHByZXNzaW9uc1swXS5sZW5ndGggPT09IDEpeyAvLyBzaW1wbGVzdCBtYXRjaFxyXG4gICAgICAgIHJldHVybiB0aGlzLm1hdGNoKG5vZGUsIGV4cHJlc3Npb25zWzBdWzBdKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86IG1vcmUgZnVuY3Rpb25hbCB0ZXN0cyA/XHJcblxyXG4gICAgaWYgKCFzbGljay5ub1FTQSAmJiB0aGlzLm1hdGNoZXNTZWxlY3Rvcil7XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm1hdGNoZXNTZWxlY3Rvcihub2RlLCBleHByZXNzaW9ucylcclxuICAgICAgICBpZiAobWF0Y2hlcyAhPT0gbnVsbCkgcmV0dXJuIG1hdGNoZXNcclxuICAgIH1cclxuXHJcbiAgICB2YXIgbm9kZXMgPSB0aGlzLnNlYXJjaCh0aGlzLmRvY3VtZW50LCBleHByZXNzaW9uLCB7bGVuZ3RoOiAwfSlcclxuXHJcbiAgICBmb3IgKHZhciBpID0gMCwgcmVzOyByZXMgPSBub2Rlc1tpKytdOykgaWYgKG5vZGUgPT09IHJlcykgcmV0dXJuIHRydWVcclxuICAgIHJldHVybiBmYWxzZVxyXG5cclxufVxyXG5cclxudmFyIGZpbmRlcnMgPSB7fVxyXG5cclxudmFyIGZpbmRlciA9IGZ1bmN0aW9uKGNvbnRleHQpe1xyXG4gICAgdmFyIGRvYyA9IGNvbnRleHQgfHwgZG9jdW1lbnRcclxuICAgIGlmIChkb2Mub3duZXJEb2N1bWVudCkgZG9jID0gZG9jLm93bmVyRG9jdW1lbnRcclxuICAgIGVsc2UgaWYgKGRvYy5kb2N1bWVudCkgZG9jID0gZG9jLmRvY3VtZW50XHJcblxyXG4gICAgaWYgKGRvYy5ub2RlVHlwZSAhPT0gOSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImludmFsaWQgZG9jdW1lbnRcIilcclxuXHJcbiAgICB2YXIgdWlkID0gdW5pcXVlSUQoZG9jKVxyXG4gICAgcmV0dXJuIGZpbmRlcnNbdWlkXSB8fCAoZmluZGVyc1t1aWRdID0gbmV3IEZpbmRlcihkb2MpKVxyXG59XHJcblxyXG4vLyAuLi4gQVBJIC4uLlxyXG5cclxudmFyIHNsaWNrID0gZnVuY3Rpb24oZXhwcmVzc2lvbiwgY29udGV4dCl7XHJcbiAgICByZXR1cm4gc2xpY2suc2VhcmNoKGV4cHJlc3Npb24sIGNvbnRleHQpXHJcbn1cclxuXHJcbnNsaWNrLnNlYXJjaCA9IGZ1bmN0aW9uKGV4cHJlc3Npb24sIGNvbnRleHQsIGZvdW5kKXtcclxuICAgIHJldHVybiBmaW5kZXIoY29udGV4dCkuc2VhcmNoKGNvbnRleHQsIGV4cHJlc3Npb24sIGZvdW5kKVxyXG59XHJcblxyXG5zbGljay5maW5kID0gZnVuY3Rpb24oZXhwcmVzc2lvbiwgY29udGV4dCl7XHJcbiAgICByZXR1cm4gZmluZGVyKGNvbnRleHQpLnNlYXJjaChjb250ZXh0LCBleHByZXNzaW9uKVswXSB8fCBudWxsXHJcbn1cclxuXHJcbnNsaWNrLmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5vZGUsIG5hbWUpe1xyXG4gICAgcmV0dXJuIGZpbmRlcihub2RlKS5nZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSlcclxufVxyXG5cclxuc2xpY2suaGFzQXR0cmlidXRlID0gZnVuY3Rpb24obm9kZSwgbmFtZSl7XHJcbiAgICByZXR1cm4gZmluZGVyKG5vZGUpLmhhc0F0dHJpYnV0ZShub2RlLCBuYW1lKVxyXG59XHJcblxyXG5zbGljay5jb250YWlucyA9IGZ1bmN0aW9uKGNvbnRleHQsIG5vZGUpe1xyXG4gICAgcmV0dXJuIGZpbmRlcihjb250ZXh0KS5jb250YWlucyhjb250ZXh0LCBub2RlKVxyXG59XHJcblxyXG5zbGljay5tYXRjaGVzID0gZnVuY3Rpb24obm9kZSwgZXhwcmVzc2lvbil7XHJcbiAgICByZXR1cm4gZmluZGVyKG5vZGUpLm1hdGNoZXMobm9kZSwgZXhwcmVzc2lvbilcclxufVxyXG5cclxuc2xpY2suc29ydCA9IGZ1bmN0aW9uKG5vZGVzKXtcclxuICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGggPiAxKSBmaW5kZXIobm9kZXNbMF0pLnNvcnQobm9kZXMpXHJcbiAgICByZXR1cm4gbm9kZXNcclxufVxyXG5cclxuc2xpY2sucGFyc2UgPSBwYXJzZTtcclxuXHJcbi8vIHNsaWNrLmRlYnVnID0gdHJ1ZVxyXG4vLyBzbGljay5ub1FTQSAgPSB0cnVlXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHNsaWNrXHJcbiIsIi8qXHJcbnNsaWNrXHJcbiovXCJ1c2Ugc3RyaWN0XCJcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gXCJkb2N1bWVudFwiIGluIGdsb2JhbCA/IHJlcXVpcmUoXCIuL2ZpbmRlclwiKSA6IHsgcGFyc2U6IHJlcXVpcmUoXCIuL3BhcnNlclwiKSB9XHJcbiIsIi8qXHJcblNsaWNrIFBhcnNlclxyXG4gLSBvcmlnaW5hbGx5IGNyZWF0ZWQgYnkgdGhlIGFsbWlnaHR5IFRob21hcyBBeWxvdHQgPEBzdWJ0bGVncmFkaWVudD4gKGh0dHA6Ly9zdWJ0bGVncmFkaWVudC5jb20pXHJcbiovXCJ1c2Ugc3RyaWN0XCJcclxuXHJcbi8vIE5vdGFibGUgY2hhbmdlcyBmcm9tIFNsaWNrLlBhcnNlciAxLjAueFxyXG5cclxuLy8gVGhlIHBhcnNlciBub3cgdXNlcyAyIGNsYXNzZXM6IEV4cHJlc3Npb25zIGFuZCBFeHByZXNzaW9uXHJcbi8vIGBuZXcgRXhwcmVzc2lvbnNgIHByb2R1Y2VzIGFuIGFycmF5LWxpa2Ugb2JqZWN0IGNvbnRhaW5pbmcgYSBsaXN0IG9mIEV4cHJlc3Npb24gb2JqZWN0c1xyXG4vLyAtIEV4cHJlc3Npb25zOjp0b1N0cmluZygpIHByb2R1Y2VzIGEgY2xlYW5lZCB1cCBleHByZXNzaW9ucyBzdHJpbmdcclxuLy8gYG5ldyBFeHByZXNzaW9uYCBwcm9kdWNlcyBhbiBhcnJheS1saWtlIG9iamVjdFxyXG4vLyAtIEV4cHJlc3Npb246OnRvU3RyaW5nKCkgcHJvZHVjZXMgYSBjbGVhbmVkIHVwIGV4cHJlc3Npb24gc3RyaW5nXHJcbi8vIFRoZSBvbmx5IGV4cG9zZWQgbWV0aG9kIGlzIHBhcnNlLCB3aGljaCBwcm9kdWNlcyBhIChjYWNoZWQpIGBuZXcgRXhwcmVzc2lvbnNgIGluc3RhbmNlXHJcbi8vIHBhcnNlZC5yYXcgaXMgbm8gbG9uZ2VyIHByZXNlbnQsIHVzZSAudG9TdHJpbmcoKVxyXG4vLyBwYXJzZWQuZXhwcmVzc2lvbiBpcyBub3cgdXNlbGVzcywganVzdCB1c2UgdGhlIGluZGljZXNcclxuLy8gcGFyc2VkLnJldmVyc2UoKSBoYXMgYmVlbiByZW1vdmVkIGZvciBub3csIGR1ZSB0byBpdHMgYXBwYXJlbnQgdXNlbGVzc25lc3NcclxuLy8gT3RoZXIgY2hhbmdlcyBpbiB0aGUgRXhwcmVzc2lvbnMgb2JqZWN0OlxyXG4vLyAtIGNsYXNzTmFtZXMgYXJlIG5vdyB1bmlxdWUsIGFuZCBzYXZlIGJvdGggZXNjYXBlZCBhbmQgdW5lc2NhcGVkIHZhbHVlc1xyXG4vLyAtIGF0dHJpYnV0ZXMgbm93IHNhdmUgYm90aCBlc2NhcGVkIGFuZCB1bmVzY2FwZWQgdmFsdWVzXHJcbi8vIC0gcHNldWRvcyBub3cgc2F2ZSBib3RoIGVzY2FwZWQgYW5kIHVuZXNjYXBlZCB2YWx1ZXNcclxuXHJcbnZhciBlc2NhcGVSZSAgID0gLyhbLS4qKz9eJHt9KCl8W1xcXVxcL1xcXFxdKS9nLFxyXG4gICAgdW5lc2NhcGVSZSA9IC9cXFxcL2dcclxuXHJcbnZhciBlc2NhcGUgPSBmdW5jdGlvbihzdHJpbmcpe1xyXG4gICAgLy8gWFJlZ0V4cCB2Mi4wLjAtYmV0YS0zXHJcbiAgICAvLyDCqyBodHRwczovL2dpdGh1Yi5jb20vc2xldml0aGFuL1hSZWdFeHAvYmxvYi9tYXN0ZXIvc3JjL3hyZWdleHAuanNcclxuICAgIHJldHVybiAoc3RyaW5nICsgXCJcIikucmVwbGFjZShlc2NhcGVSZSwgJ1xcXFwkMScpXHJcbn1cclxuXHJcbnZhciB1bmVzY2FwZSA9IGZ1bmN0aW9uKHN0cmluZyl7XHJcbiAgICByZXR1cm4gKHN0cmluZyArIFwiXCIpLnJlcGxhY2UodW5lc2NhcGVSZSwgJycpXHJcbn1cclxuXHJcbnZhciBzbGlja1JlID0gUmVnRXhwKFxyXG4vKlxyXG4jIS91c3IvYmluL2VudiBydWJ5XHJcbnB1dHMgXCJcXHRcXHRcIiArIERBVEEucmVhZC5nc3ViKC9cXChcXD94XFwpfFxccysjLiokfFxccyt8XFxcXCR8XFxcXG4vLCcnKVxyXG5fX0VORF9fXHJcbiAgICBcIig/eCleKD86XFxcclxuICAgICAgXFxcXHMqICggLCApIFxcXFxzKiAgICAgICAgICAgICAgICMgU2VwYXJhdG9yICAgICAgICAgIFxcblxcXHJcbiAgICB8IFxcXFxzKiAoIDxjb21iaW5hdG9yPisgKSBcXFxccyogICAjIENvbWJpbmF0b3IgICAgICAgICBcXG5cXFxyXG4gICAgfCAgICAgICggXFxcXHMrICkgICAgICAgICAgICAgICAgICMgQ29tYmluYXRvckNoaWxkcmVuIFxcblxcXHJcbiAgICB8ICAgICAgKCA8dW5pY29kZT4rIHwgXFxcXCogKSAgICAgIyBUYWcgICAgICAgICAgICAgICAgXFxuXFxcclxuICAgIHwgXFxcXCMgICggPHVuaWNvZGU+KyAgICAgICApICAgICAjIElEICAgICAgICAgICAgICAgICBcXG5cXFxyXG4gICAgfCBcXFxcLiAgKCA8dW5pY29kZT4rICAgICAgICkgICAgICMgQ2xhc3NOYW1lICAgICAgICAgIFxcblxcXHJcbiAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQXR0cmlidXRlICAgICAgICAgIFxcblxcXHJcbiAgICBcXFxcWyAgXFxcclxuICAgICAgICBcXFxccyogKDx1bmljb2RlMT4rKSAgKD86ICBcXFxyXG4gICAgICAgICAgICBcXFxccyogKFsqXiQhfnxdPz0pICAoPzogIFxcXHJcbiAgICAgICAgICAgICAgICBcXFxccyogKD86XFxcclxuICAgICAgICAgICAgICAgICAgICAoW1xcXCInXT8pKC4qPylcXFxcOSBcXFxyXG4gICAgICAgICAgICAgICAgKVxcXHJcbiAgICAgICAgICAgICkgIFxcXHJcbiAgICAgICAgKT8gIFxcXFxzKiAgXFxcclxuICAgIFxcXFxdKD8hXFxcXF0pIFxcblxcXHJcbiAgICB8ICAgOisgKCA8dW5pY29kZT4rICkoPzpcXFxyXG4gICAgXFxcXCggKD86XFxcclxuICAgICAgICAoPzooW1xcXCInXSkoW15cXFxcMTJdKilcXFxcMTIpfCgoPzpcXFxcKFteKV0rXFxcXCl8W14oKV0qKSspXFxcclxuICAgICkgXFxcXClcXFxyXG4gICAgKT9cXFxyXG4gICAgKVwiXHJcbiovXHJcblwiXig/OlxcXFxzKigsKVxcXFxzKnxcXFxccyooPGNvbWJpbmF0b3I+KylcXFxccyp8KFxcXFxzKyl8KDx1bmljb2RlPit8XFxcXCopfFxcXFwjKDx1bmljb2RlPispfFxcXFwuKDx1bmljb2RlPispfFxcXFxbXFxcXHMqKDx1bmljb2RlMT4rKSg/OlxcXFxzKihbKl4kIX58XT89KSg/OlxcXFxzKig/OihbXFxcIiddPykoLio/KVxcXFw5KSkpP1xcXFxzKlxcXFxdKD8hXFxcXF0pfCg6KykoPHVuaWNvZGU+KykoPzpcXFxcKCg/Oig/OihbXFxcIiddKShbXlxcXFwxM10qKVxcXFwxMyl8KCg/OlxcXFwoW14pXStcXFxcKXxbXigpXSopKykpXFxcXCkpPylcIlxyXG4gICAgLnJlcGxhY2UoLzxjb21iaW5hdG9yPi8sICdbJyArIGVzY2FwZShcIj4rfmAhQCQlXiY9e31cXFxcOzwvXCIpICsgJ10nKVxyXG4gICAgLnJlcGxhY2UoLzx1bmljb2RlPi9nLCAnKD86W1xcXFx3XFxcXHUwMGExLVxcXFx1RkZGRi1dfFxcXFxcXFxcW15cXFxcczAtOWEtZl0pJylcclxuICAgIC5yZXBsYWNlKC88dW5pY29kZTE+L2csICcoPzpbOlxcXFx3XFxcXHUwMGExLVxcXFx1RkZGRi1dfFxcXFxcXFxcW15cXFxcczAtOWEtZl0pJylcclxuKVxyXG5cclxuLy8gUGFydFxyXG5cclxudmFyIFBhcnQgPSBmdW5jdGlvbiBQYXJ0KGNvbWJpbmF0b3Ipe1xyXG4gICAgdGhpcy5jb21iaW5hdG9yID0gY29tYmluYXRvciB8fCBcIiBcIlxyXG4gICAgdGhpcy50YWcgPSBcIipcIlxyXG59XHJcblxyXG5QYXJ0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgaWYgKCF0aGlzLnJhdyl7XHJcblxyXG4gICAgICAgIHZhciB4cHIgPSBcIlwiLCBrLCBwYXJ0XHJcblxyXG4gICAgICAgIHhwciArPSB0aGlzLnRhZyB8fCBcIipcIlxyXG4gICAgICAgIGlmICh0aGlzLmlkKSB4cHIgKz0gXCIjXCIgKyB0aGlzLmlkXHJcbiAgICAgICAgaWYgKHRoaXMuY2xhc3NlcykgeHByICs9IFwiLlwiICsgdGhpcy5jbGFzc0xpc3Quam9pbihcIi5cIilcclxuICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzKSBmb3IgKGsgPSAwOyBwYXJ0ID0gdGhpcy5hdHRyaWJ1dGVzW2srK107KXtcclxuICAgICAgICAgICAgeHByICs9IFwiW1wiICsgcGFydC5uYW1lICsgKHBhcnQub3BlcmF0b3IgPyBwYXJ0Lm9wZXJhdG9yICsgJ1wiJyArIHBhcnQudmFsdWUgKyAnXCInIDogJycpICsgXCJdXCJcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMucHNldWRvcykgZm9yIChrID0gMDsgcGFydCA9IHRoaXMucHNldWRvc1trKytdOyl7XHJcbiAgICAgICAgICAgIHhwciArPSBcIjpcIiArIHBhcnQubmFtZVxyXG4gICAgICAgICAgICBpZiAocGFydC52YWx1ZSkgeHByICs9IFwiKFwiICsgcGFydC52YWx1ZSArIFwiKVwiXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJhdyA9IHhwclxyXG5cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yYXdcclxufVxyXG5cclxuLy8gRXhwcmVzc2lvblxyXG5cclxudmFyIEV4cHJlc3Npb24gPSBmdW5jdGlvbiBFeHByZXNzaW9uKCl7XHJcbiAgICB0aGlzLmxlbmd0aCA9IDBcclxufVxyXG5cclxuRXhwcmVzc2lvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgIGlmICghdGhpcy5yYXcpe1xyXG5cclxuICAgICAgICB2YXIgeHByID0gXCJcIlxyXG5cclxuICAgICAgICBmb3IgKHZhciBqID0gMCwgYml0OyBiaXQgPSB0aGlzW2orK107KXtcclxuICAgICAgICAgICAgaWYgKGogIT09IDEpIHhwciArPSBcIiBcIlxyXG4gICAgICAgICAgICBpZiAoYml0LmNvbWJpbmF0b3IgIT09IFwiIFwiKSB4cHIgKz0gYml0LmNvbWJpbmF0b3IgKyBcIiBcIlxyXG4gICAgICAgICAgICB4cHIgKz0gYml0XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJhdyA9IHhwclxyXG5cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yYXdcclxufVxyXG5cclxudmFyIHJlcGxhY2VyID0gZnVuY3Rpb24oXHJcbiAgICByYXdNYXRjaCxcclxuXHJcbiAgICBzZXBhcmF0b3IsXHJcbiAgICBjb21iaW5hdG9yLFxyXG4gICAgY29tYmluYXRvckNoaWxkcmVuLFxyXG5cclxuICAgIHRhZ05hbWUsXHJcbiAgICBpZCxcclxuICAgIGNsYXNzTmFtZSxcclxuXHJcbiAgICBhdHRyaWJ1dGVLZXksXHJcbiAgICBhdHRyaWJ1dGVPcGVyYXRvcixcclxuICAgIGF0dHJpYnV0ZVF1b3RlLFxyXG4gICAgYXR0cmlidXRlVmFsdWUsXHJcblxyXG4gICAgcHNldWRvTWFya2VyLFxyXG4gICAgcHNldWRvQ2xhc3MsXHJcbiAgICBwc2V1ZG9RdW90ZSxcclxuICAgIHBzZXVkb0NsYXNzUXVvdGVkVmFsdWUsXHJcbiAgICBwc2V1ZG9DbGFzc1ZhbHVlXHJcbil7XHJcblxyXG4gICAgdmFyIGV4cHJlc3Npb24sIGN1cnJlbnRcclxuXHJcbiAgICBpZiAoc2VwYXJhdG9yIHx8ICF0aGlzLmxlbmd0aCl7XHJcbiAgICAgICAgZXhwcmVzc2lvbiA9IHRoaXNbdGhpcy5sZW5ndGgrK10gPSBuZXcgRXhwcmVzc2lvblxyXG4gICAgICAgIGlmIChzZXBhcmF0b3IpIHJldHVybiAnJ1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZXhwcmVzc2lvbikgZXhwcmVzc2lvbiA9IHRoaXNbdGhpcy5sZW5ndGggLSAxXVxyXG5cclxuICAgIGlmIChjb21iaW5hdG9yIHx8IGNvbWJpbmF0b3JDaGlsZHJlbiB8fCAhZXhwcmVzc2lvbi5sZW5ndGgpe1xyXG4gICAgICAgIGN1cnJlbnQgPSBleHByZXNzaW9uW2V4cHJlc3Npb24ubGVuZ3RoKytdID0gbmV3IFBhcnQoY29tYmluYXRvcilcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWN1cnJlbnQpIGN1cnJlbnQgPSBleHByZXNzaW9uW2V4cHJlc3Npb24ubGVuZ3RoIC0gMV1cclxuXHJcbiAgICBpZiAodGFnTmFtZSl7XHJcblxyXG4gICAgICAgIGN1cnJlbnQudGFnID0gdW5lc2NhcGUodGFnTmFtZSlcclxuXHJcbiAgICB9IGVsc2UgaWYgKGlkKXtcclxuXHJcbiAgICAgICAgY3VycmVudC5pZCA9IHVuZXNjYXBlKGlkKVxyXG5cclxuICAgIH0gZWxzZSBpZiAoY2xhc3NOYW1lKXtcclxuXHJcbiAgICAgICAgdmFyIHVuZXNjYXBlZCA9IHVuZXNjYXBlKGNsYXNzTmFtZSlcclxuXHJcbiAgICAgICAgdmFyIGNsYXNzZXMgPSBjdXJyZW50LmNsYXNzZXMgfHwgKGN1cnJlbnQuY2xhc3NlcyA9IHt9KVxyXG4gICAgICAgIGlmICghY2xhc3Nlc1t1bmVzY2FwZWRdKXtcclxuICAgICAgICAgICAgY2xhc3Nlc1t1bmVzY2FwZWRdID0gZXNjYXBlKGNsYXNzTmFtZSlcclxuICAgICAgICAgICAgdmFyIGNsYXNzTGlzdCA9IGN1cnJlbnQuY2xhc3NMaXN0IHx8IChjdXJyZW50LmNsYXNzTGlzdCA9IFtdKVxyXG4gICAgICAgICAgICBjbGFzc0xpc3QucHVzaCh1bmVzY2FwZWQpXHJcbiAgICAgICAgICAgIGNsYXNzTGlzdC5zb3J0KClcclxuICAgICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmIChwc2V1ZG9DbGFzcyl7XHJcblxyXG4gICAgICAgIHBzZXVkb0NsYXNzVmFsdWUgPSBwc2V1ZG9DbGFzc1ZhbHVlIHx8IHBzZXVkb0NsYXNzUXVvdGVkVmFsdWVcclxuXHJcbiAgICAgICAgOyhjdXJyZW50LnBzZXVkb3MgfHwgKGN1cnJlbnQucHNldWRvcyA9IFtdKSkucHVzaCh7XHJcbiAgICAgICAgICAgIHR5cGUgICAgICAgICA6IHBzZXVkb01hcmtlci5sZW5ndGggPT0gMSA/ICdjbGFzcycgOiAnZWxlbWVudCcsXHJcbiAgICAgICAgICAgIG5hbWUgICAgICAgICA6IHVuZXNjYXBlKHBzZXVkb0NsYXNzKSxcclxuICAgICAgICAgICAgZXNjYXBlZE5hbWUgIDogZXNjYXBlKHBzZXVkb0NsYXNzKSxcclxuICAgICAgICAgICAgdmFsdWUgICAgICAgIDogcHNldWRvQ2xhc3NWYWx1ZSA/IHVuZXNjYXBlKHBzZXVkb0NsYXNzVmFsdWUpIDogbnVsbCxcclxuICAgICAgICAgICAgZXNjYXBlZFZhbHVlIDogcHNldWRvQ2xhc3NWYWx1ZSA/IGVzY2FwZShwc2V1ZG9DbGFzc1ZhbHVlKSA6IG51bGxcclxuICAgICAgICB9KVxyXG5cclxuICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlS2V5KXtcclxuXHJcbiAgICAgICAgYXR0cmlidXRlVmFsdWUgPSBhdHRyaWJ1dGVWYWx1ZSA/IGVzY2FwZShhdHRyaWJ1dGVWYWx1ZSkgOiBudWxsXHJcblxyXG4gICAgICAgIDsoY3VycmVudC5hdHRyaWJ1dGVzIHx8IChjdXJyZW50LmF0dHJpYnV0ZXMgPSBbXSkpLnB1c2goe1xyXG4gICAgICAgICAgICBvcGVyYXRvciAgICAgOiBhdHRyaWJ1dGVPcGVyYXRvcixcclxuICAgICAgICAgICAgbmFtZSAgICAgICAgIDogdW5lc2NhcGUoYXR0cmlidXRlS2V5KSxcclxuICAgICAgICAgICAgZXNjYXBlZE5hbWUgIDogZXNjYXBlKGF0dHJpYnV0ZUtleSksXHJcbiAgICAgICAgICAgIHZhbHVlICAgICAgICA6IGF0dHJpYnV0ZVZhbHVlID8gdW5lc2NhcGUoYXR0cmlidXRlVmFsdWUpIDogbnVsbCxcclxuICAgICAgICAgICAgZXNjYXBlZFZhbHVlIDogYXR0cmlidXRlVmFsdWUgPyBlc2NhcGUoYXR0cmlidXRlVmFsdWUpIDogbnVsbFxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAnJ1xyXG5cclxufVxyXG5cclxuLy8gRXhwcmVzc2lvbnNcclxuXHJcbnZhciBFeHByZXNzaW9ucyA9IGZ1bmN0aW9uIEV4cHJlc3Npb25zKGV4cHJlc3Npb24pe1xyXG4gICAgdGhpcy5sZW5ndGggPSAwXHJcblxyXG4gICAgdmFyIHNlbGYgPSB0aGlzXHJcblxyXG4gICAgdmFyIG9yaWdpbmFsID0gZXhwcmVzc2lvbiwgcmVwbGFjZWRcclxuXHJcbiAgICB3aGlsZSAoZXhwcmVzc2lvbil7XHJcbiAgICAgICAgcmVwbGFjZWQgPSBleHByZXNzaW9uLnJlcGxhY2Uoc2xpY2tSZSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcGxhY2VyLmFwcGx5KHNlbGYsIGFyZ3VtZW50cylcclxuICAgICAgICB9KVxyXG4gICAgICAgIGlmIChyZXBsYWNlZCA9PT0gZXhwcmVzc2lvbikgdGhyb3cgbmV3IEVycm9yKG9yaWdpbmFsICsgJyBpcyBhbiBpbnZhbGlkIGV4cHJlc3Npb24nKVxyXG4gICAgICAgIGV4cHJlc3Npb24gPSByZXBsYWNlZFxyXG4gICAgfVxyXG59XHJcblxyXG5FeHByZXNzaW9ucy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYgKCF0aGlzLnJhdyl7XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb25zID0gW11cclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgZXhwcmVzc2lvbjsgZXhwcmVzc2lvbiA9IHRoaXNbaSsrXTspIGV4cHJlc3Npb25zLnB1c2goZXhwcmVzc2lvbilcclxuICAgICAgICB0aGlzLnJhdyA9IGV4cHJlc3Npb25zLmpvaW4oXCIsIFwiKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnJhd1xyXG59XHJcblxyXG52YXIgY2FjaGUgPSB7fVxyXG5cclxudmFyIHBhcnNlID0gZnVuY3Rpb24oZXhwcmVzc2lvbil7XHJcbiAgICBpZiAoZXhwcmVzc2lvbiA9PSBudWxsKSByZXR1cm4gbnVsbFxyXG4gICAgZXhwcmVzc2lvbiA9ICgnJyArIGV4cHJlc3Npb24pLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKVxyXG4gICAgcmV0dXJuIGNhY2hlW2V4cHJlc3Npb25dIHx8IChjYWNoZVtleHByZXNzaW9uXSA9IG5ldyBFeHByZXNzaW9ucyhleHByZXNzaW9uKSlcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBwYXJzZVxyXG4iLCIvKiohXG4gKiBTb3J0YWJsZVxuICogQGF1dGhvclx0UnViYVhhICAgPHRyYXNoQHJ1YmF4YS5vcmc+XG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcblx0XHRkZWZpbmUoZmFjdG9yeSk7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBtb2R1bGUuZXhwb3J0cyAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mIFBhY2thZ2UgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRTb3J0YWJsZSA9IGZhY3RvcnkoKTsgIC8vIGV4cG9ydCBmb3IgTWV0ZW9yLmpzXG5cdH1cblx0ZWxzZSB7XG5cdFx0LyoganNoaW50IHN1Yjp0cnVlICovXG5cdFx0d2luZG93W1wiU29ydGFibGVcIl0gPSBmYWN0b3J5KCk7XG5cdH1cbn0pKGZ1bmN0aW9uICgpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0aWYgKHR5cGVvZiB3aW5kb3cgPT0gXCJ1bmRlZmluZWRcIiB8fCB0eXBlb2Ygd2luZG93LmRvY3VtZW50ID09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiU29ydGFibGUuanMgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50XCIgKTtcblx0XHR9XG5cdH1cblxuXHR2YXIgZHJhZ0VsLFxuXHRcdHBhcmVudEVsLFxuXHRcdGdob3N0RWwsXG5cdFx0Y2xvbmVFbCxcblx0XHRyb290RWwsXG5cdFx0bmV4dEVsLFxuXG5cdFx0c2Nyb2xsRWwsXG5cdFx0c2Nyb2xsUGFyZW50RWwsXG5cblx0XHRsYXN0RWwsXG5cdFx0bGFzdENTUyxcblx0XHRsYXN0UGFyZW50Q1NTLFxuXG5cdFx0b2xkSW5kZXgsXG5cdFx0bmV3SW5kZXgsXG5cblx0XHRhY3RpdmVHcm91cCxcblx0XHRhdXRvU2Nyb2xsID0ge30sXG5cblx0XHR0YXBFdnQsXG5cdFx0dG91Y2hFdnQsXG5cblx0XHRtb3ZlZCxcblxuXHRcdC8qKiBAY29uc3QgKi9cblx0XHRSU1BBQ0UgPSAvXFxzKy9nLFxuXG5cdFx0ZXhwYW5kbyA9ICdTb3J0YWJsZScgKyAobmV3IERhdGUpLmdldFRpbWUoKSxcblxuXHRcdHdpbiA9IHdpbmRvdyxcblx0XHRkb2N1bWVudCA9IHdpbi5kb2N1bWVudCxcblx0XHRwYXJzZUludCA9IHdpbi5wYXJzZUludCxcblxuXHRcdHN1cHBvcnREcmFnZ2FibGUgPSAhISgnZHJhZ2dhYmxlJyBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSksXG5cdFx0c3VwcG9ydENzc1BvaW50ZXJFdmVudHMgPSAoZnVuY3Rpb24gKGVsKSB7XG5cdFx0XHRlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3gnKTtcblx0XHRcdGVsLnN0eWxlLmNzc1RleHQgPSAncG9pbnRlci1ldmVudHM6YXV0byc7XG5cdFx0XHRyZXR1cm4gZWwuc3R5bGUucG9pbnRlckV2ZW50cyA9PT0gJ2F1dG8nO1xuXHRcdH0pKCksXG5cblx0XHRfc2lsZW50ID0gZmFsc2UsXG5cblx0XHRhYnMgPSBNYXRoLmFicyxcblx0XHRzbGljZSA9IFtdLnNsaWNlLFxuXG5cdFx0dG91Y2hEcmFnT3Zlckxpc3RlbmVycyA9IFtdLFxuXG5cdFx0X2F1dG9TY3JvbGwgPSBfdGhyb3R0bGUoZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQsIC8qKk9iamVjdCovb3B0aW9ucywgLyoqSFRNTEVsZW1lbnQqL3Jvb3RFbCkge1xuXHRcdFx0Ly8gQnVnOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD01MDU1MjFcblx0XHRcdGlmIChyb290RWwgJiYgb3B0aW9ucy5zY3JvbGwpIHtcblx0XHRcdFx0dmFyIGVsLFxuXHRcdFx0XHRcdHJlY3QsXG5cdFx0XHRcdFx0c2VucyA9IG9wdGlvbnMuc2Nyb2xsU2Vuc2l0aXZpdHksXG5cdFx0XHRcdFx0c3BlZWQgPSBvcHRpb25zLnNjcm9sbFNwZWVkLFxuXG5cdFx0XHRcdFx0eCA9IGV2dC5jbGllbnRYLFxuXHRcdFx0XHRcdHkgPSBldnQuY2xpZW50WSxcblxuXHRcdFx0XHRcdHdpbldpZHRoID0gd2luZG93LmlubmVyV2lkdGgsXG5cdFx0XHRcdFx0d2luSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0LFxuXG5cdFx0XHRcdFx0dngsXG5cdFx0XHRcdFx0dnlcblx0XHRcdFx0O1xuXG5cdFx0XHRcdC8vIERlbGVjdCBzY3JvbGxFbFxuXHRcdFx0XHRpZiAoc2Nyb2xsUGFyZW50RWwgIT09IHJvb3RFbCkge1xuXHRcdFx0XHRcdHNjcm9sbEVsID0gb3B0aW9ucy5zY3JvbGw7XG5cdFx0XHRcdFx0c2Nyb2xsUGFyZW50RWwgPSByb290RWw7XG5cblx0XHRcdFx0XHRpZiAoc2Nyb2xsRWwgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdHNjcm9sbEVsID0gcm9vdEVsO1xuXG5cdFx0XHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0XHRcdGlmICgoc2Nyb2xsRWwub2Zmc2V0V2lkdGggPCBzY3JvbGxFbC5zY3JvbGxXaWR0aCkgfHxcblx0XHRcdFx0XHRcdFx0XHQoc2Nyb2xsRWwub2Zmc2V0SGVpZ2h0IDwgc2Nyb2xsRWwuc2Nyb2xsSGVpZ2h0KVxuXHRcdFx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHQvKiBqc2hpbnQgYm9zczp0cnVlICovXG5cdFx0XHRcdFx0XHR9IHdoaWxlIChzY3JvbGxFbCA9IHNjcm9sbEVsLnBhcmVudE5vZGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzY3JvbGxFbCkge1xuXHRcdFx0XHRcdGVsID0gc2Nyb2xsRWw7XG5cdFx0XHRcdFx0cmVjdCA9IHNjcm9sbEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHRcdHZ4ID0gKGFicyhyZWN0LnJpZ2h0IC0geCkgPD0gc2VucykgLSAoYWJzKHJlY3QubGVmdCAtIHgpIDw9IHNlbnMpO1xuXHRcdFx0XHRcdHZ5ID0gKGFicyhyZWN0LmJvdHRvbSAtIHkpIDw9IHNlbnMpIC0gKGFicyhyZWN0LnRvcCAtIHkpIDw9IHNlbnMpO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRpZiAoISh2eCB8fCB2eSkpIHtcblx0XHRcdFx0XHR2eCA9ICh3aW5XaWR0aCAtIHggPD0gc2VucykgLSAoeCA8PSBzZW5zKTtcblx0XHRcdFx0XHR2eSA9ICh3aW5IZWlnaHQgLSB5IDw9IHNlbnMpIC0gKHkgPD0gc2Vucyk7XG5cblx0XHRcdFx0XHQvKiBqc2hpbnQgZXhwcjp0cnVlICovXG5cdFx0XHRcdFx0KHZ4IHx8IHZ5KSAmJiAoZWwgPSB3aW4pO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRpZiAoYXV0b1Njcm9sbC52eCAhPT0gdnggfHwgYXV0b1Njcm9sbC52eSAhPT0gdnkgfHwgYXV0b1Njcm9sbC5lbCAhPT0gZWwpIHtcblx0XHRcdFx0XHRhdXRvU2Nyb2xsLmVsID0gZWw7XG5cdFx0XHRcdFx0YXV0b1Njcm9sbC52eCA9IHZ4O1xuXHRcdFx0XHRcdGF1dG9TY3JvbGwudnkgPSB2eTtcblxuXHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoYXV0b1Njcm9sbC5waWQpO1xuXG5cdFx0XHRcdFx0aWYgKGVsKSB7XG5cdFx0XHRcdFx0XHRhdXRvU2Nyb2xsLnBpZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGVsID09PSB3aW4pIHtcblx0XHRcdFx0XHRcdFx0XHR3aW4uc2Nyb2xsVG8od2luLnBhZ2VYT2Zmc2V0ICsgdnggKiBzcGVlZCwgd2luLnBhZ2VZT2Zmc2V0ICsgdnkgKiBzcGVlZCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0dnkgJiYgKGVsLnNjcm9sbFRvcCArPSB2eSAqIHNwZWVkKTtcblx0XHRcdFx0XHRcdFx0XHR2eCAmJiAoZWwuc2Nyb2xsTGVmdCArPSB2eCAqIHNwZWVkKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSwgMjQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sIDMwKSxcblxuXHRcdF9wcmVwYXJlR3JvdXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXHRcdFx0dmFyIGdyb3VwID0gb3B0aW9ucy5ncm91cDtcblxuXHRcdFx0aWYgKCFncm91cCB8fCB0eXBlb2YgZ3JvdXAgIT0gJ29iamVjdCcpIHtcblx0XHRcdFx0Z3JvdXAgPSBvcHRpb25zLmdyb3VwID0ge25hbWU6IGdyb3VwfTtcblx0XHRcdH1cblxuXHRcdFx0WydwdWxsJywgJ3B1dCddLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXHRcdFx0XHRpZiAoIShrZXkgaW4gZ3JvdXApKSB7XG5cdFx0XHRcdFx0Z3JvdXBba2V5XSA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRvcHRpb25zLmdyb3VwcyA9ICcgJyArIGdyb3VwLm5hbWUgKyAoZ3JvdXAucHV0LmpvaW4gPyAnICcgKyBncm91cC5wdXQuam9pbignICcpIDogJycpICsgJyAnO1xuXHRcdH1cblx0O1xuXG5cblxuXHQvKipcblx0ICogQGNsYXNzICBTb3J0YWJsZVxuXHQgKiBAcGFyYW0gIHtIVE1MRWxlbWVudH0gIGVsXG5cdCAqIEBwYXJhbSAge09iamVjdH0gICAgICAgW29wdGlvbnNdXG5cdCAqL1xuXHRmdW5jdGlvbiBTb3J0YWJsZShlbCwgb3B0aW9ucykge1xuXHRcdGlmICghKGVsICYmIGVsLm5vZGVUeXBlICYmIGVsLm5vZGVUeXBlID09PSAxKSkge1xuXHRcdFx0dGhyb3cgJ1NvcnRhYmxlOiBgZWxgIG11c3QgYmUgSFRNTEVsZW1lbnQsIGFuZCBub3QgJyArIHt9LnRvU3RyaW5nLmNhbGwoZWwpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWwgPSBlbDsgLy8gcm9vdCBlbGVtZW50XG5cdFx0dGhpcy5vcHRpb25zID0gb3B0aW9ucyA9IF9leHRlbmQoe30sIG9wdGlvbnMpO1xuXG5cblx0XHQvLyBFeHBvcnQgaW5zdGFuY2Vcblx0XHRlbFtleHBhbmRvXSA9IHRoaXM7XG5cblxuXHRcdC8vIERlZmF1bHQgb3B0aW9uc1xuXHRcdHZhciBkZWZhdWx0cyA9IHtcblx0XHRcdGdyb3VwOiBNYXRoLnJhbmRvbSgpLFxuXHRcdFx0c29ydDogdHJ1ZSxcblx0XHRcdGRpc2FibGVkOiBmYWxzZSxcblx0XHRcdHN0b3JlOiBudWxsLFxuXHRcdFx0aGFuZGxlOiBudWxsLFxuXHRcdFx0c2Nyb2xsOiB0cnVlLFxuXHRcdFx0c2Nyb2xsU2Vuc2l0aXZpdHk6IDMwLFxuXHRcdFx0c2Nyb2xsU3BlZWQ6IDEwLFxuXHRcdFx0ZHJhZ2dhYmxlOiAvW3VvXWwvaS50ZXN0KGVsLm5vZGVOYW1lKSA/ICdsaScgOiAnPionLFxuXHRcdFx0Z2hvc3RDbGFzczogJ3NvcnRhYmxlLWdob3N0Jyxcblx0XHRcdGNob3NlbkNsYXNzOiAnc29ydGFibGUtY2hvc2VuJyxcblx0XHRcdGlnbm9yZTogJ2EsIGltZycsXG5cdFx0XHRmaWx0ZXI6IG51bGwsXG5cdFx0XHRhbmltYXRpb246IDAsXG5cdFx0XHRzZXREYXRhOiBmdW5jdGlvbiAoZGF0YVRyYW5zZmVyLCBkcmFnRWwpIHtcblx0XHRcdFx0ZGF0YVRyYW5zZmVyLnNldERhdGEoJ1RleHQnLCBkcmFnRWwudGV4dENvbnRlbnQpO1xuXHRcdFx0fSxcblx0XHRcdGRyb3BCdWJibGU6IGZhbHNlLFxuXHRcdFx0ZHJhZ292ZXJCdWJibGU6IGZhbHNlLFxuXHRcdFx0ZGF0YUlkQXR0cjogJ2RhdGEtaWQnLFxuXHRcdFx0ZGVsYXk6IDAsXG5cdFx0XHRmb3JjZUZhbGxiYWNrOiBmYWxzZSxcblx0XHRcdGZhbGxiYWNrQ2xhc3M6ICdzb3J0YWJsZS1mYWxsYmFjaycsXG5cdFx0XHRmYWxsYmFja09uQm9keTogZmFsc2Vcblx0XHR9O1xuXG5cblx0XHQvLyBTZXQgZGVmYXVsdCBvcHRpb25zXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBkZWZhdWx0cykge1xuXHRcdFx0IShuYW1lIGluIG9wdGlvbnMpICYmIChvcHRpb25zW25hbWVdID0gZGVmYXVsdHNbbmFtZV0pO1xuXHRcdH1cblxuXHRcdF9wcmVwYXJlR3JvdXAob3B0aW9ucyk7XG5cblx0XHQvLyBCaW5kIGFsbCBwcml2YXRlIG1ldGhvZHNcblx0XHRmb3IgKHZhciBmbiBpbiB0aGlzKSB7XG5cdFx0XHRpZiAoZm4uY2hhckF0KDApID09PSAnXycpIHtcblx0XHRcdFx0dGhpc1tmbl0gPSB0aGlzW2ZuXS5iaW5kKHRoaXMpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFNldHVwIGRyYWcgbW9kZVxuXHRcdHRoaXMubmF0aXZlRHJhZ2dhYmxlID0gb3B0aW9ucy5mb3JjZUZhbGxiYWNrID8gZmFsc2UgOiBzdXBwb3J0RHJhZ2dhYmxlO1xuXG5cdFx0Ly8gQmluZCBldmVudHNcblx0XHRfb24oZWwsICdtb3VzZWRvd24nLCB0aGlzLl9vblRhcFN0YXJ0KTtcblx0XHRfb24oZWwsICd0b3VjaHN0YXJ0JywgdGhpcy5fb25UYXBTdGFydCk7XG5cblx0XHRpZiAodGhpcy5uYXRpdmVEcmFnZ2FibGUpIHtcblx0XHRcdF9vbihlbCwgJ2RyYWdvdmVyJywgdGhpcyk7XG5cdFx0XHRfb24oZWwsICdkcmFnZW50ZXInLCB0aGlzKTtcblx0XHR9XG5cblx0XHR0b3VjaERyYWdPdmVyTGlzdGVuZXJzLnB1c2godGhpcy5fb25EcmFnT3Zlcik7XG5cblx0XHQvLyBSZXN0b3JlIHNvcnRpbmdcblx0XHRvcHRpb25zLnN0b3JlICYmIHRoaXMuc29ydChvcHRpb25zLnN0b3JlLmdldCh0aGlzKSk7XG5cdH1cblxuXG5cdFNvcnRhYmxlLnByb3RvdHlwZSA9IC8qKiBAbGVuZHMgU29ydGFibGUucHJvdG90eXBlICovIHtcblx0XHRjb25zdHJ1Y3RvcjogU29ydGFibGUsXG5cblx0XHRfb25UYXBTdGFydDogZnVuY3Rpb24gKC8qKiBFdmVudHxUb3VjaEV2ZW50ICovZXZ0KSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzLFxuXHRcdFx0XHRlbCA9IHRoaXMuZWwsXG5cdFx0XHRcdG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG5cdFx0XHRcdHR5cGUgPSBldnQudHlwZSxcblx0XHRcdFx0dG91Y2ggPSBldnQudG91Y2hlcyAmJiBldnQudG91Y2hlc1swXSxcblx0XHRcdFx0dGFyZ2V0ID0gKHRvdWNoIHx8IGV2dCkudGFyZ2V0LFxuXHRcdFx0XHRvcmlnaW5hbFRhcmdldCA9IHRhcmdldCxcblx0XHRcdFx0ZmlsdGVyID0gb3B0aW9ucy5maWx0ZXI7XG5cblxuXHRcdFx0aWYgKHR5cGUgPT09ICdtb3VzZWRvd24nICYmIGV2dC5idXR0b24gIT09IDAgfHwgb3B0aW9ucy5kaXNhYmxlZCkge1xuXHRcdFx0XHRyZXR1cm47IC8vIG9ubHkgbGVmdCBidXR0b24gb3IgZW5hYmxlZFxuXHRcdFx0fVxuXG5cdFx0XHR0YXJnZXQgPSBfY2xvc2VzdCh0YXJnZXQsIG9wdGlvbnMuZHJhZ2dhYmxlLCBlbCk7XG5cblx0XHRcdGlmICghdGFyZ2V0KSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gZ2V0IHRoZSBpbmRleCBvZiB0aGUgZHJhZ2dlZCBlbGVtZW50IHdpdGhpbiBpdHMgcGFyZW50XG5cdFx0XHRvbGRJbmRleCA9IF9pbmRleCh0YXJnZXQsIG9wdGlvbnMuZHJhZ2dhYmxlKTtcblxuXHRcdFx0Ly8gQ2hlY2sgZmlsdGVyXG5cdFx0XHRpZiAodHlwZW9mIGZpbHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAoZmlsdGVyLmNhbGwodGhpcywgZXZ0LCB0YXJnZXQsIHRoaXMpKSB7XG5cdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQoX3RoaXMsIG9yaWdpbmFsVGFyZ2V0LCAnZmlsdGVyJywgdGFyZ2V0LCBlbCwgb2xkSW5kZXgpO1xuXHRcdFx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHJldHVybjsgLy8gY2FuY2VsIGRuZFxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0ZmlsdGVyID0gZmlsdGVyLnNwbGl0KCcsJykuc29tZShmdW5jdGlvbiAoY3JpdGVyaWEpIHtcblx0XHRcdFx0XHRjcml0ZXJpYSA9IF9jbG9zZXN0KG9yaWdpbmFsVGFyZ2V0LCBjcml0ZXJpYS50cmltKCksIGVsKTtcblxuXHRcdFx0XHRcdGlmIChjcml0ZXJpYSkge1xuXHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQoX3RoaXMsIGNyaXRlcmlhLCAnZmlsdGVyJywgdGFyZ2V0LCBlbCwgb2xkSW5kZXgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoZmlsdGVyKSB7XG5cdFx0XHRcdFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0cmV0dXJuOyAvLyBjYW5jZWwgZG5kXG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXG5cdFx0XHRpZiAob3B0aW9ucy5oYW5kbGUgJiYgIV9jbG9zZXN0KG9yaWdpbmFsVGFyZ2V0LCBvcHRpb25zLmhhbmRsZSwgZWwpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXG5cdFx0XHQvLyBQcmVwYXJlIGBkcmFnc3RhcnRgXG5cdFx0XHR0aGlzLl9wcmVwYXJlRHJhZ1N0YXJ0KGV2dCwgdG91Y2gsIHRhcmdldCk7XG5cdFx0fSxcblxuXHRcdF9wcmVwYXJlRHJhZ1N0YXJ0OiBmdW5jdGlvbiAoLyoqIEV2ZW50ICovZXZ0LCAvKiogVG91Y2ggKi90b3VjaCwgLyoqIEhUTUxFbGVtZW50ICovdGFyZ2V0KSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzLFxuXHRcdFx0XHRlbCA9IF90aGlzLmVsLFxuXHRcdFx0XHRvcHRpb25zID0gX3RoaXMub3B0aW9ucyxcblx0XHRcdFx0b3duZXJEb2N1bWVudCA9IGVsLm93bmVyRG9jdW1lbnQsXG5cdFx0XHRcdGRyYWdTdGFydEZuO1xuXG5cdFx0XHRpZiAodGFyZ2V0ICYmICFkcmFnRWwgJiYgKHRhcmdldC5wYXJlbnROb2RlID09PSBlbCkpIHtcblx0XHRcdFx0dGFwRXZ0ID0gZXZ0O1xuXG5cdFx0XHRcdHJvb3RFbCA9IGVsO1xuXHRcdFx0XHRkcmFnRWwgPSB0YXJnZXQ7XG5cdFx0XHRcdHBhcmVudEVsID0gZHJhZ0VsLnBhcmVudE5vZGU7XG5cdFx0XHRcdG5leHRFbCA9IGRyYWdFbC5uZXh0U2libGluZztcblx0XHRcdFx0YWN0aXZlR3JvdXAgPSBvcHRpb25zLmdyb3VwO1xuXG5cdFx0XHRcdGRyYWdTdGFydEZuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdC8vIERlbGF5ZWQgZHJhZyBoYXMgYmVlbiB0cmlnZ2VyZWRcblx0XHRcdFx0XHQvLyB3ZSBjYW4gcmUtZW5hYmxlIHRoZSBldmVudHM6IHRvdWNobW92ZS9tb3VzZW1vdmVcblx0XHRcdFx0XHRfdGhpcy5fZGlzYWJsZURlbGF5ZWREcmFnKCk7XG5cblx0XHRcdFx0XHQvLyBNYWtlIHRoZSBlbGVtZW50IGRyYWdnYWJsZVxuXHRcdFx0XHRcdGRyYWdFbC5kcmFnZ2FibGUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0Ly8gQ2hvc2VuIGl0ZW1cblx0XHRcdFx0XHRfdG9nZ2xlQ2xhc3MoZHJhZ0VsLCBfdGhpcy5vcHRpb25zLmNob3NlbkNsYXNzLCB0cnVlKTtcblxuXHRcdFx0XHRcdC8vIEJpbmQgdGhlIGV2ZW50czogZHJhZ3N0YXJ0L2RyYWdlbmRcblx0XHRcdFx0XHRfdGhpcy5fdHJpZ2dlckRyYWdTdGFydCh0b3VjaCk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0Ly8gRGlzYWJsZSBcImRyYWdnYWJsZVwiXG5cdFx0XHRcdG9wdGlvbnMuaWdub3JlLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbiAoY3JpdGVyaWEpIHtcblx0XHRcdFx0XHRfZmluZChkcmFnRWwsIGNyaXRlcmlhLnRyaW0oKSwgX2Rpc2FibGVEcmFnZ2FibGUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRfb24ob3duZXJEb2N1bWVudCwgJ21vdXNldXAnLCBfdGhpcy5fb25Ecm9wKTtcblx0XHRcdFx0X29uKG93bmVyRG9jdW1lbnQsICd0b3VjaGVuZCcsIF90aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHRfb24ob3duZXJEb2N1bWVudCwgJ3RvdWNoY2FuY2VsJywgX3RoaXMuX29uRHJvcCk7XG5cblx0XHRcdFx0aWYgKG9wdGlvbnMuZGVsYXkpIHtcblx0XHRcdFx0XHQvLyBJZiB0aGUgdXNlciBtb3ZlcyB0aGUgcG9pbnRlciBvciBsZXQgZ28gdGhlIGNsaWNrIG9yIHRvdWNoXG5cdFx0XHRcdFx0Ly8gYmVmb3JlIHRoZSBkZWxheSBoYXMgYmVlbiByZWFjaGVkOlxuXHRcdFx0XHRcdC8vIGRpc2FibGUgdGhlIGRlbGF5ZWQgZHJhZ1xuXHRcdFx0XHRcdF9vbihvd25lckRvY3VtZW50LCAnbW91c2V1cCcsIF90aGlzLl9kaXNhYmxlRGVsYXllZERyYWcpO1xuXHRcdFx0XHRcdF9vbihvd25lckRvY3VtZW50LCAndG91Y2hlbmQnLCBfdGhpcy5fZGlzYWJsZURlbGF5ZWREcmFnKTtcblx0XHRcdFx0XHRfb24ob3duZXJEb2N1bWVudCwgJ3RvdWNoY2FuY2VsJywgX3RoaXMuX2Rpc2FibGVEZWxheWVkRHJhZyk7XG5cdFx0XHRcdFx0X29uKG93bmVyRG9jdW1lbnQsICdtb3VzZW1vdmUnLCBfdGhpcy5fZGlzYWJsZURlbGF5ZWREcmFnKTtcblx0XHRcdFx0XHRfb24ob3duZXJEb2N1bWVudCwgJ3RvdWNobW92ZScsIF90aGlzLl9kaXNhYmxlRGVsYXllZERyYWcpO1xuXG5cdFx0XHRcdFx0X3RoaXMuX2RyYWdTdGFydFRpbWVyID0gc2V0VGltZW91dChkcmFnU3RhcnRGbiwgb3B0aW9ucy5kZWxheSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZHJhZ1N0YXJ0Rm4oKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRfZGlzYWJsZURlbGF5ZWREcmFnOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgb3duZXJEb2N1bWVudCA9IHRoaXMuZWwub3duZXJEb2N1bWVudDtcblxuXHRcdFx0Y2xlYXJUaW1lb3V0KHRoaXMuX2RyYWdTdGFydFRpbWVyKTtcblx0XHRcdF9vZmYob3duZXJEb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9kaXNhYmxlRGVsYXllZERyYWcpO1xuXHRcdFx0X29mZihvd25lckRvY3VtZW50LCAndG91Y2hlbmQnLCB0aGlzLl9kaXNhYmxlRGVsYXllZERyYWcpO1xuXHRcdFx0X29mZihvd25lckRvY3VtZW50LCAndG91Y2hjYW5jZWwnLCB0aGlzLl9kaXNhYmxlRGVsYXllZERyYWcpO1xuXHRcdFx0X29mZihvd25lckRvY3VtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5fZGlzYWJsZURlbGF5ZWREcmFnKTtcblx0XHRcdF9vZmYob3duZXJEb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX2Rpc2FibGVEZWxheWVkRHJhZyk7XG5cdFx0fSxcblxuXHRcdF90cmlnZ2VyRHJhZ1N0YXJ0OiBmdW5jdGlvbiAoLyoqIFRvdWNoICovdG91Y2gpIHtcblx0XHRcdGlmICh0b3VjaCkge1xuXHRcdFx0XHQvLyBUb3VjaCBkZXZpY2Ugc3VwcG9ydFxuXHRcdFx0XHR0YXBFdnQgPSB7XG5cdFx0XHRcdFx0dGFyZ2V0OiBkcmFnRWwsXG5cdFx0XHRcdFx0Y2xpZW50WDogdG91Y2guY2xpZW50WCxcblx0XHRcdFx0XHRjbGllbnRZOiB0b3VjaC5jbGllbnRZXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0dGhpcy5fb25EcmFnU3RhcnQodGFwRXZ0LCAndG91Y2gnKTtcblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKCF0aGlzLm5hdGl2ZURyYWdnYWJsZSkge1xuXHRcdFx0XHR0aGlzLl9vbkRyYWdTdGFydCh0YXBFdnQsIHRydWUpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdF9vbihkcmFnRWwsICdkcmFnZW5kJywgdGhpcyk7XG5cdFx0XHRcdF9vbihyb290RWwsICdkcmFnc3RhcnQnLCB0aGlzLl9vbkRyYWdTdGFydCk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHtcblx0XHRcdFx0XHRkb2N1bWVudC5zZWxlY3Rpb24uZW1wdHkoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRfZHJhZ1N0YXJ0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChyb290RWwgJiYgZHJhZ0VsKSB7XG5cdFx0XHRcdC8vIEFwcGx5IGVmZmVjdFxuXHRcdFx0XHRfdG9nZ2xlQ2xhc3MoZHJhZ0VsLCB0aGlzLm9wdGlvbnMuZ2hvc3RDbGFzcywgdHJ1ZSk7XG5cblx0XHRcdFx0U29ydGFibGUuYWN0aXZlID0gdGhpcztcblxuXHRcdFx0XHQvLyBEcmFnIHN0YXJ0IGV2ZW50XG5cdFx0XHRcdF9kaXNwYXRjaEV2ZW50KHRoaXMsIHJvb3RFbCwgJ3N0YXJ0JywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X2VtdWxhdGVEcmFnT3ZlcjogZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKHRvdWNoRXZ0KSB7XG5cdFx0XHRcdGlmICh0aGlzLl9sYXN0WCA9PT0gdG91Y2hFdnQuY2xpZW50WCAmJiB0aGlzLl9sYXN0WSA9PT0gdG91Y2hFdnQuY2xpZW50WSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuX2xhc3RYID0gdG91Y2hFdnQuY2xpZW50WDtcblx0XHRcdFx0dGhpcy5fbGFzdFkgPSB0b3VjaEV2dC5jbGllbnRZO1xuXG5cdFx0XHRcdGlmICghc3VwcG9ydENzc1BvaW50ZXJFdmVudHMpIHtcblx0XHRcdFx0XHRfY3NzKGdob3N0RWwsICdkaXNwbGF5JywgJ25vbmUnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciB0YXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KHRvdWNoRXZ0LmNsaWVudFgsIHRvdWNoRXZ0LmNsaWVudFkpLFxuXHRcdFx0XHRcdHBhcmVudCA9IHRhcmdldCxcblx0XHRcdFx0XHRncm91cE5hbWUgPSAnICcgKyB0aGlzLm9wdGlvbnMuZ3JvdXAubmFtZSArICcnLFxuXHRcdFx0XHRcdGkgPSB0b3VjaERyYWdPdmVyTGlzdGVuZXJzLmxlbmd0aDtcblxuXHRcdFx0XHRpZiAocGFyZW50KSB7XG5cdFx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdFx0aWYgKHBhcmVudFtleHBhbmRvXSAmJiBwYXJlbnRbZXhwYW5kb10ub3B0aW9ucy5ncm91cHMuaW5kZXhPZihncm91cE5hbWUpID4gLTEpIHtcblx0XHRcdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0XHRcdHRvdWNoRHJhZ092ZXJMaXN0ZW5lcnNbaV0oe1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2xpZW50WDogdG91Y2hFdnQuY2xpZW50WCxcblx0XHRcdFx0XHRcdFx0XHRcdGNsaWVudFk6IHRvdWNoRXZ0LmNsaWVudFksXG5cdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXQ6IHRhcmdldCxcblx0XHRcdFx0XHRcdFx0XHRcdHJvb3RFbDogcGFyZW50XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dGFyZ2V0ID0gcGFyZW50OyAvLyBzdG9yZSBsYXN0IGVsZW1lbnRcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0LyoganNoaW50IGJvc3M6dHJ1ZSAqL1xuXHRcdFx0XHRcdHdoaWxlIChwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIXN1cHBvcnRDc3NQb2ludGVyRXZlbnRzKSB7XG5cdFx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnZGlzcGxheScsICcnKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblxuXHRcdF9vblRvdWNoTW92ZTogZnVuY3Rpb24gKC8qKlRvdWNoRXZlbnQqL2V2dCkge1xuXHRcdFx0aWYgKHRhcEV2dCkge1xuXHRcdFx0XHQvLyBvbmx5IHNldCB0aGUgc3RhdHVzIHRvIGRyYWdnaW5nLCB3aGVuIHdlIGFyZSBhY3R1YWxseSBkcmFnZ2luZ1xuXHRcdFx0XHRpZiAoIVNvcnRhYmxlLmFjdGl2ZSkge1xuXHRcdFx0XHRcdHRoaXMuX2RyYWdTdGFydGVkKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBhcyB3ZWxsIGFzIGNyZWF0aW5nIHRoZSBnaG9zdCBlbGVtZW50IG9uIHRoZSBkb2N1bWVudCBib2R5XG5cdFx0XHRcdHRoaXMuX2FwcGVuZEdob3N0KCk7XG5cblx0XHRcdFx0dmFyIHRvdWNoID0gZXZ0LnRvdWNoZXMgPyBldnQudG91Y2hlc1swXSA6IGV2dCxcblx0XHRcdFx0XHRkeCA9IHRvdWNoLmNsaWVudFggLSB0YXBFdnQuY2xpZW50WCxcblx0XHRcdFx0XHRkeSA9IHRvdWNoLmNsaWVudFkgLSB0YXBFdnQuY2xpZW50WSxcblx0XHRcdFx0XHR0cmFuc2xhdGUzZCA9IGV2dC50b3VjaGVzID8gJ3RyYW5zbGF0ZTNkKCcgKyBkeCArICdweCwnICsgZHkgKyAncHgsMCknIDogJ3RyYW5zbGF0ZSgnICsgZHggKyAncHgsJyArIGR5ICsgJ3B4KSc7XG5cblx0XHRcdFx0bW92ZWQgPSB0cnVlO1xuXHRcdFx0XHR0b3VjaEV2dCA9IHRvdWNoO1xuXG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3dlYmtpdFRyYW5zZm9ybScsIHRyYW5zbGF0ZTNkKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnbW96VHJhbnNmb3JtJywgdHJhbnNsYXRlM2QpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdtc1RyYW5zZm9ybScsIHRyYW5zbGF0ZTNkKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAndHJhbnNmb3JtJywgdHJhbnNsYXRlM2QpO1xuXG5cdFx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRfYXBwZW5kR2hvc3Q6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmICghZ2hvc3RFbCkge1xuXHRcdFx0XHR2YXIgcmVjdCA9IGRyYWdFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcblx0XHRcdFx0XHRjc3MgPSBfY3NzKGRyYWdFbCksXG5cdFx0XHRcdFx0b3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcblx0XHRcdFx0XHRnaG9zdFJlY3Q7XG5cblx0XHRcdFx0Z2hvc3RFbCA9IGRyYWdFbC5jbG9uZU5vZGUodHJ1ZSk7XG5cblx0XHRcdFx0X3RvZ2dsZUNsYXNzKGdob3N0RWwsIG9wdGlvbnMuZ2hvc3RDbGFzcywgZmFsc2UpO1xuXHRcdFx0XHRfdG9nZ2xlQ2xhc3MoZ2hvc3RFbCwgb3B0aW9ucy5mYWxsYmFja0NsYXNzLCB0cnVlKTtcblxuXHRcdFx0XHRfY3NzKGdob3N0RWwsICd0b3AnLCByZWN0LnRvcCAtIHBhcnNlSW50KGNzcy5tYXJnaW5Ub3AsIDEwKSk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ2xlZnQnLCByZWN0LmxlZnQgLSBwYXJzZUludChjc3MubWFyZ2luTGVmdCwgMTApKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnd2lkdGgnLCByZWN0LndpZHRoKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnaGVpZ2h0JywgcmVjdC5oZWlnaHQpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdvcGFjaXR5JywgJzAuOCcpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdwb3NpdGlvbicsICdmaXhlZCcpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICd6SW5kZXgnLCAnMTAwMDAwJyk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3BvaW50ZXJFdmVudHMnLCAnbm9uZScpO1xuXG5cdFx0XHRcdG9wdGlvbnMuZmFsbGJhY2tPbkJvZHkgJiYgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChnaG9zdEVsKSB8fCByb290RWwuYXBwZW5kQ2hpbGQoZ2hvc3RFbCk7XG5cblx0XHRcdFx0Ly8gRml4aW5nIGRpbWVuc2lvbnMuXG5cdFx0XHRcdGdob3N0UmVjdCA9IGdob3N0RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3dpZHRoJywgcmVjdC53aWR0aCAqIDIgLSBnaG9zdFJlY3Qud2lkdGgpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdoZWlnaHQnLCByZWN0LmhlaWdodCAqIDIgLSBnaG9zdFJlY3QuaGVpZ2h0KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X29uRHJhZ1N0YXJ0OiBmdW5jdGlvbiAoLyoqRXZlbnQqL2V2dCwgLyoqYm9vbGVhbiovdXNlRmFsbGJhY2spIHtcblx0XHRcdHZhciBkYXRhVHJhbnNmZXIgPSBldnQuZGF0YVRyYW5zZmVyLFxuXHRcdFx0XHRvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG5cdFx0XHR0aGlzLl9vZmZVcEV2ZW50cygpO1xuXG5cdFx0XHRpZiAoYWN0aXZlR3JvdXAucHVsbCA9PSAnY2xvbmUnKSB7XG5cdFx0XHRcdGNsb25lRWwgPSBkcmFnRWwuY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0XHRfY3NzKGNsb25lRWwsICdkaXNwbGF5JywgJ25vbmUnKTtcblx0XHRcdFx0cm9vdEVsLmluc2VydEJlZm9yZShjbG9uZUVsLCBkcmFnRWwpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodXNlRmFsbGJhY2spIHtcblxuXHRcdFx0XHRpZiAodXNlRmFsbGJhY2sgPT09ICd0b3VjaCcpIHtcblx0XHRcdFx0XHQvLyBCaW5kIHRvdWNoIGV2ZW50c1xuXHRcdFx0XHRcdF9vbihkb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTtcblx0XHRcdFx0XHRfb24oZG9jdW1lbnQsICd0b3VjaGVuZCcsIHRoaXMuX29uRHJvcCk7XG5cdFx0XHRcdFx0X29uKGRvY3VtZW50LCAndG91Y2hjYW5jZWwnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIE9sZCBicndvc2VyXG5cdFx0XHRcdFx0X29uKGRvY3VtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpO1xuXHRcdFx0XHRcdF9vbihkb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fbG9vcElkID0gc2V0SW50ZXJ2YWwodGhpcy5fZW11bGF0ZURyYWdPdmVyLCA1MCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0aWYgKGRhdGFUcmFuc2Zlcikge1xuXHRcdFx0XHRcdGRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuXHRcdFx0XHRcdG9wdGlvbnMuc2V0RGF0YSAmJiBvcHRpb25zLnNldERhdGEuY2FsbCh0aGlzLCBkYXRhVHJhbnNmZXIsIGRyYWdFbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRfb24oZG9jdW1lbnQsICdkcm9wJywgdGhpcyk7XG5cdFx0XHRcdHNldFRpbWVvdXQodGhpcy5fZHJhZ1N0YXJ0ZWQsIDApO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRfb25EcmFnT3ZlcjogZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRcdHZhciBlbCA9IHRoaXMuZWwsXG5cdFx0XHRcdHRhcmdldCxcblx0XHRcdFx0ZHJhZ1JlY3QsXG5cdFx0XHRcdHJldmVydCxcblx0XHRcdFx0b3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcblx0XHRcdFx0Z3JvdXAgPSBvcHRpb25zLmdyb3VwLFxuXHRcdFx0XHRncm91cFB1dCA9IGdyb3VwLnB1dCxcblx0XHRcdFx0aXNPd25lciA9IChhY3RpdmVHcm91cCA9PT0gZ3JvdXApLFxuXHRcdFx0XHRjYW5Tb3J0ID0gb3B0aW9ucy5zb3J0O1xuXG5cdFx0XHRpZiAoZXZ0LnByZXZlbnREZWZhdWx0ICE9PSB2b2lkIDApIHtcblx0XHRcdFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCFvcHRpb25zLmRyYWdvdmVyQnViYmxlICYmIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH1cblxuXHRcdFx0bW92ZWQgPSB0cnVlO1xuXG5cdFx0XHRfZGlzcGF0Y2hFdmVudCh0aGlzLCByb290RWwsICdvdmVyJywgZHJhZ0VsLCByb290RWwsIGV2dCwgZXZ0LnRhcmdldCk7IC8vIEdhbnRyeSA1XG5cdFx0XHRpZiAoYWN0aXZlR3JvdXAgJiYgIW9wdGlvbnMuZGlzYWJsZWQgJiZcblx0XHRcdFx0KGlzT3duZXJcblx0XHRcdFx0XHQ/IGNhblNvcnQgfHwgKHJldmVydCA9ICFyb290RWwuY29udGFpbnMoZHJhZ0VsKSkgLy8gUmV2ZXJ0aW5nIGl0ZW0gaW50byB0aGUgb3JpZ2luYWwgbGlzdFxuXHRcdFx0XHRcdDogYWN0aXZlR3JvdXAucHVsbCAmJiBncm91cFB1dCAmJiAoXG5cdFx0XHRcdFx0XHQoYWN0aXZlR3JvdXAubmFtZSA9PT0gZ3JvdXAubmFtZSkgfHwgLy8gYnkgTmFtZVxuXHRcdFx0XHRcdFx0KGdyb3VwUHV0LmluZGV4T2YgJiYgfmdyb3VwUHV0LmluZGV4T2YoYWN0aXZlR3JvdXAubmFtZSkpIC8vIGJ5IEFycmF5XG5cdFx0XHRcdFx0KVxuXHRcdFx0XHQpICYmXG5cdFx0XHRcdChldnQucm9vdEVsID09PSB2b2lkIDAgfHwgZXZ0LnJvb3RFbCA9PT0gdGhpcy5lbCkgLy8gdG91Y2ggZmFsbGJhY2tcblx0XHRcdCkge1xuXHRcdFx0XHQvLyBTbWFydCBhdXRvLXNjcm9sbGluZ1xuXHRcdFx0XHRfYXV0b1Njcm9sbChldnQsIG9wdGlvbnMsIHRoaXMuZWwpO1xuXG5cdFx0XHRcdGlmIChfc2lsZW50KSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFyZ2V0ID0gX2Nsb3Nlc3QoZXZ0LnRhcmdldCwgb3B0aW9ucy5kcmFnZ2FibGUsIGVsKTtcblx0XHRcdFx0ZHJhZ1JlY3QgPSBkcmFnRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cblx0XHRcdFx0aWYgKHJldmVydCkge1xuXHRcdFx0XHRcdF9jbG9uZUhpZGUodHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAoY2xvbmVFbCB8fCBuZXh0RWwpIHtcblx0XHRcdFx0XHRcdHJvb3RFbC5pbnNlcnRCZWZvcmUoZHJhZ0VsLCBjbG9uZUVsIHx8IG5leHRFbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2UgaWYgKCFjYW5Tb3J0KSB7XG5cdFx0XHRcdFx0XHRyb290RWwuYXBwZW5kQ2hpbGQoZHJhZ0VsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXG5cdFx0XHRcdGlmICgoZWwuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB8fCAoZWwuY2hpbGRyZW5bMF0gPT09IGdob3N0RWwpIHx8XG5cdFx0XHRcdFx0KGVsID09PSBldnQudGFyZ2V0KSAmJiAodGFyZ2V0ID0gX2dob3N0SXNMYXN0KGVsLCBldnQpKVxuXHRcdFx0XHQpIHtcblxuXHRcdFx0XHRcdGlmICh0YXJnZXQpIHtcblx0XHRcdFx0XHRcdGlmICh0YXJnZXQuYW5pbWF0ZWQpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdF9jbG9uZUhpZGUoaXNPd25lcik7XG5cblx0XHRcdFx0XHRpZiAoX29uTW92ZShyb290RWwsIGVsLCBkcmFnRWwsIGRyYWdSZWN0LCB0YXJnZXQsIHRhcmdldFJlY3QpICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0aWYgKCFkcmFnRWwuY29udGFpbnMoZWwpKSB7XG5cdFx0XHRcdFx0XHRcdGVsLmFwcGVuZENoaWxkKGRyYWdFbCk7XG5cdFx0XHRcdFx0XHRcdHBhcmVudEVsID0gZWw7IC8vIGFjdHVhbGl6YXRpb25cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dGhpcy5fYW5pbWF0ZShkcmFnUmVjdCwgZHJhZ0VsKTtcblx0XHRcdFx0XHRcdHRhcmdldCAmJiB0aGlzLl9hbmltYXRlKHRhcmdldFJlY3QsIHRhcmdldCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYgKHRhcmdldCAmJiAhdGFyZ2V0LmFuaW1hdGVkICYmIHRhcmdldCAhPT0gZHJhZ0VsICYmICh0YXJnZXQucGFyZW50Tm9kZVtleHBhbmRvXSAhPT0gdm9pZCAwKSkge1xuXHRcdFx0XHRcdGlmIChsYXN0RWwgIT09IHRhcmdldCkge1xuXHRcdFx0XHRcdFx0bGFzdEVsID0gdGFyZ2V0O1xuXHRcdFx0XHRcdFx0bGFzdENTUyA9IF9jc3ModGFyZ2V0KTtcblx0XHRcdFx0XHRcdGxhc3RQYXJlbnRDU1MgPSBfY3NzKHRhcmdldC5wYXJlbnROb2RlKTtcblx0XHRcdFx0XHR9XG5cblxuXHRcdFx0XHRcdHZhciB0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuXHRcdFx0XHRcdFx0d2lkdGggPSB0YXJnZXRSZWN0LnJpZ2h0IC0gdGFyZ2V0UmVjdC5sZWZ0LFxuXHRcdFx0XHRcdFx0aGVpZ2h0ID0gdGFyZ2V0UmVjdC5ib3R0b20gLSB0YXJnZXRSZWN0LnRvcCxcblx0XHRcdFx0XHRcdGZsb2F0aW5nID0gL2xlZnR8cmlnaHR8aW5saW5lLy50ZXN0KGxhc3RDU1MuY3NzRmxvYXQgKyBsYXN0Q1NTLmRpc3BsYXkpXG5cdFx0XHRcdFx0XHRcdHx8IChsYXN0UGFyZW50Q1NTLmRpc3BsYXkgPT0gJ2ZsZXgnICYmIGxhc3RQYXJlbnRDU1NbJ2ZsZXgtZGlyZWN0aW9uJ10uaW5kZXhPZigncm93JykgPT09IDApLFxuXHRcdFx0XHRcdFx0aXNXaWRlID0gKHRhcmdldC5vZmZzZXRXaWR0aCA+IGRyYWdFbC5vZmZzZXRXaWR0aCksXG5cdFx0XHRcdFx0XHRpc0xvbmcgPSAodGFyZ2V0Lm9mZnNldEhlaWdodCA+IGRyYWdFbC5vZmZzZXRIZWlnaHQpLFxuXHRcdFx0XHRcdFx0aGFsZndheSA9IChmbG9hdGluZyA/IChldnQuY2xpZW50WCAtIHRhcmdldFJlY3QubGVmdCkgLyB3aWR0aCA6IChldnQuY2xpZW50WSAtIHRhcmdldFJlY3QudG9wKSAvIGhlaWdodCkgPiAwLjUsXG5cdFx0XHRcdFx0XHRuZXh0U2libGluZyA9IHRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmcsXG5cdFx0XHRcdFx0XHRtb3ZlVmVjdG9yID0gX29uTW92ZShyb290RWwsIGVsLCBkcmFnRWwsIGRyYWdSZWN0LCB0YXJnZXQsIHRhcmdldFJlY3QpLFxuXHRcdFx0XHRcdFx0YWZ0ZXJcblx0XHRcdFx0XHQ7XG5cblx0XHRcdFx0XHRpZiAobW92ZVZlY3RvciAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdF9zaWxlbnQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0c2V0VGltZW91dChfdW5zaWxlbnQsIDMwKTtcblxuXHRcdFx0XHRcdFx0X2Nsb25lSGlkZShpc093bmVyKTtcblxuXHRcdFx0XHRcdFx0aWYgKG1vdmVWZWN0b3IgPT09IDEgfHwgbW92ZVZlY3RvciA9PT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0YWZ0ZXIgPSAobW92ZVZlY3RvciA9PT0gMSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRlbHNlIGlmIChmbG9hdGluZykge1xuXHRcdFx0XHRcdFx0XHR2YXIgZWxUb3AgPSBkcmFnRWwub2Zmc2V0VG9wLFxuXHRcdFx0XHRcdFx0XHRcdHRnVG9wID0gdGFyZ2V0Lm9mZnNldFRvcDtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZWxUb3AgPT09IHRnVG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0YWZ0ZXIgPSAodGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcgPT09IGRyYWdFbCkgJiYgIWlzV2lkZSB8fCBoYWxmd2F5ICYmIGlzV2lkZTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRhZnRlciA9IHRnVG9wID4gZWxUb3A7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGFmdGVyID0gKG5leHRTaWJsaW5nICE9PSBkcmFnRWwpICYmICFpc0xvbmcgfHwgaGFsZndheSAmJiBpc0xvbmc7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICghZHJhZ0VsLmNvbnRhaW5zKGVsKSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoYWZ0ZXIgJiYgIW5leHRTaWJsaW5nKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWwuYXBwZW5kQ2hpbGQoZHJhZ0VsKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHR0YXJnZXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZHJhZ0VsLCBhZnRlciA/IG5leHRTaWJsaW5nIDogdGFyZ2V0KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRwYXJlbnRFbCA9IGRyYWdFbC5wYXJlbnROb2RlOyAvLyBhY3R1YWxpemF0aW9uXG5cblx0XHRcdFx0XHRcdHRoaXMuX2FuaW1hdGUoZHJhZ1JlY3QsIGRyYWdFbCk7XG5cdFx0XHRcdFx0XHR0aGlzLl9hbmltYXRlKHRhcmdldFJlY3QsIHRhcmdldCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdF9hbmltYXRlOiBmdW5jdGlvbiAocHJldlJlY3QsIHRhcmdldCkge1xuXHRcdFx0dmFyIG1zID0gdGhpcy5vcHRpb25zLmFuaW1hdGlvbjtcblxuXHRcdFx0aWYgKG1zKSB7XG5cdFx0XHRcdHZhciBjdXJyZW50UmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuXHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zaXRpb24nLCAnbm9uZScpO1xuXHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUzZCgnXG5cdFx0XHRcdFx0KyAocHJldlJlY3QubGVmdCAtIGN1cnJlbnRSZWN0LmxlZnQpICsgJ3B4LCdcblx0XHRcdFx0XHQrIChwcmV2UmVjdC50b3AgLSBjdXJyZW50UmVjdC50b3ApICsgJ3B4LDApJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHRhcmdldC5vZmZzZXRXaWR0aDsgLy8gcmVwYWludFxuXG5cdFx0XHRcdF9jc3ModGFyZ2V0LCAndHJhbnNpdGlvbicsICdhbGwgJyArIG1zICsgJ21zJyk7XG5cdFx0XHRcdF9jc3ModGFyZ2V0LCAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZTNkKDAsMCwwKScpO1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXJnZXQuYW5pbWF0ZWQpO1xuXHRcdFx0XHR0YXJnZXQuYW5pbWF0ZWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zaXRpb24nLCAnJyk7XG5cdFx0XHRcdFx0X2Nzcyh0YXJnZXQsICd0cmFuc2Zvcm0nLCAnJyk7XG5cdFx0XHRcdFx0dGFyZ2V0LmFuaW1hdGVkID0gZmFsc2U7XG5cdFx0XHRcdH0sIG1zKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X29mZlVwRXZlbnRzOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgb3duZXJEb2N1bWVudCA9IHRoaXMuZWwub3duZXJEb2N1bWVudDtcblxuXHRcdFx0X29mZihkb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTtcblx0XHRcdF9vZmYob3duZXJEb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0X29mZihvd25lckRvY3VtZW50LCAndG91Y2hlbmQnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0X29mZihvd25lckRvY3VtZW50LCAndG91Y2hjYW5jZWwnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdH0sXG5cblx0XHRfb25Ecm9wOiBmdW5jdGlvbiAoLyoqRXZlbnQqL2V2dCkge1xuXHRcdFx0dmFyIGVsID0gdGhpcy5lbCxcblx0XHRcdFx0b3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuXHRcdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLl9sb29wSWQpO1xuXHRcdFx0Y2xlYXJJbnRlcnZhbChhdXRvU2Nyb2xsLnBpZCk7XG5cdFx0XHRjbGVhclRpbWVvdXQodGhpcy5fZHJhZ1N0YXJ0VGltZXIpO1xuXG5cdFx0XHQvLyBVbmJpbmQgZXZlbnRzXG5cdFx0XHRfb2ZmKGRvY3VtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpO1xuXG5cdFx0XHRpZiAodGhpcy5uYXRpdmVEcmFnZ2FibGUpIHtcblx0XHRcdFx0X29mZihkb2N1bWVudCwgJ2Ryb3AnLCB0aGlzKTtcblx0XHRcdFx0X29mZihlbCwgJ2RyYWdzdGFydCcsIHRoaXMuX29uRHJhZ1N0YXJ0KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fb2ZmVXBFdmVudHMoKTtcblxuXHRcdFx0aWYgKGV2dCkge1xuXHRcdFx0XHRpZiAobW92ZWQpIHtcblx0XHRcdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHQhb3B0aW9ucy5kcm9wQnViYmxlICYmIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGdob3N0RWwgJiYgZ2hvc3RFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGdob3N0RWwpO1xuXG5cdFx0XHRcdGlmIChkcmFnRWwpIHtcblx0XHRcdFx0XHRpZiAodGhpcy5uYXRpdmVEcmFnZ2FibGUpIHtcblx0XHRcdFx0XHRcdF9vZmYoZHJhZ0VsLCAnZHJhZ2VuZCcsIHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdF9kaXNhYmxlRHJhZ2dhYmxlKGRyYWdFbCk7XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgY2xhc3Mnc1xuXHRcdFx0XHRcdF90b2dnbGVDbGFzcyhkcmFnRWwsIHRoaXMub3B0aW9ucy5naG9zdENsYXNzLCBmYWxzZSk7XG5cdFx0XHRcdFx0X3RvZ2dsZUNsYXNzKGRyYWdFbCwgdGhpcy5vcHRpb25zLmNob3NlbkNsYXNzLCBmYWxzZSk7XG5cblx0XHRcdFx0XHRpZiAocm9vdEVsICE9PSBwYXJlbnRFbCkge1xuXHRcdFx0XHRcdFx0bmV3SW5kZXggPSBfaW5kZXgoZHJhZ0VsLCBvcHRpb25zLmRyYWdnYWJsZSk7XG5cblx0XHRcdFx0XHRcdGlmIChuZXdJbmRleCA+PSAwKSB7XG5cdFx0XHRcdFx0XHRcdC8vIGRyYWcgZnJvbSBvbmUgbGlzdCBhbmQgZHJvcCBpbnRvIGFub3RoZXJcblx0XHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQobnVsbCwgcGFyZW50RWwsICdzb3J0JywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0XHRcdF9kaXNwYXRjaEV2ZW50KHRoaXMsIHJvb3RFbCwgJ3NvcnQnLCBkcmFnRWwsIHJvb3RFbCwgb2xkSW5kZXgsIG5ld0luZGV4KTtcblxuXHRcdFx0XHRcdFx0XHQvLyBBZGQgZXZlbnRcblx0XHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQobnVsbCwgcGFyZW50RWwsICdhZGQnLCBkcmFnRWwsIHJvb3RFbCwgb2xkSW5kZXgsIG5ld0luZGV4KTtcblxuXHRcdFx0XHRcdFx0XHQvLyBSZW1vdmUgZXZlbnRcblx0XHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQodGhpcywgcm9vdEVsLCAncmVtb3ZlJywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIGNsb25lXG5cdFx0XHRcdFx0XHRjbG9uZUVsICYmIGNsb25lRWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbG9uZUVsKTtcblxuXHRcdFx0XHRcdFx0aWYgKGRyYWdFbC5uZXh0U2libGluZyAhPT0gbmV4dEVsKSB7XG5cdFx0XHRcdFx0XHRcdC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRyYWdnZWQgZWxlbWVudCB3aXRoaW4gaXRzIHBhcmVudFxuXHRcdFx0XHRcdFx0XHRuZXdJbmRleCA9IF9pbmRleChkcmFnRWwsIG9wdGlvbnMuZHJhZ2dhYmxlKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAobmV3SW5kZXggPj0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdC8vIGRyYWcgJiBkcm9wIHdpdGhpbiB0aGUgc2FtZSBsaXN0XG5cdFx0XHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQodGhpcywgcm9vdEVsLCAndXBkYXRlJywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQodGhpcywgcm9vdEVsLCAnc29ydCcsIGRyYWdFbCwgcm9vdEVsLCBvbGRJbmRleCwgbmV3SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKFNvcnRhYmxlLmFjdGl2ZSkge1xuXHRcdFx0XHRcdFx0aWYgKG5ld0luZGV4ID09PSBudWxsIHx8IG5ld0luZGV4ID09PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRuZXdJbmRleCA9IG9sZEluZGV4O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0aGlzLm9yaWdpbmFsRXZlbnQgPSBldnQ7IC8vIEdhbnRyeSA1XG5cdFx0XHRcdFx0XHRfZGlzcGF0Y2hFdmVudCh0aGlzLCByb290RWwsICdlbmQnLCBkcmFnRWwsIHJvb3RFbCwgb2xkSW5kZXgsIG5ld0luZGV4KTtcblxuXHRcdFx0XHRcdFx0Ly8gU2F2ZSBzb3J0aW5nXG5cdFx0XHRcdFx0XHR0aGlzLnNhdmUoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXHRcdFx0dGhpcy5fbnVsbGluZygpO1xuXHRcdH0sXG5cblx0XHRfbnVsbGluZzogZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBOdWxsaW5nXG5cdFx0XHRyb290RWwgPVxuXHRcdFx0ZHJhZ0VsID1cblx0XHRcdHBhcmVudEVsID1cblx0XHRcdGdob3N0RWwgPVxuXHRcdFx0bmV4dEVsID1cblx0XHRcdGNsb25lRWwgPVxuXG5cdFx0XHRzY3JvbGxFbCA9XG5cdFx0XHRzY3JvbGxQYXJlbnRFbCA9XG5cblx0XHRcdHRhcEV2dCA9XG5cdFx0XHR0b3VjaEV2dCA9XG5cblx0XHRcdG1vdmVkID1cblx0XHRcdG5ld0luZGV4ID1cblxuXHRcdFx0bGFzdEVsID1cblx0XHRcdGxhc3RDU1MgPVxuXG5cdFx0XHRhY3RpdmVHcm91cCA9XG5cdFx0XHRTb3J0YWJsZS5hY3RpdmUgPSBudWxsO1xuXHRcdH0sXG5cblx0XHRoYW5kbGVFdmVudDogZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRcdHZhciB0eXBlID0gZXZ0LnR5cGU7XG5cblx0XHRcdGlmICh0eXBlID09PSAnZHJhZ292ZXInIHx8IHR5cGUgPT09ICdkcmFnZW50ZXInKSB7XG5cdFx0XHRcdGlmIChkcmFnRWwpIHtcblx0XHRcdFx0XHR0aGlzLl9vbkRyYWdPdmVyKGV2dCk7XG5cdFx0XHRcdFx0X2dsb2JhbERyYWdPdmVyKGV2dCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKHR5cGUgPT09ICdkcm9wJyB8fCB0eXBlID09PSAnZHJhZ2VuZCcpIHtcblx0XHRcdFx0dGhpcy5fb25Ecm9wKGV2dCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogU2VyaWFsaXplcyB0aGUgaXRlbSBpbnRvIGFuIGFycmF5IG9mIHN0cmluZy5cblx0XHQgKiBAcmV0dXJucyB7U3RyaW5nW119XG5cdFx0ICovXG5cdFx0dG9BcnJheTogZnVuY3Rpb24gKCkge1xuXHRcdFx0dmFyIG9yZGVyID0gW10sXG5cdFx0XHRcdGVsLFxuXHRcdFx0XHRjaGlsZHJlbiA9IHRoaXMuZWwuY2hpbGRyZW4sXG5cdFx0XHRcdGkgPSAwLFxuXHRcdFx0XHRuID0gY2hpbGRyZW4ubGVuZ3RoLFxuXHRcdFx0XHRvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG5cdFx0XHRmb3IgKDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRlbCA9IGNoaWxkcmVuW2ldO1xuXHRcdFx0XHRpZiAoX2Nsb3Nlc3QoZWwsIG9wdGlvbnMuZHJhZ2dhYmxlLCB0aGlzLmVsKSkge1xuXHRcdFx0XHRcdG9yZGVyLnB1c2goZWwuZ2V0QXR0cmlidXRlKG9wdGlvbnMuZGF0YUlkQXR0cikgfHwgX2dlbmVyYXRlSWQoZWwpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3JkZXI7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogU29ydHMgdGhlIGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUgYXJyYXkuXG5cdFx0ICogQHBhcmFtICB7U3RyaW5nW119ICBvcmRlciAgb3JkZXIgb2YgdGhlIGl0ZW1zXG5cdFx0ICovXG5cdFx0c29ydDogZnVuY3Rpb24gKG9yZGVyKSB7XG5cdFx0XHR2YXIgaXRlbXMgPSB7fSwgcm9vdEVsID0gdGhpcy5lbDtcblxuXHRcdFx0dGhpcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbiAoaWQsIGkpIHtcblx0XHRcdFx0dmFyIGVsID0gcm9vdEVsLmNoaWxkcmVuW2ldO1xuXG5cdFx0XHRcdGlmIChfY2xvc2VzdChlbCwgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSwgcm9vdEVsKSkge1xuXHRcdFx0XHRcdGl0ZW1zW2lkXSA9IGVsO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzKTtcblxuXHRcdFx0b3JkZXIuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcblx0XHRcdFx0aWYgKGl0ZW1zW2lkXSkge1xuXHRcdFx0XHRcdHJvb3RFbC5yZW1vdmVDaGlsZChpdGVtc1tpZF0pO1xuXHRcdFx0XHRcdHJvb3RFbC5hcHBlbmRDaGlsZChpdGVtc1tpZF0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cblx0XHQvKipcblx0XHQgKiBTYXZlIHRoZSBjdXJyZW50IHNvcnRpbmdcblx0XHQgKi9cblx0XHRzYXZlOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgc3RvcmUgPSB0aGlzLm9wdGlvbnMuc3RvcmU7XG5cdFx0XHRzdG9yZSAmJiBzdG9yZS5zZXQodGhpcyk7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogRm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgc2V0LCBnZXQgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBzZWxlY3RvciBieSB0ZXN0aW5nIHRoZSBlbGVtZW50IGl0c2VsZiBhbmQgdHJhdmVyc2luZyB1cCB0aHJvdWdoIGl0cyBhbmNlc3RvcnMgaW4gdGhlIERPTSB0cmVlLlxuXHRcdCAqIEBwYXJhbSAgIHtIVE1MRWxlbWVudH0gIGVsXG5cdFx0ICogQHBhcmFtICAge1N0cmluZ30gICAgICAgW3NlbGVjdG9yXSAgZGVmYXVsdDogYG9wdGlvbnMuZHJhZ2dhYmxlYFxuXHRcdCAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfVxuXHRcdCAqL1xuXHRcdGNsb3Nlc3Q6IGZ1bmN0aW9uIChlbCwgc2VsZWN0b3IpIHtcblx0XHRcdHJldHVybiBfY2xvc2VzdChlbCwgc2VsZWN0b3IgfHwgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSwgdGhpcy5lbCk7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogU2V0L2dldCBvcHRpb25cblx0XHQgKiBAcGFyYW0gICB7c3RyaW5nfSBuYW1lXG5cdFx0ICogQHBhcmFtICAgeyp9ICAgICAgW3ZhbHVlXVxuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdG9wdGlvbjogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuXHRcdFx0aWYgKHZhbHVlID09PSB2b2lkIDApIHtcblx0XHRcdFx0cmV0dXJuIG9wdGlvbnNbbmFtZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRvcHRpb25zW25hbWVdID0gdmFsdWU7XG5cblx0XHRcdFx0aWYgKG5hbWUgPT09ICdncm91cCcpIHtcblx0XHRcdFx0XHRfcHJlcGFyZUdyb3VwKG9wdGlvbnMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogRGVzdHJveVxuXHRcdCAqL1xuXHRcdGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBlbCA9IHRoaXMuZWw7XG5cblx0XHRcdGVsW2V4cGFuZG9dID0gbnVsbDtcblxuXHRcdFx0X29mZihlbCwgJ21vdXNlZG93bicsIHRoaXMuX29uVGFwU3RhcnQpO1xuXHRcdFx0X29mZihlbCwgJ3RvdWNoc3RhcnQnLCB0aGlzLl9vblRhcFN0YXJ0KTtcblxuXHRcdFx0aWYgKHRoaXMubmF0aXZlRHJhZ2dhYmxlKSB7XG5cdFx0XHRcdF9vZmYoZWwsICdkcmFnb3ZlcicsIHRoaXMpO1xuXHRcdFx0XHRfb2ZmKGVsLCAnZHJhZ2VudGVyJywgdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlbW92ZSBkcmFnZ2FibGUgYXR0cmlidXRlc1xuXHRcdFx0QXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKCdbZHJhZ2dhYmxlXScpLCBmdW5jdGlvbiAoZWwpIHtcblx0XHRcdFx0ZWwucmVtb3ZlQXR0cmlidXRlKCdkcmFnZ2FibGUnKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0b3VjaERyYWdPdmVyTGlzdGVuZXJzLnNwbGljZSh0b3VjaERyYWdPdmVyTGlzdGVuZXJzLmluZGV4T2YodGhpcy5fb25EcmFnT3ZlciksIDEpO1xuXG5cdFx0XHR0aGlzLl9vbkRyb3AoKTtcblxuXHRcdFx0dGhpcy5lbCA9IGVsID0gbnVsbDtcblx0XHR9XG5cdH07XG5cblxuXHRmdW5jdGlvbiBfY2xvbmVIaWRlKHN0YXRlKSB7XG5cdFx0aWYgKGNsb25lRWwgJiYgKGNsb25lRWwuc3RhdGUgIT09IHN0YXRlKSkge1xuXHRcdFx0X2NzcyhjbG9uZUVsLCAnZGlzcGxheScsIHN0YXRlID8gJ25vbmUnIDogJycpO1xuXHRcdFx0IXN0YXRlICYmIGNsb25lRWwuc3RhdGUgJiYgcm9vdEVsLmluc2VydEJlZm9yZShjbG9uZUVsLCBkcmFnRWwpO1xuXHRcdFx0Y2xvbmVFbC5zdGF0ZSA9IHN0YXRlO1xuXHRcdH1cblx0fVxuXG5cblx0ZnVuY3Rpb24gX2Nsb3Nlc3QoLyoqSFRNTEVsZW1lbnQqL2VsLCAvKipTdHJpbmcqL3NlbGVjdG9yLCAvKipIVE1MRWxlbWVudCovY3R4KSB7XG5cdFx0aWYgKGVsKSB7XG5cdFx0XHRjdHggPSBjdHggfHwgZG9jdW1lbnQ7XG5cblx0XHRcdGRvIHtcblx0XHRcdFx0aWYgKFxuXHRcdFx0XHRcdChzZWxlY3RvciA9PT0gJz4qJyAmJiBlbC5wYXJlbnROb2RlID09PSBjdHgpXG5cdFx0XHRcdFx0fHwgX21hdGNoZXMoZWwsIHNlbGVjdG9yKVxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHRyZXR1cm4gZWw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHdoaWxlIChlbCAhPT0gY3R4ICYmIChlbCA9IGVsLnBhcmVudE5vZGUpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cblx0ZnVuY3Rpb24gX2dsb2JhbERyYWdPdmVyKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRpZiAoZXZ0LmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0ZXZ0LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ21vdmUnO1xuXHRcdH1cblx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0fVxuXG5cblx0ZnVuY3Rpb24gX29uKGVsLCBldmVudCwgZm4pIHtcblx0XHRlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfb2ZmKGVsLCBldmVudCwgZm4pIHtcblx0XHRlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfdG9nZ2xlQ2xhc3MoZWwsIG5hbWUsIHN0YXRlKSB7XG5cdFx0aWYgKGVsKSB7XG5cdFx0XHRpZiAoZWwuY2xhc3NMaXN0KSB7XG5cdFx0XHRcdGVsLmNsYXNzTGlzdFtzdGF0ZSA/ICdhZGQnIDogJ3JlbW92ZSddKG5hbWUpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhciBjbGFzc05hbWUgPSAoJyAnICsgZWwuY2xhc3NOYW1lICsgJyAnKS5yZXBsYWNlKFJTUEFDRSwgJyAnKS5yZXBsYWNlKCcgJyArIG5hbWUgKyAnICcsICcgJyk7XG5cdFx0XHRcdGVsLmNsYXNzTmFtZSA9IChjbGFzc05hbWUgKyAoc3RhdGUgPyAnICcgKyBuYW1lIDogJycpKS5yZXBsYWNlKFJTUEFDRSwgJyAnKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXG5cdGZ1bmN0aW9uIF9jc3MoZWwsIHByb3AsIHZhbCkge1xuXHRcdHZhciBzdHlsZSA9IGVsICYmIGVsLnN0eWxlO1xuXG5cdFx0aWYgKHN0eWxlKSB7XG5cdFx0XHRpZiAodmFsID09PSB2b2lkIDApIHtcblx0XHRcdFx0aWYgKGRvY3VtZW50LmRlZmF1bHRWaWV3ICYmIGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUpIHtcblx0XHRcdFx0XHR2YWwgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsLCAnJyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSBpZiAoZWwuY3VycmVudFN0eWxlKSB7XG5cdFx0XHRcdFx0dmFsID0gZWwuY3VycmVudFN0eWxlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHByb3AgPT09IHZvaWQgMCA/IHZhbCA6IHZhbFtwcm9wXTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRpZiAoIShwcm9wIGluIHN0eWxlKSkge1xuXHRcdFx0XHRcdHByb3AgPSAnLXdlYmtpdC0nICsgcHJvcDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN0eWxlW3Byb3BdID0gdmFsICsgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gJycgOiAncHgnKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXG5cdGZ1bmN0aW9uIF9maW5kKGN0eCwgdGFnTmFtZSwgaXRlcmF0b3IpIHtcblx0XHRpZiAoY3R4KSB7XG5cdFx0XHR2YXIgbGlzdCA9IGN0eC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKSwgaSA9IDAsIG4gPSBsaXN0Lmxlbmd0aDtcblxuXHRcdFx0aWYgKGl0ZXJhdG9yKSB7XG5cdFx0XHRcdGZvciAoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRcdFx0aXRlcmF0b3IobGlzdFtpXSwgaSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGxpc3Q7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG5cblxuXG5cdGZ1bmN0aW9uIF9kaXNwYXRjaEV2ZW50KHNvcnRhYmxlLCByb290RWwsIG5hbWUsIHRhcmdldEVsLCBmcm9tRWwsIHN0YXJ0SW5kZXgsIG5ld0luZGV4KSB7XG5cdFx0dmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpLFxuXHRcdFx0b3B0aW9ucyA9IChzb3J0YWJsZSB8fCByb290RWxbZXhwYW5kb10pLm9wdGlvbnMsXG5cdFx0XHRvbk5hbWUgPSAnb24nICsgbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc3Vic3RyKDEpO1xuXG5cdFx0ZXZ0LmluaXRFdmVudChuYW1lLCB0cnVlLCB0cnVlKTtcblxuXHRcdGV2dC50byA9IHJvb3RFbDtcblx0XHRldnQuZnJvbSA9IGZyb21FbCB8fCByb290RWw7XG5cdFx0ZXZ0Lml0ZW0gPSB0YXJnZXRFbCB8fCByb290RWw7XG5cdFx0ZXZ0LmNsb25lID0gY2xvbmVFbDtcblxuXHRcdGV2dC5vbGRJbmRleCA9IHN0YXJ0SW5kZXg7XG5cdFx0ZXZ0Lm5ld0luZGV4ID0gbmV3SW5kZXg7XG5cblx0XHRyb290RWwuZGlzcGF0Y2hFdmVudChldnQpO1xuXG5cdFx0aWYgKG9wdGlvbnNbb25OYW1lXSkge1xuXHRcdFx0b3B0aW9uc1tvbk5hbWVdLmNhbGwoc29ydGFibGUsIGV2dCk7XG5cdFx0fVxuXHR9XG5cblxuXHRmdW5jdGlvbiBfb25Nb3ZlKGZyb21FbCwgdG9FbCwgZHJhZ0VsLCBkcmFnUmVjdCwgdGFyZ2V0RWwsIHRhcmdldFJlY3QpIHtcblx0XHR2YXIgZXZ0LFxuXHRcdFx0c29ydGFibGUgPSBmcm9tRWxbZXhwYW5kb10sXG5cdFx0XHRvbk1vdmVGbiA9IHNvcnRhYmxlLm9wdGlvbnMub25Nb3ZlLFxuXHRcdFx0cmV0VmFsO1xuXG5cdFx0ZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG5cdFx0ZXZ0LmluaXRFdmVudCgnbW92ZScsIHRydWUsIHRydWUpO1xuXG5cdFx0ZXZ0LnRvID0gdG9FbDtcblx0XHRldnQuZnJvbSA9IGZyb21FbDtcblx0XHRldnQuZHJhZ2dlZCA9IGRyYWdFbDtcblx0XHRldnQuZHJhZ2dlZFJlY3QgPSBkcmFnUmVjdDtcblx0XHRldnQucmVsYXRlZCA9IHRhcmdldEVsIHx8IHRvRWw7XG5cdFx0ZXZ0LnJlbGF0ZWRSZWN0ID0gdGFyZ2V0UmVjdCB8fCB0b0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0ZnJvbUVsLmRpc3BhdGNoRXZlbnQoZXZ0KTtcblxuXHRcdGlmIChvbk1vdmVGbikge1xuXHRcdFx0cmV0VmFsID0gb25Nb3ZlRm4uY2FsbChzb3J0YWJsZSwgZXZ0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0VmFsO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfZGlzYWJsZURyYWdnYWJsZShlbCkge1xuXHRcdGVsLmRyYWdnYWJsZSA9IGZhbHNlO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfdW5zaWxlbnQoKSB7XG5cdFx0X3NpbGVudCA9IGZhbHNlO1xuXHR9XG5cblxuXHQvKiogQHJldHVybnMge0hUTUxFbGVtZW50fGZhbHNlfSAqL1xuXHRmdW5jdGlvbiBfZ2hvc3RJc0xhc3QoZWwsIGV2dCkge1xuXHRcdHZhciBsYXN0RWwgPSBlbC5sYXN0RWxlbWVudENoaWxkLFxuXHRcdFx0XHRyZWN0ID0gbGFzdEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0Ly8gcmV0dXJuICgoZXZ0LmNsaWVudFkgLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCkgPiA1KSB8fCAoZXZ0LmNsaWVudFggLSByZWN0LnJpZ2h0ID4gNSkpICYmIGxhc3RFbDsgLy8gbWluIGRlbHRhIC8vIEdhbnRyeSA1XG5cdFx0cmV0dXJuICgoZXZ0LmNsaWVudFkgLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCkgPiA1KSB8fCAoZXZ0LmNsaWVudFggLSAocmVjdC5yaWdodCArIHJlY3Qud2lkdGgpID4gNSkpICYmIGxhc3RFbDsgLy8gbWluIGRlbHRhXG5cdH1cblxuXG5cdC8qKlxuXHQgKiBHZW5lcmF0ZSBpZFxuXHQgKiBAcGFyYW0gICB7SFRNTEVsZW1lbnR9IGVsXG5cdCAqIEByZXR1cm5zIHtTdHJpbmd9XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRmdW5jdGlvbiBfZ2VuZXJhdGVJZChlbCkge1xuXHRcdHZhciBzdHIgPSBlbC50YWdOYW1lICsgZWwuY2xhc3NOYW1lICsgZWwuc3JjICsgZWwuaHJlZiArIGVsLnRleHRDb250ZW50LFxuXHRcdFx0aSA9IHN0ci5sZW5ndGgsXG5cdFx0XHRzdW0gPSAwO1xuXG5cdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0c3VtICs9IHN0ci5jaGFyQ29kZUF0KGkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBzdW0udG9TdHJpbmcoMzYpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIGluZGV4IG9mIGFuIGVsZW1lbnQgd2l0aGluIGl0cyBwYXJlbnQgZm9yIGEgc2VsZWN0ZWQgc2V0IG9mXG5cdCAqIGVsZW1lbnRzXG5cdCAqIEBwYXJhbSAge0hUTUxFbGVtZW50fSBlbFxuXHQgKiBAcGFyYW0gIHtzZWxlY3Rvcn0gc2VsZWN0b3Jcblx0ICogQHJldHVybiB7bnVtYmVyfVxuXHQgKi9cblx0ZnVuY3Rpb24gX2luZGV4KGVsLCBzZWxlY3Rvcikge1xuXHRcdHZhciBpbmRleCA9IDA7XG5cblx0XHRpZiAoIWVsIHx8ICFlbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXG5cdFx0d2hpbGUgKGVsICYmIChlbCA9IGVsLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpKSB7XG5cdFx0XHRpZiAoZWwubm9kZU5hbWUudG9VcHBlckNhc2UoKSAhPT0gJ1RFTVBMQVRFJ1xuXHRcdFx0XHRcdCYmIF9tYXRjaGVzKGVsLCBzZWxlY3RvcikpIHtcblx0XHRcdFx0aW5kZXgrKztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gaW5kZXg7XG5cdH1cblxuXHRmdW5jdGlvbiBfbWF0Y2hlcygvKipIVE1MRWxlbWVudCovZWwsIC8qKlN0cmluZyovc2VsZWN0b3IpIHtcblx0XHRpZiAoZWwpIHtcblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3BsaXQoJy4nKTtcblxuXHRcdFx0dmFyIHRhZyA9IHNlbGVjdG9yLnNoaWZ0KCkudG9VcHBlckNhc2UoKSxcblx0XHRcdFx0cmUgPSBuZXcgUmVnRXhwKCdcXFxccygnICsgc2VsZWN0b3Iuam9pbignfCcpICsgJykoPz1cXFxccyknLCAnZycpO1xuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQodGFnID09PSAnJyB8fCBlbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09IHRhZykgJiZcblx0XHRcdFx0KCFzZWxlY3Rvci5sZW5ndGggfHwgKCgnICcgKyBlbC5jbGFzc05hbWUgKyAnICcpLm1hdGNoKHJlKSB8fCBbXSkubGVuZ3RoID09IHNlbGVjdG9yLmxlbmd0aClcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0ZnVuY3Rpb24gX3Rocm90dGxlKGNhbGxiYWNrLCBtcykge1xuXHRcdHZhciBhcmdzLCBfdGhpcztcblxuXHRcdHJldHVybiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRpZiAoYXJncyA9PT0gdm9pZCAwKSB7XG5cdFx0XHRcdGFyZ3MgPSBhcmd1bWVudHM7XG5cdFx0XHRcdF90aGlzID0gdGhpcztcblxuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAoYXJncy5sZW5ndGggPT09IDEpIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwoX3RoaXMsIGFyZ3NbMF0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShfdGhpcywgYXJncyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YXJncyA9IHZvaWQgMDtcblx0XHRcdFx0fSwgbXMpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBfZXh0ZW5kKGRzdCwgc3JjKSB7XG5cdFx0aWYgKGRzdCAmJiBzcmMpIHtcblx0XHRcdGZvciAodmFyIGtleSBpbiBzcmMpIHtcblx0XHRcdFx0aWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdFx0XHRcdFx0ZHN0W2tleV0gPSBzcmNba2V5XTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkc3Q7XG5cdH1cblxuXG5cdC8vIEV4cG9ydCB1dGlsc1xuXHRTb3J0YWJsZS51dGlscyA9IHtcblx0XHRvbjogX29uLFxuXHRcdG9mZjogX29mZixcblx0XHRjc3M6IF9jc3MsXG5cdFx0ZmluZDogX2ZpbmQsXG5cdFx0aXM6IGZ1bmN0aW9uIChlbCwgc2VsZWN0b3IpIHtcblx0XHRcdHJldHVybiAhIV9jbG9zZXN0KGVsLCBzZWxlY3RvciwgZWwpO1xuXHRcdH0sXG5cdFx0ZXh0ZW5kOiBfZXh0ZW5kLFxuXHRcdHRocm90dGxlOiBfdGhyb3R0bGUsXG5cdFx0Y2xvc2VzdDogX2Nsb3Nlc3QsXG5cdFx0dG9nZ2xlQ2xhc3M6IF90b2dnbGVDbGFzcyxcblx0XHRpbmRleDogX2luZGV4XG5cdH07XG5cblxuXHQvKipcblx0ICogQ3JlYXRlIHNvcnRhYmxlIGluc3RhbmNlXG5cdCAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9ICBlbFxuXHQgKiBAcGFyYW0ge09iamVjdH0gICAgICBbb3B0aW9uc11cblx0ICovXG5cdFNvcnRhYmxlLmNyZWF0ZSA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuXHRcdHJldHVybiBuZXcgU29ydGFibGUoZWwsIG9wdGlvbnMpO1xuXHR9O1xuXG5cblx0Ly8gRXhwb3J0XG5cdFNvcnRhYmxlLnZlcnNpb24gPSAnMS40LjInO1xuXHRyZXR1cm4gU29ydGFibGU7XG59KTtcbiIsIi8qIFdlYiBGb250IExvYWRlciB2MS42LjI2IC0gKGMpIEFkb2JlIFN5c3RlbXMsIEdvb2dsZS4gTGljZW5zZTogQXBhY2hlIDIuMCAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIGFhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfWZ1bmN0aW9uIGJhKGEsYixjKXtpZighYSl0aHJvdyBFcnJvcigpO2lmKDI8YXJndW1lbnRzLmxlbmd0aCl7dmFyIGQ9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7QXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkoYyxkKTtyZXR1cm4gYS5hcHBseShiLGMpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLGFyZ3VtZW50cyl9fWZ1bmN0aW9uIHAoYSxiLGMpe3A9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQmJi0xIT1GdW5jdGlvbi5wcm90b3R5cGUuYmluZC50b1N0cmluZygpLmluZGV4T2YoXCJuYXRpdmUgY29kZVwiKT9hYTpiYTtyZXR1cm4gcC5hcHBseShudWxsLGFyZ3VtZW50cyl9dmFyIHE9RGF0ZS5ub3d8fGZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfTtmdW5jdGlvbiBjYShhLGIpe3RoaXMuYT1hO3RoaXMubT1ifHxhO3RoaXMuYz10aGlzLm0uZG9jdW1lbnR9dmFyIGRhPSEhd2luZG93LkZvbnRGYWNlO2Z1bmN0aW9uIHQoYSxiLGMsZCl7Yj1hLmMuY3JlYXRlRWxlbWVudChiKTtpZihjKWZvcih2YXIgZSBpbiBjKWMuaGFzT3duUHJvcGVydHkoZSkmJihcInN0eWxlXCI9PWU/Yi5zdHlsZS5jc3NUZXh0PWNbZV06Yi5zZXRBdHRyaWJ1dGUoZSxjW2VdKSk7ZCYmYi5hcHBlbmRDaGlsZChhLmMuY3JlYXRlVGV4dE5vZGUoZCkpO3JldHVybiBifWZ1bmN0aW9uIHUoYSxiLGMpe2E9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKGIpWzBdO2F8fChhPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7YS5pbnNlcnRCZWZvcmUoYyxhLmxhc3RDaGlsZCl9ZnVuY3Rpb24gdihhKXthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKX1cbmZ1bmN0aW9uIHcoYSxiLGMpe2I9Ynx8W107Yz1jfHxbXTtmb3IodmFyIGQ9YS5jbGFzc05hbWUuc3BsaXQoL1xccysvKSxlPTA7ZTxiLmxlbmd0aDtlKz0xKXtmb3IodmFyIGY9ITEsZz0wO2c8ZC5sZW5ndGg7Zys9MSlpZihiW2VdPT09ZFtnXSl7Zj0hMDticmVha31mfHxkLnB1c2goYltlXSl9Yj1bXTtmb3IoZT0wO2U8ZC5sZW5ndGg7ZSs9MSl7Zj0hMTtmb3IoZz0wO2c8Yy5sZW5ndGg7Zys9MSlpZihkW2VdPT09Y1tnXSl7Zj0hMDticmVha31mfHxiLnB1c2goZFtlXSl9YS5jbGFzc05hbWU9Yi5qb2luKFwiIFwiKS5yZXBsYWNlKC9cXHMrL2csXCIgXCIpLnJlcGxhY2UoL15cXHMrfFxccyskLyxcIlwiKX1mdW5jdGlvbiB5KGEsYil7Zm9yKHZhciBjPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZD0wLGU9Yy5sZW5ndGg7ZDxlO2QrKylpZihjW2RdPT1iKXJldHVybiEwO3JldHVybiExfVxuZnVuY3Rpb24geihhKXtpZihcInN0cmluZ1wiPT09dHlwZW9mIGEuZilyZXR1cm4gYS5mO3ZhciBiPWEubS5sb2NhdGlvbi5wcm90b2NvbDtcImFib3V0OlwiPT1iJiYoYj1hLmEubG9jYXRpb24ucHJvdG9jb2wpO3JldHVyblwiaHR0cHM6XCI9PWI/XCJodHRwczpcIjpcImh0dHA6XCJ9ZnVuY3Rpb24gZWEoYSl7cmV0dXJuIGEubS5sb2NhdGlvbi5ob3N0bmFtZXx8YS5hLmxvY2F0aW9uLmhvc3RuYW1lfVxuZnVuY3Rpb24gQShhLGIsYyl7ZnVuY3Rpb24gZCgpe2smJmUmJmYmJihrKGcpLGs9bnVsbCl9Yj10KGEsXCJsaW5rXCIse3JlbDpcInN0eWxlc2hlZXRcIixocmVmOmIsbWVkaWE6XCJhbGxcIn0pO3ZhciBlPSExLGY9ITAsZz1udWxsLGs9Y3x8bnVsbDtkYT8oYi5vbmxvYWQ9ZnVuY3Rpb24oKXtlPSEwO2QoKX0sYi5vbmVycm9yPWZ1bmN0aW9uKCl7ZT0hMDtnPUVycm9yKFwiU3R5bGVzaGVldCBmYWlsZWQgdG8gbG9hZFwiKTtkKCl9KTpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZT0hMDtkKCl9LDApO3UoYSxcImhlYWRcIixiKX1cbmZ1bmN0aW9uIEIoYSxiLGMsZCl7dmFyIGU9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTtpZihlKXt2YXIgZj10KGEsXCJzY3JpcHRcIix7c3JjOmJ9KSxnPSExO2Yub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Z3x8dGhpcy5yZWFkeVN0YXRlJiZcImxvYWRlZFwiIT10aGlzLnJlYWR5U3RhdGUmJlwiY29tcGxldGVcIiE9dGhpcy5yZWFkeVN0YXRlfHwoZz0hMCxjJiZjKG51bGwpLGYub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPW51bGwsXCJIRUFEXCI9PWYucGFyZW50Tm9kZS50YWdOYW1lJiZlLnJlbW92ZUNoaWxkKGYpKX07ZS5hcHBlbmRDaGlsZChmKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Z3x8KGc9ITAsYyYmYyhFcnJvcihcIlNjcmlwdCBsb2FkIHRpbWVvdXRcIikpKX0sZHx8NUUzKTtyZXR1cm4gZn1yZXR1cm4gbnVsbH07ZnVuY3Rpb24gQygpe3RoaXMuYT0wO3RoaXMuYz1udWxsfWZ1bmN0aW9uIEQoYSl7YS5hKys7cmV0dXJuIGZ1bmN0aW9uKCl7YS5hLS07RShhKX19ZnVuY3Rpb24gRihhLGIpe2EuYz1iO0UoYSl9ZnVuY3Rpb24gRShhKXswPT1hLmEmJmEuYyYmKGEuYygpLGEuYz1udWxsKX07ZnVuY3Rpb24gRyhhKXt0aGlzLmE9YXx8XCItXCJ9Ry5wcm90b3R5cGUuYz1mdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz0wO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspYi5wdXNoKGFyZ3VtZW50c1tjXS5yZXBsYWNlKC9bXFxXX10rL2csXCJcIikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGIuam9pbih0aGlzLmEpfTtmdW5jdGlvbiBIKGEsYil7dGhpcy5jPWE7dGhpcy5mPTQ7dGhpcy5hPVwiblwiO3ZhciBjPShifHxcIm40XCIpLm1hdGNoKC9eKFtuaW9dKShbMS05XSkkL2kpO2MmJih0aGlzLmE9Y1sxXSx0aGlzLmY9cGFyc2VJbnQoY1syXSwxMCkpfWZ1bmN0aW9uIGZhKGEpe3JldHVybiBJKGEpK1wiIFwiKyhhLmYrXCIwMFwiKStcIiAzMDBweCBcIitKKGEuYyl9ZnVuY3Rpb24gSihhKXt2YXIgYj1bXTthPWEuc3BsaXQoLyxcXHMqLyk7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10ucmVwbGFjZSgvWydcIl0vZyxcIlwiKTstMSE9ZC5pbmRleE9mKFwiIFwiKXx8L15cXGQvLnRlc3QoZCk/Yi5wdXNoKFwiJ1wiK2QrXCInXCIpOmIucHVzaChkKX1yZXR1cm4gYi5qb2luKFwiLFwiKX1mdW5jdGlvbiBLKGEpe3JldHVybiBhLmErYS5mfWZ1bmN0aW9uIEkoYSl7dmFyIGI9XCJub3JtYWxcIjtcIm9cIj09PWEuYT9iPVwib2JsaXF1ZVwiOlwiaVwiPT09YS5hJiYoYj1cIml0YWxpY1wiKTtyZXR1cm4gYn1cbmZ1bmN0aW9uIGdhKGEpe3ZhciBiPTQsYz1cIm5cIixkPW51bGw7YSYmKChkPWEubWF0Y2goLyhub3JtYWx8b2JsaXF1ZXxpdGFsaWMpL2kpKSYmZFsxXSYmKGM9ZFsxXS5zdWJzdHIoMCwxKS50b0xvd2VyQ2FzZSgpKSwoZD1hLm1hdGNoKC8oWzEtOV0wMHxub3JtYWx8Ym9sZCkvaSkpJiZkWzFdJiYoL2JvbGQvaS50ZXN0KGRbMV0pP2I9NzovWzEtOV0wMC8udGVzdChkWzFdKSYmKGI9cGFyc2VJbnQoZFsxXS5zdWJzdHIoMCwxKSwxMCkpKSk7cmV0dXJuIGMrYn07ZnVuY3Rpb24gaGEoYSxiKXt0aGlzLmM9YTt0aGlzLmY9YS5tLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDt0aGlzLmg9Yjt0aGlzLmE9bmV3IEcoXCItXCIpO3RoaXMuaj0hMSE9PWIuZXZlbnRzO3RoaXMuZz0hMSE9PWIuY2xhc3Nlc31mdW5jdGlvbiBpYShhKXthLmcmJncoYS5mLFthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpXSk7TChhLFwibG9hZGluZ1wiKX1mdW5jdGlvbiBNKGEpe2lmKGEuZyl7dmFyIGI9eShhLmYsYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpKSxjPVtdLGQ9W2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIildO2J8fGMucHVzaChhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKSk7dyhhLmYsYyxkKX1MKGEsXCJpbmFjdGl2ZVwiKX1mdW5jdGlvbiBMKGEsYixjKXtpZihhLmomJmEuaFtiXSlpZihjKWEuaFtiXShjLmMsSyhjKSk7ZWxzZSBhLmhbYl0oKX07ZnVuY3Rpb24gamEoKXt0aGlzLmM9e319ZnVuY3Rpb24ga2EoYSxiLGMpe3ZhciBkPVtdLGU7Zm9yKGUgaW4gYilpZihiLmhhc093blByb3BlcnR5KGUpKXt2YXIgZj1hLmNbZV07ZiYmZC5wdXNoKGYoYltlXSxjKSl9cmV0dXJuIGR9O2Z1bmN0aW9uIE4oYSxiKXt0aGlzLmM9YTt0aGlzLmY9Yjt0aGlzLmE9dCh0aGlzLmMsXCJzcGFuXCIse1wiYXJpYS1oaWRkZW5cIjpcInRydWVcIn0sdGhpcy5mKX1mdW5jdGlvbiBPKGEpe3UoYS5jLFwiYm9keVwiLGEuYSl9ZnVuY3Rpb24gUChhKXtyZXR1cm5cImRpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05OTk5cHg7bGVmdDotOTk5OXB4O2ZvbnQtc2l6ZTozMDBweDt3aWR0aDphdXRvO2hlaWdodDphdXRvO2xpbmUtaGVpZ2h0Om5vcm1hbDttYXJnaW46MDtwYWRkaW5nOjA7Zm9udC12YXJpYW50Om5vcm1hbDt3aGl0ZS1zcGFjZTpub3dyYXA7Zm9udC1mYW1pbHk6XCIrSihhLmMpK1wiO1wiKyhcImZvbnQtc3R5bGU6XCIrSShhKStcIjtmb250LXdlaWdodDpcIisoYS5mK1wiMDBcIikrXCI7XCIpfTtmdW5jdGlvbiBRKGEsYixjLGQsZSxmKXt0aGlzLmc9YTt0aGlzLmo9Yjt0aGlzLmE9ZDt0aGlzLmM9Yzt0aGlzLmY9ZXx8M0UzO3RoaXMuaD1mfHx2b2lkIDB9US5wcm90b3R5cGUuc3RhcnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmMubS5kb2N1bWVudCxiPXRoaXMsYz1xKCksZD1uZXcgUHJvbWlzZShmdW5jdGlvbihkLGUpe2Z1bmN0aW9uIGsoKXtxKCktYz49Yi5mP2UoKTphLmZvbnRzLmxvYWQoZmEoYi5hKSxiLmgpLnRoZW4oZnVuY3Rpb24oYSl7MTw9YS5sZW5ndGg/ZCgpOnNldFRpbWVvdXQoaywyNSl9LGZ1bmN0aW9uKCl7ZSgpfSl9aygpfSksZT1uZXcgUHJvbWlzZShmdW5jdGlvbihhLGQpe3NldFRpbWVvdXQoZCxiLmYpfSk7UHJvbWlzZS5yYWNlKFtlLGRdKS50aGVuKGZ1bmN0aW9uKCl7Yi5nKGIuYSl9LGZ1bmN0aW9uKCl7Yi5qKGIuYSl9KX07ZnVuY3Rpb24gUihhLGIsYyxkLGUsZixnKXt0aGlzLnY9YTt0aGlzLkI9Yjt0aGlzLmM9Yzt0aGlzLmE9ZDt0aGlzLnM9Z3x8XCJCRVNic3d5XCI7dGhpcy5mPXt9O3RoaXMudz1lfHwzRTM7dGhpcy51PWZ8fG51bGw7dGhpcy5vPXRoaXMuaj10aGlzLmg9dGhpcy5nPW51bGw7dGhpcy5nPW5ldyBOKHRoaXMuYyx0aGlzLnMpO3RoaXMuaD1uZXcgTih0aGlzLmMsdGhpcy5zKTt0aGlzLmo9bmV3IE4odGhpcy5jLHRoaXMucyk7dGhpcy5vPW5ldyBOKHRoaXMuYyx0aGlzLnMpO2E9bmV3IEgodGhpcy5hLmMrXCIsc2VyaWZcIixLKHRoaXMuYSkpO2E9UChhKTt0aGlzLmcuYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSCh0aGlzLmEuYytcIixzYW5zLXNlcmlmXCIsSyh0aGlzLmEpKTthPVAoYSk7dGhpcy5oLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEgoXCJzZXJpZlwiLEsodGhpcy5hKSk7YT1QKGEpO3RoaXMuai5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBIKFwic2Fucy1zZXJpZlwiLEsodGhpcy5hKSk7YT1cblAoYSk7dGhpcy5vLmEuc3R5bGUuY3NzVGV4dD1hO08odGhpcy5nKTtPKHRoaXMuaCk7Tyh0aGlzLmopO08odGhpcy5vKX12YXIgUz17RDpcInNlcmlmXCIsQzpcInNhbnMtc2VyaWZcIn0sVD1udWxsO2Z1bmN0aW9uIFUoKXtpZihudWxsPT09VCl7dmFyIGE9L0FwcGxlV2ViS2l0XFwvKFswLTldKykoPzpcXC4oWzAtOV0rKSkvLmV4ZWMod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1Q9ISFhJiYoNTM2PnBhcnNlSW50KGFbMV0sMTApfHw1MzY9PT1wYXJzZUludChhWzFdLDEwKSYmMTE+PXBhcnNlSW50KGFbMl0sMTApKX1yZXR1cm4gVH1SLnByb3RvdHlwZS5zdGFydD1mdW5jdGlvbigpe3RoaXMuZi5zZXJpZj10aGlzLmouYS5vZmZzZXRXaWR0aDt0aGlzLmZbXCJzYW5zLXNlcmlmXCJdPXRoaXMuby5hLm9mZnNldFdpZHRoO3RoaXMuQT1xKCk7bGEodGhpcyl9O1xuZnVuY3Rpb24gbWEoYSxiLGMpe2Zvcih2YXIgZCBpbiBTKWlmKFMuaGFzT3duUHJvcGVydHkoZCkmJmI9PT1hLmZbU1tkXV0mJmM9PT1hLmZbU1tkXV0pcmV0dXJuITA7cmV0dXJuITF9ZnVuY3Rpb24gbGEoYSl7dmFyIGI9YS5nLmEub2Zmc2V0V2lkdGgsYz1hLmguYS5vZmZzZXRXaWR0aCxkOyhkPWI9PT1hLmYuc2VyaWYmJmM9PT1hLmZbXCJzYW5zLXNlcmlmXCJdKXx8KGQ9VSgpJiZtYShhLGIsYykpO2Q/cSgpLWEuQT49YS53P1UoKSYmbWEoYSxiLGMpJiYobnVsbD09PWEudXx8YS51Lmhhc093blByb3BlcnR5KGEuYS5jKSk/VihhLGEudik6VihhLGEuQik6bmEoYSk6VihhLGEudil9ZnVuY3Rpb24gbmEoYSl7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7bGEodGhpcyl9LGEpLDUwKX1mdW5jdGlvbiBWKGEsYil7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7dih0aGlzLmcuYSk7dih0aGlzLmguYSk7dih0aGlzLmouYSk7dih0aGlzLm8uYSk7Yih0aGlzLmEpfSxhKSwwKX07ZnVuY3Rpb24gVyhhLGIsYyl7dGhpcy5jPWE7dGhpcy5hPWI7dGhpcy5mPTA7dGhpcy5vPXRoaXMuaj0hMTt0aGlzLnM9Y312YXIgWD1udWxsO1cucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2IuZyYmdyhiLmYsW2IuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpXSxbYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpLGIuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIildKTtMKGIsXCJmb250YWN0aXZlXCIsYSk7dGhpcy5vPSEwO29hKHRoaXMpfTtcblcucHJvdG90eXBlLmg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2lmKGIuZyl7dmFyIGM9eShiLmYsYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIikpLGQ9W10sZT1bYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXTtjfHxkLnB1c2goYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKSk7dyhiLmYsZCxlKX1MKGIsXCJmb250aW5hY3RpdmVcIixhKTtvYSh0aGlzKX07ZnVuY3Rpb24gb2EoYSl7MD09LS1hLmYmJmEuaiYmKGEubz8oYT1hLmEsYS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpXSxbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKSxhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKV0pLEwoYSxcImFjdGl2ZVwiKSk6TShhLmEpKX07ZnVuY3Rpb24gcGEoYSl7dGhpcy5qPWE7dGhpcy5hPW5ldyBqYTt0aGlzLmg9MDt0aGlzLmY9dGhpcy5nPSEwfXBhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3RoaXMuYz1uZXcgY2EodGhpcy5qLGEuY29udGV4dHx8dGhpcy5qKTt0aGlzLmc9ITEhPT1hLmV2ZW50czt0aGlzLmY9ITEhPT1hLmNsYXNzZXM7cWEodGhpcyxuZXcgaGEodGhpcy5jLGEpLGEpfTtcbmZ1bmN0aW9uIHJhKGEsYixjLGQsZSl7dmFyIGY9MD09LS1hLmg7KGEuZnx8YS5nKSYmc2V0VGltZW91dChmdW5jdGlvbigpe3ZhciBhPWV8fG51bGwsaz1kfHxudWxsfHx7fTtpZigwPT09Yy5sZW5ndGgmJmYpTShiLmEpO2Vsc2V7Yi5mKz1jLmxlbmd0aDtmJiYoYi5qPWYpO3ZhciBoLG09W107Zm9yKGg9MDtoPGMubGVuZ3RoO2grKyl7dmFyIGw9Y1toXSxuPWtbbC5jXSxyPWIuYSx4PWw7ci5nJiZ3KHIuZixbci5hLmMoXCJ3ZlwiLHguYyxLKHgpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXSk7TChyLFwiZm9udGxvYWRpbmdcIix4KTtyPW51bGw7bnVsbD09PVgmJihYPXdpbmRvdy5Gb250RmFjZT8oeD0vR2Vja28uKkZpcmVmb3hcXC8oXFxkKykvLmV4ZWMod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpKT80MjxwYXJzZUludCh4WzFdLDEwKTohMDohMSk7WD9yPW5ldyBRKHAoYi5nLGIpLHAoYi5oLGIpLGIuYyxsLGIucyxuKTpyPW5ldyBSKHAoYi5nLGIpLHAoYi5oLGIpLGIuYyxsLGIucyxhLFxubik7bS5wdXNoKHIpfWZvcihoPTA7aDxtLmxlbmd0aDtoKyspbVtoXS5zdGFydCgpfX0sMCl9ZnVuY3Rpb24gcWEoYSxiLGMpe3ZhciBkPVtdLGU9Yy50aW1lb3V0O2lhKGIpO3ZhciBkPWthKGEuYSxjLGEuYyksZj1uZXcgVyhhLmMsYixlKTthLmg9ZC5sZW5ndGg7Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspZFtiXS5sb2FkKGZ1bmN0aW9uKGIsZCxjKXtyYShhLGYsYixkLGMpfSl9O2Z1bmN0aW9uIHNhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9ZnVuY3Rpb24gdGEoYSxiLGMpe3ZhciBkPXooYS5jKTthPShhLmEuYXBpfHxcImZhc3QuZm9udHMubmV0L2pzYXBpXCIpLnJlcGxhY2UoL14uKmh0dHAocz8pOihcXC9cXC8pPy8sXCJcIik7cmV0dXJuIGQrXCIvL1wiK2ErXCIvXCIrYitcIi5qc1wiKyhjP1wiP3Y9XCIrYzpcIlwiKX1cbnNhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoKXtpZihmW1wiX19tdGlfZm50THN0XCIrZF0pe3ZhciBjPWZbXCJfX210aV9mbnRMc3RcIitkXSgpLGU9W10saDtpZihjKWZvcih2YXIgbT0wO208Yy5sZW5ndGg7bSsrKXt2YXIgbD1jW21dLmZvbnRmYW1pbHk7dm9pZCAwIT1jW21dLmZvbnRTdHlsZSYmdm9pZCAwIT1jW21dLmZvbnRXZWlnaHQ/KGg9Y1ttXS5mb250U3R5bGUrY1ttXS5mb250V2VpZ2h0LGUucHVzaChuZXcgSChsLGgpKSk6ZS5wdXNoKG5ldyBIKGwpKX1hKGUpfWVsc2Ugc2V0VGltZW91dChmdW5jdGlvbigpe2IoKX0sNTApfXZhciBjPXRoaXMsZD1jLmEucHJvamVjdElkLGU9Yy5hLnZlcnNpb247aWYoZCl7dmFyIGY9Yy5jLm07Qih0aGlzLmMsdGEoYyxkLGUpLGZ1bmN0aW9uKGUpe2U/YShbXSk6KGZbXCJfX01vbm90eXBlQ29uZmlndXJhdGlvbl9fXCIrZF09ZnVuY3Rpb24oKXtyZXR1cm4gYy5hfSxiKCkpfSkuaWQ9XCJfX01vbm90eXBlQVBJU2NyaXB0X19cIitcbmR9ZWxzZSBhKFtdKX07ZnVuY3Rpb24gdWEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn11YS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5hLnVybHN8fFtdLGU9dGhpcy5hLmZhbWlsaWVzfHxbXSxmPXRoaXMuYS50ZXN0U3RyaW5nc3x8e30sZz1uZXcgQztiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKylBKHRoaXMuYyxkW2JdLEQoZykpO3ZhciBrPVtdO2I9MDtmb3IoYz1lLmxlbmd0aDtiPGM7YisrKWlmKGQ9ZVtiXS5zcGxpdChcIjpcIiksZFsxXSlmb3IodmFyIGg9ZFsxXS5zcGxpdChcIixcIiksbT0wO208aC5sZW5ndGg7bSs9MSlrLnB1c2gobmV3IEgoZFswXSxoW21dKSk7ZWxzZSBrLnB1c2gobmV3IEgoZFswXSkpO0YoZyxmdW5jdGlvbigpe2EoayxmKX0pfTtmdW5jdGlvbiB2YShhLGIsYyl7YT90aGlzLmM9YTp0aGlzLmM9Yit3YTt0aGlzLmE9W107dGhpcy5mPVtdO3RoaXMuZz1jfHxcIlwifXZhciB3YT1cIi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzXCI7ZnVuY3Rpb24geGEoYSxiKXtmb3IodmFyIGM9Yi5sZW5ndGgsZD0wO2Q8YztkKyspe3ZhciBlPWJbZF0uc3BsaXQoXCI6XCIpOzM9PWUubGVuZ3RoJiZhLmYucHVzaChlLnBvcCgpKTt2YXIgZj1cIlwiOzI9PWUubGVuZ3RoJiZcIlwiIT1lWzFdJiYoZj1cIjpcIik7YS5hLnB1c2goZS5qb2luKGYpKX19XG5mdW5jdGlvbiB5YShhKXtpZigwPT1hLmEubGVuZ3RoKXRocm93IEVycm9yKFwiTm8gZm9udHMgdG8gbG9hZCFcIik7aWYoLTEhPWEuYy5pbmRleE9mKFwia2l0PVwiKSlyZXR1cm4gYS5jO2Zvcih2YXIgYj1hLmEubGVuZ3RoLGM9W10sZD0wO2Q8YjtkKyspYy5wdXNoKGEuYVtkXS5yZXBsYWNlKC8gL2csXCIrXCIpKTtiPWEuYytcIj9mYW1pbHk9XCIrYy5qb2luKFwiJTdDXCIpOzA8YS5mLmxlbmd0aCYmKGIrPVwiJnN1YnNldD1cIithLmYuam9pbihcIixcIikpOzA8YS5nLmxlbmd0aCYmKGIrPVwiJnRleHQ9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGEuZykpO3JldHVybiBifTtmdW5jdGlvbiB6YShhKXt0aGlzLmY9YTt0aGlzLmE9W107dGhpcy5jPXt9fVxudmFyIEFhPXtsYXRpbjpcIkJFU2Jzd3lcIixcImxhdGluLWV4dFwiOlwiXFx1MDBlN1xcdTAwZjZcXHUwMGZjXFx1MDExZlxcdTAxNWZcIixjeXJpbGxpYzpcIlxcdTA0MzlcXHUwNDRmXFx1MDQxNlwiLGdyZWVrOlwiXFx1MDNiMVxcdTAzYjJcXHUwM2EzXCIsa2htZXI6XCJcXHUxNzgwXFx1MTc4MVxcdTE3ODJcIixIYW51bWFuOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCJ9LEJhPXt0aGluOlwiMVwiLGV4dHJhbGlnaHQ6XCIyXCIsXCJleHRyYS1saWdodFwiOlwiMlwiLHVsdHJhbGlnaHQ6XCIyXCIsXCJ1bHRyYS1saWdodFwiOlwiMlwiLGxpZ2h0OlwiM1wiLHJlZ3VsYXI6XCI0XCIsYm9vazpcIjRcIixtZWRpdW06XCI1XCIsXCJzZW1pLWJvbGRcIjpcIjZcIixzZW1pYm9sZDpcIjZcIixcImRlbWktYm9sZFwiOlwiNlwiLGRlbWlib2xkOlwiNlwiLGJvbGQ6XCI3XCIsXCJleHRyYS1ib2xkXCI6XCI4XCIsZXh0cmFib2xkOlwiOFwiLFwidWx0cmEtYm9sZFwiOlwiOFwiLHVsdHJhYm9sZDpcIjhcIixibGFjazpcIjlcIixoZWF2eTpcIjlcIixsOlwiM1wiLHI6XCI0XCIsYjpcIjdcIn0sQ2E9e2k6XCJpXCIsaXRhbGljOlwiaVwiLG46XCJuXCIsbm9ybWFsOlwiblwifSxcbkRhPS9eKHRoaW58KD86KD86ZXh0cmF8dWx0cmEpLT8pP2xpZ2h0fHJlZ3VsYXJ8Ym9va3xtZWRpdW18KD86KD86c2VtaXxkZW1pfGV4dHJhfHVsdHJhKS0/KT9ib2xkfGJsYWNrfGhlYXZ5fGx8cnxifFsxLTldMDApPyhufGl8bm9ybWFsfGl0YWxpYyk/JC87XG5mdW5jdGlvbiBFYShhKXtmb3IodmFyIGI9YS5mLmxlbmd0aCxjPTA7YzxiO2MrKyl7dmFyIGQ9YS5mW2NdLnNwbGl0KFwiOlwiKSxlPWRbMF0ucmVwbGFjZSgvXFwrL2csXCIgXCIpLGY9W1wibjRcIl07aWYoMjw9ZC5sZW5ndGgpe3ZhciBnO3ZhciBrPWRbMV07Zz1bXTtpZihrKWZvcih2YXIgaz1rLnNwbGl0KFwiLFwiKSxoPWsubGVuZ3RoLG09MDttPGg7bSsrKXt2YXIgbDtsPWtbbV07aWYobC5tYXRjaCgvXltcXHctXSskLykpe3ZhciBuPURhLmV4ZWMobC50b0xvd2VyQ2FzZSgpKTtpZihudWxsPT1uKWw9XCJcIjtlbHNle2w9blsyXTtsPW51bGw9PWx8fFwiXCI9PWw/XCJuXCI6Q2FbbF07bj1uWzFdO2lmKG51bGw9PW58fFwiXCI9PW4pbj1cIjRcIjtlbHNlIHZhciByPUJhW25dLG49cj9yOmlzTmFOKG4pP1wiNFwiOm4uc3Vic3RyKDAsMSk7bD1bbCxuXS5qb2luKFwiXCIpfX1lbHNlIGw9XCJcIjtsJiZnLnB1c2gobCl9MDxnLmxlbmd0aCYmKGY9Zyk7Mz09ZC5sZW5ndGgmJihkPWRbMl0sZz1bXSxkPWQ/ZC5zcGxpdChcIixcIik6XG5nLDA8ZC5sZW5ndGgmJihkPUFhW2RbMF1dKSYmKGEuY1tlXT1kKSl9YS5jW2VdfHwoZD1BYVtlXSkmJihhLmNbZV09ZCk7Zm9yKGQ9MDtkPGYubGVuZ3RoO2QrPTEpYS5hLnB1c2gobmV3IEgoZSxmW2RdKSl9fTtmdW5jdGlvbiBGYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifXZhciBHYT17QXJpbW86ITAsQ291c2luZTohMCxUaW5vczohMH07RmEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IEMsYz10aGlzLmMsZD1uZXcgdmEodGhpcy5hLmFwaSx6KGMpLHRoaXMuYS50ZXh0KSxlPXRoaXMuYS5mYW1pbGllczt4YShkLGUpO3ZhciBmPW5ldyB6YShlKTtFYShmKTtBKGMseWEoZCksRChiKSk7RihiLGZ1bmN0aW9uKCl7YShmLmEsZi5jLEdhKX0pfTtmdW5jdGlvbiBIYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifUhhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYS5pZCxjPXRoaXMuYy5tO2I/Qih0aGlzLmMsKHRoaXMuYS5hcGl8fFwiaHR0cHM6Ly91c2UudHlwZWtpdC5uZXRcIikrXCIvXCIrYitcIi5qc1wiLGZ1bmN0aW9uKGIpe2lmKGIpYShbXSk7ZWxzZSBpZihjLlR5cGVraXQmJmMuVHlwZWtpdC5jb25maWcmJmMuVHlwZWtpdC5jb25maWcuZm4pe2I9Yy5UeXBla2l0LmNvbmZpZy5mbjtmb3IodmFyIGU9W10sZj0wO2Y8Yi5sZW5ndGg7Zis9Milmb3IodmFyIGc9YltmXSxrPWJbZisxXSxoPTA7aDxrLmxlbmd0aDtoKyspZS5wdXNoKG5ldyBIKGcsa1toXSkpO3RyeXtjLlR5cGVraXQubG9hZCh7ZXZlbnRzOiExLGNsYXNzZXM6ITEsYXN5bmM6ITB9KX1jYXRjaChtKXt9YShlKX19LDJFMyk6YShbXSl9O2Z1bmN0aW9uIElhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPVtdfUlhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZi5pZCxjPXRoaXMuYy5tLGQ9dGhpcztiPyhjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX198fChjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX189e30pLGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfX1tiXT1mdW5jdGlvbihiLGMpe2Zvcih2YXIgZz0wLGs9Yy5mb250cy5sZW5ndGg7ZzxrOysrZyl7dmFyIGg9Yy5mb250c1tnXTtkLmEucHVzaChuZXcgSChoLm5hbWUsZ2EoXCJmb250LXdlaWdodDpcIitoLndlaWdodCtcIjtmb250LXN0eWxlOlwiK2guc3R5bGUpKSl9YShkLmEpfSxCKHRoaXMuYyx6KHRoaXMuYykrKHRoaXMuZi5hcGl8fFwiLy9mLmZvbnRkZWNrLmNvbS9zL2Nzcy9qcy9cIikrZWEodGhpcy5jKStcIi9cIitiK1wiLmpzXCIsZnVuY3Rpb24oYil7YiYmYShbXSl9KSk6YShbXSl9O3ZhciBZPW5ldyBwYSh3aW5kb3cpO1kuYS5jLmN1c3RvbT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgdWEoYixhKX07WS5hLmMuZm9udGRlY2s9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IElhKGIsYSl9O1kuYS5jLm1vbm90eXBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBzYShiLGEpfTtZLmEuYy50eXBla2l0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBIYShiLGEpfTtZLmEuYy5nb29nbGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEZhKGIsYSl9O3ZhciBaPXtsb2FkOnAoWS5sb2FkLFkpfTtcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShmdW5jdGlvbigpe3JldHVybiBafSk6XCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPVo6KHdpbmRvdy5XZWJGb250PVosd2luZG93LldlYkZvbnRDb25maWcmJlkubG9hZCh3aW5kb3cuV2ViRm9udENvbmZpZykpO30oKSk7XG4iLCIvKiFcbiAqIHRvb2x0aXBzIDAuMS4wIC0gMjB0aCBEZWMgMjAxM1xuICogaHR0cHM6Ly9naXRodWIuY29tL2RhcnNhaW4vdG9vbHRpcFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKiBAbW9kaWZpZWQgYnkgRGphbWlsIExlZ2F0b1xuICovXG47KGZ1bmN0aW9uKCl7XG5cbiAgICAvKipcbiAgICAgKiBSZXF1aXJlIHRoZSBnaXZlbiBwYXRoLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGhcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGV4cG9ydHNcbiAgICAgKiBAYXBpIHB1YmxpY1xuICAgICAqL1xuXG4gICAgZnVuY3Rpb24gZmFrZVJlcXVpcmUocGF0aCwgcGFyZW50LCBvcmlnKSB7XG4gICAgICAgIHZhciByZXNvbHZlZCA9IGZha2VSZXF1aXJlLnJlc29sdmUocGF0aCk7XG5cbiAgICAgICAgLy8gbG9va3VwIGZhaWxlZFxuICAgICAgICBpZiAobnVsbCA9PSByZXNvbHZlZCkge1xuICAgICAgICAgICAgb3JpZyA9IG9yaWcgfHwgcGF0aDtcbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudCB8fCAncm9vdCc7XG4gICAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdGYWlsZWQgdG8gZmFrZVJlcXVpcmUgXCInICsgb3JpZyArICdcIiBmcm9tIFwiJyArIHBhcmVudCArICdcIicpO1xuICAgICAgICAgICAgZXJyLnBhdGggPSBvcmlnO1xuICAgICAgICAgICAgZXJyLnBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgICAgIGVyci5mYWtlUmVxdWlyZSA9IHRydWU7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbW9kdWxlID0gZmFrZVJlcXVpcmUubW9kdWxlc1tyZXNvbHZlZF07XG5cbiAgICAgICAgLy8gcGVyZm9ybSByZWFsIGZha2VSZXF1aXJlKClcbiAgICAgICAgLy8gYnkgaW52b2tpbmcgdGhlIG1vZHVsZSdzXG4gICAgICAgIC8vIHJlZ2lzdGVyZWQgZnVuY3Rpb25cbiAgICAgICAgaWYgKCFtb2R1bGUuX3Jlc29sdmluZyAmJiAhbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgICAgIHZhciBtb2QgPSB7fTtcbiAgICAgICAgICAgIG1vZC5leHBvcnRzID0ge307XG4gICAgICAgICAgICBtb2QuY2xpZW50ID0gbW9kLmNvbXBvbmVudCA9IHRydWU7XG4gICAgICAgICAgICBtb2R1bGUuX3Jlc29sdmluZyA9IHRydWU7XG4gICAgICAgICAgICBtb2R1bGUuY2FsbCh0aGlzLCBtb2QuZXhwb3J0cywgZmFrZVJlcXVpcmUucmVsYXRpdmUocmVzb2x2ZWQpLCBtb2QpO1xuICAgICAgICAgICAgZGVsZXRlIG1vZHVsZS5fcmVzb2x2aW5nO1xuICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBtb2QuZXhwb3J0cztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcmVkIG1vZHVsZXMuXG4gICAgICovXG5cbiAgICBmYWtlUmVxdWlyZS5tb2R1bGVzID0ge307XG5cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcmVkIGFsaWFzZXMuXG4gICAgICovXG5cbiAgICBmYWtlUmVxdWlyZS5hbGlhc2VzID0ge307XG5cbiAgICAvKipcbiAgICAgKiBSZXNvbHZlIGBwYXRoYC5cbiAgICAgKlxuICAgICAqIExvb2t1cDpcbiAgICAgKlxuICAgICAqICAgLSBQQVRIL2luZGV4LmpzXG4gICAgICogICAtIFBBVEguanNcbiAgICAgKiAgIC0gUEFUSFxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGhcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHBhdGggb3IgbnVsbFxuICAgICAqIEBhcGkgcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgZmFrZVJlcXVpcmUucmVzb2x2ZSA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgICAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHBhdGggPSBwYXRoLnNsaWNlKDEpO1xuXG4gICAgICAgIHZhciBwYXRocyA9IFtcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBwYXRoICsgJy5qcycsXG4gICAgICAgICAgICBwYXRoICsgJy5qc29uJyxcbiAgICAgICAgICAgIHBhdGggKyAnL2luZGV4LmpzJyxcbiAgICAgICAgICAgIHBhdGggKyAnL2luZGV4Lmpzb24nXG4gICAgICAgIF07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRocy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHBhdGggPSBwYXRoc1tpXTtcbiAgICAgICAgICAgIGlmIChmYWtlUmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcGF0aDtcbiAgICAgICAgICAgIGlmIChmYWtlUmVxdWlyZS5hbGlhc2VzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gZmFrZVJlcXVpcmUuYWxpYXNlc1twYXRoXTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBOb3JtYWxpemUgYHBhdGhgIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGguXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY3VyclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoXG4gICAgICogQHJldHVybiB7U3RyaW5nfVxuICAgICAqIEBhcGkgcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgZmFrZVJlcXVpcmUubm9ybWFsaXplID0gZnVuY3Rpb24oY3VyciwgcGF0aCkge1xuICAgICAgICB2YXIgc2VncyA9IFtdO1xuXG4gICAgICAgIGlmICgnLicgIT0gcGF0aC5jaGFyQXQoMCkpIHJldHVybiBwYXRoO1xuXG4gICAgICAgIGN1cnIgPSBjdXJyLnNwbGl0KCcvJyk7XG4gICAgICAgIHBhdGggPSBwYXRoLnNwbGl0KCcvJyk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoJy4uJyA9PSBwYXRoW2ldKSB7XG4gICAgICAgICAgICAgICAgY3Vyci5wb3AoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJy4nICE9IHBhdGhbaV0gJiYgJycgIT0gcGF0aFtpXSkge1xuICAgICAgICAgICAgICAgIHNlZ3MucHVzaChwYXRoW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjdXJyLmNvbmNhdChzZWdzKS5qb2luKCcvJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVyIG1vZHVsZSBhdCBgcGF0aGAgd2l0aCBjYWxsYmFjayBgZGVmaW5pdGlvbmAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aFxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGRlZmluaXRpb25cbiAgICAgKiBAYXBpIHByaXZhdGVcbiAgICAgKi9cblxuICAgIGZha2VSZXF1aXJlLnJlZ2lzdGVyID0gZnVuY3Rpb24ocGF0aCwgZGVmaW5pdGlvbikge1xuICAgICAgICBmYWtlUmVxdWlyZS5tb2R1bGVzW3BhdGhdID0gZGVmaW5pdGlvbjtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQWxpYXMgYSBtb2R1bGUgZGVmaW5pdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHRvXG4gICAgICogQGFwaSBwcml2YXRlXG4gICAgICovXG5cbiAgICBmYWtlUmVxdWlyZS5hbGlhcyA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7XG4gICAgICAgIGlmICghZmFrZVJlcXVpcmUubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShmcm9tKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYWxpYXMgXCInICsgZnJvbSArICdcIiwgaXQgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgfVxuICAgICAgICBmYWtlUmVxdWlyZS5hbGlhc2VzW3RvXSA9IGZyb207XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIGZha2VSZXF1aXJlIGZ1bmN0aW9uIHJlbGF0aXZlIHRvIHRoZSBgcGFyZW50YCBwYXRoLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhcmVudFxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgICAqIEBhcGkgcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgZmFrZVJlcXVpcmUucmVsYXRpdmUgPSBmdW5jdGlvbihwYXJlbnQpIHtcbiAgICAgICAgdmFyIHAgPSBmYWtlUmVxdWlyZS5ub3JtYWxpemUocGFyZW50LCAnLi4nKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogbGFzdEluZGV4T2YgaGVscGVyLlxuICAgICAgICAgKi9cblxuICAgICAgICBmdW5jdGlvbiBsYXN0SW5kZXhPZihhcnIsIG9iaikge1xuICAgICAgICAgICAgdmFyIGkgPSBhcnIubGVuZ3RoO1xuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHJlbGF0aXZlIGZha2VSZXF1aXJlKCkgaXRzZWxmLlxuICAgICAgICAgKi9cblxuICAgICAgICBmdW5jdGlvbiBsb2NhbFJlcXVpcmUocGF0aCkge1xuICAgICAgICAgICAgdmFyIHJlc29sdmVkID0gbG9jYWxSZXF1aXJlLnJlc29sdmUocGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gZmFrZVJlcXVpcmUocmVzb2x2ZWQsIHBhcmVudCwgcGF0aCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzb2x2ZSByZWxhdGl2ZSB0byB0aGUgcGFyZW50LlxuICAgICAgICAgKi9cblxuICAgICAgICBsb2NhbFJlcXVpcmUucmVzb2x2ZSA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgICAgICAgIHZhciBjID0gcGF0aC5jaGFyQXQoMCk7XG4gICAgICAgICAgICBpZiAoJy8nID09IGMpIHJldHVybiBwYXRoLnNsaWNlKDEpO1xuICAgICAgICAgICAgaWYgKCcuJyA9PSBjKSByZXR1cm4gZmFrZVJlcXVpcmUubm9ybWFsaXplKHAsIHBhdGgpO1xuXG4gICAgICAgICAgICAvLyByZXNvbHZlIGRlcHMgYnkgcmV0dXJuaW5nXG4gICAgICAgICAgICAvLyB0aGUgZGVwIGluIHRoZSBuZWFyZXN0IFwiZGVwc1wiXG4gICAgICAgICAgICAvLyBkaXJlY3RvcnlcbiAgICAgICAgICAgIHZhciBzZWdzID0gcGFyZW50LnNwbGl0KCcvJyk7XG4gICAgICAgICAgICB2YXIgaSA9IGxhc3RJbmRleE9mKHNlZ3MsICdkZXBzJykgKyAxO1xuICAgICAgICAgICAgaWYgKCFpKSBpID0gMDtcbiAgICAgICAgICAgIHBhdGggPSBzZWdzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcvJykgKyAnL2RlcHMvJyArIHBhdGg7XG4gICAgICAgICAgICByZXR1cm4gcGF0aDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgbW9kdWxlIGlzIGRlZmluZWQgYXQgYHBhdGhgLlxuICAgICAgICAgKi9cblxuICAgICAgICBsb2NhbFJlcXVpcmUuZXhpc3RzID0gZnVuY3Rpb24ocGF0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZha2VSZXF1aXJlLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobG9jYWxSZXF1aXJlLnJlc29sdmUocGF0aCkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBsb2NhbFJlcXVpcmU7XG4gICAgfTtcbiAgICBmYWtlUmVxdWlyZS5yZWdpc3RlcihcImRhcnNhaW4tcG9zaXRpb24vaW5kZXguanNcIiwgRnVuY3Rpb24oXCJleHBvcnRzLCBmYWtlUmVxdWlyZSwgbW9kdWxlXCIsXG4gICAgICAgIFwiJ3VzZSBzdHJpY3QnO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFRyYW5zcG9ydC5cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHBvc2l0aW9uO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIEdsb2JhbHMuXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgdmFyIHdpbiA9IHdpbmRvdztcXG5cXFxuICAgICAgICB2YXIgZG9jID0gd2luLmRvY3VtZW50O1xcblxcXG4gICAgICAgIHZhciBkb2NFbCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUG9vciBtYW4ncyBzaGFsbG93IG9iamVjdCBleHRlbmQuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gYVxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBiXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgZnVuY3Rpb24gZXh0ZW5kKGEsIGIpIHtcXG5cXFxuICAgICAgICBcXHRmb3IgKHZhciBrZXkgaW4gYikge1xcblxcXG4gICAgICAgIFxcdFxcdGFba2V5XSA9IGJba2V5XTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIGE7XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIENoZWNrcyB3aGV0aGVyIG9iamVjdCBpcyB3aW5kb3cuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIGZ1bmN0aW9uIGlzV2luKG9iaikge1xcblxcXG4gICAgICAgIFxcdHJldHVybiBvYmogJiYgb2JqLnNldEludGVydmFsICE9IG51bGw7XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFJldHVybnMgZWxlbWVudCdzIG9iamVjdCB3aXRoIGBsZWZ0YCwgYHRvcGAsIGBib3R0b21gLCBgcmlnaHRgLCBgd2lkdGhgLCBhbmQgYGhlaWdodGBcXG5cXFxuICAgICAgICAgKiBwcm9wZXJ0aWVzIGluZGljYXRpbmcgdGhlIHBvc2l0aW9uIGFuZCBkaW1lbnNpb25zIG9mIGVsZW1lbnQgb24gYSBwYWdlLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgZnVuY3Rpb24gcG9zaXRpb24oZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdHZhciB3aW5Ub3AgPSB3aW4ucGFnZVlPZmZzZXQgfHwgZG9jRWwuc2Nyb2xsVG9wO1xcblxcXG4gICAgICAgIFxcdHZhciB3aW5MZWZ0ID0gd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsLnNjcm9sbExlZnQ7XFxuXFxcbiAgICAgICAgXFx0dmFyIGJveCA9IHsgbGVmdDogMCwgcmlnaHQ6IDAsIHRvcDogMCwgYm90dG9tOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0aWYgKGlzV2luKGVsZW1lbnQpKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0Ym94LndpZHRoID0gd2luLmlubmVyV2lkdGggfHwgZG9jRWwuY2xpZW50V2lkdGg7XFxuXFxcbiAgICAgICAgXFx0XFx0Ym94LmhlaWdodCA9IHdpbi5pbm5lckhlaWdodCB8fCBkb2NFbC5jbGllbnRIZWlnaHQ7XFxuXFxcbiAgICAgICAgXFx0fSBlbHNlIGlmIChkb2NFbC5jb250YWlucyhlbGVtZW50KSAmJiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPSBudWxsKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0ZXh0ZW5kKGJveCwgZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XFxuXFxcbiAgICAgICAgXFx0XFx0Ly8gd2lkdGggJiBoZWlnaHQgZG9uJ3QgZXhpc3QgaW4gPElFOVxcblxcXG4gICAgICAgIFxcdFxcdGJveC53aWR0aCA9IGJveC5yaWdodCAtIGJveC5sZWZ0O1xcblxcXG4gICAgICAgIFxcdFxcdGJveC5oZWlnaHQgPSBib3guYm90dG9tIC0gYm94LnRvcDtcXG5cXFxuICAgICAgICBcXHR9IGVsc2Uge1xcblxcXG4gICAgICAgIFxcdFxcdHJldHVybiBib3g7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdGJveC50b3AgPSBib3gudG9wICsgd2luVG9wIC0gZG9jRWwuY2xpZW50VG9wO1xcblxcXG4gICAgICAgIFxcdGJveC5sZWZ0ID0gYm94LmxlZnQgKyB3aW5MZWZ0IC0gZG9jRWwuY2xpZW50TGVmdDtcXG5cXFxuICAgICAgICBcXHRib3gucmlnaHQgPSBib3gubGVmdCArIGJveC53aWR0aDtcXG5cXFxuICAgICAgICBcXHRib3guYm90dG9tID0gYm94LnRvcCArIGJveC5oZWlnaHQ7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIGJveDtcXG5cXFxuICAgICAgICB9Ly8jIHNvdXJjZVVSTD1kYXJzYWluLXBvc2l0aW9uL2luZGV4LmpzXCJcbiAgICApKTtcbiAgICBmYWtlUmVxdWlyZS5yZWdpc3RlcihcImNvbXBvbmVudC1jbGFzc2VzL2luZGV4LmpzXCIsIEZ1bmN0aW9uKFwiZXhwb3J0cywgZmFrZVJlcXVpcmUsIG1vZHVsZVwiLFxuICAgICAgICBcIi8qKlxcblxcXG4gICAgICAgICAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgdmFyIGluZGV4ID0gZmFrZVJlcXVpcmUoJ2luZGV4b2YnKTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBXaGl0ZXNwYWNlIHJlZ2V4cC5cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICB2YXIgcmUgPSAvXFxcXHMrLztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiB0b1N0cmluZyByZWZlcmVuY2UuXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwdWJsaWNcXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGVsKXtcXG5cXFxuICAgICAgICAgIHJldHVybiBuZXcgQ2xhc3NMaXN0KGVsKTtcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBlbFxcblxcXG4gICAgICAgICAqIEBhcGkgcHJpdmF0ZVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIGZ1bmN0aW9uIENsYXNzTGlzdChlbCkge1xcblxcXG4gICAgICAgICAgaWYgKCFlbCkgdGhyb3cgbmV3IEVycm9yKCdBIERPTSBlbGVtZW50IHJlZmVyZW5jZSBpcyBmYWtlUmVxdWlyZWQnKTtcXG5cXFxuICAgICAgICAgIHRoaXMuZWwgPSBlbDtcXG5cXFxuICAgICAgICAgIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDtcXG5cXFxuICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogQWRkIGNsYXNzIGBuYW1lYCBpZiBub3QgYWxyZWFkeSBwcmVzZW50LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwdWJsaWNcXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBDbGFzc0xpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKG5hbWUpe1xcblxcXG4gICAgICAgICAgLy8gY2xhc3NMaXN0XFxuXFxcbiAgICAgICAgICBpZiAodGhpcy5saXN0KSB7XFxuXFxcbiAgICAgICAgICAgIHRoaXMubGlzdC5hZGQobmFtZSk7XFxuXFxcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgICAgLy8gZmFsbGJhY2tcXG5cXFxuICAgICAgICAgIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7XFxuXFxcbiAgICAgICAgICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7XFxuXFxcbiAgICAgICAgICBpZiAoIX5pKSBhcnIucHVzaChuYW1lKTtcXG5cXFxuICAgICAgICAgIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTtcXG5cXFxuICAgICAgICAgIHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yXFxuXFxcbiAgICAgICAgICogcGFzcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byByZW1vdmVcXG5cXFxuICAgICAgICAgKiBhbnkgd2hpY2ggbWF0Y2guXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IG5hbWVcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwdWJsaWNcXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpe1xcblxcXG4gICAgICAgICAgaWYgKCdbb2JqZWN0IFJlZ0V4cF0nID09IHRvU3RyaW5nLmNhbGwobmFtZSkpIHtcXG5cXFxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmcobmFtZSk7XFxuXFxcbiAgICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgICAvLyBjbGFzc0xpc3RcXG5cXFxuICAgICAgICAgIGlmICh0aGlzLmxpc3QpIHtcXG5cXFxuICAgICAgICAgICAgdGhpcy5saXN0LnJlbW92ZShuYW1lKTtcXG5cXFxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XFxuXFxcbiAgICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgICAvLyBmYWxsYmFja1xcblxcXG4gICAgICAgICAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTtcXG5cXFxuICAgICAgICAgIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTtcXG5cXFxuICAgICAgICAgIGlmICh+aSkgYXJyLnNwbGljZShpLCAxKTtcXG5cXFxuICAgICAgICAgIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTtcXG5cXFxuICAgICAgICAgIHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUmVtb3ZlIGFsbCBjbGFzc2VzIG1hdGNoaW5nIGByZWAuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gcmVcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwcml2YXRlXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmVNYXRjaGluZyA9IGZ1bmN0aW9uKHJlKXtcXG5cXFxuICAgICAgICAgIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7XFxuXFxcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xcblxcXG4gICAgICAgICAgICBpZiAocmUudGVzdChhcnJbaV0pKSB7XFxuXFxcbiAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoYXJyW2ldKTtcXG5cXFxuICAgICAgICAgICAgfVxcblxcXG4gICAgICAgICAgfVxcblxcXG4gICAgICAgICAgcmV0dXJuIHRoaXM7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBUb2dnbGUgY2xhc3MgYG5hbWVgLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwdWJsaWNcXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBDbGFzc0xpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKG5hbWUpe1xcblxcXG4gICAgICAgICAgLy8gY2xhc3NMaXN0XFxuXFxcbiAgICAgICAgICBpZiAodGhpcy5saXN0KSB7XFxuXFxcbiAgICAgICAgICAgIHRoaXMubGlzdC50b2dnbGUobmFtZSk7XFxuXFxcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgICAgLy8gZmFsbGJhY2tcXG5cXFxuICAgICAgICAgIGlmICh0aGlzLmhhcyhuYW1lKSkge1xcblxcXG4gICAgICAgICAgICB0aGlzLnJlbW92ZShuYW1lKTtcXG5cXFxuICAgICAgICAgIH0gZWxzZSB7XFxuXFxcbiAgICAgICAgICAgIHRoaXMuYWRkKG5hbWUpO1xcblxcXG4gICAgICAgICAgfVxcblxcXG4gICAgICAgICAgcmV0dXJuIHRoaXM7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBSZXR1cm4gYW4gYXJyYXkgb2YgY2xhc3Nlcy5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge0FycmF5fVxcblxcXG4gICAgICAgICAqIEBhcGkgcHVibGljXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgQ2xhc3NMaXN0LnByb3RvdHlwZS5hcnJheSA9IGZ1bmN0aW9uKCl7XFxuXFxcbiAgICAgICAgICB2YXIgc3RyID0gdGhpcy5lbC5jbGFzc05hbWUucmVwbGFjZSgvXlxcXFxzK3xcXFxccyskL2csICcnKTtcXG5cXFxuICAgICAgICAgIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpO1xcblxcXG4gICAgICAgICAgaWYgKCcnID09PSBhcnJbMF0pIGFyci5zaGlmdCgpO1xcblxcXG4gICAgICAgICAgcmV0dXJuIGFycjtcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9XFxuXFxcbiAgICAgICAgICogQGFwaSBwdWJsaWNcXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBDbGFzc0xpc3QucHJvdG90eXBlLmhhcyA9XFxuXFxcbiAgICAgICAgQ2xhc3NMaXN0LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKG5hbWUpe1xcblxcXG4gICAgICAgICAgcmV0dXJuIHRoaXMubGlzdFxcblxcXG4gICAgICAgICAgICA/IHRoaXMubGlzdC5jb250YWlucyhuYW1lKVxcblxcXG4gICAgICAgICAgICA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgLy8jIHNvdXJjZVVSTD1jb21wb25lbnQtY2xhc3Nlcy9pbmRleC5qc1wiXG4gICAgKSk7XG4gICAgZmFrZVJlcXVpcmUucmVnaXN0ZXIoXCJkYXJzYWluLXRvb2x0aXAvaW5kZXguanNcIiwgRnVuY3Rpb24oXCJleHBvcnRzLCBmYWtlUmVxdWlyZSwgbW9kdWxlXCIsXG4gICAgICAgIFwiJ3VzZSBzdHJpY3QnO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIERlcGVuZGVuY2llcy5cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICB2YXIgZXZ0ID0gZmFrZVJlcXVpcmUoJ2V2ZW50Jyk7XFxuXFxcbiAgICAgICAgdmFyIGNsYXNzZXMgPSBmYWtlUmVxdWlyZSgnY2xhc3NlcycpO1xcblxcXG4gICAgICAgIHZhciBpbmRleE9mID0gZmFrZVJlcXVpcmUoJ2luZGV4b2YnKTtcXG5cXFxuICAgICAgICB2YXIgcG9zaXRpb24gPSBmYWtlUmVxdWlyZSgncG9zaXRpb24nKTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBHbG9iYWxzLlxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIHZhciB3aW4gPSB3aW5kb3c7XFxuXFxcbiAgICAgICAgdmFyIGRvYyA9IHdpbi5kb2N1bWVudDtcXG5cXFxuICAgICAgICB2YXIgYm9keSA9IGRvYy5ib2R5O1xcblxcXG4gICAgICAgIHZhciB2ZXJ0aWNhbFBsYWNlcyA9IFsndG9wJywgJ2JvdHRvbSddO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFRyYW5zcG9ydC5cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IFRvb2x0aXA7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUHJvdG90eXBhbCBpbmhlcml0YW5jZS5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgdmFyIG9iamVjdENyZWF0ZSA9IE9iamVjdC5jcmVhdGUgfHwgKGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHRmdW5jdGlvbiBGKCkge31cXG5cXFxuICAgICAgICBcXHRyZXR1cm4gZnVuY3Rpb24gKG8pIHtcXG5cXFxuICAgICAgICBcXHRcXHRGLnByb3RvdHlwZSA9IG87XFxuXFxcbiAgICAgICAgXFx0XFx0cmV0dXJuIG5ldyBGKCk7XFxuXFxcbiAgICAgICAgXFx0fTtcXG5cXFxuICAgICAgICB9KSgpO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFBvb3IgbWFuJ3Mgc2hhbGxvdyBvYmplY3QgZXh0ZW5kLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGFcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gYlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIGZ1bmN0aW9uIGV4dGVuZChhLCBiKSB7XFxuXFxcbiAgICAgICAgXFx0Zm9yICh2YXIga2V5IGluIGIpIHtcXG5cXFxuICAgICAgICBcXHRcXHRhW2tleV0gPSBiW2tleV07XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHJldHVybiBhO1xcblxcXG4gICAgICAgIH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBQYXJzZSBpbnRlZ2VyIGZyb20gc3RyaW5ncyBsaWtlICctNTBweCcuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZVxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7SW50ZWdlcn1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBmdW5jdGlvbiBwYXJzZVB4KHZhbHVlKSB7XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIDAgfCBNYXRoLnJvdW5kKFN0cmluZyh2YWx1ZSkucmVwbGFjZSgvW15cXFxcLTAtOS5dL2csICcnKSk7XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIEdldCBjb21wdXRlZCBzdHlsZSBvZiBlbGVtZW50LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIHZhciBzdHlsZSA9IHdpbi5nZXRDb21wdXRlZFN0eWxlID8gZnVuY3Rpb24gc3R5bGUoZWxlbWVudCwgbmFtZSkge1xcblxcXG4gICAgICAgIFxcdHJldHVybiB3aW4uZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKVtuYW1lXTtcXG5cXFxuICAgICAgICB9IDogZnVuY3Rpb24gc3R5bGUoZWxlbWVudCwgbmFtZSkge1xcblxcXG4gICAgICAgIFxcdHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZVtuYW1lXTtcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFJldHVybnMgdHJhbnNpdGlvbiBkdXJhdGlvbiBvZiBlbGVtZW50IGluIG1zLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtJbnR9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgZnVuY3Rpb24gdHJhbnNpdGlvbkR1cmF0aW9uKGVsZW1lbnQpIHtcXG5cXFxuICAgICAgICBcXHR2YXIgZHVyYXRpb24gPSBTdHJpbmcoc3R5bGUoZWxlbWVudCwgdHJhbnNpdGlvbkR1cmF0aW9uLnByb3BOYW1lKSk7XFxuXFxcbiAgICAgICAgXFx0dmFyIG1hdGNoID0gZHVyYXRpb24ubWF0Y2goLyhbMC05Ll0rKShbbXNdezEsMn0pLyk7XFxuXFxcbiAgICAgICAgXFx0aWYgKG1hdGNoKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0ZHVyYXRpb24gPSBOdW1iZXIobWF0Y2hbMV0pO1xcblxcXG4gICAgICAgIFxcdFxcdGlmIChtYXRjaFsyXSA9PT0gJ3MnKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0ZHVyYXRpb24gKj0gMTAwMDtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHJldHVybiAwfGR1cmF0aW9uO1xcblxcXG4gICAgICAgIH1cXG5cXFxuICAgICAgICB0cmFuc2l0aW9uRHVyYXRpb24ucHJvcE5hbWUgPSAoZnVuY3Rpb24gKCkge1xcblxcXG4gICAgICAgIFxcdHZhciBlbGVtZW50ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xcblxcXG4gICAgICAgIFxcdHZhciBuYW1lcyA9IFsndHJhbnNpdGlvbkR1cmF0aW9uJywgJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddO1xcblxcXG4gICAgICAgIFxcdHZhciB2YWx1ZSA9ICcxcyc7XFxuXFxcbiAgICAgICAgXFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykge1xcblxcXG4gICAgICAgIFxcdFxcdGVsZW1lbnQuc3R5bGVbbmFtZXNbaV1dID0gdmFsdWU7XFxuXFxcbiAgICAgICAgXFx0XFx0aWYgKGVsZW1lbnQuc3R5bGVbbmFtZXNbaV1dID09PSB2YWx1ZSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHJldHVybiBuYW1lc1tpXTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIH0oKSk7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogVG9vbHRpcCBjb25zdHJ1bmN0b3IuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xFbGVtZW50fSBjb250ZW50XFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICAgICAgICAgb3B0aW9uc1xcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBmdW5jdGlvbiBUb29sdGlwKGNvbnRlbnQsIG9wdGlvbnMpIHtcXG5cXFxuICAgICAgICBcXHRpZiAoISh0aGlzIGluc3RhbmNlb2YgVG9vbHRpcCkpIHtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gbmV3IFRvb2x0aXAoY29udGVudCwgb3B0aW9ucyk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHRoaXMuaGlkZGVuID0gMTtcXG5cXFxuICAgICAgICBcXHR0aGlzLm9wdGlvbnMgPSBleHRlbmQob2JqZWN0Q3JlYXRlKFRvb2x0aXAuZGVmYXVsdHMpLCBvcHRpb25zKTtcXG5cXFxuICAgICAgICBcXHR0aGlzLl9jcmVhdGVFbGVtZW50KCk7XFxuXFxcbiAgICAgICAgXFx0dGhpcy5jb250ZW50KGNvbnRlbnQpO1xcblxcXG4gICAgICAgIH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBDcmVhdGVzIGEgdG9vbHRpcCBlbGVtZW50LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7Vm9pZH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5fY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHR0aGlzLmVsZW1lbnQgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XFxuXFxcbiAgICAgICAgXFx0dGhpcy5jbGFzc2VzID0gY2xhc3Nlcyh0aGlzLmVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdHRoaXMuY2xhc3Nlcy5hZGQodGhpcy5vcHRpb25zLmJhc2VDbGFzcyk7XFxuXFxcbiAgICAgICAgXFx0dmFyIHByb3BOYW1lO1xcblxcXG4gICAgICAgIFxcdGZvciAodmFyIGkgPSAwOyBpIDwgVG9vbHRpcC5jbGFzc1R5cGVzLmxlbmd0aDsgaSsrKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0cHJvcE5hbWUgPSBUb29sdGlwLmNsYXNzVHlwZXNbaV0gKyAnQ2xhc3MnO1xcblxcXG4gICAgICAgIFxcdFxcdGlmICh0aGlzLm9wdGlvbnNbcHJvcE5hbWVdKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dGhpcy5jbGFzc2VzLmFkZCh0aGlzLm9wdGlvbnNbcHJvcE5hbWVdKTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogQ2hhbmdlcyB0b29sdGlwJ3MgdHlwZSBjbGFzcyB0eXBlLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge1Rvb2x0aXB9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgVG9vbHRpcC5wcm90b3R5cGUudHlwZSA9IGZ1bmN0aW9uIChuYW1lKSB7XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIHRoaXMuY2hhbmdlQ2xhc3NUeXBlKCd0eXBlJywgbmFtZSk7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBDaGFuZ2VzIHRvb2x0aXAncyBlZmZlY3QgY2xhc3MgdHlwZS5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtUb29sdGlwfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAucHJvdG90eXBlLmVmZmVjdCA9IGZ1bmN0aW9uIChuYW1lKSB7XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIHRoaXMuY2hhbmdlQ2xhc3NUeXBlKCdlZmZlY3QnLCBuYW1lKTtcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIENoYW5nZXMgY2xhc3MgdHlwZS5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wTmFtZVxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdDbGFzc1xcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5jaGFuZ2VDbGFzc1R5cGUgPSBmdW5jdGlvbiAocHJvcE5hbWUsIG5ld0NsYXNzKSB7XFxuXFxcbiAgICAgICAgXFx0cHJvcE5hbWUgKz0gJ0NsYXNzJztcXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5vcHRpb25zW3Byb3BOYW1lXSkge1xcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuY2xhc3Nlcy5yZW1vdmUodGhpcy5vcHRpb25zW3Byb3BOYW1lXSk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHRoaXMub3B0aW9uc1twcm9wTmFtZV0gPSBuZXdDbGFzcztcXG5cXFxuICAgICAgICBcXHRpZiAobmV3Q2xhc3MpIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLmNsYXNzZXMuYWRkKG5ld0NsYXNzKTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIHRoaXM7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBVcGRhdGVzIHRvb2x0aXAncyBkaW1lbnNpb25zLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS51cGRhdGVTaXplID0gZnVuY3Rpb24gKCkge1xcblxcXG4gICAgICAgIFxcdGlmICh0aGlzLmhpZGRlbikge1xcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XFxuXFxcbiAgICAgICAgXFx0XFx0d2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0dGhpcy53aWR0aCA9IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcXG5cXFxuICAgICAgICBcXHR0aGlzLmhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XFxuXFxcbiAgICAgICAgXFx0aWYgKHRoaXMuc3BhY2luZyA9PSBudWxsKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5zcGFjaW5nID0gdGhpcy5vcHRpb25zLnNwYWNpbmcgIT0gbnVsbCA/IHRoaXMub3B0aW9ucy5zcGFjaW5nIDogcGFyc2VQeChzdHlsZSh0aGlzLmVsZW1lbnQsICd0b3AnKSk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdGlmICh0aGlzLm9mZnNldCA9PSBudWxsKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5vZmZzZXQgPSB0aGlzLm9wdGlvbnMub2Zmc2V0ICE9IG51bGwgPyB0aGlzLm9wdGlvbnMub2Zmc2V0IDogMDtcXG5cXFxuICAgIFxcdH1cXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5oaWRkZW4pIHtcXG5cXFxuICAgICAgICBcXHRcXHR3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJyc7XFxuXFxcbiAgICAgICAgXFx0fSBlbHNlIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLnBvc2l0aW9uKCk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogQ2hhbmdlIHRvb2x0aXAgY29udGVudC5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIFdoZW4gdG9vbHRpcCBpcyB2aXNpYmxlLCBpdHMgc2l6ZSBpcyBhdXRvbWF0aWNhbGx5XFxuXFxcbiAgICAgICAgICogc3luY2VkIGFuZCB0b29sdGlwIGNvcnJlY3RseSByZXBvc2l0aW9uZWQuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xFbGVtZW50fSBjb250ZW50XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtUb29sdGlwfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAucHJvdG90eXBlLmNvbnRlbnQgPSBmdW5jdGlvbiAoY29udGVudCkge1xcblxcXG4gICAgICAgIFxcdGlmICh0eXBlb2YgY29udGVudCA9PT0gJ29iamVjdCcpIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKGNvbnRlbnQpO1xcblxcXG4gICAgICAgIFxcdH0gZWxzZSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IGNvbnRlbnQ7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHRoaXMudXBkYXRlU2l6ZSgpO1xcblxcXG4gICAgICAgIFxcdHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUGljayBuZXcgcGxhY2UgdG9vbHRpcCBzaG91bGQgYmUgZGlzcGxheWVkIGF0LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogV2hlbiB0aGUgdG9vbHRpcCBpcyB2aXNpYmxlLCBpdCBpcyBhdXRvbWF0aWNhbGx5IHBvc2l0aW9uZWQgdGhlcmUuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGxhY2VcXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge1Rvb2x0aXB9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgVG9vbHRpcC5wcm90b3R5cGUucGxhY2UgPSBmdW5jdGlvbiAocGxhY2UpIHtcXG5cXFxuICAgICAgICBcXHR0aGlzLm9wdGlvbnMucGxhY2UgPSBwbGFjZTtcXG5cXFxuICAgICAgICBcXHRpZiAoIXRoaXMuaGlkZGVuKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5wb3NpdGlvbigpO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXHRyZXR1cm4gdGhpcztcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIEF0dGFjaCB0b29sdGlwIHRvIGFuIGVsZW1lbnQuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnRcXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge1Rvb2x0aXB9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgVG9vbHRpcC5wcm90b3R5cGUuYXR0YWNoID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcXG5cXFxuICAgICAgICBcXHR0aGlzLmF0dGFjaGVkVG8gPSBlbGVtZW50O1xcblxcXG4gICAgICAgIFxcdGlmICghdGhpcy5oaWRkZW4pIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLnBvc2l0aW9uKCk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcdHJldHVybiB0aGlzO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogRGV0YWNoIHRvb2x0aXAgZnJvbSBlbGVtZW50LlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5kZXRhY2ggPSBmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0dGhpcy5oaWRlKCk7XFxuXFxcbiAgICAgICAgXFx0dGhpcy5hdHRhY2hlZFRvID0gbnVsbDtcXG5cXFxuICAgICAgICBcXHRyZXR1cm4gdGhpcztcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFBpY2sgdGhlIG1vc3QgcmVhc29uYWJsZSBwbGFjZSBmb3IgdGFyZ2V0IHBvc2l0aW9uLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldFxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5fcGlja1BsYWNlID0gZnVuY3Rpb24gKHRhcmdldCkge1xcblxcXG4gICAgICAgIFxcdGlmICghdGhpcy5vcHRpb25zLmF1dG8pIHtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gdGhpcy5vcHRpb25zLnBsYWNlO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXHR2YXIgd2luUG9zID0gcG9zaXRpb24od2luKTtcXG5cXFxuICAgICAgICBcXHR2YXIgcGxhY2UgPSB0aGlzLm9wdGlvbnMucGxhY2Uuc3BsaXQoJy0nKTtcXG5cXFxuICAgICAgICBcXHR2YXIgc3BhY2luZyA9IHRoaXMuc3BhY2luZztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRpZiAofmluZGV4T2YodmVydGljYWxQbGFjZXMsIHBsYWNlWzBdKSkge1xcblxcXG4gICAgICAgIFxcdFxcdGlmICh0YXJnZXQudG9wIC0gdGhpcy5oZWlnaHQgLSBzcGFjaW5nIDw9IHdpblBvcy50b3ApIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRwbGFjZVswXSA9ICdib3R0b20nO1xcblxcXG4gICAgICAgIFxcdFxcdH0gZWxzZSBpZiAodGFyZ2V0LmJvdHRvbSArIHRoaXMuaGVpZ2h0ICsgc3BhY2luZyA+PSB3aW5Qb3MuYm90dG9tKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0cGxhY2VbMF0gPSAndG9wJztcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0c3dpdGNoIChwbGFjZVsxXSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGNhc2UgJ2xlZnQnOlxcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdGlmICh0YXJnZXQucmlnaHQgLSB0aGlzLndpZHRoIDw9IHdpblBvcy5sZWZ0KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0XFx0cGxhY2VbMV0gPSAncmlnaHQnO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRjYXNlICdyaWdodCc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0aWYgKHRhcmdldC5sZWZ0ICsgdGhpcy53aWR0aCA+PSB3aW5Qb3MucmlnaHQpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRcXHRwbGFjZVsxXSA9ICdsZWZ0JztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0YnJlYWs7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0ZGVmYXVsdDpcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRpZiAodGFyZ2V0LmxlZnQgKyB0YXJnZXQud2lkdGggLyAyICsgdGhpcy53aWR0aCAvIDIgPj0gd2luUG9zLnJpZ2h0KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0XFx0cGxhY2VbMV0gPSAnbGVmdCc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0fSBlbHNlIGlmICh0YXJnZXQucmlnaHQgLSB0YXJnZXQud2lkdGggLyAyIC0gdGhpcy53aWR0aCAvIDIgPD0gd2luUG9zLmxlZnQpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRcXHRwbGFjZVsxXSA9ICdyaWdodCc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHR9IGVsc2Uge1xcblxcXG4gICAgICAgIFxcdFxcdGlmICh0YXJnZXQubGVmdCAtIHRoaXMud2lkdGggLSBzcGFjaW5nIDw9IHdpblBvcy5sZWZ0KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0cGxhY2VbMF0gPSAncmlnaHQnO1xcblxcXG4gICAgICAgIFxcdFxcdH0gZWxzZSBpZiAodGFyZ2V0LnJpZ2h0ICsgdGhpcy53aWR0aCArIHNwYWNpbmcgPj0gd2luUG9zLnJpZ2h0KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0cGxhY2VbMF0gPSAnbGVmdCc7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdHN3aXRjaCAocGxhY2VbMV0pIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRjYXNlICd0b3AnOlxcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdGlmICh0YXJnZXQuYm90dG9tIC0gdGhpcy5oZWlnaHQgPD0gd2luUG9zLnRvcCkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdFxcdHBsYWNlWzFdID0gJ2JvdHRvbSc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdGJyZWFrO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGNhc2UgJ2JvdHRvbSc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0aWYgKHRhcmdldC50b3AgKyB0aGlzLmhlaWdodCA+PSB3aW5Qb3MuYm90dG9tKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0XFx0cGxhY2VbMV0gPSAndG9wJztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0YnJlYWs7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0ZGVmYXVsdDpcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRpZiAodGFyZ2V0LnRvcCArIHRhcmdldC5oZWlnaHQgLyAyICsgdGhpcy5oZWlnaHQgLyAyID49IHdpblBvcy5ib3R0b20pIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRcXHRwbGFjZVsxXSA9ICd0b3AnO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdH0gZWxzZSBpZiAodGFyZ2V0LmJvdHRvbSAtIHRhcmdldC5oZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyIDw9IHdpblBvcy50b3ApIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRcXHRwbGFjZVsxXSA9ICdib3R0b20nO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdHJldHVybiBwbGFjZS5qb2luKCctJyk7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBQb3NpdGlvbiB0aGUgZWxlbWVudCB0byBhbiBlbGVtZW50IG9yIGEgc3BlY2lmaWMgY29vcmRpbmF0ZXMuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ8RWxlbWVudH0geFxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gICAgICAgICB5XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtUb29sdGlwfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAucHJvdG90eXBlLnBvc2l0aW9uID0gZnVuY3Rpb24gKHgsIHkpIHtcXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5hdHRhY2hlZFRvKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0eCA9IHRoaXMuYXR0YWNoZWRUbztcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0aWYgKHggPT0gbnVsbCAmJiB0aGlzLl9wKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0eCA9IHRoaXMuX3BbMF07XFxuXFxcbiAgICAgICAgXFx0XFx0eSA9IHRoaXMuX3BbMV07XFxuXFxcbiAgICAgICAgXFx0fSBlbHNlIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLl9wID0gYXJndW1lbnRzO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXHR2YXIgdGFyZ2V0ID0gdHlwZW9mIHggPT09ICdudW1iZXInID8ge1xcblxcXG4gICAgICAgIFxcdFxcdGxlZnQ6IDB8eCxcXG5cXFxuICAgICAgICBcXHRcXHRyaWdodDogMHx4LFxcblxcXG4gICAgICAgIFxcdFxcdHRvcDogMHx5LFxcblxcXG4gICAgICAgIFxcdFxcdGJvdHRvbTogMHx5LFxcblxcXG4gICAgICAgIFxcdFxcdHdpZHRoOiAwLFxcblxcXG4gICAgICAgIFxcdFxcdGhlaWdodDogMFxcblxcXG4gICAgICAgIFxcdH0gOiBwb3NpdGlvbih4KTtcXG5cXFxuICAgICAgICBcXHR2YXIgc3BhY2luZyA9IE51bWJlcih0aGlzLnNwYWNpbmcpLCBvZmZzZXQgPSBOdW1iZXIodGhpcy5vZmZzZXQpO1xcblxcXG4gICAgICAgIFxcdHZhciBuZXdQbGFjZSA9IHRoaXMuX3BpY2tQbGFjZSh0YXJnZXQpO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8vIEFkZC9DaGFuZ2UgcGxhY2UgY2xhc3Mgd2hlbiBuZWNlc3NhcnlcXG5cXFxuICAgICAgICBcXHRpZiAobmV3UGxhY2UgIT09IHRoaXMuY3VyUGxhY2UpIHtcXG5cXFxuICAgICAgICBcXHRcXHRpZiAodGhpcy5jdXJQbGFjZSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHRoaXMuY2xhc3Nlcy5yZW1vdmUodGhpcy5jdXJQbGFjZSk7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuY2xhc3Nlcy5hZGQobmV3UGxhY2UpO1xcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuY3VyUGxhY2UgPSBuZXdQbGFjZTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gUG9zaXRpb24gdGhlIHRpcFxcblxcXG4gICAgICAgIFxcdHZhciB0b3AsIGxlZnQ7XFxuXFxcbiAgICAgICAgXFx0c3dpdGNoICh0aGlzLmN1clBsYWNlKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0Y2FzZSAndG9wJzpcXG5cXFxuICAgICAgICBcXHRcXHRcXHR0b3AgPSB0YXJnZXQudG9wIC0gdGhpcy5oZWlnaHQgLSBzcGFjaW5nO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGxlZnQgPSB0YXJnZXQubGVmdCArIHRhcmdldC53aWR0aCAvIDIgLSB0aGlzLndpZHRoIC8gMjtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICd0b3AtbGVmdCc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LnRvcCAtIHRoaXMuaGVpZ2h0IC0gc3BhY2luZztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRsZWZ0ID0gdGFyZ2V0LnJpZ2h0IC0gdGhpcy53aWR0aCAtIG9mZnNldDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICd0b3AtcmlnaHQnOlxcblxcXG4gICAgICAgIFxcdFxcdFxcdHRvcCA9IHRhcmdldC50b3AgLSB0aGlzLmhlaWdodCAtIHNwYWNpbmc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0bGVmdCA9IHRhcmdldC5sZWZ0ICsgb2Zmc2V0O1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGJyZWFrO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdFxcdGNhc2UgJ2JvdHRvbSc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LmJvdHRvbSArIHNwYWNpbmc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0bGVmdCA9IHRhcmdldC5sZWZ0ICsgdGFyZ2V0LndpZHRoIC8gMiAtIHRoaXMud2lkdGggLyAyO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGJyZWFrO1xcblxcXG4gICAgICAgIFxcdFxcdGNhc2UgJ2JvdHRvbS1sZWZ0JzpcXG5cXFxuICAgICAgICBcXHRcXHRcXHR0b3AgPSB0YXJnZXQuYm90dG9tICsgc3BhY2luZztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRsZWZ0ID0gdGFyZ2V0LnJpZ2h0IC0gdGhpcy53aWR0aCAtIG9mZnNldDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICdib3R0b20tcmlnaHQnOlxcblxcXG4gICAgICAgIFxcdFxcdFxcdHRvcCA9IHRhcmdldC5ib3R0b20gKyBzcGFjaW5nO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGxlZnQgPSB0YXJnZXQubGVmdCArIG9mZnNldDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICdsZWZ0JzpcXG5cXFxuICAgICAgICBcXHRcXHRcXHR0b3AgPSB0YXJnZXQudG9wICsgdGFyZ2V0LmhlaWdodCAvIDIgLSB0aGlzLmhlaWdodCAvIDI7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0bGVmdCA9IHRhcmdldC5sZWZ0IC0gdGhpcy53aWR0aCAtIHNwYWNpbmc7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0YnJlYWs7XFxuXFxcbiAgICAgICAgXFx0XFx0Y2FzZSAnbGVmdC10b3AnOlxcblxcXG4gICAgICAgIFxcdFxcdFxcdHRvcCA9IHRhcmdldC5ib3R0b20gLSB0aGlzLmhlaWdodDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRsZWZ0ID0gdGFyZ2V0LmxlZnQgLSB0aGlzLndpZHRoIC0gc3BhY2luZztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICdsZWZ0LWJvdHRvbSc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LnRvcDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRsZWZ0ID0gdGFyZ2V0LmxlZnQgLSB0aGlzLndpZHRoIC0gc3BhY2luZztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRcXHRjYXNlICdyaWdodCc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LnRvcCArIHRhcmdldC5oZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGxlZnQgPSB0YXJnZXQucmlnaHQgKyBzcGFjaW5nO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGJyZWFrO1xcblxcXG4gICAgICAgIFxcdFxcdGNhc2UgJ3JpZ2h0LXRvcCc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LmJvdHRvbSAtIHRoaXMuaGVpZ2h0O1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGxlZnQgPSB0YXJnZXQucmlnaHQgKyBzcGFjaW5nO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGJyZWFrO1xcblxcXG4gICAgICAgIFxcdFxcdGNhc2UgJ3JpZ2h0LWJvdHRvbSc6XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dG9wID0gdGFyZ2V0LnRvcDtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRsZWZ0ID0gdGFyZ2V0LnJpZ2h0ICsgc3BhY2luZztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRicmVhaztcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gU2V0IHRpcCBwb3NpdGlvbiAmIGNsYXNzXFxuXFxcbiAgICAgICAgXFx0dGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IE1hdGgucm91bmQodG9wKSArICdweCc7XFxuXFxcbiAgICAgICAgXFx0dGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBNYXRoLnJvdW5kKGxlZnQpICsgJ3B4JztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRyZXR1cm4gdGhpcztcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFNob3cgdGhlIHRvb2x0aXAuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ8RWxlbWVudH0geFxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gICAgICAgICB5XFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtUb29sdGlwfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoeCwgeSkge1xcblxcXG4gICAgICAgIFxcdHggPSB0aGlzLmF0dGFjaGVkVG8gPyB0aGlzLmF0dGFjaGVkVG8gOiB4O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8vIENsZWFyIHBvdGVudGlhbCBvbmdvaW5nIGFuaW1hdGlvblxcblxcXG4gICAgICAgIFxcdGNsZWFyVGltZW91dCh0aGlzLmFJbmRleCk7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gUG9zaXRpb24gdGhlIGVsZW1lbnQgd2hlbiByZXF1ZXN0ZWRcXG5cXFxuICAgICAgICBcXHRpZiAoeCAhPSBudWxsKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5wb3NpdGlvbih4LCB5KTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gU3RvcCBoZXJlIGlmIHRpcCBpcyBhbHJlYWR5IHZpc2libGVcXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5oaWRkZW4pIHtcXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLmhpZGRlbiA9IDA7XFxuXFxcbiAgICAgICAgXFx0XFx0d2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gTWFrZSB0b29sdGlwIGF3YXJlIG9mIHdpbmRvdyByZXNpemVcXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5hdHRhY2hlZFRvKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5fYXdhcmUoKTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gVHJpZ2dlciBsYXlvdXQgYW5kIGtpY2sgaW4gdGhlIHRyYW5zaXRpb25cXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5vcHRpb25zLmluQ2xhc3MpIHtcXG5cXFxuICAgICAgICBcXHRcXHRpZiAodGhpcy5vcHRpb25zLmVmZmVjdENsYXNzKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dm9pZCB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHR0aGlzLmNsYXNzZXMuYWRkKHRoaXMub3B0aW9ucy5pbkNsYXNzKTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIHRoaXM7XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBIaWRlIHRoZSB0b29sdGlwLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7VG9vbHRpcH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xcblxcXG4gICAgICAgIFxcdGlmICh0aGlzLmhpZGRlbikge1xcblxcXG4gICAgICAgIFxcdFxcdHJldHVybjtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0dmFyIHNlbGYgPSB0aGlzO1xcblxcXG4gICAgICAgIFxcdHZhciBkdXJhdGlvbiA9IDA7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0Ly8gUmVtb3ZlIC5pbiBjbGFzcyBhbmQgY2FsY3VsYXRlIHRyYW5zaXRpb24gZHVyYXRpb24gaWYgYW55XFxuXFxcbiAgICAgICAgXFx0aWYgKHRoaXMub3B0aW9ucy5pbkNsYXNzKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5jbGFzc2VzLnJlbW92ZSh0aGlzLm9wdGlvbnMuaW5DbGFzcyk7XFxuXFxcbiAgICAgICAgXFx0XFx0aWYgKHRoaXMub3B0aW9ucy5lZmZlY3RDbGFzcykge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGR1cmF0aW9uID0gdHJhbnNpdGlvbkR1cmF0aW9uKHRoaXMuZWxlbWVudCk7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvLyBSZW1vdmUgdGlwIGZyb20gd2luZG93IHJlc2l6ZSBhd2FyZW5lc3NcXG5cXFxuICAgICAgICBcXHRpZiAodGhpcy5hdHRhY2hlZFRvKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dGhpcy5fdW5hd2FyZSgpO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvLyBSZW1vdmUgdGhlIHRpcCBmcm9tIHRoZSBET00gd2hlbiB0cmFuc2l0aW9uIGlzIGRvbmVcXG5cXFxuICAgICAgICBcXHRjbGVhclRpbWVvdXQodGhpcy5hSW5kZXgpO1xcblxcXG4gICAgICAgIFxcdHRoaXMuYUluZGV4ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0c2VsZi5hSW5kZXggPSAwO1xcblxcXG4gICAgICAgIFxcdFxcdHdpbmRvdy5kb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNlbGYuZWxlbWVudCk7XFxuXFxcbiAgICAgICAgXFx0XFx0c2VsZi5oaWRkZW4gPSAxO1xcblxcXG4gICAgICAgIFxcdH0sIGR1cmF0aW9uKTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRyZXR1cm4gdGhpcztcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFRvb2x0aXAucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICh4LCB5KSB7XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIHRoaXNbdGhpcy5oaWRkZW4gPyAnc2hvdycgOiAnaGlkZSddKHgsIHkpO1xcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgVG9vbHRpcC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHRjbGVhclRpbWVvdXQodGhpcy5hSW5kZXgpO1xcblxcXG4gICAgICAgIFxcdHRoaXMuX3VuYXdhcmUoKTtcXG5cXFxuICAgICAgICBcXHRpZiAoIXRoaXMuaGlkZGVuKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0d2luZG93LmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0dGhpcy5lbGVtZW50ID0gdGhpcy5vcHRpb25zID0gbnVsbDtcXG5cXFxuICAgICAgICB9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIE1ha2UgdGhlIHRpcCB3aW5kb3cgcmVzaXplIGF3YXJlLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7Vm9pZH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5fYXdhcmUgPSBmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0dmFyIGluZGV4ID0gaW5kZXhPZihUb29sdGlwLndpbkF3YXJlLCB0aGlzKTtcXG5cXFxuICAgICAgICBcXHRpZiAoIX5pbmRleCkge1xcblxcXG4gICAgICAgIFxcdFxcdFRvb2x0aXAud2luQXdhcmUucHVzaCh0aGlzKTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBSZW1vdmUgdGhlIHdpbmRvdyByZXNpemUgYXdhcmVuZXNzLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7Vm9pZH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwLnByb3RvdHlwZS5fdW5hd2FyZSA9IGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHR2YXIgaW5kZXggPSBpbmRleE9mKFRvb2x0aXAud2luQXdhcmUsIHRoaXMpO1xcblxcXG4gICAgICAgIFxcdGlmICh+aW5kZXgpIHtcXG5cXFxuICAgICAgICBcXHRcXHRUb29sdGlwLndpbkF3YXJlLnNwbGljZShpbmRleCwgMSk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogSGFuZGxlcyByZXBvc2l0aW9uaW5nIG9mIHRvb2x0aXBzIG9uIHdpbmRvdyByZXNpemUuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtWb2lkfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAucmVwb3NpdGlvbiA9IChmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0dmFyIHJBRiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoZm4pIHtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gc2V0VGltZW91dChmbiwgMTcpO1xcblxcXG4gICAgICAgIFxcdH07XFxuXFxcbiAgICAgICAgXFx0dmFyIHJJbmRleDtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRmdW5jdGlvbiByZXF1ZXN0UmVwb3NpdGlvbigpIHtcXG5cXFxuICAgICAgICBcXHRcXHRpZiAockluZGV4IHx8ICFUb29sdGlwLndpbkF3YXJlLmxlbmd0aCkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHJldHVybjtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0ckluZGV4ID0gckFGKHJlcG9zaXRpb24sIDE3KTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0ZnVuY3Rpb24gcmVwb3NpdGlvbigpIHtcXG5cXFxuICAgICAgICBcXHRcXHRySW5kZXggPSAwO1xcblxcXG4gICAgICAgIFxcdFxcdHZhciB0aXA7XFxuXFxcbiAgICAgICAgXFx0XFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBUb29sdGlwLndpbkF3YXJlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHRpcCA9IFRvb2x0aXAud2luQXdhcmVbaV07XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0dGlwLnBvc2l0aW9uKCk7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRyZXR1cm4gcmVxdWVzdFJlcG9zaXRpb247XFxuXFxcbiAgICAgICAgfSgpKTtcXG5cXFxuICAgICAgICBUb29sdGlwLndpbkF3YXJlID0gW107XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLy8gQmluZCB3aW5Bd2FyZSByZXBvc2l0aW9uaW5nIHRvIHdpbmRvdyByZXNpemUgZXZlbnRcXG5cXFxuICAgICAgICBldnQuYmluZCh3aW5kb3csICdyZXNpemUnLCBUb29sdGlwLnJlcG9zaXRpb24pO1xcblxcXG4gICAgICAgIGV2dC5iaW5kKHdpbmRvdywgJ3Njcm9sbCcsIFRvb2x0aXAucmVwb3NpdGlvbik7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogQXJyYXkgd2l0aCBkeW5hbWljIGNsYXNzIHR5cGVzLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHR5cGUge0FycmF5fVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAuY2xhc3NUeXBlcyA9IFsndHlwZScsICdlZmZlY3QnXTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBEZWZhdWx0IG9wdGlvbnMgZm9yIFRvb2x0aXAgY29uc3RydWN0b3IuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXAuZGVmYXVsdHMgPSB7XFxuXFxcbiAgICAgICAgXFx0YmFzZUNsYXNzOiAgICd0b29sdGlwJywgLy8gQmFzZSB0b29sdGlwIGNsYXNzIG5hbWUuXFxuXFxcbiAgICAgICAgXFx0dHlwZUNsYXNzOiAgIG51bGwsICAgICAgLy8gVHlwZSB0b29sdGlwIGNsYXNzIG5hbWUuXFxuXFxcbiAgICAgICAgXFx0ZWZmZWN0Q2xhc3M6IG51bGwsICAgICAgLy8gRWZmZWN0IHRvb2x0aXAgY2xhc3MgbmFtZS5cXG5cXFxuICAgICAgICBcXHRpbkNsYXNzOiAgICAgJ2luJywgICAgICAvLyBDbGFzcyB1c2VkIHRvIHRyYW5zaXRpb24gc3R1ZmYgaW4uXFxuXFxcbiAgICAgICAgXFx0cGxhY2U6ICAgICAgICd0b3AnLCAgICAgLy8gRGVmYXVsdCBwbGFjZS5cXG5cXFxuICAgICAgICBcXHRzcGFjaW5nOiAgICAgbnVsbCwgICAgICAvLyBHYXAgYmV0d2VlbiB0YXJnZXQgYW5kIHRvb2x0aXAuXFxuXFxcbiAgICAgICAgXFx0b2Zmc2V0OiAgICAgIG51bGwsICAgICAgLy8gSG9yaXpvbnRhbCBvZmZzZXQgdG8gYWxpZ24gYXJyb3dcXG5cXFxuICAgICAgICBcXHRhdXRvOiAgICAgICAgMCAgICAgICAgICAvLyBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgYWRqdXN0IHBsYWNlIHRvIGZpdCBpbnRvIHdpbmRvdy5cXG5cXFxuICAgICAgICB9Oy8vIyBzb3VyY2VVUkw9ZGFyc2Fpbi10b29sdGlwL2luZGV4LmpzXCJcbiAgICApKTtcbiAgICBmYWtlUmVxdWlyZS5yZWdpc3RlcihcImRhcnNhaW4tZXZlbnQvaW5kZXguanNcIiwgRnVuY3Rpb24oXCJleHBvcnRzLCBmYWtlUmVxdWlyZSwgbW9kdWxlXCIsXG4gICAgICAgIFwiJ3VzZSBzdHJpY3QnO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIEJpbmQgYGVsYCBldmVudCBgdHlwZWAgdG8gYGZuYC5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7RWxlbWVudH0gIGVsXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9ICAgdHlwZVxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSAgY2FwdHVyZVxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgZXhwb3J0cy5iaW5kID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPyBmdW5jdGlvbiAoZWwsIHR5cGUsIGZuLCBjYXB0dXJlKSB7XFxuXFxcbiAgICAgICAgXFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIGZuO1xcblxcXG4gICAgICAgIH0gOiBmdW5jdGlvbiAoZWwsIHR5cGUsIGZuKSB7XFxuXFxcbiAgICAgICAgXFx0dmFyIGZuaWQgPSB0eXBlICsgZm47XFxuXFxcbiAgICAgICAgXFx0ZWxbZm5pZF0gPSBlbFtmbmlkXSB8fCBmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dmFyIGV2ZW50ID0gd2luZG93LmV2ZW50O1xcblxcXG4gICAgICAgIFxcdFxcdGV2ZW50LnRhcmdldCA9IGV2ZW50LnNyY0VsZW1lbnQ7XFxuXFxcbiAgICAgICAgXFx0XFx0ZXZlbnQucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0ZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTtcXG5cXFxuICAgICAgICBcXHRcXHR9O1xcblxcXG4gICAgICAgIFxcdFxcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlO1xcblxcXG4gICAgICAgIFxcdFxcdH07XFxuXFxcbiAgICAgICAgXFx0XFx0Zm4uY2FsbChlbCwgZXZlbnQpO1xcblxcXG4gICAgICAgIFxcdH07XFxuXFxcbiAgICAgICAgXFx0ZWwuYXR0YWNoRXZlbnQoJ29uJyArIHR5cGUsIGVsW2ZuaWRdKTtcXG5cXFxuICAgICAgICBcXHRyZXR1cm4gZm47XFxuXFxcbiAgICAgICAgfTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBVbmJpbmQgYGVsYCBldmVudCBgdHlwZWAncyBjYWxsYmFjayBgZm5gLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSAgZWxcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gICB0eXBlXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59ICBjYXB0dXJlXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBleHBvcnRzLnVuYmluZCA9IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyID8gZnVuY3Rpb24gKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSkge1xcblxcXG4gICAgICAgIFxcdGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpO1xcblxcXG4gICAgICAgIFxcdHJldHVybiBmbjtcXG5cXFxuICAgICAgICB9IDogZnVuY3Rpb24gKGVsLCB0eXBlLCBmbikge1xcblxcXG4gICAgICAgIFxcdHZhciBmbmlkID0gdHlwZSArIGZuO1xcblxcXG4gICAgICAgIFxcdGVsLmRldGFjaEV2ZW50KCdvbicgKyB0eXBlLCBlbFtmbmlkXSk7XFxuXFxcbiAgICAgICAgXFx0dHJ5IHtcXG5cXFxuICAgICAgICBcXHRcXHRkZWxldGUgZWxbZm5pZF07XFxuXFxcbiAgICAgICAgXFx0fSBjYXRjaCAoZXJyKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0Ly8gY2FuJ3QgZGVsZXRlIHdpbmRvdyBvYmplY3QgcHJvcGVydGllc1xcblxcXG4gICAgICAgIFxcdFxcdGVsW2ZuaWRdID0gdW5kZWZpbmVkO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXHRyZXR1cm4gZm47XFxuXFxcbiAgICAgICAgfTsvLyMgc291cmNlVVJMPWRhcnNhaW4tZXZlbnQvaW5kZXguanNcIlxuICAgICkpO1xuICAgIGZha2VSZXF1aXJlLnJlZ2lzdGVyKFwiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanNcIiwgRnVuY3Rpb24oXCJleHBvcnRzLCBmYWtlUmVxdWlyZSwgbW9kdWxlXCIsXG4gICAgICAgIFwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhcnIsIG9iail7XFxuXFxcbiAgICAgICAgICBpZiAoYXJyLmluZGV4T2YpIHJldHVybiBhcnIuaW5kZXhPZihvYmopO1xcblxcXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHtcXG5cXFxuICAgICAgICAgICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTtcXG5cXFxuICAgICAgICAgIH1cXG5cXFxuICAgICAgICAgIHJldHVybiAtMTtcXG5cXFxuICAgICAgICB9Oy8vIyBzb3VyY2VVUkw9Y29tcG9uZW50LWluZGV4b2YvaW5kZXguanNcIlxuICAgICkpO1xuICAgIGZha2VSZXF1aXJlLnJlZ2lzdGVyKFwiY29kZTQyZGF5LWRhdGFzZXQvaW5kZXguanNcIiwgRnVuY3Rpb24oXCJleHBvcnRzLCBmYWtlUmVxdWlyZSwgbW9kdWxlXCIsXG4gICAgICAgIFwibW9kdWxlLmV4cG9ydHM9ZGF0YXNldDtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKmdsb2JhbCBkb2N1bWVudCovXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLy8gcmVwbGFjZSBuYW1lc0xpa2VUaGlzIHdpdGggbmFtZXMtbGlrZS10aGlzXFxuXFxcbiAgICAgICAgZnVuY3Rpb24gdG9EYXNoZWQobmFtZSkge1xcblxcXG4gICAgICAgICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvKFtBLVpdKS9nLCBmdW5jdGlvbih1KSB7XFxuXFxcbiAgICAgICAgICAgIHJldHVybiBcXFwiLVxcXCIgKyB1LnRvTG93ZXJDYXNlKCk7XFxuXFxcbiAgICAgICAgICB9KTtcXG5cXFxuICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgdmFyIGZuO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIGlmIChkb2N1bWVudC5oZWFkLmRhdGFzZXQpIHtcXG5cXFxuICAgICAgICAgIGZuID0ge1xcblxcXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKG5vZGUsIGF0dHIsIHZhbHVlKSB7XFxuXFxcbiAgICAgICAgICAgICAgIGlmICghbm9kZS5kYXRhc2V0KSByZXR1cm47XFxcbiAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldFthdHRyXSA9IHZhbHVlO1xcblxcXG4gICAgICAgICAgICB9LFxcblxcXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKG5vZGUsIGF0dHIpIHtcXG5cXFxuICAgICAgICAgICAgICByZXR1cm4gbm9kZS5kYXRhc2V0ICYmIG5vZGUuZGF0YXNldFthdHRyXTtcXG5cXFxuICAgICAgICAgICAgfVxcblxcXG4gICAgICAgICAgfTtcXG5cXFxuICAgICAgICB9IGVsc2Uge1xcblxcXG4gICAgICAgICAgZm4gPSB7XFxuXFxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24obm9kZSwgYXR0ciwgdmFsdWUpIHtcXG5cXFxuICAgICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgnZGF0YS0nICsgdG9EYXNoZWQoYXR0ciksIHZhbHVlKTtcXG5cXFxuICAgICAgICAgICAgfSxcXG5cXFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihub2RlLCBhdHRyKSB7XFxuXFxcbiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLScgKyB0b0Rhc2hlZChhdHRyKSk7XFxuXFxcbiAgICAgICAgICAgIH1cXG5cXFxuICAgICAgICAgIH07XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIGZ1bmN0aW9uIGRhdGFzZXQobm9kZSwgYXR0ciwgdmFsdWUpIHtcXG5cXFxuICAgICAgICAgIHZhciBzZWxmID0ge1xcblxcXG4gICAgICAgICAgICBzZXQ6IHNldCxcXG5cXFxuICAgICAgICAgICAgZ2V0OiBnZXRcXG5cXFxuICAgICAgICAgIH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgICBmdW5jdGlvbiBzZXQoYXR0ciwgdmFsdWUpIHtcXG5cXFxuICAgICAgICAgICAgZm4uc2V0KG5vZGUsIGF0dHIsIHZhbHVlKTtcXG5cXFxuICAgICAgICAgICAgcmV0dXJuIHNlbGY7XFxuXFxcbiAgICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgICBmdW5jdGlvbiBnZXQoYXR0cikge1xcblxcXG4gICAgICAgICAgICByZXR1cm4gZm4uZ2V0KG5vZGUsIGF0dHIpO1xcblxcXG4gICAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMpIHtcXG5cXFxuICAgICAgICAgICAgcmV0dXJuIHNldChhdHRyLCB2YWx1ZSk7XFxuXFxcbiAgICAgICAgICB9XFxuXFxcbiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyKSB7XFxuXFxcbiAgICAgICAgICAgIHJldHVybiBnZXQoYXR0cik7XFxuXFxcbiAgICAgICAgICB9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgICByZXR1cm4gc2VsZjtcXG5cXFxuICAgICAgICB9Ly8jIHNvdXJjZVVSTD1jb2RlNDJkYXktZGF0YXNldC9pbmRleC5qc1wiXG4gICAgKSk7XG4gICAgZmFrZVJlcXVpcmUucmVnaXN0ZXIoXCJ0b29sdGlwcy9pbmRleC5qc1wiLCBGdW5jdGlvbihcImV4cG9ydHMsIGZha2VSZXF1aXJlLCBtb2R1bGVcIixcbiAgICAgICAgXCIndXNlIHN0cmljdCc7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogRGVwZW5kZW5jaWVzLlxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIHZhciBldnQgPSBmYWtlUmVxdWlyZSgnZXZlbnQnKTtcXG5cXFxuICAgICAgICB2YXIgaW5kZXhPZiA9IGZha2VSZXF1aXJlKCdpbmRleG9mJyk7XFxuXFxcbiAgICAgICAgdmFyIFRvb2x0aXAgPSBmYWtlUmVxdWlyZSgndG9vbHRpcCcpO1xcblxcXG4gICAgICAgIHZhciBkYXRhc2V0ID0gZmFrZVJlcXVpcmUoJ2RhdGFzZXQnKTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBUcmFuc3BvcnQuXFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBUb29sdGlwcztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBHbG9iYWxzLlxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIHZhciBNT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2Via2l0TXV0YXRpb25PYnNlcnZlcjtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBQcm90b3R5cGFsIGluaGVyaXRhbmNlLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge09iamVjdH1cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICB2YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCAoZnVuY3Rpb24gKCkge1xcblxcXG4gICAgICAgIFxcdGZ1bmN0aW9uIEYoKSB7fVxcblxcXG4gICAgICAgIFxcdHJldHVybiBmdW5jdGlvbiAobykge1xcblxcXG4gICAgICAgIFxcdFxcdEYucHJvdG90eXBlID0gbztcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gbmV3IEYoKTtcXG5cXFxuICAgICAgICBcXHR9O1xcblxcXG4gICAgICAgIH0pKCk7XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgLyoqXFxuXFxcbiAgICAgICAgICogUG9vciBtYW4ncyBzaGFsbG93IG9iamVjdCBleHRlbmQuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gYVxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBiXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XFxuXFxcbiAgICAgICAgICovXFxuXFxcbiAgICAgICAgZnVuY3Rpb24gZXh0ZW5kKGEsIGIpIHtcXG5cXFxuICAgICAgICBcXHRmb3IgKHZhciBrZXkgaW4gYikge1xcblxcXG4gICAgICAgIFxcdFxcdGFba2V5XSA9IGJba2V5XTtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFx0cmV0dXJuIGE7XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIENhcGl0YWxpemUgdGhlIGZpcnN0IGxldHRlciBvZiBhIHN0cmluZy5cXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmdcXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ31cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBmdW5jdGlvbiB1Y0ZpcnN0KHN0cmluZykge1xcblxcXG4gICAgICAgIFxcdHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XFxuXFxcbiAgICAgICAgfVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIC8qKlxcblxcXG4gICAgICAgICAqIFRvb2x0aXBzIGNvbnN0cnVjdG9yLlxcblxcXG4gICAgICAgICAqXFxuXFxcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXJcXG5cXFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gIG9wdGlvbnNcXG5cXFxuICAgICAgICAgKlxcblxcXG4gICAgICAgICAqIEByZXR1cm4ge1Rvb2x0aXBzfVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIGZ1bmN0aW9uIFRvb2x0aXBzKGNvbnRhaW5lciwgb3B0aW9ucykge1xcblxcXG4gICAgICAgIFxcdGlmICghKHRoaXMgaW5zdGFuY2VvZiBUb29sdGlwcykpIHtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gbmV3IFRvb2x0aXBzKGNvbnRhaW5lciwgb3B0aW9ucyk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdHZhciBzZWxmID0gdGhpcztcXG5cXFxuICAgICAgICBcXHR2YXIgb2JzZXJ2ZXIsIFRJRDtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvKipcXG5cXFxuICAgICAgICBcXHQgKiBTaG93IHRvb2x0aXAgYXR0YWNoZWQgdG8gYW4gZWxlbWVudC5cXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudFxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7VG9vbHRpcHN9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0c2VsZi5zaG93ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gY2FsbFRvb2x0aXBNZXRob2QoZWxlbWVudCwgJ3Nob3cnKTtcXG5cXFxuICAgICAgICBcXHR9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIEhpZGUgdG9vbHRpcCBhdHRhY2hlZCB0byBhbiBlbGVtZW50LlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtUb29sdGlwc31cXG5cXFxuICAgICAgICBcXHQgKi9cXG5cXFxuICAgICAgICBcXHRzZWxmLmhpZGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdHJldHVybiBjYWxsVG9vbHRpcE1ldGhvZChlbGVtZW50LCAnaGlkZScpO1xcblxcXG4gICAgICAgIFxcdH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0LyoqXFxuXFxcbiAgICAgICAgXFx0ICogVG9nZ2xlIHRvb2x0aXAgYXR0YWNoZWQgdG8gYW4gZWxlbWVudC5cXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudFxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7VG9vbHRpcHN9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdHJldHVybiBjYWxsVG9vbHRpcE1ldGhvZChlbGVtZW50LCAndG9nZ2xlJyk7XFxuXFxcbiAgICAgICAgXFx0fTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvKipcXG5cXFxuICAgICAgICBcXHQgKiBSZXRyaWV2ZSB0b29sdGlwIGF0dGFjaGVkIHRvIGFuIGVsZW1lbnQgYW5kIGNhbGwgaXQncyBtZXRob2QuXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnRcXG5cXFxuICAgICAgICBcXHQgKiBAcGFyYW0ge1N0cmluZ30gIG1ldGhvZFxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7VG9vbHRpcHN9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0ZnVuY3Rpb24gY2FsbFRvb2x0aXBNZXRob2QoZWxlbWVudCwgbWV0aG9kKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dmFyIHRpcCA9IHNlbGYuZ2V0KGVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdFxcdGlmICh0aXApIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHR0aXBbbWV0aG9kXSgpO1xcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gc2VsZjtcXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0LyoqXFxuXFxcbiAgICAgICAgXFx0ICogUmV0dXJuIGEgdG9vbHRpcCBhdHRhY2hlZCB0byBhbiBlbGVtZW50LiBUb29sdGlwIGlzIGNyZWF0ZWQgaWYgaXQgZG9lc24ndCBleGlzdCB5ZXQuXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnRcXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEByZXR1cm4ge1Rvb2x0aXB9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0c2VsZi5nZXQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdHZhciB0aXAgPSAhIWVsZW1lbnQgJiYgKGVsZW1lbnRbVElEXSB8fCBjcmVhdGVUaXAoZWxlbWVudCkpO1xcblxcXG4gICAgICAgIFxcdFxcdGlmICh0aXAgJiYgIWVsZW1lbnRbVElEXSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGVsZW1lbnRbVElEXSA9IHRpcDtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0cmV0dXJuIHRpcDtcXG5cXFxuICAgICAgICBcXHR9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIEFkZCBlbGVtZW50KHMpIHRvIFRvb2x0aXBzIGluc3RhbmNlLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtbdHlwZV19IGVsZW1lbnQgQ2FuIGJlIGVsZW1lbnQsIG9yIGNvbnRhaW5lciBjb250YWluaW5nIGVsZW1lbnRzIHRvIGJlIGFkZGVkLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7VG9vbHRpcHN9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0c2VsZi5hZGQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdGlmICghZWxlbWVudCB8fCBlbGVtZW50Lm5vZGVUeXBlICE9PSAxKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0cmV0dXJuIHNlbGY7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdGlmIChkYXRhc2V0KGVsZW1lbnQpLmdldChvcHRpb25zLmtleSkpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRiaW5kRWxlbWVudChlbGVtZW50KTtcXG5cXFxuICAgICAgICBcXHRcXHR9IGVsc2UgaWYgKGVsZW1lbnQuY2hpbGRyZW4pIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRiaW5kRWxlbWVudHMoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGYuc2VsZWN0b3IpKTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0cmV0dXJuIHNlbGY7XFxuXFxcbiAgICAgICAgXFx0fTtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvKipcXG5cXFxuICAgICAgICBcXHQgKiBSZW1vdmUgZWxlbWVudChzKSBmcm9tIFRvb2x0aXBzIGluc3RhbmNlLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IENhbiBiZSBlbGVtZW50LCBvciBjb250YWluZXIgY29udGFpbmluZyBlbGVtZW50cyB0byBiZSByZW1vdmVkLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7VG9vbHRpcHN9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0c2VsZi5yZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdGlmICghZWxlbWVudCB8fCBlbGVtZW50Lm5vZGVUeXBlICE9PSAxKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0cmV0dXJuIHNlbGY7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdGlmIChkYXRhc2V0KGVsZW1lbnQpLmdldChvcHRpb25zLmtleSkpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHR1bmJpbmRFbGVtZW50KGVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdFxcdH0gZWxzZSBpZiAoZWxlbWVudC5jaGlsZHJlbikge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHVuYmluZEVsZW1lbnRzKGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxmLnNlbGVjdG9yKSk7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdHJldHVybiBzZWxmO1xcblxcXG4gICAgICAgIFxcdH07XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0LyoqXFxuXFxcbiAgICAgICAgXFx0ICogUmVsb2FkIFRvb2x0aXBzIGluc3RhbmNlLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogVW5iaW5kcyBjdXJyZW50IHRvb2x0aXBwZWQgZWxlbWVudHMsIHRoYW4gc2VsZWN0cyB0aGVcXG5cXFxuICAgICAgICBcXHQgKiBkYXRhLWtleSBlbGVtZW50cyBmcm9tIGNvbnRhaW5lciBhbmQgYmluZHMgdGhlbSBhZ2Fpbi5cXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEByZXR1cm4ge1Rvb2x0aXBzfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdHNlbGYucmVsb2FkID0gZnVuY3Rpb24gKCkge1xcblxcXG4gICAgICAgIFxcdFxcdC8vIFVuYmluZCBvbGQgZWxlbWVudHNcXG5cXFxuICAgICAgICBcXHRcXHR1bmJpbmRFbGVtZW50cyhzZWxmLmVsZW1lbnRzKTtcXG5cXFxuICAgICAgICBcXHRcXHQvLyBCaW5kIG5ldyBlbGVtZW50c1xcblxcXG4gICAgICAgIFxcdFxcdGJpbmRFbGVtZW50cyhzZWxmLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKHNlbGYuc2VsZWN0b3IpKTtcXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gc2VsZjtcXG5cXFxuICAgICAgICBcXHR9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIERlc3Ryb3kgVG9vbHRpcHMgaW5zdGFuY2UuXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtWb2lkfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdHNlbGYuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcXG5cXFxuICAgICAgICBcXHRcXHR1bmJpbmRFbGVtZW50cyh0aGlzLmVsZW1lbnRzKTtcXG5cXFxuICAgICAgICBcXHRcXHRpZiAob2JzZXJ2ZXIpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRvYnNlcnZlci5kaXNjb25uZWN0KCk7XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdHRoaXMuY29udGFpbmVyID0gdGhpcy5lbGVtZW50cyA9IHRoaXMub3B0aW9ucyA9IG9ic2VydmVyID0gbnVsbDtcXG5cXFxuICAgICAgICBcXHR9O1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIENyZWF0ZSBhIHRpcCBmcm9tIGVsZW1lbnQgZGF0YSBhdHRyaWJ1dGVzLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtUb29sdGlwfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdGZ1bmN0aW9uIGNyZWF0ZVRpcChlbGVtZW50KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dmFyIGRhdGEgPSBkYXRhc2V0KGVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdFxcdHZhciBjb250ZW50ID0gZGF0YS5nZXQob3B0aW9ucy5rZXkpO1xcblxcXG4gICAgICAgIFxcdFxcdGlmICghY29udGVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHJldHVybiBmYWxzZTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0dmFyIHRpcE9wdGlvbnMgPSBvYmplY3RDcmVhdGUob3B0aW9ucy50b29sdGlwKTtcXG5cXFxuICAgICAgICBcXHRcXHR2YXIga2V5RGF0YTtcXG5cXFxuICAgICAgICBcXHRcXHRmb3IgKHZhciBrZXkgaW4gVG9vbHRpcC5kZWZhdWx0cykge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGtleURhdGEgPSBkYXRhLmdldChvcHRpb25zLmtleSArIHVjRmlyc3Qoa2V5LnJlcGxhY2UoL0NsYXNzJC8sICcnKSkpO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGlmICgha2V5RGF0YSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdGNvbnRpbnVlO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHRcXHR0aXBPcHRpb25zW2tleV0gPSBrZXlEYXRhO1xcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHRyZXR1cm4gbmV3IFRvb2x0aXAoY29udGVudCwgdGlwT3B0aW9ucykuYXR0YWNoKGVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvKipcXG5cXFxuICAgICAgICBcXHQgKiBCaW5kIFRvb2x0aXBzIGV2ZW50cyB0byBBcnJheS9Ob2RlTGlzdCBvZiBlbGVtZW50cy5cXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEBwYXJhbSB7QXJyYXl9IGVsZW1lbnRzXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtWb2lkfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdGZ1bmN0aW9uIGJpbmRFbGVtZW50cyhlbGVtZW50cykge1xcblxcXG4gICAgICAgIFxcdFxcdGZvciAodmFyIGkgPSAwLCBsID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0YmluZEVsZW1lbnQoZWxlbWVudHNbaV0pO1xcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHR9XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0LyoqXFxuXFxcbiAgICAgICAgXFx0ICogQmluZCBUb29sdGlwcyBldmVudHMgdG8gZWxlbWVudC5cXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudFxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7Vm9pZH1cXG5cXFxuICAgICAgICBcXHQgKi9cXG5cXFxuICAgICAgICBcXHRmdW5jdGlvbiBiaW5kRWxlbWVudChlbGVtZW50KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0aWYgKGVsZW1lbnRbVElEXSB8fCB+aW5kZXhPZihzZWxmLmVsZW1lbnRzLCBlbGVtZW50KSkge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdHJldHVybjtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0ZXZ0LmJpbmQoZWxlbWVudCwgb3B0aW9ucy5zaG93T24sIGV2ZW50SGFuZGxlcik7XFxuXFxcbiAgICAgICAgXFx0XFx0ZXZ0LmJpbmQoZWxlbWVudCwgb3B0aW9ucy5oaWRlT24sIGV2ZW50SGFuZGxlcik7XFxuXFxcbiAgICAgICAgXFx0XFx0c2VsZi5lbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xcblxcXG4gICAgICAgIFxcdH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHQvKipcXG5cXFxuICAgICAgICBcXHQgKiBVbmJpbmQgVG9vbHRpcHMgZXZlbnRzIGZyb20gQXJyYXkvTm9kZUxpc3Qgb2YgZWxlbWVudHMuXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcGFyYW0ge0FycmF5fSBlbGVtZW50c1xcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHJldHVybiB7Vm9pZH1cXG5cXFxuICAgICAgICBcXHQgKi9cXG5cXFxuICAgICAgICBcXHRmdW5jdGlvbiB1bmJpbmRFbGVtZW50cyhlbGVtZW50cykge1xcblxcXG4gICAgICAgIFxcdFxcdGlmIChzZWxmLmVsZW1lbnRzID09PSBlbGVtZW50cykge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGVsZW1lbnRzID0gZWxlbWVudHMuc2xpY2UoKTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHR1bmJpbmRFbGVtZW50KGVsZW1lbnRzW2ldKTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIFVuYmluZCBUb29sdGlwcyBldmVudHMgZnJvbSBlbGVtZW50LlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtWb2lkfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdGZ1bmN0aW9uIHVuYmluZEVsZW1lbnQoZWxlbWVudCkge1xcblxcXG4gICAgICAgIFxcdFxcdHZhciBpbmRleCA9IGluZGV4T2Yoc2VsZi5lbGVtZW50cywgZWxlbWVudCk7XFxuXFxcbiAgICAgICAgXFx0XFx0aWYgKCF+aW5kZXgpIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRyZXR1cm47XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdGlmIChlbGVtZW50W1RJRF0pIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRlbGVtZW50W1RJRF0uZGVzdHJveSgpO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdGRlbGV0ZSBlbGVtZW50W1RJRF07XFxuXFxcbiAgICAgICAgXFx0XFx0fVxcblxcXG4gICAgICAgIFxcdFxcdGV2dC51bmJpbmQoZWxlbWVudCwgb3B0aW9ucy5zaG93T24sIGV2ZW50SGFuZGxlcik7XFxuXFxcbiAgICAgICAgXFx0XFx0ZXZ0LnVuYmluZChlbGVtZW50LCBvcHRpb25zLmhpZGVPbiwgZXZlbnRIYW5kbGVyKTtcXG5cXFxuICAgICAgICBcXHRcXHRzZWxmLmVsZW1lbnRzLnNwbGljZShpbmRleCwgMSk7XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIFRvb2x0aXBzIGV2ZW50cyBoYW5kbGVyLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtFdmVudH0gZXZlbnRcXG5cXFxuICAgICAgICBcXHQgKlxcblxcXG4gICAgICAgIFxcdCAqIEByZXR1cm4ge1ZvaWR9XFxuXFxcbiAgICAgICAgXFx0ICovXFxuXFxcbiAgICAgICAgXFx0ZnVuY3Rpb24gZXZlbnRIYW5kbGVyKGV2ZW50KSB7XFxuXFxcbiAgICAgICAgXFx0XFx0Lypqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cXG5cXFxuICAgICAgICBcXHRcXHRpZiAob3B0aW9ucy5zaG93T24gPT09IG9wdGlvbnMuaGlkZU9uKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0c2VsZi50b2dnbGUodGhpcyk7XFxuXFxcbiAgICAgICAgXFx0XFx0fSBlbHNlIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRzZWxmW2V2ZW50LnR5cGUgPT09IG9wdGlvbnMuc2hvd09uID8gJ3Nob3cnIDogJ2hpZGUnXSh0aGlzKTtcXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8qKlxcblxcXG4gICAgICAgIFxcdCAqIE11dGF0aW9ucyBoYW5kbGVyLlxcblxcXG4gICAgICAgIFxcdCAqXFxuXFxcbiAgICAgICAgXFx0ICogQHBhcmFtIHtBcnJheX0gbXV0YXRpb25zXFxuXFxcbiAgICAgICAgXFx0ICpcXG5cXFxuICAgICAgICBcXHQgKiBAcmV0dXJuIHtWb2lkfVxcblxcXG4gICAgICAgIFxcdCAqL1xcblxcXG4gICAgICAgIFxcdGZ1bmN0aW9uIG11dGF0aW9uc0hhbmRsZXIobXV0YXRpb25zKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0dmFyIGFkZGVkLCByZW1vdmVkLCBpLCBsO1xcblxcXG4gICAgICAgIFxcdFxcdGZvciAodmFyIG0gPSAwLCBtbCA9IG11dGF0aW9ucy5sZW5ndGg7IG0gPCBtbDsgbSsrKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0YWRkZWQgPSBtdXRhdGlvbnNbbV0uYWRkZWROb2RlcztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRyZW1vdmVkID0gbXV0YXRpb25zW21dLnJlbW92ZWROb2RlcztcXG5cXFxuICAgICAgICBcXHRcXHRcXHRmb3IgKGkgPSAwLCBsID0gYWRkZWQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0c2VsZi5hZGQoYWRkZWRbaV0pO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHRcXHRmb3IgKGkgPSAwLCBsID0gcmVtb3ZlZC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRcXHRzZWxmLnJlbW92ZShyZW1vdmVkW2ldKTtcXG5cXFxuICAgICAgICBcXHRcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0aWYgKG11dGF0aW9uc1ttXS50eXBlID09ICdhdHRyaWJ1dGVzJyAmJiBtdXRhdGlvbnNbbV0uYXR0cmlidXRlTmFtZSA9PSAnZGF0YS10aXRsZScpe1xcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdGlmICghc2VsZi5nZXQobXV0YXRpb25zW21dKSkgeyBzZWxmLmFkZChtdXRhdGlvbnNbbV0udGFyZ2V0KTsgfVxcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdHNlbGYuZ2V0KG11dGF0aW9uc1ttXS50YXJnZXQpLmNvbnRlbnQoZGF0YXNldChtdXRhdGlvbnNbbV0udGFyZ2V0KS5nZXQoJ3RpdGxlJykpO1xcblxcXG4gICAgICAgIFxcdFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHRcXHR9XFxuXFxcbiAgICAgICAgXFx0fVxcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdC8vIENvbnN0cnVjdFxcblxcXG4gICAgICAgIFxcdChmdW5jdGlvbiAoKSB7XFxuXFxcbiAgICAgICAgXFx0XFx0c2VsZi5jb250YWluZXIgPSBjb250YWluZXI7XFxuXFxcbiAgICAgICAgXFx0XFx0c2VsZi5vcHRpb25zID0gb3B0aW9ucyA9IGV4dGVuZChvYmplY3RDcmVhdGUoVG9vbHRpcHMuZGVmYXVsdHMpLCBvcHRpb25zKTtcXG5cXFxuICAgICAgICBcXHRcXHRzZWxmLklEID0gVElEID0gb3B0aW9ucy5rZXkgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKTtcXG5cXFxuICAgICAgICBcXHRcXHRzZWxmLmVsZW1lbnRzID0gW107XFxuXFxcbiAgICAgICAgXFxuXFxcbiAgICAgICAgXFx0XFx0Ly8gQ3JlYXRlIHRpcHMgc2VsZWN0b3JcXG5cXFxuICAgICAgICBcXHRcXHRzZWxmLnNlbGVjdG9yID0gJ1tkYXRhLScgKyBvcHRpb25zLmtleSArICddJztcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICBcXHRcXHQvLyBMb2FkIHRpcHNcXG5cXFxuICAgICAgICBcXHRcXHRzZWxmLnJlbG9hZCgpO1xcblxcXG4gICAgICAgIFxcblxcXG4gICAgICAgIFxcdFxcdC8vIENyZWF0ZSBtdXRhdGlvbnMgb2JzZXJ2ZXJcXG5cXFxuICAgICAgICBcXHRcXHRpZiAob3B0aW9ucy5vYnNlcnZlICYmIE1PYnNlcnZlcikge1xcblxcXG4gICAgICAgIFxcdFxcdFxcdG9ic2VydmVyID0gbmV3IE1PYnNlcnZlcihtdXRhdGlvbnNIYW5kbGVyKTtcXG5cXFxuICAgICAgICBcXHRcXHRcXHRvYnNlcnZlci5vYnNlcnZlKHNlbGYuY29udGFpbmVyLCB7XFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0Y2hpbGRMaXN0OiB0cnVlLFxcblxcXG4gICAgICAgIFxcdFxcdFxcdFxcdHN1YnRyZWU6IHRydWUsXFxuXFxcbiAgICAgICAgXFx0XFx0XFx0XFx0YXR0cmlidXRlczogdHJ1ZVxcblxcXG4gICAgICAgIFxcdFxcdFxcdH0pO1xcblxcXG4gICAgICAgIFxcdFxcdH1cXG5cXFxuICAgICAgICBcXHR9KCkpO1xcblxcXG4gICAgICAgIH1cXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBFeHBvc2UgVG9vbHRpcC5cXG5cXFxuICAgICAgICAgKi9cXG5cXFxuICAgICAgICBUb29sdGlwcy5Ub29sdGlwID0gVG9vbHRpcDtcXG5cXFxuICAgICAgICBcXG5cXFxuICAgICAgICAvKipcXG5cXFxuICAgICAgICAgKiBEZWZhdWx0IFRvb2x0aXBzIG9wdGlvbnMuXFxuXFxcbiAgICAgICAgICpcXG5cXFxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxcblxcXG4gICAgICAgICAqL1xcblxcXG4gICAgICAgIFRvb2x0aXBzLmRlZmF1bHRzID0ge1xcblxcXG4gICAgICAgIFxcdHRvb2x0aXA6ICAgIHt9LCAgICAgICAgICAvLyBPcHRpb25zIGZvciBpbmRpdmlkdWFsIFRvb2x0aXAgaW5zdGFuY2VzLlxcblxcXG4gICAgICAgIFxcdGtleTogICAgICAgJ3Rvb2x0aXAnLCAgICAvLyBUb29sdGlwcyBkYXRhIGF0dHJpYnV0ZSBrZXkuXFxuXFxcbiAgICAgICAgXFx0c2hvd09uOiAgICAnbW91c2VlbnRlcicsIC8vIFNob3cgdG9vbHRpcCBldmVudC5cXG5cXFxuICAgICAgICBcXHRoaWRlT246ICAgICdtb3VzZWxlYXZlJywgLy8gSGlkZSB0b29sdGlwIGV2ZW50LlxcblxcXG4gICAgICAgIFxcdG9ic2VydmU6ICAgMCAgICAgICAgICAgICAvLyBFbmFibGUgbXV0YXRpb24gb2JzZXJ2ZXIgKHVzZWQgb25seSB3aGVuIHN1cHBvcnRlZCkuXFxuXFxcbiAgICAgICAgfTsvLyMgc291cmNlVVJMPXRvb2x0aXBzL2luZGV4LmpzXCJcbiAgICApKTtcblxuXG5cblxuXG5cblxuXG5cblxuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiZGFyc2Fpbi10b29sdGlwL2luZGV4LmpzXCIsIFwidG9vbHRpcHMvZGVwcy90b29sdGlwL2luZGV4LmpzXCIpO1xuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiZGFyc2Fpbi10b29sdGlwL2luZGV4LmpzXCIsIFwidG9vbHRpcC9pbmRleC5qc1wiKTtcbiAgICBmYWtlUmVxdWlyZS5hbGlhcyhcImRhcnNhaW4tZXZlbnQvaW5kZXguanNcIiwgXCJkYXJzYWluLXRvb2x0aXAvZGVwcy9ldmVudC9pbmRleC5qc1wiKTtcblxuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiZGFyc2Fpbi1wb3NpdGlvbi9pbmRleC5qc1wiLCBcImRhcnNhaW4tdG9vbHRpcC9kZXBzL3Bvc2l0aW9uL2luZGV4LmpzXCIpO1xuXG4gICAgZmFrZVJlcXVpcmUuYWxpYXMoXCJjb21wb25lbnQtY2xhc3Nlcy9pbmRleC5qc1wiLCBcImRhcnNhaW4tdG9vbHRpcC9kZXBzL2NsYXNzZXMvaW5kZXguanNcIik7XG4gICAgZmFrZVJlcXVpcmUuYWxpYXMoXCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qc1wiLCBcImNvbXBvbmVudC1jbGFzc2VzL2RlcHMvaW5kZXhvZi9pbmRleC5qc1wiKTtcblxuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanNcIiwgXCJkYXJzYWluLXRvb2x0aXAvZGVwcy9pbmRleG9mL2luZGV4LmpzXCIpO1xuXG4gICAgZmFrZVJlcXVpcmUuYWxpYXMoXCJkYXJzYWluLWV2ZW50L2luZGV4LmpzXCIsIFwidG9vbHRpcHMvZGVwcy9ldmVudC9pbmRleC5qc1wiKTtcbiAgICBmYWtlUmVxdWlyZS5hbGlhcyhcImRhcnNhaW4tZXZlbnQvaW5kZXguanNcIiwgXCJldmVudC9pbmRleC5qc1wiKTtcblxuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanNcIiwgXCJ0b29sdGlwcy9kZXBzL2luZGV4b2YvaW5kZXguanNcIik7XG4gICAgZmFrZVJlcXVpcmUuYWxpYXMoXCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qc1wiLCBcImluZGV4b2YvaW5kZXguanNcIik7XG5cbiAgICBmYWtlUmVxdWlyZS5hbGlhcyhcImNvZGU0MmRheS1kYXRhc2V0L2luZGV4LmpzXCIsIFwidG9vbHRpcHMvZGVwcy9kYXRhc2V0L2luZGV4LmpzXCIpO1xuICAgIGZha2VSZXF1aXJlLmFsaWFzKFwiY29kZTQyZGF5LWRhdGFzZXQvaW5kZXguanNcIiwgXCJkYXRhc2V0L2luZGV4LmpzXCIpO1xuICAgIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFrZVJlcXVpcmUoXCJ0b29sdGlwc1wiKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKGZ1bmN0aW9uKCl7IHJldHVybiBmYWtlUmVxdWlyZShcInRvb2x0aXBzXCIpOyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzW1wiVG9vbHRpcHNcIl0gPSBmYWtlUmVxdWlyZShcInRvb2x0aXBzXCIpO1xuICAgIH19KSgpO1xuIl19